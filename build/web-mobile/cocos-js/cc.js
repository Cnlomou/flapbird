System.register([],(function(t,e){"use strict";return{execute:function(){function n(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function i(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function a(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}t({BitMask:re,CCClass:tn,CacheMode:void 0,DebugMode:void 0,ECollider2DType:void 0,EJoint2DType:void 0,EPhysics2DDrawFlags:void 0,ERaycast2DType:void 0,ERigidBody2DType:void 0,Enum:oe,Eventify:$l,ExtrapolationMode:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,KeyCode:void 0,Overflow:void 0,Physics2DManifoldType:void 0,PhysicsGroup:void 0,PipelineEventType:void 0,QuatInterpolationMode:void 0,RealInterpolationMode:void 0,SystemEventType:void 0,TangentWeightMode:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:Hb,WorldNode3DToWorldNodeUI:Wb,absMax:bn,absMaxComponent:Cn,approx:ln,assert:x,assertID:L,bezier:P_,bezierByTime:q_,ccenum:le,clamp:un,clamp01:hn,color:Rn,computeRatioByType:DJ,createDefaultPipeline:XO,debug:E,deserialize:Lh,earcut:tj,enumerableProps:wn,equals:cn,error:T,errorID:O,find:VR,fragmentText:DB,getBaselineOffset:function(){return 0},getEnglishWordPartAtFirst:PB,getEnglishWordPartAtLast:RB,getError:F,getPathFromRoot:function(t,e){for(var n=t,i="";null!==n&&n!==e;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},getSerializationMetadata:function(t){return t[Rc]},getWorldTransformUntilRoot:X2,instantiate:Zh,inverseLerp:An,isDisplayStats:B,isEnglishWordPartAtFirst:function(t){return AB.test(t)},isEnglishWordPartAtLast:function(t){return EB.test(t)},isUnicodeCJK:CB,isUnicodeSpace:bB,isValid:pl,lerp:fn,log:y,logID:I,markAsWarning:void 0,mat4:Kn,murmurhash2_32_gc:Sa,nextPow2:Tn,pingPong:En,pseudoRandom:vn,pseudoRandomRange:yn,pseudoRandomRangeInt:Sn,quat:Wn,randomRange:mn,randomRangeInt:gn,rect:oi,removeProperty:void 0,repeat:xn,replaceProperty:void 0,safeMeasureText:wB,sampleAnimationCurve:RJ,setDefaultLogTimes:function(t){t>0&&(X=t)},setDisplayStats:z,size:ri,toDegree:dn,toRadian:_n,tween:Lmt,tweenUtil:Fmt,v2:$n,v3:Mn,v4:ei,warn:S,warnID:R});var o=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,i=e,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;t[e]=i<<r&255}}(o);var s=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-2147483648,sign:function(t){return(t>0)-(t<0)},abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:n,log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:i,countTrailingZeros:r,nextPow2:a,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},interleave3:function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>r(t)+1}});t("bits",s);var c="undefined"==typeof window?global:window,l=t("cclegacy",{_global:c});l.internal={},c.CC_BUILD=!0,c.CC_TEST=!1,c.CC_EDITOR=false,c.CC_PREVIEW=!1,c.CC_DEV=!1,c.CC_DEBUG=!1,c.CC_JSB=!1,c.CC_BYTEDANCE=!1,c.CC_WECHAT=!1,c.CC_ALIPAY=!1,c.CC_XIAOMI=!1,c.CC_BAIDU=!1,c.CC_COCOSPLAY=!1,c.CC_HUAWEI=!1,c.CC_OPPO=!1,c.CC_VIVO=!1,c.CC_MINIGAME=!1,c.CC_RUNTIME_BASED=!1,c.CC_SUPPORT_JIT=!0;var u=t("VERSION","3.5.1");c.CocosEngine=l.ENGINE_VERSION=u,c.cc=l;var h="https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md",f=null,_=console.log.bind(console),d=_,p=_,m=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+v.apply(void 0,[e].concat(i)))}},g=_;function v(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return l.js.formatStr.apply(null,[t].concat(n))}function y(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return _.apply(void 0,[t].concat(n))}function S(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return d.apply(void 0,[t].concat(n))}function T(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return p.apply(void 0,[t].concat(n))}function x(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return m.apply(void 0,[t,e].concat(i))}function E(){return g.apply(void 0,arguments)}function A(t){if(_=d=p=m=g=function(){},t!==N.NONE){if(t>N.ERROR){var e=function(t){if(l.game.canvas){if(!f){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",l.game.canvas.height);var n=e.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(f=document.createElement("textarea")).setAttribute("rows","20"),f.setAttribute("cols","30"),f.setAttribute("disabled","true");var i=f.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",e.appendChild(f),l.game.canvas.parentNode.appendChild(e)}f.value=f.value+t+"\r\n",f.scrollTop=f.scrollHeight}};p=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("ERROR :  "+v.apply(void 0,[t].concat(i)))},m=function(t,n){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];e("ASSERT: "+v.apply(void 0,[n].concat(r)))}},t!==N.ERROR_FOR_WEB_PAGE&&(d=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("WARN :  "+v.apply(void 0,[t].concat(i)))}),t===N.INFO_FOR_WEB_PAGE&&(_=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e(v.apply(void 0,[t].concat(i)))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),p=console.error.bind?console.error.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.error.apply(console,[t].concat(n))},m=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var a=v.apply(void 0,[e].concat(i));throw new Error(a)}});if(t!==N.ERROR&&(d=console.warn.bind?console.warn.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.warn.apply(console,[t].concat(n))}),t<=N.INFO&&(_=console.log.bind?console.log.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.log.apply(console,[t].concat(n))}),t<=N.VERBOSE&&"function"==typeof console.debug){var n=console.debug.bind(console);g=function(){return n.apply(void 0,arguments)}}}}function C(t){T(t.stack||t)}function b(t){return function(e){for(var n=t+" "+e+", please go to "+h+"#"+e+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var w=b("Log");function I(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];y(w.apply(void 0,[t].concat(n)))}var P=b("Warning");function R(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];S(P.apply(void 0,[t].concat(n)))}var D=b("Error");function O(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];T(D.apply(void 0,[t].concat(n)))}var N,M=b("Assert");function L(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];x(!1,M.apply(void 0,[e].concat(i)))}}function F(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return D.apply(void 0,[t].concat(n))}function B(){return!!l.profiler&&l.profiler.isShowingStats()}function z(t){l.profiler&&(t?l.profiler.showStats():l.profiler.hideStats(),l.game.config.showFPS=!!t)}!function(t){t[t.NONE=0]="NONE",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",t[t.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",t[t.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(N||(N=t("DebugMode",{})));var U,k,G,V,H,W,j=Object.freeze({__proto__:null,log:y,warn:S,error:T,assert:x,debug:E,_resetDebugSetting:A,_throw:C,logID:I,warnID:R,errorID:O,assertID:L,get DebugMode(){return N},getError:F,isDisplayStats:B,setDisplayStats:z}),X=10,q=0,Y=new Map;function K(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t,e,n){return e&&K(t.prototype,e),n&&K(t,n),t}function J(){return(J=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function Z(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,tt(t,e)}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tt(t,e){return(tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function et(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function nt(t,e,n){return(nt=et()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&tt(r,n.prototype),r}).apply(null,arguments)}function it(t){var e="function"==typeof Map?new Map:void 0;return(it=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return nt(t,arguments,$(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),tt(i,t)})(t)}function rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function ot(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return at(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?at(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function st(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function ct(t,e,n,i,r){var a={};return Object.keys(i).forEach((function(t){a[t]=i[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,i){return i(t,e,n)||n}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}V=function(t,e,n,i,r,a,o){var s=Y.get(a);s&&s.logTimes>s.count&&(r("'%s' is deprecated, please use '%s' instead. "+o,t+"."+e,n+"."+i),s.count++)},U=t("replaceProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=q++;Y.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var r=null!=n.target?n.target:t,a=null!=n.newName?n.newName:n.name,o=null!=n.targetName?n.targetName:e,s=r===t,c=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)t[n.name]=function(){var t;return V(e,n.name,o,a,S,i,c),(t=n.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var l=null!=n.customSetter,u=null!=n.customGetter;l&&u?Object.defineProperty(t,n.name,{get:function(){return V(e,n.name,o,a,S,i,c),n.customGetter.call(this)},set:function(t){V(e,n.name,o,a,S,i,c),n.customSetter.call(this,t)},enumerable:!1}):l?Object.defineProperty(t,n.name,{set:function(t){V(e,n.name,o,a,S,i,c),n.customSetter.call(this,t)},enumerable:!1}):u&&Object.defineProperty(t,n.name,{get:function(){return V(e,n.name,o,a,S,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,n.name,{get:function(){return V(e,n.name,o,a,S,i,c),s?this[a]:r[a]},set:function(t){V(e,n.name,o,a,S,i,c),s?this[a]=t:r[a]=t},enumerable:!1})}))})),W=function(t,e,n,i,r){var a=Y.get(i);a&&a.logTimes>a.count&&(n("'%s' has been removed. "+r,t+"."+e),a.count++)},k=t("removeProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=q++;Y.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var r=n.suggest?"("+n.suggest+")":"";Object.defineProperty(t,n.name,{get:function(){return W(e,n.name,T,i,r)},set:function(){W(e,n.name,T,i,r)},enumerable:!1})}))})),H=function(t,e,n,i,r){var a=Y.get(i);a&&a.logTimes>a.count&&(n("'%s' is deprecated. "+r,t+"."+e),a.count++)},G=t("markAsWarning",(function(t,e,n){null!=t&&n.forEach((function(n){var i=n.name,r=Object.getOwnPropertyDescriptor(t,i);if(r&&r.configurable){var a=q++;Y.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var o=n.suggest?"("+n.suggest+")":"";if(void 0!==r.value)if("function"==typeof r.value){var s=r.value;t[i]=function(){return H(e,i,S,a,o),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else{var c=r.value;Object.defineProperty(t,i,{configurable:!0,get:function(){return H(e,i,S,a,o),c}}),r.writable&&Object.defineProperty(t,i,{set:function(t){H(e,i,S,a,o),c=t}})}else!function(e,n,i,r,a,o){if(e.get){var s=e.get;e.get=function(){return H(n,i,r,a,o),s.call(this)}}if(e.set){var c=e.set;e.set=function(t){H(n,i,r,a,o),c.call(this,t)}}Object.defineProperty(t,i,e)}(r,e,i,S,a,o);Object.defineProperty(t,i,{enumerable:!1})}}))}));var lt=function(){function t(t){this.i=0,this.array=t}var e=t.prototype;return e.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},e.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},e.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},e.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},e.push=function(t){this.array.push(t)},Q(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function ut(t,e){t.splice(e,1)}function ht(t,e){var n=t.length;e<0||e>=n||(t[e]=t[n-1],t.length=n-1)}function ft(t,e){var n=t.indexOf(e);return n>=0&&(ut(t,n),!0)}function _t(t,e){var n=t.findIndex(e);if(n>=0){var i=t[n];return ut(t,n),i}}function dt(t,e){return t.indexOf(e)>=0}var pt=Object.freeze({__proto__:null,removeAt:ut,fastRemoveAt:ht,remove:ft,fastRemove:function(t,e){var n=t.indexOf(e);n>=0&&(t[n]=t[t.length-1],--t.length)},removeIf:_t,verifyType:function(t,e){if(t&&t.length>0)for(var n,i=ot(t);!(n=i()).done;)if(!(n.value instanceof e))return I(1300),!1;return!0},removeArray:function(t,e){for(var n=0,i=e.length;n<i;n++)ft(t,e[n])},appendObjectsAt:function(t,e,n){return t.splice.apply(t,[n,0].concat(e)),t},contains:dt,copy:function(t){for(var e=t.length,n=new Array(e),i=0;i<e;i+=1)n[i]=t[i];return n},MutableForwardIterator:lt}),mt=function(){function t(t){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+ ++this.id},t}();mt.global=new mt("global");var gt=new mt("TmpCId."),vt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),yt="__cid__";function St(t){return"number"==typeof t||t instanceof Number}function Tt(t){return"string"==typeof t||t instanceof String}function xt(t){for(var e in t)return!1;return!0}var Et,At=(Et={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,e,n,i,r){Et.value=n,Et.writable=i,Et.enumerable=r,Object.defineProperty(t,e,Et),Et.value=void 0}),Ct=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(e,n,i,r,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),"boolean"==typeof r&&(a=r,r=void 0),t.get=i,t.set=r,t.enumerable=a,t.configurable=o,Object.defineProperty(e,n,t),t.get=void 0,t.set=void 0}}(),bt=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.get=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.get=void 0}}(),wt=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.set=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.set=void 0}}();function It(t){var e=Object.create(null);return t&&(e["."]=1,e["/"]=1,delete e["."],delete e["/"]),e}function Pt(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var n="";if(t.name&&(n=t.name),t.toString){var i,r=t.toString();(i="["===r.charAt(0)?/\[\w+\s*(\w+)\]/.exec(r):/function\s*(\w+)/.exec(r))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return t&&t.constructor?Pt(t.constructor):""}function Rt(t,e,n,i){var r=/([^.]+)$/,a=r.exec(e)[0],o=r.exec(n)[0];function s(){return this[o]}i?Ct(t,a,s,(function(t){this[o]=t})):bt(t,a,s)}function Dt(t,e,n,i){for(var r in n)Rt(t,e+"."+r,n[r],i)}var Ot=/(%d)|(%s)/,Nt=/%s/;function Mt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+t;var r="string"==typeof t&&Ot.test(t);if(r)for(var a,o=ot(n);!(a=o()).done;){var s=a.value,c="number"==typeof s?Ot:Nt;if(c.test(t)){var l=""+s;t=t.replace(c,l)}else t+=" "+s}else for(var u,h=ot(n);!(u=h()).done;){var f=u.value;t+=" "+f}return t}function Lt(){for(var t=arguments.length-1,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n+1];return e}function Ft(t,e){for(;t;){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Object.getPrototypeOf(t)}return null}function Bt(t,e,n){var i=Ft(e,t);i&&Object.defineProperty(n,t,i)}function zt(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){O(5402,o);continue}for(var s in o)s in t||Bt(s,o,t)}}return t}function Ut(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){O(5403,o);continue}for(var s in o)Bt(s,o,t)}}return t}function kt(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function Gt(t){var e=t.prototype,n=e&&Object.getPrototypeOf(e);return n&&n.constructor}function Vt(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=Gt(t)))return!1;if(t===e)return!0}}return!1}function Ht(t){for(var e=0,n=Object.keys(t);e<n.length;e++)delete t[n[e]]}var Wt=It(!0),jt=It(!0);function Xt(t,e){return function(n,i){if(i.prototype.hasOwnProperty(t)&&delete e[i.prototype[t]],At(i.prototype,t,n),n){var r=e[n];r&&r!==i?T("A Class already exists with the same "+t+' : "'+n+'".'):e[n]=i}}}var qt=Xt("__cid__",Wt),Yt=Xt("__classname__",jt);function Kt(t,e){if(Yt(t,e),!e.prototype.hasOwnProperty(yt)){var n=t||gt.getNewId();n&&qt(n,e)}}function Qt(t,e){var n=jt[e],i=Wt[e],r=!0;if(n&&n!==t&&(T('"'+e+'" has already been set as name or alias of another class.'),r=!1),i&&i!==t&&(T('"'+e+'" has already been set as id or alias of another class.'),r=!1),r){var a=t[vt];a||(a=[],t[vt]=a),a.push(e),jt[e]=t,Wt[e]=t}}function Jt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++){var a=r[i],o=a.prototype,s=o.__cid__;s&&delete Wt[s];var c=o.__classname__;c&&delete jt[c];var l=o[vt];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete jt[h],delete Wt[h]}}}function Zt(t){return Wt[t]}function $t(t){return jt[t]}function te(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty(yt))return t.prototype.__cid__;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty(yt))return t.__cid__}return""}var ee=function(){var t=e.prototype;function e(t,e){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===e?t:e,i=void 0===e?null:t;this.count=0,this._pool=new Array(n),this._cleanup=i}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},t.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},e}(),ne=pt,ie={IDGenerator:mt,Pool:ee,array:pt,isNumber:St,isString:Tt,isEmptyObject:xt,getPropertyDescriptor:Ft,addon:zt,mixin:Ut,extend:kt,getSuper:Gt,isChildClassOf:Vt,clear:Ht,value:At,getset:Ct,get:bt,set:wt,unregisterClass:Jt,getClassName:Pt,setClassName:Kt,setClassAlias:Qt,getClassByName:$t,get _registeredClassNames(){return J({},jt)},set _registeredClassNames(t){Ht(jt),Object.assign(jt,t)},get _registeredClassIds(){return J({},Wt)},set _registeredClassIds(t){Ht(Wt),Object.assign(Wt,t)},_getClassId:te,_setClassId:qt,_getClassById:Zt,obsolete:Rt,obsoletes:Dt,formatStr:Mt,shiftArguments:Lt,createMap:It};function re(t){if("__bitmask__"in t)return t;At(t,"__bitmask__",null,!0);for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&At(t,o,r)}return t}function ae(t,e){e>=0&&t.length,t.length}function oe(t){return"__enums__"in t?t:(At(t,"__enums__",null,!0),oe.update(t))}function se(t){t.hasOwnProperty("__enums__")}function ce(t){se(t);var e=t.__enums__||[];for(var n in e.length=0,t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),t.__enums__=e,e}function le(t){"__enums__"in t||At(t,"__enums__",null,!0)}l.js=ie,t("js",Object.freeze({__proto__:null,array:ne,js:ie,IDGenerator:mt,Pool:ee,isNumber:St,isString:Tt,isEmptyObject:xt,value:At,getset:Ct,get:bt,set:wt,createMap:It,getClassName:Pt,obsolete:Rt,obsoletes:Dt,formatStr:Mt,shiftArguments:Lt,getPropertyDescriptor:Ft,addon:zt,mixin:Ut,extend:kt,getSuper:Gt,isChildClassOf:Vt,clear:Ht,_idToClass:Wt,_nameToClass:jt,_setClassId:qt,setClassName:Kt,setClassAlias:Qt,unregisterClass:Jt,_getClassById:Zt,getClassByName:$t,_getClassId:te})),re.isBitMask=function(t){return t&&t.hasOwnProperty("__bitmask__")},re.getList=function(t){if(t.__bitmask__)return t.__bitmask__;var e=t.__bitmask__=[];for(var n in t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),e},l.BitMask=re,oe.update=function(t){for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&At(t,o,r)}return Array.isArray(t.__enums__)&&ce(t),t},oe||(oe=t("Enum",{})),oe.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},oe.getList=function(t){return se(t),t.__enums__?t.__enums__:ce(t)},l.Enum=oe;var ue=t("ValueType",function(){function t(){}var e=t.prototype;return e.clone=function(){return O(100,Pt(this)+".clone"),this},e.equals=function(){return!1},e.set=function(){O(100,Pt(this)+".set")},e.toString=function(){return""},t}());Kt("cc.ValueType",ue),l.ValueType=ue;var he=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_ANTIALIAS_FXAA:!1,ENABLE_BLOOM:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144});l.macro=he;for(var fe=/^(?:cc|dragonBones|sp|ccsg)\..+/,_e=new Array(123),de=0;de<123;++de)_e[de]=64;for(var pe=0;pe<64;++pe)_e["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(pe)]=pe;var me=_e;function ge(t,e,n){function i(t,e,n,i){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[n]=r.get),r.set&&i&&(t[i]=r.set);else{var a=t[n];Ct(t,e,a,t[i])}}for(var r,a=t.prototype,o=0;o<e.length;o++){var s=(r=e[o])[0].toUpperCase()+r.slice(1);i(a,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(a,r,c[0],c[1])}}function ve(t,e,n,i){var r=t[e];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):t[e]=i?[n,r]:[r,n]:t[e]=n}function ye(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var n=e.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1}function Se(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function Te(t,e,n){t&&setTimeout((function(){t(e,n)}),0)}function xe(t){return!(!t||t.constructor!==Object)&&xt(t)}function Ee(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t<n?t:n}function Ae(t){return t*he.RAD}function Ce(t){return t*he.DEG}l.misc={BUILTIN_CLASSID_RE:fe,BASE64_VALUES:me,propertyDefine:ge,pushToMap:ve,contains:ye,isDomNode:Se,callInNextTick:Te,isPlainEmptyObj_DEV:xe,clampf:Ee,degreesToRadians:Ae,radiansToDegrees:Ce},t("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:fe,BASE64_VALUES:me,propertyDefine:ge,pushToMap:ve,contains:ye,isDomNode:Se,callInNextTick:Te,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:xe,clampf:Ee,degreesToRadians:Ae,radiansToDegrees:Ce}));var be="$_$";function we(t,e){var n=e?Object.create(e):{};return At(t,"__attrs__",n),n}function Ie(t){if("function"!=typeof t)return we(t,Re(t.constructor));for(var e,n=l.Class.getInheritanceChain(t),i=n.length-1;i>=0;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||we(r,(e=n[i+1])&&e.__attrs__)}return we(t,(e=n[0])&&e.__attrs__),t.__attrs__}function Pe(t,e){var n=Re(t),i=e+be,r={};for(var a in n)a.startsWith(i)&&(r[a.slice(i.length)]=n[a]);return r}function Re(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||Ie(t)}function De(t,e,n,i){Re(t)[e+be+n]=i}var Oe=function(){function t(t,e){this.name=void 0,this.default=void 0,this.name=t,this.default=e}return t.prototype.toString=function(){return this.name},t}(),Ne=t("CCInteger",new Oe("Integer",0));l.Integer=Ne,l.CCInteger=Ne;var Me=t("CCFloat",new Oe("Float",0));l.Float=Me,l.CCFloat=Me;var Le=t("CCBoolean",new Oe("Boolean",!1));l.Boolean=Le,l.CCBoolean=Le;var Fe=t("CCString",new Oe("String",""));function Be(t,e){return function(n,i){var r='"'+Pt(n)+"."+i+'"',a=Pe(n,i),o=a.type;if(o===Ne||o===Me?o="Number":o!==Fe&&o!==Le||(o=""+o),o===t){if(a.hasOwnProperty("default")){var s=a.default;if(void 0!==s&&!Array.isArray(s)&&!xe(s)){var c=typeof s,l=t.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof a.ctor)return;R(3605,r,Pt(a.ctor))}else"Number"!==t&&R(3606,e,r,t);else{if("function"===c)return;t===Fe.default&&null==s?R(3607,r):R(3611,e,r,c)}delete a.type}}}else R(3604,r)}}l.String=Fe,l.CCString=Fe;var ze=Object.freeze({__proto__:null,DELIMETER:be,createAttrsSingle:we,createAttrs:Ie,attr:Pe,getClassAttrs:Re,setClassAttr:De,PrimitiveType:Oe,CCInteger:Ne,CCFloat:Me,CCBoolean:Le,CCString:Fe,getTypeChecker_ET:Be,getObjTypeChecker_ET:function(t){return function(e,n){Be("Object","type")(e,n);var i=Re(e)[n+be+"default"],r=l.Class.getDefault(i);if(!Array.isArray(r)&&Vt(t,l.ValueType)){var a=Pt(t),o=Mt('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Pt(e),n,a);i?y(o):R(3612,o,a,Pt(e),n,a)}}}}),Ue={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function ke(t,e,n,i){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,n.call(this,e)};var a={};for(var o in i[r]=a,Ue){var s=Ue[o];t.hasOwnProperty(o)&&(a[o]=t[o],s.canUsedInGet||delete t[o])}}}function Ge(t,e,n,i){if(Array.isArray(e)){if(!(e.length>0))return O(5508,n,i);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=l.String:e===Boolean?t.type=l.Boolean:e===Number&&(t.type=l.Float))}function Ve(t,e,n){var i=t?{_short:!0}:{_short:!0,default:e};return n&&(i.type=n),i}function He(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return Ve(e,[],t);if("function"==typeof t){var n=t;return Ve(e,Vt(n,l.ValueType)?new n:null,n)}return Ve(e,t instanceof Oe?t.default:t)}return null}var We,je=[];function Xe(){return je[je.length-1]}l._RF={push:function(t,e,n,i){void 0===n&&(n=e,e=""),je.push({uuid:e,script:n,module:t,exports:t.exports,beh:null,importMeta:i})},pop:function(){var t=je.pop(),e=t.module,n=e.exports;if(n===t.exports){for(var i in n)return;e.exports=n=t.cls}},peek:Xe},function(t){t[t.STANDALONE=1]="STANDALONE",t[t.IMPLICIT_VISIBLE=2]="IMPLICIT_VISIBLE",t[t.IMPLICIT_SERIALIZABLE=4]="IMPLICIT_SERIALIZABLE"}(We||(We={}));var qe=be,Ye={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var n=t[e],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var a=Pt(i);r?$e(i,a,r,i.$super,n.mixins):O(3633,a)}this.datas=null}}};function Ke(t,e,n,i){!function(t,e){!function(t,e){t.indexOf(e)<0&&t.push(e)}(t.__props__,e)}(t,n),rn(t,i,e,n)}function Qe(t,e,n,i){var r=i.get;i.set,r&&(rn(t,i,e,n),De(t,n,"serializable",!1))}function Je(t){return"function"==typeof t?t():t}function Ze(t,e,n){for(var i in e)t.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(t,i,Ft(e,i))}function $e(t,e,n,i,r){if(t.__props__=[],i&&i.__props__&&(t.__props__=i.__props__.slice()),r)for(var a=0;a<r.length;++a){var o=r[a];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(n)for(var s in function(t,e){for(var n in t){var i=t[n],r=He(i,!1);if(r&&(i=t[n]=r),i){var a=i.notify;a&&ke(i,n,a,t),"type"in i&&Ge(i,i.type,e,n)}}}(n,e),n){var c=n[s];c.get||c.set?Qe(t,e,s,c):Ke(t,e,s,c)}var l=Re(t);t.__values__=t.__props__.filter((function(t){return!1!==l[t+qe+"serializable"]}))}function tn(t){var e=t.name,n=t.extends,i=t.mixins,r=function(t,e,n,i){var r=l.Component,a=Xe();if(a&&Vt(e,r)){if(Vt(a.cls,r))return O(3615),null;t=t||a.script}var o=function(t,e,n,i){var r=i.ctor,a=[r],o=r;At(o,"__ctors__",a.length>0?a:null,!0);var s=o.prototype;if(e&&(o.$super=e),n){for(var c=n.length-1;c>=0;c--){var l=n[c];Ze(s,l.prototype),tn._isCCClass(l)&&Ze(Re(o),Re(l))}s.constructor=o}return Kt(t,o),o}(t,e,n,i);if(a)if(Vt(e,r)){var s=a.uuid;s&&qt(s,o),a.cls=o}else Vt(a.cls,r)||(a.cls=o);return o}(e,n,i,t);e||(e=l.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1);var a=t.properties;"function"==typeof a||n&&null===n.__props__||i&&i.some((function(t){return null===t.__props__}))?(Ye.push({cls:r,props:a,mixins:i}),r.__props__=r.__values__=null):$e(r,e,a,n,t.mixins);var o=t.editor;return o&&Vt(n,l.Component)&&l.Component._registerEditorProps(r,o),r}function en(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__values__")}tn._isCCClass=function(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__ctors__")},tn.fastDefine=function(t,e,n){Kt(t,e);for(var i=e.__props__=e.__values__=Object.keys(n),r=Re(e),a=0;a<i.length;a++){var o=i[a];r[o+qe+"visible"]=!1,r[o+qe+"default"]=n[o]}},tn.Attr=ze,tn.attr=Pe,tn.getInheritanceChain=function(t){for(var e=[];t=Gt(t);)t!==Object&&e.push(t);return e};var nn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function rn(t,e,n,i){var r=null,a="";function o(){return a=i+qe,r=Re(t)}"type"in e&&void 0===e.type&&R(3660,i,n);var s=e.type;s&&(nn[s]?(r||o())[a+"type"]=s:"Object"===s||("object"==typeof s?oe.isEnum(s)?((r||o())[a+"type"]="Enum",r[a+"enumList"]=oe.getList(s)):re.isBitMask(s)&&((r||o())[a+"type"]="BitMask",r[a+"bitmaskList"]=re.getList(s)):"function"==typeof s&&((r||o())[a+"type"]="Object",r[a+"ctor"]=s))),"default"in e&&((r||o())[a+"default"]=e.default);var c,l=function(t,n){if(t in e){var i=e[t];typeof i===n&&((r||o())[a+t]=i)}};e.editorOnly&&((r||o())[a+"editorOnly"]=!0),e.__internalFlags&We.STANDALONE?c=!0===e.serializable||0!=(e.__internalFlags&We.IMPLICIT_SERIALIZABLE):!1===e.serializable&&(c=!1),void 0!==c&&((r||o())[a+"serializable"]=c),l("formerlySerializedAs","string");var u=e.range;u&&Array.isArray(u)&&u.length>=2&&((r||o())[a+"min"]=u[0],r[a+"max"]=u[1],u.length>2&&(r[a+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}tn.isArray=function(t){return t=Je(t),Array.isArray(t)},tn.getDefault=Je,tn.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},tn.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,tn.getNewValueTypeCode=function(t){for(var e=Pt(t),n=t.constructor,i="new "+e+"(",r=0;r<n.__props__.length;r++)i+=t[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},l.Class=tn;var an=Math.PI/180,on=180/Math.PI,sn=t("EPSILON",1e-6);function cn(t,e){return Math.abs(t-e)<=sn*Math.max(1,Math.abs(t),Math.abs(e))}function ln(t,e,n){return n=n||sn,Math.abs(t-e)<=n}function un(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t>n?n:t}function hn(t){return t<0?0:t>1?1:t}function fn(t,e,n){return t+(e-t)*n}function _n(t){return t*an}function dn(t){return t*on}var pn=t("random",Math.random);function mn(t,e){return Math.random()*(e-t)+t}function gn(t,e){return Math.floor(mn(t,e))}function vn(t){return(t=(9301*t+49297)%233280)/233280}function yn(t,e,n){return vn(t)*(n-e)+e}function Sn(t,e,n){return Math.floor(yn(t,e,n))}function Tn(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function xn(t,e){return t-Math.floor(t/e)*e}function En(t,e){return t=xn(t,2*e),e-Math.abs(t-e)}function An(t,e,n){return(n-t)/(e-t)}function Cn(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function bn(t,e){return Math.abs(t)>Math.abs(e)?t:e}function wn(t,e){e.forEach((function(e){Object.defineProperty(t,e,{enumerable:!0})}))}var In=1/255,Pn=t("Color",function(t){function e(e,n,i,r){var a;return(a=t.call(this)||this)._val=0,"string"==typeof e?a.fromHEX(e):void 0!==n?a.set(e,n,i,r):a.set(e),a}Z(e,t),e.clone=function(t){var n=new e;return t._val?n._val=t._val:n._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,n},e.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.set=function(t,e,n,i,r){return t.r=e,t.g=n,t.b=i,t.a=r,t},e.fromHEX=function(t,e){e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0;var n=parseInt(e.substr(6,2),16);return t.a=Number.isNaN(n)?255:n,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},e.add=function(t,e,n){return t.r=e.r+n.r,t.g=e.g+n.g,t.b=e.b+n.b,t.a=e.a+n.a,t},e.subtract=function(t,e,n){return t.r=e.r-n.r,t.g=e.g-n.g,t.b=e.b-n.b,t.a=e.a-n.a,t},e.multiply=function(t,e,n){return t.r=e.r*n.r,t.g=e.g*n.g,t.b=e.b*n.b,t.a=e.a*n.a,t},e.divide=function(t,e,n){return t.r=e.r/n.r,t.g=e.g/n.g,t.b=e.b/n.b,t.a=e.a/n.a,t},e.scale=function(t,e,n){return t.r=e.r*n,t.g=e.g*n,t.b=e.b*n,t.a=e.a*n,t},e.lerp=function(t,e,n,i){var r=e.r,a=e.g,o=e.b,s=e.a;return r+=(n.r-r)*i,a+=(n.g-a)*i,o+=(n.b-o)*i,s+=(n.a-s)*i,t._val=Math.floor((s<<24>>>0)+(o<<16)+(a<<8)+r),t},e.toArray=function(t,n,i){void 0===i&&(i=0);var r=n instanceof e||n.a>1?1/255:1;return t[i+0]=n.r*r,t[i+1]=n.g*r,t[i+2]=n.b*r,t[i+3]=n.a*r,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),e.r=255*t[n+0],e.g=255*t[n+1],e.b=255*t[n+2],e.a=255*t[n+3],e},e.strictEquals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.r-e.r)<=n*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=n*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=n*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=n*Math.max(1,Math.abs(t.a),Math.abs(e.a))},e.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0};var n=e.prototype;return n.clone=function(){var t=new e;return t._val=this._val,t},n.equals=function(t){return t&&this._val===t._val},n.lerp=function(t,e){var n=this.r,i=this.g,r=this.b,a=this.a;return n+=(t.r-n)*e,i+=(t.g-i)*e,r+=(t.b-r)*e,a+=(t.a-a)*e,this._val=Math.floor((a<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*In).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},n.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16);return r=Number.isNaN(r)?255:r,this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|e),this},n.toHEX=function(t){void 0===t&&(t="#rrggbb");var e="0",n=[(this.r<16?e:"")+this.r.toString(16),(this.g<16?e:"")+this.g.toString(16),(this.b<16?e:"")+this.b.toString(16)];return"#rgb"===t?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===t&&n.push((this.a<16?e:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(t,e,n){var i=0,r=0,a=0;if(0===e)i=r=a=n;else if(0===n)i=r=a=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),s=t-o,c=n*(1-e),l=n*(1-e*s),u=n*(1-e*(1-s));switch(o){case 0:i=n,r=u,a=c;break;case 1:i=l,r=n,a=c;break;case 2:i=c,r=n,a=u;break;case 3:i=c,r=l,a=n;break;case 4:i=u,r=c,a=n;break;case 5:i=n,r=c,a=l}}return i*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var t=this.r*In,e=this.g*In,n=this.b*In,i={h:0,s:0,v:0},r=Math.max(t,e,n),a=Math.min(t,e,n),o=0;return i.v=r,i.s=r?(r-a)/r:0,i.s?(o=r-a,i.h=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(t,e,n,i){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,n=t.b||0,i="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)),this},n.multiply=function(t){var e=(255&this._val)*t.r>>8,n=(65280&this._val)*t.g>>8,i=(16711680&this._val)*t.b>>8,r=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&r|16711680&i|65280&n|255&e,this},n._set_r_unsafe=function(t){return this._val=(4294967040&this._val|t)>>>0,this},n._set_g_unsafe=function(t){return this._val=(4294902015&this._val|t<<8)>>>0,this},n._set_b_unsafe=function(t){return this._val=(4278255615&this._val|t<<16)>>>0,this},n._set_a_unsafe=function(t){return this._val=(16777215&this._val|t<<24)>>>0,this},Q(e,[{key:"r",get:function(){return 255&this._val},set:function(t){t=~~un(t,0,255),this._val=(4294967040&this._val|t)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(t){t=~~un(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(t){t=~~un(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(t){t=~~un(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}},{key:"x",get:function(){return this.r*In},set:function(t){this.r=255*t}},{key:"y",get:function(){return this.g*In},set:function(t){this.g=255*t}},{key:"z",get:function(){return this.b*In},set:function(t){this.b=255*t}},{key:"w",get:function(){return this.a*In},set:function(t){this.a=255*t}}]),e}(ue));function Rn(t,e,n,i){return new Pn(t,e,n,i)}Pn.WHITE=Object.freeze(new Pn(255,255,255,255)),Pn.GRAY=Object.freeze(new Pn(127,127,127,255)),Pn.BLACK=Object.freeze(new Pn(0,0,0,255)),Pn.TRANSPARENT=Object.freeze(new Pn(0,0,0,0)),Pn.RED=Object.freeze(new Pn(255,0,0,255)),Pn.GREEN=Object.freeze(new Pn(0,255,0,255)),Pn.BLUE=Object.freeze(new Pn(0,0,255,255)),Pn.CYAN=Object.freeze(new Pn(0,255,255,255)),Pn.MAGENTA=Object.freeze(new Pn(255,0,255,255)),Pn.YELLOW=Object.freeze(new Pn(255,255,0,255)),tn.fastDefine("cc.Color",Pn,{r:0,g:0,b:0,a:255}),l.Color=Pn,l.color=Rn;var Dn=t("Vec3",function(t){function e(e,n,i){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.x=e.x,r.y=e.y,r.z=e.z):(r.x=e||0,r.y=n||0,r.z=i||0),r}Z(e,t),e.zero=function(t){return t.x=0,t.y=0,t.z=0,t},e.clone=function(t){return new e(t.x,t.y,t.z)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.set=function(t,e,n,i){return t.x=e,t.y=n,t.z=i,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.sqrt(n*n+i*i+r*r)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r},e.len=function(t){var e=t.x,n=t.y,i=t.z;return Math.sqrt(e*e+n*n+i*i)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z;return e*e+n*n+i*i},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.invert=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},e.invertSafe=function(t,e){var n=e.x,i=e.y,r=e.z;return Math.abs(n)<sn?t.x=0:t.x=1/n,Math.abs(i)<sn?t.y=0:t.y=1/i,Math.abs(r)<sn?t.z=0:t.z=1/r,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),t.x=n*a,t.y=i*a,t.z=r*a),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.cross=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z;return t.x=r*c-a*s,t.y=a*o-i*c,t.z=i*s-r*o,t},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t},e.random=function(t,e){e=e||1;var n=2*pn()*Math.PI,i=2*pn()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a+n.m15;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a+n.m12)*o,t.y=(n.m01*i+n.m05*r+n.m09*a+n.m13)*o,t.z=(n.m02*i+n.m06*r+n.m10*a+n.m14)*o,t},e.transformMat4Normal=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a)*o,t.y=(n.m01*i+n.m05*r+n.m09*a)*o,t.z=(n.m02*i+n.m06*r+n.m10*a)*o,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=i*n.m00+r*n.m03+a*n.m06,t.y=i*n.m01+r*n.m04+a*n.m07,t.z=i*n.m02+r*n.m05+a*n.m08,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14,t},e.transformQuat=function(t,e,n){var i=n.w*e.x+n.y*e.z-n.z*e.y,r=n.w*e.y+n.z*e.x-n.x*e.z,a=n.w*e.z+n.x*e.y-n.y*e.x,o=-n.x*e.x-n.y*e.y-n.z*e.z;return t.x=i*n.w+o*-n.x+r*-n.z-a*-n.y,t.y=r*n.w+o*-n.y+a*-n.x-i*-n.z,t.z=a*n.w+o*-n.z+i*-n.y-r*-n.x,t},e.transformRTS=function(t,e,n,i,r){var a=e.x*r.x,o=e.y*r.y,s=e.z*r.z,c=n.w*a+n.y*s-n.z*o,l=n.w*o+n.z*a-n.x*s,u=n.w*s+n.x*o-n.y*a,h=-n.x*a-n.y*o-n.z*s;return t.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,t.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,t.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,t},e.transformInverseRTS=function(t,e,n,i,r){var a=e.x-i.x,o=e.y-i.y,s=e.z-i.z,c=n.w*a-n.y*s+n.z*o,l=n.w*o-n.z*a+n.x*s,u=n.w*s-n.x*o+n.y*a,h=n.x*a+n.y*o+n.z*s;return t.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,t.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,t.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,t},e.rotateX=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=a*s-o*c,h=a*c+o*s;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.rotateY=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o*c+r*s,u=a,h=o*s-r*c;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.rotateZ=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-a*c,u=r*c+a*s,h=o;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},e.equals=function(t,e,n){void 0===n&&(n=sn);var i=t.x,r=t.y,a=t.z,o=e.x,s=e.y,c=e.z;return Math.abs(i-o)<=n*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=n*Math.max(1,Math.abs(a),Math.abs(c))},e.angle=function(t,n){e.normalize(On,t),e.normalize(Nn,n);var i=e.dot(On,Nn);return i>1?0:i<-1?Math.PI:Math.acos(i)},e.projectOnPlane=function(t,n,i){return e.subtract(t,n,e.project(t,n,i))},e.project=function(t,n,i){var r=e.lengthSqr(i);return r<1e-6?e.set(t,0,0,0):e.multiplyScalar(t,i,e.dot(n,i)/r)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z)},n.set=function(t,e,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=n||0),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))},n.equals3f=function(t,e,n,i){return void 0===i&&(i=sn),Math.abs(this.x-t)<=i*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=i*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},n.strictEquals3f=function(t,e,n){return this.x===t&&this.y===e&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add3f=function(t,e,n){return this.x+=t,this.y+=e,this.z+=n,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.subtract3f=function(t,e,n){return this.x-=t,this.y-=e,this.z-=n,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.multiply3f=function(t,e,n){return this.x*=t,this.y*=e,this.z*=n,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},n.divide3f=function(t,e,n){return this.x/=t,this.y/=e,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this.z=un(this.z,t.z,e.z),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=t*t+e*e+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i,this.z=n*i),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=t.m03*e+t.m07*n+t.m11*i+t.m15;return r=r?1/r:1,this.x=(t.m00*e+t.m04*n+t.m08*i+t.m12)*r,this.y=(t.m01*e+t.m05*n+t.m09*i+t.m13)*r,this.z=(t.m02*e+t.m06*n+t.m10*i+t.m14)*r,this},e}(ue));Dn.UNIT_X=Object.freeze(new Dn(1,0,0)),Dn.UNIT_Y=Object.freeze(new Dn(0,1,0)),Dn.UNIT_Z=Object.freeze(new Dn(0,0,1)),Dn.RIGHT=Object.freeze(new Dn(1,0,0)),Dn.UP=Object.freeze(new Dn(0,1,0)),Dn.FORWARD=Object.freeze(new Dn(0,0,-1)),Dn.ZERO=Object.freeze(new Dn(0,0,0)),Dn.ONE=Object.freeze(new Dn(1,1,1)),Dn.NEG_ONE=Object.freeze(new Dn(-1,-1,-1));var On=new Dn,Nn=new Dn;function Mn(t,e,n){return new Dn(t,e,n)}tn.fastDefine("cc.Vec3",Dn,{x:0,y:0,z:0}),l.Vec3=Dn,l.v3=Mn;var Ln=t("Mat3",function(t){function e(e,n,i,r,a,o,s,c,l){var u;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=t.call(this)||this,"object"==typeof e?(u.m00=e.m00,u.m01=e.m01,u.m02=e.m02,u.m03=e.m03,u.m04=e.m04,u.m05=e.m05,u.m06=e.m06,u.m07=e.m07,u.m08=e.m08):(u.m00=e,u.m01=n,u.m02=i,u.m03=r,u.m04=a,u.m05=o,u.m06=s,u.m07=c,u.m08=l),u}Z(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.set=function(t,e,n,i,r,a,o,s,c,l){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=n,t.m05=e.m07,t.m06=i,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=u*o-s*l,f=-u*a+s*c,_=l*a-o*c,d=n*h+i*f+r*_;return 0===d?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(d=1/d,t.m00=h*d,t.m01=(-u*i+r*l)*d,t.m02=(s*i-r*o)*d,t.m03=f*d,t.m04=(u*n-r*c)*d,t.m05=(-s*n+r*a)*d,t.m06=_*d,t.m07=(-l*n+i*c)*d,t.m08=(o*n-i*a)*d,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08;return e*(l*a-o*c)+n*(-l*r+o*s)+i*(c*r-a*s)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.m00,_=n.m01,d=n.m02,p=n.m03,m=n.m04,g=n.m05,v=n.m06,y=n.m07,S=n.m08;return t.m00=f*i+_*o+d*l,t.m01=f*r+_*s+d*u,t.m02=f*a+_*c+d*h,t.m03=p*i+m*o+g*l,t.m04=p*r+m*s+g*u,t.m05=p*a+m*c+g*h,t.m06=v*i+y*o+S*l,t.m07=v*r+y*s+S*u,t.m08=v*a+y*c+S*h,t},e.multiplyMat4=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.m00,_=n.m01,d=n.m02,p=n.m04,m=n.m05,g=n.m06,v=n.m08,y=n.m09,S=n.m10;return t.m00=f*i+_*o+d*l,t.m01=f*r+_*s+d*u,t.m02=f*a+_*c+d*h,t.m03=p*i+m*o+g*l,t.m04=p*r+m*s+g*u,t.m05=p*a+m*c+g*h,t.m06=v*i+y*o+S*l,t.m07=v*r+y*s+S*u,t.m08=v*a+y*c+S*h,t},e.transform=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.x,_=n.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=o,t.m04=s,t.m05=c,t.m06=f*i+_*o+l,t.m07=f*r+_*s+u,t.m08=f*a+_*c+h,t},e.scale=function(t,e,n){var i=n.x,r=n.y;return t.m00=i*e.m00,t.m01=i*e.m01,t.m02=i*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.rotate=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=Math.sin(n),_=Math.cos(n);return t.m00=_*i+f*o,t.m01=_*r+f*s,t.m02=_*a+f*c,t.m03=_*o-f*i,t.m04=_*s-f*r,t.m05=_*c-f*a,t.m06=l,t.m07=u,t.m08=h,t},e.fromMat4=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t},e.fromViewUp=function(t,n,i){return Dn.lengthSqr(n)<sn*sn?(e.identity(t),t):(i=i||Dn.UNIT_Y,Dn.normalize(Fn,Dn.cross(Fn,i,n)),Dn.lengthSqr(Fn)<sn*sn?(e.identity(t),t):(Dn.cross(Bn,n,Fn),e.set(t,Fn.x,Fn.y,Fn.z,Bn.x,Bn.y,Bn.z,n.x,n.y,n.z),t))},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=-n,t.m04=i,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,u=i*o,h=i*s,f=r*o,_=r*s,d=r*c,p=a*o,m=a*s,g=a*c;return t.m00=1-h-d,t.m03=u-g,t.m06=f+m,t.m01=u+g,t.m04=1-l-d,t.m07=_-p,t.m02=f-m,t.m05=_+p,t.m08=1-l-h,t},e.inverseTransposeMat4=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,d=e.m12,p=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,S=n*l-a*o,T=i*c-r*s,x=i*l-a*s,E=r*l-a*c,A=u*p-h*d,C=u*m-f*d,b=u*g-_*d,w=h*m-f*p,I=h*g-_*p,P=f*g-_*m,R=v*P-y*I+S*w+T*b-x*C+E*A;return R?(R=1/R,t.m00=(s*P-c*I+l*w)*R,t.m01=(c*b-o*P-l*C)*R,t.m02=(o*I-s*b+l*A)*R,t.m03=(r*I-i*P-a*w)*R,t.m04=(n*P-r*b+a*C)*R,t.m05=(i*b-n*I-a*A)*R,t.m06=(p*E-m*x+g*T)*R,t.m07=(m*S-d*E-g*y)*R,t.m08=(d*x-p*S+g*v)*R,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=n.m00*i+e.m00,t.m01=n.m01*i+e.m01,t.m02=n.m02*i+e.m02,t.m03=n.m03*i+e.m03,t.m04=n.m04*i+e.m04,t.m05=n.m05*i+e.m05,t.m06=n.m06*i+e.m06,t.m07=n.m07*i+e.m07,t.m08=n.m08*i+e.m08,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))};var n=e.prototype;return n.clone=function(){var t=this;return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},n.set=function(t,e,n,i,r,a,o,s,c){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+",\n"+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+",\n"+t.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=n,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=c*r-a*s,u=-c*i+a*o,h=s*i-r*o,f=t*l+e*u+n*h;return 0===f?(this.set(0,0,0,0,0,0,0,0,0),this):(f=1/f,this.m00=l*f,this.m01=(-c*e+n*s)*f,this.m02=(a*e-n*r)*f,this.m03=u*f,this.m04=(c*t-n*o)*f,this.m05=(-a*t+n*i)*f,this.m06=h*f,this.m07=(-s*t+e*o)*f,this.m08=(r*t-e*i)*f,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08;return t*(c*r-a*s)+e*(-c*i+a*o)+n*(s*i-r*o)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=t.m00,h=t.m01,f=t.m02,_=t.m03,d=t.m04,p=t.m05,m=t.m06,g=t.m07,v=t.m08;return this.m00=u*e+h*r+f*s,this.m01=u*n+h*a+f*c,this.m02=u*i+h*o+f*l,this.m03=_*e+d*r+p*s,this.m04=_*n+d*a+p*c,this.m05=_*i+d*o+p*l,this.m06=m*e+g*r+v*s,this.m07=m*n+g*a+v*c,this.m08=m*i+g*o+v*l,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this},n.scale=function(t){var e=t.x,n=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(t),h=Math.cos(t);return this.m00=h*e+u*r,this.m01=h*n+u*a,this.m02=h*i+u*o,this.m03=h*r-u*e,this.m04=h*a-u*n,this.m05=h*o-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,u=n*o,h=i*a,f=i*o,_=i*s,d=r*a,p=r*o,m=r*s;return this.m00=1-u-_,this.m03=l-m,this.m06=h+p,this.m01=l+m,this.m04=1-c-_,this.m07=f-d,this.m02=h-p,this.m05=f+d,this.m08=1-c-u,this},e}(ue));Ln.IDENTITY=Object.freeze(new Ln);var Fn=new Dn,Bn=new Dn;tn.fastDefine("cc.Mat3",Ln,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),l.Mat3=Ln;var zn=t("Quat",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=null!=r?r:1),a}Z(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},e.rotationTo=function(t,n,i){var r=Dn.dot(n,i);return r<-.999999?(Dn.cross(Gn,Dn.UNIT_X,n),Gn.length()<1e-6&&Dn.cross(Gn,Dn.UNIT_Y,n),Dn.normalize(Gn,Gn),e.fromAxisAngle(t,Gn,Math.PI),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Dn.cross(Gn,n,i),t.x=Gn.x,t.y=Gn.y,t.z=Gn.z,t.w=1+r,e.normalize(t,t))},e.getAxisAngle=function(t,e){var n=2*Math.acos(e.w),i=Math.sin(n/2);return 0!==i?(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i):(t.x=1,t.y=0,t.z=0),n},e.multiply=function(t,e,n){var i=e.x*n.w+e.w*n.x+e.y*n.z-e.z*n.y,r=e.y*n.w+e.w*n.y+e.z*n.x-e.x*n.z,a=e.z*n.w+e.w*n.z+e.x*n.y-e.y*n.x,o=e.w*n.w-e.x*n.x-e.y*n.y-e.z*n.z;return t.x=i,t.y=r,t.z=a,t.w=o,t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.rotateX=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+c*i,t.y=o*r+s*i,t.z=s*r-o*i,t.w=c*r-a*i,t},e.rotateY=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r-s*i,t.y=o*r+c*i,t.z=s*r+a*i,t.w=c*r-o*i,t},e.rotateZ=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+o*i,t.y=o*r-a*i,t.z=s*r+c*i,t.w=c*r-s*i,t},e.rotateAround=function(t,n,i,r){return e.invert(Un,n),Dn.transformQuat(Gn,i,Un),e.fromAxisAngle(Un,Gn,r),e.multiply(t,n,Un),t},e.rotateAroundLocal=function(t,n,i,r){return e.fromAxisAngle(Un,i,r),e.multiply(t,n,Un),t},e.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.slerp=function(t,e,n,i){var r=0,a=0,o=n.x,s=n.y,c=n.z,l=n.w,u=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(u<0&&(u=-u,o=-o,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),f=Math.sin(h);r=Math.sin((1-i)*h)/f,a=Math.sin(i*h)/f}else r=1-i,a=i;return t.x=r*e.x+a*o,t.y=r*e.y+a*s,t.z=r*e.z+a*c,t.w=r*e.w+a*l,t},e.sqlerp=function(t,n,i,r,a,o){return e.slerp(Un,n,a,o),e.slerp(kn,i,r,o),e.slerp(t,Un,kn,2*o*(1-o)),t},e.invert=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=n?1/n:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t},e.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},e.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},e.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},e.normalize=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return n>0&&(n=1/Math.sqrt(n),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n),t},e.fromAxes=function(t,n,i,r){return Ln.set(Vn,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),e.normalize(t,e.fromMat3(t,Vn))},e.fromViewUp=function(t,n,i){return Ln.fromViewUp(Vn,n,i),e.normalize(t,e.fromMat3(t,Vn))},e.fromAxisAngle=function(t,e,n){n*=.5;var i=Math.sin(n);return t.x=i*e.x,t.y=i*e.y,t.z=i*e.z,t.w=Math.cos(n),t},e.fromMat3=function(t,e){var n=e.m00,i=e.m03,r=e.m06,a=e.m01,o=e.m04,s=e.m07,c=e.m02,l=e.m05,u=e.m08,h=n+o+u;if(h>0){var f=.5/Math.sqrt(h+1);t.w=.25/f,t.x=(l-s)*f,t.y=(r-c)*f,t.z=(a-i)*f}else if(n>o&&n>u){var _=2*Math.sqrt(1+n-o-u);t.w=(l-s)/_,t.x=.25*_,t.y=(i+a)/_,t.z=(r+c)/_}else if(o>u){var d=2*Math.sqrt(1+o-n-u);t.w=(r-c)/d,t.x=(i+a)/d,t.y=.25*d,t.z=(s+l)/d}else{var p=2*Math.sqrt(1+u-n-o);t.w=(a-i)/p,t.x=(r+c)/p,t.y=(s+l)/p,t.z=.25*p}return t},e.fromEuler=function(t,e,n,i){e*=Hn,n*=Hn,i*=Hn;var r=Math.sin(e),a=Math.cos(e),o=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return t.x=r*s*l+a*o*c,t.y=a*o*l+r*s*c,t.z=a*s*c-r*o*l,t.w=a*s*l-r*o*c,t},e.fromAngleZ=function(t,e){return e*=Hn,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},e.toAxisX=function(t,e){var n=2*e.y,i=2*e.z;return t.x=1-n*e.y-i*e.z,t.y=n*e.x+i*e.w,t.z=i*e.x+n*e.w,t},e.toAxisY=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=i*e.x-r*e.w,t.y=1-n*e.x-r*e.z,t.z=r*e.y+n*e.w,t},e.toAxisZ=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=r*e.x-i*e.w,t.y=r*e.y-n*e.w,t.z=1-n*e.x-i*e.y,t},e.toEuler=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=0,c=0,l=0,u=i*r+a*o;if(u>.499999)s=0,c=dn(2*Math.atan2(i,o)),l=90;else if(u<-.499999)s=0,c=-dn(2*Math.atan2(i,o)),l=-90;else{var h=i*i,f=r*r,_=a*a;s=dn(Math.atan2(2*i*o-2*r*a,1-2*h-2*_)),c=dn(Math.atan2(2*r*o-2*i*a,1-2*f-2*_)),l=dn(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return t.x=s,t.y=c,t.z=l,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.getEulerAngles=function(t){return e.toEuler(t,this)},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this},n.slerp=function(t,n){return e.slerp(this,this,t,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(ue));zn.IDENTITY=Object.freeze(new zn);var Un=new zn,kn=new zn,Gn=new Dn,Vn=new Ln,Hn=.5*Math.PI/180;function Wn(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),new zn(t,e,n,i)}tn.fastDefine("cc.Quat",zn,{x:0,y:0,z:0,w:1}),l.Quat=zn,l.quat=Wn;var jn=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Xn=t("Mat4",function(t){function e(e,n,i,r,a,o,s,c,l,u,h,f,_,d,p,m){var g;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===f&&(f=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),(g=t.call(this)||this).m00=void 0,g.m01=void 0,g.m02=void 0,g.m03=void 0,g.m04=void 0,g.m05=void 0,g.m06=void 0,g.m07=void 0,g.m08=void 0,g.m09=void 0,g.m10=void 0,g.m11=void 0,g.m12=void 0,g.m13=void 0,g.m14=void 0,g.m15=void 0,"object"==typeof e?(g.m00=e.m00,g.m01=e.m01,g.m02=e.m02,g.m03=e.m03,g.m04=e.m04,g.m05=e.m05,g.m06=e.m06,g.m07=e.m07,g.m08=e.m08,g.m09=e.m09,g.m10=e.m10,g.m11=e.m11,g.m12=e.m12,g.m13=e.m13,g.m14=e.m14,g.m15=e.m15):(g.m00=e,g.m01=n,g.m02=i,g.m03=r,g.m04=a,g.m05=o,g.m06=s,g.m07=c,g.m08=l,g.m09=u,g.m10=h,g.m11=f,g.m12=_,g.m13=d,g.m14=p,g.m15=m),g}Z(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p,m){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t.m09=u,t.m10=h,t.m11=f,t.m12=_,t.m13=d,t.m14=p,t.m15=m,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m03,a=e.m06,o=e.m07,s=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=n,t.m06=e.m09,t.m07=e.m13,t.m08=i,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=o,t.m14=s}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,d=e.m12,p=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,S=n*l-a*o,T=i*c-r*s,x=i*l-a*s,E=r*l-a*c,A=u*p-h*d,C=u*m-f*d,b=u*g-_*d,w=h*m-f*p,I=h*g-_*p,P=f*g-_*m,R=v*P-y*I+S*w+T*b-x*C+E*A;return 0===R?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(R=1/R,t.m00=(s*P-c*I+l*w)*R,t.m01=(r*I-i*P-a*w)*R,t.m02=(p*E-m*x+g*T)*R,t.m03=(f*x-h*E-_*T)*R,t.m04=(c*b-o*P-l*C)*R,t.m05=(n*P-r*b+a*C)*R,t.m06=(m*S-d*E-g*y)*R,t.m07=(u*E-f*S+_*y)*R,t.m08=(o*I-s*b+l*A)*R,t.m09=(i*b-n*I-a*A)*R,t.m10=(d*x-p*S+g*v)*R,t.m11=(h*S-u*x-_*v)*R,t.m12=(s*C-o*w-c*A)*R,t.m13=(n*w-i*C+r*A)*R,t.m14=(p*y-d*T-m*v)*R,t.m15=(u*T-h*y+f*v)*R,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,f=t.m11,_=t.m12,d=t.m13,p=t.m14,m=t.m15;return(e*o-n*a)*(h*m-f*p)-(e*s-i*a)*(u*m-f*d)+(e*c-r*a)*(u*p-h*d)+(n*s-i*o)*(l*m-f*_)-(n*c-r*o)*(l*p-h*_)+(i*c-r*s)*(l*d-u*_)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=e.m09,_=e.m10,d=e.m11,p=e.m12,m=e.m13,g=e.m14,v=e.m15,y=n.m00,S=n.m01,T=n.m02,x=n.m03;return t.m00=y*i+S*s+T*h+x*p,t.m01=y*r+S*c+T*f+x*m,t.m02=y*a+S*l+T*_+x*g,t.m03=y*o+S*u+T*d+x*v,y=n.m04,S=n.m05,T=n.m06,x=n.m07,t.m04=y*i+S*s+T*h+x*p,t.m05=y*r+S*c+T*f+x*m,t.m06=y*a+S*l+T*_+x*g,t.m07=y*o+S*u+T*d+x*v,y=n.m08,S=n.m09,T=n.m10,x=n.m11,t.m08=y*i+S*s+T*h+x*p,t.m09=y*r+S*c+T*f+x*m,t.m10=y*a+S*l+T*_+x*g,t.m11=y*o+S*u+T*d+x*v,y=n.m12,S=n.m13,T=n.m14,x=n.m15,t.m12=y*i+S*s+T*h+x*p,t.m13=y*r+S*c+T*f+x*m,t.m14=y*a+S*l+T*_+x*g,t.m15=y*o+S*u+T*d+x*v,t},e.transform=function(t,e,n){var i=n.x,r=n.y,a=n.z;if(e===t)t.m12=e.m00*i+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*i+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*i+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*i+e.m07*r+e.m11*a+e.m15;else{var o=e.m00,s=e.m01,c=e.m02,l=e.m03,u=e.m04,h=e.m05,f=e.m06,_=e.m07,d=e.m08,p=e.m09,m=e.m10,g=e.m11;e.m12,e.m13,e.m14,e.m15,t.m00=o,t.m01=s,t.m02=c,t.m03=l,t.m04=u,t.m05=h,t.m06=f,t.m07=_,t.m08=d,t.m09=p,t.m10=m,t.m11=g,t.m12=o*i+u*r+d*a+e.m12,t.m13=s*i+h*r+p*a+e.m13,t.m14=c*i+f*r+m*a+e.m14,t.m15=l*i+_*r+g*a+e.m15}return t},e.translate=function(t,e,n){return console.warn("function changed"),e===t?(t.m12+=n.x,t.m13+=n.y,t.m14+=n.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12+=n.x,t.m13+=n.y,t.m14+=n.z,t.m15=e.m15),t},e.scale=function(t,e,n){var i=n.x,r=n.y,a=n.z;return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.rotate=function(t,e,n,i){var r=i.x,a=i.y,o=i.z,s=Math.sqrt(r*r+a*a+o*o);if(Math.abs(s)<sn)return null;r*=s=1/s,a*=s,o*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=e.m00,f=e.m01,_=e.m02,d=e.m03,p=e.m04,m=e.m05,g=e.m06,v=e.m07,y=e.m08,S=e.m09,T=e.m10,x=e.m11,E=r*r*u+l,A=a*r*u+o*c,C=o*r*u-a*c,b=r*a*u-o*c,w=a*a*u+l,I=o*a*u+r*c,P=r*o*u+a*c,R=a*o*u-r*c,D=o*o*u+l;return t.m00=h*E+p*A+y*C,t.m01=f*E+m*A+S*C,t.m02=_*E+g*A+T*C,t.m03=d*E+v*A+x*C,t.m04=h*b+p*w+y*I,t.m05=f*b+m*w+S*I,t.m06=_*b+g*w+T*I,t.m07=d*b+v*w+x*I,t.m08=h*P+p*R+y*D,t.m09=f*P+m*R+S*D,t.m10=_*P+g*R+T*D,t.m11=d*P+v*R+x*D,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t},e.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m04,o=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+l*i,t.m05=o*r+u*i,t.m06=s*r+h*i,t.m07=c*r+f*i,t.m08=l*r-a*i,t.m09=u*r-o*i,t.m10=h*r-s*i,t.m11=f*r-c*i,t},e.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m08,u=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-l*i,t.m01=o*r-u*i,t.m02=s*r-h*i,t.m03=c*r-f*i,t.m08=a*i+l*r,t.m09=o*i+u*r,t.m10=s*i+h*r,t.m11=c*i+f*r,t},e.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m04,u=e.m05,h=e.m06,f=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+l*i,t.m01=o*r+u*i,t.m02=s*r+h*i,t.m03=c*r+f*i,t.m04=l*r-a*i,t.m05=u*r-o*i,t.m06=h*r-s*i,t.m07=f*r-c*i,t},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRotation=function(t,e,n){var i=n.x,r=n.y,a=n.z,o=Math.sqrt(i*i+r*r+a*a);if(Math.abs(o)<sn)return null;i*=o=1/o,r*=o,a*=o;var s=Math.sin(e),c=Math.cos(e),l=1-c;return t.m00=i*i*l+c,t.m01=r*i*l+a*s,t.m02=a*i*l-r*s,t.m03=0,t.m04=i*r*l-a*s,t.m05=r*r*l+c,t.m06=a*r*l+i*s,t.m07=0,t.m08=i*a*l+r*s,t.m09=r*a*l-i*s,t.m10=a*a*l+c,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=i,t.m06=n,t.m07=0,t.m08=0,t.m09=-n,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=0,t.m02=-n,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=n,t.m09=0,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=0,t.m04=-n,t.m05=i,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRT=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=i+i,c=r+r,l=a+a,u=i*s,h=i*c,f=i*l,_=r*c,d=r*l,p=a*l,m=o*s,g=o*c,v=o*l;return t.m00=1-(_+p),t.m01=h+v,t.m02=f-g,t.m03=0,t.m04=h-v,t.m05=1-(u+p),t.m06=d+m,t.m07=0,t.m08=f+g,t.m09=d-m,t.m10=1-(u+_),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.getTranslation=function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t},e.getScaling=function(t,e){var n=Yn.m00=e.m00,i=Yn.m01=e.m01,r=Yn.m02=e.m02,a=Yn.m03=e.m04,o=Yn.m04=e.m05,s=Yn.m05=e.m06,c=Yn.m06=e.m08,l=Yn.m07=e.m09,u=Yn.m08=e.m10;return t.x=Math.sqrt(n*n+i*i+r*r),t.y=Math.sqrt(a*a+o*o+s*s),t.z=Math.sqrt(c*c+l*l+u*u),Ln.determinant(Yn)<0&&(t.x*=-1),t},e.getRotation=function(t,e){var n=e.m00+e.m05+e.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),t.w=.25*i,t.x=(e.m06-e.m09)/i,t.y=(e.m08-e.m02)/i,t.z=(e.m01-e.m04)/i):e.m00>e.m05&&e.m00>e.m10?(i=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/i,t.x=.25*i,t.y=(e.m01+e.m04)/i,t.z=(e.m08+e.m02)/i):e.m05>e.m10?(i=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/i,t.x=(e.m01+e.m04)/i,t.y=.25*i,t.z=(e.m06+e.m09)/i):(i=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/i,t.x=(e.m08+e.m02)/i,t.y=(e.m06+e.m09)/i,t.z=.25*i),t},e.toRTS=function(t,e,n,i){i.x=Dn.set(qn,t.m00,t.m01,t.m02).length(),Yn.m00=t.m00/i.x,Yn.m01=t.m01/i.x,Yn.m02=t.m02/i.x,i.y=Dn.set(qn,t.m04,t.m05,t.m06).length(),Yn.m03=t.m04/i.y,Yn.m04=t.m05/i.y,Yn.m05=t.m06/i.y,i.z=Dn.set(qn,t.m08,t.m09,t.m10).length(),Yn.m06=t.m08/i.z,Yn.m07=t.m09/i.z,Yn.m08=t.m10/i.z,Ln.determinant(Yn)<0&&(i.x*=-1,Yn.m00*=-1,Yn.m01*=-1,Yn.m02*=-1),zn.fromMat3(e,Yn),Dn.set(n,t.m12,t.m13,t.m14)},e.fromRTS=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=e.w,c=r+r,l=a+a,u=o+o,h=r*c,f=r*l,_=r*u,d=a*l,p=a*u,m=o*u,g=s*c,v=s*l,y=s*u,S=i.x,T=i.y,x=i.z;return t.m00=(1-(d+m))*S,t.m01=(f+y)*S,t.m02=(_-v)*S,t.m03=0,t.m04=(f-y)*T,t.m05=(1-(h+m))*T,t.m06=(p+g)*T,t.m07=0,t.m08=(_+v)*x,t.m09=(p-g)*x,t.m10=(1-(h+d))*x,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.fromRTSOrigin=function(t,e,n,i,r){var a=e.x,o=e.y,s=e.z,c=e.w,l=a+a,u=o+o,h=s+s,f=a*l,_=a*u,d=a*h,p=o*u,m=o*h,g=s*h,v=c*l,y=c*u,S=c*h,T=i.x,x=i.y,E=i.z,A=r.x,C=r.y,b=r.z;return t.m00=(1-(p+g))*T,t.m01=(_+S)*T,t.m02=(d-y)*T,t.m03=0,t.m04=(_-S)*x,t.m05=(1-(f+g))*x,t.m06=(m+v)*x,t.m07=0,t.m08=(d+y)*E,t.m09=(m-v)*E,t.m10=(1-(f+p))*E,t.m11=0,t.m12=n.x+A-(t.m00*A+t.m04*C+t.m08*b),t.m13=n.y+C-(t.m01*A+t.m05*C+t.m09*b),t.m14=n.z+b-(t.m02*A+t.m06*C+t.m10*b),t.m15=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,u=i*o,h=i*s,f=r*o,_=r*s,d=r*c,p=a*o,m=a*s,g=a*c;return t.m00=1-h-d,t.m01=u+g,t.m02=f-m,t.m03=0,t.m04=u-g,t.m05=1-l-d,t.m06=_+p,t.m07=0,t.m08=f+m,t.m09=_-p,t.m10=1-l-h,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.frustum=function(t,e,n,i,r,a,o){var s=1/(n-e),c=1/(r-i),l=1/(a-o);return t.m00=2*a*s,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*c,t.m06=0,t.m07=0,t.m08=(n+e)*s,t.m09=(r+i)*c,t.m10=(o+a)*l,t.m11=-1,t.m12=0,t.m13=0,t.m14=o*a*2*l,t.m15=0,t},e.perspective=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=!0),void 0===o&&(o=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(e/2),u=1/(i-r),h=a?l/n:l,f=(a?l:l*n)*s,_=jn[c];return t.m00=h*_[0],t.m01=h*_[1],t.m02=0,t.m03=0,t.m04=f*_[2],t.m05=f*_[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-o*i)*u,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*i*u*(1-o),t.m15=0,t},e.ortho=function(t,e,n,i,r,a,o,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(e-n),h=1/(i-r)*c,f=1/(a-o),_=-2*u,d=-2*h,p=(e+n)*u,m=(r+i)*h,g=jn[l];return t.m00=_*g[0],t.m01=_*g[1],t.m02=0,t.m03=0,t.m04=d*g[2],t.m05=d*g[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=f*(1-s),t.m11=0,t.m12=p*g[0]+m*g[2],t.m13=p*g[1]+m*g[3],t.m14=(a-s*o)*f,t.m15=1,t},e.lookAt=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=a-n.y,f=o-n.z,_=1/Math.sqrt(u*u+h*h+f*f),d=c*(f*=_)-l*(h*=_),p=l*(u*=_)-s*f,m=s*h-c*u,g=h*(m*=_=1/Math.sqrt(d*d+p*p+m*m))-f*(p*=_),v=f*(d*=_)-u*m,y=u*p-h*d;return t.m00=d,t.m01=g,t.m02=u,t.m03=0,t.m04=p,t.m05=v,t.m06=h,t.m07=0,t.m08=m,t.m09=y,t.m10=f,t.m11=0,t.m12=-(d*r+p*a+m*o),t.m13=-(g*r+v*a+y*o),t.m14=-(u*r+h*a+f*o),t.m15=1,t},e.inverseTranspose=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,d=e.m12,p=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,S=n*l-a*o,T=i*c-r*s,x=i*l-a*s,E=r*l-a*c,A=u*p-h*d,C=u*m-f*d,b=u*g-_*d,w=h*m-f*p,I=h*g-_*p,P=f*g-_*m,R=v*P-y*I+S*w+T*b-x*C+E*A;return R?(R=1/R,t.m00=(s*P-c*I+l*w)*R,t.m01=(c*b-o*P-l*C)*R,t.m02=(o*I-s*b+l*A)*R,t.m03=0,t.m04=(r*I-i*P-a*w)*R,t.m05=(n*P-r*b+a*C)*R,t.m06=(i*b-n*I-a*A)*R,t.m07=0,t.m08=(p*E-m*x+g*T)*R,t.m09=(m*S-d*E-g*y)*R,t.m10=(d*x-p*S+g*v)*R,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t[n+9]=e.m09,t[n+10]=e.m10,t[n+11]=e.m11,t[n+12]=e.m12,t[n+13]=e.m13,t[n+14]=e.m14,t[n+15]=e.m15,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t.m09=e[n+9],t.m10=e[n+10],t.m11=e[n+11],t.m12=e[n+12],t.m13=e[n+13],t.m14=e[n+14],t.m15=e[n+15],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t.m09=e.m09+n.m09,t.m10=e.m10+n.m10,t.m11=e.m11+n.m11,t.m12=e.m12+n.m12,t.m13=e.m13+n.m13,t.m14=e.m14+n.m14,t.m15=e.m15+n.m15,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t.m09=e.m09-n.m09,t.m10=e.m10-n.m10,t.m11=e.m11-n.m11,t.m12=e.m12-n.m12,t.m13=e.m13-n.m13,t.m14=e.m14-n.m14,t.m15=e.m15-n.m15,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t.m09=e.m09*n,t.m10=e.m10*n,t.m11=e.m11*n,t.m12=e.m12*n,t.m13=e.m13*n,t.m14=e.m14*n,t.m15=e.m15*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t.m06=e.m06+n.m06*i,t.m07=e.m07+n.m07*i,t.m08=e.m08+n.m08*i,t.m09=e.m09+n.m09*i,t.m10=e.m10+n.m10*i,t.m11=e.m11+n.m11*i,t.m12=e.m12+n.m12*i,t.m13=e.m13+n.m13*i,t.m14=e.m14+n.m14*i,t.m15=e.m15+n.m15*i,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=n*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=n*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=n*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=n*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=n*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=n*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=n*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))};var n=e.prototype;return n.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===p&&(p=1),"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=f,this.m13=_,this.m14=d,this.m15=p,this.m00=t),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m03,i=this.m06,r=this.m07,a=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=a,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,f=this.m12,_=this.m13,d=this.m14,p=this.m15,m=t*a-e*r,g=t*o-n*r,v=t*s-i*r,y=e*o-n*a,S=e*s-i*a,T=n*s-i*o,x=c*_-l*f,E=c*d-u*f,A=c*p-h*f,C=l*d-u*_,b=l*p-h*_,w=u*p-h*d,I=m*w-g*b+v*C+y*A-S*E+T*x;return 0===I?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(I=1/I,this.m00=(a*w-o*b+s*C)*I,this.m01=(n*b-e*w-i*C)*I,this.m02=(_*T-d*S+p*y)*I,this.m03=(u*S-l*T-h*y)*I,this.m04=(o*A-r*w-s*E)*I,this.m05=(t*w-n*A+i*E)*I,this.m06=(d*v-f*T-p*g)*I,this.m07=(c*T-u*v+h*g)*I,this.m08=(r*b-a*A+s*x)*I,this.m09=(e*A-t*b-i*x)*I,this.m10=(f*S-_*v+p*m)*I,this.m11=(l*v-c*S-h*m)*I,this.m12=(a*E-r*C-o*x)*I,this.m13=(t*C-e*E+n*x)*I,this.m14=(_*g-f*y-d*m)*I,this.m15=(c*y-l*g+u*m)*I,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,f=this.m12,_=this.m13,d=this.m14,p=this.m15;return(t*a-e*r)*(u*p-h*d)-(t*o-n*r)*(l*p-h*_)+(t*s-i*r)*(l*d-u*_)+(e*o-n*a)*(c*p-h*f)-(e*s-i*a)*(c*d-u*f)+(n*s-i*o)*(c*_-l*f)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,f=this.m11,_=this.m12,d=this.m13,p=this.m14,m=this.m15,g=t.m00,v=t.m01,y=t.m02,S=t.m03;return this.m00=g*e+v*a+y*l+S*_,this.m01=g*n+v*o+y*u+S*d,this.m02=g*i+v*s+y*h+S*p,this.m03=g*r+v*c+y*f+S*m,g=t.m04,v=t.m05,y=t.m06,S=t.m07,this.m04=g*e+v*a+y*l+S*_,this.m05=g*n+v*o+y*u+S*d,this.m06=g*i+v*s+y*h+S*p,this.m07=g*r+v*c+y*f+S*m,g=t.m08,v=t.m09,y=t.m10,S=t.m11,this.m08=g*e+v*a+y*l+S*_,this.m09=g*n+v*o+y*u+S*d,this.m10=g*i+v*s+y*h+S*p,this.m11=g*r+v*c+y*f+S*m,g=t.m12,v=t.m13,y=t.m14,S=t.m15,this.m12=g*e+v*a+y*l+S*_,this.m13=g*n+v*o+y*u+S*d,this.m14=g*i+v*s+y*h+S*p,this.m15=g*r+v*c+y*f+S*m,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this},n.translate=function(t){return console.warn("function changed"),this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},n.scale=function(t){var e=t.x,n=t.y,i=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(t,e){var n=e.x,i=e.y,r=e.z,a=Math.sqrt(n*n+i*i+r*r);if(Math.abs(a)<sn)return null;n*=a=1/a,i*=a,r*=a;var o=Math.sin(t),s=Math.cos(t),c=1-s,l=this.m00,u=this.m01,h=this.m02,f=this.m03,_=this.m04,d=this.m05,p=this.m06,m=this.m07,g=this.m08,v=this.m09,y=this.m10,S=this.m11,T=n*n*c+s,x=i*n*c+r*o,E=r*n*c-i*o,A=n*i*c-r*o,C=i*i*c+s,b=r*i*c+n*o,w=n*r*c+i*o,I=i*r*c-n*o,P=r*r*c+s;return this.m00=l*T+_*x+g*E,this.m01=u*T+d*x+v*E,this.m02=h*T+p*x+y*E,this.m03=f*T+m*x+S*E,this.m04=l*A+_*C+g*b,this.m05=u*A+d*C+v*b,this.m06=h*A+p*C+y*b,this.m07=f*A+m*C+S*b,this.m08=l*w+_*I+g*P,this.m09=u*w+d*I+v*P,this.m10=h*w+p*I+y*P,this.m11=f*w+m*I+S*P,this},n.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},n.getScale=function(t){var e=Yn.m00=this.m00,n=Yn.m01=this.m01,i=Yn.m02=this.m02,r=Yn.m03=this.m04,a=Yn.m04=this.m05,o=Yn.m05=this.m06,s=Yn.m06=this.m08,c=Yn.m07=this.m09,l=Yn.m08=this.m10;return t.x=Math.sqrt(e*e+n*n+i*i),t.y=Math.sqrt(r*r+a*a+o*o),t.z=Math.sqrt(s*s+c*c+l*l),Ln.determinant(Yn)<0&&(t.x*=-1),t},n.getRotation=function(t){var e=this.m00+this.m05+this.m10,n=0;return e>0?(n=2*Math.sqrt(e+1),t.w=.25*n,t.x=(this.m06-this.m09)/n,t.y=(this.m08-this.m02)/n,t.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),t.w=(this.m06-this.m09)/n,t.x=.25*n,t.y=(this.m01+this.m04)/n,t.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),t.w=(this.m08-this.m02)/n,t.x=(this.m01+this.m04)/n,t.y=.25*n,t.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),t.w=(this.m01-this.m04)/n,t.x=(this.m08+this.m02)/n,t.y=(this.m06+this.m09)/n,t.z=.25*n),t},n.fromRTS=function(t,e,n){var i=t.x,r=t.y,a=t.z,o=t.w,s=i+i,c=r+r,l=a+a,u=i*s,h=i*c,f=i*l,_=r*c,d=r*l,p=a*l,m=o*s,g=o*c,v=o*l,y=n.x,S=n.y,T=n.z;return this.m00=(1-(_+p))*y,this.m01=(h+v)*y,this.m02=(f-g)*y,this.m03=0,this.m04=(h-v)*S,this.m05=(1-(u+p))*S,this.m06=(d+m)*S,this.m07=0,this.m08=(f+g)*T,this.m09=(d-m)*T,this.m10=(1-(u+_))*T,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,u=n*o,h=i*a,f=i*o,_=i*s,d=r*a,p=r*o,m=r*s;return this.m00=1-u-_,this.m01=l+m,this.m02=h-p,this.m03=0,this.m04=l-m,this.m05=1-c-_,this.m06=f+d,this.m07=0,this.m08=h+p,this.m09=f-d,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(ue));Xn.IDENTITY=Object.freeze(new Xn);var qn=new Dn,Yn=new Ln;function Kn(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p){return new Xn(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p)}tn.fastDefine("cc.Mat4",Xn,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),l.Mat4=Xn,l.mat4=Kn;var Qn=t("Vec2",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.x=e.x,i.y=e.y):(i.x=e||0,i.y=n||0),i}Z(e,t),e.clone=function(t){return new e(t.x,t.y)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t},e.set=function(t,e,n){return t.x=e,t.y=n,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},e.len=function(t){var e=t.x,n=t.y;return Math.sqrt(e*e+n*n)},e.lengthSqr=function(t){var e=t.x,n=t.y;return e*e+n*n},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y;return Math.abs(n)<sn?t.x=0:t.x=1/n,Math.abs(i)<sn?t.y=0:t.y=1/i,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t.x=n*r,t.y=i*r),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e,n){return t instanceof Dn?(t.x=t.y=0,t.z=e.x*n.y-e.y*n.x,t):t.x*e.y-t.y*e.x},e.lerp=function(t,e,n,i){var r=e.x,a=e.y;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t},e.random=function(t,e){e=e||1;var n=2*pn()*Math.PI;return t.x=Math.cos(n)*e,t.y=Math.sin(n)*e,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m03*r+n.m06,t.y=n.m01*i+n.m04*r+n.m07,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m04*r+n.m12,t.y=n.m01*i+n.m05*r+n.m13,t},e.str=function(t){return"Vec2("+t.x+", "+t.y+")"},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))},e.angle=function(t,n){e.normalize(Jn,t),e.normalize(Zn,n);var i=e.dot(Jn,Zn);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y)},n.set=function(t,e){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))},n.equals2f=function(t,e,n){return void 0===n&&(n=sn),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},n.strictEquals2f=function(t,e){return this.x===t&&this.y===e},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(t,e){var n=this.x,i=this.y;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.add2f=function(t,e){return this.x+=t,this.y+=e,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.subtract2f=function(t,e){return this.x-=t,this.y-=e,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=t,this.y*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this},n.multiply2f=function(t,e){return this.x*=t,this.y*=e,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.divide2f=function(t,e){return this.x/=t,this.y/=e,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var t=this.x,e=this.y,n=t*t+e*e;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(t){var e=this.lengthSqr(),n=t.lengthSqr();if(0===e||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(t)/Math.sqrt(e*n);return i=un(i,-1,1),Math.acos(i)},n.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},n.rotate=function(t){var e=this.x,n=this.y,i=Math.sin(t),r=Math.cos(t);return this.x=r*e-i*n,this.y=i*e+r*n,this},n.project=function(t){var e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this},n.transformMat4=function(t){var e=this.x,n=this.y;return this.x=t.m00*e+t.m04*n+t.m12,this.y=t.m01*e+t.m05*n+t.m13,this},e}(ue));Qn.ZERO=Object.freeze(new Qn(0,0)),Qn.ONE=Object.freeze(new Qn(1,1)),Qn.NEG_ONE=Object.freeze(new Qn(-1,-1)),Qn.UNIT_X=Object.freeze(new Qn(1,0)),Qn.UNIT_Y=Object.freeze(new Qn(0,1));var Jn=new Qn,Zn=new Qn;function $n(t,e){return new Qn(t,e)}tn.fastDefine("cc.Vec2",Qn,{x:0,y:0}),l.Vec2=Qn,l.v2=$n;var ti=t("Vec4",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=r||0),a}Z(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t.w=e.w+n.w,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t.w=e.w-n.w,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t.w=e.w*n.w,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t.w=e.w/n.w,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t.w=Math.min(e.w,n.w),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t.w=Math.max(e.w,n.w),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(n*n+i*i+r*r+a*a)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return n*n+i*i+r*r+a*a},e.len=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+n*n+i*i+r*r)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return e*e+n*n+i*i+r*r},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w;return Math.abs(n)<sn?t.x=0:t.x=1/n,Math.abs(i)<sn?t.y=0:t.y=1/i,Math.abs(r)<sn?t.z=0:t.z=1/r,Math.abs(a)<sn?t.w=0:t.w=1/a,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),t.x=n*o,t.y=i*o,t.z=r*o,t.w=a*o),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.random=function(t,e){e=e||1;var n=2*pn()*Math.PI,i=2*pn()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t.w=0,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*o,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*o,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*o,t.w=n.m03*i+n.m07*r+n.m11*a+n.m15*o,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*o,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*o,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*o,t.w=e.w,t},e.transformQuat=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*a-c*r,h=l*r+c*i-o*a,f=l*a+o*r-s*i,_=-o*i-s*r-c*a;return t.x=u*l+_*-o+h*-c-f*-s,t.y=h*l+_*-s+f*-o-u*-c,t.z=f*l+_*-c+u*-s-h*-o,t.w=e.w,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=sn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=i||0),this},n.equals=function(t,e){return void 0===e&&(e=sn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.equals4f=function(t,e,n,i,r){return void 0===r&&(r=sn),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.strictEquals4f=function(t,e,n,i){return this.x===t&&this.y===e&&this.z===n&&this.w===i},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.z,a=this.w;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=r+e*(t.z-r),this.w=a+e*(t.w-a),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this.z=un(this.z,t.z,e.z),this.w=un(this.w,t.w,e.w),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.add4f=function(t,e,n,i){return this.x+=t,this.y+=e,this.z+=n,this.w+=i,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.subtract4f=function(t,e,n,i){return this.x-=t,this.y-=e,this.z-=n,this.w-=i,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.multiply4f=function(t,e,n,i){return this.x*=t,this.y*=e,this.z*=n,this.w*=i,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},n.divide4f=function(t,e,n,i){return this.x/=t,this.y/=e,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return Math.sqrt(t*t+e*e+n*n+i*i)},n.lengthSqr=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=this.w,r=t*t+e*e+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=this.w;return this.x=t.m00*e+t.m04*n+t.m08*i+t.m12*r,this.y=t.m01*e+t.m05*n+t.m09*i+t.m13*r,this.z=t.m02*e+t.m06*n+t.m10*i+t.m14*r,this.w=t.m03*e+t.m07*n+t.m11*i+t.m15*r,this},e}(ue));function ei(t,e,n,i){return new ti(t,e,n,i)}ti.ZERO=Object.freeze(new ti(0,0,0,0)),ti.ONE=Object.freeze(new ti(1,1,1,1)),ti.NEG_ONE=Object.freeze(new ti(-1,-1,-1,-1)),tn.fastDefine("cc.Vec4",ti,{x:0,y:0,z:0,w:0}),l.Vec4=ti,l.v4=ei,U(Qn,"Vec2",[{name:"sub",newName:"subtract",target:Qn,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Qn,targetName:"Vec2"},{name:"div",newName:"divide",target:Qn,targetName:"Vec2"},{name:"dist",newName:"distance",target:Qn,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Qn,targetName:"Vec2"},{name:"mag",newName:"len",target:Qn,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Qn,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Qn,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Qn,targetName:"Vec2"}]),U(Qn.prototype,"Vec2",[{name:"mag",newName:"length",target:Qn.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Qn.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Qn.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Qn.prototype,targetName:"Vec2"}]),U(Dn,"Vec3",[{name:"sub",newName:"subtract",target:Dn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Dn,targetName:"Vec3"},{name:"div",newName:"divide",target:Dn,targetName:"Vec3"},{name:"dist",newName:"distance",target:Dn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Dn,targetName:"Vec3"},{name:"mag",newName:"len",target:Dn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Dn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Dn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Dn,targetName:"Vec3"}]),U(Dn.prototype,"Vec3",[{name:"mag",newName:"length",target:Dn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Dn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Dn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Dn.prototype,targetName:"Vec3"}]),U(ti,"Vec4",[{name:"sub",newName:"subtract",target:ti,targetName:"Vec4"},{name:"mul",newName:"multiply",target:ti,targetName:"Vec4"},{name:"div",newName:"divide",target:ti,targetName:"Vec4"},{name:"dist",newName:"distance",target:ti,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:ti,targetName:"Vec4"},{name:"mag",newName:"len",target:ti,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:ti,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ti,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ti,targetName:"Vec4"}]),U(ti.prototype,"Vec4",[{name:"mag",newName:"length",target:ti.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:ti.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ti.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ti.prototype,targetName:"Vec4"}]),U(zn,"Quat",[{name:"mag",newName:"len",target:zn,targetName:"Quat"},{name:"mul",newName:"multiply",target:zn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:zn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:zn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn,targetName:"Quat"}]),U(zn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:zn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn.prototype,targetName:"Quat"}]),U(Pn,"Color",[{name:"sub",newName:"subtract",target:Pn,targetName:"Color"},{name:"mul",newName:"multiply",target:Pn,targetName:"Color"},{name:"div",newName:"divide",target:Pn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Pn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[1].toString(16);return l.Color.fromHEX(e[0],i)}}]),U(Ln,"Mat3",[{name:"sub",newName:"subtract",target:Ln,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ln,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ln,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Ln,targetName:"Mat3"}]),U(Ln.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Ln.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ln.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Ln.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ln.prototype,targetName:"Mat3"}]),U(Xn,"Mat4",[{name:"sub",newName:"subtract",target:Xn,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Xn,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Xn,targetName:"Mat4"}]),U(Xn.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Xn.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Xn.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Xn.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Xn.prototype,targetName:"Mat4"}]);var ni=t("AffineTransform",function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.identity=function(){return new t},t.clone=function(e){return new t(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.concat=function(t,e,n){var i=e.a,r=e.b,a=e.c,o=e.d,s=e.tx,c=e.ty;t.a=i*n.a+r*n.c,t.b=i*n.b+r*n.d,t.c=a*n.a+o*n.c,t.d=a*n.b+o*n.d,t.tx=s*n.a+c*n.c+n.tx,t.ty=s*n.b+c*n.d+n.ty},t.invert=function(t,e){var n=1/(e.a*e.d-e.b*e.c);t.a=n*e.d,t.b=-n*e.b,t.c=-n*e.c,t.d=n*e.a,t.tx=n*(e.c*e.ty-e.d*e.tx),t.ty=n*(e.b*e.tx-e.a*e.ty)},t.fromMat4=function(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13},t.transformVec2=function(t,e,n,i){var r,a;i?(r=e,a=n):(i=n,r=e.x,a=e.y),t.x=i.a*r+i.c*a+i.tx,t.y=i.b*r+i.d*a+i.ty},t.transformSize=function(t,e,n){t.width=n.a*e.width+n.c*e.height,t.height=n.b*e.width+n.d*e.height},t.transformRect=function(t,e,n){var i=e.x+e.width,r=e.y+e.height,a=n.a*e.x+n.c*e.y+n.tx,o=n.b*e.x+n.d*e.y+n.ty,s=n.a*i+n.c*e.y+n.tx,c=n.b*i+n.d*e.y+n.ty,l=n.a*e.x+n.c*r+n.tx,u=n.b*e.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,f=n.b*i+n.d*r+n.ty,_=Math.min(a,s,l,h),d=Math.max(a,s,l,h),p=Math.min(o,c,u,f),m=Math.max(o,c,u,f);t.x=_,t.y=p,t.width=d-_,t.height=m-p},t.transformObb=function(t,e,n,i,r,a){var o=a.a*r.x+a.c*r.y+a.tx,s=a.b*r.x+a.d*r.y+a.ty,c=a.a*r.width,l=a.b*r.width,u=a.c*r.height,h=a.d*r.height;e.x=o,e.y=s,n.x=c+o,n.y=l+s,t.x=u+o,t.y=h+s,i.x=c+u+o,i.y=l+h+s},t}());l.AffineTransform=ni;var ii=t("Size",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.width=e.width,i.height=e.height):(i.width=e||0,i.height=n||0),i}Z(e,t),e.lerp=function(t,e,n,i){return t.width=e.width+(n.width-e.width)*i,t.height=e.height+(n.height-e.height)*i,t};var n=e.prototype;return n.clone=function(){return new e(this.width,this.height)},n.set=function(t,e){return t&&"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this},n.equals=function(t){return this.width===t.width&&this.height===t.height},n.lerp=function(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Q(e,[{key:"x",get:function(){return this.width},set:function(t){this.width=t}},{key:"y",get:function(){return this.height},set:function(t){this.height=t}}]),e}(ue));function ri(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new ii(t,e)}ii.ZERO=Object.freeze(new ii(0,0)),ii.ONE=Object.freeze(new ii(1,1)),tn.fastDefine("cc.Size",ii,{width:0,height:0}),l.size=ri,l.Size=ii;var ai=t("Rect",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.y=e.y,a.width=e.width,a.height=e.height,a.x=e.x):(a.x=e||0,a.y=n||0,a.width=i||0,a.height=r||0),a}Z(e,t),e.fromMinMax=function(t,e,n){var i=Math.min(e.x,n.x),r=Math.min(e.y,n.y),a=Math.max(e.x,n.x),o=Math.max(e.y,n.y);return t.x=i,t.y=r,t.width=a-i,t.height=o-r,t},e.lerp=function(t,e,n,i){var r=e.x,a=e.y,o=e.width,s=e.height;return t.x=r+(n.x-r)*i,t.y=a+(n.y-a)*i,t.width=o+(n.width-o)*i,t.height=s+(n.height-s)*i,t},e.intersection=function(t,e,n){var i=e.x,r=e.y,a=e.x+e.width,o=e.y+e.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return t.x=Math.max(i,s),t.y=Math.max(r,c),t.width=Math.min(a,l)-t.x,t.height=Math.min(o,u)-t.y,t},e.union=function(t,e,n){var i=e.x,r=e.y,a=e.width,o=e.height,s=n.x,c=n.y,l=n.width,u=n.height;return t.x=Math.min(i,s),t.y=Math.min(r,c),t.width=Math.max(i+a,s+l)-t.x,t.height=Math.max(r+o,c+u)-t.y,t};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.width,this.height)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x):(this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0),this},n.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.width,a=this.height;return this.x=n+(t.x-n)*e,this.y=i+(t.y-i)*e,this.width=r+(t.width-r)*e,this.height=a+(t.height-a)*e,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(t){var e=this.x+this.width,n=this.y+this.height,i=t.x+t.width,r=t.y+t.height;return!(e<t.x||i<this.x||n<t.y||r<this.y)},n.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},n.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},n.transformMat4=function(t){var e=this.x,n=this.y,i=e+this.width,r=n+this.height,a=t.m00*e+t.m04*n+t.m12,o=t.m01*e+t.m05*n+t.m13,s=t.m00*i+t.m04*n+t.m12,c=t.m01*i+t.m05*n+t.m13,l=t.m00*e+t.m04*r+t.m12,u=t.m01*e+t.m05*r+t.m13,h=t.m00*i+t.m04*r+t.m12,f=t.m01*i+t.m05*r+t.m13,_=Math.min(a,s,l,h),d=Math.max(a,s,l,h),p=Math.min(o,c,u,f),m=Math.max(o,c,u,f);return this.x=_,this.y=p,this.width=d-_,this.height=m-p,this},n.transformMat4ToPoints=function(t,e,n,i,r){var a=this.x,o=this.y,s=a+this.width,c=o+this.height;e.x=t.m00*a+t.m04*o+t.m12,e.y=t.m01*a+t.m05*o+t.m13,r.x=t.m00*s+t.m04*o+t.m12,r.y=t.m01*s+t.m05*o+t.m13,n.x=t.m00*a+t.m04*c+t.m12,n.y=t.m01*a+t.m05*c+t.m13,i.x=t.m00*s+t.m04*c+t.m12,i.y=t.m01*s+t.m05*c+t.m13},Q(e,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Qn(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Qn(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new ii(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",get:function(){return this.width},set:function(t){this.width=t}},{key:"w",get:function(){return this.height},set:function(t){this.height=t}}]),e}(ue));function oi(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),new ai(t,e,n,i)}tn.fastDefine("cc.Rect",ai,{x:0,y:0,width:0,height:0}),l.Rect=ai,l.rect=oi;var si=t("MATH_FLOAT_ARRAY",Float64Array),ci=t("MathBase",function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.createFloatArray=function(t){return new si(t)},Q(e,[{key:"array",get:function(){return this._array}}]),e}(ue)),li=Object.freeze({__proto__:null,bits:s,Vec2:Qn,v2:$n,Vec3:Dn,v3:Mn,Vec4:ti,v4:ei,Quat:zn,quat:Wn,Mat3:Ln,Mat4:Xn,mat4:Kn,AffineTransform:ni,Size:ii,size:ri,Rect:ai,rect:oi,Color:Pn,color:Rn,EPSILON:sn,equals:cn,approx:ln,clamp:un,clamp01:hn,lerp:fn,toRadian:_n,toDegree:dn,random:pn,randomRange:mn,randomRangeInt:gn,pseudoRandom:vn,pseudoRandomRange:yn,pseudoRandomRangeInt:Sn,nextPow2:Tn,repeat:xn,pingPong:En,inverseLerp:An,absMaxComponent:Cn,absMax:bn,enumerableProps:wn,MATH_FLOAT_ARRAY:si,MathBase:ci});t("math",li);var ui,hi,fi,_i,di,pi,mi,gi,vi,yi,Si,Ti,xi,Ei,Ai,Ci,bi,wi,Ii,Pi,Ri,Di,Oi,Ni,Mi,Li,Fi,Bi,zi,Ui,ki,Gi,Vi,Hi,Wi,ji,Xi,qi,Yi,Ki,Qi,Ji,Zi=function(t,e,n){for(var i=0;i<e.length;++i)t.length<=i&&t.push(new n),t[i].copy(e[i]);t.length=e.length};!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SWAPCHAIN=1]="SWAPCHAIN",t[t.BUFFER=2]="BUFFER",t[t.TEXTURE=3]="TEXTURE",t[t.RENDER_PASS=4]="RENDER_PASS",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.SAMPLER=6]="SAMPLER",t[t.SHADER=7]="SHADER",t[t.DESCRIPTOR_SET_LAYOUT=8]="DESCRIPTOR_SET_LAYOUT",t[t.PIPELINE_LAYOUT=9]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=10]="PIPELINE_STATE",t[t.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",t[t.COMMAND_BUFFER=13]="COMMAND_BUFFER",t[t.QUEUE=14]="QUEUE",t[t.QUERY_POOL=15]="QUERY_POOL",t[t.GLOBAL_BARRIER=16]="GLOBAL_BARRIER",t[t.TEXTURE_BARRIER=17]="TEXTURE_BARRIER",t[t.BUFFER_BARRIER=18]="BUFFER_BARRIER",t[t.COUNT=19]="COUNT"}(ui||(ui={})),function(t){t[t.UNREADY=0]="UNREADY",t[t.FAILED=1]="FAILED",t[t.SUCCESS=2]="SUCCESS"}(hi||(hi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.GLES2=1]="GLES2",t[t.GLES3=2]="GLES3",t[t.METAL=3]="METAL",t[t.VULKAN=4]="VULKAN",t[t.NVN=5]="NVN",t[t.WEBGL=6]="WEBGL",t[t.WEBGL2=7]="WEBGL2",t[t.WEBGPU=8]="WEBGPU"}(fi||(fi={})),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.ROTATE_90=1]="ROTATE_90",t[t.ROTATE_180=2]="ROTATE_180",t[t.ROTATE_270=3]="ROTATE_270"}(_i||(_i={})),function(t){t[t.ELEMENT_INDEX_UINT=0]="ELEMENT_INDEX_UINT",t[t.INSTANCED_ARRAYS=1]="INSTANCED_ARRAYS",t[t.MULTIPLE_RENDER_TARGETS=2]="MULTIPLE_RENDER_TARGETS",t[t.BLEND_MINMAX=3]="BLEND_MINMAX",t[t.COMPUTE_SHADER=4]="COMPUTE_SHADER",t[t.INPUT_ATTACHMENT_BENEFIT=5]="INPUT_ATTACHMENT_BENEFIT",t[t.COUNT=6]="COUNT"}(di||(di={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.BGRA8=36]="BGRA8",t[t.SRGB8_A8=37]="SRGB8_A8",t[t.RGBA8SN=38]="RGBA8SN",t[t.RGBA8UI=39]="RGBA8UI",t[t.RGBA8I=40]="RGBA8I",t[t.RGBA16F=41]="RGBA16F",t[t.RGBA16UI=42]="RGBA16UI",t[t.RGBA16I=43]="RGBA16I",t[t.RGBA32F=44]="RGBA32F",t[t.RGBA32UI=45]="RGBA32UI",t[t.RGBA32I=46]="RGBA32I",t[t.R5G6B5=47]="R5G6B5",t[t.R11G11B10F=48]="R11G11B10F",t[t.RGB5A1=49]="RGB5A1",t[t.RGBA4=50]="RGBA4",t[t.RGB10A2=51]="RGB10A2",t[t.RGB10A2UI=52]="RGB10A2UI",t[t.RGB9E5=53]="RGB9E5",t[t.DEPTH=54]="DEPTH",t[t.DEPTH_STENCIL=55]="DEPTH_STENCIL",t[t.BC1=56]="BC1",t[t.BC1_ALPHA=57]="BC1_ALPHA",t[t.BC1_SRGB=58]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=59]="BC1_SRGB_ALPHA",t[t.BC2=60]="BC2",t[t.BC2_SRGB=61]="BC2_SRGB",t[t.BC3=62]="BC3",t[t.BC3_SRGB=63]="BC3_SRGB",t[t.BC4=64]="BC4",t[t.BC4_SNORM=65]="BC4_SNORM",t[t.BC5=66]="BC5",t[t.BC5_SNORM=67]="BC5_SNORM",t[t.BC6H_UF16=68]="BC6H_UF16",t[t.BC6H_SF16=69]="BC6H_SF16",t[t.BC7=70]="BC7",t[t.BC7_SRGB=71]="BC7_SRGB",t[t.ETC_RGB8=72]="ETC_RGB8",t[t.ETC2_RGB8=73]="ETC2_RGB8",t[t.ETC2_SRGB8=74]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=75]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=76]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=77]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=78]="ETC2_SRGB8_A8",t[t.EAC_R11=79]="EAC_R11",t[t.EAC_R11SN=80]="EAC_R11SN",t[t.EAC_RG11=81]="EAC_RG11",t[t.EAC_RG11SN=82]="EAC_RG11SN",t[t.PVRTC_RGB2=83]="PVRTC_RGB2",t[t.PVRTC_RGBA2=84]="PVRTC_RGBA2",t[t.PVRTC_RGB4=85]="PVRTC_RGB4",t[t.PVRTC_RGBA4=86]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=87]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=88]="PVRTC2_4BPP",t[t.ASTC_RGBA_4X4=89]="ASTC_RGBA_4X4",t[t.ASTC_RGBA_5X4=90]="ASTC_RGBA_5X4",t[t.ASTC_RGBA_5X5=91]="ASTC_RGBA_5X5",t[t.ASTC_RGBA_6X5=92]="ASTC_RGBA_6X5",t[t.ASTC_RGBA_6X6=93]="ASTC_RGBA_6X6",t[t.ASTC_RGBA_8X5=94]="ASTC_RGBA_8X5",t[t.ASTC_RGBA_8X6=95]="ASTC_RGBA_8X6",t[t.ASTC_RGBA_8X8=96]="ASTC_RGBA_8X8",t[t.ASTC_RGBA_10X5=97]="ASTC_RGBA_10X5",t[t.ASTC_RGBA_10X6=98]="ASTC_RGBA_10X6",t[t.ASTC_RGBA_10X8=99]="ASTC_RGBA_10X8",t[t.ASTC_RGBA_10X10=100]="ASTC_RGBA_10X10",t[t.ASTC_RGBA_12X10=101]="ASTC_RGBA_12X10",t[t.ASTC_RGBA_12X12=102]="ASTC_RGBA_12X12",t[t.ASTC_SRGBA_4X4=103]="ASTC_SRGBA_4X4",t[t.ASTC_SRGBA_5X4=104]="ASTC_SRGBA_5X4",t[t.ASTC_SRGBA_5X5=105]="ASTC_SRGBA_5X5",t[t.ASTC_SRGBA_6X5=106]="ASTC_SRGBA_6X5",t[t.ASTC_SRGBA_6X6=107]="ASTC_SRGBA_6X6",t[t.ASTC_SRGBA_8X5=108]="ASTC_SRGBA_8X5",t[t.ASTC_SRGBA_8X6=109]="ASTC_SRGBA_8X6",t[t.ASTC_SRGBA_8X8=110]="ASTC_SRGBA_8X8",t[t.ASTC_SRGBA_10X5=111]="ASTC_SRGBA_10X5",t[t.ASTC_SRGBA_10X6=112]="ASTC_SRGBA_10X6",t[t.ASTC_SRGBA_10X8=113]="ASTC_SRGBA_10X8",t[t.ASTC_SRGBA_10X10=114]="ASTC_SRGBA_10X10",t[t.ASTC_SRGBA_12X10=115]="ASTC_SRGBA_12X10",t[t.ASTC_SRGBA_12X12=116]="ASTC_SRGBA_12X12",t[t.COUNT=117]="COUNT"}(pi||(pi={})),function(t){t[t.NONE=0]="NONE",t[t.UNORM=1]="UNORM",t[t.SNORM=2]="SNORM",t[t.UINT=3]="UINT",t[t.INT=4]="INT",t[t.UFLOAT=5]="UFLOAT",t[t.FLOAT=6]="FLOAT"}(mi||(mi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.MAT2=17]="MAT2",t[t.MAT2X3=18]="MAT2X3",t[t.MAT2X4=19]="MAT2X4",t[t.MAT3X2=20]="MAT3X2",t[t.MAT3=21]="MAT3",t[t.MAT3X4=22]="MAT3X4",t[t.MAT4X2=23]="MAT4X2",t[t.MAT4X3=24]="MAT4X3",t[t.MAT4=25]="MAT4",t[t.SAMPLER1D=26]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=28]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=30]="SAMPLER3D",t[t.SAMPLER_CUBE=31]="SAMPLER_CUBE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE1D=33]="TEXTURE1D",t[t.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",t[t.TEXTURE2D=35]="TEXTURE2D",t[t.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",t[t.TEXTURE3D=37]="TEXTURE3D",t[t.TEXTURE_CUBE=38]="TEXTURE_CUBE",t[t.IMAGE1D=39]="IMAGE1D",t[t.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",t[t.IMAGE2D=41]="IMAGE2D",t[t.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",t[t.IMAGE3D=43]="IMAGE3D",t[t.IMAGE_CUBE=44]="IMAGE_CUBE",t[t.SUBPASS_INPUT=45]="SUBPASS_INPUT",t[t.COUNT=46]="COUNT"}(gi||(gi={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(vi||(vi={})),function(t){t[t.NONE=0]="NONE"}(yi||(yi={})),function(t){t[t.NONE=0]="NONE",t[t.READ_ONLY=1]="READ_ONLY",t[t.WRITE_ONLY=2]="WRITE_ONLY",t[t.READ_WRITE=3]="READ_WRITE"}(Si||(Si={})),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(Ti||(Ti={})),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D",t[t.CUBE=3]="CUBE",t[t.TEX1D_ARRAY=4]="TEX1D_ARRAY",t[t.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(xi||(xi={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT"}(Ei||(Ei={})),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.GENERAL_LAYOUT=2]="GENERAL_LAYOUT"}(Ai||(Ai={})),function(t){t[t.NONE=0]="NONE",t[t.RENDER_TARGET=1]="RENDER_TARGET",t[t.SAMPLED_TEXTURE=2]="SAMPLED_TEXTURE",t[t.LINEAR_FILTER=4]="LINEAR_FILTER",t[t.STORAGE_TEXTURE=8]="STORAGE_TEXTURE",t[t.VERTEX_ATTRIBUTE=16]="VERTEX_ATTRIBUTE"}(Ci||(Ci={})),function(t){t[t.ONE=0]="ONE",t[t.MULTIPLE_PERFORMANCE=1]="MULTIPLE_PERFORMANCE",t[t.MULTIPLE_BALANCE=2]="MULTIPLE_BALANCE",t[t.MULTIPLE_QUALITY=3]="MULTIPLE_QUALITY"}(bi||(bi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.RELAXED=2]="RELAXED",t[t.MAILBOX=3]="MAILBOX",t[t.HALF=4]="HALF"}(wi||(wi={})),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(Ii||(Ii={})),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(Pi||(Pi={})),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(Ri||(Ri={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(Di||(Di={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Oi||(Oi={})),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(Ni||(Ni={})),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}(Mi||(Mi={})),function(t){t[t.NONE=0]="NONE",t[t.VERTEX=1]="VERTEX",t[t.CONTROL=2]="CONTROL",t[t.EVALUATION=4]="EVALUATION",t[t.GEOMETRY=8]="GEOMETRY",t[t.FRAGMENT=16]="FRAGMENT",t[t.COMPUTE=32]="COMPUTE",t[t.ALL=63]="ALL"}(Li||(Li={})),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(Fi||(Fi={})),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(Bi||(Bi={})),function(t){t[t.NONE=0]="NONE",t[t.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",t[t.INDEX_BUFFER=2]="INDEX_BUFFER",t[t.VERTEX_BUFFER=4]="VERTEX_BUFFER",t[t.VERTEX_SHADER_READ_UNIFORM_BUFFER=8]="VERTEX_SHADER_READ_UNIFORM_BUFFER",t[t.VERTEX_SHADER_READ_TEXTURE=16]="VERTEX_SHADER_READ_TEXTURE",t[t.VERTEX_SHADER_READ_OTHER=32]="VERTEX_SHADER_READ_OTHER",t[t.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=64]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",t[t.FRAGMENT_SHADER_READ_TEXTURE=128]="FRAGMENT_SHADER_READ_TEXTURE",t[t.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=256]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=512]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_OTHER=1024]="FRAGMENT_SHADER_READ_OTHER",t[t.COLOR_ATTACHMENT_READ=2048]="COLOR_ATTACHMENT_READ",t[t.DEPTH_STENCIL_ATTACHMENT_READ=4096]="DEPTH_STENCIL_ATTACHMENT_READ",t[t.COMPUTE_SHADER_READ_UNIFORM_BUFFER=8192]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",t[t.COMPUTE_SHADER_READ_TEXTURE=16384]="COMPUTE_SHADER_READ_TEXTURE",t[t.COMPUTE_SHADER_READ_OTHER=32768]="COMPUTE_SHADER_READ_OTHER",t[t.TRANSFER_READ=65536]="TRANSFER_READ",t[t.HOST_READ=131072]="HOST_READ",t[t.PRESENT=262144]="PRESENT",t[t.VERTEX_SHADER_WRITE=524288]="VERTEX_SHADER_WRITE",t[t.FRAGMENT_SHADER_WRITE=1048576]="FRAGMENT_SHADER_WRITE",t[t.COLOR_ATTACHMENT_WRITE=2097152]="COLOR_ATTACHMENT_WRITE",t[t.DEPTH_STENCIL_ATTACHMENT_WRITE=4194304]="DEPTH_STENCIL_ATTACHMENT_WRITE",t[t.COMPUTE_SHADER_WRITE=8388608]="COMPUTE_SHADER_WRITE",t[t.TRANSFER_WRITE=16777216]="TRANSFER_WRITE",t[t.HOST_PREINITIALIZED=33554432]="HOST_PREINITIALIZED",t[t.HOST_WRITE=67108864]="HOST_WRITE"}(zi||(zi={})),function(t){t[t.NONE=0]="NONE",t[t.SAMPLE_ZERO=1]="SAMPLE_ZERO",t[t.AVERAGE=2]="AVERAGE",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(Ui||(Ui={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(ki||(ki={})),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(Gi||(Gi={})),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(Vi||(Vi={})),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(Hi||(Hi={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(Wi||(Wi={})),function(t){t[t.NONE=0]="NONE",t[t.LINE_WIDTH=1]="LINE_WIDTH",t[t.DEPTH_BIAS=2]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=8]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=16]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=32]="STENCIL_COMPARE_MASK"}(ji||(ji={})),function(t){t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.ALL=3]="ALL"}(Xi||(Xi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",t[t.STORAGE_BUFFER=4]="STORAGE_BUFFER",t[t.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",t[t.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE=64]="TEXTURE",t[t.STORAGE_IMAGE=128]="STORAGE_IMAGE",t[t.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(qi||(qi={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}(Yi||(Yi={})),function(t){t[t.OCCLUSION=0]="OCCLUSION",t[t.PIPELINE_STATISTICS=1]="PIPELINE_STATISTICS",t[t.TIMESTAMP=2]="TIMESTAMP"}(Ki||(Ki={})),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(Qi||(Qi={})),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(Ji||(Ji={}));var $i,tr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),er=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p,m,g,v,y,S,T){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=1),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=new tr),void 0===g&&(g=new tr),void 0===v&&(v=!1),void 0===y&&(y=-1),void 0===S&&(S=1),void 0===T&&(T=1),this.maxVertexAttributes=t,this.maxVertexUniformVectors=e,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=r,this.maxVertexTextureUnits=a,this.maxColorRenderTargets=o,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=u,this.maxTextureSize=h,this.maxCubeMapTextureSize=f,this.uboOffsetAlignment=_,this.maxComputeSharedMemorySize=d,this.maxComputeWorkGroupInvocations=p,this.maxComputeWorkGroupSize=m,this.maxComputeWorkGroupCount=g,this.supportQuery=v,this.clipSpaceMinZ=y,this.screenSpaceSignY=S,this.clipSpaceSignY=T}return t.prototype.copy=function(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this},t}(),nr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),ir=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t}(),rr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.width=t,this.height=e,this.depth=n}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this},t}(),ar=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=n}return t.prototype.copy=function(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),or=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=1),this.baseMipLevel=t,this.levelCount=e,this.baseArrayLayer=n,this.layerCount=i}return t.prototype.copy=function(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),sr=function(){function t(t,e,n,i,r){void 0===t&&(t=new ar),void 0===e&&(e=new nr),void 0===n&&(n=new ar),void 0===i&&(i=new nr),void 0===r&&(r=new rr),this.srcSubres=t,this.srcOffset=e,this.dstSubres=n,this.dstOffset=i,this.extent=r}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this},t}(),cr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=new ar),void 0===e&&(e=new nr),void 0===n&&(n=new rr),void 0===i&&(i=new ar),void 0===r&&(r=new nr),void 0===a&&(a=new rr),this.srcSubres=t,this.srcOffset=e,this.srcExtent=n,this.dstSubres=i,this.dstOffset=r,this.dstExtent=a}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this},t}(),lr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=new nr),void 0===i&&(i=new rr),void 0===r&&(r=new ar),this.buffStride=t,this.buffTexHeight=e,this.texOffset=n,this.texExtent=i,this.texSubres=r}return t.prototype.copy=function(t){return this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this},t}(),ur=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),this.left=t,this.top=e,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=a}return t.prototype.copy=function(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this},t}(),hr=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=n,this.w=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t}(),fr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=[0]),void 0===e&&(e=[0]),void 0===n&&(n=[0]),void 0===i&&(i=[0]),void 0===r&&(r=[0]),void 0===a&&(a=[0]),void 0===o&&(o=[0]),void 0===s&&(s=[0]),this.maxBlockCounts=t,this.maxSamplerTextureCounts=e,this.maxSamplerCounts=n,this.maxTextureCounts=i,this.maxBufferCounts=r,this.maxImageCounts=a,this.maxSubpassInputCounts=o,this.setIndices=s}return t.prototype.copy=function(t){return this.maxBlockCounts=t.maxBlockCounts.slice(),this.maxSamplerTextureCounts=t.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=t.maxSamplerCounts.slice(),this.maxTextureCounts=t.maxTextureCounts.slice(),this.maxBufferCounts=t.maxBufferCounts.slice(),this.maxImageCounts=t.maxImageCounts.slice(),this.maxSubpassInputCounts=t.maxSubpassInputCounts.slice(),this.setIndices=t.setIndices.slice(),this},t}(),_r=function(){function t(t,e,n,i){void 0===t&&(t=null),void 0===e&&(e=wi.ON),void 0===n&&(n=0),void 0===i&&(i=0),this.windowHandle=t,this.vsyncMode=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this},t}(),dr=function(){function t(t){void 0===t&&(t=new fr),this.bindingMappingInfo=t}return t.prototype.copy=function(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this},t}(),pr=function(){function t(t,e,n,i,r){void 0===t&&(t=vi.NONE),void 0===e&&(e=Ti.NONE),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=yi.NONE),this.usage=t,this.memUsage=e,this.size=n,this.stride=i,this.flags=r}return t.prototype.copy=function(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this},t}(),mr=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=0),void 0===n&&(n=0),this.buffer=t,this.offset=e,this.range=n}return t.prototype.copy=function(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this},t}(),gr=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),this.vertexCount=t,this.firstVertex=e,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=a,this.firstInstance=o}return t.prototype.copy=function(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this},t}(),vr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===r&&(r=0),this.groupCountX=t,this.groupCountY=e,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=r}return t.prototype.copy=function(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this},t}(),yr=function(){function t(t){void 0===t&&(t=[]),this.drawInfos=t}return t.prototype.copy=function(t){return Zi(this.drawInfos,t.drawInfos,gr),this},t}(),Sr=function(){function t(t,e,n,i,r,a,o,s,c,l,u){void 0===t&&(t=xi.TEX2D),void 0===e&&(e=Ei.NONE),void 0===n&&(n=pi.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=Ai.NONE),void 0===o&&(o=1),void 0===s&&(s=1),void 0===c&&(c=bi.ONE),void 0===l&&(l=1),void 0===u&&(u=0),this.type=t,this.usage=e,this.format=n,this.width=i,this.height=r,this.flags=a,this.layerCount=o,this.levelCount=s,this.samples=c,this.depth=l,this.externalRes=u}return t.prototype.copy=function(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this},t}(),Tr=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=null),void 0===e&&(e=xi.TEX2D),void 0===n&&(n=pi.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=1),this.texture=t,this.type=e,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=a,this.layerCount=o}return t.prototype.copy=function(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this},t}(),xr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=Ii.LINEAR),void 0===e&&(e=Ii.LINEAR),void 0===n&&(n=Ii.NONE),void 0===i&&(i=Pi.WRAP),void 0===r&&(r=Pi.WRAP),void 0===a&&(a=Pi.WRAP),void 0===o&&(o=0),void 0===s&&(s=Ri.ALWAYS),this.minFilter=t,this.magFilter=e,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=a,this.maxAnisotropy=o,this.cmpFunc=s}return t.prototype.copy=function(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this},t}(),Er=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=gi.UNKNOWN),void 0===n&&(n=0),this.name=t,this.type=e,this.count=n}return t.prototype.copy=function(t){return this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Ar=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.members=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,Zi(this.members,t.members,Er),this.count=t.count,this},t}(),Cr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),br=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),wr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Ir=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),void 0===a&&(a=Si.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r,this.memoryAccess=a}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Pr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),void 0===r&&(r=Si.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.count=i,this.memoryAccess=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Rr=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),Dr=function(){function t(t,e){void 0===t&&(t=Li.NONE),void 0===e&&(e=""),this.stage=t,this.source=e}return t.prototype.copy=function(t){return this.stage=t.stage,this.source=t.source,this},t}(),Or=function(){function t(t,e,n,i,r,a){void 0===t&&(t=""),void 0===e&&(e=pi.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=0),this.name=t,this.format=e,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=a}return t.prototype.copy=function(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this},t}(),Nr=function(){function t(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===a&&(a=[]),void 0===o&&(o=[]),void 0===s&&(s=[]),void 0===c&&(c=[]),void 0===l&&(l=[]),this.name=t,this.stages=e,this.attributes=n,this.blocks=i,this.buffers=r,this.samplerTextures=a,this.samplers=o,this.textures=s,this.images=c,this.subpassInputs=l}return t.prototype.copy=function(t){return this.name=t.name,Zi(this.stages,t.stages,Dr),Zi(this.attributes,t.attributes,Or),Zi(this.blocks,t.blocks,Ar),Zi(this.buffers,t.buffers,Pr),Zi(this.samplerTextures,t.samplerTextures,Cr),Zi(this.samplers,t.samplers,br),Zi(this.textures,t.textures,wr),Zi(this.images,t.images,Ir),Zi(this.subpassInputs,t.subpassInputs,Rr),this},t}(),Mr=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=t,this.vertexBuffers=e,this.indexBuffer=n,this.indirectBuffer=i}return t.prototype.copy=function(t){return Zi(this.attributes,t.attributes,Or),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this},t}(),Lr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=pi.UNKNOWN),void 0===e&&(e=bi.ONE),void 0===n&&(n=Fi.CLEAR),void 0===i&&(i=Bi.STORE),void 0===r&&(r=null),void 0===a&&(a=!1),this.format=t,this.sampleCount=e,this.loadOp=n,this.storeOp=i,this.barrier=r,this.isGeneralLayout=a}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.barrier=t.barrier,this.isGeneralLayout=t.isGeneralLayout,this},t}(),Fr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=pi.UNKNOWN),void 0===e&&(e=bi.ONE),void 0===n&&(n=Fi.CLEAR),void 0===i&&(i=Bi.STORE),void 0===r&&(r=Fi.CLEAR),void 0===a&&(a=Bi.STORE),void 0===o&&(o=null),void 0===s&&(s=!1),this.format=t,this.sampleCount=e,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=a,this.barrier=o,this.isGeneralLayout=s}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.barrier=t.barrier,this.isGeneralLayout=t.isGeneralLayout,this},t}(),Br=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===a&&(a=-1),void 0===o&&(o=Ui.NONE),void 0===s&&(s=Ui.NONE),this.inputs=t,this.colors=e,this.resolves=n,this.preserves=i,this.depthStencil=r,this.depthStencilResolve=a,this.depthResolveMode=o,this.stencilResolveMode=s}return t.prototype.copy=function(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this},t}(),zr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),this.srcSubpass=t,this.dstSubpass=e,this.barrier=n}return t.prototype.copy=function(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.barrier=t.barrier,this},t}(),Ur=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=new Fr),void 0===n&&(n=[]),void 0===i&&(i=[]),this.colorAttachments=t,this.depthStencilAttachment=e,this.subpasses=n,this.dependencies=i}return t.prototype.copy=function(t){return Zi(this.colorAttachments,t.colorAttachments,Lr),this.depthStencilAttachment.copy(t.depthStencilAttachment),Zi(this.subpasses,t.subpasses,Br),Zi(this.dependencies,t.dependencies,zr),this},t}(),kr=function(){function t(t,e){void 0===t&&(t=zi.NONE),void 0===e&&(e=zi.NONE),this.prevAccesses=t,this.nextAccesses=e}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this},t}(),Gr=function(){function t(t,e,n,i,r){void 0===t&&(t=zi.NONE),void 0===e&&(e=zi.NONE),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===r&&(r=null),this.prevAccesses=t,this.nextAccesses=e,this.discardContents=n,this.srcQueue=i,this.dstQueue=r}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),Vr=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=[]),void 0===n&&(n=null),this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=n}return t.prototype.copy=function(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this},t}(),Hr=function(){function t(t,e,n,i,r){void 0===t&&(t=-1),void 0===e&&(e=qi.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=Li.NONE),void 0===r&&(r=[]),this.binding=t,this.descriptorType=e,this.count=n,this.stageFlags=i,this.immutableSamplers=r}return t.prototype.copy=function(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.immutableSamplers=t.immutableSamplers.slice(),this},t}(),Wr=function(){function t(t){void 0===t&&(t=[]),this.bindings=t}return t.prototype.copy=function(t){return Zi(this.bindings,t.bindings,Hr),this},t}(),jr=function(){function t(t){void 0===t&&(t=null),this.layout=t}return t.prototype.copy=function(t){return this.layout=t.layout,this},t}(),Xr=function(){function t(t){void 0===t&&(t=[]),this.setLayouts=t}return t.prototype.copy=function(t){return this.setLayouts=t.setLayouts.slice(),this},t}(),qr=function(){function t(t){void 0===t&&(t=[]),this.attributes=t}return t.prototype.copy=function(t){return Zi(this.attributes,t.attributes,Or),this},t}(),Yr=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=Qi.PRIMARY),this.queue=t,this.type=e}return t.prototype.copy=function(t){return this.queue=t.queue,this.type=t.type,this},t}(),Kr=function(){function t(t){void 0===t&&(t=Yi.GRAPHICS),this.type=t}return t.prototype.copy=function(t){return this.type=t.type,this},t}(),Qr=function(){function t(t,e,n){void 0===t&&(t=Ki.OCCLUSION),void 0===e&&(e=32767),void 0===n&&(n=!0),this.type=t,this.maxQueryObjects=e,this.forceWait=n}return t.prototype.copy=function(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this},t}(),Jr=function(t,e,n,i,r,a,o,s){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=mi.NONE),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),this.name=t,this.size=e,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=a,this.hasStencil=o,this.isCompressed=s},Zr=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.bufferSize=t,this.textureSize=e}return t.prototype.copy=function(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this},t}(),$r=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.writeMask=t,this.compareMask=e,this.reference=n}return t.prototype.copy=function(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this},t}(),ta=function(){function t(t,e,n,i,r,a,o,s,c,l,u){void 0===t&&(t=new ur),void 0===e&&(e=new ir),void 0===n&&(n=new hr),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=new $r),void 0===u&&(u=new $r),this.viewport=t,this.scissor=e,this.blendConstant=n,this.lineWidth=i,this.depthBiasConstant=r,this.depthBiasClamp=a,this.depthBiasSlope=o,this.depthMinBounds=s,this.depthMaxBounds=c,this.stencilStatesFront=l,this.stencilStatesBack=u}return t.prototype.copy=function(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this},t}(),ea=function(){function t(e){this._objectType=ui.UNKNOWN,this._objectID=0,this._typedID=0,this._objectType=e,this._objectID=t._idTable[ui.UNKNOWN]++,this._typedID=t._idTable[e]++}return Q(t,[{key:"objectType",get:function(){return this._objectType}},{key:"objectID",get:function(){return this._objectID}},{key:"typedID",get:function(){return this._typedID}}]),t}();ea._idTable=Array(ui.COUNT).fill(65536),function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8",t.ATTR_BATCH_ID="a_batch_id",t.ATTR_BATCH_UV="a_batch_uv"}($i||($i={}));var na=Object.freeze([new Jr("UNKNOWN",0,0,mi.NONE,!1,!1,!1,!1),new Jr("A8",1,1,mi.UNORM,!0,!1,!1,!1),new Jr("L8",1,1,mi.UNORM,!1,!1,!1,!1),new Jr("LA8",1,2,mi.UNORM,!0,!1,!1,!1),new Jr("R8",1,1,mi.UNORM,!1,!1,!1,!1),new Jr("R8SN",1,1,mi.SNORM,!1,!1,!1,!1),new Jr("R8UI",1,1,mi.UINT,!1,!1,!1,!1),new Jr("R8I",1,1,mi.INT,!1,!1,!1,!1),new Jr("R16F",2,1,mi.FLOAT,!1,!1,!1,!1),new Jr("R16UI",2,1,mi.UINT,!1,!1,!1,!1),new Jr("R16I",2,1,mi.INT,!1,!1,!1,!1),new Jr("R32F",4,1,mi.FLOAT,!1,!1,!1,!1),new Jr("R32UI",4,1,mi.UINT,!1,!1,!1,!1),new Jr("R32I",4,1,mi.INT,!1,!1,!1,!1),new Jr("RG8",2,2,mi.UNORM,!1,!1,!1,!1),new Jr("RG8SN",2,2,mi.SNORM,!1,!1,!1,!1),new Jr("RG8UI",2,2,mi.UINT,!1,!1,!1,!1),new Jr("RG8I",2,2,mi.INT,!1,!1,!1,!1),new Jr("RG16F",4,2,mi.FLOAT,!1,!1,!1,!1),new Jr("RG16UI",4,2,mi.UINT,!1,!1,!1,!1),new Jr("RG16I",4,2,mi.INT,!1,!1,!1,!1),new Jr("RG32F",8,2,mi.FLOAT,!1,!1,!1,!1),new Jr("RG32UI",8,2,mi.UINT,!1,!1,!1,!1),new Jr("RG32I",8,2,mi.INT,!1,!1,!1,!1),new Jr("RGB8",3,3,mi.UNORM,!1,!1,!1,!1),new Jr("SRGB8",3,3,mi.UNORM,!1,!1,!1,!1),new Jr("RGB8SN",3,3,mi.SNORM,!1,!1,!1,!1),new Jr("RGB8UI",3,3,mi.UINT,!1,!1,!1,!1),new Jr("RGB8I",3,3,mi.INT,!1,!1,!1,!1),new Jr("RGB16F",6,3,mi.FLOAT,!1,!1,!1,!1),new Jr("RGB16UI",6,3,mi.UINT,!1,!1,!1,!1),new Jr("RGB16I",6,3,mi.INT,!1,!1,!1,!1),new Jr("RGB32F",12,3,mi.FLOAT,!1,!1,!1,!1),new Jr("RGB32UI",12,3,mi.UINT,!1,!1,!1,!1),new Jr("RGB32I",12,3,mi.INT,!1,!1,!1,!1),new Jr("RGBA8",4,4,mi.UNORM,!0,!1,!1,!1),new Jr("BGRA8",4,4,mi.UNORM,!0,!1,!1,!1),new Jr("SRGB8_A8",4,4,mi.UNORM,!0,!1,!1,!1),new Jr("RGBA8SN",4,4,mi.SNORM,!0,!1,!1,!1),new Jr("RGBA8UI",4,4,mi.UINT,!0,!1,!1,!1),new Jr("RGBA8I",4,4,mi.INT,!0,!1,!1,!1),new Jr("RGBA16F",8,4,mi.FLOAT,!0,!1,!1,!1),new Jr("RGBA16UI",8,4,mi.UINT,!0,!1,!1,!1),new Jr("RGBA16I",8,4,mi.INT,!0,!1,!1,!1),new Jr("RGBA32F",16,4,mi.FLOAT,!0,!1,!1,!1),new Jr("RGBA32UI",16,4,mi.UINT,!0,!1,!1,!1),new Jr("RGBA32I",16,4,mi.INT,!0,!1,!1,!1),new Jr("R5G6B5",2,3,mi.UNORM,!1,!1,!1,!1),new Jr("R11G11B10F",4,3,mi.FLOAT,!1,!1,!1,!1),new Jr("RGB5A1",2,4,mi.UNORM,!0,!1,!1,!1),new Jr("RGBA4",2,4,mi.UNORM,!0,!1,!1,!1),new Jr("RGB10A2",2,4,mi.UNORM,!0,!1,!1,!1),new Jr("RGB10A2UI",2,4,mi.UINT,!0,!1,!1,!1),new Jr("RGB9E5",2,4,mi.FLOAT,!0,!1,!1,!1),new Jr("DEPTH",4,1,mi.FLOAT,!1,!0,!1,!1),new Jr("DEPTH_STENCIL",5,2,mi.FLOAT,!1,!0,!0,!1),new Jr("BC1",1,3,mi.UNORM,!1,!1,!1,!0),new Jr("BC1_ALPHA",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC1_SRGB",1,3,mi.UNORM,!1,!1,!1,!0),new Jr("BC1_SRGB_ALPHA",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC2",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC2_SRGB",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC3",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC3_SRGB",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC4",1,1,mi.UNORM,!1,!1,!1,!0),new Jr("BC4_SNORM",1,1,mi.SNORM,!1,!1,!1,!0),new Jr("BC5",1,2,mi.UNORM,!1,!1,!1,!0),new Jr("BC5_SNORM",1,2,mi.SNORM,!1,!1,!1,!0),new Jr("BC6H_UF16",1,3,mi.UFLOAT,!1,!1,!1,!0),new Jr("BC6H_SF16",1,3,mi.FLOAT,!1,!1,!1,!0),new Jr("BC7",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("BC7_SRGB",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ETC_RGB8",1,3,mi.UNORM,!1,!1,!1,!0),new Jr("ETC2_RGB8",1,3,mi.UNORM,!1,!1,!1,!0),new Jr("ETC2_SRGB8",1,3,mi.UNORM,!1,!1,!1,!0),new Jr("ETC2_RGB8_A1",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ETC2_SRGB8_A1",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ETC2_RGBA8",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("ETC2_SRGB8_A8",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("EAC_R11",1,1,mi.UNORM,!1,!1,!1,!0),new Jr("EAC_R11SN",1,1,mi.SNORM,!1,!1,!1,!0),new Jr("EAC_RG11",2,2,mi.UNORM,!1,!1,!1,!0),new Jr("EAC_RG11SN",2,2,mi.SNORM,!1,!1,!1,!0),new Jr("PVRTC_RGB2",2,3,mi.UNORM,!1,!1,!1,!0),new Jr("PVRTC_RGBA2",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("PVRTC_RGB4",2,3,mi.UNORM,!1,!1,!1,!0),new Jr("PVRTC_RGBA4",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("PVRTC2_2BPP",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("PVRTC2_4BPP",2,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_4x4",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_5x4",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_5x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_6x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_6x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_8x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_8x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_8x8",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_10x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_10x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_10x8",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_10x10",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_12x10",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_RGBA_12x12",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_4x4",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_5x4",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_5x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_6x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_6x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_8x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_8x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_8x8",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_10x5",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_10x6",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_10x8",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_10x10",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_12x10",1,4,mi.UNORM,!0,!1,!1,!0),new Jr("ASTC_SRGBA_12x12",1,4,mi.UNORM,!0,!1,!1,!0)]),ia=qi.UNIFORM_BUFFER|qi.DYNAMIC_UNIFORM_BUFFER|qi.STORAGE_BUFFER|qi.DYNAMIC_STORAGE_BUFFER,ra=qi.SAMPLER_TEXTURE|qi.SAMPLER|qi.TEXTURE|qi.STORAGE_IMAGE|qi.INPUT_ATTACHMENT,aa=qi.DYNAMIC_STORAGE_BUFFER|qi.DYNAMIC_UNIFORM_BUFFER;function oa(t){return t>0&&0==(t&t-1)}function sa(t,e,n,i){if(!na[t].isCompressed)return e*n*i*na[t].size;switch(t){case pi.BC1:case pi.BC1_ALPHA:case pi.BC1_SRGB:case pi.BC1_SRGB_ALPHA:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case pi.BC2:case pi.BC2_SRGB:case pi.BC3:case pi.BC3_SRGB:case pi.BC4:case pi.BC4_SNORM:case pi.BC6H_SF16:case pi.BC6H_UF16:case pi.BC7:case pi.BC7_SRGB:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case pi.BC5:case pi.BC5_SNORM:return Math.ceil(e/4)*Math.ceil(n/4)*32*i;case pi.ETC_RGB8:case pi.ETC2_RGB8:case pi.ETC2_SRGB8:case pi.ETC2_RGB8_A1:case pi.EAC_R11:case pi.EAC_R11SN:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case pi.ETC2_RGBA8:case pi.ETC2_SRGB8_A1:case pi.EAC_RG11:case pi.EAC_RG11SN:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case pi.PVRTC_RGB2:case pi.PVRTC_RGBA2:case pi.PVRTC2_2BPP:return Math.ceil(Math.max(e,16)*Math.max(n,8)/4)*i;case pi.PVRTC_RGB4:case pi.PVRTC_RGBA4:case pi.PVRTC2_4BPP:return Math.ceil(Math.max(e,8)*Math.max(n,8)/2)*i;case pi.ASTC_RGBA_4X4:case pi.ASTC_SRGBA_4X4:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case pi.ASTC_RGBA_5X4:case pi.ASTC_SRGBA_5X4:return Math.ceil(e/5)*Math.ceil(n/4)*16*i;case pi.ASTC_RGBA_5X5:case pi.ASTC_SRGBA_5X5:return Math.ceil(e/5)*Math.ceil(n/5)*16*i;case pi.ASTC_RGBA_6X5:case pi.ASTC_SRGBA_6X5:return Math.ceil(e/6)*Math.ceil(n/5)*16*i;case pi.ASTC_RGBA_6X6:case pi.ASTC_SRGBA_6X6:return Math.ceil(e/6)*Math.ceil(n/6)*16*i;case pi.ASTC_RGBA_8X5:case pi.ASTC_SRGBA_8X5:return Math.ceil(e/8)*Math.ceil(n/5)*16*i;case pi.ASTC_RGBA_8X6:case pi.ASTC_SRGBA_8X6:return Math.ceil(e/8)*Math.ceil(n/6)*16*i;case pi.ASTC_RGBA_8X8:case pi.ASTC_SRGBA_8X8:return Math.ceil(e/8)*Math.ceil(n/8)*16*i;case pi.ASTC_RGBA_10X5:case pi.ASTC_SRGBA_10X5:return Math.ceil(e/10)*Math.ceil(n/5)*16*i;case pi.ASTC_RGBA_10X6:case pi.ASTC_SRGBA_10X6:return Math.ceil(e/10)*Math.ceil(n/6)*16*i;case pi.ASTC_RGBA_10X8:case pi.ASTC_SRGBA_10X8:return Math.ceil(e/10)*Math.ceil(n/8)*16*i;case pi.ASTC_RGBA_10X10:case pi.ASTC_SRGBA_10X10:return Math.ceil(e/10)*Math.ceil(n/10)*16*i;case pi.ASTC_RGBA_12X10:case pi.ASTC_SRGBA_12X10:return Math.ceil(e/12)*Math.ceil(n/10)*16*i;case pi.ASTC_RGBA_12X12:case pi.ASTC_SRGBA_12X12:return Math.ceil(e/12)*Math.ceil(n/12)*16*i;default:return 0}}function ca(t,e,n,i,r){for(var a=0,o=0;o<r;++o)a+=sa(t,e,n,i),e=Math.max(e>>1,1),n=Math.max(n>>1,1);return a}var la=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function ua(t){return la[t]||0}function ha(t){var e=t.size/t.count;switch(t.type){case mi.UNORM:case mi.UINT:switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case mi.SNORM:case mi.INT:switch(e){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case mi.FLOAT:return Float32Array}return Float32Array}var fa=Object.freeze({__proto__:null,get ObjectType(){return ui},get Status(){return hi},get API(){return fi},get SurfaceTransform(){return _i},get Feature(){return di},get Format(){return pi},get FormatType(){return mi},get Type(){return gi},get BufferUsageBit(){return vi},get BufferFlagBit(){return yi},get MemoryAccessBit(){return Si},get MemoryUsageBit(){return Ti},get TextureType(){return xi},get TextureUsageBit(){return Ei},get TextureFlagBit(){return Ai},get FormatFeatureBit(){return Ci},get SampleCount(){return bi},get VsyncMode(){return wi},get Filter(){return Ii},get Address(){return Pi},get ComparisonFunc(){return Ri},get StencilOp(){return Di},get BlendFactor(){return Oi},get BlendOp(){return Ni},get ColorMask(){return Mi},get ShaderStageFlagBit(){return Li},get LoadOp(){return Fi},get StoreOp(){return Bi},get AccessFlagBit(){return zi},get ResolveMode(){return Ui},get PipelineBindPoint(){return ki},get PrimitiveMode(){return Gi},get PolygonMode(){return Vi},get ShadeModel(){return Hi},get CullMode(){return Wi},get DynamicStateFlagBit(){return ji},get StencilFace(){return Xi},get DescriptorType(){return qi},get QueueType(){return Yi},get QueryType(){return Ki},get CommandBufferType(){return Qi},get ClearFlagBit(){return Ji},Size:tr,DeviceCaps:er,Offset:nr,Rect:ir,Extent:rr,TextureSubresLayers:ar,TextureSubresRange:or,TextureCopy:sr,TextureBlit:cr,BufferTextureCopy:lr,Viewport:ur,Color:hr,BindingMappingInfo:fr,SwapchainInfo:_r,DeviceInfo:dr,BufferInfo:pr,BufferViewInfo:mr,DrawInfo:gr,DispatchInfo:vr,IndirectBuffer:yr,TextureInfo:Sr,TextureViewInfo:Tr,SamplerInfo:xr,Uniform:Er,UniformBlock:Ar,UniformSamplerTexture:Cr,UniformSampler:br,UniformTexture:wr,UniformStorageImage:Ir,UniformStorageBuffer:Pr,UniformInputAttachment:Rr,ShaderStage:Dr,Attribute:Or,ShaderInfo:Nr,InputAssemblerInfo:Mr,ColorAttachment:Lr,DepthStencilAttachment:Fr,SubpassInfo:Br,SubpassDependency:zr,RenderPassInfo:Ur,GeneralBarrierInfo:kr,TextureBarrierInfo:Gr,FramebufferInfo:Vr,DescriptorSetLayoutBinding:Hr,DescriptorSetLayoutInfo:Wr,DescriptorSetInfo:jr,PipelineLayoutInfo:Xr,InputState:qr,CommandBufferInfo:Yr,QueueInfo:Kr,QueryPoolInfo:Qr,FormatInfo:Jr,MemoryStatus:Zr,DynamicStencilStates:$r,DynamicStates:ta,GFXObject:ea,get AttributeName(){return $i},FormatInfos:na,DESCRIPTOR_BUFFER_TYPE:ia,DESCRIPTOR_SAMPLER_TYPE:ra,DESCRIPTOR_DYNAMIC_TYPE:aa,DRAW_INFO_SIZE:28,IsPowerOf2:oa,FormatSize:sa,FormatSurfaceSize:ca,GetTypeSize:ua,getTypedArrayConstructor:ha}),_a=function(t){function e(){var e;return(e=t.call(this,ui.BUFFER)||this)._usage=vi.NONE,e._memUsage=Ti.NONE,e._size=0,e._stride=1,e._count=0,e._flags=yi.NONE,e._isBufferView=!1,e}return Z(e,t),Q(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),e}(ea),da=function(t){function e(){var e;return(e=t.call(this,ui.COMMAND_BUFFER)||this)._queue=null,e._type=Qi.PRIMARY,e._numDrawCalls=0,e._numInstances=0,e._numTris=0,e}return Z(e,t),Q(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(ea),pa=function(){function t(){this._gfxAPI=fi.UNKNOWN,this._renderer="",this._vendor="",this._features=new Array(di.COUNT),this._formatFeatures=new Array(pi.COUNT),this._queue=null,this._cmdBuff=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new Zr,this._caps=new er,this._bindingMappingInfo=new fr,this._samplers=new Map,this._generalBarrierss=new Map,this._textureBarriers=new Map}var e=t.prototype;return e.hasFeature=function(t){return this._features[t]},e.getFormatFeatures=function(t){return this._formatFeatures[t]},Q(t,[{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}}]),t}();pa.canvas=void 0;var ma=function(t){function e(){var e;return(e=t.call(this,ui.SWAPCHAIN)||this)._transform=_i.IDENTITY,e._colorTexture=null,e._depthStencilTexture=null,e}return Z(e,t),Q(e,[{key:"colorTexture",get:function(){return this._colorTexture}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"surfaceTransform",get:function(){return this._transform}},{key:"width",get:function(){return this._colorTexture.width}},{key:"height",get:function(){return this._colorTexture.height}}]),e}(ea),ga=function(t){function e(){var e;return(e=t.call(this,ui.FRAMEBUFFER)||this)._renderPass=null,e._colorTextures=[],e._depthStencilTexture=null,e}return Z(e,t),Q(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),e}(ea),va=String.prototype.charCodeAt;function ya(t){return this[t]}function Sa(t,e){for(var n=t.length,i=e^n,r=0,a="string"==typeof t?va:ya;n>=4;){var o=255&a.call(t,r)|(255&a.call(t,++r))<<8|(255&a.call(t,++r))<<16|(255&a.call(t,++r))<<24;o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&a.call(t,r+2))<<16;case 2:i^=(255&a.call(t,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&a.call(t,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var Ta=function(t){function e(){var e;return(e=t.call(this,ui.INPUT_ASSEMBLER)||this)._attributes=[],e._attributesHash=0,e._vertexBuffers=[],e._indexBuffer=null,e._indirectBuffer=null,e._drawInfo=new gr,e}Z(e,t);var n=e.prototype;return n.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this._vertexBuffers.length?this._vertexBuffers[t]:null},n.computeAttributesHash=function(){for(var t="attrs",e=0;e<this.attributes.length;++e){var n=this.attributes[e];t+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return Sa(t,666)},Q(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._drawInfo.vertexCount},set:function(t){this._drawInfo.vertexCount=t}},{key:"firstVertex",get:function(){return this._drawInfo.firstVertex},set:function(t){this._drawInfo.firstVertex=t}},{key:"indexCount",get:function(){return this._drawInfo.indexCount},set:function(t){this._drawInfo.indexCount=t}},{key:"firstIndex",get:function(){return this._drawInfo.firstIndex},set:function(t){this._drawInfo.firstIndex=t}},{key:"vertexOffset",get:function(){return this._drawInfo.vertexOffset},set:function(t){this._drawInfo.vertexOffset=t}},{key:"instanceCount",get:function(){return this._drawInfo.instanceCount},set:function(t){this._drawInfo.instanceCount=t}},{key:"firstInstance",get:function(){return this._drawInfo.firstInstance},set:function(t){this._drawInfo.firstInstance=t}},{key:"drawInfo",get:function(){return this._drawInfo}}]),e}(ea),xa=function(t){function e(){var e;return(e=t.call(this,ui.DESCRIPTOR_SET)||this)._layout=null,e._buffers=[],e._textures=[],e._samplers=[],e._isDirty=!1,e}Z(e,t);var n=e.prototype;return n.bindBuffer=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&ia){var a=this._layout.descriptorIndices[t];this._buffers[a+n]!==e&&(this._buffers[a+n]=e,this._isDirty=!0)}},n.bindSampler=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&ra){var a=this._layout.descriptorIndices[t];this._samplers[a+n]!==e&&(this._samplers[a+n]=e,this._isDirty=!0)}},n.bindTexture=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&ra){var a=this._layout.descriptorIndices[t];this._textures[a+n]!==e&&(this._textures[a+n]=e,this._isDirty=!0)}},n.getBuffer=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._buffers[n+e]},n.getSampler=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._samplers[n+e]},n.getTexture=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._textures[n+e]},Q(e,[{key:"layout",get:function(){return this._layout}}]),e}(ea),Ea=function(t){function e(){var e;return(e=t.call(this,ui.DESCRIPTOR_SET_LAYOUT)||this)._bindings=[],e._bindingIndices=[],e._descriptorIndices=[],e}return Z(e,t),Q(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(ea),Aa=function(t){function e(){var e;return(e=t.call(this,ui.PIPELINE_LAYOUT)||this)._setLayouts=[],e}return Z(e,t),Q(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(ea),Ca=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h){void 0===t&&(t=!1),void 0===e&&(e=Vi.FILL),void 0===n&&(n=Hi.GOURAND),void 0===i&&(i=Wi.BACK),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=t,this.polygonMode=e,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=a,this.depthBias=o,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var e=t.prototype;return e.reset=function(){this.isDiscard=!1,this.polygonMode=Vi.FILL,this.shadeModel=Hi.GOURAND,this.cullMode=Wi.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),ba=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p,m,g,v){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=Ri.LESS),void 0===i&&(i=!1),void 0===r&&(r=Ri.ALWAYS),void 0===a&&(a=65535),void 0===o&&(o=65535),void 0===s&&(s=Di.KEEP),void 0===c&&(c=Di.KEEP),void 0===l&&(l=Di.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===f&&(f=Ri.ALWAYS),void 0===_&&(_=65535),void 0===d&&(d=65535),void 0===p&&(p=Di.KEEP),void 0===m&&(m=Di.KEEP),void 0===g&&(g=Di.KEEP),void 0===v&&(v=1),this.depthTest=t,this.depthWrite=e,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=a,this.stencilWriteMaskFront=o,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=f,this.stencilReadMaskBack=_,this.stencilWriteMaskBack=d,this.stencilFailOpBack=p,this.stencilZFailOpBack=m,this.stencilPassOpBack=g,this.stencilRefBack=v}var e=t.prototype;return e.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Ri.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Ri.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Di.KEEP,this.stencilZFailOpFront=Di.KEEP,this.stencilPassOpFront=Di.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Ri.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Di.KEEP,this.stencilZFailOpBack=Di.KEEP,this.stencilPassOpBack=Di.KEEP,this.stencilRefBack=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),wa=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=!1),void 0===e&&(e=Oi.ONE),void 0===n&&(n=Oi.ZERO),void 0===i&&(i=Ni.ADD),void 0===r&&(r=Oi.ONE),void 0===a&&(a=Oi.ZERO),void 0===o&&(o=Ni.ADD),void 0===s&&(s=Mi.ALL),this.blend=t,this.blendSrc=e,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=a,this.blendAlphaEq=o,this.blendColorMask=s}var e=t.prototype;return e.reset=function(){this.blend=!1,this.blendSrc=Oi.ONE,this.blendDst=Oi.ZERO,this.blendEq=Ni.ADD,this.blendSrcAlpha=Oi.ONE,this.blendDstAlpha=Oi.ZERO,this.blendAlphaEq=Ni.ADD,this.blendColorMask=Mi.ALL},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},t}(),Ia=function(){function t(t,e,n,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n=new hr),void 0===i&&(i=[new wa]),this.isA2C=t,this.isIndepend=e,this.blendColor=n,this.targets=i}var e=t.prototype;return e.setTarget=function(t,e){var n=this.targets[t];n||(n=this.targets[t]=new wa),Object.assign(n,e)},e.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),Pa=function(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=new qr),void 0===r&&(r=new Ca),void 0===a&&(a=new ba),void 0===o&&(o=new Ia),void 0===s&&(s=Gi.TRIANGLE_LIST),void 0===c&&(c=ji.NONE),void 0===l&&(l=ki.GRAPHICS),this.shader=t,this.pipelineLayout=e,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=a,this.blendState=o,this.primitive=s,this.dynamicStates=c,this.bindPoint=l},Ra=function(t){function e(){var e;return(e=t.call(this,ui.PIPELINE_STATE)||this)._shader=null,e._pipelineLayout=null,e._primitive=Gi.TRIANGLE_LIST,e._is=null,e._rs=new Ca,e._dss=new ba,e._bs=new Ia,e._dynamicStates=ji.NONE,e._renderPass=null,e}return Z(e,t),Q(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(ea),Da=function(t){function e(){var e;return(e=t.call(this,ui.QUEUE)||this)._type=Yi.GRAPHICS,e}return Z(e,t),Q(e,[{key:"type",get:function(){return this._type}}]),e}(ea),Oa=function(t){function e(){var e;return(e=t.call(this,ui.RENDER_PASS)||this)._colorInfos=[],e._depthStencilInfo=null,e._subpasses=[],e._hash=0,e}return Z(e,t),e.prototype.computeHash=function(){var t="";if(this._subpasses.length)for(var e=0;e<this._subpasses.length;++e){var n=this._subpasses[e];if(n.inputs.length){t+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];t+=","+r.format+","+r.sampleCount}}if(n.colors.length){t+="ca";for(var a=0;a<n.inputs.length;++a){var o=this._colorInfos[n.inputs[a]];t+=","+o.format+","+o.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];t+="ds,"+s.format+","+s.sampleCount}}else{t+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];t+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(t+="ds,"+u.format+","+u.sampleCount)}return Sa(t,666)},Q(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),e}(ea),Na=function(t){function e(e,n){var i;return(i=t.call(this,ui.SAMPLER)||this)._info=new xr,i._hash=0,i._info.copy(e),i._hash=n,i}return Z(e,t),e.computeHash=function(t){var e=t.minFilter;return e|=t.magFilter<<2,e|=t.mipFilter<<4,e|=t.addressU<<6,e|=t.addressV<<8,e|=t.addressW<<10,(e|=t.maxAnisotropy<<12)|t.cmpFunc<<16},e.unpackFromHash=function(t){var e=new xr;return e.minFilter=(3&t)>>0,e.magFilter=(3&t)>>2,e.mipFilter=(3&t)>>4,e.addressU=(3&t)>>6,e.addressV=(3&t)>>8,e.addressW=(3&t)>>10,e.maxAnisotropy=(15&t)>>12,e.cmpFunc=(7&t)>>16,e},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ea),Ma=function(t){function e(){var e;return(e=t.call(this,ui.SHADER)||this)._name="",e._stages=[],e._attributes=[],e._blocks=[],e._samplers=[],e}return Z(e,t),Q(e,[{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),e}(ea),La=function(t){function e(){var e;return(e=t.call(this,ui.TEXTURE)||this)._info=new Sr,e._viewInfo=new Tr,e._isPowerOf2=!1,e._isTextureView=!1,e._size=0,e}return Z(e,t),e.getLevelCount=function(t,e){return Math.floor(Math.log2(Math.max(t,e)))},Q(e,[{key:"type",get:function(){return this._info.type}},{key:"usage",get:function(){return this._info.usage}},{key:"format",get:function(){return this._info.format}},{key:"width",get:function(){return this._info.width}},{key:"height",get:function(){return this._info.height}},{key:"depth",get:function(){return this._info.depth}},{key:"layerCount",get:function(){return this._info.layerCount}},{key:"levelCount",get:function(){return this._info.levelCount}},{key:"samples",get:function(){return this._info.samples}},{key:"flags",get:function(){return this._info.flags}},{key:"size",get:function(){return this._size}},{key:"info",get:function(){return this._info}},{key:"viewInfo",get:function(){return this._viewInfo}},{key:"isTextureView",get:function(){return this._isTextureView}}]),e}(ea),Fa=function(t){function e(e,n){var i;return(i=t.call(this,ui.GLOBAL_BARRIER)||this)._info=new kr,i._hash=0,i._info.copy(e),i._hash=n,i}return Z(e,t),e.computeHash=function(t){return Sa(t.prevAccesses+" "+t.nextAccesses,666)},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ea),Ba=function(t){function e(e,n){var i;return(i=t.call(this,ui.TEXTURE_BARRIER)||this)._info=new Gr,i._hash=0,i._info.copy(e),i._hash=n,i}return Z(e,t),e.computeHash=function(t){var e=t.prevAccesses+" "+t.nextAccesses;return e+=t.discardContents,e+=t.srcQueue?t.srcQueue.type:0,Sa(e+=t.dstQueue?t.dstQueue.type:0,666)},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ea),za={Device:pa,Swapchain:ma,Buffer:_a,Texture:La,Sampler:Na,Shader:Ma,InputAssembler:Ta,RenderPass:Oa,Framebuffer:ga,DescriptorSet:xa,DescriptorSetLayout:Ea,PipelineLayout:Aa,PipelineState:Ra,CommandBuffer:da,Queue:Da,GeneralBarrier:Fa,TextureBarrier:Ba,RasterizerState:Ca,BlendState:Ia,BlendTarget:wa,DepthStencilState:ba,PipelineStateInfo:Pa};Object.assign(za,fa),l.gfx=za;var Ua={GFXDevice:!0,GFXBuffer:!0,GFXTexture:!0,GFXSampler:!0,GFXShader:!0,GFXInputAssembler:!0,GFXRenderPass:!0,GFXFramebuffer:!0,GFXPipelineState:!0,GFXCommandBuffer:!0,GFXQueue:!0,GFXObjectType:!0,GFXObject:!1,GFXAttributeName:!0,GFXType:!0,GFXFormat:!0,GFXBufferUsageBit:!0,GFXMemoryUsageBit:!0,GFXBufferFlagBit:!0,GFXBufferAccessBit:"MemoryAccessBit",GFXPrimitiveMode:!0,GFXPolygonMode:!0,GFXShadeModel:!0,GFXCullMode:!0,GFXComparisonFunc:!0,GFXStencilOp:!0,GFXBlendOp:!0,GFXBlendFactor:!0,GFXColorMask:!0,GFXFilter:!0,GFXAddress:!0,GFXTextureType:!0,GFXTextureUsageBit:!0,GFXSampleCount:!0,GFXTextureFlagBit:!0,GFXShaderStageFlagBit:!0,GFXDescriptorType:!0,GFXCommandBufferType:!0,GFXLoadOp:!0,GFXStoreOp:!0,GFXPipelineBindPoint:!0,GFXDynamicStateFlagBit:!0,GFXStencilFace:!0,GFXQueueType:!0,GFXRect:!0,GFXViewport:!0,GFXColor:!0,GFXClearFlag:!0,GFXOffset:!0,GFXExtent:!0,GFXTextureSubres:"TextureSubresLayers",GFXTextureCopy:!0,GFXBufferTextureCopy:!0,GFXFormatType:!0,GFXFormatInfo:!0,GFXMemoryStatus:!0,GFXFormatInfos:!0,GFXFormatSize:!0,GFXFormatSurfaceSize:!0,GFXGetTypeSize:!0,getTypedArrayConstructor:!1};for(var ka in Ua){var Ga=Ua[ka];!0===Ga?Ga=ka.slice(3):!1===Ga&&(Ga=ka),U(l,"cc",[{name:ka,newName:Ga,target:l.gfx,targetName:"cc.gfx"}])}k(l,"cc",[{name:"GFX_MAX_VERTEX_ATTRIBUTES"},{name:"GFX_MAX_TEXTURE_UNITS"},{name:"GFX_MAX_ATTACHMENTS"},{name:"GFX_MAX_BUFFER_BINDINGS"},{name:"GFXTextureLayout"}]),k(di,"Feature",[{name:"COLOR_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.RENDER_TARGET;"},{name:"COLOR_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.RENDER_TARGET;"},{name:"TEXTURE_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R32F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R16F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"TEXTURE_HALF_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"FORMAT_R11G11B10F",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R11G11B10F) !== FormatFeatureBit.NONE;"},{name:"FORMAT_SRGB",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.SRGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC1",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC2",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC2_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_DXT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.BC1) !== FormatFeatureBit.NONE;"},{name:"FORMAT_PVRTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.PVRTC_RGB2) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ASTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ASTC_RGBA_4x4) !== FormatFeatureBit.NONE;"},{name:"FORMAT_RGB8",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.RGB8) !== FormatFeatureBit.NONE;"}]),k(Lr.prototype,"ColorAttachment",[{name:"beginAccesses",suggest:"Please assign to ColorAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to ColorAttachment.barrier instead"}]),k(Fr.prototype,"DepthStencilAttachment",[{name:"beginAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"}]),U(pa.prototype,"Device",[{name:"getGlobalBarrier",newName:"getGeneralBarrier"}]),t("gfx",Object.freeze({__proto__:null,DescriptorSet:xa,Buffer:_a,CommandBuffer:da,get ObjectType(){return ui},get Status(){return hi},get API(){return fi},get SurfaceTransform(){return _i},get Feature(){return di},get Format(){return pi},get FormatType(){return mi},get Type(){return gi},get BufferUsageBit(){return vi},get BufferFlagBit(){return yi},get MemoryAccessBit(){return Si},get MemoryUsageBit(){return Ti},get TextureType(){return xi},get TextureUsageBit(){return Ei},get TextureFlagBit(){return Ai},get FormatFeatureBit(){return Ci},get SampleCount(){return bi},get VsyncMode(){return wi},get Filter(){return Ii},get Address(){return Pi},get ComparisonFunc(){return Ri},get StencilOp(){return Di},get BlendFactor(){return Oi},get BlendOp(){return Ni},get ColorMask(){return Mi},get ShaderStageFlagBit(){return Li},get LoadOp(){return Fi},get StoreOp(){return Bi},get AccessFlagBit(){return zi},get ResolveMode(){return Ui},get PipelineBindPoint(){return ki},get PrimitiveMode(){return Gi},get PolygonMode(){return Vi},get ShadeModel(){return Hi},get CullMode(){return Wi},get DynamicStateFlagBit(){return ji},get StencilFace(){return Xi},get DescriptorType(){return qi},get QueueType(){return Yi},get QueryType(){return Ki},get CommandBufferType(){return Qi},get ClearFlagBit(){return Ji},Size:tr,DeviceCaps:er,Offset:nr,Rect:ir,Extent:rr,TextureSubresLayers:ar,TextureSubresRange:or,TextureCopy:sr,TextureBlit:cr,BufferTextureCopy:lr,Viewport:ur,Color:hr,BindingMappingInfo:fr,SwapchainInfo:_r,DeviceInfo:dr,BufferInfo:pr,BufferViewInfo:mr,DrawInfo:gr,DispatchInfo:vr,IndirectBuffer:yr,TextureInfo:Sr,TextureViewInfo:Tr,SamplerInfo:xr,Uniform:Er,UniformBlock:Ar,UniformSamplerTexture:Cr,UniformSampler:br,UniformTexture:wr,UniformStorageImage:Ir,UniformStorageBuffer:Pr,UniformInputAttachment:Rr,ShaderStage:Dr,Attribute:Or,ShaderInfo:Nr,InputAssemblerInfo:Mr,ColorAttachment:Lr,DepthStencilAttachment:Fr,SubpassInfo:Br,SubpassDependency:zr,RenderPassInfo:Ur,GeneralBarrierInfo:kr,TextureBarrierInfo:Gr,FramebufferInfo:Vr,DescriptorSetLayoutBinding:Hr,DescriptorSetLayoutInfo:Wr,DescriptorSetInfo:jr,PipelineLayoutInfo:Xr,InputState:qr,CommandBufferInfo:Yr,QueueInfo:Kr,QueryPoolInfo:Qr,FormatInfo:Jr,MemoryStatus:Zr,DynamicStencilStates:$r,DynamicStates:ta,GFXObject:ea,get AttributeName(){return $i},FormatInfos:na,DESCRIPTOR_BUFFER_TYPE:ia,DESCRIPTOR_SAMPLER_TYPE:ra,DESCRIPTOR_DYNAMIC_TYPE:aa,DRAW_INFO_SIZE:28,IsPowerOf2:oa,FormatSize:sa,FormatSurfaceSize:ca,GetTypeSize:ua,getTypedArrayConstructor:ha,Device:pa,Swapchain:ma,Framebuffer:ga,InputAssembler:Ta,DescriptorSetLayout:Ea,PipelineLayout:Aa,RasterizerState:Ca,DepthStencilState:ba,BlendTarget:wa,BlendState:Ia,PipelineStateInfo:Pa,PipelineState:Ra,Queue:Da,RenderPass:Oa,Sampler:Na,Shader:Ma,Texture:La,GeneralBarrier:Fa,TextureBarrier:Ba}));var Va=new Dn,Ha=new Dn,Wa=new Dn,ja=new Dn,Xa=new Dn,qa=new Dn,Ya=new Array(3),Ka=new Array(3);function Qa(t,e){return Dn.dot(e.n,t)-e.d}function Ja(t,e,n){return Dn.copy(t,e),Dn.subtract(Xa,n.center,n.halfExtents),Dn.add(qa,n.center,n.halfExtents),t.x=t.x<Xa.x?Xa.x:t.x,t.y=t.y<Xa.y?Xa.y:t.y,t.z=t.z<Xa.z?Xa.z:t.z,t.x=t.x>qa.x?qa.x:t.x,t.y=t.y>qa.y?qa.y:t.y,t.z=t.z>qa.z?qa.z:t.z,t}function Za(t,e,n){Dn.set(Va,n.orientation.m00,n.orientation.m01,n.orientation.m02),Dn.set(Ha,n.orientation.m03,n.orientation.m04,n.orientation.m05),Dn.set(Wa,n.orientation.m06,n.orientation.m07,n.orientation.m08),Ya[0]=Va,Ya[1]=Ha,Ya[2]=Wa,Ka[0]=n.halfExtents.x,Ka[1]=n.halfExtents.y,Ka[2]=n.halfExtents.z,Dn.subtract(ja,e,n.center),Dn.set(t,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Dn.dot(ja,Ya[i]);r>Ka[i]&&(r=Ka[i]),r<-Ka[i]&&(r=-Ka[i]),t.x+=r*Ya[i].x,t.y+=r*Ya[i].y,t.z+=r*Ya[i].z}return t}var $a=Object.freeze({__proto__:null,point_plane:Qa,pt_point_plane:function(t,e,n){var i=Qa(e,n);return Dn.subtract(t,e,Dn.multiplyScalar(t,n.n,i))},pt_point_aabb:Ja,pt_point_obb:Za,pt_point_line:function(t,e,n,i){Dn.subtract(Va,n,i);var r=Va,a=Dn.lengthSqr(r);if(0==a)Dn.copy(t,n);else{Dn.subtract(Va,e,n);var o=Dn.dot(Va,r)/a;o<0?Dn.copy(t,n):o>1?Dn.copy(t,i):Dn.scaleAndAdd(t,n,r,o)}}}),to={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},eo=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=to.SHAPE_LINE,this.s=new Dn(t,e,n),this.e=new Dn(i,r,a)}return t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return Dn.copy(t.s,e.s),Dn.copy(t.e,e.e),t},t.fromPoints=function(t,e,n){return Dn.copy(t.s,e),Dn.copy(t.e,n),t},t.set=function(t,e,n,i,r,a,o){return t.s.x=e,t.s.y=n,t.s.z=i,t.e.x=r,t.e.y=a,t.e.z=o,t},t.len=function(t){return Dn.distance(t.s,t.e)},t.prototype.length=function(){return Dn.distance(this.s,this.e)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),no=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=to.SHAPE_RAY,this.o=new Dn(t,e,n),this.d=new Dn(i,r,a)}return t.create=function(e,n,i,r,a,o){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return Dn.copy(t.o,e.o),Dn.copy(t.d,e.d),t},t.fromPoints=function(t,e,n){return Dn.copy(t.o,e),Dn.normalize(t.d,Dn.subtract(t.d,n,e)),t},t.set=function(t,e,n,i,r,a,o){return t.o.x=e,t.o.y=n,t.o.z=i,t.d.x=r,t.d.y=a,t.d.z=o,t},t.prototype.computeHit=function(t,e){Dn.normalize(t,this.d),Dn.scaleAndAdd(t,this.o,t,e)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),io=new Dn,ro=new Dn,ao=new Dn,oo=new Dn;function so(t){return Math.max(Math.max(t.x,t.y),t.z)}var co,lo=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Dn(0,0,0),this._radius=0,this._type=void 0,this._type=to.SHAPE_SPHERE,this._center=new Dn(t,e,n),this._radius=i}t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return Dn.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,n){return Dn.multiplyScalar(t.center,Dn.add(io,e,n),.5),t.radius=.5*Dn.subtract(io,n,e).length(),t},t.set=function(t,e,n,i,r){return t.center.x=e,t.center.y=n,t.center.z=i,t.radius=r,t};var e=t.prototype;return e.destroy=function(){},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){Dn.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Dn.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,n,i,r){Dn.transformMat4(r.center,this.center,t),r.radius=this.radius*so(i)},e.translateAndRotate=function(t,e,n){Dn.transformMat4(n.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*so(t)},e.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),Dn.subtract(ro,t,this.center);var e=ro.length();if(e>this.radius){var n=.5*(e-this.radius);this.radius+=n,Dn.multiplyScalar(ro,ro,n/e),Dn.add(this.center,this.center,ro)}},e.mergePoints=function(t){var e=t.length;if(!(e<1)){this.radius=-1;for(var n=0;n<e;n++)this.mergePoint(t[n])}},e.mergeAABB=function(t){t.getBoundary(ao,oo),this.mergePoint(ao),this.mergePoint(oo)},Q(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t}},{key:"type",get:function(){return this._type}}]),t}(),uo=function(){function t(t,e,n,i,r,a,o,s,c){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=to.SHAPE_TRIANGLE,this.a=new Dn(t,e,n),this.b=new Dn(i,r,a),this.c=new Dn(o,s,c)}return t.create=function(e,n,i,r,a,o,s,c,l){return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new t(e,n,i,r,a,o,s,c,l)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return Dn.copy(t.a,e.a),Dn.copy(t.b,e.b),Dn.copy(t.c,e.c),t},t.fromPoints=function(t,e,n,i){return Dn.copy(t.a,e),Dn.copy(t.b,n),Dn.copy(t.c,i),t},t.set=function(t,e,n,i,r,a,o,s,c,l){return t.a.x=e,t.a.y=n,t.a.z=i,t.b.x=r,t.b.y=a,t.b.z=o,t.c.x=s,t.c.y=c,t.c.z=l,t},Q(t,[{key:"type",get:function(){return this._type}}]),t}();!function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(co||(co={}));var ho,fo,_o,po,mo,go,vo,yo,So=(ho=new Dn(0,0,0),function(t,e){var n=Dn.dot(t.d,e.n);if(Math.abs(n)<Number.EPSILON)return 0;Dn.multiplyScalar(ho,e.n,e.d);var i=Dn.dot(Dn.subtract(ho,ho,t.o),e.n)/n;return i<0?0:i}),To=(fo=new Dn(0,0,0),_o=new Dn(0,0,0),po=new Dn(0,0,0),mo=new Dn(0,0,0),go=new Dn(0,0,0),function(t,e,n){Dn.subtract(fo,e.b,e.a),Dn.subtract(_o,e.c,e.a),Dn.cross(po,t.d,_o);var i=Dn.dot(fo,po);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Dn.subtract(mo,t.o,e.a);var a=Dn.dot(mo,po)*r;if(a<0||a>1)return 0;Dn.cross(go,mo,fo);var o=Dn.dot(t.d,go)*r;if(o<0||a+o>1)return 0;var s=Dn.dot(_o,go)*r;return s<0?0:s}),xo=function(){var t=new Dn(0,0,0);return function(e,n){var i=n.radius,r=n.center,a=e.o,o=e.d,s=i*i;Dn.subtract(t,r,a);var c=t.lengthSqr(),l=Dn.dot(t,o),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),f=c<s?l+h:l-h;return f<0?0:f}}(),Eo=(vo=new Dn,yo=new Dn,function(t,e){return Dn.subtract(vo,e.center,e.halfExtents),Dn.add(yo,e.center,e.halfExtents),Ao(t,vo,yo)});function Ao(t,e,n){var i=t.o,r=t.d,a=1/r.x,o=1/r.y,s=1/r.z,c=(e.x-i.x)*a,l=(n.x-i.x)*a,u=(e.y-i.y)*o,h=(n.y-i.y)*o,f=(e.z-i.z)*s,_=(n.z-i.z)*s,d=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(f,_)),p=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(f,_));return p<0||d>p?0:d>0?d:p}var Co,bo,wo,Io,Po=function(){var t=new Dn,e=new Dn,n=new Dn,i=new Dn,r=new Dn,a=new Dn,o=new Dn,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,f){s[0]=f.halfExtents.x,s[1]=f.halfExtents.y,s[2]=f.halfExtents.z,t=f.center,e=h.o,n=h.d,Dn.set(i,f.orientation.m00,f.orientation.m01,f.orientation.m02),Dn.set(r,f.orientation.m03,f.orientation.m04,f.orientation.m05),Dn.set(a,f.orientation.m06,f.orientation.m07,f.orientation.m08),Dn.subtract(o,t,e),c[0]=Dn.dot(i,n),c[1]=Dn.dot(r,n),c[2]=Dn.dot(a,n),l[0]=Dn.dot(i,o),l[1]=Dn.dot(r,o),l[2]=Dn.dot(a,o);for(var _=0;_<3;++_){if(0===c[_]){if(-l[_]-s[_]>0||-l[_]+s[_]<0)return 0;c[_]=1e-7}u[2*_+0]=(l[_]+s[_])/c[_],u[2*_+1]=(l[_]-s[_])/c[_]}var d=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),p=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return p<0||d>p?0:d>0?d:p}}(),Ro=function(){var t=new Dn,e=new Dn,n=new Dn,i=new Dn,r=new Dn,a=new Dn,o=new Dn,s=new lo;return function(c,l){var u=l.radius*l.radius,h=Dn.normalize(t,c.d),f=l.ellipseCenter0,_=l.ellipseCenter1,d=Dn.subtract(e,_,f);if(d.equals(Dn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),ds.raySphere(c,s);var p=c.o,m=Dn.subtract(n,p,f),g=Dn.cross(i,h,d),v=g.lengthSqr();if(0===v){s.radius=l.radius;var y=Dn.subtract(r,_,p);return m.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),ds.raySphere(c,s)}var S=Dn.cross(r,m,d),T=d.lengthSqr(),x=2*Dn.dot(g,S),E=x*x-4*v*(S.lengthSqr()-u*T);if(E<0)return 0;var A=(-x-Math.sqrt(E))/(2*v);if(A<0){s.radius=l.radius;var C=Dn.subtract(a,_,p);return m.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),ds.raySphere(c,s)}var b=Dn.scaleAndAdd(a,c.o,h,A),w=Dn.subtract(o,b,f),I=Dn.dot(w,d)/T;return I>=0&&I<=1?A:I<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),ds.raySphere(c,s)):I>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),ds.raySphere(c,s)):0}}(),Do=(Co=uo.create(),bo={distance:1/0,doubleSided:!1,mode:co.ANY},wo=0,Io=function(t,e,n,i,r,a){t===co.CLOSEST?(wo>e||0===wo)&&(wo=e,a&&(0===a.length?a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(a[0].distance=e,a[0].vertexIndex0=n/3,a[0].vertexIndex1=i/3,a[0].vertexIndex2=r/3))):(wo=e,a&&a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(t,e,n){if(wo=0,0===e.geometricInfo.positions.length)return wo;var i=void 0===n?bo:n;if(Ao(t,e.geometricInfo.boundingBox.min,e.geometricInfo.boundingBox.max)){var r=e.primitiveMode,a=e.geometricInfo;!function(t,e,n,i,r){if(n===Gi.TRIANGLE_LIST)for(var a=e.length,o=0;o<a;o+=3){var s=3*e[o],c=3*e[o+1],l=3*e[o+2];Dn.set(Co.a,t[s],t[s+1],t[s+2]),Dn.set(Co.b,t[c],t[c+1],t[c+2]),Dn.set(Co.c,t[l],t[l+1],t[l+2]);var u=ds.rayTriangle(i,Co,r.doubleSided);if(!(0===u||u>r.distance)&&(Io(r.mode,u,s,c,l,r.result),r.mode===co.ANY))return u}else if(n===Gi.TRIANGLE_STRIP)for(var h=e.length-2,f=0,_=0;_<h;_+=1){var d=3*e[_-f],p=3*e[_+f+1],m=3*e[_+2];Dn.set(Co.a,t[d],t[d+1],t[d+2]),Dn.set(Co.b,t[p],t[p+1],t[p+2]),Dn.set(Co.c,t[m],t[m+1],t[m+2]),f=~f;var g=ds.rayTriangle(i,Co,r.doubleSided);if(!(0===g||g>r.distance)&&(Io(r.mode,g,d,p,m,r.result),r.mode===co.ANY))return g}else if(n===Gi.TRIANGLE_FAN){var v=e.length-1,y=3*e[0];Dn.set(Co.a,t[y],t[y+1],t[y+2]);for(var S=1;S<v;S+=1){var T=3*e[S],x=3*e[S+1];Dn.set(Co.b,t[T],t[T+1],t[T+2]),Dn.set(Co.c,t[x],t[x+1],t[x+2]);var E=ds.rayTriangle(i,Co,r.doubleSided);if(!(0===E||E>r.distance)&&(Io(r.mode,E,y,T,x,r.result),r.mode===co.ANY))return E}}}(a.positions,a.indices,r,t,i)}return wo}),Oo=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:co.ANY};return function(n,i,r){t=0;var a=void 0===r?e:r,o=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!Ao(n,s,c))return t;for(var l=0;l<o;l++){var u=i.renderingSubMeshes[l],h=Do(n,u,a);if(h)if(a.mode===co.CLOSEST)(0===t||t>h)&&(t=h,a.subIndices&&(a.subIndices[0]=l));else if(t=h,a.subIndices&&a.subIndices.push(l),a.mode===co.ANY)return h}return t&&a.mode===co.CLOSEST&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}(),No=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:co.ANY},n=new no,i=new Xn;return function(r,a,o){t=0;var s=void 0===o?e:o,c=a.worldBounds;if(c&&!Eo(r,c))return t;no.copy(n,r),a.node&&(Xn.invert(i,a.node.getWorldMatrix(i)),Dn.transformMat4(n.o,r.o,i),Dn.transformMat4Normal(n.d,r.d,i));for(var l=a.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,f=Do(n,h,s);if(f)if(s.mode===co.CLOSEST)(0===t||t>f)&&(t=f,s.subIndices&&(s.subIndices[0]=u));else if(t=f,s.subIndices&&s.subIndices.push(u),s.mode===co.ANY)return f}return t&&s.mode===co.CLOSEST&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),Mo=function(){var t=new Dn(0,0,0);return function(e,n){Dn.subtract(t,e.e,e.s);var i=(n.d-Dn.dot(e.s,n.n))/Dn.dot(t,n.n);return i<0||i>1?0:i}}(),Lo=function(){var t=new Dn(0,0,0),e=new Dn(0,0,0),n=new Dn(0,0,0),i=new Dn(0,0,0),r=new Dn(0,0,0),a=new Dn(0,0,0);return function(o,s,c){Dn.subtract(t,s.b,s.a),Dn.subtract(e,s.c,s.a),Dn.subtract(n,o.s,o.e),Dn.cross(r,t,e);var l=Dn.dot(n,r);if(l<=0)return 0;Dn.subtract(i,o.s,s.a);var u=Dn.dot(i,r);if(u<0||u>l)return 0;Dn.cross(a,n,i);var h=Dn.dot(e,a);if(h<0||h>l)return 0;var f=-Dn.dot(t,a);if(f<0||h+f>l)return 0;if(c){var _=1/l,d=1-(h*=_)-(f*=_);Dn.set(c,s.a.x*d+s.b.x*h+s.c.x*f,s.a.y*d+s.b.y*h+s.c.y*f,s.a.z*d+s.b.z*h+s.c.z*f)}return 1}}(),Fo=new no;function Bo(t,e){Fo.o.set(t.s),Dn.subtract(Fo.d,t.e,t.s),Fo.d.normalize();var n=Eo(Fo,e);return n<=t.length()?n:0}function zo(t,e){Fo.o.set(t.s),Dn.subtract(Fo.d,t.e,t.s),Fo.d.normalize();var n=Po(Fo,e);return n<=t.length()?n:0}function Uo(t,e){Fo.o.set(t.s),Dn.subtract(Fo.d,t.e,t.s),Fo.d.normalize();var n=xo(Fo,e);return n<=t.length()?n:0}var ko,Go,Vo,Ho,Wo=(ko=new Dn,Go=new Dn,Vo=new Dn,Ho=new Dn,function(t,e){return Dn.subtract(ko,t.center,t.halfExtents),Dn.add(Go,t.center,t.halfExtents),Dn.subtract(Vo,e.center,e.halfExtents),Dn.add(Ho,e.center,e.halfExtents),ko.x<=Ho.x&&Go.x>=Vo.x&&ko.y<=Ho.y&&Go.y>=Vo.y&&ko.z<=Ho.z&&Go.z>=Vo.z});function jo(t,e,n,i,r,a){Dn.set(a[0],t.x+n.x*e.x+i.x*e.y+r.x*e.z,t.y+n.y*e.x+i.y*e.y+r.y*e.z,t.z+n.z*e.x+i.z*e.y+r.z*e.z),Dn.set(a[1],t.x-n.x*e.x+i.x*e.y+r.x*e.z,t.y-n.y*e.x+i.y*e.y+r.y*e.z,t.z-n.z*e.x+i.z*e.y+r.z*e.z),Dn.set(a[2],t.x+n.x*e.x-i.x*e.y+r.x*e.z,t.y+n.y*e.x-i.y*e.y+r.y*e.z,t.z+n.z*e.x-i.z*e.y+r.z*e.z),Dn.set(a[3],t.x+n.x*e.x+i.x*e.y-r.x*e.z,t.y+n.y*e.x+i.y*e.y-r.y*e.z,t.z+n.z*e.x+i.z*e.y-r.z*e.z),Dn.set(a[4],t.x-n.x*e.x-i.x*e.y-r.x*e.z,t.y-n.y*e.x-i.y*e.y-r.y*e.z,t.z-n.z*e.x-i.z*e.y-r.z*e.z),Dn.set(a[5],t.x+n.x*e.x-i.x*e.y-r.x*e.z,t.y+n.y*e.x-i.y*e.y-r.y*e.z,t.z+n.z*e.x-i.z*e.y-r.z*e.z),Dn.set(a[6],t.x-n.x*e.x+i.x*e.y-r.x*e.z,t.y-n.y*e.x+i.y*e.y-r.y*e.z,t.z-n.z*e.x+i.z*e.y-r.z*e.z),Dn.set(a[7],t.x-n.x*e.x-i.x*e.y+r.x*e.z,t.y-n.y*e.x-i.y*e.y+r.y*e.z,t.z-n.z*e.x-i.z*e.y+r.z*e.z)}function Xo(t,e){for(var n=Dn.dot(e,t[0]),i=n,r=1;r<8;++r){var a=Dn.dot(e,t[r]);n=a<n?a:n,i=a>i?a:i}return[n,i]}var qo,Yo,Ko,Qo=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Dn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Dn(0,0,0),i[r]=new Dn(0,0,0);var a=new Dn,o=new Dn;return function(e,r){Dn.set(t[0],1,0,0),Dn.set(t[1],0,1,0),Dn.set(t[2],0,0,1),Dn.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Dn.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Dn.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Dn.cross(t[6+3*s],t[s],t[3]),Dn.cross(t[7+3*s],t[s],t[4]),Dn.cross(t[7+3*s],t[s],t[5]);Dn.subtract(a,e.center,e.halfExtents),Dn.add(o,e.center,e.halfExtents),function(t,e,n){Dn.set(n[0],t.x,e.y,e.z),Dn.set(n[1],t.x,e.y,t.z),Dn.set(n[2],t.x,t.y,e.z),Dn.set(n[3],t.x,t.y,t.z),Dn.set(n[4],e.x,e.y,e.z),Dn.set(n[5],e.x,e.y,t.z),Dn.set(n[6],e.x,t.y,e.z),Dn.set(n[7],e.x,t.y,t.z)}(a,o,n),jo(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var c=0;c<15;++c){var l=Xo(n,t[c]),u=Xo(i,t[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Jo=function(t,e){var n=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),i=Dn.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1},Zo=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===Jo(t,e.planes[n]))return 0;return 1},$o=function(){for(var t=new Array(8),e=0,n=0,i=0;i<t.length;i++)t[i]=new Dn(0,0,0);return function(i,r){for(var a=0,o=!1,s=0;s<r.planes.length;s++){if(-1===(a=Jo(i,r.planes[s])))return 0;1===a&&(o=!0)}if(!o)return 1;for(var c=0;c<r.vertices.length;c++)Dn.subtract(t[c],r.vertices[c],i.center);e=0,n=0;for(var l=0;l<r.vertices.length;l++)t[l].x>i.halfExtents.x?e++:t[l].x<-i.halfExtents.x&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var u=0;u<r.vertices.length;u++)t[u].y>i.halfExtents.y?e++:t[u].y<-i.halfExtents.y&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var h=0;h<r.vertices.length;h++)t[h].z>i.halfExtents.z?e++:t[h].z<-i.halfExtents.z&&n++;return e===r.vertices.length||n===r.vertices.length?0:1}}(),ts=(qo=new Dn(0,0,0),Yo=new Ln,function(t,e){return Dn.subtract(qo,e,t.center),Dn.transformMat3(qo,qo,Ln.transpose(Yo,t.orientation)),n=qo,i=t.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),es=(Ko=function(t,e,n,i){return Math.abs(t.x*e+t.y*n+t.z*i)},function(t,e){var n=t.halfExtents.x*Ko(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*Ko(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*Ko(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),i=Dn.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1}),ns=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===es(t,e.planes[n]))return 0;return 1},is=function(){for(var t=new Array(8),e=0,n=0,i=0,r=0;r<t.length;r++)t[r]=new Dn(0,0,0);var a=function(t,e,n,i){return t.x*e+t.y*n+t.z*i};return function(r,o){for(var s=0,c=!1,l=0;l<o.planes.length;l++){if(-1===(s=es(r,o.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<o.vertices.length;u++)Dn.subtract(t[u],o.vertices[u],r.center);n=0,i=0;for(var h=0;h<o.vertices.length;h++)(e=a(t[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:e<-r.halfExtents.x&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var f=0;f<o.vertices.length;f++)(e=a(t[f],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:e<-r.halfExtents.y&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var _=0;_<o.vertices.length;_++)(e=a(t[_],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:e<-r.halfExtents.z&&i++;return n===o.vertices.length||i===o.vertices.length?0:1}}(),rs=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Dn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Dn(0,0,0),i[r]=new Dn(0,0,0);return function(e,r){Dn.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),Dn.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),Dn.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),Dn.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Dn.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Dn.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var a=0;a<3;++a)Dn.cross(t[6+3*a],t[a],t[3]),Dn.cross(t[7+3*a],t[a],t[4]),Dn.cross(t[8+3*a],t[a],t[5]);jo(e.center,e.halfExtents,t[0],t[1],t[2],n),jo(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var o=0;o<15;++o){var s=Xo(n,t[o]),c=Xo(i,t[o]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),as=function(){for(var t=new lo,e=new Dn,n=new Dn,i=new Dn,r=new Array(8),a=0;a<8;a++)r[a]=new Dn;for(var o=new Array(8),s=0;s<8;s++)o[s]=new Dn;return function(a,s){if(0===Dn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return t.radius=s.radius,t.center.set(s.ellipseCenter0),ds.sphereOBB(t,a);e.x=a.orientation.m00,e.y=a.orientation.m01,e.z=a.orientation.m02,n.x=a.orientation.m03,n.y=a.orientation.m04,n.z=a.orientation.m05,i.x=a.orientation.m06,i.y=a.orientation.m07,i.z=a.orientation.m08,jo(a.center,a.halfExtents,e,n,i,r);var c=o,l=Dn.copy(c[0],e),u=Dn.copy(c[1],n),h=Dn.copy(c[2],i);Dn.subtract(c[3],s.center,a.center).normalize();var f=Dn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);f.normalize(),Dn.cross(c[5],l,f),Dn.cross(c[6],u,f),Dn.cross(c[7],h,f);for(var _=0;_<8;++_){var d=Xo(r,c[_]),p=Dn.dot(c[_],s.ellipseCenter0),m=Dn.dot(c[_],s.ellipseCenter1),g=Math.max(p,m),v=Math.min(p,m)-s.radius,y=g+s.radius;if(v>d[1]||d[0]>y)return 0}return 1}}(),os=function(t,e){var n=Dn.dot(e.n,t.center),i=t.radius*e.n.length();return n+i<e.d?-1:n-i>e.d?0:1},ss=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===os(t,e.planes[n]))return 0;return 1},cs=function(){var t=new Dn(0,0,0),e=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var a=i.planes[r],o=n.radius,s=n.center,c=a.n,l=a.d,u=Dn.dot(c,s);if(u+o<l)return 0;if(!(u-o>l)){Dn.add(t,s,Dn.multiplyScalar(t,c,o));for(var h=0;h<6;h++)if(h!==r&&h!==r+e[r]){var f=i.planes[h];if(Dn.dot(f.n,t)<f.d)return 0}}}return 1}}(),ls=function(t,e){var n=t.radius+e.radius;return Dn.squaredDistance(t.center,e.center)<n*n},us=function(){var t=new Dn;return function(e,n){return Ja(t,e.center,n),Dn.squaredDistance(e.center,t)<e.radius*e.radius}}(),hs=function(){var t=new Dn;return function(e,n){return Za(t,e.center,n),Dn.squaredDistance(e.center,t)<e.radius*e.radius}}(),fs=function(){var t=new Dn,e=new Dn;return function(n,i){var r=n.radius+i.radius,a=r*r,o=Dn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===o)return Dn.squaredDistance(n.center,i.center)<a;Dn.subtract(t,n.center,i.ellipseCenter0),Dn.subtract(e,i.ellipseCenter1,i.ellipseCenter0);var s=Dn.dot(t,e)/o;return s<0?Dn.squaredDistance(n.center,i.ellipseCenter0)<a:s>1?Dn.squaredDistance(n.center,i.ellipseCenter1)<a:(Dn.scaleAndAdd(t,i.ellipseCenter0,e,s),Dn.squaredDistance(n.center,t)<a)}}(),_s=function(){var t=new Dn,e=new Dn,n=new Dn,i=new Dn,r=new Dn,a=new Dn;return function(o,s){var c,l,u=Dn.subtract(t,o.ellipseCenter1,o.ellipseCenter0),h=Dn.subtract(e,s.ellipseCenter1,s.ellipseCenter0),f=Dn.subtract(n,o.ellipseCenter0,s.ellipseCenter0),_=Dn.dot(u,u),d=Dn.dot(u,h),p=Dn.dot(h,h),m=Dn.dot(u,f),g=Dn.dot(h,f),v=_*p-d*d,y=v,S=v;v<sn?(c=0,y=1,l=g,S=p):(l=_*g-d*m,(c=d*g-p*m)<0?(c=0,l=g,S=p):c>y&&(c=y,l=g+d,S=p)),l<0?(l=0,-m<0?c=0:-m>_?c=y:(c=-m,y=_)):l>S&&(l=S,-m+d<0?c=0:-m+d>_?c=y:(c=-m+d,y=_));var T=Math.abs(c)<sn?0:c/y,x=Math.abs(l)<sn?0:l/S,E=i;E.set(f),E.add(Dn.multiplyScalar(r,u,T)),E.subtract(Dn.multiplyScalar(a,h,x));var A=o.radius+s.radius;return E.lengthSqr()<A*A}}(),ds={raySphere:xo,rayAABB:Eo,rayOBB:Po,rayPlane:So,rayTriangle:To,rayCapsule:Ro,raySubMesh:Do,rayMesh:Oo,rayModel:No,lineSphere:Uo,lineAABB:Bo,lineOBB:zo,linePlane:Mo,lineTriangle:Lo,sphereWithSphere:ls,sphereAABB:us,sphereOBB:hs,spherePlane:os,sphereFrustum:ss,sphereFrustumAccurate:cs,sphereCapsule:fs,aabbWithAABB:Wo,aabbWithOBB:Qo,aabbPlane:Jo,aabbFrustum:Zo,aabbFrustumAccurate:$o,obbWithOBB:rs,obbPlane:es,obbFrustum:ns,obbFrustumAccurate:is,obbPoint:ts,obbCapsule:as,capsuleWithCapsule:_s,resolve:function(t,e,n){void 0===n&&(n=null);var i=t._type,r=e._type,a=this[i|r];return i<r?a(t,e,n):a(e,t,n)}};ds[to.SHAPE_RAY|to.SHAPE_SPHERE]=xo,ds[to.SHAPE_RAY|to.SHAPE_AABB]=Eo,ds[to.SHAPE_RAY|to.SHAPE_OBB]=Po,ds[to.SHAPE_RAY|to.SHAPE_PLANE]=So,ds[to.SHAPE_RAY|to.SHAPE_TRIANGLE]=To,ds[to.SHAPE_RAY|to.SHAPE_CAPSULE]=Ro,ds[to.SHAPE_LINE|to.SHAPE_SPHERE]=Uo,ds[to.SHAPE_LINE|to.SHAPE_AABB]=Bo,ds[to.SHAPE_LINE|to.SHAPE_OBB]=zo,ds[to.SHAPE_LINE|to.SHAPE_PLANE]=Mo,ds[to.SHAPE_LINE|to.SHAPE_TRIANGLE]=Lo,ds[to.SHAPE_SPHERE]=ls,ds[to.SHAPE_SPHERE|to.SHAPE_AABB]=us,ds[to.SHAPE_SPHERE|to.SHAPE_OBB]=hs,ds[to.SHAPE_SPHERE|to.SHAPE_PLANE]=os,ds[to.SHAPE_SPHERE|to.SHAPE_FRUSTUM]=ss,ds[to.SHAPE_SPHERE|to.SHAPE_FRUSTUM_ACCURATE]=cs,ds[to.SHAPE_SPHERE|to.SHAPE_CAPSULE]=fs,ds[to.SHAPE_AABB]=Wo,ds[to.SHAPE_AABB|to.SHAPE_OBB]=Qo,ds[to.SHAPE_AABB|to.SHAPE_PLANE]=Jo,ds[to.SHAPE_AABB|to.SHAPE_FRUSTUM]=Zo,ds[to.SHAPE_AABB|to.SHAPE_FRUSTUM_ACCURATE]=$o,ds[to.SHAPE_OBB]=rs,ds[to.SHAPE_OBB|to.SHAPE_PLANE]=es,ds[to.SHAPE_OBB|to.SHAPE_FRUSTUM]=ns,ds[to.SHAPE_OBB|to.SHAPE_FRUSTUM_ACCURATE]=is,ds[to.SHAPE_OBB|to.SHAPE_CAPSULE]=as,ds[to.SHAPE_CAPSULE]=_s,U(eo.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),k(ds,"intersect",[{name:"line_quad"}]);var ps,ms,gs,vs,ys,Ss,Ts,xs=new Dn(0,0,0),Es=new Dn(0,0,0),As=l.mat4(),Cs=l.v4(),bs=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=to.SHAPE_PLANE,this.n=new Dn(t,e,n),this.d=i}return t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return Dn.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,n,i){return Dn.subtract(xs,n,e),Dn.subtract(Es,i,e),Dn.normalize(t.n,Dn.cross(t.n,xs,Es)),t.d=Dn.dot(t.n,e),t},t.set=function(t,e,n,i,r){return t.n.x=e,t.n.y=n,t.n.z=i,t.d=r,t},t.fromNormalAndPoint=function(t,e,n){return Dn.copy(t.n,e),t.d=Dn.dot(e,n),t},t.normalize=function(t,e){var n=e.n.length();return Dn.normalize(t.n,e.n),n>0&&(t.d=e.d/n),t},t.prototype.transform=function(t){Xn.invert(As,t),Xn.transpose(As,As),ti.set(Cs,this.n.x,this.n.y,this.n.z,this.d),ti.transformMat4(Cs,Cs,As),Dn.set(this.n,Cs.x,Cs.y,Cs.z),this.d=Cs.w},Q(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}(),ws=function(){function t(t,e,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(Ts||(Ts={}));var Is,Ps,Rs=function(){function t(t,e,n,i,r){void 0===r&&(r=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=r,this._dataType=e,this._dataMembers=n,this._stride=4*this._elementCount,this._entriesPerChunk=1<<r,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new ws(t,r,this._stride);var a=Ts.NEVER,o=!1,s=!1;for(var c in e){if(o=this._hasFloat32,(s=this._hasUint32)&&o)break;a=e[c],o||a!==Ts.FLOAT32?s||a!==Ts.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freeLists.length;t++){var e=this._freeLists[t];if(e.length){var n=e[e.length-1];return e.length--,(t<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],a=[],o=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&a.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&o.push(l);return c&&this._uint32BufferViews.push(a),s&&this._float32BufferViews.push(r),this._freeLists.push(o),this._arrayBuffers.push(i),(t<<this._entryBits)+this._poolFlag},e.getBuffer=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][n]},e.getTypedArray=function(t,e){var n=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t,r=e,a=(this._dataType[e]===Ts.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i],o=this._dataMembers[e];return a.subarray(r,r+o)},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][n].fill(0),this._freeLists[e].push(n)},t}();!function(t){t[t.NODE=0]="NODE",t[t.PASS=1]="PASS",t[t.AABB=2]="AABB"}(Is||(Is={})),function(t){t[t.DIRTY_FLAG=0]="DIRTY_FLAG",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.LOCAL_SCALE=28]="LOCAL_SCALE",t[t.LOCAL_POSITION=31]="LOCAL_POSITION",t[t.LOCAL_ROTATION=34]="LOCAL_ROTATION",t[t.COUNT=38]="COUNT"}(Ps||(Ps={}));var Ds,Os=((ps={})[Ps.DIRTY_FLAG]=Ts.UINT32,ps[Ps.LAYER]=Ts.UINT32,ps[Ps.WORLD_SCALE]=Ts.FLOAT32,ps[Ps.WORLD_POSITION]=Ts.FLOAT32,ps[Ps.WORLD_ROTATION]=Ts.FLOAT32,ps[Ps.WORLD_MATRIX]=Ts.FLOAT32,ps[Ps.LOCAL_SCALE]=Ts.FLOAT32,ps[Ps.LOCAL_POSITION]=Ts.FLOAT32,ps[Ps.LOCAL_ROTATION]=Ts.FLOAT32,ps[Ps.COUNT]=Ts.NEVER,ps),Ns=((ms={})[Ps.DIRTY_FLAG]=Ps.LAYER-Ps.DIRTY_FLAG,ms[Ps.LAYER]=Ps.WORLD_SCALE-Ps.LAYER,ms[Ps.WORLD_SCALE]=Ps.WORLD_POSITION-Ps.WORLD_SCALE,ms[Ps.WORLD_POSITION]=Ps.WORLD_ROTATION-Ps.WORLD_POSITION,ms[Ps.WORLD_ROTATION]=Ps.WORLD_MATRIX-Ps.WORLD_ROTATION,ms[Ps.WORLD_MATRIX]=Ps.LOCAL_SCALE-Ps.WORLD_MATRIX,ms[Ps.LOCAL_SCALE]=Ps.LOCAL_POSITION-Ps.LOCAL_SCALE,ms[Ps.LOCAL_POSITION]=Ps.LOCAL_ROTATION-Ps.LOCAL_POSITION,ms[Ps.LOCAL_ROTATION]=Ps.COUNT-Ps.LOCAL_ROTATION,ms[Ps.COUNT]=1,ms),Ms=new Rs(Is.NODE,Os,Ns,Ps);!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.PRIMITIVE=3]="PRIMITIVE",t[t.BATCHING_SCHEME=4]="BATCHING_SCHEME",t[t.DYNAMIC_STATE=5]="DYNAMIC_STATE",t[t.HASH=6]="HASH",t[t.COUNT=7]="COUNT"}(Ds||(Ds={}));var Ls,Fs=((gs={})[Ds.PRIORITY]=Ts.UINT32,gs[Ds.STAGE]=Ts.UINT32,gs[Ds.PHASE]=Ts.UINT32,gs[Ds.PRIMITIVE]=Ts.UINT32,gs[Ds.BATCHING_SCHEME]=Ts.UINT32,gs[Ds.DYNAMIC_STATE]=Ts.UINT32,gs[Ds.HASH]=Ts.UINT32,gs[Ds.COUNT]=Ts.NEVER,gs),Bs=((vs={})[Ds.PRIORITY]=Ds.STAGE-Ds.PRIORITY,vs[Ds.STAGE]=Ds.PHASE-Ds.STAGE,vs[Ds.PHASE]=Ds.PRIMITIVE-Ds.PHASE,vs[Ds.PRIMITIVE]=Ds.BATCHING_SCHEME-Ds.PRIMITIVE,vs[Ds.BATCHING_SCHEME]=Ds.DYNAMIC_STATE-Ds.BATCHING_SCHEME,vs[Ds.DYNAMIC_STATE]=Ds.HASH-Ds.DYNAMIC_STATE,vs[Ds.HASH]=Ds.COUNT-Ds.HASH,vs[Ds.COUNT]=1,vs),zs=new Rs(Is.PASS,Fs,Bs,Ds);!function(t){t[t.CENTER=0]="CENTER",t[t.HALFEXTENTS=3]="HALFEXTENTS",t[t.COUNT=6]="COUNT"}(Ls||(Ls={}));var Us=((ys={})[Ls.CENTER]=Ts.FLOAT32,ys[Ls.HALFEXTENTS]=Ts.FLOAT32,ys[Ls.COUNT]=Ts.NEVER,ys),ks=((Ss={})[Ls.CENTER]=Ls.HALFEXTENTS-Ls.CENTER,Ss[Ls.HALFEXTENTS]=Ls.COUNT-Ls.HALFEXTENTS,Ss[Ls.COUNT]=1,Ss),Gs=new Rs(Is.AABB,Us,ks,Ls),Vs=new Dn,Hs=new Dn,Ws=new Dn,js=new Dn,Xs=new Ln,qs=function(t,e,n){Xs.m00=Math.abs(n.m00),Xs.m01=Math.abs(n.m01),Xs.m02=Math.abs(n.m02),Xs.m03=Math.abs(n.m04),Xs.m04=Math.abs(n.m05),Xs.m05=Math.abs(n.m06),Xs.m06=Math.abs(n.m08),Xs.m07=Math.abs(n.m09),Xs.m08=Math.abs(n.m10),Dn.transformMat3(t,e,Xs)},Ys=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._aabbHandle=0,this._type=to.SHAPE_AABB,this.center=new Dn(t,e,n),this.halfExtents=new Dn(i,r,a)}t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return Dn.copy(t.center,e.center),Dn.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,n){return Dn.add(Vs,n,e),Dn.subtract(Hs,n,e),Dn.multiplyScalar(t.center,Vs,.5),Dn.multiplyScalar(t.halfExtents,Hs,.5),t},t.set=function(t,e,n,i,r,a,o){return t.center.set(e,n,i),t.halfExtents.set(r,a,o),t},t.merge=function(e,n,i){return Dn.subtract(Vs,n.center,n.halfExtents),Dn.subtract(Hs,i.center,i.halfExtents),Dn.add(Ws,n.center,n.halfExtents),Dn.add(js,i.center,i.halfExtents),Dn.max(js,Ws,js),Dn.min(Ws,Vs,Hs),t.fromPoints(e,Ws,js)},t.toBoundingSphere=function(t,e){return t.center.set(e.center),t.radius=e.halfExtents.length(),t},t.transform=function(t,e,n){return Dn.transformMat4(t.center,e.center,n),qs(t.halfExtents,e.halfExtents,n),t};var e=t.prototype;return e.getBoundary=function(t,e){Dn.subtract(t,this.center,this.halfExtents),Dn.add(e,this.center,this.halfExtents)},e.transform=function(t,e,n,i,r){Dn.transformMat4(r.center,this.center,t),qs(r.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.mergePoint=function(t){this.getBoundary(Vs,Hs),t.x<Vs.x&&(Vs.x=t.x),t.y<Vs.y&&(Vs.y=t.y),t.z<Vs.z&&(Vs.z=t.z),t.x>Hs.x&&(Hs.x=t.x),t.y>Hs.y&&(Hs.y=t.y),t.z>Hs.z&&(Hs.z=t.z),Dn.add(Ws,Vs,Hs),this.center.set(Dn.multiplyScalar(Ws,Ws,.5)),this.halfExtents.set(Hs.x-Ws.x,Hs.y-Ws.y,Hs.z-Ws.z)},e.mergePoints=function(t){if(!(t.length<1))for(var e=0;e<t.length;e++)this.mergePoint(t[e])},e.mergeFrustum=function(t){return this.mergePoints(t.vertices)},Q(t,[{key:"type",get:function(){return this._type}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Ks=new Dn,Qs=new Dn,Js=new Ln,Zs=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=to.SHAPE_OBB,this.center=new Dn(t,e,n),this.halfExtents=new Dn(i,r,a),this.orientation=new Ln(o,s,c,l,u,h,f,_,d)}t.create=function(e,n,i,r,a,o,s,c,l,u,h,f,_,d,p){return new t(e,n,i,r,a,o,s,c,l,u,h,f,_,d,p)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return Dn.copy(t.center,e.center),Dn.copy(t.halfExtents,e.halfExtents),Ln.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,n){return Dn.multiplyScalar(t.center,Dn.add(Ks,e,n),.5),Dn.multiplyScalar(t.halfExtents,Dn.subtract(Qs,n,e),.5),Ln.identity(t.orientation),t},t.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,d,p){return Dn.set(t.center,e,n,i),Dn.set(t.halfExtents,r,a,o),Ln.set(t.orientation,s,c,l,u,h,f,_,d,p),t};var e=t.prototype;return e.getBoundary=function(t,e){!function(t,e,n){Js.m00=Math.abs(n.m00),Js.m01=Math.abs(n.m01),Js.m02=Math.abs(n.m02),Js.m03=Math.abs(n.m03),Js.m04=Math.abs(n.m04),Js.m05=Math.abs(n.m05),Js.m06=Math.abs(n.m06),Js.m07=Math.abs(n.m07),Js.m08=Math.abs(n.m08),Dn.transformMat3(t,e,Js)}(Ks,this.halfExtents,this.orientation),Dn.subtract(t,this.center,Ks),Dn.add(e,this.center,Ks)},e.transform=function(t,e,n,i,r){Dn.transformMat4(r.center,this.center,t),Ln.fromQuat(r.orientation,n),Dn.multiply(r.halfExtents,this.halfExtents,i)},e.translateAndRotate=function(t,e,n){Dn.transformMat4(n.center,this.center,t),Ln.fromQuat(n.orientation,e)},e.setScale=function(t,e){Dn.multiply(e.halfExtents,this.halfExtents,t)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),$s=function(){function t(t,e,n){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=to.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=n,this.center=new Dn,this.rotation=new zn,this.ellipseCenter0=new Dn(0,e,0),this.ellipseCenter1=new Dn(0,-e,0),this.updateCache()}var e=t.prototype;return e.transform=function(t,e,n,i,r){var a=i,o=Cn(a);r.radius=this.radius*Math.abs(o);var s=(this.halfHeight+this.radius)*Math.abs(a.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Dn.transformMat4(r.center,this.center,t),zn.multiply(r.rotation,this.rotation,n),r.updateCache()},e.updateCache=function(){this.updateLocalCenter(),Dn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Dn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),tc=new Array(8);tc[0]=new Dn(1,1,1),tc[1]=new Dn(-1,1,1),tc[2]=new Dn(-1,-1,1),tc[3]=new Dn(1,-1,1),tc[4]=new Dn(1,1,-1),tc[5]=new Dn(-1,1,-1),tc[6]=new Dn(-1,-1,-1),tc[7]=new Dn(1,-1,-1);var ec,nc,ic=new Dn,rc=new Dn,ac=new Dn,oc=function(){function t(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=to.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=bs.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new Dn}t.createFromAABB=function(t,e){var n=new Dn,i=new Dn;return Dn.subtract(n,e.center,e.halfExtents),Dn.add(i,e.center,e.halfExtents),t.vertices[0].set(n.x,i.y,n.z),t.vertices[1].set(i.x,i.y,n.z),t.vertices[2].set(i.x,n.y,n.z),t.vertices[3].set(n.x,n.y,n.z),t.vertices[4].set(n.x,i.y,i.z),t.vertices[5].set(i.x,i.y,i.z),t.vertices[6].set(i.x,n.y,i.z),t.vertices[7].set(n.x,n.y,i.z),t._type!==to.SHAPE_FRUSTUM_ACCURATE||t.updatePlanes(),t},t.split=function(t,e,n,i,r){var a=Math.tan(.5*e.fov),o=a*e.aspect;ic.set(i*o,i*a,i),rc.set(r*o,r*a,r);var s=t.vertices;return ac.set(ic.x,ic.y,ic.z),Dn.transformMat4(s[0],ac,n),ac.set(-ic.x,ic.y,ic.z),Dn.transformMat4(s[1],ac,n),ac.set(-ic.x,-ic.y,ic.z),Dn.transformMat4(s[2],ac,n),ac.set(ic.x,-ic.y,ic.z),Dn.transformMat4(s[3],ac,n),ac.set(rc.x,rc.y,rc.z),Dn.transformMat4(s[4],ac,n),ac.set(-rc.x,rc.y,rc.z),Dn.transformMat4(s[5],ac,n),ac.set(-rc.x,-rc.y,rc.z),Dn.transformMat4(s[6],ac,n),ac.set(rc.x,-rc.y,rc.z),Dn.transformMat4(s[7],ac,n),t.updatePlanes(),t},t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var n=0;n<6;++n)bs.copy(t.planes[n],e.planes[n]);for(var i=0;i<8;++i)Dn.copy(t.vertices[i],e.vertices[i]);return t};var e=t.prototype;return e.update=function(t,e){if(Dn.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),Dn.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),Dn.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),Dn.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),Dn.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),Dn.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===to.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Dn.multiplyScalar(i.n,i.n,r),i.d*=r}for(var a=0;a<8;a++)Dn.transformMat4(this.vertices[a],tc[a],e)}},e.transform=function(t){if(this._type===to.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)Dn.transformMat4(this.vertices[e],this.vertices[e],t);this.updatePlanes()}},e.updatePlanes=function(){bs.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),bs.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),bs.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),bs.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),bs.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),bs.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])},Q(t,[{key:"accurate",set:function(t){this._type=t?to.SHAPE_FRUSTUM_ACCURATE:to.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),t}();oc.createOrtho=function(t,e,n,i,r,a){var o=e/2,s=n/2;Dn.set(ac,o,s,-i),Dn.transformMat4(t.vertices[0],ac,a),Dn.set(ac,-o,s,-i),Dn.transformMat4(t.vertices[1],ac,a),Dn.set(ac,-o,-s,-i),Dn.transformMat4(t.vertices[2],ac,a),Dn.set(ac,o,-s,-i),Dn.transformMat4(t.vertices[3],ac,a),Dn.set(ac,o,s,-r),Dn.transformMat4(t.vertices[4],ac,a),Dn.set(ac,-o,s,-r),Dn.transformMat4(t.vertices[5],ac,a),Dn.set(ac,-o,-s,-r),Dn.transformMat4(t.vertices[6],ac,a),Dn.set(ac,o,-s,-r),Dn.transformMat4(t.vertices[7],ac,a),bs.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),bs.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),bs.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),bs.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),bs.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),bs.fromPoints(t.planes[5],t.vertices[7],t.vertices[5],t.vertices[6])},function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(ec||(ec={})),function(t){t[t.Default=ec.Default]="Default",t[t.Normal=ec.Normal]="Normal",t[t.Reverse=ec.Reverse]="Reverse",t[t.Loop=ec.Loop]="Loop",t[t.LoopReverse=ec.Loop|ec.Reverse]="LoopReverse",t[t.PingPong=ec.PingPong]="PingPong",t[t.PingPongReverse=ec.PingPong|ec.Reverse]="PingPongReverse"}(nc||(nc={})),le(nc);var sc,cc=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}();function lc(t,e,n){void 0===n&&(n=1e-6);for(var i=0,r=t.length-1,a=r>>>1;i<=r;a=i+r>>>1){var o=t[a];if(o>e+n)r=a-1;else{if(!(o<e-n))return a;i=a+1}}return~i}sc=Symbol.iterator;var uc,hc,fc,_c=function(){function t(){this._times=[],this._values=[]}var e=t.prototype;return e[sc]=function(){var t=this,e=0;return{next:function(){if(e>=t._times.length)return{done:!0,value:void 0};var n=[t._times[e],t._values[e]];return++e,{done:!1,value:n}}}},e.keyframes=function(){return this},e.times=function(){return this._times},e.values=function(){return this._values},e.getKeyframeTime=function(t){return this._times[t]},e.getKeyframeValue=function(t){return this._values[t]},e.addKeyFrame=function(t,e){return this._insertNewKeyframe(t,e)},e.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},e.indexOfKeyframe=function(t){return lc(this._times,t)},e.updateTime=function(t,e){var n=this._values[t];this.removeKeyframe(t),this._insertNewKeyframe(e,n)},e.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},e.clear=function(){this._times.length=0,this._values.length=0},e.searchKeyframe=function(t){return lc(this._times,t)},e.setKeyframes=function(t,e){t.length,e.length,function(t){t.every((function(t,e,n){return 0===e||t>n[e-1]||ln(t,n[e-1],1e-6)}))}(t),this._times=t,this._values=e},e._insertNewKeyframe=function(t,e){var n=this._times,i=this._values,r=n.length,a=lc(n,t);if(a>=0)return a;var o=~a;return 0===o?(n.unshift(t),i.unshift(e)):o===r?(n.push(t),i.push(e)):(n.splice(o-1,0,t),i.splice(o-1,0,e)),o},Q(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}();function dc(t){return t>-1e-9&&t<1e-9}tn.fastDefine("cc.KeyframeCurve",_c,{_times:[],_values:[]}),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.CUBIC=2]="CUBIC"}(uc||(uc=t("RealInterpolationMode",{}))),function(t){t[t.LINEAR=0]="LINEAR",t[t.CLAMP=1]="CLAMP",t[t.LOOP=2]="LOOP",t[t.PING_PONG=3]="PING_PONG"}(hc||(hc=t("ExtrapolationMode",{}))),function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.BOTH=3]="BOTH"}(fc||(fc=t("TangentWeightMode",{})));var pc=function(){},mc=function(){return pc},gc=vc((function(){}));function vc(t){return function(e){return"function"==typeof e?t(e):function(n){return t(n,e)}}}function yc(t){return function(e){return function(n){!function(t,e,n){var i=Tc(t);if(i){var r=xc(i,"proto");xc(r,"editor")[e]=n}}(n,t,e)}}}var Sc="__ccclassCache__";function Tc(t){return xc(t,Sc)}function xc(t,e){return t[e]||(t[e]={})}var Ec=vc((function(t,e){var n=ie.getSuper(t);n===Object&&(n=null);var i={name:e,extends:n,ctor:t},r=t[Sc];if(r){var a=r.proto;a&&ie.mixin(i,a),t[Sc]=void 0}return tn(i)})),Ac=yc("requireComponent"),Cc=yc("executionOrder"),bc=gc;function wc(t,e,n){var i=null;function r(t,e,n){!function(t,e,n,i,r,a){var o,s=a&&(a.get||a.set);r&&(o=He(r,s));var c=ie.mixin(e,o||r||{});s?(a.get&&(c.get=a.get),a.set&&(c.set=a.set)):Pc(t,c,n,i,a)}(function(t){return Tc(t.constructor)}(t),function(t,e){var n,i,r=xc(Tc(t.constructor),"proto"),a=xc(r,"properties");return null!==(i=a[n=e])&&void 0!==i?i:a[n]={}}(t,e),t.constructor,e,i,n)}return void 0===t?wc({type:void 0}):void 0===e?(i=t,r):void r(t,e,n)}function Ic(t,e,n){var i,r,a=Tc(t.constructor),o=xc(a,"proto"),s=xc(o,"properties"),c=null!==(r=s[i=e])&&void 0!==r?r:s[i]={};return c.__internalFlags|=We.STANDALONE,n&&(n.get||n.set)?(n.get&&(c.get=n.get),n.set&&(c.set=n.set)):Pc(a,c,t.constructor,e,n),c}function Pc(t,e,n,i,r){if(r)r.initializer&&(e.default=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var a=t.default||(t.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(n));a.hasOwnProperty(i)&&(e.default=a[i])}}var Rc=Symbol("cc:SerializationMetadata"),Dc=function(t,e,n){Mc(Ic(t,e,n))};function Oc(t){return function(e,n,i){var r=Ic(e,n,i);r.formerlySerializedAs=t,Mc(r)}}var Nc=function(t,e,n){var i=Ic(t,e,n);i.editorOnly=!0,Mc(i)};function Mc(t){t.__internalFlags|=We.IMPLICIT_SERIALIZABLE}var Lc=pc,Fc=gc,Bc=mc,zc=gc,Uc=mc,kc=mc,Gc=mc,Vc=pc,Hc=mc,Wc=pc,jc=mc,Xc=mc,qc=mc,Yc=mc,Kc=mc,Qc=mc,Jc=pc,Zc=mc,$c=pc,tl=pc,el=al(Ne),nl=al(Me),il=al(Le),rl=al(Fe);function al(t){return wc({type:t})}var ol,sl=function(t,e,n){Ic(t,e,n).override=!0},cl=t("editorExtrasTag","__editorExtras__"),ll=function(){},ul=Object.freeze({__proto__:null,uniquelyReferenced:Lc,ccclass:Ec,property:wc,requireComponent:Ac,executionOrder:Cc,disallowMultiple:bc,allowReplicated:function(t){tn.Attr.setClassAttr(t,"replicated","visible",!0)},executeInEditMode:Fc,menu:Bc,playOnFocus:zc,inspector:Uc,icon:kc,help:Gc,type:al,integer:el,float:nl,boolean:il,string:rl});t("_decorator",ul);var hl=1<<22,fl=[],_l=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=void 0,this._name=void 0,this._name=t,this._objFlags=0}t._deferredDestroy=function(){for(var t=fl.length,e=0;e<t;++e){var n=fl[e];1&n._objFlags||n._destroyImmediate()}t===fl.length?fl.length=0:fl.splice(0,t)};var e=t.prototype;return e.destroy=function(){return 1&this._objFlags?(R(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,fl.push(this),0))},e._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var n,i=t instanceof l._BaseNode||t instanceof l.Component,r=i?"_id":null,a={};for(n in t)if(t.hasOwnProperty(n)){if(n===r)continue;switch(typeof t[n]){case"string":a[n]="";break;case"object":case"function":a[n]=null}}if(tn._isCCClass(e))for(var o=l.Class.Attr.getClassAttrs(e),s=e.__props__,c=0;c<s.length;c++){var u=(n=s[c])+l.Class.Attr.DELIMETER+"default";if(u in o){if(i&&"_id"===n)continue;switch(typeof o[u]){case"string":a[n]="";break;case"object":case"function":a[n]=null;break;case"undefined":a[n]=void 0}}}var h="";for(n in a){var f;f=tn.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+tn.escapeForJS(n)+"]=";var _=a[n];""===_&&(_='""'),h+=f+_+";\n"}return Function("o",h)}(this,t),At(t,"__destruct__",e,!0)),e(this)},e._destroyImmediate=function(){1&this._objFlags?O(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},Q(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"hideFlags",get:function(){return this._objFlags&t.Flags.AllHideMasks},set:function(e){var n=e&t.Flags.AllHideMasks;this._objFlags=this._objFlags&~t.Flags.AllHideMasks|n}},{key:"replicated",get:function(){return!!(this._objFlags&hl)},set:function(t){t?this._objFlags|=hl:this._objFlags&=-4194305}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}()),dl=_l.prototype;function pl(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}dl._deserialize=null,dl._onPreDestroy=null,tn.fastDefine("cc.Object",_l,((ol={_name:"",_objFlags:0})[cl]={},ol)),tn.Attr.setClassAttr(_l,cl,"editorOnly",!0),tn.Attr.setClassAttr(_l,"replicated","visible",!1),At(_l,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),l.isValid=pl,l.Object=_l;var ml=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=ie.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=ie.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},Q(t,[{key:"count",get:function(){return this._count}}]),t}(),gl=function(){function t(e,n){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var e=t.prototype;return e.insert=function(t,e){return e>this.pipes.length?(R(4921),this):(this.pipes.splice(e,0,t),this)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0===e.length)return null;t.isFinish=!1;for(var n=0,i=e.length;n<i;){var r=(0,e[n])(t);if(r)return t.isFinish=!0,r;++n!==i&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var n=this;(0,this.pipes[t])(e,(function(i){i?(e.isFinish=!0,e.dispatch("complete",i)):++t<n.pipes.length?(e.input=e.output,e.output=null,n._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",i,e.output))}))},t}();gl._pipelineId=0,function(){function t(t){if(this._weakMap={},void 0===window.WeakRef)throw new Error("this platform does not support WeakRef!");if(t)for(var e in t)this._weakMap[e]=new WeakRef(t[e])}var e=t.prototype;e.add=function(t,e){return this._weakMap[t]=new WeakRef(e),e},e.has=function(t){return t in this._weakMap&&!!this._weakMap[t].deref()},e.get=function(t){return this._weakMap[t]&&this._weakMap[t].deref()},e.remove=function(t){var e=this._weakMap[t];return delete this._weakMap[t],e&&e.deref()},e.clear=function(){this._weakMap=ie.createMap(!0)},e.forEach=function(t){for(var e in this._weakMap){var n=this.get(e);n&&t(n,e)}},e.find=function(t){for(var e in this._weakMap){var n=this.get(e);if(n&&t(n,e))return this._weakMap[e].deref()}return null},e.destroy=function(){this._weakMap={}},Q(t,[{key:"count",get:function(){return Object.values(this._weakMap).filter((function(t){return t.deref()})).length}}])}();var vl,yl=new ml,Sl=new ml,Tl=new ml,xl=new ml,El=new gl("normal load",[]),Al=new gl("fetch",[]),Cl=new gl("transform url",[]);!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}(vl||(vl={}));var bl,wl={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(bl||(bl={}));var Il=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var n;return 0!==t._deadPool.length?(n=t._deadPool.pop()).set(e):n=new t(e),n};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,n,i,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,n);break;case"progress":this.onProgress&&this.onProgress(e,n,i,r);break;case"error":this.onError&&this.onError(e,n,i,r);break;default:var a="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[a]&&this[a](e,n,i,r)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();Il.MAX_DEAD_NUM=500,Il._taskId=0,Il._deadPool=[];var Pl="0123456789abcdef".split(""),Rl=["","","",""],Dl=Rl.concat(Rl,"-",Rl,"-",Rl,"-",Rl,"-",Rl,Rl,Rl),Ol=Dl.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function Nl(t){var e=t.split("@")[0];if(22!==e.length)return t;Dl[0]=t[0],Dl[1]=t[1];for(var n=2,i=2;n<22;n+=2){var r=me[t.charCodeAt(n)],a=me[t.charCodeAt(n+1)];Dl[Ol[i++]]=Pl[r>>2],Dl[Ol[i++]]=Pl[(3&r)<<2|a>>4],Dl[Ol[i++]]=Pl[15&a]}return t.replace(e,Dl.join(""))}var Ml=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Ll(t){var e=Ml.exec(t);return e?e[1]:""}function Fl(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.nativeExt&&(e.ext=e.nativeExt);var n=xl.find((function(e){return!!e.getAssetInfo(t)}));return n&&(e.bundle=n.name),Ul(t,e)}function Bl(t){return!!t&&(t instanceof l.SceneAsset||t instanceof l.Scene)}function zl(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function Ul(t,e){var n=Il.create({input:t,options:e}),i=[];try{for(var r,a=ot(Cl.sync(n));!(r=a()).done;){var o=r.value,s=o.url;o.recycle(),i.push(s)}}catch(t){for(var c,l=ot(n.output);!(c=l()).done;)c.value.recycle();T(t.message,t.stack)}return n.recycle(),i.length>1?i:i[0]}var kl=Object.freeze({__proto__:null,getUuidFromURL:Ll,getUrlWithUuid:Fl,isScene:Bl,normalize:zl,transform:Ul,decodeUuid:Nl}),Gl=new(function(){function t(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}var e=t.prototype;return e.addContainer=function(t){-1===t._poolHandle&&(t._poolHandle=this._pools.length,this._pools.push(t))},e.removeContainer=function(t){-1!==t._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=t._poolHandle,ht(this._pools,t._poolHandle),t._poolHandle=-1)},e.tryShrink=function(){for(var t=0;t<this._pools.length;t++)this._pools[t].tryShrink()},e.update=function(t){this._lastShrinkPassed+=t,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)},t}()),Vl=function(){function t(){this._poolHandle=-1,Gl.addContainer(this)}return t.prototype.destroy=function(){Gl.removeContainer(this)},t}(),Hl=t("Pool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._ctor=void 0,r._elementsPerBatch=void 0,r._nextAvail=void 0,r._freepool=[],r._dtor=void 0,r._ctor=e,r._dtor=i||null,r._elementsPerBatch=Math.max(n,1),r._nextAvail=r._elementsPerBatch-1;for(var a=0;a<r._elementsPerBatch;++a)r._freepool.push(e());return r}Z(e,t);var n=e.prototype;return n.alloc=function(){if(this._nextAvail<0){this._freepool.length=this._elementsPerBatch;for(var t=0;t<this._elementsPerBatch;t++)this._freepool[t]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freepool[this._nextAvail--]},n.free=function(t){this._freepool[++this._nextAvail]=t},n.freeArray=function(t){this._freepool.length=this._nextAvail+1,Array.prototype.push.apply(this._freepool,t),this._nextAvail+=t.length},n.tryShrink=function(){if(this._nextAvail>>1>this._elementsPerBatch){if(this._dtor)for(var t=this._nextAvail>>1;t<=this._nextAvail;t++)this._dtor(this._freepool[t]);this._freepool.length=this._nextAvail>>1,this._nextAvail=this._freepool.length-1}},n.destroy=function(){var e=arguments.length>0?arguments[0]:null;e&&R(14100);var n=e||this._dtor;if(n)for(var i=0;i<=this._nextAvail;i++)n(this._freepool[i]);this._freepool.length=0,this._nextAvail=-1,t.prototype.destroy.call(this)},e}(Vl)),Wl=t("RecyclePool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._fn=void 0,r._dtor=null,r._count=0,r._data=void 0,r._initSize=0,r._fn=e,r._dtor=i||null,r._data=new Array(n),r._initSize=n;for(var a=0;a<n;++a)r._data[a]=e();return r}Z(e,t);var n=e.prototype;return n.reset=function(){this._count=0},n.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},n.add=function(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]},n.destroy=function(){if(this._dtor)for(var e=0;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=0,this._count=0,t.prototype.destroy.call(this)},n.tryShrink=function(){if(this._data.length>>2>this._count){var t=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(var e=t;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=t}},n.removeAt=function(t){if(!(t>=this._count)){var e=this._count-1,n=this._data[t];this._data[t]=this._data[e],this._data[e]=n,this._count-=1}},Q(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}(Vl)),jl=t("CachedArray",function(t){function e(e,n){var i;return(i=t.call(this)||this).array=void 0,i.length=0,i._compareFn=void 0,i._initSize=0,i.array=new Array(e),i._initSize=e,i.length=0,i._compareFn=n,i}Z(e,t);var n=e.prototype;return n.push=function(t){this.array[this.length++]=t},n.pop=function(){return this.array[--this.length]},n.get=function(t){return this.array[t]},n.clear=function(){this.length=0},n.destroy=function(){this.length=0,this.array.length=0,t.prototype.destroy.call(this)},n.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this._initSize,this.array.length>>1))},n.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},n.concat=function(t){for(var e=0;e<t.length;++e)this.array[this.length++]=t[e]},n.fastRemove=function(t){if(!(t>=this.length||t<0)){var e=--this.length;this.array[t]=this.array[e]}},n.indexOf=function(t){for(var e=0,n=this.length;e<n;++e)if(this.array[e]===t)return e;return-1},e}(Vl));t("memop",Object.freeze({__proto__:null,Pool:Hl,RecyclePool:Wl,CachedArray:jl}));var Xl=ne.fastRemoveAt;function ql(){}var Yl=function(){function t(){this.callback=ql,this.target=void 0,this.once=!1}var e=t.prototype;return e.set=function(t,e,n){this.callback=t||ql,this.target=e,this.once=!!n},e.reset=function(){this.target=void 0,this.callback=ql,this.once=!1},e.check=function(){return!(this.target instanceof _l&&!pl(this.target,!0))},t}(),Kl=new Hl((function(){return new Yl}),32),Ql=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var e=t.prototype;return e.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.callback===t&&(n.reset(),Kl.free(n),Xl(this.callbackInfos,e),--e)}},e.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.target===t&&(n.reset(),Kl.free(n),Xl(this.callbackInfos,e),--e)}},e.cancel=function(t){var e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:Xl(this.callbackInfos,t),Kl.free(e)),this.containCanceled=!0},e.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(e.reset(),Kl.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0},e.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Xl(this.callbackInfos,t);this.containCanceled=!1},e.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),Jl=new Hl((function(){return new Ql}),16),Zl=function(){function t(){this._callbackTable=It(!0),this._offCallback=void 0}var e=t.prototype;return e.on=function(t,e,n,i){if(!this.hasEventListener(t,e,n)){var r=this._callbackTable[t];r||(r=this._callbackTable[t]=Jl.alloc());var a=Kl.alloc();a.set(e,n,i),r.callbackInfos.push(a)}return e},e.hasEventListener=function(t,e,n){var i=this._callbackTable&&this._callbackTable[t];if(!i)return!1;var r=i.callbackInfos;if(!e){if(i.isInvoking){for(var a=0;a<r.length;++a)if(r[a])return!0;return!1}return r.length>0}for(var o=0;o<r.length;++o){var s=r[o];if(s&&s.check()&&s.callback===e&&s.target===n)return!0}return!1},e.removeAll=function(t){var e=typeof t;if("string"===e||"number"===e){var n=this._callbackTable&&this._callbackTable[t];n&&(n.isInvoking?n.cancelAll():(n.clear(),Jl.free(n),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking)for(var a=r.callbackInfos,o=0;o<a.length;++o){var s=a[o];s&&s.target===t&&r.cancel(o)}else r.removeByTarget(t)}},e.off=function(t,e,n){var i,r=this._callbackTable&&this._callbackTable[t];if(r){var a=r.callbackInfos;if(e)for(var o=0;o<a.length;++o){var s=a[o];if(s&&s.callback===e&&s.target===n){r.cancel(o);break}}else this.removeAll(t)}null===(i=this._offCallback)||void 0===i||i.call(this)},e.emit=function(t,e,n,i,r,a){var o=this._callbackTable&&this._callbackTable[t];if(o){var s=!o.isInvoking;o.isInvoking=!0;for(var c=o.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var f=h.callback,_=h.target;h.once&&this.off(t,f,_),h.check()?_?f.call(_,e,n,i,r,a):f(e,n,i,r,a):this.off(t,f,_)}}s&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},e.clear=function(){for(var t in this._callbackTable){var e=this._callbackTable[t];e&&(e.clear(),Jl.free(e),delete this._callbackTable[t])}},e._registerOffCallback=function(t){this._offCallback=t},t}();function $l(t){for(var e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._callbackTable=It(!0),e}Z(e,t);var n=e.prototype;return n.once=function(t,e,n){return this.on(t,e,n,!0)},n.targetOff=function(t){this.removeAll(t)},e}(t),n=Zl.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var a=i[r];if(!(a in e.prototype)){var o=Object.getOwnPropertyDescriptor(n,a);o&&Object.defineProperty(e.prototype,a,o)}}return e}var tu=t("EventTarget",$l((function(){})));l.EventTarget=tu;var eu,nu,iu,ru,au,ou,su,cu=new(function(){function t(){this._finalizationRegistry=null}var e=t.prototype;return e.registerGCObject=function(t){return t},e.unregisterGCObject=function(){},e.init=function(){},e.finalizationRegistryCallback=function(t){t.isValid&&t.destroy()},e.destroy=function(){},t}()),lu=Ec("cc.GCObject")(eu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,cu.registerGCObject(rt(e))||rt(e)}Z(e,t);var n=e.prototype;return n.equals=function(t){return!!t&&t===this},n.destroy=function(){return cu.unregisterGCObject(this),t.prototype.destroy.call(this)},e}(_l))||eu;!function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(nu||(nu={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg"}(iu||(iu={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(ru||(ru={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS"}(au||(au={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.WECHAT_GAME="WECHAT_GAME",t.BAIDU_MINI_GAME="BAIDU_MINI_GAME",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.COCOSPLAY="COCOSPLAY",t.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",t.QTT_MINI_GAME="QTT_MINI_GAME"}(ou||(ou={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER"}(su||(su={}));var uu,hu,fu,_u,du=new(function(t){function e(){var e,n,i;(i=t.call(this)||this).networkType=void 0,i.isNative=void 0,i.isBrowser=void 0,i.isMobile=void 0,i.isLittleEndian=void 0,i.platform=void 0,i.language=void 0,i.nativeLanguage=void 0,i.os=void 0,i.osVersion=void 0,i.osMainVersion=void 0,i.browserType=void 0,i.browserVersion=void 0,i._battery=void 0,i._featureMap=void 0;var r,a=window.navigator,o=a.userAgent.toLowerCase();null===(e=a.getBattery)||void 0===e||e.call(a).then((function(t){i._battery=t})),i.networkType=ru.LAN,i.isNative=!1,i.isBrowser=!0,i.isMobile=/mobile|android|iphone|ipad/.test(o),i.platform=i.isMobile?ou.MOBILE_BROWSER:ou.DESKTOP_BROWSER,i.isLittleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]);var s=a.language;i.nativeLanguage=s.toLowerCase(),s=(s=s||a.browserLanguage)?s.split("-")[0]:iu.ENGLISH,i.language=s;var c=!1,l=!1,u="",h=0,f=/android\s*(\d+(?:\.\d+)*)/i.exec(o)||/android\s*(\d+(?:\.\d+)*)/i.exec(a.platform);f&&(c=!0,u=f[1]||"",h=parseInt(u)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(o))?(l=!0,u=f[2]||"",h=parseInt(u)||0):(/(iPhone|iPad|iPod)/.exec(a.platform)||"MacIntel"===a.platform&&a.maxTouchPoints&&a.maxTouchPoints>1)&&(l=!0,u="",h=0);var _=au.UNKNOWN;-1!==a.appVersion.indexOf("Win")?_=au.WINDOWS:l?_=au.IOS:-1!==a.appVersion.indexOf("Mac")?_=au.OSX:-1!==a.appVersion.indexOf("X11")&&-1===a.appVersion.indexOf("Linux")?_=au.LINUX:c?_=au.ANDROID:-1===a.appVersion.indexOf("Linux")&&-1===o.indexOf("ubuntu")||(_=au.LINUX),i.os=_,i.osVersion=u,i.osMainVersion=h,i.browserType=nu.UNKNOWN;var d=/wechat|weixin|micromessenger/i.exec(o)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(o)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(o)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(o),p=d?d[0].toLowerCase():au.UNKNOWN;("safari"===p&&c||"qq"===p&&/android.*applewebkit/i.test(o))&&(p=nu.ANDROID);var m={micromessenger:nu.WECHAT,wechat:nu.WECHAT,weixin:nu.WECHAT,trident:nu.IE,edge:nu.EDGE,"360 aphone":nu.BROWSER_360,mxbrowser:nu.MAXTHON,"opr/":nu.OPERA,ubrowser:nu.UC,huaweibrowser:nu.HUAWEI};i.browserType=m[p]||p,i.browserVersion="";var g=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(o);g||(g=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(o)),i.browserVersion=g?g[4]:"";var v,y=document.createElement("canvas");y.getContext("2d");try{v=y.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){v=!1}var S=!1;"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(y.width=y.height=2,createImageBitmap(y,{}).then((function(t){S=!0,null==t||t.close()})).catch((function(){})));var T=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart,x=void 0!==document.documentElement.onmouseup;return i._featureMap=((n={})[su.WEBP]=v,n[su.IMAGE_BITMAP]=S,n[su.WEB_VIEW]=!0,n[su.VIDEO_PLAYER]=!0,n[su.SAFE_AREA]=!1,n[su.INPUT_TOUCH]=T,n[su.EVENT_KEYBOARD]=void 0!==document.documentElement.onkeyup,n[su.EVENT_MOUSE]=x,n[su.EVENT_TOUCH]=T||x,n[su.EVENT_ACCELEROMETER]=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,n),i._registerEvent(),i}Z(e,t);var n=e.prototype;return n._registerEvent=function(){var t,e=this;t=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,i=function(){n||(n=!0,e.emit("hide"))},r=function(t,i,r,a,o){n&&(n=!1,e.emit("show",t,i,r,a,o))};if(t)for(var a=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],o=0;o<a.length;o++)document.addEventListener(a[o],(function(e){var n=document[t];(n=n||e.hidden)?i():r()}));else window.addEventListener("blur",i),window.addEventListener("focus",r);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",i),window.addEventListener("pageshow",r),document.addEventListener("pagehide",i),document.addEventListener("pageshow",r))},n.hasFeature=function(t){return this._featureMap[t]},n.getBatteryLevel=function(){return this._battery?this._battery.level:1},n.triggerGC=function(){},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},n.restartJSVM=function(){},n.close=function(){this.emit("close"),window.close()},e}(tu)),pu=/(\.[^\.\/\?\\]*)(\?.*)?$/,mu=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,gu=/[^\.\/]+\/\.\.\//;function vu(){for(var t="",e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];t=(t+(""===t?"":"/")+o).replace(/(\/|\\\\)$/,"")}return t}function yu(t){var e=pu.exec(t);return e?e[1]:""}function Su(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function Tu(t,e){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return t;var r=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function xu(t){var e=mu.exec(t);return e?e[2]:""}function Eu(t,e){e=e||"";var n=t.indexOf("?"),i="";return n>0&&(i=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+e+i:t.substring(0,n)+e+i}function Au(t,e,n){if(0===e.indexOf("."))return Eu(t,e);var i=t.indexOf("?"),r="",a=n?yu(t):"";return i>0&&(r=t.substring(i),t=t.substring(0,i)),i=(i=t.lastIndexOf("/"))<=0?0:i+1,t.substring(0,i)+e+a+r}function Cu(t){var e=t=String(t);do{e=t,t=t.replace(gu,"")}while(e.length!==t.length);return t}function bu(t){return t.replace(/[\/\\]$/,"")}function wu(){return du.os===au.WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,join:vu,extname:yu,mainFileName:Su,basename:Tu,dirname:xu,changeExtname:Eu,changeBasename:Au,_normalize:Cu,stripSep:bu,getSeperator:wu}));var Iu,Pu,Ru,Du=t("Asset",Ec("cc.Asset")((_u=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).loaded=!0,st(e,"_native",fu,rt(e)),e._nativeUrl="",e._file=null,e._ref=0,Object.defineProperty(rt(e),"_uuid",{value:"",writable:!0}),e}Z(e,t),e.deserialize=function(t){return l.deserialize(t)};var n=e.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},n.addRef=function(){return this._ref++,this},n.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&l.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},n.validate=function(){return!0},n.destroy=function(){return E(F(12101,this._uuid)),t.prototype.destroy.call(this)},Q(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=Fl(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=Fl(this._uuid,{__nativeName__:t,nativeExt:yu(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}($l(lu)),fu=ct((hu=_u).prototype,"_native",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ct(hu.prototype,"_nativeAsset",[wc],Object.getOwnPropertyDescriptor(hu.prototype,"_nativeAsset"),hu.prototype),uu=hu))||uu);Du.prototype.createNode=null,l.Asset=Du;var Ou=t("Script",Ec("cc.Script")(Iu=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(Du))||Iu);l._Script=Ou;var Nu=t("JavaScript",Ec("cc.JavaScript")(Pu=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(Ou))||Pu);l._JavaScript=Nu;var Mu,Lu,Fu,Bu,zu,Uu,ku,Gu,Vu,Hu,Wu,ju=t("TypeScript",Ec("cc.TypeScript")(Ru=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(Ou))||Ru);l._TypeScript=ju;var Xu,qu,Yu,Ku,Qu=new mt("Comp"),Ju=_l.Flags.IsOnLoadCalled,Zu=t("Component",(Mu=Ec("cc.Component"),Lu=jc(),Fu=al(Ou),Bu=Xc(),Mu((Wu=Hu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"node",ku,rt(e)),st(e,"_enabled",Gu,rt(e)),st(e,"__prefab",Vu,rt(e)),e._sceneGetter=null,e._id=Qu.getNewId(),e}Z(e,t);var n=e.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},n.addComponent=function(t){return this.node.addComponent(t)},n.getComponent=function(t){return this.node.getComponent(t)},n.getComponents=function(t){return this.node.getComponents(t)},n.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},n.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},n.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&l.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),l.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(t){return t||(t=l.instantiate._clone(this,this)),t&&(t.node=null),t},n.schedule=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=l.macro.REPEAT_FOREVER),void 0===i&&(i=0),L(t,1619),L((e=e||0)>=0,1620),n=Number.isNaN(n)?l.macro.REPEAT_FOREVER:n,i=i||0;var r=l.director.getScheduler(),a=r.isTargetPaused(this);r.schedule(t,this,e,n,i,a)},n.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},n.unschedule=function(t){t&&l.director.getScheduler().unschedule(t,this)},n.unscheduleAllCallbacks=function(){l.director.getScheduler().unscheduleAllForTarget(this)},Q(e,[{key:"name",get:function(){if(this._name)return this._name;var t=Pt(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=l.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&Ju}}]),e}(_l),Hu.system=null,ct((Uu=Wu).prototype,"__scriptAsset",[Lu,Fu,Bu,tl],Object.getOwnPropertyDescriptor(Uu.prototype,"__scriptAsset"),Uu.prototype),ku=ct(Uu.prototype,"node",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gu=ct(Uu.prototype,"_enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Vu=ct(Uu.prototype,"__prefab",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zu=Uu))||zu)),$u=Zu.prototype;$u.update=null,$u.lateUpdate=null,$u.__preload=null,$u.onLoad=null,$u.start=null,$u.onEnable=null,$u.onDisable=null,$u.onDestroy=null,$u.onFocusInEditor=null,$u.onLostFocusInEditor=null,$u.resetInEditor=null,$u._getLocalBounds=null,$u.onRestore=null,Zu._requireComponent=null,Zu._executionOrder=0,At(Zu,"_registerEditorProps",(function(t,e){var n=e.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i)})),l.Component=Zu;var th,eh=t("MissingScript",Ec("cc.MissingScript")(Xu=Uc()((Ku=function(t){function e(){var e;return st(e=t.call(this)||this,"_$erialized",Yu,rt(e)),e}return Z(e,t),e.safeFindClass=function(t){var e=Zt(t);if(e)return e;l.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){R(4600,this.node.name)},e}(Zu),Yu=ct((qu=Ku).prototype,"_$erialized",[Dc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xu=qu))||Xu)||Xu);l._MissingScript=eh;try{var nh=eh.__values__;0!==nh.length&&"_$erialized"===nh[nh.length-1]||(T("The '_$erialized' prop in MissingScript is missing. Please contact jare."),T("    Error props: ['"+nh+"']"))}catch(Ka){T("Error when checking MissingScript 5, "+Ka)}!function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(th||(th={}));var ih,rh={auto:th.AUTO,landscape:th.LANDSCAPE,portrait:th.PORTRAIT};!function(t){t[t.Unknown=0]="Unknown",t[t.SubFrame=1]="SubFrame",t[t.BrowserWindow=2]="BrowserWindow",t[t.Fullscreen=3]="Fullscreen"}(ih||(ih={}));var ah=new(function(t){function e(){var e,n,i,r,a,o;(e=t.call(this)||this).isFrameRotated=!1,e.handleResizeEvent=!0,e._gameFrame=void 0,e._gameContainer=void 0,e._gameCanvas=void 0,e._isProportionalToFrame=!1,e._cachedFrameStyle={width:"0px",height:"0px"},e._cachedContainerStyle={width:"0px",height:"0px"},e._cbToUpdateFrameBuffer=void 0,e._supportFullScreen=!1,e._touchEventName=void 0,e._onFullscreenChange=void 0,e._onFullscreenError=void 0,e._orientationChangeTimeoutId=-1,e._cachedFrameSize=new ii(0,0),e._exactFitScreen=!1,e._fn={},e._fnGroup=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],e._resolutionScale=1,e._orientation=th.AUTO,e._gameFrame=document.getElementById("GameDiv"),e._gameContainer=document.getElementById("Cocos3dGameContainer"),e._gameCanvas=document.getElementById("GameCanvas"),e._gameFrame||(e._gameFrame=document.createElement("div"),e._gameFrame.setAttribute("id","GameDiv"),null===(n=e._gameCanvas)||void 0===n||null===(i=n.parentNode)||void 0===i||i.insertBefore(e._gameFrame,e._gameCanvas),e._gameFrame.appendChild(e._gameCanvas)),e._gameContainer||(e._gameContainer=document.createElement("div"),e._gameContainer.setAttribute("id","Cocos3dGameContainer"),null===(r=e._gameCanvas)||void 0===r||null===(a=r.parentNode)||void 0===a||a.insertBefore(e._gameContainer,e._gameCanvas),e._gameContainer.appendChild(e._gameCanvas));for(var s=e._fnGroup,c=0;c<s.length;c++)if(o=s[c],void 0!==document[o[1]]){for(var l=0;l<o.length;l++)e._fn[s[0][l]]=o[l];break}return e._supportFullScreen=void 0!==e._fn.requestFullscreen,e._touchEventName="ontouchstart"in window?"touchend":"mousedown",e._registerEvent(),e}Z(e,t);var n=e.prototype;return n.init=function(t,e){this._cbToUpdateFrameBuffer=e,this.orientation=rh[t.configOrientation],this._exactFitScreen=t.exactFitScreen,this._resizeFrame()},n.requestFullScreen=function(){var t=this;return new Promise((function(e,n){t.isFullScreen?e():(t._cachedFrameSize=t.windowSize,t._doRequestFullScreen().then((function(){e()})).catch((function(){var i=t._getFullscreenTarget();i?i.addEventListener(t._touchEventName,(function(){t._doRequestFullScreen().then((function(){e()})).catch(n)}),{once:!0,capture:!0}):n(new Error("Cannot access fullscreen target"))})))}))},n.exitFullScreen=function(){var t=this;return new Promise((function(e,n){var i=document[t._fn.exitFullscreen]();window.Promise&&i instanceof Promise?i.then((function(){t.windowSize=t._cachedFrameSize,e()})).catch(n):(t.windowSize=t._cachedFrameSize,e())}))},n._registerEvent=function(){var t=this;document.addEventListener(this._fn.fullscreenerror,(function(){var e;null===(e=t._onFullscreenError)||void 0===e||e.call(t)})),window.addEventListener("resize",(function(){t.handleResizeEvent&&t._resizeFrame()})),"function"==typeof window.matchMedia&&function e(){var n,i,r=window.devicePixelRatio;null===(n=window.matchMedia("(resolution: "+r+"dppx)"))||void 0===n||null===(i=n.addEventListener)||void 0===i||i.call(n,"change",(function(){t.emit("window-resize"),e()}),{once:!0})}(),window.addEventListener("orientationchange",(function(){-1!==t._orientationChangeTimeoutId&&clearTimeout(t._orientationChangeTimeoutId),t._orientationChangeTimeoutId=setTimeout((function(){t.handleResizeEvent&&(t._updateFrameState(),t._resizeFrame(),t.emit("orientation-change"),t._orientationChangeTimeoutId=-1)}),200)})),document.addEventListener(this._fn.fullscreenchange,(function(){var e;null===(e=t._onFullscreenChange)||void 0===e||e.call(t),t.emit("fullscreen-change")}))},n._convertToSizeInCssPixels=function(t){var e=t.clone(),n=this.devicePixelRatio;return e.width/=n,e.height/=n,e},n._resizeFrame=function(t){if(this._gameFrame){if(this._gameFrame.style.display="flex",this._gameFrame.style["justify-content"]="center",this._gameFrame.style["align-items"]="center",this._windowType===ih.SubFrame){if(!t)return void this._updateContainer();this._gameFrame.style.width=t.width+"px",this._gameFrame.style.height=t.height+"px"}else{var e=window.innerWidth,n=window.innerHeight;this.isFrameRotated?(this._gameFrame.style["-webkit-transform"]="rotate(90deg)",this._gameFrame.style.transform="rotate(90deg)",this._gameFrame.style["-webkit-transform-origin"]="0px 0px 0px",this._gameFrame.style.transformOrigin="0px 0px 0px",this._gameFrame.style.margin="0 0 0 "+e+"px",this._gameFrame.style.width=n+"px",this._gameFrame.style.height=e+"px"):(this._gameFrame.style["-webkit-transform"]="rotate(0deg)",this._gameFrame.style.transform="rotate(0deg)",this._gameFrame.style.margin="0px auto",this._gameFrame.style.width=e+"px",this._gameFrame.style.height=n+"px")}this._updateContainer()}},n._getFullscreenTarget=function(){var t=this._windowType;return t===ih.Fullscreen?document[this._fn.fullscreenElement]:t===ih.SubFrame?this._gameFrame:document.body},n._doRequestFullScreen=function(){var t=this;return new Promise((function(e,n){if(t._supportFullScreen){var i=t._getFullscreenTarget();if(i){t._onFullscreenChange=void 0,t._onFullscreenError=void 0;var r=i[t._fn.requestFullscreen]();window.Promise&&r instanceof Promise?r.then(e).catch(n):(t._onFullscreenChange=e,t._onFullscreenError=n)}else n(new Error("Cannot access fullscreen target"))}else n(new Error("fullscreen is not supported"))}))},n._updateFrameState=function(){var t=this.orientation,e=window.innerWidth>window.innerHeight;this.isFrameRotated=du.isMobile&&(e&&t===th.PORTRAIT||!e&&t===th.LANDSCAPE)},n._updateContainer=function(){if(this._gameContainer){if(this.isProportionalToFrame){if(!this._gameFrame)return void R(9201);var t,e,n=l.view.getDesignResolutionSize(),i=this._gameFrame,r=i.clientWidth,a=i.clientHeight,o=n.width,s=n.height,c=r/o,u=a/s,h=this._gameContainer.style;c<u?(t=r,e=s*c):(t=o*u,e=a),h.width=t+"px",h.height=e+"px"}else{var f=this._gameContainer.style;f.width="100%",f.height="100%"}!this._gameFrame||this._cachedFrameStyle.width===this._gameFrame.style.width&&this._cachedFrameStyle.height===this._gameFrame.style.height&&this._cachedContainerStyle.width===this._gameContainer.style.width&&this._cachedContainerStyle.height===this._gameContainer.style.height||(this.emit("window-resize"),this._cachedFrameStyle.width=this._gameFrame.style.width,this._cachedFrameStyle.height=this._gameFrame.style.height,this._cachedContainerStyle.width=this._gameContainer.style.width,this._cachedContainerStyle.height=this._gameContainer.style.height)}else R(9201)},Q(e,[{key:"supportFullScreen",get:function(){return this._supportFullScreen}},{key:"isFullScreen",get:function(){return!!this._supportFullScreen&&!!document[this._fn.fullscreenElement]}},{key:"devicePixelRatio",get:function(){var t;return Math.min(null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,2)}},{key:"windowSize",get:function(){var t=this._windowSizeInCssPixels,e=this.devicePixelRatio;return t.width*=e,t.height*=e,t},set:function(t){this._windowType===ih.SubFrame?this._resizeFrame(this._convertToSizeInCssPixels(t)):R(9202)}},{key:"resolution",get:function(){var t=this.windowSize,e=this.resolutionScale;return new ii(t.width*e,t.height*e)}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(t){var e;t!==this._resolutionScale&&(this._resolutionScale=t,null===(e=this._cbToUpdateFrameBuffer)||void 0===e||e.call(this))}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation!==t&&(this._orientation=t,this._updateFrameState())}},{key:"safeAreaEdge",get:function(){return{top:0,bottom:0,left:0,right:0}}},{key:"isProportionalToFrame",get:function(){return this._isProportionalToFrame},set:function(t){this._isProportionalToFrame!==t&&(this._isProportionalToFrame=t,this._updateContainer())}},{key:"_windowSizeInCssPixels",get:function(){if(this.isProportionalToFrame)return this._gameContainer?new ii(this._gameContainer.clientWidth,this._gameContainer.clientHeight):(R(9201),new ii(0,0));var t,e,n;switch(this._windowType){case ih.SubFrame:return this._gameFrame?new ii(this._gameFrame.clientWidth,this._gameFrame.clientHeight):(R(9201),new ii(0,0));case ih.Fullscreen:return t=this._getFullscreenTarget(),e=this.isFrameRotated?t.clientHeight:t.clientWidth,n=this.isFrameRotated?t.clientWidth:t.clientHeight,new ii(e,n);case ih.BrowserWindow:return e=this.isFrameRotated?window.innerHeight:window.innerWidth,n=this.isFrameRotated?window.innerWidth:window.innerHeight,new ii(e,n);case ih.Unknown:default:return new ii(0,0)}}},{key:"_windowType",get:function(){return this.isFullScreen?ih.Fullscreen:this._gameFrame?this._exactFitScreen?ih.BrowserWindow:ih.SubFrame:(R(9201),ih.Unknown)}}]),e}(tu)),oh=function(){function t(){}var e=t.prototype;return e._init=function(t){ah.init(t,(function(){var t,e=l.director;(null===(t=e.root)||void 0===t?void 0:t.pipeline)?e.root.pipeline.pipelineSceneData.shadingScale=ah.resolutionScale:R(1220)}))},e.fullScreen=function(){return ah.isFullScreen},e.requestFullScreen=function(t,e,n){return arguments.length>0&&R(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),ah.requestFullScreen().then((function(){null==e||e()})).catch((function(t){console.error(t),null==n||n()}))},e.exitFullScreen=function(){return ah.exitFullScreen()},e.autoFullScreen=function(t,e){var n;null===(n=this.requestFullScreen(t,e))||void 0===n||n.catch((function(){}))},e.disableAutoFullScreen=function(){},Q(t,[{key:"devicePixelRatio",get:function(){return ah.devicePixelRatio}},{key:"windowSize",get:function(){return ah.windowSize},set:function(t){ah.windowSize=t}},{key:"resolution",get:function(){return ah.resolution}},{key:"supportsFullScreen",get:function(){return ah.supportFullScreen}}]),t}(),sh=t("screen",new oh);l.screen=sh;var ch=t("sys",{Feature:su,hasFeature:function(t){return du.hasFeature(t)},NetworkType:ru,Language:iu,OS:au,Platform:ou,BrowserType:nu,isNative:du.isNative,isBrowser:du.isBrowser,isMobile:du.isMobile,isLittleEndian:du.isLittleEndian,platform:du.platform,language:du.language,languageCode:du.nativeLanguage,os:du.os,osVersion:du.osVersion,osMainVersion:du.osMainVersion,browserType:du.browserType,browserVersion:du.browserVersion,windowPixelResolution:sh.windowSize,capabilities:{canvas:!0,opengl:!0,webp:du.hasFeature(su.WEBP),imageBitmap:du.hasFeature(su.IMAGE_BITMAP),touches:du.hasFeature(su.INPUT_TOUCH),mouse:du.hasFeature(su.EVENT_MOUSE),keyboard:du.hasFeature(su.EVENT_KEYBOARD),accelerometer:du.hasFeature(su.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return du.networkType},getBatteryLevel:function(){return du.getBatteryLevel()},garbageCollect:function(){du.triggerGC()},isObjectValid:function(t){return null!=t},dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",y(t+="Using "+(l.game.renderType===l.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){du.openURL(t)},now:function(){return du.now()},restartVM:function(){du.restartJSVM()},getSafeAreaRect:function(){var t=l.view,e=ah.safeAreaEdge,n=ah.windowSize,i=new Qn(e.left,e.bottom),r=new Qn(n.width-e.right,n.height-e.top);t._convertToUISpace(i),t._convertToUISpace(r);var a=i.x,o=i.y,s=r.x-i.x,c=r.y-i.y;return new ai(a,o,s,c)}});!function(){try{var t=ch.localStorage=window.localStorage;t.setItem("storage",""),t.removeItem("storage"),t=null}catch(t){var e=function(){R(5200)};ch.localStorage={getItem:e,setItem:e,clear:e,removeItem:e}}ch.__isWebIOS14OrIPadOS14Env=(ch.os===au.IOS||ch.os===au.OSX)&&du.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}(),l.sys=ch;var lh=t("serializeTag",Symbol("[[Serialize]]")),uh=t("deserializeTag",Symbol("[[Deserialize]]")),hh=function(){function t(t,e){this._document=void 0,this._chunks=void 0,this._document=t,this._chunks=e}return Q(t,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t}();function fh(t){var e=t;return{chunks:e.chunks,document:e.document}}function _h(t){if(t.length<16)throw new dh(F(13102));var e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new dh(F(13100));var n=e.getUint32(4,!0);if(1!==n)throw new dh(F(13101,n));if(e.getUint32(8,!0)!==e.byteLength)throw new dh(F(13102));var i=12,r=e.getUint32(i,!0);i+=4;var a=new Uint8Array(e.buffer,i+e.byteOffset,r);i+=r;var o,s=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(F(13104))}(a);try{o=JSON.parse(s)}catch(t){throw new dh(t)}for(var c=[];i<e.byteLength;){i%8!=0&&(i+=8-i%8);var l=e.getUint32(i,!0);i+=4,c.push(new Uint8Array(e.buffer,i+e.byteOffset,l)),i+=l}if(i!==e.byteLength)throw new dh(F(13102));return new hh(o,c)}var dh=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(it(Error));function ph(t,e,n,i,r){if(e instanceof l.ValueType){r||t.push("if(prop){");var a=Pt(e);t.push("s._deserializeFastDefinedObject(o"+n+",prop,"+a+");"),r||t.push("}else o"+n+"=null;")}else t.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+i+");\n} else {\n    o"+n+"=null;\n}\n")}!function(){function t(){this._viewOrPaddings=[],this._length=0}var e=t.prototype;e.alignAs=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;return this._viewOrPaddings.push(n),this._length+=n,n}}return 0},e.append=function(t){var e=this._length;return this._viewOrPaddings.push(t),this._length+=t.byteLength,e},e.get=function(){var t=new Uint8Array(this._length),e=0;return this._viewOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e),e+=n.byteLength)})),t},Q(t,[{key:"byteLength",get:function(){return this._length}}])}(),l.internal.parseCCONJson=fh,l.internal.decodeCCONBinary=_h,l.internal.CCON=hh;var mh="$_$default",gh="$_$formerlySerializedAs",vh=function(t){function e(){return t.call(this,(function(t){t.clear()}),1)||this}return Z(e,t),e.prototype.get=function(t,e,n,i,r){var a=this._get();return a?(a.reset(t,e,n,i,r),a):new yh(t,e,n,i,r)},e}(ee),yh=function(){function t(t,e,n,i){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced}var e=t.prototype;return e.reset=function(t,e,n,i){this.result=t,this.customEnv=i,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced},e.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},e.deserialize=function(t){var e,n=!1;t instanceof hh?(n=!0,e=t.document,t.chunks.length>0&&(t.chunks.length,this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:n};var i=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(i,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},e._deserializeObject=function(t,e,n,i){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,n,i):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}},e._deserializeTypedArrayView=function(t){return globalThis[t.ctor].from(t.array)},e._deserializeTypedArrayViewRef=function(t){var e=t.offset,n=t.length,i=t.ctor;return new globalThis[i](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,n)},e._deserializeArray=function(t){for(var e,n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof(e=t[i])&&e?this._deserializeAndAssignField(n,e,""+i)&&(n[i]=null):n[i]=e;return n},e._deserializePlainObject=function(t){var e={};return this._fillPlainObject(e,t),e},e._deserializeTypeTaggedObject=function(t,e,n,i){var r=this,a=t.__type__,o=this._classFinder(a,t,n,i);if(!o)return this._classFinder===Zt&&this._reportMissingClass(a),null;var s=function(t){var n=new t;return e>=0&&(r.deserializedList[e]=n),n}(o);return this._deserializeInto(t,s,o),s},e._deserializeInto=function(t,e,n,i){void 0===i&&(i=!1),i||!e[uh]?e._deserialize?e._deserialize(t.content,this):l.Class._isCCClass(n)?this._deserializeFireClass(e,t,n):this._deserializeFastDefinedObject(e,t,n):this._runCustomizedDeserialize(t,e,n)},e._runCustomizedDeserialize=function(t,e,n){var i=this,r={readProperty:function(e){var n=t[e];return"object"==typeof n&&n?i._deserializeObjectField(n):n},readThis:function(){i._deserializeInto(t,e,n,!0)},readSuper:function(){var r=Gt(n);r&&i._deserializeInto(t,e,r)}};e[uh](r,this._context)},e._deserializeFireClass=function(t,e,n){var i;if(n.hasOwnProperty("__deserialize__"))i=n.__deserialize__;else{i=function(t,e){for(var n=Re(e),i=e.__values__,r=["var prop;"],a=fe.test(te(e)),o=0;o<i.length;o++){var s=i[o],c=void 0,u=void 0;tn.IDENTIFIER_RE.test(s)?(u='"'+s+'"',c="."+s):c="["+(u=tn.escapeForJS(s))+"]";var h=c;if(n[s+gh]){var f=n[s+gh];h=tn.IDENTIFIER_RE.test(f)?"."+f:"["+tn.escapeForJS(f)+"]"}r.push("prop=d"+h+";"),r.push('if(typeof prop!=="undefined"){');var _=tn.getDefault(n[s+mh]);if(a){var d=void 0,p=n[s+"$_$type"];if(void 0===_&&p)d=p instanceof Oe;else{var m=typeof _;d="string"===m||"number"===m||"boolean"===m}d?r.push("o"+c+"=prop;"):ph(r,_,c,u,!0)}else r.push('if(typeof prop!=="object"){o'+c+"=prop;}else{"),ph(r,_,c,u,!1),r.push("}");r.push("}")}return(l.js.isChildClassOf(e,l._BaseNode)||l.js.isChildClassOf(e,l.Component))&&r.push("d._id&&(o._id=d._id);"),"_$erialized"===i[i.length-1]&&(r.push("o._$erialized=JSON.parse(JSON.stringify(d));"),r.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",r.join(""))}(0,n);try{if(n===eh){var r=n.__values__;0!==r.length&&"_$erialized"===r[r.length-1]||(T("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),T("    Error props: ['"+r+"']. Please contact jare."));var a=i;i=function(t,e,n,i){a(t,e,n,i),e._$erialized||T("Unable to stash previously serialized data. "+JSON.stringify(n))}}}catch(t){T("Error when checking MissingScript 6, "+t)}At(n,"__deserialize__",i,!0)}i(this,t,e,n)},e._deserializeAndAssignField=function(t,e,n){var i=e.__id__;if("number"==typeof i){var r=this.deserializedList[i];if(r)t[n]=r;else{var a,o=this._serializedData[i];t[n]=this._deserializeObject(o,i,void 0,n),null===(a=this._onDereferenced)||void 0===a||a.call(this,this.deserializedList,i,t,n)}}else{var s=e.__uuid__;if(s){var c=e.__expectedType__;this.result.push(t,n,s,c)}else t[n]=this._deserializeObject(e,-1)}return!1},e._deserializeObjectField=function(t){var e=t.__id__;if("number"==typeof e){var n=this.deserializedList[e];if(n)return n;var i=this._serializedData[e];return this._deserializeObject(i,e,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)},e._fillPlainObject=function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"object"!=typeof i?"__type__"!==n&&(t[n]=i):i?this._deserializeAndAssignField(t,i,n)&&(t[n]=null):t[n]=null}},e._deserializeFastDefinedObject=function(t,e,n){if(n===l.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(n===l.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(n!==l.Color){if(n===l.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var i=Re(n),r=n.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];void 0!==s||e.hasOwnProperty(o)||(s=tn.getDefault(i[o+mh])),"object"!=typeof s?t[o]=s:s?this._deserializeAndAssignField(t,s,o):t[o]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var c=e.a;t.a=void 0===c?255:c}},t}();yh.pool=new vh;var Sh=[Qn,Dn,ti,zn,Pn,ii,ai,Xn];function Th(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var xh=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},Th,Th,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Xn.fromArray(t,e,1)}],Eh=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var e=t.prototype;return e.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},e.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},e.push=function(t,e,n,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(n),this.uuidTypeList.push(i||"")},t}());function Ah(t,e){for(var n=t[4][e[0]],i=n[0],r=new(0,i[0]),a=i[1],o=i[2],s=n[n.length-1],c=1;c<s;++c)r[a[n[c]]]=e[c];for(;c<e.length;++c){var l=a[n[c]],u=i[n[c]+o];(0,Rh[u])(t,r,l,e[c])}return r}function Ch(t,e,n){var i=new e;return i._deserialize?i._deserialize(n,t[0]):O(5303,Pt(e)),i}function bh(t,e,n,i){i>=0?e[n]=t[5][i]:t[7][3*~i]=e}function wh(t){return function(e,n,i,r){n[i]=r;for(var a=0;a<r.length;++a)t(e,r,a,r[a])}}function Ih(t,e,n,i){e[n]=null,t[8][i]=e}function Ph(t,e,n,i){e[n]=Ah(t,i)}Eh.pool=new ee((function(t){t.reset()}),5),Eh.pool.get=function(){return this._get()||new Eh};var Rh=new Array(13);function Dh(t,e,n){return t||n(e),Object}function Oh(t,e,n,i,r,a,o){var s=t(e);if(!s){if(r)return void(n[i]=function(e,n,i){return function(){var r=t(i)||Dh(a,i,o);return e[n]=r,new r}}(n,i,e));s=Dh(a,e,o)}n[i]=s}function Nh(t,e,n,i){for(var r=n||Zt,a=t[3],o=0;o<a.length;++o){var s=a[o];"string"!=typeof s?Oh(r,s[0],s,0,e,n,i):Oh(r,s,a,o,e,n,i)}}function Mh(t){var e=t[4];if(e)for(var n=t[3],i=0;i<e.length;++i){var r=e[i];r[0]=n[r[0]]}}function Lh(t,e,n){"string"==typeof t&&(t=JSON.parse(t));var i,r=!e;if(e=e||Eh.pool.get(),function(t){if(Array.isArray(t)){var e=t[0];return"number"==typeof e||e instanceof Fh}return!1}(t)){e.init(t),n=n||{};var a,o=t[0],s=!1;if("object"==typeof o&&(s=o.preprocessed,o=o.version),o<1)throw new Error(F(5304,o));n._version=o,n.result=e,t[0]=n,s||(Nh(t,!1,n.classFinder,null!==(a=n.reportMissingClass)&&void 0!==a?a:Lh.reportMissingClass),Mh(t)),l.game._isCloning=!0;var c=t[5],u=function(t){var e=t[5],n=t[6],i=0===n?0:n.length,r=e[e.length-1],a=e.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--a);for(var o=0;o<a;++o)e[o]=Ah(t,e[o]);for(var s=t[3],c=0;c<i;++c,++o){var l=n[c],u=e[o];if(l>=0){var h=s[l];e[o]=Ch(t,h,u)}else(0,Rh[l=~l])(t,e,o,u)}return r}(t);l.game._isCloning=!1,t[7]&&function(t,e,n){for(var i=t.length-1,r=0,a=3*t[i];r<a;r+=3){var o=t[r],s=e[t[r+2]],c=t[r+1];c>=0?o[n[c]]=s:o[~c]=s}for(;r<i;r+=3){var l=e[t[r]],u=e[t[r+2]],h=t[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(t[7],c,t[2]),function(t){for(var e=t[5],n=t[2],i=t[1],r=t[8],a=t[9],o=t[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=e[c]);var l=a[s];"number"==typeof l&&(l=l>=0?n[l]:~l,a[s]=l);var u=o[s];"number"==typeof u&&(o[s]=i[u])}}(t),i=c[u]}else i=function(t,e,n){var i,r=(n=n||{}).classFinder||Zt,a=n.createAssetRefs||ch.platform===ou.EDITOR_CORE,o=n.customEnv,s=n.ignoreEditorOnly,c=null!==(i=n.reportMissingClass)&&void 0!==i?i:l.deserialize.reportMissingClass;e.init();var u=yh.pool.get(e,r,c,o,s);l.game._isCloning=!0;var h=u.deserialize(t);return l.game._isCloning=!1,yh.pool.put(u),a&&e.assignAssetsBy(EditorExtends.serialize.asAsset),h}(t,e,n);return r&&Eh.pool.put(e),i}Rh[0]=function(t,e,n,i){e[n]=i},Rh[1]=bh,Rh[2]=wh(bh),Rh[3]=wh(Ih),Rh[4]=Ph,Rh[5]=function(t,e,n,i){xh[i[0]](e[n],i)},Rh[6]=Ih,Rh[7]=function(t,e,n,i){e[n].set(i)},Rh[8]=function(t,e,n,i){var r=new Sh[i[0]];xh[i[0]](r,i),e[n]=r},Rh[9]=wh(Ph),Rh[10]=function(t,e,n,i){var r=t[3][i[0]];e[n]=Ch(t,r,i[1])},Rh[11]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=1;a<i.length;a+=3){var o=i[a],s=i[a+1],c=i[a+2];(0,Rh[s])(t,r,o,c)}},Rh[12]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=0;a<r.length;++a){var o=r[a],s=i[a+1];0!==s&&(0,Rh[s])(t,r,a,o)}},Lh.Details=Eh,Lh.reportMissingClass=function(t){O(5302,t)};var Fh=function(t){this.preprocessed=!0,this.version=t};function Bh(t,e,n){return[1,0,0,[t],0,n?[e,-1]:[e],[0],0,[],[],[]]}l.deserialize=Lh;var zh,Uh,kh,Gh,Vh,Hh,Wh,jh,Xh,qh,Yh,Kh=_l.Flags.Destroyed,Qh=_l.Flags.PersistentMask,Jh=[];function Zh(t){var e;if(t instanceof _l){if(t._instantiate)return l.game._isCloning=!0,e=t._instantiate(null,!0),l.game._isCloning=!1,e;if(t instanceof l.Asset)throw new TypeError(F(6903))}return l.game._isCloning=!0,e=$h(t),l.game._isCloning=!1,e}function $h(t,e){var n;tf(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var i=0,r=Jh.length;i<r;++i)Jh[i]._iN$t=null;return Jh.length=0,n}function tf(t,e,n){ie.value(t,"_iN$t",e,!0),Jh.push(t);var i=t.constructor;if(en(i))!function(t,e,n,i){for(var r=t.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];if("object"==typeof s&&s){var c=n[o];c instanceof ue&&c.constructor===s.constructor?c.set(s):n[o]=s._iN$t||ef(s,i)}else n[o]=s}}(i,t,e,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r||"__prefab"===r)){var a=t[r];if("object"==typeof a&&a){if(a===e)continue;e[r]=a._iN$t||ef(a,n)}else e[r]=a}t instanceof _l&&(e._objFlags&=Qh)}function ef(t,e){if(t instanceof ue)return t.clone();if(t instanceof l.Asset)return t;var n;if(ArrayBuffer.isView(t)){var i=t.length;n=new t.constructor(i),t._iN$t=n,Jh.push(t);for(var r=0;r<i;++r)n[r]=t[r];return n}if(Array.isArray(t)){var a=t.length;n=new Array(a),t._iN$t=n,Jh.push(t);for(var o=0;o<a;++o){var s=t[o];n[o]="object"==typeof s&&s?s._iN$t||ef(s,e):s}return n}if(t._objFlags&Kh)return null;var c=t.constructor;if(en(c)){if(e)if(e instanceof l.Component){if(t instanceof l._BaseNode||t instanceof l.Component)return t}else if(e instanceof l._BaseNode)if(t instanceof l._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof l.Component&&t.node&&!t.node.isChildOf(e))return t;n=new c}else if(c===Object)n={};else{if(c)return t;n=Object.create(null)}return tf(t,n,e),n}function nf(t,e){return(e<<3)+t}function rf(t){return of[t]}function af(t){switch(t){case qh.Uint8:return Uint8Array;case qh.Uint16:return Uint16Array;case qh.Uint32:return Uint32Array;case qh.Int8:return Int8Array;case qh.Int16:return Int16Array;case qh.Int32:return Int32Array;case qh.Float32:return Float32Array;case qh.Float64:return Float64Array}}Zh._clone=$h,l.instantiate=Zh,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(qh||(qh={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(Yh||(Yh={})),t("CompactValueTypeArray",Ec("cc.CompactValueTypeArray")((jh=Wh=function(){function t(){st(this,"_byteOffset",kh,this),st(this,"_unitCount",Gh,this),st(this,"_unitElement",Vh,this),st(this,"_length",Hh,this)}return t.lengthFor=function(t,e,n){return rf(e).requiredUnits*t.length*af(n).BYTES_PER_ELEMENT},t.compress=function(e,n,i,r,a,o){for(var s=rf(n),c=af(i),l=s.requiredUnits*e.length,u=new c(r,a,l),h=0;h<e.length;++h)s.compress(u,h,e[h]);var f=new t;return f._unitElement=nf(i,n),f._byteOffset=o,f._unitCount=l,f._length=e.length,f},t.prototype.decompress=function(t){for(var e,n={storageUnit:7&(e=this._unitElement),elementType:e>>3},i=n.storageUnit,r=rf(n.elementType),a=new(af(i))(t,this._byteOffset,this._unitCount),o=new Array(this._length),s=0;s<this._length;++s)o[s]=r.decompress(a,s);return o},t}(),Wh.StorageUnit=qh,Wh.ElementType=Yh,kh=ct((Uh=jh).prototype,"_byteOffset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gh=ct(Uh.prototype,"_unitCount",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vh=ct(Uh.prototype,"_unitElement",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nf(qh.Uint8,Yh.Scalar)}}),Hh=ct(Uh.prototype,"_length",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zh=Uh))||zh);var of=((Xh={})[Yh.Scalar]={requiredUnits:1,compress:function(t,e,n){t[e]=n},decompress:function(t,e){return t[e]}},Xh[Yh.Vec2]={requiredUnits:2,compress:function(t,e,n){t[2*e]=n.x,t[2*e+1]=n.y},decompress:function(t,e){return new Dn(t[2*e],t[2*e+1])}},Xh[Yh.Vec3]={requiredUnits:3,compress:function(t,e,n){t[3*e]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z},decompress:function(t,e){return new Dn(t[3*e],t[3*e+1],t[3*e+2])}},Xh[Yh.Vec4]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new ti(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},Xh[Yh.Quat]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new zn(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},Xh[Yh.Mat4]={requiredUnits:16,compress:function(t,e,n){Xn.toArray(t,n,16*e)},decompress:function(t,e){return Xn.fromArray(new Xn,t,16*e)}},Xh);function sf(){return 0}function cf(t){return t}function lf(t){return t*t}function uf(t){return t*(2-t)}function hf(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function ff(t){return t*t*t}function _f(t){return--t*t*t+1}function df(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function pf(t){return t*t*t*t}function mf(t){return 1- --t*t*t*t}function gf(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function vf(t){return t*t*t*t*t}function yf(t){return--t*t*t*t*t+1}function Sf(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function Tf(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function xf(t){return Math.sin(t*Math.PI/2)}function Ef(t){return.5*(1-Math.cos(Math.PI*t))}function Af(t){return 0===t?0:Math.pow(1024,t-1)}function Cf(t){return 1===t?1:1-Math.pow(2,-10*t)}function bf(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function wf(t){return 1-Math.sqrt(1-t*t)}function If(t){return Math.sqrt(1- --t*t)}function Pf(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Rf(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function Df(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function Of(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}function Nf(t){if(1===t)return 1;var e=1.70158;return t*t*((e+1)*t-e)}function Mf(t){if(0===t)return 0;var e=1.70158;return--t*t*((e+1)*t+e)+1}function Lf(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}function Ff(t){return 1-Bf(1-t)}function Bf(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function zf(t){return t<.5?.5*Ff(2*t):.5*Bf(2*t-1)+.5}function Uf(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function kf(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}l._decorator=ul;var Gf=Jf(lf,uf),Vf=Jf(ff,_f),Hf=Jf(pf,mf),Wf=Jf(vf,yf),jf=Jf(Tf,xf),Xf=Jf(Af,Cf),qf=Jf(wf,If),Yf=Jf(Rf,Df),Kf=Jf(Nf,Mf),Qf=Jf(Ff,Bf);function Jf(t,e){return function(n){return n<.5?e(2*n)/2:t(2*n-1)/2+.5}}var Zf,$f,t_=Object.freeze({__proto__:null,constant:sf,linear:cf,quadIn:lf,quadOut:uf,quadInOut:hf,cubicIn:ff,cubicOut:_f,cubicInOut:df,quartIn:pf,quartOut:mf,quartInOut:gf,quintIn:vf,quintOut:yf,quintInOut:Sf,sineIn:Tf,sineOut:xf,sineInOut:Ef,expoIn:Af,expoOut:Cf,expoInOut:bf,circIn:wf,circOut:If,circInOut:Pf,elasticIn:Rf,elasticOut:Df,elasticInOut:Of,backIn:Nf,backOut:Mf,backInOut:Lf,bounceIn:Ff,bounceOut:Bf,bounceInOut:zf,smooth:Uf,fade:kf,quadOutIn:Gf,cubicOutIn:Vf,quartOutIn:Hf,quintOutIn:Wf,sineOutIn:jf,expoOutIn:Xf,circOutIn:qf,elasticOutIn:Yf,backOutIn:Kf,bounceOutIn:Qf});t("easing",t_),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.QUAD_IN=2]="QUAD_IN",t[t.QUAD_OUT=3]="QUAD_OUT",t[t.QUAD_IN_OUT=4]="QUAD_IN_OUT",t[t.QUAD_OUT_IN=5]="QUAD_OUT_IN",t[t.CUBIC_IN=6]="CUBIC_IN",t[t.CUBIC_OUT=7]="CUBIC_OUT",t[t.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",t[t.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",t[t.QUART_IN=10]="QUART_IN",t[t.QUART_OUT=11]="QUART_OUT",t[t.QUART_IN_OUT=12]="QUART_IN_OUT",t[t.QUART_OUT_IN=13]="QUART_OUT_IN",t[t.QUINT_IN=14]="QUINT_IN",t[t.QUINT_OUT=15]="QUINT_OUT",t[t.QUINT_IN_OUT=16]="QUINT_IN_OUT",t[t.QUINT_OUT_IN=17]="QUINT_OUT_IN",t[t.SINE_IN=18]="SINE_IN",t[t.SINE_OUT=19]="SINE_OUT",t[t.SINE_IN_OUT=20]="SINE_IN_OUT",t[t.SINE_OUT_IN=21]="SINE_OUT_IN",t[t.EXPO_IN=22]="EXPO_IN",t[t.EXPO_OUT=23]="EXPO_OUT",t[t.EXPO_IN_OUT=24]="EXPO_IN_OUT",t[t.EXPO_OUT_IN=25]="EXPO_OUT_IN",t[t.CIRC_IN=26]="CIRC_IN",t[t.CIRC_OUT=27]="CIRC_OUT",t[t.CIRC_IN_OUT=28]="CIRC_IN_OUT",t[t.CIRC_OUT_IN=29]="CIRC_OUT_IN",t[t.ELASTIC_IN=30]="ELASTIC_IN",t[t.ELASTIC_OUT=31]="ELASTIC_OUT",t[t.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",t[t.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",t[t.BACK_IN=34]="BACK_IN",t[t.BACK_OUT=35]="BACK_OUT",t[t.BACK_IN_OUT=36]="BACK_IN_OUT",t[t.BACK_OUT_IN=37]="BACK_OUT_IN",t[t.BOUNCE_IN=38]="BOUNCE_IN",t[t.BOUNCE_OUT=39]="BOUNCE_OUT",t[t.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",t[t.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",t[t.SMOOTH=42]="SMOOTH",t[t.FADE=43]="FADE"}($f||($f={}));var e_,n_=((Zf={})[$f.CONSTANT]=sf,Zf[$f.LINEAR]=cf,Zf[$f.QUAD_IN]=lf,Zf[$f.QUAD_OUT]=uf,Zf[$f.QUAD_IN_OUT]=hf,Zf[$f.QUAD_OUT_IN]=Gf,Zf[$f.CUBIC_IN]=ff,Zf[$f.CUBIC_OUT]=_f,Zf[$f.CUBIC_IN_OUT]=df,Zf[$f.CUBIC_OUT_IN]=Vf,Zf[$f.QUART_IN]=pf,Zf[$f.QUART_OUT]=mf,Zf[$f.QUART_IN_OUT]=gf,Zf[$f.QUART_OUT_IN]=Hf,Zf[$f.QUINT_IN]=vf,Zf[$f.QUINT_OUT]=yf,Zf[$f.QUINT_IN_OUT]=Sf,Zf[$f.QUINT_OUT_IN]=Wf,Zf[$f.SINE_IN]=Tf,Zf[$f.SINE_OUT]=xf,Zf[$f.SINE_IN_OUT]=Ef,Zf[$f.SINE_OUT_IN]=jf,Zf[$f.EXPO_IN]=Af,Zf[$f.EXPO_OUT]=Cf,Zf[$f.EXPO_IN_OUT]=bf,Zf[$f.EXPO_OUT_IN]=Xf,Zf[$f.CIRC_IN]=wf,Zf[$f.CIRC_OUT]=If,Zf[$f.CIRC_IN_OUT]=Pf,Zf[$f.CIRC_OUT_IN]=qf,Zf[$f.ELASTIC_IN]=Rf,Zf[$f.ELASTIC_OUT]=Df,Zf[$f.ELASTIC_IN_OUT]=Of,Zf[$f.ELASTIC_OUT_IN]=Yf,Zf[$f.BACK_IN]=Nf,Zf[$f.BACK_OUT]=Mf,Zf[$f.BACK_IN_OUT]=Lf,Zf[$f.BACK_OUT_IN]=Kf,Zf[$f.BOUNCE_IN]=Ff,Zf[$f.BOUNCE_OUT]=Bf,Zf[$f.BOUNCE_IN_OUT]=zf,Zf[$f.BOUNCE_OUT_IN]=Qf,Zf[$f.SMOOTH]=Uf,Zf[$f.FADE]=kf,Zf);function i_(t){return n_[t]}i(255),i(65280);var r_,a_,o_,s_=uc.LINEAR<<0|fc.NONE<<8|$f.LINEAR<<16,c_=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).value=0,e.rightTangent=0,e.rightTangentWeight=0,e.leftTangent=0,e.leftTangentWeight=0,e._flags=s_,e}return Z(e,t),Q(e,[{key:"interpolationMode",get:function(){return(255&this._flags)>>0},set:function(t){this._flags&=-256,this._flags|=t<<0}},{key:"tangentWeightMode",get:function(){return(65280&this._flags)>>8},set:function(t){this._flags&=-65281,this._flags|=t<<8}},{key:"easingMethod",get:function(){return(16711680&this._flags)>>16},set:function(t){this._flags&=-16711681,this._flags|=t<<16}}]),e}(ll);function l_(t){var e=new c_;if("number"==typeof t)e.value=t;else{var n=t.interpolationMode,i=t.tangentWeightMode,r=t.value,a=t.rightTangent,o=t.rightTangentWeight,s=t.leftTangent,c=t.leftTangentWeight,l=t.easingMethod,u=t[cl];e.value=null!=r?r:e.value,e.rightTangent=null!=a?a:e.rightTangent,e.rightTangentWeight=null!=o?o:e.rightTangentWeight,e.leftTangent=null!=s?s:e.leftTangent,e.leftTangentWeight=null!=c?c:e.leftTangentWeight,e.interpolationMode=null!=n?n:e.interpolationMode,e.tangentWeightMode=null!=i?i:e.tangentWeightMode,e.easingMethod=null!=l?l:e.easingMethod,u&&(e[cl]=u)}return e}tn.fastDefine("cc.RealKeyframeValue",c_,((e_={interpolationMode:uc.LINEAR,tangentWeightMode:fc.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:$f.LINEAR})[cl]=void 0,e_)),tn.Attr.setClassAttr(c_,cl,"editorOnly",!0),(r_=c_,null!==(o_=(a_=r_)[Rc])&&void 0!==o_?o_:a_[Rc]={}).uniquelyReferenced=!0;var u_,h_=t("RealCurve",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).preExtrapolation=hc.CLAMP,e.postExtrapolation=hc.CLAMP,e}Z(e,t);var n=e.prototype;return n.evaluate=function(t){var e=this._times,n=this._values,i=e.length;if(0===i)return 0;var r=e[0],a=e[i-1];if(t<r){var o=this.preExtrapolation,s=n[0];if(o===hc.CLAMP||i<2)return s.value;switch(o){case hc.LINEAR:return w_(r,n[0].value,e[1],n[1].value,t);case hc.LOOP:t=C_(t,r,a);break;case hc.PING_PONG:t=b_(t,r,a);break;default:return s.value}}else if(t>a){var c=this.postExtrapolation,l=n[i-1];if(c===hc.CLAMP||i<2)return l.value;switch(c){case hc.LINEAR:return w_(a,l.value,e[i-2],n[i-2].value,t);case hc.LOOP:t=C_(t,r,a);break;case hc.PING_PONG:t=b_(t,r,a);break;default:return l.value}}var u=lc(e,t);if(u>=0)return n[u].value;var h=~u,f=h-1,_=e[f],d=n[f],p=e[h];return function(t,e,n,i,r){var a=n-t;switch(e.interpolationMode){default:case uc.CONSTANT:return e.value;case uc.LINEAR:var o=e.easingMethod===$f.LINEAR?r:i_(e.easingMethod)(r);return fn(e.value,i.value,o);case uc.CUBIC:var s=1/3,c=e.rightTangent,l=e.rightTangentWeight,u=0!=(e.tangentWeightMode&fc.RIGHT),h=i.leftTangent,f=i.leftTangentWeight,_=0!=(i.tangentWeightMode&fc.LEFT);if(u||_){var d=0;if(u)d=l;else{var p=a,m=a*c;d=Math.sqrt(p*p+m*m)*s}var g=Math.atan(c),v=Math.cos(g)*d+t,y=Math.sin(g)*d+e.value,S=0;if(_)S=f;else{var T=a,x=a*h;S=Math.sqrt(T*T+x*x)*s}var E=Math.atan(h),A=(v-t)/a,C=(-Math.cos(E)*S+n-t)/a,b=y,w=-Math.sin(E)*S+i.value,I=[0,0,0],P=function(t,e,n,i,r){var a=n/i,o=e/i,s=a*a,c=1/3*(-1/3*s+o),l=.5*(2/27*a*s-1/3*a*o+t/i),u=c*c*c,h=l*l+u,f=0;if(dc(h)){if(dc(l))return r[0]=0,1;var _=Math.cbrt(-l);return r[0]=2*_,r[1]=-_,2}if(h<0){var d=1/3*Math.acos(-l/Math.sqrt(-u)),p=2*Math.sqrt(-c);r[0]=p*Math.cos(d),r[1]=-p*Math.cos(d+Math.PI/3),r[2]=-p*Math.cos(d-Math.PI/3),f=3}else{var m=Math.sqrt(h),g=Math.cbrt(m-l),v=-Math.cbrt(m+l);r[0]=g+v,f=1}for(var y=1/3*a,S=0;S<f;++S)r[S]-=y;return f}(0-r,3*A,3*C-6*A,3*(A-C)+1,I),R=function(t,e,n){var i=n;if(1===e)i=t[0];else{i=-1/0;for(var r=0;r<e;++r){var a=t[r];a>=0&&a<=1&&a>i&&(i=a)}i===-1/0&&(i=0)}return i}(I,P,r);return I_(e.value,b,w,i.value,R)}var D=e.value+s*c*a,O=i.value-s*h*a;return I_(e.value,D,O,i.value,r)}}(_,d,p,n[h],(t-_)/(p-_))},n.addKeyFrame=function(e,n){return t.prototype.addKeyFrame.call(this,e,l_(n))},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return l_(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return l_(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var e=this._values[0].value;return this._values.every((function(n){return ln(n.value,e,t)}))},n[lh]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=n.length,a=new DataView(new ArrayBuffer(0+f_+f_+__+d_*r+x_*r)),o=0;a.setUint8(o,this.preExtrapolation),o+=f_,a.setUint8(o,this.postExtrapolation),o+=f_,a.setUint32(o,r,!0),o+=__,n.forEach((function(t,e){return a.setFloat32(o+d_*e,t,!0)})),o+=d_*r;for(var s,c=ot(i);!(s=c()).done;){var l=s.value;o=E_(a,l,o)}var u=new Uint8Array(a.buffer,0,o);t.writeProperty("bytes",u);var h=i.map((function(t){return t[cl]}));h.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",h)}else t.writeThis()},n[uh]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;this.preExtrapolation=i.getUint8(r),r+=f_,this.postExtrapolation=i.getUint8(r),r+=f_;var a=i.getUint32(r,!0);r+=__;var o=Array.from({length:a},(function(t,e){return i.getFloat32(r+d_*e,!0)}));r+=d_*a;for(var s=new Array(a),c=0;c<a;++c){var l=l_({});r=A_(i,l,r),s[c]=l}n.byteLength;var u=t.readProperty("keyframeValueEditorExtras");u&&(u.length,u.forEach((function(t,e){return s[e][cl]=t}))),this._times=o,this._values=s}else t.readThis()},e}(_c));tn.fastDefine("cc.RealCurve",h_,{_times:[],_values:[],preExtrapolation:hc.CLAMP,postExtrapolation:hc.CLAMP}),function(t){t[t.VALUE=1]="VALUE",t[t.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",t[t.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",t[t.LEFT_TANGENT=8]="LEFT_TANGENT",t[t.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",t[t.RIGHT_TANGENT=32]="RIGHT_TANGENT",t[t.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}(u_||(u_={}));var f_=1,__=4,d_=4,p_=l_({}),m_=p_.interpolationMode,g_=p_.tangentWeightMode,v_=p_.leftTangent,y_=p_.leftTangentWeight,S_=p_.rightTangent,T_=p_.rightTangentWeight,x_=26;function E_(t,e,n){var i=0,r=n,a=r;r+=4;var o=e.value,s=e.interpolationMode,c=e.tangentWeightMode,l=e.rightTangent,u=e.rightTangentWeight,h=e.leftTangent,f=e.leftTangentWeight,_=e.easingMethod;return t.setFloat32(r,o,!0),r+=4,s!==m_&&(i|=u_.INTERPOLATION_MODE,t.setUint8(r,s),r+=1),c!==g_&&(i|=u_.TANGENT_WEIGHT_MODE,t.setUint8(r,c),r+=1),h!==v_&&(i|=u_.LEFT_TANGENT,t.setFloat32(r,h,!0),r+=4),f!==y_&&(i|=u_.LEFT_TANGENT_WEIGHT,t.setFloat32(r,f,!0),r+=4),l!==S_&&(i|=u_.RIGHT_TANGENT,t.setFloat32(r,l,!0),r+=4),u!==T_&&(i|=u_.RIGHT_TANGENT_WEIGHT,t.setFloat32(r,u,!0),r+=4),i|=_<<8,t.setUint32(a,i,!0),r}function A_(t,e,n){var i=n,r=t.getUint32(i,!0);i+=4,e.value=t.getFloat32(i,!0),i+=4,r&u_.INTERPOLATION_MODE&&(e.interpolationMode=t.getUint8(i),i+=1),r&u_.TANGENT_WEIGHT_MODE&&(e.tangentWeightMode=t.getUint8(i),i+=1),r&u_.LEFT_TANGENT&&(e.leftTangent=t.getFloat32(i,!0),i+=4),r&u_.LEFT_TANGENT_WEIGHT&&(e.leftTangentWeight=t.getFloat32(i,!0),i+=4),r&u_.RIGHT_TANGENT&&(e.rightTangent=t.getFloat32(i,!0),i+=4),r&u_.RIGHT_TANGENT_WEIGHT&&(e.rightTangentWeight=t.getFloat32(i,!0),i+=4);var a=(65280&r)>>8;return e.easingMethod=a,i}function C_(t,e,n){return e+xn(t-e,n-e)}function b_(t,e,n){return e+En(t-e,n-e)}function w_(t,e,n,i,r){return e+(i-e)/(n-t)*(r-t)}function I_(t,e,n,i,r){var a=1-r;return a*a*a*t+3*a*a*r*e+3*a*r*r*n+r*r*r*i}function P_(t,e,n,i,r){var a=1-r;return a*(a*(t+(3*e-t)*r)+3*n*r*r)+i*r*r*r}l.bezier=P_;var R_,D_,O_,N_,M_,L_,F_,B_,z_,U_,k_,G_=Math.cos,V_=Math.acos,H_=Math.max,W_=2*Math.PI,j_=Math.sqrt;function X_(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function q_(t,e){var n=function(t,e){var n,i,r,a,o=e-0,s=e-t[0],c=3*o,l=3*s,u=3*(e-t[2]),h=1/(-o+l-u+(e-1)),f=1/3,_=(c-6*s+u)*h,d=_*f,p=(-c+l)*h,m=(3*p-_*_)*f,g=m*f,v=(2*_*_*_-9*_*p+o*h*27)/27,y=v/2,S=y*y+g*g*g;if(S<0){var T=-m*f,x=j_(T*T*T),E=-v/(2*x),A=V_(E<-1?-1:E>1?1:E),C=2*X_(x);return i=C*G_(A*f)-d,r=C*G_((A+W_)*f)-d,a=C*G_((A+2*W_)*f)-d,i>=0&&i<=1?r>=0&&r<=1?a>=0&&a<=1?H_(i,r,a):H_(i,r):a>=0&&a<=1?H_(i,a):i:r>=0&&r<=1?a>=0&&a<=1?H_(r,a):r:a}if(0===S)return r=-(n=y<0?X_(-y):-X_(y))-d,(i=2*n-d)>=0&&i<=1?r>=0&&r<=1?H_(i,r):i:r;var b=j_(S);return(n=X_(-y+b))-X_(y+b)-d}(t,e),i=t[1];return((1-n)*(i+(t[3]-i)*n)*3+n*n)*n}l.bezierByTime=q_,function(t){t[t.SLERP=0]="SLERP",t[t.CONSTANT=1]="CONSTANT"}(k_||(k_=t("QuatInterpolationMode",{})));var Y_=Ec("cc.QuatKeyframeValue")(R_=Lc((O_=ct((D_=function(t){var e=void 0===t?{}:t,n=e.value,i=e.interpolationMode,r=e.easingMethod;st(this,"interpolationMode",O_,this),st(this,"value",N_,this),st(this,"easingMethod",M_,this),this.value=n?zn.clone(n):this.value,this.interpolationMode=null!=i?i:this.interpolationMode,this.easingMethod=null!=r?r:this.easingMethod}).prototype,"interpolationMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return k_.SLERP}}),N_=ct(D_.prototype,"value",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.clone(zn.IDENTITY)}}),M_=ct(D_.prototype,"easingMethod",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $f.LINEAR}}),R_=D_))||R_)||R_;function K_(t){return new Y_(t)}var Q_,J_=t("QuatCurve",Ec("cc.QuatCurve")((U_=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"preExtrapolation",B_,rt(e)),st(e,"postExtrapolation",z_,rt(e)),e}Z(e,t);var n=e.prototype;return n.evaluate=function(t,e){var n;null!==(n=e)&&void 0!==n||(e=new zn);var i=this._times,r=this._values,a=this.postExtrapolation,o=this.preExtrapolation,s=i.length;if(0===s)return e;var c=i[0],l=i[s-1];if(t<c){var u=r[0];switch(o){case hc.LOOP:t=c+xn(t-c,l-c);break;case hc.PING_PONG:t=c+En(t-c,l-c);break;case hc.CLAMP:default:return zn.copy(e,u.value)}}else if(t>l){var h=r[s-1];switch(a){case hc.LOOP:t=c+xn(t-c,l-c);break;case hc.PING_PONG:t=c+En(t-c,l-c);break;case hc.CLAMP:default:return zn.copy(e,h.value)}}var f=lc(i,t);if(f>=0)return zn.copy(e,r[f].value);var _=~f,d=_-1,p=i[d],m=r[d],g=i[_],v=r[_],y=(t-p)/(g-p);switch(m.interpolationMode){default:case k_.CONSTANT:return zn.copy(e,m.value);case k_.SLERP:var S=m.easingMethod,T=S===$f.LINEAR?y:Array.isArray(S)?q_(S,y):i_(S)(y);return zn.slerp(e,m.value,v.value,T)}},n.addKeyFrame=function(e,n){var i=new Y_(n);return t.prototype.addKeyFrame.call(this,e,i)},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return K_(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return K_(t[1])})))}},n[lh]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=!0;i.forEach((function(t,e,n){var i=n[0];r&&t.interpolationMode!==i.interpolationMode&&(r=!1)}));var a=n.length,o=id*(r?1:a),s=i.reduce((function(t,e){var n=e.easingMethod;return t+(Array.isArray(n)?rd+4*od:rd)}),0),c=0,l=new DataView(new ArrayBuffer(c+=$_+td+ed*a+4*nd*a+s+o+0)),u=0,h=0;r&&(h|=Q_.INTERPOLATION_MODE),l.setUint32(u,h,!0),u+=$_,l.setUint32(u,a,!0),u+=td,n.forEach((function(t,e){return l.setFloat32(u+ed*e,t,!0)})),u+=ed*a,i.forEach((function(t,e){var n=t.value,i=n.x,r=n.y,a=n.z,o=n.w,s=u+4*nd*e;l.setFloat32(s+0*nd,i,!0),l.setFloat32(s+1*nd,r,!0),l.setFloat32(s+2*nd,a,!0),l.setFloat32(s+3*nd,o,!0)})),u+=4*nd*a,i.forEach((function(t){var e=t.easingMethod;Array.isArray(e)?(l.setUint8(u,ad),++u,l.setFloat32(u+0*od,e[0],!0),l.setFloat32(u+1*od,e[1],!0),l.setFloat32(u+2*od,e[2],!0),l.setFloat32(u+3*od,e[3],!0),u+=4*od):(l.setUint8(u,e),++u)}));var f=u;u+=o;var _=f;i.forEach((function(t){var e=t.interpolationMode;l.setUint8(_,e),r||(_+=id)}));var d=new Uint8Array(l.buffer);t.writeProperty("bytes",d)}else t.writeThis()},n[uh]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0,a=i.getUint32(r,!0);r+=$_;var o=a&Q_.INTERPOLATION_MODE,s=i.getUint32(r,!0);r+=td;var c=Array.from({length:s},(function(t,e){return i.getFloat32(r+ed*e,!0)})),l=r+=ed*s;r+=4*nd*s;var u=Array.from({length:s},(function(t,e){var n=l+4*nd*e,a=i.getFloat32(n+0*nd,!0),o=i.getFloat32(n+1*nd,!0),s=i.getFloat32(n+2*nd,!0),c=i.getFloat32(n+3*nd,!0),u=i.getUint8(r);++r;var h=K_({value:{x:a,y:o,z:s,w:c}});return u!==ad?h.easingMethod=u:(h.easingMethod=[i.getFloat32(r+0*od,!0),i.getFloat32(r+1*od,!0),i.getFloat32(r+2*od,!0),i.getFloat32(r+3*od,!0)],r+=4*od),h}));if(o){var h=i.getUint8(r);++r;for(var f=0;f<s;++f)u[f].interpolationMode=h}else{for(var _=0;_<s;++_){var d=i.getUint8(r+_);u[_].interpolationMode=d}r+=s}this._times=c,this._values=u}else t.readThis()},e}(_c),B_=ct((F_=U_).prototype,"preExtrapolation",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hc.CLAMP}}),z_=ct(F_.prototype,"postExtrapolation",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hc.CLAMP}}),L_=F_))||L_);!function(t){t[t.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(Q_||(Q_={}));var Z_,$_=1,td=4,ed=4,nd=4,id=1,rd=1,ad=255,od=4,sd=t("ObjectCurve",Ec("cc.ObjectCurve")(Z_=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.prototype.evaluate=function(t){var e=this.searchKeyframe(t);if(e>=0)return this._values[e];var n=un(~e-1,0,this._values.length-1);return this._values[n]},e}(_c))||Z_),cd=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};tn.fastDefine("cc.Keyframe",cd,{time:0,value:0,inTangent:0,outTangent:0});var ld=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,n=this.coefficient,e*(e*(e*n[0]+n[1])+n[2])+n[3];var e,n},t}(),ud=function(){function t(t){if(void 0===t&&(t=null),this.cachedKey=void 0,t instanceof h_)this._curve=t;else{var e=new h_;this._curve=e,e.preExtrapolation=hc.LOOP,e.postExtrapolation=hc.CLAMP,t?e.assignSorted(t.map((function(t){return[t.time,{interpolationMode:uc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):e.assignSorted([[0,{interpolationMode:uc.CUBIC,value:1}],[1,{interpolationMode:uc.CUBIC,value:1}]])}this.cachedKey=new ld}var e=t.prototype;return e.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:uc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},e.evaluate_slow=function(t){return this._curve.evaluate(t)},e.evaluate=function(t){var e=this.cachedKey,n=this._curve,i=n.keyFramesCount-1,r=t,a=t<0?n.preExtrapolation:n.postExtrapolation,o=n.getKeyframeTime(0),s=n.getKeyframeTime(i);switch(a){case hc.LOOP:r=xn(t-o,s-o)+o;break;case hc.PING_PONG:r=En(t-o,s-o)+o;break;case hc.CLAMP:default:r=un(t,o,s)}if(r>=e.time&&r<e.endTime)return e.evaluate(r);var c=this.findIndex(e,r),l=Math.min(c+1,i);return this.calcOptimizedKey(e,c,l),e.evaluate(r)},e.calcOptimizedKey=function(t,e,n){var i=this._curve.getKeyframeTime(e),r=this._curve.getKeyframeTime(n),a=this._curve.getKeyframeValue(e),o=a.value,s=a.leftTangent,c=this._curve.getKeyframeValue(n),l=c.value,u=c.rightTangent;t.index=e,t.time=i,t.endTime=r;var h=r-i,f=l-o,_=1/(h*h),d=s*h,p=u*h;t.coefficient[0]=(d+p-f-f)*_/h,t.coefficient[1]=(f+f+f-d-d-p)*_,t.coefficient[2]=s,t.coefficient[3]=o},e.findIndex=function(t,e){var n=this._curve,i=n.keyFramesCount,r=t.index;if(-1!==r)if(e>n.getKeyframeTime(r))for(var a=0;a<3;a++){var o=r+a;if(o+1<i&&n.getKeyframeTime(o+1)>e)return o}else for(var s=0;s<3;s++){var c=r-s;if(c>=0&&n.getKeyframeTime(c-1)<=e)return c-1}for(var l,u=0,h=i;h-u>1;)l=Math.floor((u+h)/2),n.getKeyframeTime(l)>=e?h=l:u=l;return u},Q(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var e=t[0],n=t[1],i=new cd;return i.time=e,i.value=n.value,i.inTangent=n.leftTangent,i.outTangent=n.rightTangent,i}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:uc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return fd(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=hd(t)}},{key:"postWrapMode",get:function(){return fd(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=hd(t)}}]),t}();function hd(t){switch(t){default:case ec.Default:case ec.Normal:case ec.Clamp:return hc.CLAMP;case ec.PingPong:return hc.PING_PONG;case ec.Loop:return hc.LOOP}}function fd(t){switch(t){default:case hc.LINEAR:case hc.CLAMP:return ec.Clamp;case hc.PING_PONG:return ec.PingPong;case hc.LOOP:return ec.Loop}}function _d(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}ud.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],tn.fastDefine("cc.AnimationCurve",ud,{_curve:null}),U(ds,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var dd=function(t){function e(){var e;return e=t.call(this)||this,_d("line","Line"),e}return Z(e,t),e}(eo),pd=function(t){function e(){var e;return e=t.call(this)||this,_d("plane","Plane"),e}return Z(e,t),e}(bs),md=function(t){function e(){var e;return e=t.call(this)||this,_d("ray","Ray"),e}return Z(e,t),e}(no),gd=function(t){function e(){var e;return e=t.call(this)||this,_d("triangle","Triangle"),e}return Z(e,t),e}(uo),vd=function(t){function e(){var e;return e=t.call(this)||this,_d("sphere","Sphere"),e}return Z(e,t),e}(lo),yd=function(t){function e(){var e;return e=t.call(this)||this,_d("aabb","AABB"),e}return Z(e,t),e}(Ys),Sd=function(t){function e(){var e;return e=t.call(this)||this,_d("obb","OBB"),e}return Z(e,t),e}(Zs),Td=function(t){function e(){var e;return e=t.call(this)||this,_d("capsule","Capsule"),e}return Z(e,t),e}($s),xd=function(t){function e(){var e;return e=t.call(this)||this,_d("frustum","Frustum"),e}return Z(e,t),e}(oc),Ed=Object.freeze({__proto__:null,distance:$a,enums:to,intersect:ds,Line:eo,Plane:bs,Ray:no,Triangle:uo,Sphere:lo,AABB:Ys,OBB:Zs,Capsule:$s,Frustum:oc,Keyframe:cd,AnimationCurve:ud,get ERaycastMode(){return co},line:dd,plane:pd,ray:md,triangle:gd,sphere:vd,aabb:yd,obb:Sd,capsule:Td,frustum:xd});t("geometry",Ed);var Ad={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Cd=t("Layers",function(){function t(){}return t.makeMaskInclude=function(t){for(var e,n=0,i=ot(t);!(e=i()).done;)n|=e.value;return n},t.makeMaskExclude=function(e){return~t.makeMaskInclude(e)},t.addLayer=function(e,n){if(void 0!==n)if(n>19||n<0)console.warn("maximum layers reached.");else{var i=1<<n;t.Enum[e],F(2104,e),t.Enum[e]=i,ie.value(t.Enum,String(i),e),t.BitMask[e]=i,ie.value(t.BitMask,String(i),e)}else console.warn("bitNum can't be undefined")},t.deleteLayer=function(e){if(e>19||e<0)console.warn("do not change buildin layers.");else{var n=1<<e;delete t.Enum[t.Enum[n]],delete t.Enum[n],delete t.BitMask[t.BitMask[n]],delete t.BitMask[n]}},t.nameToLayer=function(e){return void 0===e?(console.warn("name can't be undefined"),-1):n(t.Enum[e])},t.layerToName=function(e){return e>31||e<0?(console.warn("Unable to access unknown layer."),""):t.Enum[1<<e]},t}());Cd.Enum=oe(Ad),Cd.BitMask=re(J({},Ad)),l.Layers=Cd;var bd,wd,Id="MainFlow",Pd="ForwardFlow",Rd="ShadowFlow";!function(t){t[t.DEFAULT=100]="DEFAULT",t[t.UI=200]="UI"}(bd||(bd={})),l.RenderPassStage=bd,function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(wd||(wd={}));var Dd,Od={bindings:[],layouts:{}},Nd={bindings:[],layouts:{}};!function(t){t[t.UBO_GLOBAL=0]="UBO_GLOBAL",t[t.UBO_CAMERA=1]="UBO_CAMERA",t[t.UBO_SHADOW=2]="UBO_SHADOW",t[t.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",t[t.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",t[t.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",t[t.SAMPLER_DIFFUSEMAP=6]="SAMPLER_DIFFUSEMAP",t[t.COUNT=7]="COUNT"}(Dd||(Dd={}));var Md,Ld=Dd.SAMPLER_SHADOWMAP,Fd=Dd.COUNT-Ld;!function(t){t[t.UBO_LOCAL=0]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",t[t.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",t[t.UBO_MORPH=4]="UBO_MORPH",t[t.UBO_UI_LOCAL=5]="UBO_UI_LOCAL",t[t.SAMPLER_JOINTS=6]="SAMPLER_JOINTS",t[t.SAMPLER_MORPH_POSITION=7]="SAMPLER_MORPH_POSITION",t[t.SAMPLER_MORPH_NORMAL=8]="SAMPLER_MORPH_NORMAL",t[t.SAMPLER_MORPH_TANGENT=9]="SAMPLER_MORPH_TANGENT",t[t.SAMPLER_LIGHTMAP=10]="SAMPLER_LIGHTMAP",t[t.SAMPLER_SPRITE=11]="SAMPLER_SPRITE",t[t.SAMPLER_REFLECTION=12]="SAMPLER_REFLECTION",t[t.STORAGE_REFLECTION=13]="STORAGE_REFLECTION",t[t.COUNT=14]="COUNT"}(Md||(Md={}));var Bd,zd=Md.SAMPLER_JOINTS,Ud=Md.STORAGE_REFLECTION-zd,kd=Md.COUNT-zd-Ud;!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MATERIAL=1]="MATERIAL",t[t.LOCAL=2]="LOCAL"}(Bd||(Bd={}));var Gd=new fr([Ld,0,zd],[Fd,0,Ud],[0,0,0],[0,0,0],[0,0,0],[0,0,kd],[0,0,0],[0,2,1]),Vd=function(){};Vd.SIZE=4*(Vd.COUNT=4+(Vd.SCREEN_SIZE_OFFSET=4+(Vd.NATIVE_SIZE_OFFSET=4+(Vd.TIME_OFFSET=0)))),Vd.NAME="CCGlobal",Vd.BINDING=Dd.UBO_GLOBAL,Vd.DESCRIPTOR=new Hr(Vd.BINDING,qi.UNIFORM_BUFFER,1,Li.ALL),Vd.LAYOUT=new Ar(Bd.GLOBAL,Vd.BINDING,Vd.NAME,[new Er("cc_time",gi.FLOAT4,1),new Er("cc_screenSize",gi.FLOAT4,1),new Er("cc_nativeSize",gi.FLOAT4,1)],1),Od.layouts[Vd.NAME]=Vd.LAYOUT,Od.bindings[Vd.BINDING]=Vd.DESCRIPTOR;var Hd=function(){};Hd.SIZE=4*(Hd.COUNT=4+(Hd.VIEW_PORT_OFFSET=4+(Hd.NEAR_FAR_OFFSET=4+(Hd.GLOBAL_FOG_ADD_OFFSET=4+(Hd.GLOBAL_FOG_BASE_OFFSET=4+(Hd.GLOBAL_FOG_COLOR_OFFSET=4+(Hd.AMBIENT_GROUND_OFFSET=4+(Hd.AMBIENT_SKY_OFFSET=4+(Hd.MAIN_LIT_COLOR_OFFSET=4+(Hd.MAIN_LIT_DIR_OFFSET=4+(Hd.EXPOSURE_OFFSET=4+(Hd.SCREEN_SCALE_OFFSET=4+(Hd.CAMERA_POS_OFFSET=16+(Hd.MAT_VIEW_PROJ_INV_OFFSET=16+(Hd.MAT_VIEW_PROJ_OFFSET=16+(Hd.MAT_PROJ_INV_OFFSET=16+(Hd.MAT_PROJ_OFFSET=16+(Hd.MAT_VIEW_INV_OFFSET=16+(Hd.MAT_VIEW_OFFSET=0))))))))))))))))))),Hd.NAME="CCCamera",Hd.BINDING=Dd.UBO_CAMERA,Hd.DESCRIPTOR=new Hr(Hd.BINDING,qi.UNIFORM_BUFFER,1,Li.ALL),Hd.LAYOUT=new Ar(Bd.GLOBAL,Hd.BINDING,Hd.NAME,[new Er("cc_matView",gi.MAT4,1),new Er("cc_matViewInv",gi.MAT4,1),new Er("cc_matProj",gi.MAT4,1),new Er("cc_matProjInv",gi.MAT4,1),new Er("cc_matViewProj",gi.MAT4,1),new Er("cc_matViewProjInv",gi.MAT4,1),new Er("cc_cameraPos",gi.FLOAT4,1),new Er("cc_screenScale",gi.FLOAT4,1),new Er("cc_exposure",gi.FLOAT4,1),new Er("cc_mainLitDir",gi.FLOAT4,1),new Er("cc_mainLitColor",gi.FLOAT4,1),new Er("cc_ambientSky",gi.FLOAT4,1),new Er("cc_ambientGround",gi.FLOAT4,1),new Er("cc_fogColor",gi.FLOAT4,1),new Er("cc_fogBase",gi.FLOAT4,1),new Er("cc_fogAdd",gi.FLOAT4,1),new Er("cc_nearFar",gi.FLOAT4,1),new Er("cc_viewPort",gi.FLOAT4,1)],1),Od.layouts[Hd.NAME]=Hd.LAYOUT,Od.bindings[Hd.BINDING]=Hd.DESCRIPTOR;var Wd=function(){};Wd.SIZE=4*(Wd.COUNT=4+(Wd.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=4+(Wd.SHADOW_COLOR_OFFSET=4+(Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=4+(Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=4+(Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=4+(Wd.SHADOW_PROJ_INFO_OFFSET=4+(Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET=4+(Wd.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=16+(Wd.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(Wd.MAT_LIGHT_VIEW_OFFSET=16+(Wd.MAT_LIGHT_PLANE_PROJ_OFFSET=0)))))))))))),Wd.NAME="CCShadow",Wd.BINDING=Dd.UBO_SHADOW,Wd.DESCRIPTOR=new Hr(Wd.BINDING,qi.UNIFORM_BUFFER,1,Li.ALL),Wd.LAYOUT=new Ar(Bd.GLOBAL,Wd.BINDING,Wd.NAME,[new Er("cc_matLightPlaneProj",gi.MAT4,1),new Er("cc_matLightView",gi.MAT4,1),new Er("cc_matLightViewProj",gi.MAT4,1),new Er("cc_shadowInvProjDepthInfo",gi.FLOAT4,1),new Er("cc_shadowProjDepthInfo",gi.FLOAT4,1),new Er("cc_shadowProjInfo",gi.FLOAT4,1),new Er("cc_shadowNFLSInfo",gi.FLOAT4,1),new Er("cc_shadowWHPBInfo",gi.FLOAT4,1),new Er("cc_shadowLPNNInfo",gi.FLOAT4,1),new Er("cc_shadowColor",gi.FLOAT4,1),new Er("cc_planarNDInfo",gi.FLOAT4,1)],1),Od.layouts[Wd.NAME]=Wd.LAYOUT,Od.bindings[Wd.BINDING]=Wd.DESCRIPTOR;var jd=Dd.SAMPLER_SHADOWMAP,Xd=new Hr(jd,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),qd=new Cr(Bd.GLOBAL,jd,"cc_shadowMap",gi.SAMPLER2D,1);Od.layouts.cc_shadowMap=qd,Od.bindings[jd]=Xd;var Yd=Dd.SAMPLER_ENVIRONMENT,Kd=new Hr(Yd,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Qd=new Cr(Bd.GLOBAL,Yd,"cc_environment",gi.SAMPLER_CUBE,1);Od.layouts.cc_environment=Qd,Od.bindings[Yd]=Kd;var Jd=Dd.SAMPLER_DIFFUSEMAP,Zd=new Hr(Jd,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),$d=new Cr(Bd.GLOBAL,Jd,"cc_diffuseMap",gi.SAMPLER_CUBE,1);Od.layouts.cc_diffuseMap=$d,Od.bindings[Jd]=Zd;var tp=Dd.SAMPLER_SPOT_LIGHTING_MAP,ep=new Hr(tp,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),np=new Cr(Bd.GLOBAL,tp,"cc_spotLightingMap",gi.SAMPLER2D,1);Od.layouts.cc_spotLightingMap=np,Od.bindings[tp]=ep;var ip=function(){};ip.SIZE=4*(ip.COUNT=4+(ip.LOCAL_SHADOW_BIAS=4+(ip.LIGHTINGMAP_UVPARAM=16+(ip.MAT_WORLD_IT_OFFSET=16+(ip.MAT_WORLD_OFFSET=0))))),ip.NAME="CCLocal",ip.BINDING=Md.UBO_LOCAL,ip.DESCRIPTOR=new Hr(ip.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),ip.LAYOUT=new Ar(Bd.LOCAL,ip.BINDING,ip.NAME,[new Er("cc_matWorld",gi.MAT4,1),new Er("cc_matWorldIT",gi.MAT4,1),new Er("cc_lightingMapUVParam",gi.FLOAT4,1),new Er("cc_localShadowBias",gi.FLOAT4,1)],1),Nd.layouts[ip.NAME]=ip.LAYOUT,Nd.bindings[ip.BINDING]=ip.DESCRIPTOR;var rp=function(){};rp.SIZE=4*(rp.COUNT=4+(rp.WORLD_BOUND_HALF_EXTENTS=4+(rp.WORLD_BOUND_CENTER=0))),rp.NAME="CCWorldBound",rp.BINDING=Md.UBO_LOCAL,rp.DESCRIPTOR=new Hr(rp.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),rp.LAYOUT=new Ar(Bd.LOCAL,rp.BINDING,rp.NAME,[new Er("cc_worldBoundCenter",gi.FLOAT4,1),new Er("cc_worldBoundHalfExtents",gi.FLOAT4,1)],1),Nd.layouts[rp.NAME]=rp.LAYOUT,Nd.bindings[rp.BINDING]=rp.DESCRIPTOR;var ap="a_matWorld0",op=function(){};op.BATCHING_COUNT=10,op.MAT_WORLDS_OFFSET=0,op.SIZE=4*(op.COUNT=16*op.BATCHING_COUNT),op.NAME="CCLocalBatched",op.BINDING=Md.UBO_LOCAL,op.DESCRIPTOR=new Hr(op.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),op.LAYOUT=new Ar(Bd.LOCAL,op.BINDING,op.NAME,[new Er("cc_matWorlds",gi.MAT4,op.BATCHING_COUNT)],1),Nd.layouts[op.NAME]=op.LAYOUT,Nd.bindings[op.BINDING]=op.DESCRIPTOR;var sp=function(){};sp.LIGHTS_PER_PASS=1,sp.SIZE=4*(sp.COUNT=(sp.LIGHT_DIR_OFFSET=(sp.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(sp.LIGHT_COLOR_OFFSET=(sp.LIGHT_POS_OFFSET=0)+4*sp.LIGHTS_PER_PASS)+4*sp.LIGHTS_PER_PASS)+4*sp.LIGHTS_PER_PASS)+4*sp.LIGHTS_PER_PASS),sp.NAME="CCForwardLight",sp.BINDING=Md.UBO_FORWARD_LIGHTS,sp.DESCRIPTOR=new Hr(sp.BINDING,qi.DYNAMIC_UNIFORM_BUFFER,1,Li.FRAGMENT),sp.LAYOUT=new Ar(Bd.LOCAL,sp.BINDING,sp.NAME,[new Er("cc_lightPos",gi.FLOAT4,sp.LIGHTS_PER_PASS),new Er("cc_lightColor",gi.FLOAT4,sp.LIGHTS_PER_PASS),new Er("cc_lightSizeRangeAngle",gi.FLOAT4,sp.LIGHTS_PER_PASS),new Er("cc_lightDir",gi.FLOAT4,sp.LIGHTS_PER_PASS)],1),Nd.layouts[sp.NAME]=sp.LAYOUT,Nd.bindings[sp.BINDING]=sp.DESCRIPTOR;var cp=function(){};cp.LIGHTS_PER_PASS=10;var lp=function(){};lp.SIZE=4*(lp.COUNT=4+(lp.JOINTS_TEXTURE_INFO_OFFSET=0)),lp.NAME="CCSkinningTexture",lp.BINDING=Md.UBO_SKINNING_TEXTURE,lp.DESCRIPTOR=new Hr(lp.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX),lp.LAYOUT=new Ar(Bd.LOCAL,lp.BINDING,lp.NAME,[new Er("cc_jointTextureInfo",gi.FLOAT4,1)],1),Nd.layouts[lp.NAME]=lp.LAYOUT,Nd.bindings[lp.BINDING]=lp.DESCRIPTOR;var up=function(){};up.SIZE=4*(up.COUNT=4+(up.JOINTS_ANIM_INFO_OFFSET=0)),up.NAME="CCSkinningAnimation",up.BINDING=Md.UBO_SKINNING_ANIMATION,up.DESCRIPTOR=new Hr(up.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX),up.LAYOUT=new Ar(Bd.LOCAL,up.BINDING,up.NAME,[new Er("cc_jointAnimInfo",gi.FLOAT4,1)],1),Nd.layouts[up.NAME]=up.LAYOUT,Nd.bindings[up.BINDING]=up.DESCRIPTOR;var hp="a_jointAnimInfo",fp=function(){};fp.SIZE=4*(fp.COUNT=360+(fp.JOINTS_OFFSET=0)),fp.NAME="CCSkinning",fp.BINDING=Md.UBO_SKINNING_TEXTURE,fp.DESCRIPTOR=new Hr(fp.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX),fp.LAYOUT=new Ar(Bd.LOCAL,fp.BINDING,fp.NAME,[new Er("cc_joints",gi.FLOAT4,90)],1),Nd.layouts[fp.NAME]=fp.LAYOUT,Nd.bindings[fp.BINDING]=fp.DESCRIPTOR;var _p=function(){};_p.MAX_MORPH_TARGET_COUNT=60,_p.OFFSET_OF_WEIGHTS=0,_p.OFFSET_OF_VERTICES_COUNT=4+(_p.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(_p.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*_p.MAX_MORPH_TARGET_COUNT)),_p.COUNT_BASE_4_BYTES=4*Math.ceil(_p.MAX_MORPH_TARGET_COUNT/4)+4,_p.SIZE=4*_p.COUNT_BASE_4_BYTES,_p.NAME="CCMorph",_p.BINDING=Md.UBO_MORPH,_p.DESCRIPTOR=new Hr(_p.BINDING,qi.UNIFORM_BUFFER,1,Li.VERTEX),_p.LAYOUT=new Ar(Bd.LOCAL,_p.BINDING,_p.NAME,[new Er("cc_displacementWeights",gi.FLOAT4,_p.MAX_MORPH_TARGET_COUNT/4),new Er("cc_displacementTextureInfo",gi.FLOAT4,1)],1),Nd.layouts[_p.NAME]=_p.LAYOUT,Nd.bindings[_p.BINDING]=_p.DESCRIPTOR;var dp=function(){};dp.NAME="CCUILocal",dp.BINDING=Md.UBO_UI_LOCAL,dp.DESCRIPTOR=new Hr(dp.BINDING,qi.DYNAMIC_UNIFORM_BUFFER,1,Li.VERTEX),dp.LAYOUT=new Ar(Bd.LOCAL,dp.BINDING,dp.NAME,[new Er("cc_local_data",gi.FLOAT4,1)],1),Nd.layouts[dp.NAME]=dp.LAYOUT,Nd.bindings[dp.BINDING]=dp.DESCRIPTOR;var pp=Md.SAMPLER_JOINTS,mp=new Hr(pp,qi.SAMPLER_TEXTURE,1,Li.VERTEX),gp=new Cr(Bd.LOCAL,pp,"cc_jointTexture",gi.SAMPLER2D,1);Nd.layouts.cc_jointTexture=gp,Nd.bindings[pp]=mp;var vp=Md.SAMPLER_MORPH_POSITION,yp=new Hr(vp,qi.SAMPLER_TEXTURE,1,Li.VERTEX),Sp=new Cr(Bd.LOCAL,vp,"cc_PositionDisplacements",gi.SAMPLER2D,1);Nd.layouts.cc_PositionDisplacements=Sp,Nd.bindings[vp]=yp;var Tp=Md.SAMPLER_MORPH_NORMAL,xp=new Hr(Tp,qi.SAMPLER_TEXTURE,1,Li.VERTEX),Ep=new Cr(Bd.LOCAL,Tp,"cc_NormalDisplacements",gi.SAMPLER2D,1);Nd.layouts.cc_NormalDisplacements=Ep,Nd.bindings[Tp]=xp;var Ap=Md.SAMPLER_MORPH_TANGENT,Cp=new Hr(Ap,qi.SAMPLER_TEXTURE,1,Li.VERTEX),bp=new Cr(Bd.LOCAL,Ap,"cc_TangentDisplacements",gi.SAMPLER2D,1);Nd.layouts.cc_TangentDisplacements=bp,Nd.bindings[Ap]=Cp;var wp=Md.SAMPLER_LIGHTMAP,Ip=new Hr(wp,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Pp=new Cr(Bd.LOCAL,wp,"cc_lightingMap",gi.SAMPLER2D,1);Nd.layouts.cc_lightingMap=Pp,Nd.bindings[wp]=Ip;var Rp=Md.SAMPLER_SPRITE,Dp=new Hr(Rp,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Op=new Cr(Bd.LOCAL,Rp,"cc_spriteTexture",gi.SAMPLER2D,1);Nd.layouts.cc_spriteTexture=Op,Nd.bindings[Rp]=Dp;var Np=Md.SAMPLER_REFLECTION,Mp=new Hr(Np,qi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Lp=new Cr(Bd.LOCAL,Np,"cc_reflectionTexture",gi.SAMPLER2D,1);Nd.layouts.cc_reflectionTexture=Lp,Nd.bindings[Np]=Mp;var Fp=Md.STORAGE_REFLECTION,Bp=new Hr(Fp,qi.STORAGE_IMAGE,1,Li.COMPUTE),zp=new Ir(Bd.LOCAL,Fp,"cc_reflectionStorage",gi.IMAGE2D,1);Nd.layouts.cc_reflectionStorage=zp,Nd.bindings[Fp]=Bp;var Up,kp,Gp=Cd.makeMaskExclude([Cd.BitMask.UI_2D,Cd.BitMask.GIZMOS,Cd.BitMask.EDITOR,Cd.BitMask.SCENE_GIZMO,Cd.BitMask.PROFILER]),Vp=Cd.makeMaskExclude([Cd.BitMask.UI_2D,Cd.BitMask.PROFILER]),Hp=Cd.Enum.ALL;function Wp(t){return(t.getFormatFeatures(pi.R32F)&(Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE))==(Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE)}t("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_MAIN:Id,PIPELINE_FLOW_FORWARD:Pd,PIPELINE_FLOW_SHADOW:Rd,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return bd},get RenderPriority(){return wd},globalDescriptorSetLayout:Od,localDescriptorSetLayout:Nd,get PipelineGlobalBindings(){return Dd},get ModelLocalBindings(){return Md},get SetIndex(){return Bd},bindingMappingInfo:Gd,UBOGlobal:Vd,UBOCamera:Hd,UBOShadow:Wd,UNIFORM_SHADOWMAP_BINDING:jd,UNIFORM_ENVIRONMENT_BINDING:Yd,UNIFORM_DIFFUSEMAP_BINDING:Jd,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:tp,UBOLocal:ip,UBOWorldBound:rp,INST_MAT_WORLD:ap,UBOLocalBatched:op,UBOForwardLight:sp,UBODeferredLight:cp,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:lp,UBOSkinningAnimation:up,INST_JOINT_ANIM_INFO:hp,UBOSkinning:fp,UBOMorph:_p,UBOUILocal:dp,UNIFORM_JOINT_TEXTURE_BINDING:pp,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:vp,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Tp,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Ap,UNIFORM_LIGHTMAP_TEXTURE_BINDING:wp,UNIFORM_SPRITE_TEXTURE_BINDING:Rp,UNIFORM_REFLECTION_TEXTURE_BINDING:Np,UNIFORM_REFLECTION_STORAGE_BINDING:Fp,CAMERA_DEFAULT_MASK:Gp,CAMERA_EDITOR_MASK:Vp,MODEL_ALWAYS_MASK:Hp,supportsR16HalfFloatTexture:function(t){return(t.getFormatFeatures(pi.R16F)&(Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE))==(Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE)},supportsR32FloatTexture:Wp}));var jp=4227858432,Xp=66060288,qp=1044480,Yp=function(t,e,n,i){return void 0===i&&(i=0),e<<26&jp|t<<20&Xp|n<<12&qp|4095&i},Kp=function(t){return(t&jp)>>>26},Qp=function(t){return(t&Xp)>>>20},Jp=function(t){return(t&qp)>>>12},Zp=function(t){return 4095&t},$p=function(t,e){return 67108863&t|e<<26&jp},tm=((Up={})[gi.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Up[gi.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]},Up[gi.INT2]=function(t,e,n){return void 0===n&&(n=0),Qn.fromArray(e,t,n)},Up[gi.INT3]=function(t,e,n){return void 0===n&&(n=0),Dn.fromArray(e,t,n)},Up[gi.INT4]=function(t,e,n){return void 0===n&&(n=0),ti.fromArray(e,t,n)},Up[gi.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]},Up[gi.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Qn.fromArray(e,t,n)},Up[gi.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Dn.fromArray(e,t,n)},Up[gi.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),ti.fromArray(e,t,n)},Up[gi.MAT3]=function(t,e,n){return void 0===n&&(n=0),Ln.fromArray(e,t,n)},Up[gi.MAT4]=function(t,e,n){return void 0===n&&(n=0),Xn.fromArray(e,t,n)},Up),em=((kp={})[gi.UNKNOWN]=function(){return console.warn("illegal uniform handle")},kp[gi.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},kp[gi.INT2]=function(t,e,n){return void 0===n&&(n=0),Qn.toArray(t,e,n)},kp[gi.INT3]=function(t,e,n){return void 0===n&&(n=0),Dn.toArray(t,e,n)},kp[gi.INT4]=function(t,e,n){return void 0===n&&(n=0),ti.toArray(t,e,n)},kp[gi.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},kp[gi.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Qn.toArray(t,e,n)},kp[gi.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Dn.toArray(t,e,n)},kp[gi.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),ti.toArray(t,e,n)},kp[gi.MAT3]=function(t,e,n){return void 0===n&&(n=0),Ln.toArray(t,e,n)},kp[gi.MAT4]=function(t,e,n){return void 0===n&&(n=0),Xn.toArray(t,e,n)},kp),nm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function im(t){switch(t){case gi.BOOL:case gi.INT:case gi.UINT:case gi.FLOAT:return nm[0];case gi.BOOL2:case gi.INT2:case gi.UINT2:case gi.FLOAT2:return nm[1];case gi.BOOL4:case gi.INT4:case gi.UINT4:case gi.FLOAT4:return nm[2];case gi.MAT4:return nm[3];case gi.SAMPLER2D:return"default-texture";case gi.SAMPLER_CUBE:return"default-cube-texture"}return nm[0]}function rm(t,e){for(var n=Object.entries(e),i=!1,r=0;r<n.length;r++)t[n[r][0]]!==n[r][1]&&(t[n[r][0]]=n[r][1],i=!0);return i}var am=new Wr;function om(t){return Math.ceil(Math.log2(Math.max(t,2)))}function sm(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function cm(t,e,n,i,r){for(var a=t.builtins[i],o=[],s=function(t){var e=a.blocks[t],i=n.layouts[e.name],s=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&s&&s.descriptorType&ia))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<a.blocks.length;c++)s(c);Array.prototype.unshift.apply(e.shaderInfo.blocks,o);for(var l=[],u=function(t){var e=a.samplerTextures[t],i=n.layouts[e.name],o=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&o&&o.descriptorType&ra))return console.warn("builtin samplerTexture '"+e.name+"' not available!"),"continue";l.push(i),r&&!r.includes(o)&&r.push(o)},h=0;h<a.samplerTextures.length;h++)u(h);Array.prototype.unshift.apply(e.shaderInfo.samplerTextures,l),r&&r.sort((function(t,e){return t.binding-e.binding}))}function lm(t){return t.members.reduce((function(t,e){return t+ua(e.type)*e.count}),0)}function um(t,e){for(var n=0;n<t.length;n++){var i=t[n];if("!"===i[0]){if(e[i.slice(1)])return!1}else if(!e[i])return!1}return!0}function hm(t){switch(t.gfxAPI){case fi.GLES2:case fi.WEBGL:return"glsl1";case fi.GLES3:case fi.WEBGL2:return"glsl3";default:return"glsl4"}}var fm,_m,dm,pm,mm,gm,vm,ym,Sm=new(function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var i=t.techniques[n],r=0;r<i.passes.length;r++){var a=i.passes[r];void 0!==a.propertyIndex&&void 0===a.properties&&(a.properties=i.passes[a.propertyIndex].properties)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var n=J({},t),i=0,r=function(t){var e=n.defines[t],r=1;if("number"===e.type){var a=e.range;r=om(a[1]-a[0]+1),e._map=function(t){return t-a[0]}}else"string"===e.type?(r=om(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=i,i+=r},a=0;a<n.defines.length;a++)r(a);for(var o in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+o+" "+n.builtins.statistics[o]+"\n";if(this._templates[t.name]=n,!this._templateInfos[n.hash]){var s={};s.samplerStartBinding=n.blocks.length,s.shaderInfo=new Nr,s.blockSizes=[],s.bindings=[];for(var c=0;c<n.blocks.length;c++){var l=n.blocks[c];s.blockSizes.push(lm(l)),s.bindings.push(new Hr(l.binding,qi.UNIFORM_BUFFER,1,l.stageFlags)),s.shaderInfo.blocks.push(new Ar(Bd.MATERIAL,l.binding,l.name,l.members.map((function(t){return new Er(t.name,t.type,t.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var h=n.samplerTextures[u];s.bindings.push(new Hr(h.binding,qi.SAMPLER_TEXTURE,h.count,h.stageFlags)),s.shaderInfo.samplerTextures.push(new Cr(Bd.MATERIAL,h.binding,h.name,h.type,h.count))}for(var f=0;f<n.samplers.length;f++){var _=n.samplers[f];s.bindings.push(new Hr(_.binding,qi.SAMPLER,_.count,_.stageFlags)),s.shaderInfo.samplers.push(new br(Bd.MATERIAL,_.binding,_.name,_.count))}for(var d=0;d<n.textures.length;d++){var p=n.textures[d];s.bindings.push(new Hr(p.binding,qi.TEXTURE,p.count,p.stageFlags)),s.shaderInfo.textures.push(new wr(Bd.MATERIAL,p.binding,p.name,p.type,p.count))}for(var m=0;m<n.buffers.length;m++){var g=n.buffers[m];s.bindings.push(new Hr(g.binding,qi.STORAGE_BUFFER,1,g.stageFlags)),s.shaderInfo.buffers.push(new Pr(Bd.MATERIAL,g.binding,g.name,1,g.memoryAccess))}for(var v=0;v<n.images.length;v++){var y=n.images[v];s.bindings.push(new Hr(y.binding,qi.STORAGE_IMAGE,y.count,y.stageFlags)),s.shaderInfo.images.push(new Ir(Bd.MATERIAL,y.binding,y.name,y.type,y.count,y.memoryAccess))}for(var S=0;S<n.subpassInputs.length;S++){var T=n.subpassInputs[S];s.bindings.push(new Hr(T.binding,qi.INPUT_ATTACHMENT,T.count,T.stageFlags)),s.shaderInfo.subpassInputs.push(new Rr(Bd.MATERIAL,T.binding,T.name,T.count))}s.gfxAttributes=[];for(var x=0;x<n.attributes.length;x++){var E=n.attributes[x];s.gfxAttributes.push(new Or(E.name,E.format,E.isNormalized,0,E.isInstanced,E.location))}cm(n,s,Nd,"locals"),s.shaderInfo.stages.push(new Dr(Li.VERTEX,"")),s.shaderInfo.stages.push(new Dr(Li.FRAGMENT,"")),s.handleMap=function(t){for(var e={},n=0;n<t.blocks.length;n++)for(var i=t.blocks[n],r=i.members,a=0,o=0;o<r.length;o++){var s=r[o];e[s.name]=Yp(i.binding,s.type,s.count,a),a+=(ua(s.type)>>2)*s.count}for(var c=0;c<t.samplerTextures.length;c++){var l=t.samplerTextures[c];e[l.name]=Yp(l.binding,l.type,l.count)}return e}(n),s.setLayouts=[],this._templateInfos[n.hash]=s}return n},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,n){void 0===n&&(n=!1);var i=this._templates[e],r=this._templateInfos[i.hash];return r.setLayouts.length||(am.bindings=r.bindings,r.setLayouts[Bd.MATERIAL]=t.createDescriptorSetLayout(am),am.bindings=Nd.bindings,r.setLayouts[Bd.LOCAL]=t.createDescriptorSetLayout(am)),r.setLayouts[n?Bd.LOCAL:Bd.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var n=this._templates[t],i=n.defines;if(n.uber){for(var r="",a=0;a<i.length;a++){var o=i[a],s=e[o.name];if(s&&o._map){var c=o._map(s);r+=""+o._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],f=e[h.name];f&&h._map&&(l|=h._map(f)<<h._offset)}return l.toString(16)+"|"+n.hash},e.destroyShaderByDefines=function(t){var e=this,n=Object.keys(t);if(n.length)for(var i=n.map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+e+n)})),r=Object.keys(this._cache).filter((function(t){return i.every((function(n){return n.test(e._cache[t].name)}))})),a=0;a<r.length;a++){var o=r[a],s=this._cache[o];E("destroyed shader "+s.name),s.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(e,n));var a=this._cache[r];if(a)return a;var o=this._templates[e],s=this._templateInfos[o.hash];s.pipelineLayout||(this.getDescriptorSetLayout(t,e),cm(o,s,Od,"globals"),s.setLayouts[Bd.GLOBAL]=i.descriptorSetLayout,s.pipelineLayout=t.createPipelineLayout(new Xr(s.setLayouts)));var c=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],a=r.name,o=t[a],s=sm(r,o),c=!o||"0"===o;n.push({name:a,value:s,isDefault:c})}return n}(n,o.defines),l=i.constantMacros+o.constantMacros+c.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),""),u=o.glsl3,h=hm(t);return h?u=o[h]:console.error("Invalid GFX API!"),s.shaderInfo.stages[0].source=l+u.vert,s.shaderInfo.stages[1].source=l+u.frag,s.shaderInfo.attributes=function(t,e,n){for(var i=[],r=t.attributes,a=e.gfxAttributes,o=0;o<r.length;o++)um(r[o].defines,n)&&i.push(a[o]);return i}(o,s,n),s.shaderInfo.name=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,c),this._cache[r]=t.createShader(s.shaderInfo)},t}());l.programLib=Sm;var Tm=t("EffectAsset",Ec("cc.EffectAsset")((ym=vm=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"techniques",dm,rt(e)),st(e,"shaders",pm,rt(e)),st(e,"combinations",mm,rt(e)),st(e,"hideInEditor",gm,rt(e)),e}Z(e,t),e.register=function(t){e._effects[t.name]=t},e.remove=function(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name].equals(t)&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return void delete e._effects[n]}},e.get=function(t){if(e._effects[t])return e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return e._effects[n];return null},e.getAll=function(){return e._effects};var n=e.prototype;return n.onLoaded=function(){Sm.register(this),e.register(this),l.game.once(l.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var t=this,e=l.director.root,n=function(n){var i=t.shaders[n],r=t.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(t,e){return t.reduce((function(t,n){for(var i=r[e],a=0;a<i.length;++a){var o=J({},n);o[e]=i[a],t.push(o)}return t}),[])}),[{}]).forEach((function(t){return Sm.getGFXShader(e.device,i.name,t,e.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return e.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var i=e.get("unlit");this.name="unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}(Du),vm._effects={},dm=ct((_m=ym).prototype,"techniques",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pm=ct(_m.prototype,"shaders",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mm=ct(_m.prototype,"combinations",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gm=ct(_m.prototype,"hideInEditor",[Dc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fm=_m))||fm);l.EffectAsset=Tm;var xm,Em,Am,Cm,bm,wm,Im,Pm,Rm,Dm,Om,Nm,Mm,Lm,Fm,Bm=1024;!function(t){t[t.RGB565=pi.R5G6B5]="RGB565",t[t.RGB5A1=pi.RGB5A1]="RGB5A1",t[t.RGBA4444=pi.RGBA4]="RGBA4444",t[t.RGB888=pi.RGB8]="RGB888",t[t.RGB32F=pi.RGB32F]="RGB32F",t[t.RGBA8888=pi.RGBA8]="RGBA8888",t[t.RGBA32F=pi.RGBA32F]="RGBA32F",t[t.A8=pi.A8]="A8",t[t.I8=pi.L8]="I8",t[t.AI8=pi.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=pi.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=pi.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=Bm++]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=pi.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=pi.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=Bm++]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=pi.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=Bm++]="RGBA_ETC1",t[t.RGB_ETC2=pi.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=pi.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=pi.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=pi.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=pi.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=pi.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=pi.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=pi.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=pi.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=pi.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=pi.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=pi.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=pi.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=pi.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=pi.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=pi.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(xm||(xm={})),function(t){t[t.REPEAT=Pi.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=Pi.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=Pi.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=Pi.BORDER]="CLAMP_TO_BORDER"}(Em||(Em={})),function(t){t[t.NONE=Ii.NONE]="NONE",t[t.LINEAR=Ii.LINEAR]="LINEAR",t[t.NEAREST=Ii.POINT]="NEAREST"}(Am||(Am={})),le(pi);var zm,Um,km,Gm,Vm=new mt("Tex"),Hm=Ec("cc.TextureBase")((Fm=Lm=function(t){function e(){var e;return st(e=t.call(this)||this,"_format",wm,rt(e)),st(e,"_minFilter",Im,rt(e)),st(e,"_magFilter",Pm,rt(e)),st(e,"_mipFilter",Rm,rt(e)),st(e,"_wrapS",Dm,rt(e)),st(e,"_wrapT",Om,rt(e)),st(e,"_wrapR",Nm,rt(e)),st(e,"_anisotropy",Mm,rt(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=new xr,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=Vm.getNewId(),e._gfxDevice=e._getGFXDevice(),e._textureHash=Sa(e._id,666),e}Z(e,t);var n=e.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(t,e,n){void 0===n&&(n=t),this._wrapS=t,this._samplerInfo.addressU=t,this._wrapT=e,this._samplerInfo.addressV=e,this._wrapR=n,this._samplerInfo.addressW=n,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setFilters=function(t,e){this._minFilter=t,this._samplerInfo.minFilter=t,this._magFilter=e,this._samplerInfo.magFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo.mipFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo.maxAnisotropy=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.destroy=function(){var e,n=t.prototype.destroy.call(this);return n&&(null===(e=l.director.root)||void 0===e?void 0:e.batcher2D)&&l.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),n},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerInfo=function(){return this._samplerInfo},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):O(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},n._getGFXDevice=function(){return l.director.root?l.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(t){this._format=void 0===t?xm.RGBA8888:t},n._getGFXPixelFormat=function(t){return t===xm.RGBA_ETC1?t=xm.RGB_ETC1:t===xm.RGB_A_PVRTC_4BPPV1?t=xm.RGB_PVRTC_4BPPV1:t===xm.RGB_A_PVRTC_2BPPV1&&(t=xm.RGB_PVRTC_2BPPV1),t},Q(e,[{key:"isCompressed",get:function(){return this._format>=xm.RGB_ETC1&&this._format<=xm.RGBA_ASTC_12x12||this._format>=xm.RGB_A_PVRTC_2BPPV1&&this._format<=xm.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(Du),Lm.PixelFormat=xm,Lm.WrapMode=Em,Lm.Filter=Am,wm=ct((bm=Fm).prototype,"_format",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xm.RGBA8888}}),Im=ct(bm.prototype,"_minFilter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Am.LINEAR}}),Pm=ct(bm.prototype,"_magFilter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Am.LINEAR}}),Rm=ct(bm.prototype,"_mipFilter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Am.NONE}}),Dm=ct(bm.prototype,"_wrapS",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Em.REPEAT}}),Om=ct(bm.prototype,"_wrapT",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Em.REPEAT}}),Nm=ct(bm.prototype,"_wrapR",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Em.REPEAT}}),Mm=ct(bm.prototype,"_anisotropy",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cm=bm))||Cm;function Wm(t){return!!(l.sys.hasFeature(l.sys.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}l.TextureBase=Hm;var jm=t("ImageAsset",Ec("cc.ImageAsset")((Gm=km=function(t){function e(e){var n;return(n=t.call(this)||this)._nativeData=void 0,n._exportedExts=void 0,n._format=xm.RGBA8888,n._width=0,n._height=0,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&n.reset(e),n}Z(e,t);var n=e.prototype;return n.reset=function(t){Wm(t)||t instanceof HTMLElement?this._nativeData=t:(this._nativeData=t,this._format=t.format)},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Wm(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(t){var n="";"string"==typeof t?n=t:(this._width=t.w,this._height=t.h,n=t.fmt);for(var i,r=l.director.root?l.director.root.device:null,a=n.split("_"),o=Number.MAX_VALUE,s=this._format,c="",u=l.macro.SUPPORT_TEXTURE_FORMATS,h=ot(a);!(i=h()).done;){var f=i.value.split("@"),_=parseInt(f[0],void 0),d=e.extnames[_]||f[0],p=u.indexOf(d);if(-1!==p&&p<o){var m=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==d||r&&r.getFormatFeatures(pi.ASTC_RGBA_4X4)&Ci.SAMPLED_TEXTURE))continue;if(!(".pvr"!==d||r&&r.getFormatFeatures(pi.PVRTC_RGBA4)&Ci.SAMPLED_TEXTURE))continue;if(!(m!==xm.RGB_ETC1&&m!==xm.RGBA_ETC1||r&&r.getFormatFeatures(pi.ETC_RGB8)&Ci.SAMPLED_TEXTURE))continue;if(!(m!==xm.RGB_ETC2&&m!==xm.RGBA_ETC2||r&&r.getFormatFeatures(pi.ETC2_RGB8)&Ci.SAMPLED_TEXTURE))continue;if(".webp"===d&&!l.sys.hasFeature(l.sys.Feature.WEBP))continue;o=p,c=d,s=m}}c?(this._setRawAsset(c),this._format=s):R(3121)},n.initDefault=function(n){if(t.prototype.initDefault.call(this,n),e._sharedPlaceHolderCanvas)this.reset(e._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),r=i.getContext("2d"),a=i.width=i.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,a,a),this.reset(i),e._sharedPlaceHolderCanvas=i}},n.validate=function(){return!!this.data},Q(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||Wm(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Wm(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=xm.RGB_ETC1&&this._format<=xm.RGBA_ASTC_12x12||this._format>=xm.RGB_A_PVRTC_2BPPV1&&this._format<=xm.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}}]),e}(Du),km.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],km._sharedPlaceHolderCanvas=null,ct((Um=Gm).prototype,"_nativeAsset",[sl],Object.getOwnPropertyDescriptor(Um.prototype,"_nativeAsset"),Um.prototype),zm=Um))||zm);l.ImageAsset=jm;var Xm=new WeakMap,qm=new WeakSet,Ym=new WeakSet;function Km(t,e){var n;n=eh.safeFindClass;var i,r=Eh.pool.get();try{i=Lh(t,r,{classFinder:n,customEnv:e})}catch(t){throw T(t),Eh.pool.put(r),t}i._uuid=e.__uuid__||"";for(var a=r.uuidList,o=r.uuidObjList,s=r.uuidPropList,c=r.uuidTypeList||[],l=[],u=0;u<a.length;u++){var h=a[u];l[u]={uuid:Nl(h),owner:o[u],prop:s[u],type:ie._getClassById(c[u])}}return Xm.set(i,l),i._native&&qm.add(i),Eh.pool.put(r),i}var Qm,Jm=new(function(){function t(){this._depends=new ml}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?J({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),n=[];return this._descend(t,e,n),n},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var n,i,r=null;if(Array.isArray(e)||e.__type__||e instanceof hh){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(i=(n=e[5])[n.length-1])&&i<0)try{var a=Km(e,{__uuid__:t});(r=this._parseDepsFromAsset(a)).nativeDep&&(r.nativeDep.uuid=t),Tl.add(t+"@import",a)}catch(e){Sl.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0},n=Xm.get(t),i=0,r=n.length;i<r;i++)e.deps.push(n[i].uuid);return qm.has(t)&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=function(t){return n=(e=t)[1],e[10].map((function(t){return n[t]}));var e,n}(t);return e.forEach((function(t,n){return e[n]=Nl(t)})),e},e._descend=function(t,e,n){for(var i=this.getDeps(t),r=0;r<i.length;r++){var a=i[r];e[a]||(e[a]=!0,n.push(a),this._descend(a,e,n))}},t}()),Zm=[new lr];function $m(t){return t&&0==(t&t-1)}var tg,eg,ng,ig,rg,ag,og=Ec("cc.SimpleTexture")(Qm=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gfxTexture=null,e._gfxTextureView=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e._baseLevel=0,e._maxLevel=1e3,e}Z(e,t);var n=e.prototype;return n.getGFXTexture=function(){return this._gfxTextureView},n.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),t.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var i=this._getGFXDevice();if(i){var r=Zm[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?i.copyBuffersToTexture([t],this._gfxTexture,Zm):i.copyTexImagesToTexture([t],this._gfxTexture,Zm)}}},n._assignImage=function(t,e,n){var i=t.data;if(i&&(this.uploadData(i,e,n),this._checkTextureLoaded(),he.CLEANUP_IMAGE_CACHE)){var r=Jm.getDeps(this._uuid),a=r.indexOf(t._uuid);-1!==a&&(ht(r,a),t.decRef())}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},n._setMipRange=function(t,e){this._baseLevel=t<1?0:t,this._maxLevel=e<1?0:e},n.setMipRange=function(t,e){L(t<=e,3124),this._setMipRange(t,e);var n=this._getGFXDevice();if(n){var i=this._createTextureView(n);this._tryDestroyTextureView(),this._gfxTextureView=i}},n._getGfxTextureCreateInfo=function(){return null},n._getGfxTextureViewCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&(this._createTexture(t),this._gfxTextureView=this._createTextureView(t))}},n._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=Ai.NONE;this._mipFilter!==Am.NONE&&function(t,e,n){return!(t.gfxAPI===fi.WEBGL)||$m(e)&&$m(n)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var n=Math.max(t,e),i=0;n;)n>>=1,i++;return i}(this._width,this._height),e=Ai.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:Ei.SAMPLED|Ei.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(n){var i=t.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._createTextureView=function(t){if(!this._gfxTexture)return null;var e=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,n=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:e-this._baseLevel+1});return n?t.createTexture(n):null},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},n._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},Q(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(Hm))||Qm;l.SimpleTexture=og;var sg,cg,lg,ug,hg,fg,_g,dg=t("Texture2D",(tg=Ec("cc.Texture2D"),eg=al([jm]),tg((ag=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_mipmaps",rg,rt(e)),e}Z(e,t);var n=e.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},n.create=function(t,e,n,i,r,a){void 0===n&&(n=xm.RGBA8888),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=1e3),this.reset({width:t,height:e,format:n,mipmapLevel:i,baseLevel:r,maxLevel:a})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var n=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),i=0;i<n;++i){var r=t+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new jm,i.mipmaps[r]){var a=i.mipmaps[r];n.result.push(this._mipmaps,""+r,a,ie._getClassId(jm))}},n._getGfxTextureCreateInfo=function(t){var e=new Sr(xi.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t),e},n._getGfxTextureViewCreateInfo=function(t){var e=new Tr;return e.type=xi.TEX2D,Object.assign(e,t),e},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new jm;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},Q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){e._assignImage(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(og),rg=ct((ig=ag).prototype,"_mipmaps",[eg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ng=ig))||ng));l.Texture2D=dg,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(_g||(_g={}));var pg=t("TextureCube",Ec("cc.TextureCube")((fg=hg=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"isRGBE",lg,rt(e)),st(e,"_mipmaps",ug,rt(e)),e}Z(e,t),e.fromTexture2DArray=function(t,n){for(var i=[],r=t.length/6,a=0;a<r;a++){var o=6*a;i.push({front:t[o+_g.front].image,back:t[o+_g.back].image,left:t[o+_g.left].image,right:t[o+_g.right].image,top:t[o+_g.top].image,bottom:t[o+_g.bottom].image})}return(n=n||new e).mipmaps=i,n};var n=e.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},n.updateMipmaps=function(t,e){var n=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=function(e){var i=t+e;mg(n._mipmaps[i],(function(t,e){n._assignImage(t,i,e)}))},a=0;a<i;++a)r(a)},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this.isRGBE=i.rgbe,this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new jm,back:new jm,left:new jm,right:new jm,top:new jm,bottom:new jm};var a=i.mipmaps[r],o=ie._getClassId(jm);n.result.push(this._mipmaps[r],"front",a.front,o),n.result.push(this._mipmaps[r],"back",a.back,o),n.result.push(this._mipmaps[r],"left",a.left,o),n.result.push(this._mipmaps[r],"right",a.right,o),n.result.push(this._mipmaps[r],"top",a.top,o),n.result.push(this._mipmaps[r],"bottom",a.bottom,o)}},n._getGfxTextureCreateInfo=function(t){var e=new Sr(xi.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e},n._getGfxTextureViewCreateInfo=function(t){var e=new Tr;return e.type=xi.CUBE,e.baseLayer=0,e.layerCount=6,Object.assign(e,t),e},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new jm;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},Q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){mg(t,(function(t,i){e._assignImage(t,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(og),hg.FaceIndex=_g,lg=ct((cg=fg).prototype,"isRGBE",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ug=ct(cg.prototype,"_mipmaps",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sg=cg))||sg);function mg(t,e){e(t.front,_g.front),e(t.back,_g.back),e(t.left,_g.left),e(t.right,_g.right),e(t.top,_g.top),e(t.bottom,_g.bottom)}l.TextureCube=pg;var gg,vg,yg,Sg=t("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:3642336485,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:54,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:3507038093,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"geometry-renderer",techniques:[{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]},{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]}],shaders:[{name:"geometry-renderer|line-vs:vert|line-fs:front",hash:3617431e3,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|line-vs:vert|line-fs:back",hash:4168905198,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",hash:4034582016,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:back",hash:1762165009,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|triangle-vs:vert|triangle-fs:front",hash:4143142643,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:44,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|triangle-vs:vert|triangle-fs:back",hash:826026446,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:44,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:4284763886,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1},{name:"a_dist",defines:[],format:11,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"occlusion-query",techniques:[{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blendColorMask:0}]},program:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",hash:1571978323,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:41,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCWorldBound",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:851293782,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:64,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"USE_VK_SHADER",type:"boolean"},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position_starttime",defines:[],format:44,location:0},{name:"a_size_uv",defines:[],format:44,location:1},{name:"a_rotation_uv",defines:[],format:44,location:2},{name:"a_color",defines:[],format:44,location:3},{name:"a_dir_life",defines:[],format:44,location:4},{name:"a_rndSeed",defines:[],format:11,location:5},{name:"a_texCoord",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:7},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_color1",defines:["CC_RENDER_MODE"],format:44,location:9}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:2502358098,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:44,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:585841727,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:32,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4},{name:"a_color1",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:7}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:2499219289,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2},{name:"a_color2",defines:["TWO_COLORED"],format:44,location:3}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:67215139,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},specularIntensity:{value:[.5],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],linear:!0,type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},normalStrength:{value:[1],type:13,handleInfo:["emissiveScaleParam",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,.5]},emissiveScaleParam:{type:16,value:[1,1,1,1]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:4079105024,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:223,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:75},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["CC_USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_TWOSIDE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:14},{name:"a_texCoord1",defines:[],format:21,location:15}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:7},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:8},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:9}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3928335406,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:184,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:75},globals:{blocks:[{name:"CCShadow",defines:[]},{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_texCoord1",defines:[],format:21,location:14}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:3669699677,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:71,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:71},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_lightingMap",defines:["CC_USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:12},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:13},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:14}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:2218105608,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:69,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{linear:!0,type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3152709001,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:198,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:41},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:14}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"bloom",techniques:[{passes:[{phase:"bloom-prefilter",program:"bloom|bloom-vs|prefilter-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-combine",program:"bloom|bloom-vs|combine-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"bloom|bloom-vs|prefilter-fs",hash:837263906,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|downsample-fs",hash:682261797,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|upsample-fs",hash:3663548873,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|combine-fs",hash:670444562,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1},{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:2587574837,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:69},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:4},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:5},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:6}],images:[],textures:[],samplers:[],subpassInputs:[{name:"gbuffer_albedoMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:0},{name:"gbuffer_normalMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:1},{name:"gbuffer_emissiveMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:2},{name:"depth_stencil",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:3}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:3542426468,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:217,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:2960965003,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"ANTIALIAS_TYPE",type:"number",range:[0,3]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:0}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2207113861,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",priority:255,depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:179162168,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},percent:{value:[.5],type:13,handleInfo:["u_percent",0,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,0,0]},u_percent:{type:13,value:[.5]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:3189094080,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:21,location:0},{name:"a_texCoord",defines:[],format:21,location:1}],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]},{name:"Factor",defines:[],binding:1,stageFlags:16,members:[{name:"u_percent",type:13,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]}]),Tg={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 front() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 back() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_normal;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_normal;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_worldBoundCenter;\nuniform highp vec4 cc_worldBoundHalfExtents;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\nuniform highp vec4 cc_localShadowBias;\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\nvec2 CCGetShadowBias()\n{\n#if USE_INSTANCING\nreturn vec2(a_localShadowBias.x + cc_shadowWHPBInfo.w, a_localShadowBias.y + cc_shadowLPNNInfo.z);\n#elif !USE_BATCHING\nreturn vec2(cc_localShadowBias.x + cc_shadowWHPBInfo.w, cc_localShadowBias.y + cc_shadowLPNNInfo.z);\n#else\nreturn vec2(cc_shadowWHPBInfo.w, cc_shadowLPNNInfo.z);\n#endif\n}\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying mediump vec3 v_normal;\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying mediump vec2 v_uv1;\n#endif\n#if CC_RECEIVE_SHADOW\nvarying mediump vec2 v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvarying mediump vec4 v_tangent;\n#endif\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.z;\nv_luv.z = cc_lightingMapUVParam.w;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.z;\nv_luv.z = a_lightingMapUVParam.w;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if CC_RECEIVE_SHADOW\nv_shadowBias = CCGetShadowBias();\n#endif\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent.xyz = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_tangent.w = In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying mediump vec2 v_uv1;\n#endif\nvarying mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nvarying mediump vec2 v_shadowBias;\n#endif\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying mediump vec4 v_tangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = lightColor.xyz * v_luv.z;\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\nvec3 bitangent = cross(v_normal, v_tangent.xyz) * v_tangent.w;\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent.xyz) +\n(nmmp.y * emissiveScaleParam.w) * normalize(bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.specularIntensity = 0.5;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying vec2 v_uv1;\n#endif\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nuniform highp mat4 cc_matLightView;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying vec2 v_uv1;\n#endif\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\n#if CC_RECEIVE_SHADOW\nvarying vec2 v_shadowBias;\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if CC_USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.z;\nluv.z = lightMapUVParam.w;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if CC_RECEIVE_SHADOW\nv_shadowBias = vec2(0.0, 0.0);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nvarying vec2 v_shadowBias;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 tangent = vec3(1.0, 0.0, 0.0);\nvec3 binormal = vec3(0.0, 0.0, 1.0);\nbinormal = cross(tangent, v_normal);\ntangent = cross(v_normal, binormal);\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(tangent) +\nnmmp.y * normalize(binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#if LAYERS == 1\ns.specularIntensity = 0.5;\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = lightColor.xyz * luv.z;\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture2D(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture2D(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\ngl_FragColor = vec4(color, 1.0);\n} else {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nvoid main() {\nvec4 hdrColor = texture2D(outputResultMap, v_uv);\nvec3 bloomColor = texture2D(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\ngl_FragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewProjInv;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nvarying vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nuniform sampler2D depth_stencil;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#endif\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gl_LastFragData[0];\nvec4 normalMap = gl_LastFragData[1];\nvec4 emissiveMap = gl_LastFragData[2];\nfloat depth = texture2D(depth_stencil, v_uv).x;\n#else\nvec4 albedoMap = texture2D(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture2D(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(gbuffer_emissiveMap,v_uv);\nfloat depth = texture2D(depth_stencil, v_uv).x;\n#endif\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.specularIntensity = 0.5;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngl_FragData[2] = color;\n#else\ngl_FragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nuniform mediump vec4 cc_planarNDInfo;\nvarying float v_dist;\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nvarying vec2 v_uv;\nuniform sampler2D outputResultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\ngl_FragColor = texture2D(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\n#endif\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform float u_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nout float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nin float v_distance;\nvec4 front() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nout float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nin float v_distance;\nvec4 back() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_normal;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_normal;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCWorldBound {\nhighp vec4 cc_worldBoundCenter;\nhighp vec4 cc_worldBoundHalfExtents;\n};\nin vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#if SAMPLE_FROM_RT\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\nvec2 CCGetShadowBias()\n{\n#if USE_INSTANCING\nreturn vec2(a_localShadowBias.x + cc_shadowWHPBInfo.w, a_localShadowBias.y + cc_shadowLPNNInfo.z);\n#elif !USE_BATCHING\nreturn vec2(cc_localShadowBias.x + cc_shadowWHPBInfo.w, cc_localShadowBias.y + cc_shadowLPNNInfo.z);\n#else\nreturn vec2(cc_shadowWHPBInfo.w, cc_shadowLPNNInfo.z);\n#endif\n}\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout lowp vec4 v_color;\n#endif\nout vec3 v_position;\nout mediump vec3 v_normal;\nout vec2 v_uv;\n#if HAS_SECOND_UV\nout mediump vec2 v_uv1;\n#endif\n#if CC_RECEIVE_SHADOW\nout mediump vec2 v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nout mediump vec4 v_tangent;\n#endif\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.z;\nv_luv.z = cc_lightingMapUVParam.w;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.z;\nv_luv.z = a_lightingMapUVParam.w;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if CC_RECEIVE_SHADOW\nv_shadowBias = CCGetShadowBias();\n#endif\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent.xyz = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_tangent.w = In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\n#if HAS_SECOND_UV\nin mediump vec2 v_uv1;\n#endif\nin mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nin mediump vec2 v_shadowBias;\n#endif\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin mediump vec4 v_tangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = lightColor.xyz * v_luv.z;\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\nvec3 bitangent = cross(v_normal, v_tangent.xyz) * v_tangent.w;\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent.xyz) +\n(nmmp.y * emissiveScaleParam.w) * normalize(bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.specularIntensity = 0.5;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\n#if HAS_SECOND_UV\nout vec2 v_uv1;\n#endif\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec2 v_uv;\n#if HAS_SECOND_UV\nin vec2 v_uv1;\n#endif\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\n#if CC_RECEIVE_SHADOW\nout vec2 v_shadowBias;\n#endif\nout highp vec3 v_position;\nout mediump vec3 v_normal;\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if CC_USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.z;\nluv.z = lightMapUVParam.w;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if CC_RECEIVE_SHADOW\nv_shadowBias = vec2(0.0, 0.0);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nin vec2 v_shadowBias;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 tangent = vec3(1.0, 0.0, 0.0);\nvec3 binormal = vec3(0.0, 0.0, 1.0);\nbinormal = cross(tangent, v_normal);\ntangent = cross(v_normal, binormal);\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(tangent) +\nnmmp.y * normalize(binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#if LAYERS == 1\ns.specularIntensity = 0.5;\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = lightColor.xyz * luv.z;\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\nfragColor = vec4(color, 1.0);\n} else {\nfragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvoid main() {\nvec4 hdrColor = texture(outputResultMap, v_uv);\nvec3 bloomColor = texture(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\nfragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nin vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nlayout(location = 0) inout vec4 gbuffer_albedoMap;\nlayout(location = 1) inout vec4 gbuffer_normalMap;\nlayout(location = 2) inout vec4 gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#endif\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\nlayout(location = 0) out vec4 fragColor;\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gbuffer_albedoMap;\nvec4 normalMap = gbuffer_normalMap;\nvec4 emissiveMap = gbuffer_emissiveMap;\nfloat depth = texture(depth_stencil, v_uv).x;\n#else\nvec4 albedoMap = texture(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(gbuffer_emissiveMap,v_uv);\nfloat depth = texture(depth_stencil, v_uv).x;\n#endif\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.specularIntensity = 0.5;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngbuffer_emissiveMap = color;\n#else\nfragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nout float v_dist;\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nin vec2 v_uv;\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\nfragColor = texture(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\n#endif\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nlayout(std140) uniform Factor {\nfloat u_percent;\n};\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},xg=function(){function t(){this._device=null,this._resources={}}var e=t.prototype;return e.initBuiltinRes=function(t){var e=this;this._device=t;for(var n=this._resources,i=new Uint8Array(16),r=new Uint8Array(16),a=new Uint8Array(16),o=new Uint8Array(16),s=new Uint8Array(16),c=0,u=0;u<4;u++)i[c]=0,i[c+1]=0,i[c+2]=0,i[c+3]=255,r[c]=0,r[c+1]=0,r[c+2]=0,r[c+3]=0,a[c]=119,a[c+1]=119,a[c+2]=119,a[c+3]=255,o[c]=255,o[c+1]=255,o[c+2]=255,o[c+3]=255,s[c]=127,s[c+1]=127,s[c+2]=255,s[c+3]=255,c+=4;var h=new Uint8Array(1024);c=0;for(var f=0;f<256;f++)h[c]=221,h[c+1]=221,h[c+2]=221,h[c+3]=255,c+=4;c=0;for(var _=0;_<8;_++){for(var d=0;d<8;d++)h[c]=85,h[c+1]=85,h[c+2]=85,h[c+3]=255,c+=4;c+=32}c+=32;for(var p=0;p<8;p++){for(var m=0;m<8;m++)h[c]=85,h[c+1]=85,h[c+2]=85,h[c+3]=255,c+=4;c+=32}var g={width:2,height:2,_data:i,_compressed:!1,format:dg.PixelFormat.RGBA8888},v={width:2,height:2,_data:r,_compressed:!1,format:dg.PixelFormat.RGBA8888},y={width:2,height:2,_data:a,_compressed:!1,format:dg.PixelFormat.RGBA8888},S={width:2,height:2,_data:o,_compressed:!1,format:dg.PixelFormat.RGBA8888},T={width:2,height:2,_data:s,_compressed:!1,format:dg.PixelFormat.RGBA8888},x={width:16,height:16,_data:h,_compressed:!1,format:dg.PixelFormat.RGBA8888},E=new jm(g),A=new dg;A._uuid="black-texture",A.image=E,n[A._uuid]=A;var C=new jm(v),b=new dg;b._uuid="empty-texture",b.image=C,n[b._uuid]=b;var w=new pg;w._uuid="black-cube-texture",w.setMipFilter(pg.Filter.NEAREST),w.image={front:new jm(g),back:new jm(g),left:new jm(g),right:new jm(g),top:new jm(g),bottom:new jm(g)},n[w._uuid]=w;var I=new jm(y),P=new dg;P._uuid="grey-texture",P.image=I,n[P._uuid]=P;var R=new jm(S),D=new dg;D._uuid="white-texture",D.image=R,n[D._uuid]=D;var O=new pg;O._uuid="white-cube-texture",O.setMipFilter(pg.Filter.NEAREST),O.image={front:new jm(S),back:new jm(S),left:new jm(S),right:new jm(S),top:new jm(S),bottom:new jm(S)},n[O._uuid]=O;var N=new jm(T),M=new dg;M._uuid="normal-texture",M.image=N,n[M._uuid]=M;var L=new jm(x),F=new dg;F._uuid="default-texture",F.image=L,n[F._uuid]=F;var B=new pg;if(B.setMipFilter(pg.Filter.NEAREST),B._uuid="default-cube-texture",B.image={front:new jm(x),back:new jm(x),left:new jm(x),right:new jm(x),top:new jm(x),bottom:new jm(x)},n[B._uuid]=B,l.SpriteFrame){var z=new l.SpriteFrame,U=E,k=new dg;k.image=U,z.texture=k,z._uuid="default-spriteframe",n[z._uuid]=z}var G=hm(t);if(!G)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var V=Tg[G];return V?Promise.resolve().then((function(){Sg.forEach((function(t,e){var n=Object.assign(new l.EffectAsset,t);n.shaders.forEach((function(t,n){var i=V[e][n];i&&(t[G]=i)})),n.hideInEditor=!0,n.onLoaded()})),e._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+G+" but shaders of that version are not assembled in this build."))},e.get=function(t){return this._resources[t]},e._initMaterials=function(){var t=this._resources,e=[],n=new l.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),t[n._uuid]=n,e.push(n);var i=new l.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",l.color("#ffff00")),t[i._uuid]=i,e.push(i);var r=new l.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",l.color("#ff00ff")),t[r._uuid]=r,e.push(r);var a=new l.Material;a._uuid="default-clear-stencil",a.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),t[a._uuid]=a,e.push(a);var o=new l.Material;o._uuid="ui-base-material",o.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),t[o._uuid]=o,e.push(o);var s=new l.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[s._uuid]=s,e.push(s);var c=new l.Material;c._uuid="ui-alpha-test-material",c.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[c._uuid]=c,e.push(c);var u=new l.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),t[u._uuid]=u,e.push(u);var h=new l.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),t[h._uuid]=h,e.push(h);var f=new l.Material;f._uuid="ui-sprite-gray-alpha-sep-material",f.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),t[f._uuid]=f,e.push(f);var _=new l.Material;_._uuid="ui-graphics-material",_.initialize({effectName:"graphics"}),t[_._uuid]=_,e.push(_);var d=new l.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),t[d._uuid]=d,e.push(d);var p=new l.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),t[p._uuid]=p,e.push(p);var m=new l.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),t[m._uuid]=m,e.push(m);var g=new l.Material;g._uuid="default-billboard-material",g.initialize({effectName:"billboard"}),t[g._uuid]=g,e.push(g);var v=new l.Material;v._uuid="default-spine-material",v.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),t[v._uuid]=v,e.push(v),l.game.on(l.Game.EVENT_GAME_INITED,(function(){for(var t=0;t<e.length;++t)for(var n=e[t],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},t}(),Eg=t("builtinResMgr",l.builtinResMgr=new xg),Ag=t("getPhaseID",(gg=new Map,vg=0,function(t){return"number"==typeof t?t:(gg.has(t)||(gg.set(t,1<<vg),vg++),gg.get(t))})),Cg=t("InstancedBuffer",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,n,i){void 0===i&&(i=null);var r=e.buffer.length;if(r){var a=t.inputAssembler,o=t.descriptorSet.getTexture(wp),s=i;s||(s=t.shaders[n]);for(var c=t.descriptorSet,l=0;l<this.instances.length;++l){var u=this.instances[l];if(!(u.ia.indexBuffer!==a.indexBuffer||u.count>=1024)&&u.lightingMap===o&&u.stride===r){if(u.count>=u.capacity){u.capacity<<=1;var h=u.stride*u.capacity,f=u.data;u.data=new Uint8Array(h),u.data.set(f),u.vb.resize(h)}return u.shader!==s&&(u.shader=s),u.descriptorSet!==c&&(u.descriptorSet=c),u.data.set(e.buffer,u.stride*u.count++),void(this.hasPendingModels=!0)}}for(var _=this._device.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,32*r,r)),d=new Uint8Array(32*r),p=a.vertexBuffers.slice(),m=a.attributes.slice(),g=a.indexBuffer,v=0;v<e.attributes.length;v++){var y=e.attributes[v],S=new Or(y.name,y.format,y.isNormalized,p.length,!0);m.push(S)}d.set(e.buffer),p.push(_);var T=new Mr(m,p,g),x=this._device.createInputAssembler(T);this.instances.push({count:1,capacity:32,vb:_,data:d,ia:x,stride:r,shader:s,descriptorSet:c,lightingMap:o}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var n=this.instances[e];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}()),bg=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],n=0;n<e.vbs.length;++n)e.vbs[n].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,n){var i=t.subMesh.flatBuffers;if(0!==i.length){for(var r=0,a=0,o=i[0].count,s=t.passes[e],c=t.shaders[e],l=t.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var f=this.batches[h];if(f.vbs.length===i.length&&f.mergeCount<op.BATCHING_COUNT){u=!0;for(var _=0;_<f.vbs.length;++_)if(f.vbs[_].stride!==i[_].stride){u=!1;break}if(u){for(var d=0;d<f.vbs.length;++d){var p=i[d],m=f.vbs[d],g=f.vbDatas[d];(r=(o+f.vbCount)*p.stride)>m.size&&(m.resize(r),f.vbDatas[d]=new Uint8Array(r),f.vbDatas[d].set(g)),f.vbDatas[d].set(p.buffer,f.vbCount*p.stride)}var v=f.vbIdxData;(a=4*(o+f.vbCount))>f.vbIdx.size&&(f.vbIdx.resize(a),f.vbIdxData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT),f.vbIdxData.set(v),v=f.vbIdxData);var y=f.vbCount,S=y+o,T=f.mergeCount;if(v[y]!==T||v[S-1]!==T)for(var x=y;x<S;x++)v[x]=T+.1;return Xn.toArray(f.uboData,n.transform.worldMatrix,op.MAT_WORLDS_OFFSET+16*f.mergeCount),f.mergeCount||(l.bindBuffer(op.BINDING,f.ubo),l.update(),f.pass=s,f.shader=c,f.descriptorSet=l),++f.mergeCount,f.vbCount+=o,void(f.ia.vertexCount+=o)}}}for(var E=[],A=[],C=[],b=0;b<i.length;++b){var w=i[b],I=this._device.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,w.count*w.stride,w.stride));I.update(w.buffer.buffer),E.push(I),A.push(new Uint8Array(I.size)),C.push(I)}var P=this._device.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,4*o,4)),R=new Float32Array(o);R.fill(0),P.update(R),C.push(P);for(var D=t.inputAssembler.attributes,O=new Array(D.length+1),N=0;N<D.length;++N)O[N]=D[N];O[D.length]=new Or("a_dyn_batch_id",pi.R32F,!1,i.length);var M=new Mr(O,C),L=this._device.createInputAssembler(M),F=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,op.SIZE,op.SIZE));l.bindBuffer(op.BINDING,F),l.update();var B=new Float32Array(op.COUNT);Xn.toArray(B,n.transform.worldMatrix,op.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:E,vbDatas:A,vbIdx:P,vbIdxData:R,vbCount:o,ia:L,ubo:F,uboData:B,pass:s,shader:c,descriptorSet:l})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}(),wg=new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE),Ig=new mr(null),Pg=new jr(null);!function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(yg||(yg={}));var Rg=function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new Ia,this._dss=new ba,this._rs=new Ca,this._priority=wd.DEFAULT,this._stage=bd.DEFAULT,this._phase=Ag("default"),this._primitive=Gi.TRIANGLE_LIST,this._batchingScheme=yg.NONE,this._dynamicStates=ji.NONE,this._instancedBuffers={},this._batchedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._passHandle=0,this._rootBufferDirty=!1,this._root=t,this._device=t.device}t.fillPipelineInfo=function(t,e){void 0!==e.priority&&t._setPriority(e.priority),void 0!==e.primitive&&t._setPrimitive(e.primitive),void 0!==e.stage&&t._setStage(e.stage),void 0!==e.dynamicStates&&t._setDynamicState(e.dynamicStates),void 0!==e.phase&&t._setPhase(Ag(e.phase));var n=t._bs;if(e.blendState){var i=e.blendState,r=i.targets;r&&r.forEach((function(t,e){n.setTarget(e,t)})),void 0!==i.isA2C&&(n.isA2C=i.isA2C),void 0!==i.isIndepend&&(n.isIndepend=i.isIndepend),void 0!==i.blendColor&&(n.blendColor=i.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t){var e,n=Sm.getKey(t.program,t.defines)+","+t._primitive+","+t._dynamicStates;return n+=function(t){for(var e,n=",bs,"+t.isA2C,i=ot(t.targets);!(e=i()).done;){var r=e.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(t._bs),n+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),Sa(n+=",rs,"+(e=t._rs).cullMode+","+e.depthBias+","+e.isFrontFaceCCW,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=gi.UNKNOWN);var i=this._propertyHandleMap[t];return i?(n?i=$p(i,n):e&&(i=$p(i,Kp(i)-e)),i+e):0},e.getBinding=function(e){var n=this.getHandle(e);return n?t.getBindingFromHandle(n):-1},e.setUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);em[r](o,n,a),this._setRootBufferDirty(!0)},e.getUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);return tm[r](o,n,a)},e.setUniformArray=function(e,n){for(var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=ua(r)>>2,o=this._getBlockView(r,i),s=t.getOffsetFromHandle(e),c=0;c<n.length;c++,s+=a)null!==n[c]&&em[r](o,n[c],s);this._setRootBufferDirty(!0)},e.bindTexture=function(t,e,n){this._descriptorSet.bindTexture(t,e,n||0)},e.bindSampler=function(t,e,n){this._descriptorSet.bindSampler(t,e,n||0)},e.setDynamicState=function(t,e){var n=this._dynamics[t];n&&n.value===e||(n.value=e,n.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e._setRootBufferDirty=function(t){this._rootBufferDirty=t},e.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._setRootBufferDirty(!1)),this._descriptorSet.update()):O(12006)},e.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new Cg(this))},e.getBatchedBuffer=function(t){return void 0===t&&(t=0),this._batchedBuffers[t]||(this._batchedBuffers[t]=new bg(this))},e._initNative=function(){},e._destroy=function(){},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();for(var i in this._batchedBuffers)this._batchedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._destroy()},e.resetUniform=function(e){var n=this.getHandle(e);if(n){for(var i=t.getTypeFromHandle(n),r=t.getBindingFromHandle(n),a=t.getOffsetFromHandle(n),o=t.getCountFromHandle(n),s=this._getBlockView(i,r),c=this._properties[e],l=c&&c.value||im(i),u=(ua(i)>>2)*o,h=0;h+l.length<=u;h+=l.length)s.set(l,a+h);this._setRootBufferDirty(!0)}},e.resetTexture=function(e,n){var i=this.getHandle(e);if(i){var r=t.getTypeFromHandle(i),a=t.getBindingFromHandle(i),o=this._properties[e],s=o&&o.value,c=s?s+"-texture":im(r),l=Eg.get(c),u=l&&l.getGFXTexture(),h=o&&void 0!==o.samplerHash?Na.unpackFromHash(o.samplerHash):l&&l.getSamplerInfo(),f=this._device.getSampler(h);this._descriptorSet.bindSampler(a,f,n),this._descriptorSet.bindTexture(a,u,n)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],n=0,i=0;i<e.members.length;i++){for(var r=e.members[i],a=this._getBlockView(r.type,e.binding),o=this._properties[r.name],s=o&&o.value||im(r.type),c=(ua(r.type)>>2)*r.count,l=0;l+s.length<=c;l+=s.length)a.set(s,n+l);n+=c}this._setRootBufferDirty(!0)},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplerTextures.length;t++)for(var e=this._shaderInfo.samplerTextures[t],n=0;n<e.count;n++)this.resetTexture(e.name,n)},e.tryCompile=function(){var e=this._root.pipeline;if(!e)return!1;this._syncBatchingScheme();var n=Sm.getGFXShader(this._device,this._programName,this._defines,e);return n?(this._shader=n,this._setPipelineLayout(Sm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t.getPassHash(this)),!0):(console.warn("create shader "+this._programName+" failed"),!1)},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return console.warn("pass resources incomplete"),null;if(!t)return this._shader;for(var e=this._root.pipeline,n=0;n<t.length;n++){var i=t[n];this._defines[i.name]=i.value}for(var r=Sm.getGFXShader(this._device,this._programName,this._defines,e),a=0;a<t.length;a++){var o=t[a];delete this._defines[o.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._setPriority=function(t){this._priority=t},e._setStage=function(t){this._stage=t},e._setPhase=function(t){this._phase=t},e._setPrimitive=function(t){this._primitive=t},e._setState=function(t,e,n,i){this._bs=t,this._dss=e,this._rs=n,this._descriptorSet=i},e._doInit=function(e,n){void 0===n&&(n=!1),this._initNative(),this._setPriority(wd.DEFAULT),this._setStage(bd.DEFAULT),this._setPhase(Ag("default")),this._setPrimitive(Gi.TRIANGLE_LIST),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=n?J({},e.defines):e.defines,this._shaderInfo=Sm.getTemplate(e.program),this._properties=e.properties||this._properties;var i=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),Pg.layout=Sm.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(Pg),this._setState(this._bs,this._dss,this._rs,this._descriptorSet);for(var r=this._shaderInfo.blocks,a=Sm.getTemplateInfo(e.program),o=a.blockSizes,s=a.handleMap,c=i.capabilities.uboOffsetAlignment,l=[],u=0,h=0,f=0;f<r.length;f++){var _=o[f];l.push(h),h+=Math.ceil(_/c)*c,u=_}var d=l[l.length-1]+u;d&&(wg.size=16*Math.ceil(d/16),this._rootBuffer=i.createBuffer(wg),this._rootBlock=new ArrayBuffer(d));for(var p=0,m=0;p<r.length;p++){var g=r[p].binding,v=o[p];Ig.buffer=this._rootBuffer,Ig.offset=l[m++],Ig.range=16*Math.ceil(v/16);var y=this._buffers[g]=i.createBuffer(Ig);this._blocks[g]=new Float32Array(this._rootBlock,Ig.offset,v/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[g]=new Int32Array(this._blocks[g].buffer,this._blocks[g].byteOffset,this._blocks[g].length),this._descriptorSet.bindBuffer(g,y)}var S=this._propertyHandleMap=s,T={};for(var x in this._properties){var E=this._properties[x];E.handleInfo&&(T[x]=this.getHandle.apply(this,E.handleInfo))}Object.assign(S,T)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(di.INSTANCED_ARRAYS)?this._setBatchingScheme(yg.INSTANCING):(this._defines.USE_INSTANCING=!1,this._setBatchingScheme(yg.NONE)):this._defines.USE_BATCHING?this._setBatchingScheme(yg.VB_MERGING):this._setBatchingScheme(yg.NONE)},e._setBatchingScheme=function(t){this._batchingScheme=t},e._setDynamicState=function(t){this._dynamicStates=t},e._setHash=function(t){this._hash=t},e._getBlockView=function(t,e){return t<gi.FLOAT?this._blocksInt[e]:this._blocks[e]},e._setPipelineLayout=function(t){this._pipelineLayout=t},e._initPassFromTarget=function(t,e,n,i){this._initNative(),this._setPriority(t.priority),this._setStage(t.stage),this._setPhase(t.phase),this._setBatchingScheme(t.batchingScheme),this._setPrimitive(t.primitive),this._setDynamicState(t.dynamicStates),this._setState(n,e,t.rasterizerState,t.descriptorSet),this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,this._setPipelineLayout(Sm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t._hash^i)},Q(t,[{key:"native",get:function(){return this._nativeObj}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Sm.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}();Rg.getTypeFromHandle=Kp,Rg.getBindingFromHandle=Qp,Rg.getCountFromHandle=Jp,Rg.getOffsetFromHandle=Zp;var Dg=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,e,n,i,r){var a=e.hash^i.hash^r.attributesHash^n.typedID,o=this._PSOHashMap.get(a);if(!o){var s=e.pipelineLayout,c=new qr(r.attributes),l=new Pa(n,s,i,c,e.rasterizerState,e.depthStencilState,e.blendState,e.primitive,e.dynamicStates);o=t.createPipelineState(l),this._PSOHashMap.set(a,o)}return o},t}());Dg._PSOHashMap=new Map;var Og=new ur,Ng=new ir;function Mg(t,e){t.x=e.x*e.x,t.y=e.y*e.y,t.z=e.z*e.z}var Lg,Fg,Bg,zg,Ug,kg,Gg,Vg,Hg,Wg,jg=null;function Xg(t,e,n,i,r){if(i&&i.enabled&&r===jg){var a=i.subModels[0],o=a.inputAssembler,s=a.passes,c=a.shaders,l=a.descriptorSet;Og.width=Ng.width=r.window.width,Og.height=Ng.height=r.window.height;var u=Dg.getOrCreatePipelineState(t,s[0],c[0],e,o);n.setViewport(Og),n.setScissor(Ng),n.bindPipelineState(u),n.bindDescriptorSet(Bd.MATERIAL,s[0].descriptorSet),n.bindDescriptorSet(Bd.LOCAL,l),n.bindInputAssembler(o),n.draw(o)}}var qg,Yg,Kg,Qg,Jg,Zg=new ti,$g=t("Material",(Lg=Ec("cc.Material"),Fg=al(Tm),Lg((Wg=function(t){function e(){var e;return st(e=t.call(this)||this,"_effectAsset",Ug,rt(e)),st(e,"_techIdx",kg,rt(e)),st(e,"_defines",Gg,rt(e)),st(e,"_states",Vg,rt(e)),st(e,"_props",Hg,rt(e)),e._passes=[],e._hash=0,e}Z(e,t),e.getHash=function(t){for(var e,n=0,i=ot(t.passes);!(e=i()).done;)n^=e.value.hash;return n};var n=e.prototype;return n.initialize=function(t){this._passes.length?R(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(t),this._update())},n.reset=function(t){this.initialize(t)},n.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update()},n.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var n,i=ot(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(t,e,n){var i=!1;if(void 0===n)for(var r=this._passes,a=r.length,o=0;o<a;o++){var s=r[o];this._uploadProperty(s,t,e)&&(this._props[s.propertyIndex][t]=e,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,t,e)&&(this._props[c.propertyIndex][t]=e,i=!0)}i||console.warn("illegal property name: "+t+".")},n.getProperty=function(t,e){if(void 0===e)for(var n=this._props,i=n.length,r=0;r<i;r++){var a=n[r];if(t in a)return a[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},n.copy=function(t,e){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=J({},t._props[n]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=J({},t._defines[i]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=J({},t._states[r]);this._effectAsset=t._effectAsset,e&&this._fillInfo(e),this._update()},n._fillInfo=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=Tm.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states)},n._prepareInfo=function(t,e){var n=t;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(e[r]||(e[r]={}),n[r])},n._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,n=[],i=0;i<e;++i){var r=t.passes[i],a=r.passIndex=i,o=r.defines=this._defines[a]||(this._defines[a]={});if(r.stateOverrides=this._states[a]||(this._states[a]={}),void 0!==r.propertyIndex&&Object.assign(o,this._defines[r.propertyIndex]),void 0!==r.embeddedMacros&&Object.assign(o,r.embeddedMacros),!r.switch||o[r.switch]){var s=new Rg(l.director.root);s.initialize(r),n.push(s)}}return n},n._update=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this._createPasses();var i=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=i,t)this._passes.forEach((function(t,e){var i=n._props[e];for(var r in i||(i=n._props[e]={}),void 0!==t.propertyIndex&&Object.assign(i,n._props[t.propertyIndex]),i)n._uploadProperty(t,r,i[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=e.getHash(this)},n._uploadProperty=function(t,e,n){var i=t.getHandle(e);if(!i)return!1;if(Rg.getTypeFromHandle(i)<gi.SAMPLER1D)if(Array.isArray(n))t.setUniformArray(i,n);else if(null!==n){var r;if(null===(r=t.properties[e])||void 0===r?void 0:r.linear){var a=n;Mg(Zg,a),Zg.w=a.w,n=Zg}t.setUniform(i,n)}else t.resetUniform(e);else if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(t,i,n[o],o);else n?this._bindTexture(t,i,n):t.resetTexture(e);return!0},n._bindTexture=function(t,e,n,i){var r=Rg.getBindingFromHandle(e);if(n instanceof La)t.bindTexture(r,n,i);else if(n instanceof Hm){var a=n.getGFXTexture();if(!a||!a.width||!a.height)return;t.bindTexture(r,a,i),t.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=ot(this._passes);!(t=e()).done;)t.value.destroy();this._passes.length=0},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new Pn("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},Q(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(Du),Ug=ct((zg=Wg).prototype,"_effectAsset",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kg=ct(zg.prototype,"_techIdx",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gg=ct(zg.prototype,"_defines",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vg=ct(zg.prototype,"_states",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hg=ct(zg.prototype,"_props",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bg=zg))||Bg));l.Material=$g,function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(qg||(qg={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(Yg||(Yg={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(Kg||(Kg={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(Qg||(Qg={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(Jg||(Jg={}));var tv=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],ev=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],nv=[100,200,400,800],iv=new Dn,rv=new Dn,av=new Xn,ov=Ji.STENCIL<<1,sv=[],cv=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=qg.VERTICAL,this._fov=_n(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new hr(.2,.2,.2,1),this._viewport=new ai(0,0,1,1),this._orientedViewport=new ai(0,0,1,1),this._curTransform=_i.IDENTITY,this._isProjDirty=!0,this._matView=new Xn,this._matProj=new Xn,this._matProjInv=new Xn,this._matViewProj=new Xn,this._matViewProjInv=new Xn,this._frustum=new oc,this._forward=new Dn,this._position=new Dn,this._priority=0,this._aperture=Kg.F16_0,this._apertureValue=void 0,this._shutter=Jg.D125,this._shutterValue=0,this._iso=Qg.ISO100,this._isoValue=0,this._window=null,this._width=1,this._height=1,this._clearFlag=Ji.NONE,this._clearDepth=1,this._visibility=Gp,this._exposure=0,this._clearStencil=0,this._device=t,this._apertureValue=tv[this._aperture],this._shutterValue=ev[this._shutter],this._isoValue=nv[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!sv.length){var e=t.capabilities.clipSpaceSignY;sv[_i.IDENTITY]=new Xn(1,0,0,0,0,e),sv[_i.ROTATE_90]=new Xn(0,1,0,0,-e,0),sv[_i.ROTATE_180]=new Xn(-1,0,0,0,0,-e),sv[_i.ROTATE_270]=new Xn(0,-1,0,0,e,0)}}var e=t.prototype;return e._setWidth=function(t){this._width=t},e._setHeight=function(t){this._height=t},e._setScene=function(t){this._scene=t},e._updateAspect=function(t){if(void 0===t&&(t=!0),this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),t){var e=this.window.swapchain;(e&&e.surfaceTransform||_i.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0},e._init=function(){},e._destroy=function(){},e.initialize=function(t){this._init(t),this.node=t.node,this._setWidth(1),this._setHeight(1),this.clearFlag=Ji.NONE,this.clearDepth=1,this.visibility=Gp,this._name=t.name,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(t.window)},e.destroy=function(){this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,this._destroy()},e.attachToScene=function(t){this._enabled=!0,this._setScene(t)},e.detachFromScene=function(){this._enabled=!1,this._setScene(null)},e.resize=function(t,e){this._window&&(this._setWidth(t),this._setHeight(e),this._updateAspect())},e.setFixedSize=function(t,e){this._setWidth(t),this._setHeight(e),this._updateAspect(!1),this.isWindowSize=!1},e.syncCameraEditor=function(){},e.update=function(t){var e;if(void 0===t&&(t=!1),this._node){var n=!1;(this._node.hasChangedFlags||t)&&(Xn.invert(this._matView,this._node.worldMatrix),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),n=!0);var i=null===(e=this.window)||void 0===e?void 0:e.swapchain,r=i&&i.surfaceTransform||_i.IDENTITY;if(this._isProjDirty||this._curTransform!==r){this._curTransform=r;var a=this._device.capabilities.clipSpaceSignY;if(this._proj===Yg.PERSPECTIVE)Xn.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===qg.VERTICAL,this._device.capabilities.clipSpaceMinZ,a,r);else{var o=this._orthoHeight*this._aspect,s=this._orthoHeight;Xn.ortho(this._matProj,-o,o,-s,s,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,a,r)}Xn.invert(this._matProjInv,this._matProj),n=!0,this._isProjDirty=!1}n&&(Xn.multiply(this._matViewProj,this._matProj,this._matView),Xn.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv))}},e.setViewportInOrientedSpace=function(t){var e,n=t.x,i=t.width,r=t.height,a=this._device.capabilities.screenSpaceSignY<0?1-t.y-r:t.y,o=null===(e=this.window)||void 0===e?void 0:e.swapchain;switch(o&&o.surfaceTransform||_i.IDENTITY){case _i.ROTATE_90:this._viewport.x=1-a-r,this._viewport.y=n,this._viewport.width=r,this._viewport.height=i;break;case _i.ROTATE_180:this._viewport.x=1-n-i,this._viewport.y=1-a-r,this._viewport.width=i,this._viewport.height=r;break;case _i.ROTATE_270:this._viewport.x=a,this._viewport.y=1-n-i,this._viewport.width=r,this._viewport.height=i;break;case _i.IDENTITY:this._viewport.x=n,this._viewport.y=a,this._viewport.width=i,this._viewport.height=r}this._orientedViewport.x=n,this._orientedViewport.y=a,this._orientedViewport.width=i,this._orientedViewport.height=r,this.resize(this.width,this.height)},e.changeTargetWindow=function(t){void 0===t&&(t=null),this._window&&this._window.detachCamera(this);var e=t||l.director.root.mainWindow;if(e){e.attachCamera(this),this.window=e;var n=e.swapchain;(n&&n.surfaceTransform||_i.IDENTITY)%2?this.resize(e.height,e.width):this.resize(e.width,e.height)}},e.detachCamera=function(){this._window&&this._window.detachCamera(this)},e.screenPointToRay=function(t,e,n){if(!this._node)return null;var i=this.width,r=this.height,a=this._orientedViewport.x*i,o=this._orientedViewport.y*r,s=this._orientedViewport.width*i,c=this._orientedViewport.height*r,l=this._proj===Yg.PERSPECTIVE,u=this._device.capabilities.clipSpaceSignY,h=jn[this._curTransform];Dn.set(iv,(e-a)/s*2-1,(n-o)/c*2-1,l?1:-1);var f=iv.x,_=iv.y;return iv.x=f*h[0]+_*h[2]*u,iv.y=f*h[1]+_*h[3]*u,Dn.transformMat4(l?iv:t.o,iv,this._matViewProjInv),l?(this._node.getWorldPosition(rv),no.fromPoints(t,rv,iv)):Dn.transformQuat(t.d,Dn.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var n=this.width,i=this.height,r=this._orientedViewport.x*n,a=this._orientedViewport.y*i,o=this._orientedViewport.width*n,s=this._orientedViewport.height*i,c=this._device.capabilities.clipSpaceSignY,l=jn[this._curTransform];if(this._proj===Yg.PERSPECTIVE){Dn.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,1);var u=t.x,h=t.y;t.x=u*l[0]+h*l[2]*c,t.y=u*l[1]+h*l[3]*c,Dn.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(iv),Dn.lerp(t,iv,t,fn(this._nearClip/this._farClip,1,e.z))}else{Dn.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,2*e.z-1);var f=t.x,_=t.y;t.x=f*l[0]+_*l[2]*c,t.y=f*l[1]+_*l[3]*c,Dn.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var n=this._device.capabilities.clipSpaceSignY,i=jn[this._curTransform];Dn.transformMat4(t,e,this._matViewProj);var r=t.x,a=t.y;t.x=r*i[0]+a*i[2]*n,t.y=r*i[1]+a*i[3]*n;var o=this.width,s=this.height,c=this._orientedViewport.x*o,l=this._orientedViewport.y*s,u=this._orientedViewport.width*o,h=this._orientedViewport.height*s;return t.x=c+.5*(t.x+1)*u,t.y=l+.5*(t.y+1)*h,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,n,i){Xn.multiply(t,this._matViewProj,e),Xn.multiply(t,sv[this._curTransform],t);var r=n/2,a=i/2;return Xn.identity(av),Xn.transform(av,av,Dn.set(iv,r,a,0)),Xn.scale(av,av,Dn.set(iv,r,a,1)),Xn.multiply(t,av,t),t},e.setExposure=function(t){this._exposure=.833333/Math.pow(2,t)},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(t)},Q(t,[{key:"name",get:function(){return this._name}},{key:"scene",get:function(){return this._scene}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"window",get:function(){return this._window},set:function(t){this._window=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"forward",get:function(){return this._forward},set:function(t){this._forward=t}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._apertureValue=tv[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._shutterValue=ev[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._isoValue=nv[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"exposure",get:function(){return this._exposure}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t}},{key:"clearColor",get:function(){return this._clearColor},set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w}},{key:"clearDepth",get:function(){return this._clearDepth},set:function(t){this._clearDepth=t}},{key:"clearStencil",get:function(){return this._clearStencil},set:function(t){this._clearStencil=t}},{key:"projectionType",get:function(){return this._proj},set:function(t){this._proj=t,this._isProjDirty=!0}},{key:"aspect",get:function(){return this._aspect}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){this._fovAxis=t,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(t){this._farClip=t,this._isProjDirty=!0}},{key:"viewport",get:function(){return this._viewport},set:function(t){R(8302),this.setViewportInOrientedSpace(t)}},{key:"frustum",get:function(){return this._frustum},set:function(t){this._frustum=t}},{key:"matView",get:function(){return this._matView}},{key:"matProj",get:function(){return this._matProj}},{key:"matProjInv",get:function(){return this._matProjInv}},{key:"matViewProj",get:function(){return this._matViewProj}},{key:"matViewProjInv",get:function(){return this._matViewProjInv}},{key:"native",get:function(){return this._nativeObj}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}(),lv=oe({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),uv=oe({Planar:0,ShadowMap:1}),hv=oe({HARD:0,SOFT:1,SOFT_2X:2}),fv=uv.ShadowMap+1,_v=function(){function t(){this.fixedSphere=new lo(0,0,0,.01),this.maxReceived=4,this.firstSetCSM=!1,this.shadowCameraFar=0,this.matShadowView=new Xn,this.matShadowProj=new Xn,this.matShadowViewProj=new Xn,this._enabled=!1,this._type=fv,this._distance=0,this._normal=new Dn(0,1,0),this._shadowColor=new Pn(0,0,0,76),this._size=new Qn(512,512),this._shadowMapDirty=!1,this._matLight=new Xn,this._material=null,this._instancingMaterial=null}var e=t.prototype;return e.getPlanarShader=function(t){return this._material||(this._material=new $g,this._material.initialize({effectName:"planar-shadow"})),this._material.passes[0].getShaderVariant(t)},e.getPlanarInstanceShader=function(t){return this._instancingMaterial||(this._instancingMaterial=new $g,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}})),this._instancingMaterial.passes[0].getShaderVariant(t)},e._setEnable=function(t){this._enabled=t},e._setType=function(t){this._type=this.enabled?t:fv},e.initialize=function(t){this._setEnable(t.enabled),this._setType(t.type),this.normal=t.planeDirection,this.distance=t.planeHeight,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,this.size=t.size},e.activate=function(){this.enabled&&this.type===uv.Planar&&this._updatePlanarInfo()},e._updatePlanarInfo=function(){this._material||(this._material=new $g,this._material.initialize({effectName:"planar-shadow"})),this._instancingMaterial||(this._instancingMaterial=new $g,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}))},e._destroy=function(){},e.destroy=function(){this._destroy(),this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){Dn.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"native",get:function(){return this._nativeObj}}]),t}();_v.MAX_FAR=2e3,_v.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),l.Shadows=_v;var dv=new Dn,pv=(new Dn,new Dn,new Dn),mv=new Xn,gv=new Ys,vv=new Ys,yv=!1,Sv=lo.create(0,0,0,1),Tv=new lo,xv=new oc;xv.accurate=!0;var Ev=new oc;Ev.accurate=!0;var Av=new oc,Cv=new Xn,bv=new Xn,wv=new Xn,Iv=new Xn,Pv=new Xn,Rv=new Xn,Dv=new Xn,Ov=new Dn,Nv=new Qn,Mv=new Dn,Lv=new Dn,Fv=new Dn(0,0,0),Bv=(new Ys,new Hl((function(){return{model:null,depth:0}}),128)),zv=new Hl((function(){return{model:null,depth:0}}),128),Uv=new Hl((function(){return{model:null,depth:0}}),128);function kv(t,e){var n=0;t.node&&(Dn.subtract(dv,t.node.worldPosition,e.position),n=Dn.dot(dv,e.forward));var i=Bv.alloc();return i.model=t,i.depth=n,i}function Gv(t,e){var n=0;t.node&&(Dn.subtract(dv,t.node.worldPosition,e.position),n=Dn.dot(dv,e.forward));var i=zv.alloc();return i.model=t,i.depth=n,i}function Vv(t,e){var n=0;t.node&&(Dn.subtract(dv,t.node.worldPosition,e.position),n=Dn.dot(dv,e.forward));var i=Uv.alloc();return i.model=t,i.depth=n,i}function Hv(t,e,n){var i=e.direction,r=t.normal,a=t.distance+.001,o=1/Dn.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,u=r.x,h=r.y,f=r.z,_=t.matLight;_.m00=1-u*s,_.m01=-u*c,_.m02=-u*l,_.m03=0,_.m04=-h*s,_.m05=1-h*c,_.m06=-h*l,_.m07=0,_.m08=-f*s,_.m09=-f*c,_.m10=1-f*l,_.m11=0,_.m12=s*a,_.m13=c*a,_.m14=l*a,_.m15=1,Xn.toArray(n,_,Wd.MAT_LIGHT_PLANE_PROJ_OFFSET)}function Wv(t,e){Dn.normalize(dv,t.normal),e[Wd.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+0]=dv.x,e[Wd.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+1]=dv.y,e[Wd.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+2]=dv.z,e[Wd.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+3]=t.distance}function jv(t,e){var n=t.pipelineSceneData.validPunctualLights;n.length=0;for(var i=e.scene.spotLights,r=0;r<i.length;r++){var a=i[r];a.baked||(lo.set(Sv,a.position.x,a.position.y,a.position.z,a.range),ds.sphereFrustum(Sv,e.frustum)&&n.push(a))}for(var o=e.scene.sphereLights,s=0;s<o.length;s++){var c=o[s];c.baked||(lo.set(Sv,c.position.x,c.position.y,c.position.z,c.range),ds.sphereFrustum(Sv,e.frustum)&&n.push(c))}}function Xv(t,e){var n=e.scene,i=n.mainLight,r=t.pipelineSceneData,a=r.shadows,o=r.skybox,s=r.renderObjects;Bv.freeArray(s),s.length=0;var c=r.castShadowObjects;Uv.freeArray(c),c.length=0,yv=!1;var l=null;if(a.enabled&&(t.pipelineUBO.updateShadowUBORange(Wd.SHADOW_COLOR_OFFSET,a.shadowColor),a.type===uv.ShadowMap))if(l=t.pipelineSceneData.dirShadowObjects,zv.freeArray(l),l.length=0,i&&i.node)!function(t,e,n,i,r){var a=e.device;if(n.shadowFixedArea){var o=n.shadowOrthoSize,s=n.shadowOrthoSize,c=n.shadowNear,l=n.shadowFar;Xn.fromRT(Cv,n.node.getWorldRotation(),n.node.getWorldPosition()),Xn.invert(bv,Cv),Xn.ortho(Iv,-o,o,-s,s,c,l,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),Xn.multiply(Pv,Iv,bv),Xn.invert(wv,bv),r.matShadowView=bv,r.matShadowProj=Iv,r.matShadowViewProj=Pv,oc.createOrtho(t,2*o,2*s,c,l,wv)}else{var u=n.shadowInvisibleOcclusionRange,h=r.size.x;!function(t,e){if(e.node){var n=e.node,i=n.getWorldPosition(),r=n.getWorldRotation();Xn.fromRT(t,r,i),t.m08*=-1,t.m09*=-1,t.m10*=-1}}(mv,i),oc.split(xv,i,mv,.1,n.shadowDistance),Ev=oc.clone(xv),Xn.fromRT(Cv,n.node.rotation,Fv),Xn.invert(bv,Cv),Xn.invert(wv,bv);var f=bv.clone();Ev.transform(bv),Ys.fromPoints(gv,new Dn(1e7,1e7,1e7),new Dn(-1e7,-1e7,-1e7)),gv.mergeFrustum(Ev);var _=2*gv.halfExtents.z;pv.set(gv.center.x,gv.center.y,gv.center.z+gv.halfExtents.z+u),Dn.transformMat4(pv,pv,wv),Xn.fromRT(Cv,n.node.rotation,pv),Xn.invert(bv,Cv),Xn.invert(wv,bv);var d=Dn.distance(xv.vertices[0],xv.vertices[6]);Tv.center.set(0,0,0),Tv.radius=-1,Tv.mergePoints(xv.vertices);var p=.8*d+.4*Tv.radius;r.shadowCameraFar=_+u;var m=.5*p;if(Xn.ortho(Iv,-m,m,-m,m,.1,r.shadowCameraFar,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),h>0){Xn.multiply(Rv,Iv,f),Dn.transformMat4(Ov,pv,Rv);var g=2/h;Nv.set(g,g);var v=Ov.x%Nv.x,y=Ov.y%Nv.y;Mv.set(Ov.x-v,Ov.y-y,Ov.z),Xn.invert(Dv,Rv),Dn.transformMat4(Lv,Mv,Dv),Xn.fromRT(Cv,n.node.rotation,Lv),Xn.invert(bv,Cv),Xn.invert(wv,bv),oc.createOrtho(t,p,p,.1,r.shadowCameraFar,wv)}else{for(var S=0;S<8;S++)t.vertices[S].set(0,0,0);t.updatePlanes()}Xn.multiply(Pv,Iv,bv),r.matShadowView=bv,r.matShadowProj=Iv,r.matShadowViewProj=Pv}}(Av,t,i,e,a);else{for(var u=0;u<8;u++)Av.vertices[u].set(0,0,0);Av.updatePlanes()}i&&a.type===uv.Planar&&function(t,e){var n=t.pipelineSceneData.shadows,i=e.direction,r=n.normal,a=n.distance+.001,o=1/Dn.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,u=r.x,h=r.y,f=r.z,_=n.matLight;_.m00=1-u*s,_.m01=-u*c,_.m02=-u*l,_.m03=0,_.m04=-h*s,_.m05=1-h*c,_.m06=-h*l,_.m07=0,_.m08=-f*s,_.m09=-f*c,_.m10=1-f*l,_.m11=0,_.m12=s*a,_.m13=c*a,_.m14=l*a,_.m15=1,t.pipelineUBO.updateShadowUBORange(Wd.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(t,i),o.enabled&&o.model&&e.clearFlag&ov&&s.push(kv(o.model,e));for(var h=n.models,f=e.visibility,_=0;_<h.length;_++){var d=h[_];if(d.enabled&&(d.castShadow&&c.push(Vv(d,e)),a.firstSetCSM&&d.worldBounds&&(yv||(vv.copy(d.worldBounds),yv=!0),Ys.merge(vv,vv,d.worldBounds)),d.node&&(f&d.node.layer)===d.node.layer||f&d.visFlags)){if(null!=l&&d.castShadow&&d.worldBounds&&ds.aabbFrustum(d.worldBounds,Av)&&l.push(Gv(d,e)),d.worldBounds&&!ds.aabbFrustum(d.worldBounds,e.frustum))continue;s.push(kv(d,e))}}}var qv,Yv=new xr(Ii.LINEAR,Ii.LINEAR,Ii.NONE,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP),Kv=new xr(Ii.POINT,Ii.POINT,Ii.NONE,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP),Qv=function(){function t(t){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=t.device,this._linearSampler=this._device.getSampler(Yv),this._pointSampler=this._device.getSampler(Kv);var e=new Wr(Od.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._globalDescriptorSet=this._device.createDescriptorSet(new jr(this._descriptorSetLayout))}var e=t.prototype;return e.bindBuffer=function(t,e){this._globalDescriptorSet.bindBuffer(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindBuffer(t,e),i=n.next()},e.bindSampler=function(t,e){this._globalDescriptorSet.bindSampler(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindSampler(t,e),i=n.next()},e.bindTexture=function(t,e){this._globalDescriptorSet.bindTexture(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindTexture(t,e),i=n.next()},e.update=function(){this._globalDescriptorSet.update();for(var t=this._descriptorSetMap.values(),e=t.next();!e.done;)e.value.update(),e=t.next()},e.getOrCreateDescriptorSet=function(t){var e=this._device;if(!this._descriptorSetMap.has(t)){var n=this._globalDescriptorSet,i=e.createDescriptorSet(new jr(this._descriptorSetLayout));this._descriptorSetMap.set(t,i);for(var r=Dd.UBO_GLOBAL;r<Dd.COUNT;r++)i.bindBuffer(r,n.getBuffer(r)),i.bindSampler(r,n.getSampler(r)),i.bindTexture(r,n.getTexture(r));var a=e.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,Wd.SIZE,Wd.SIZE));i.bindBuffer(Wd.BINDING,a),i.update()}return this._descriptorSetMap.get(t)},e.destroy=function(){this._descriptorSetLayout.destroy()},Q(t,[{key:"descriptorSetMap",get:function(){return this._descriptorSetMap}},{key:"linearSampler",get:function(){return this._linearSampler}},{key:"pointSampler",get:function(){return this._pointSampler}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"globalDescriptorSet",get:function(){return this._globalDescriptorSet}}]),t}(),Jv=0,Zv={},$v=new jr(null),ty=function(){function t(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=wd.DEFAULT,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._planarInstanceShader=null,this._planarShader=null,this._reflectionTex=null,this._reflectionSampler=null}var e=t.prototype;return e._destroyDescriptorSet=function(){this._descriptorSet.destroy(),this._descriptorSet=null},e._destroyWorldBoundDescriptorSet=function(){this._worldBoundDescriptorSet.destroy(),this._worldBoundDescriptorSet=null},e._destroyInputAssembler=function(){this._inputAssembler.destroy(),this._inputAssembler=null},e._createDescriptorSet=function(t){this._descriptorSet=this._device.createDescriptorSet(t)},e._createWorldBoundDescriptorSet=function(t){this._worldBoundDescriptorSet=this._device.createDescriptorSet(t)},e._setInputAssembler=function(t){this._inputAssembler=this._device.createInputAssembler(t)},e._setSubMesh=function(t){this._subMesh=t},e._init=function(){},e.initialize=function(t,e,n){void 0===n&&(n=null);var i=l.director.root;this._device=i.device,$v.layout=e[0].localSetLayout,this._init(),this._setInputAssembler(t.iaInfo),this._createDescriptorSet($v);var r=l.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass(),a=new jr(null);if(a.layout=r.localSetLayout,this._createWorldBoundDescriptorSet(a),this._setSubMesh(t),this._patches=n,this._passes=e,this._flushPassInfo(),e[0].batchingScheme===yg.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this.priority=wd.DEFAULT,e[0].phase===Ag("reflection")){var o=i.mainWindow.width,s=i.mainWindow.height,c=512;s<o?(o=c*o/s,s=c):s=c*s/(o=c),this._reflectionTex=this._device.createTexture(new Sr(xi.TEX2D,Ei.STORAGE|Ei.TRANSFER_SRC|Ei.SAMPLED,pi.RGBA8,o,s)),this.descriptorSet.bindTexture(Np,this._reflectionTex),this._reflectionSampler=this._device.getSampler(new xr(Ii.LINEAR,Ii.LINEAR,Ii.NONE,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP)),this.descriptorSet.bindSampler(Np,this._reflectionSampler),this.descriptorSet.bindTexture(Fp,this._reflectionTex)}},e._initNativePlanarShadowShader=function(t){this._planarShader=t.getPlanarShader(this._patches)},e.initPlanarShadowShader=function(){var t=l.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowShader(t)},e._initNativePlanarShadowInstanceShader=function(t){this._planarInstanceShader=t.getPlanarInstanceShader(this._patches)},e.initPlanarShadowInstanceShader=function(){var t=l.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowInstanceShader(t)},e._destroy=function(){},e.destroy=function(){this._destroyDescriptorSet(),this._destroyWorldBoundDescriptorSet(),this._destroyInputAssembler(),this.priority=wd.DEFAULT,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null,this._reflectionTex&&this._reflectionTex.destroy(),this._reflectionTex=null,this._reflectionSampler=null,this._destroy()},e.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update(),this._worldBoundDescriptorSet.update()},e.onPipelineStateChanged=function(){var t=this._passes;if(t){for(var e=0;e<t.length;e++){var n=t[e];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},e.onMacroPatchesStateChanged=function(t){this._patches=t;var e=this._passes;if(e){for(var n=0;n<e.length;n++){var i=e[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},e._flushPassInfo=function(){var t=this._passes;if(t){this._shaders||(this._shaders=[]),this._shaders.length=t.length;for(var e=0,n=t.length;e<n;e++)this._shaders[e]=t[e].getShaderVariant(this.patches)}},Q(t,[{key:"passes",get:function(){return this._passes},set:function(t){t.length>8?O(12004,8):(this._passes=t,this._flushPassInfo(),this._passes[0].batchingScheme===yg.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this._descriptorSet&&(this._destroyDescriptorSet(),$v.layout=t[0].localSetLayout,this._createDescriptorSet($v)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(t){this._inputAssembler.destroy(),this._inputAssembler.initialize(t.iaInfo),this._passes[0].batchingScheme===yg.VB_MERGING&&this.subMesh.genFlatBuffers(),this._setSubMesh(t)}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarInstanceShader",get:function(){return this._planarInstanceShader}},{key:"planarShader",get:function(){return this._planarShader}},{key:"native",get:function(){return this._nativeObj}}]),t}(),ey=new Xn,ny=[{name:"CC_RECEIVE_SHADOW",value:!0}],iy=[{name:"CC_USE_LIGHTMAP",value:!0}];!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.BATCH_2D=3]="BATCH_2D",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(qv||(qv={}));var ry=new xr(Ii.LINEAR,Ii.LINEAR,Ii.NONE,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP),ay=new xr(Ii.LINEAR,Ii.LINEAR,Ii.LINEAR,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP),oy=function(){function t(){this.type=qv.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(ip.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new ti,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._shadowBias=0,this._shadowNormalBias=0,this._enabled=!0,this._visFlags=Cd.Enum.NONE,this._device=l.director.root.device}var e=t.prototype;return e._setReceiveShadow=function(t){this._receiveShadow=t},e._init=function(){},e.initialize=function(){this._inited||(this._init(),this._setReceiveShadow(!0),this.castShadow=!1,this.enabled=!0,this.visFlags=Cd.Enum.NONE,this._inited=!0)},e._destroySubmodel=function(t){t.destroy()},e._destroy=function(){},e.destroy=function(){for(var t=this._subModels,e=0;e<t.length;e++){var n=this._subModels[e];this._destroySubmodel(n)}this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._destroy()},e.attachToScene=function(t){this.scene=t,this._localDataUpdated=!0},e.detachFromScene=function(){this.scene=null},e.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e._applyLocalData=function(){},e._applyLocalBuffer=function(){},e._applyWorldBoundBuffer=function(){},e.updateUBOs=function(t){for(var e=this._subModels,n=0;n<e.length;n++)e[n].update();if(this._updateStamp=t,this._localDataUpdated){this._localDataUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var a=this.instancedAttributes.views;!function(t,e,n,i){e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,n[0]=t.m04,n[1]=t.m05,n[2]=t.m06,n[3]=t.m13,i[0]=t.m08,i[1]=t.m09,i[2]=t.m10,i[3]=t.m14}(i,a[r],a[r+1],a[r+2])}else if(this._localBuffer){Xn.toArray(this._localData,i,ip.MAT_WORLD_OFFSET),Xn.inverseTranspose(ey,i);var o=Math.abs(Xn.determinant(ey)),s=1/Math.sqrt(o);Xn.multiplyScalar(ey,ey,s),Xn.toArray(this._localData,ey,ip.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._applyLocalData(),this._applyLocalBuffer()}}},e._updateNativeBounds=function(){},e.createBoundingShape=function(t,e){t&&e&&(this._modelBounds=Ys.fromPoints(Ys.create(),t,e),this._worldBounds=Ys.clone(this._modelBounds),this._updateNativeBounds())},e._createSubModel=function(){return new ty},e.initSubModel=function(t,e,n){this.initialize(),null==this._subModels[t]?this._subModels[t]=this._createSubModel():this._subModels[t].destroy(),this._subModels[t].initialize(e,n.passes,this.getMacroPatches(t)),this._subModels[t].initPlanarShadowShader(),this._subModels[t].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(t)},e.setSubModelMesh=function(t,e){this._subModels[t]&&(this._subModels[t].subMesh=e)},e.setSubModelMaterial=function(t,e){this._subModels[t]&&(this._subModels[t].passes=e.passes,this._updateAttributesAndBinding(t))},e.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onPipelineStateChanged()},e.onMacroPatchesStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onMacroPatchesStateChanged(this.getMacroPatches(e))},e.updateLightingmap=function(t,e){ti.toArray(this._localData,e,ip.LIGHTINGMAP_UVPARAM),this._localDataUpdated=!0,this._lightmap=t,this._lightmapUVParam=e,this.onMacroPatchesStateChanged(),null===t&&(t=Eg.get("empty-texture"));var n=t.getGFXTexture();if(n)for(var i=this._device.getSampler(t.mipmaps.length>1?ay:ry),r=this._subModels,a=0;a<r.length;a++){var o=r[a].descriptorSet;o.bindTexture(wp,n),o.bindSampler(wp,i),o.update()}},e.updateLocalShadowBias=function(){var t=this._localData;t[ip.LOCAL_SHADOW_BIAS+0]=this._shadowBias,t[ip.LOCAL_SHADOW_BIAS+1]=this._shadowNormalBias,t[ip.LOCAL_SHADOW_BIAS+2]=0,t[ip.LOCAL_SHADOW_BIAS+3]=0,this._localDataUpdated=!0},e.getMacroPatches=function(){var t=this.receiveShadow?ny:null;return null!=this._lightmap&&(t=t?t.concat(iy):iy),t},e._updateAttributesAndBinding=function(t){var e=this._subModels[t];if(e){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,e.descriptorSet),this._initWorldBoundDescriptors(t),this._updateWorldBoundDescriptors(t,e.worldBoundDescriptorSet);var n=e.passes[0].getShaderVariant(e.patches);this._updateInstancedAttributes(n.attributes,e.passes[0])}},e._getInstancedAttributeIndex=function(t){for(var e=this.instancedAttributes.attributes,n=0;n<e.length;n++)if(e[n].name===t)return n;return-1},e._setInstMatWorldIdx=function(t){this._instMatWorldIdx=t},e._updateInstancedAttributes=function(t,e){if(e.device.hasFeature(di.INSTANCED_ARRAYS)){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.isInstanced&&(n+=na[r.format].size)}var a=this.instancedAttributes;a.buffer=new Uint8Array(n),a.views.length=a.attributes.length=0;for(var o=0,s=0;s<t.length;s++){var c=t[s];if(c.isInstanced){var l=new Or;l.format=c.format,l.name=c.name,l.isNormalized=c.isNormalized,l.location=c.location,a.attributes.push(l);var u=na[c.format],h=new(ha(u))(a.buffer.buffer,o,u.count);a.views.push(h),o+=u.size}}e.batchingScheme===yg.INSTANCING&&e.getInstancedBuffer().destroy(),this._setInstMatWorldIdx(this._getInstancedAttributeIndex(ap)),this._localDataUpdated=!0}},e._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE,ip.SIZE,ip.SIZE)),this._applyLocalBuffer())},e._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE,rp.SIZE,rp.SIZE)),this._applyWorldBoundBuffer())},e._updateLocalDescriptors=function(t,e){this._localBuffer&&e.bindBuffer(ip.BINDING,this._localBuffer)},e._updateWorldBoundDescriptors=function(t,e){this._worldBoundBuffer&&e.bindBuffer(rp.BINDING,this._worldBoundBuffer)},Q(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._setReceiveShadow(t),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"native",get:function(){return this._nativeObj}}]),t}(),sy=function(){function t(){this._groundAlbedoHDR=new ti(.2,.2,.2,1),this._skyColorHDR=new ti(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new ti(.2,.2,.2,1),this._skyColorLDR=new ti(.2,.5,.8,1),this._skyIllumLDR=0,this._enabled=!1}var e=t.prototype;return e.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}},{key:"native",get:function(){return this._nativeObj}}]),t}();sy.SUN_ILLUM=65e3,sy.SKY_ILLUM=2e4,l.Ambient=sy;var cy=function(t){function e(e,n){var i;(i=t.call(this,e.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=e,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var a=i._shaderInfo.blocks[r],o=i._blocks[a.binding],s=i._parent.blocks[a.binding];o.set(s)}i._setRootBufferDirty(!0);for(var c=i._parent,l=0;l<i._shaderInfo.samplerTextures.length;l++)for(var u=i._shaderInfo.samplerTextures[l],h=0;h<u.count;h++){var f=c._descriptorSet.getSampler(u.binding,h),_=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,f,h),i._descriptorSet.bindTexture(u.binding,_,h)}return t.prototype.tryCompile.call(rt(i)),i}Z(e,t);var n=e.prototype;return n.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),Rg.fillPipelineInfo(this,t),Rg.fillPipelineInfo(this,e),this._onStateChange()},n.tryCompile=function(e){if(e&&!rm(this._defines,e))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this._setBatchingScheme(yg.NONE)},n._onStateChange=function(){this._setHash(Rg.getPassHash(this)),this._owner.onPassStateChange(this._dontNotify)},Q(e,[{key:"parent",get:function(){return this._parent}}]),e}(Rg),ly=function(t){function e(e){var n;return(n=t.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=e.parent,n._owner=e.owner||null,n._subModelIdx=e.subModelIdx||0,n.copy(n._parent),n}Z(e,t);var n=e.prototype;return n.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var n,i=ot(this._passes);!(n=i()).done;)n.value.tryCompile(t);else this._passes[e].tryCompile(t)},n.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],a=this._states[i]||(this._states[i]={});for(var o in t)a[o]=t[o];r.overridePipelineStates(n[r.passIndex],a)}else{var s=this._states[e]||(this._states[e]={});for(var c in t)s[c]=t[c];this._passes[e].overridePipelineStates(n[e],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(t){this._hash=$g.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var n=0;n<e.length;++n)t.push(new cy(e[n],this));return t},Q(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}($g),uy=null,hy=null,fy=oe({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2}),_y=function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1}var e=t.prototype;return e._setEnabled=function(t){this._enabled=t},e._setUseIBL=function(t){this._useIBL=t},e._setUseHDR=function(t){this._useHDR=t},e._setUseDiffuseMap=function(t){this._useDiffuseMap=t},e.initialize=function(t){this._setEnabled(t.enabled),this._setUseIBL(t.useIBL),this._setUseDiffuseMap(t.applyDiffuseMap),this._setUseHDR(t.useHDR)},e.setEnvMaps=function(t,e){this._envmapHDR=t,this._envmapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setDiffuseMaps=function(t,e){this._diffuseMapHDR=t,this._diffuseMapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.activate=function(){var t=l.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=Eg.get("default-cube-texture"),this._model||(this._model=l.director.root.createModel(l.renderer.scene.Model),this._model._initLocalDescriptors=function(){},this._model._initWorldBoundDescriptors=function(){});var e=this._default.isRGBE;if(this.envmap&&(e=this.envmap.isRGBE),!hy){var n=new $g;n.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:e}}),hy=new ly({parent:n})}this.enabled&&(uy||(uy=l.utils.createMesh(l.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,uy.renderingSubMeshes[0],hy)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline()},e._updatePipeline=function(){var t=l.director.root,e=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,i=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,r=this.useHDR;e.macros.CC_USE_IBL===n&&e.macros.CC_USE_DIFFUSEMAP===i&&e.macros.CC_USE_HDR===r||(e.macros.CC_USE_IBL=n,e.macros.CC_USE_DIFFUSEMAP=i,e.macros.CC_USE_HDR=r,t.onGlobalPipelineStateChanged()),this.enabled&&hy&&hy.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE}),this._model&&this._model.setSubModelMaterial(0,hy)},e._updateGlobalBinding=function(){if(this._globalDSManager){var t=l.director.root.device,e=this.envmap?this.envmap:this._default;if(e){var n=e.getGFXTexture(),i=t.getSampler(e.getSamplerInfo());this._globalDSManager.bindSampler(Yd,i),this._globalDSManager.bindTexture(Yd,n)}var r=this.diffuseMap?this.diffuseMap:this._default;if(r){var a=r.getGFXTexture(),o=t.getSampler(r.getSamplerInfo());this._globalDSManager.bindSampler(Jd,o),this._globalDSManager.bindTexture(Jd,a)}this._globalDSManager.update()}},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnabled(t),t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._setUseHDR(t),this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._setUseIBL(t),this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"envmap",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"native",get:function(){return this._nativeObj}}]),t}();l.Skybox=_y;var dy=new ti,py=oe({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),my=py.LAYERED+1,gy=function(){function t(){this._fogColor=new Pn("#C8C8C8"),this._colorArray=new ti(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2}var e=t.prototype;return e._setType=function(t){this._type=this.enabled?t:my},e._setEnable=function(t){this._enabled=t},e._setAccurate=function(t){this._accurate=t},e.initialize=function(t){this.fogColor=t.fogColor,this._setEnable(t.enabled),this._setAccurate(t.accurate),this._setType(t.type),this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},e.activate=function(){this._updatePipeline()},e._updatePipeline=function(){var t=l.director.root,e=this.enabled?this.type:my,n=this.accurate?1:0,i=t.pipeline;i.macros.CC_USE_FOG===e&&i.macros.CC_USE_ACCURATE_FOG===n||(i.macros.CC_USE_FOG=e,i.macros.CC_USE_ACCURATE_FOG=n,t.onGlobalPipelineStateChanged())},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),t?this.activate():(this._type=my,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._setAccurate(t),this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),dy.set(t.x,t.y,t.z,t.w),Mg(this._colorArray,dy)}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}},{key:"native",get:function(){return this._nativeObj}}]),t}();l.Fog=gy;var vy,yy,Sy,Ty=function(){function t(){this._enabled=!1,this._minPos=new Dn(0,0,0),this._maxPos=new Dn(0,0,0),this._depth=0}var e=t.prototype;return e.initialize=function(t){this._enabled=t.enabled,this._minPos=t.minPos,this._maxPos=t.maxPos,this._depth=t.depth},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t}},{key:"native",get:function(){return this._nativeObj}}]),t}();function xy(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);var n=e*e,i=(.860117757+.000154118254*e+1.28641212e-7*n)/(1+.000842420235*e+7.08145163e-7*n),r=(.317398726+422806245e-13*e+4.20481691e-8*n)/(1-289741816e-13*e+1.61456053e-7*n),a=2*i-8*r+4,o=3*i/a,s=2*r/a,c=1/s*o,l=1/s*(1-o-s);t.x=3.2404542*c-1.5371385+-.4985314*l,t.y=-.969266*c+1.8760108+.041556*l,t.z=.0556434*c-.2040259+1.0572252*l}!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(vy||(vy={})),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(yy||(yy={})),l.internal.TransformBit=yy,function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.UNKNOWN=3]="UNKNOWN"}(Sy||(Sy={}));var Ey,Ay,Cy=function(t){return 4*Math.PI*Math.PI*t*t},by=function(){function t(){this._baked=!1,this._color=new Dn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Dn(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=Sy.UNKNOWN}var e=t.prototype;return e._init=function(){},e._destroy=function(){},e.initialize=function(){this._init(),this.color=new Dn(1,1,1),this.colorTemperature=6550},e.attachToScene=function(t){this._scene=t},e.detachFromScene=function(){this._scene=null},e.destroy=function(){this._name=null,this._node=null,this._destroy()},e.update=function(){},Q(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",get:function(){return this._color},set:function(t){this._color.set(t)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(t){this._colorTemp=t,xy(this._colorTempRGB,this._colorTemp)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=yy.ROTATION)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}},{key:"native",get:function(){return this._nativeObj}}]),t}(),wy=new Dn(0,0,-1),Iy=new Dn,Py=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Dn(1,-1,-1),e._illuminanceHDR=sy.SUN_ILLUM,e._illuminanceLDR=1,e._shadowEnabled=!1,e._shadowPcf=hv.HARD,e._shadowBias=1e-5,e._shadowNormalBias=0,e._shadowSaturation=1,e._shadowDistance=100,e._shadowInvisibleOcclusionRange=200,e._shadowFixedArea=!1,e._shadowNear=.1,e._shadowFar=10,e._shadowOrthoSize=5,e._type=Sy.DIRECTIONAL,e}Z(e,t);var n=e.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=sy.SUN_ILLUM,this.direction=new Dn(1,-1,-1)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Dn.transformQuat(Iy,wy,this._node.worldRotation))},Q(e,[{key:"direction",get:function(){return this._dir},set:function(t){Dn.normalize(this._dir,t)}},{key:"illuminance",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(t){this._illuminanceHDR=t}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(t){this._illuminanceLDR=t}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=t}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,_v.MAX_FAR)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,_v.MAX_FAR)}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,_v.MAX_FAR)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t}}]),e}(by),Ry=function(t){Z(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._needUpdate=!1,e._size=.15,e._range=1,e._luminanceHDR=0,e._luminanceLDR=0,e._pos=void 0,e._aabb=void 0,e._aabb=Ys.create(),e._pos=new Dn,e._type=Sy.SPHERE,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminanceHDR=1700/Cy(.15),this.luminanceLDR=1},e.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=this._range;Ys.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1}},Q(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",set:function(t){this._luminanceLDR=t}},{key:"aabb",get:function(){return this._aabb}}]),n}(by),Dy=new Dn(0,0,-1),Oy=new zn,Ny=new Xn,My=new Xn,Ly=new Xn,Fy=new Xn,By=function(t){Z(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._dir=new Dn(1,-1,-1),e._range=5,e._spotAngle=Math.cos(Math.PI/6),e._pos=void 0,e._aabb=void 0,e._frustum=void 0,e._angle=0,e._needUpdate=!1,e._size=.15,e._luminanceHDR=0,e._luminanceLDR=0,e._shadowEnabled=!1,e._shadowPcf=hv.HARD,e._shadowBias=1e-5,e._shadowNormalBias=0,e._aabb=Ys.create(),e._frustum=oc.create(),e._pos=new Dn,e._type=Sy.SPOT,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e._setDirection=function(t){this._dir.set(t)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.luminanceHDR=1700/Cy(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._setDirection(new Dn(1,-1,-1))},e.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Dn.transformQuat(this._dir,Dy,this._node.getWorldRotation(Oy)),Dn.normalize(this._dir,this._dir),Ys.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(Ny),Xn.invert(Ny,Ny),Xn.perspective(My,this._angle,1,.001,this._range),Xn.multiply(Ly,My,Ny),this._frustum.update(Ly,Fy),this._needUpdate=!1)},Q(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(t){this._luminanceLDR=t}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._angle=t,this._spotAngle=Math.cos(.5*t),this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}}]),n}(by),zy=function(){function t(t){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._root=t,this._createNativeObject()}t.registerCreateFunc=function(e){e._createSceneFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t){return this._name=t.name,!0},e.activate=function(){},e.update=function(t){var e=this._mainLight;e&&e.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,a=0;a<r.length;a++)r[a].update();for(var o=this._models,s=0;s<o.length;s++){var c=o[s];c.enabled&&(c.updateTransform(t),c.updateUBOs(t))}},e._destroy=function(){},e.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._destroy()},e.addCamera=function(t){t.attachToScene(this),this._cameras.push(t)},e.removeCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return this._cameras.splice(e,1),void t.detachFromScene()},e.removeCameras=function(){for(var t,e=ot(this._cameras);!(t=e()).done;)t.value.detachFromScene();this._cameras.splice(0)},e.setMainLight=function(t){this._mainLight=t},e.unsetMainLight=function(t){if(this._mainLight===t){var e=this._directionalLights;if(e.length)return this.setMainLight(e[e.length-1]),void(this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=yy.ROTATION));this.setMainLight(null)}},e.addDirectionalLight=function(t){t.attachToScene(this),this._directionalLights.push(t)},e.removeDirectionalLight=function(t){for(var e=0;e<this._directionalLights.length;++e)if(this._directionalLights[e]===t)return t.detachFromScene(),void this._directionalLights.splice(e,1)},e.addSphereLight=function(t){t.attachToScene(this),this._sphereLights.push(t)},e.removeSphereLight=function(t){for(var e=0;e<this._sphereLights.length;++e)if(this._sphereLights[e]===t)return t.detachFromScene(),void this._sphereLights.splice(e,1)},e.addSpotLight=function(t){t.attachToScene(this),this._spotLights.push(t)},e.removeSpotLight=function(t){for(var e=0;e<this._spotLights.length;++e)if(this._spotLights[e]===t)return t.detachFromScene(),void this._spotLights.splice(e,1)},e.removeSphereLights=function(){for(var t=0;t<this._sphereLights.length;++t)this._sphereLights[t].detachFromScene();this._sphereLights.length=0},e.removeSpotLights=function(){for(var t=0;t<this._spotLights.length;++t)this._spotLights[t].detachFromScene();this._spotLights=[]},e.addModel=function(t){t.attachToScene(this),this._models.push(t)},e.removeModel=function(t){for(var e=0;e<this._models.length;++e)if(this._models[e]===t)return t.detachFromScene(),void this._models.splice(e,1)},e.removeModels=function(){for(var t,e=ot(this._models);!(t=e()).done;){var n=t.value;n.detachFromScene(),n.destroy()}this._models.length=0},e.addBatch=function(t){this._batches.push(t)},e.removeBatch=function(t){for(var e=0;e<this._batches.length;++e)if(this._batches[e]===t)return void this._batches.splice(e,1)},e.removeBatches=function(){this._batches.length=0},e.onGlobalPipelineStateChanged=function(){for(var t,e=ot(this._models);!(t=e()).done;)t.value.onGlobalPipelineStateChanged()},e.generateModelId=function(){return this._modelId++},e._createNativeObject=function(){},Q(t,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"native",get:function(){return this._nativeObj}},{key:"batches",get:function(){return this._batches}}]),t}(),Uy=Object.freeze({__proto__:null,get CameraFOVAxis(){return qg},get CameraProjection(){return Yg},get CameraAperture(){return Kg},get CameraISO(){return Qg},get CameraShutter(){return Jg},SKYBOX_FLAG:ov,Camera:cv,get ModelType(){return qv},Model:oy,SubModel:ty,Ambient:sy,EnvironmentLightingType:fy,Skybox:_y,ShadowSize:lv,ShadowType:uv,PCFType:hv,Shadows:_v,FogType:py,Fog:gy,Octree:Ty,ColorTemperatureToRGB:xy,get LightType(){return Sy},nt2lm:Cy,Light:by,DirectionalLight:Py,SphereLight:Ry,SpotLight:By,RenderScene:zy});function ky(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function Gy(t,e){return Math.ceil(t/e)*e}!function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(Ey||(Ey={})),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(Ay||(Ay={}));var Vy=function(){function t(t){this._device=void 0,this._format=pi.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new lr,this._region1=new lr,this._region2=new lr,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=na[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=ha(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=Gy(t,this._alignment);var n=-1,i=-1;if(void 0!==e&&(n=e,i=this._findAvailableSpace(t,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(t,n))>=0));++r);if(i>=0){var a=this._chunks[n];a.start+=t;var o={chunkIdx:n,start:i,end:i+t,texture:a.texture};return this._handles.push(o),o}var s=Math.sqrt(t/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,ky(s)),l=this._chunks[this.createChunk(c)];l.start+=t;var u={chunkIdx:this._chunkCount-1,start:0,end:t,texture:l.texture};return this._handles.push(u),u},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;E("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var n={texture:this._device.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED|Ei.TRANSFER_DST,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=n,this._chunkCount++},e.update=function(t,e){var n=[],i=[],r=t.start/this._formatSize,a=e.byteLength/this._formatSize,o=r%t.texture.width,s=Math.floor(r/t.texture.width),c=Math.min(t.texture.width-o,a),l=0;o>0&&(this._region0.texOffset.x=o,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region0),o=0,s+=1,a-=c,l+=c),a>0&&(this._region1.texOffset.x=o,this._region1.texOffset.y=s,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=a,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region1),o=0,s+=this._region1.texExtent.height,a-=c,l+=c),a>0&&(this._region2.texOffset.x=o,this._region2.texOffset.y=s,this._region2.texExtent.width=a,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,a*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,t.texture,i)},e._findAvailableSpace=function(t,e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.size)i=!0;else{r=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),o=0;o<a.length;o++){var s=a[o];if(r+t<=s.start){i=!0;break}r=s.end}!i&&r+t<=n.size&&(i=!0)}return i?r:-1},e._McDonaldAlloc=function(t){t=Gy(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.end?i=!0:r>n.end?r+t<=n.size?i=!0:t<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,t<=n.end&&(i=!0)),i){n.start+=t;var a={chunkIdx:e,start:r,end:r+t,texture:n.texture};return this._handles.push(a),a}}var o=Math.sqrt(t/this._formatSize),s=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,ky(o)),c=this._chunks[this.createChunk(s)];c.start+=t;var l={chunkIdx:this._chunkCount,start:0,end:t,texture:c.texture};return this._handles.push(l),l},t}();k(zy.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),k(zy.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var Hy={};k(Hy,"CameraVisFlags",[{name:"GENERAL"}]),U(Hy,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Cd.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Cd.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Cd.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Cd.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Cd.BitMask,targetName:"UI_2D"}]),l.CameraVisFlags=Hy;var Wy={};k(Wy,"VisibilityFlags",[{name:"GENERAL"}]),U(Wy,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Cd.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Cd.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Cd.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Cd.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Cd.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Cd.Enum,targetName:"UI_2D"}]),l.VisibilityFlags=Wy,U(Rg.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),k(cv.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),k(_v.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),k(By.prototype,"SpotLight.prototype",[{name:"aspect"}]);var jy=function(t){if(void 0===Zv[t]){var e=1<<Jv;Zv[t]=e,Jv+=1}},Xy=Object.freeze({__proto__:null,addStage:jy,scene:Uy,createIA:function(t,e){if(!e.positions)return console.error("The data must have positions field"),null;for(var n=[],i=e.positions.length/3,r=0;r<i;++r)n.push(e.positions[3*r],e.positions[3*r+1],e.positions[3*r+2]),e.normals&&n.push(e.normals[3*r],e.normals[3*r+1],e.normals[3*r+2]),e.uvs&&n.push(e.uvs[2*r],e.uvs[2*r+1]),e.colors&&n.push(e.colors[3*r],e.colors[3*r+1],e.colors[3*r+2]);var a=[];a.push(new Or($i.ATTR_POSITION,pi.RGB32F)),e.normals&&a.push(new Or($i.ATTR_NORMAL,pi.RGB32F)),e.uvs&&a.push(new Or($i.ATTR_TEX_COORD,pi.RG32F)),e.colors&&a.push(new Or($i.ATTR_COLOR,pi.RGB32F));var o=t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,4*n.length,4*n.length/i));o.update(new Float32Array(n));var s=null;return e.indices&&(s=t.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,2*e.indices.length,2))).update(new Uint16Array(e.indices)),t.createInputAssembler(new Mr(a,[o],s))},get RenderQueue(){return Ey},get PassStage(){return Ay},genHandle:Yp,getTypeFromHandle:Kp,getBindingFromHandle:Qp,getCountFromHandle:Jp,getOffsetFromHandle:Zp,customizeType:$p,type2reader:tm,type2writer:em,getDefaultFromType:im,overrideMacros:rm,get BatchingSchemes(){return yg},Pass:Rg,getDeviceShaderVersion:hm,programLib:Sm,nearestPOT:ky,TextureBufferPool:Vy,MaterialInstance:ly,PassInstance:cy,get PoolType(){return Is},NULL_HANDLE:0,get NodeView(){return Ps},NodePool:Ms,get PassView(){return Ds},PassPool:zs,get AABBView(){return Ls},AABBPool:Gs,RenderScene:zy,NativeNode:null,NativeScene:null,NativeAABB:null,NativeModel:null,NativeSkinningModel:null,NativeBakedAnimInfo:null,NativeBakedJointInfo:null,NativeBakedSkinningModel:null,NativeLight:null,NativeDirectionalLight:null,NativeSphereLight:null,NativeSpotLight:null,NaitveSkybox:null,NativeFog:null,NativeRenderWindow:null,NativeCamera:null,NativePass:null,NativeSubModel:null,NativeDrawBatch2D:null,NativeRenderScene:null,NativeOctree:null,NativeAmbient:null,NativeShadow:null,NativeRoot:null,NativeJointTransform:null,NativeJointInfo:null,NativePipelineSharedSceneData:null,NativeGeometryRenderer:null,CameraVisFlags:Hy,VisibilityFlags:Wy});t("renderer",Xy);var qy,Yy=new Dn,Ky=new Dn,Qy=new Dn,Jy=new Dn,Zy=new Dn,$y=new Dn,tS=new Dn,eS=new Dn,nS=new Dn,iS=new Dn;!function(t){t[t.LINE=0]="LINE",t[t.DASHED_LINE=1]="DASHED_LINE",t[t.TRIANGLE=2]="TRIANGLE"}(qy||(qy={}));var rS,aS,oS,sS,cS,lS,uS,hS,fS,_S,dS=function(){function t(){this._maxVertices=0,this._vertexCount=0,this._stride=0}var e=t.prototype;return e.init=function(t,e,n,i){this._maxVertices=e,this._vertexCount=0,this._stride=n,this._vertices=new Float32Array(e*n/Float32Array.BYTES_PER_ELEMENT),this._buffer=t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,e*n,n)),this._inputAssembler=t.createInputAssembler(new Mr(i,[this._buffer],null))},e.empty=function(){return 0===this._vertexCount},e.reset=function(){this._vertexCount=0},e.update=function(){if(!this.empty()){var t=Math.min(this._vertexCount,this._maxVertices)*this._stride;this._buffer.update(this._vertices,t)}},e.destroy=function(){this._inputAssembler&&this._inputAssembler.destroy(),this._buffer&&this._buffer.destroy()},t}(),pS=function(){this.lines=[],this.dashedLines=[],this.triangles=[];for(var t=0;t<2;t++)this.lines[t]=new dS,this.dashedLines[t]=new dS,this.triangles[t]=new dS},mS=function(){function t(){this._device=null,this._pipeline=null,this._buffers=void 0,this._nativeObj=null,this._buffers=new pS}var e=t.prototype;return e.activate=function(t,e,n){this._device=t,this._pipeline=e;for(var i=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_COLOR,pi.RGBA32F)],r=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_NORMAL,pi.RGBA32F),new Or($i.ATTR_COLOR,pi.RGBA32F)],a=n?n.maxLines:1e5,o=n?n.maxDashedLines:1e4,s=n?n.maxTriangles:1e4,c=Float32Array.BYTES_PER_ELEMENT*(Dn.length+Pn.length),l=Float32Array.BYTES_PER_ELEMENT*(Dn.length+ti.length+Pn.length),u=0;u<2;u++)this._buffers.lines[u].init(this._device,2*a,c,i),this._buffers.dashedLines[u].init(this._device,2*o,c,i),this._buffers.triangles[u].init(this._device,3*s,l,r)},e.flush=function(){},e.render=function(t,e){this.update();for(var n=this._pipeline.pipelineSceneData.geometryRendererPasses,i=this._pipeline.pipelineSceneData.geometryRendererShaders,r=0,a=[1,2],o=0;o<2;o++){var s=this._buffers.lines[o];if(!s.empty()){var c=new gr;c.vertexCount=s._vertexCount;for(var l=0;l<a[o];l++){var u=n[r+l],h=i[r+l],f=Dg.getOrCreatePipelineState(this._device,u,h,t,s._inputAssembler);e.bindPipelineState(f),e.bindDescriptorSet(Bd.MATERIAL,u.descriptorSet),e.bindInputAssembler(s._inputAssembler),e.draw(c)}}r+=a[o]}for(var _=0;_<2;_++){var d=this._buffers.dashedLines[_];if(!d.empty()){var p=new gr;p.vertexCount=d._vertexCount;for(var m=0;m<a[_];m++){var g=n[r+m],v=i[r+m],y=Dg.getOrCreatePipelineState(this._device,g,v,t,d._inputAssembler);e.bindPipelineState(y),e.bindDescriptorSet(Bd.MATERIAL,g.descriptorSet),e.bindInputAssembler(d._inputAssembler),e.draw(p)}}r+=a[_]}for(var S=0;S<2;S++){var T=this._buffers.triangles[S];if(!T.empty()){var x=new gr;x.vertexCount=T._vertexCount;for(var E=0;E<a[S];E++){var A=n[r+E],C=i[r+E],b=Dg.getOrCreatePipelineState(this._device,A,C,t,T._inputAssembler);e.bindPipelineState(b),e.bindDescriptorSet(Bd.MATERIAL,A.descriptorSet),e.bindInputAssembler(T._inputAssembler),e.draw(x)}}r+=a[S]}this.reset()},e.destroy=function(){for(var t=0;t<2;t++)this._buffers.lines[t].destroy(),this._buffers.dashedLines[t].destroy(),this._buffers.triangles[t].destroy()},e.empty=function(){for(var t=0;t<2;t++)if(!this._buffers.lines[t].empty()||!this._buffers.dashedLines[t].empty()||!this._buffers.triangles[t].empty())return!1;return!0},e.update=function(){for(var t=0;t<2;t++)this._buffers.lines[t].update(),this._buffers.dashedLines[t].update(),this._buffers.triangles[t].update()},e.reset=function(){for(var t=0;t<2;t++)this._buffers.lines[t].reset(),this._buffers.dashedLines[t].reset(),this._buffers.triangles[t].reset()},e.addDashedLine=function(t,e,n,i){void 0===i&&(i=!0);var r=this._buffers.dashedLines[i?1:0];if(r._vertexCount+2>r._maxVertices)R(12008);else{var a=r._vertexCount*(Dn.length+Pn.length);Dn.toArray(r._vertices,t,a),a+=Dn.length,Pn.toArray(r._vertices,n,a),a+=Pn.length,Dn.toArray(r._vertices,e,a),a+=Dn.length,Pn.toArray(r._vertices,n,a),r._vertexCount+=2}},e.addLine=function(t,e,n,i){void 0===i&&(i=!0);var r=this._buffers.lines[i?1:0];if(r._vertexCount+2>r._maxVertices)R(12008);else{var a=r._vertexCount*(Dn.length+Pn.length);Dn.toArray(r._vertices,t,a),a+=Dn.length,Pn.toArray(r._vertices,n,a),a+=Pn.length,Dn.toArray(r._vertices,e,a),a+=Dn.length,Pn.toArray(r._vertices,n,a),r._vertexCount+=2}},e.addTriangle=function(t,e,n,i,r,a,o){if(void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),r)return this.addLine(t,e,i,a),this.addLine(e,n,i,a),void this.addLine(n,t,i,a);var s=this._buffers.triangles[a?1:0];if(s._vertexCount+3>s._maxVertices)R(12009);else{var c=new ti(ti.ZERO);if(!o){var l=new Dn(e.x-t.x,e.y-t.y,e.z-t.z),u=new Dn(n.x-t.x,n.y-t.y,n.z-t.z),h=new Dn;Dn.normalize(h,Dn.cross(h,l,u)),c.set(h.x,h.y,h.z,1)}var f=s._vertexCount*(Dn.length+ti.length+Pn.length);Dn.toArray(s._vertices,t,f),f+=Dn.length,ti.toArray(s._vertices,c,f),f+=ti.length,Pn.toArray(s._vertices,i,f),f+=Pn.length,Dn.toArray(s._vertices,e,f),f+=Dn.length,ti.toArray(s._vertices,c,f),f+=ti.length,Pn.toArray(s._vertices,i,f),f+=Pn.length,Dn.toArray(s._vertices,n,f),f+=Dn.length,ti.toArray(s._vertices,c,f),f+=ti.length,Pn.toArray(s._vertices,i,f),s._vertexCount+=3}},e.addQuad=function(t,e,n,i,r,a,o,s){void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),a?(this.addLine(t,e,r,o),this.addLine(e,n,r,o),this.addLine(n,i,r,o),this.addLine(i,t,r,o)):(this.addTriangle(t,e,n,r,a,o,s),this.addTriangle(t,n,i,r,a,o,s))},e.addBoundingBox=function(t,e,n,i,r,a,o){void 0===n&&(n=!0),void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=new Xn),Yy.set(t.center.x-t.halfExtents.x,t.center.y-t.halfExtents.y,t.center.z-t.halfExtents.z),Ky.set(t.center.x+t.halfExtents.x,t.center.y+t.halfExtents.y,t.center.z+t.halfExtents.z),Qy.set(Yy.x,Yy.y,Yy.z),Jy.set(Ky.x,Yy.y,Yy.z),Zy.set(Yy.x,Ky.y,Yy.z),$y.set(Ky.x,Ky.y,Yy.z),tS.set(Yy.x,Yy.y,Ky.z),eS.set(Ky.x,Yy.y,Ky.z),nS.set(Yy.x,Ky.y,Ky.z),iS.set(Ky.x,Ky.y,Ky.z),a&&(Dn.transformMat4(Qy,Qy,o),Dn.transformMat4(Jy,Jy,o),Dn.transformMat4(Zy,Zy,o),Dn.transformMat4($y,$y,o),Dn.transformMat4(tS,tS,o),Dn.transformMat4(eS,eS,o),Dn.transformMat4(nS,nS,o),Dn.transformMat4(iS,iS,o)),n?(this.addLine(nS,iS,e,i),this.addLine(iS,$y,e,i),this.addLine($y,Zy,e,i),this.addLine(Zy,nS,e,i),this.addLine(tS,eS,e,i),this.addLine(eS,Jy,e,i),this.addLine(Jy,Qy,e,i),this.addLine(Qy,tS,e,i),this.addLine(nS,tS,e,i),this.addLine(iS,eS,e,i),this.addLine($y,Jy,e,i),this.addLine(Zy,Qy,e,i)):(this.addQuad(tS,eS,iS,nS,e,n,i,r),this.addQuad(eS,Jy,$y,iS,e,n,i,r),this.addQuad(Jy,Qy,Zy,$y,e,n,i,r),this.addQuad(Qy,tS,nS,Zy,e,n,i,r),this.addQuad(nS,iS,$y,Zy,e,n,i,r),this.addQuad(Qy,Jy,eS,tS,e,n,i,r))},e.addCross=function(t,e,n,i){void 0===i&&(i=!0);var r=.5*e,a=new Dn(t.x-r,t.y,t.z),o=new Dn(t.x+r,t.y,t.z);this.addLine(a,o,n,i),a.set(t.x,t.y-r,t.z),o.set(t.x,t.y+r,t.z),this.addLine(a,o,n,i),a.set(t.x,t.y,t.z-r),o.set(t.x,t.y,t.z+r),this.addLine(a,o,n,i)},e.addFrustum=function(t,e,n){void 0===n&&(n=!0);var i=t.vertices;this.addLine(i[0],i[1],e,n),this.addLine(i[1],i[2],e,n),this.addLine(i[2],i[3],e,n),this.addLine(i[3],i[0],e,n),this.addLine(i[4],i[5],e,n),this.addLine(i[5],i[6],e,n),this.addLine(i[6],i[7],e,n),this.addLine(i[7],i[4],e,n),this.addLine(i[0],i[4],e,n),this.addLine(i[1],i[5],e,n),this.addLine(i[2],i[6],e,n),this.addLine(i[3],i[7],e,n)},e.addCapsule=function(t,e,n,i,r,a,o,s,c,l,u){void 0===r&&(r=32),void 0===a&&(a=8),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===u&&(u=new Xn);for(var h=2*Math.PI/r,f=Math.PI/2/a,_=new Dn(t.x,t.y-n/2,t.z),d=new Dn(t.x,t.y+n/2,t.z),p=new Array,m=new Array,g=0;g<a+1;g++){for(var v=new Array,y=new Array,S=g*f,T=Math.sin(S),x=Math.cos(S),E=0;E<r+1;E++){var A=E*h,C=Math.sin(A),b=Math.cos(A),w=new Dn(e*T*b,e*x,e*T*C),I=new Dn(_.x+w.x,_.y-w.y,_.z+w.z),P=new Dn(d.x+w.x,d.y+w.y,d.z+w.z);v.push(I),y.push(P)}p.push(v),m.push(y)}if(l)for(var R=0;R<a+1;R++)for(var D=0;D<r+1;D++)Dn.transformMat4(p[R][D],p[R][D],u),Dn.transformMat4(m[R][D],m[R][D],u);for(var O=0;O<a;O++)for(var N=0;N<r;N++)this.addTriangle(p[O+1][N],p[O][N+1],p[O][N],i,o,s,c),this.addTriangle(p[O+1][N],p[O+1][N+1],p[O][N+1],i,o,s,c),this.addTriangle(m[O][N],m[O+1][N+1],m[O+1][N],i,o,s,c),this.addTriangle(m[O][N],m[O][N+1],m[O+1][N+1],i,o,s,c);for(var M=p[a],L=m[a],F=0;F<r;F++)this.addTriangle(L[F],M[F+1],M[F],i,o,s,c),this.addTriangle(L[F],L[F+1],M[F+1],i,o,s,c)},e.addCylinder=function(t,e,n,i,r,a,o,s,c,l){void 0===r&&(r=32),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var u=2*Math.PI/r,h=new Dn(t.x,t.y-n/2,t.z),f=new Dn(t.x,t.y+n/2,t.z),_=new Array,d=new Array,p=0;p<r+1;p++){var m=p*u,g=new Dn(e*Math.cos(m),0,e*Math.sin(m)),v=new Dn(g.x+h.x,g.y+h.y,g.z+h.z),y=new Dn(g.x+f.x,g.y+f.y,g.z+f.z);_.push(v),d.push(y)}if(c){Dn.transformMat4(h,h,l),Dn.transformMat4(f,f,l);for(var S=0;S<r+1;S++)Dn.transformMat4(_[S],_[S],l),Dn.transformMat4(d[S],d[S],l)}for(var T=0;T<r;T++)this.addTriangle(f,d[T+1],d[T],i,a,o,s),this.addTriangle(h,_[T],_[T+1],i,a,o,s),this.addTriangle(d[T],_[T+1],_[T],i,a,o,s),this.addTriangle(d[T],d[T+1],_[T+1],i,a,o,s)},e.addCone=function(t,e,n,i,r,a,o,s,c,l){void 0===r&&(r=32),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var u=2*Math.PI/r,h=new Dn(t.x,t.y-n/2,t.z),f=new Dn(t.x,t.y+n/2,t.z),_=new Array,d=0;d<r+1;d++){var p=new Dn(e*Math.cos(d*u),0,e*Math.sin(d*u)),m=new Dn(p.x+h.x,p.y+h.y,p.z+h.z);_.push(m)}if(c){Dn.transformMat4(h,h,l),Dn.transformMat4(f,f,l);for(var g=0;g<r+1;g++)Dn.transformMat4(_[g],_[g],l)}for(var v=0;v<r;v++)this.addTriangle(f,_[v+1],_[v],i,a,o,s),this.addTriangle(h,_[v],_[v+1],i,a,o,s)},e.addCircle=function(t,e,n,i,r,a,o){void 0===i&&(i=32),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=new Xn);for(var s=2*Math.PI/i,c=new Array,l=0;l<i+1;l++){var u=new Dn(e*Math.cos(l*s),0,e*Math.sin(l*s)),h=new Dn(u.x+t.x,u.y+t.y,u.z+t.z);c.push(h)}if(a)for(var f=0;f<i+1;f++)Dn.transformMat4(c[f],c[f],o);for(var _=0;_<i;_++)this.addLine(c[_],c[_+1],n,r)},e.addArc=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=new Xn);for(var l=_n(i),u=(_n(r)-l)/a,h=new Array,f=0;f<a+1;f++){var _=new Dn(e*Math.cos(f*u+l),0,e*Math.sin(f*u+l)),d=new Dn(_.x+t.x,_.y+t.y,_.z+t.z);h.push(d)}if(s)for(var p=0;p<a+1;p++)Dn.transformMat4(h[p],h[p],c);for(var m=0;m<a;m++)this.addLine(h[m],h[m+1],n,o)},e.addPolygon=function(t,e,n,i,r,a,o,s,c){void 0===i&&(i=6),void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===c&&(c=new Xn),r?this.addCircle(t,e,n,i,a,s,c):this.addDisc(t,e,n,i,r,a,o,s,c)},e.addDisc=function(t,e,n,i,r,a,o,s,c){void 0===i&&(i=32),void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===c&&(c=new Xn);for(var l=2*Math.PI/i,u=new Array,h=new Dn(t),f=0;f<i+1;f++){var _=new Dn(e*Math.cos(f*l),0,e*Math.sin(f*l)),d=new Dn(_.x+h.x,_.y+h.y,_.z+h.z);u.push(d)}if(s){Dn.transformMat4(h,h,c);for(var p=0;p<i+1;p++)Dn.transformMat4(u[p],u[p],c)}for(var m=0;m<i;m++)this.addTriangle(h,u[m],u[m+1],n,r,a,o);if(!r)for(var g=0;g<i;g++)this.addTriangle(h,u[g+1],u[g],n,r,a,o)},e.addSector=function(t,e,n,i,r,a,o,s,c,l,u){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===u&&(u=new Xn);for(var h=_n(i),f=(_n(r)-h)/a,_=new Array,d=new Dn(t),p=0;p<a+1;p++){var m=new Dn(e*Math.cos(p*f),0,e*Math.sin(p*f)),g=new Dn(m.x+d.x,m.y+d.y,m.z+d.z);_.push(g)}if(l){Dn.transformMat4(d,d,u);for(var v=0;v<a+1;v++)Dn.transformMat4(_[v],_[v],u)}for(var y=0;y<a;y++)this.addTriangle(d,_[y],_[y+1],n,o,s,c);if(!o)for(var S=0;S<a;S++)this.addTriangle(d,_[S+1],_[S],n,o,s,c)},e.addSphere=function(t,e,n,i,r,a,o,s,c,l){void 0===i&&(i=32),void 0===r&&(r=16),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var u=2*Math.PI/i,h=Math.PI/r,f=new Array,_=0;_<r+1;_++){for(var d=new Array,p=_*h,m=Math.sin(p),g=Math.cos(p),v=0;v<i+1;v++){var y=v*u,S=Math.sin(y),T=Math.cos(y),x=new Dn(e*m*T,e*g,e*m*S),E=new Dn(t.x+x.x,t.y+x.y,t.z+x.z);d.push(E)}f.push(d)}if(c)for(var A=0;A<r+1;A++)for(var C=0;C<i+1;C++)Dn.transformMat4(f[A][C],f[A][C],l);for(var b=0;b<r;b++)for(var w=0;w<i;w++)this.addTriangle(f[b][w],f[b+1][w+1],f[b+1][w],n,a,o,s),this.addTriangle(f[b][w],f[b][w+1],f[b+1][w+1],n,a,o,s)},e.addTorus=function(t,e,n,i,r,a,o,s,c,l,u){void 0===r&&(r=32),void 0===a&&(a=16),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===u&&(u=new Xn);for(var h=2*Math.PI/r,f=2*Math.PI/a,_=new Array,d=0;d<r+1;d++){for(var p=new Array,m=d*h,g=Math.sin(m),v=Math.cos(m),y=0;y<a+1;y++){var S=y*f,T=Math.sin(S),x=Math.cos(S),E=new Dn((e+n*x)*v,n*T,(e+n*x)*g),A=new Dn(t.x+E.x,t.y+E.y,t.z+E.z);p.push(A)}_.push(p)}if(l)for(var C=0;C<r+1;C++)for(var b=0;b<a+1;b++)Dn.transformMat4(_[C][b],_[C][b],u);for(var w=0;w<r;w++)for(var I=0;I<a;I++)this.addTriangle(_[w][I+1],_[w+1][I],_[w][I],i,o,s,c),this.addTriangle(_[w][I+1],_[w+1][I+1],_[w+1][I],i,o,s,c)},e.addOctahedron=function(t,e,n,i,r,a,o,s){void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=new Xn);var c=new Array;if(c.push(new Dn(e+t.x,t.y,t.z)),c.push(new Dn(t.x,t.y,t.z-e)),c.push(new Dn(-e+t.x,t.y,t.z)),c.push(new Dn(t.x,t.y,t.z+e)),c.push(new Dn(t.x,t.y+e,t.z)),c.push(new Dn(t.x,t.y-e,t.z)),o)for(var l=0;l<c.length;l++)Dn.transformMat4(c[l],c[l],s);i?(this.addLine(c[0],c[1],n,r),this.addLine(c[1],c[2],n,r),this.addLine(c[2],c[3],n,r),this.addLine(c[3],c[0],n,r),this.addLine(c[0],c[4],n,r),this.addLine(c[1],c[4],n,r),this.addLine(c[2],c[4],n,r),this.addLine(c[3],c[4],n,r),this.addLine(c[0],c[5],n,r),this.addLine(c[1],c[5],n,r),this.addLine(c[2],c[5],n,r),this.addLine(c[3],c[5],n,r)):(this.addTriangle(c[0],c[1],c[4],n,i,r,a),this.addTriangle(c[1],c[2],c[4],n,i,r,a),this.addTriangle(c[2],c[3],c[4],n,i,r,a),this.addTriangle(c[3],c[0],c[4],n,i,r,a),this.addTriangle(c[0],c[3],c[5],n,i,r,a),this.addTriangle(c[3],c[2],c[5],n,i,r,a),this.addTriangle(c[2],c[1],c[5],n,i,r,a),this.addTriangle(c[1],c[0],c[5],n,i,r,a))},e.addBezier=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=new Xn);var l=1/a,u=new Array,h=new Dn(t),f=new Dn(e),_=new Dn(n),d=new Dn(i);s&&(Dn.transformMat4(h,h,c),Dn.transformMat4(f,f,c),Dn.transformMat4(_,_,c),Dn.transformMat4(d,d,c));for(var p=0;p<a+1;p++){var m=p*l,g=(1-m)*(1-m)*(1-m),v=3*m*(1-m)*(1-m),y=3*m*m*(1-m),S=m*m*m,T=new Dn(g*h.x+v*f.x+y*_.x+S*d.x,g*h.y+v*f.y+y*_.y+S*d.y,g*h.z+v*f.z+y*_.z+S*d.z);u.push(T)}for(var x=0;x<a;x++)this.addLine(u[x],u[x+1],r,o)},e.addMesh=function(t,e,n,i,r,a){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=new Xn);for(var o=0;o<e.length;o+=3){var s=new Dn(t.x+e[o].x,t.y+e[o].y,t.z+e[o].z),c=new Dn(t.x+e[o+1].x,t.y+e[o+1].y,t.z+e[o+1].z),l=new Dn(t.x+e[o+2].x,t.y+e[o+2].y,t.z+e[o+2].z);r&&(Dn.transformMat4(s,s,a),Dn.transformMat4(c,c,a),Dn.transformMat4(l,l,a)),this.addLine(s,c,n,i),this.addLine(c,l,n,i),this.addLine(l,s,n,i)}},e.addIndexedMesh=function(t,e,n,i,r,a,o){void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=new Xn);for(var s=0;s<n.length;s+=3){var c=new Dn(t.x+e[n[s]].x,t.y+e[n[s]].y,t.z+e[n[s]].z),l=new Dn(t.x+e[n[s+1]].x,t.y+e[n[s+1]].y,t.z+e[n[s+1]].z),u=new Dn(t.x+e[n[s+2]].x,t.y+e[n[s+2]].y,t.z+e[n[s+2]].z);a&&(Dn.transformMat4(c,c,o),Dn.transformMat4(l,l,o),Dn.transformMat4(u,u,o)),this.addLine(c,l,i,r),this.addLine(l,u,i,r),this.addLine(u,c,i,r)}},Q(t,[{key:"native",get:function(){return this._nativeObj}}]),t}(),gS=new Xn,vS=new Xn,yS=new Xn,SS=new ti,TS=new ti(0,0,1,0),xS=function(){function t(){this._globalUBO=new Float32Array(Vd.COUNT),this._cameraUBO=new Float32Array(Hd.COUNT),this._shadowUBO=new Float32Array(Wd.COUNT)}t.updateGlobalUBOView=function(t,e){var n=l.director.root,i=e,r=Math.floor(t.width),a=Math.floor(t.height);i[Vd.TIME_OFFSET]=n.cumulativeTime,i[Vd.TIME_OFFSET+1]=n.frameTime,i[Vd.TIME_OFFSET+2]=l.director.getTotalFrames(),i[Vd.SCREEN_SIZE_OFFSET]=r,i[Vd.SCREEN_SIZE_OFFSET+1]=a,i[Vd.SCREEN_SIZE_OFFSET+2]=1/r,i[Vd.SCREEN_SIZE_OFFSET+3]=1/a,i[Vd.NATIVE_SIZE_OFFSET]=r,i[Vd.NATIVE_SIZE_OFFSET+1]=a,i[Vd.NATIVE_SIZE_OFFSET+2]=1/i[Vd.NATIVE_SIZE_OFFSET],i[Vd.NATIVE_SIZE_OFFSET+3]=1/i[Vd.NATIVE_SIZE_OFFSET+1]},t.updateCameraUBOView=function(t,e,n){var i,r=(n.scene?n.scene:l.director.getScene().renderScene).mainLight,a=t.pipelineSceneData,o=a.ambient,s=a.skybox,c=a.fog,u=a.shadows,h=e,f=n.exposure,_=a.isHDR;if(h[Hd.SCREEN_SCALE_OFFSET]=a.shadingScale,h[Hd.SCREEN_SCALE_OFFSET+1]=a.shadingScale,h[Hd.SCREEN_SCALE_OFFSET+2]=1/h[Hd.SCREEN_SCALE_OFFSET],h[Hd.SCREEN_SCALE_OFFSET+3]=1/h[Hd.SCREEN_SCALE_OFFSET+1],h[Hd.EXPOSURE_OFFSET]=f,h[Hd.EXPOSURE_OFFSET+1]=1/f,h[Hd.EXPOSURE_OFFSET+2]=_?1:0,h[Hd.EXPOSURE_OFFSET+3]=1/cv.standardExposureValue,r){var d=r.shadowEnabled&&u.type===uv.ShadowMap?1:0,p=r.direction;if(TS.set(p.x,p.y,p.z,d),ti.toArray(h,TS,Hd.MAIN_LIT_DIR_OFFSET),Dn.toArray(h,r.color,Hd.MAIN_LIT_COLOR_OFFSET),r.useColorTemperature){var m=r.colorTemperatureRGB;h[Hd.MAIN_LIT_COLOR_OFFSET]*=m.x,h[Hd.MAIN_LIT_COLOR_OFFSET+1]*=m.y,h[Hd.MAIN_LIT_COLOR_OFFSET+2]*=m.z}h[Hd.MAIN_LIT_COLOR_OFFSET+3]=_?r.illuminance*f:r.illuminance}else TS.set(0,0,1,0),ti.toArray(h,TS,Hd.MAIN_LIT_DIR_OFFSET),ti.toArray(h,ti.ZERO,Hd.MAIN_LIT_COLOR_OFFSET);var g=o.skyColor;g.w=_?o.skyIllum*f:o.skyIllum,h[Hd.AMBIENT_SKY_OFFSET+0]=g.x,h[Hd.AMBIENT_SKY_OFFSET+1]=g.y,h[Hd.AMBIENT_SKY_OFFSET+2]=g.z,h[Hd.AMBIENT_SKY_OFFSET+3]=g.w,h[Hd.AMBIENT_GROUND_OFFSET+0]=o.groundAlbedo.x,h[Hd.AMBIENT_GROUND_OFFSET+1]=o.groundAlbedo.y,h[Hd.AMBIENT_GROUND_OFFSET+2]=o.groundAlbedo.z,h[Hd.AMBIENT_GROUND_OFFSET+3]=s.envmap?null===(i=s.envmap)||void 0===i?void 0:i.mipmapLevel:1,Xn.toArray(h,n.matView,Hd.MAT_VIEW_OFFSET),Xn.toArray(h,n.node.worldMatrix,Hd.MAT_VIEW_INV_OFFSET),Dn.toArray(h,n.position,Hd.CAMERA_POS_OFFSET),Xn.toArray(h,n.matProj,Hd.MAT_PROJ_OFFSET),Xn.toArray(h,n.matProjInv,Hd.MAT_PROJ_INV_OFFSET),Xn.toArray(h,n.matViewProj,Hd.MAT_VIEW_PROJ_OFFSET),Xn.toArray(h,n.matViewProjInv,Hd.MAT_VIEW_PROJ_INV_OFFSET),h[Hd.CAMERA_POS_OFFSET+3]=this.getCombineSignY();var v=c.colorArray;h[Hd.GLOBAL_FOG_COLOR_OFFSET]=v.x,h[Hd.GLOBAL_FOG_COLOR_OFFSET+1]=v.y,h[Hd.GLOBAL_FOG_COLOR_OFFSET+2]=v.z,h[Hd.GLOBAL_FOG_COLOR_OFFSET+3]=v.z,h[Hd.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,h[Hd.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,h[Hd.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,h[Hd.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,h[Hd.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,h[Hd.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten,h[Hd.NEAR_FAR_OFFSET]=n.nearClip,h[Hd.NEAR_FAR_OFFSET+1]=n.farClip,h[Hd.VIEW_PORT_OFFSET]=a.shadingScale*n.window.width*n.viewport.x,h[Hd.VIEW_PORT_OFFSET+1]=a.shadingScale*n.window.height*n.viewport.y,h[Hd.VIEW_PORT_OFFSET+2]=a.shadingScale*n.window.width*n.viewport.z,h[Hd.VIEW_PORT_OFFSET+3]=a.shadingScale*n.window.height*n.viewport.w},t.updateShadowUBOView=function(t,e,n){var i=t.device,r=n.scene.mainLight,a=t.pipelineSceneData.shadows,o=e;if(a.enabled){if(r&&r.shadowEnabled&&a.type===uv.ShadowMap){var s=.1,c=0,l=a.matShadowView,u=a.matShadowProj,h=a.matShadowViewProj;r.shadowFixedArea?(s=r.shadowNear,c=r.shadowFar):(s=.1,c=a.shadowCameraFar),Xn.toArray(e,l,Wd.MAT_LIGHT_VIEW_OFFSET),o[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=u.m10,o[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=u.m14,o[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=u.m11,o[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=u.m15,o[Wd.SHADOW_PROJ_INFO_OFFSET+0]=u.m00,o[Wd.SHADOW_PROJ_INFO_OFFSET+1]=u.m05,o[Wd.SHADOW_PROJ_INFO_OFFSET+2]=1/u.m00,o[Wd.SHADOW_PROJ_INFO_OFFSET+3]=1/u.m05,Xn.toArray(e,h,Wd.MAT_LIGHT_VIEW_PROJ_OFFSET);var f=Wp(i)?0:1;o[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=s,o[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=c,o[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,o[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=1-r.shadowSaturation,o[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=a.size.x,o[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=a.size.y,o[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.shadowPcf,o[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.shadowBias,o[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,o[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=f,o[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.shadowNormalBias,o[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else r&&a.type===uv.Planar&&(Hv(a,r,o),Wv(a,o));Pn.toArray(o,a.shadowColor,Wd.SHADOW_COLOR_OFFSET)}},t.updateShadowUBOLightView=function(t,e,n){var i=t.device,r=t.pipelineSceneData.shadows,a=e,o=Wp(i)?0:1,s=.1,c=0,l=r.matShadowView,u=r.matShadowProj,h=r.matShadowViewProj;switch(n.type){case Sy.DIRECTIONAL:var f=n;f.shadowFixedArea?(s=f.shadowNear,c=f.shadowFar):(s=.1,c=r.shadowCameraFar),Xn.toArray(e,l,Wd.MAT_LIGHT_VIEW_OFFSET),a[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=u.m10,a[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=u.m14,a[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=u.m11,a[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=u.m15,a[Wd.SHADOW_PROJ_INFO_OFFSET+0]=u.m00,a[Wd.SHADOW_PROJ_INFO_OFFSET+1]=u.m05,a[Wd.SHADOW_PROJ_INFO_OFFSET+2]=1/u.m00,a[Wd.SHADOW_PROJ_INFO_OFFSET+3]=1/u.m05,Xn.toArray(e,h,Wd.MAT_LIGHT_VIEW_PROJ_OFFSET),SS.set(s,c,0,1-f.shadowSaturation),ti.toArray(a,SS,Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),SS.set(0,o,f.shadowNormalBias,0),ti.toArray(a,SS,Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),SS.set(r.size.x,r.size.y,f.shadowPcf,f.shadowBias),ti.toArray(a,SS,Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);break;case Sy.SPOT:var _=n;Xn.invert(gS,n.node.getWorldMatrix()),Xn.toArray(a,gS,Wd.MAT_LIGHT_VIEW_OFFSET),Xn.perspective(vS,n.angle,1,.001,n.range),Xn.multiply(yS,vS,gS),Xn.toArray(a,yS,Wd.MAT_LIGHT_VIEW_PROJ_OFFSET),SS.set(.01,n.range,0,0),ti.toArray(a,SS,Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),SS.set(1,o,_.shadowNormalBias,0),ti.toArray(a,SS,Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),SS.set(r.size.x,r.size.y,_.shadowPcf,_.shadowBias),ti.toArray(a,SS,Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET)}Pn.toArray(a,r.shadowColor,Wd.SHADOW_COLOR_OFFSET)},t.getCombineSignY=function(){return t._combineSignY};var e=t.prototype;return e._initCombineSignY=function(){var e=this._device;t._combineSignY=.5*e.capabilities.screenSpaceSignY+.5<<1|.5*e.capabilities.clipSpaceSignY+.5},e.activate=function(t,e){this._device=t,this._pipeline=e;var n=this._pipeline.descriptorSet;this._initCombineSignY();var i=t.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,Vd.SIZE,Vd.SIZE));n.bindBuffer(Vd.BINDING,i);var r=t.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,Hd.SIZE,Hd.SIZE));n.bindBuffer(Hd.BINDING,r);var a=t.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,Wd.SIZE,Wd.SIZE));n.bindBuffer(Wd.BINDING,a)},e.updateGlobalUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;i.update(),t.updateGlobalUBOView(e,this._globalUBO),r[0].updateBuffer(i.getBuffer(Vd.BINDING),this._globalUBO),n.bindBuffer(Vd.BINDING,i.getBuffer(Vd.BINDING)),n.update()},e.updateCameraUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;t.updateCameraUBOView(this._pipeline,this._cameraUBO,e),r[0].updateBuffer(i.getBuffer(Hd.BINDING),this._cameraUBO),n.bindBuffer(Hd.BINDING,i.getBuffer(Hd.BINDING)),n.update()},e.updateShadowUBO=function(e){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers,a=n.shadowFrameBufferMap,o=e.scene.mainLight;o&&a.has(o)&&i.bindTexture(jd,a.get(o).colorTextures[0]),t.updateShadowUBOView(this._pipeline,this._shadowUBO,e),i.update(),r[0].updateBuffer(i.getBuffer(Wd.BINDING),this._shadowUBO)}},e.updateShadowUBOLight=function(e,n){t.updateShadowUBOLightView(this._pipeline,this._shadowUBO,n),e.bindTexture(jd,Eg.get("default-texture").getGFXTexture()),e.bindTexture(tp,Eg.get("default-texture").getGFXTexture()),e.update(),e.getBuffer(Wd.BINDING).update(this._shadowUBO)},e.updateShadowUBORange=function(t,e){e instanceof Xn?Xn.toArray(this._shadowUBO,e,t):e instanceof Pn&&Pn.toArray(this._shadowUBO,e,t)},e.destroy=function(){},t}();xS._combineSignY=0;var ES,AS,CS,bS,wS,IS,PS,RS,DS,OS,NS,MS,LS,FS=t("RenderStage",(rS=Ec("RenderStage"),aS=Zc(),oS=Zc(),sS=Zc(),rS((_S=function(){function t(){st(this,"_name",uS,this),st(this,"_priority",hS,this),this._enabled=!0,st(this,"_tag",fS,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},e.activate=function(t,e){this._pipeline=t,this._flow=e},Q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}(),uS=ct((lS=_S).prototype,"_name",[aS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hS=ct(lS.prototype,"_priority",[oS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fS=ct(lS.prototype,"_tag",[sS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cS=lS))||cS));l.RenderStage=FS;var BS,zS=t("RenderFlow",(ES=Ec("RenderFlow"),AS=Zc(),CS=Zc(),bS=Zc(),wS=Zc(),IS=al([FS]),ES((LS=function(){function t(){st(this,"_name",DS,this),st(this,"_priority",OS,this),st(this,"_tag",NS,this),st(this,"_stages",MS,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},e.activate=function(t){this._pipeline=t,this._stages.sort((function(t,e){return t.priority-e.priority}));for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].activate(t,this)},e.render=function(t){for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].enabled&&this._stages[e].render(t)},e.destroy=function(){for(var t=0,e=this._stages.length;t<e;t++)this._stages[t].destroy();this._stages.length=0},Q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),t}(),DS=ct((RS=LS).prototype,"_name",[AS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),OS=ct(RS.prototype,"_priority",[CS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NS=ct(RS.prototype,"_tag",[bS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MS=ct(RS.prototype,"_stages",[wS,IS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PS=RS))||PS));l.RenderFlow=zS,function(t){t.RENDER_FRAME_BEGIN="render-frame-begin",t.RENDER_FRAME_END="render-frame-end",t.RENDER_CAMERA_BEGIN="render-camera-begin",t.RENDER_CAMERA_END="render-camera-end",t.ATTACHMENT_SCALE_CAHNGED="attachment-scale-changed"}(BS||(BS=t("PipelineEventType",{})));var US,kS,GS,VS,HS,WS,jS,XS,qS,YS,KS,QS,JS,ZS,$S,tT=t("PipelineEventProcessor",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e}Z(e,t);var n=e.prototype;return n.on=function(t,e,n,i){return this.eventTargetOn(t,e,n,i)},n.once=function(t,e,n){return this.eventTargetOnce(t,e,n)},e}(tu)),eT=new ir,nT=new ur,iT=function(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null},rT=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},aT=t("RenderPipeline",(US=Ec("cc.RenderPipeline"),kS=Zc(),GS=Zc(),VS=al([zS]),US((qS=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_tag",jS,rt(e)),st(e,"_flows",XS,rt(e)),e._quadIB=null,e._quadVBOnscreen=null,e._quadVBOffscreen=null,e._quadIAOnscreen=null,e._quadIAOffscreen=null,e._eventProcessor=new tT,e._commandBuffers=[],e._pipelineUBO=new xS,e._macros={},e._constantMacros="",e._profiler=null,e._geometryRenderer=new mS,e._pipelineRenderData=null,e._renderPasses=new Map,e._width=0,e._height=0,e._lastUsedRenderArea=new ir,e._clusterEnabled=!1,e._bloomEnabled=!1,e}Z(e,t);var n=e.prototype;return n.getPipelineRenderData=function(){return this._pipelineRenderData},n.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},n.createRenderPass=function(t,e,n){var i=this._device,r=new Lr,a=new Fr;r.format=e,a.format=n,a.stencilStoreOp=Bi.DISCARD,a.depthStoreOp=Bi.DISCARD,t&Ji.COLOR||(t&ov?r.loadOp=Fi.DISCARD:(r.loadOp=Fi.LOAD,r.barrier=i.getGeneralBarrier(new kr(zi.COLOR_ATTACHMENT_WRITE,zi.COLOR_ATTACHMENT_WRITE)))),(t&Ji.DEPTH_STENCIL)!==Ji.DEPTH_STENCIL&&(t&Ji.DEPTH||(a.depthLoadOp=Fi.LOAD),t&Ji.STENCIL||(a.stencilLoadOp=Fi.LOAD)),a.barrier=i.getGeneralBarrier(new kr(zi.DEPTH_STENCIL_ATTACHMENT_WRITE,zi.DEPTH_STENCIL_ATTACHMENT_WRITE));var o=new Ur([r],a);return i.createRenderPass(o)},n.getRenderPass=function(t,e){var n=this._renderPasses.get(t);return n||(n=this.createRenderPass(t,e.colorTextures[0].format,e.depthStencilTexture.format),this._renderPasses.set(t,n),n)},n.applyFramebufferRatio=function(t){for(var e=this.pipelineSceneData,n=this._width*e.shadingScale,i=this._height*e.shadingScale,r=t.colorTextures,a=0;a<r.length;a++)r[a].resize(n,i);t.depthStencilTexture&&t.depthStencilTexture.resize(n,i),t.destroy(),t.initialize(new Vr(t.renderPass,r,t.depthStencilTexture))},n.generateRenderArea=function(t,e){var n=t.viewport,i=t.window.width,r=t.window.height;e.x=n.x*i,e.y=n.y*r,e.width=n.width*i,e.height=n.height*r},n.generateViewport=function(t,e){this.generateRenderArea(t,eT),e||(e=nT);var n=this.pipelineSceneData.shadingScale;return e.left=eT.x*n,e.top=eT.y*n,e.width=eT.width*n,e.height=eT.height*n,e},n.generateScissor=function(t,e){e||(e=eT),this.generateRenderArea(t,e);var n=this.pipelineSceneData.shadingScale;return e.x*=n,e.y*=n,e.width*=n,e.height*=n,e},n.activate=function(){var t=l.director.root;this._device=t.device,this._generateConstantMacros(),this._globalDSManager=new Qv(this),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device,this),this._geometryRenderer.activate(this._device,this);for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0},n._ensureEnoughSize=function(){},n.render=function(t){if(0!==t.length){this._commandBuffers[0].begin(),this.emit(BS.RENDER_FRAME_BEGIN,t),this._ensureEnoughSize(t),function(t){for(var e=t.length-1;e>=0;--e){var n=t[e];if(n.window.swapchain)return void(jg=n)}jg=null}(t);for(var e=0;e<t.length;e++){var n=t[e];if(n.scene){this.emit(BS.RENDER_CAMERA_BEGIN,n),jv(this,n),Xv(this,n),this._pipelineUBO.updateGlobalUBO(n.window),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n);this.emit(BS.RENDER_CAMERA_END,n)}}this.emit(BS.RENDER_FRAME_END,t),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n._destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._destroyBloomData=function(){var t,e=this._pipelineRenderData.bloom;if(null!==e){e.prefiterTex&&e.prefiterTex.destroy(),e.prefilterFramebuffer&&e.prefilterFramebuffer.destroy();for(var n=0;n<e.downsampleTexs.length;++n)e.downsampleTexs[n].destroy(),e.downsampleFramebuffers[n].destroy();e.downsampleTexs.length=0,e.downsampleFramebuffers.length=0;for(var i=0;i<e.upsampleTexs.length;++i)e.upsampleTexs[i].destroy(),e.upsampleFramebuffers[i].destroy();e.upsampleTexs.length=0,e.upsampleFramebuffers.length=0,e.combineTex&&e.combineTex.destroy(),e.combineFramebuffer&&e.combineFramebuffer.destroy(),null===(t=e.renderPass)||void 0===t||t.destroy(),this._pipelineRenderData.bloom=null}},n._genQuadVertexData=function(t,e){var n=new Float32Array(16),i=e.x/this._width,r=(e.x+e.width)/this._width,a=e.y/this._height,o=(e.y+e.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){var s=o;o=a,a=s}var c=0;switch(t){case _i.IDENTITY:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=a;break;case _i.ROTATE_90:c=0,n[c++]=-1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=i,n[c++]=a;break;case _i.ROTATE_180:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o;break;case _i.ROTATE_270:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=r,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o}return n},n._createQuadInputAssembler=function(){var t=new rT,e=4*Float32Array.BYTES_PER_ELEMENT,n=4*e,i=this._device.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE|Ti.HOST,n,e));if(!i)return t;var r=Uint8Array.BYTES_PER_ELEMENT,a=6*r,o=this._device.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,a,r));if(!o)return t;var s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,o.update(s);var c=new Array(2);c[0]=new Or("a_position",pi.RG32F),c[1]=new Or("a_texCoord",pi.RG32F);var l=this._device.createInputAssembler(new Mr(c,[i],o));return t.quadIB=o,t.quadVB=i,t.quadIA=l,t},n.updateQuadVertexData=function(t,e){var n=this._lastUsedRenderArea;if(n.x!==t.x||n.y!==t.y||n.width!==t.width||n.height!==t.height){var i=this._genQuadVertexData(_i.IDENTITY,t);this._quadVBOffscreen.update(i);var r=this._genQuadVertexData(e.swapchain&&e.swapchain.surfaceTransform||_i.IDENTITY,t);this._quadVBOnscreen.update(r),n.copy(t)}},n.destroy=function(){for(var e,n,i=0;i<this._flows.length;i++)this._flows[i].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null===(e=this._globalDSManager)||void 0===e||e.destroy();for(var r=0;r<this._commandBuffers.length;r++)this._commandBuffers[r].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null===(n=this._pipelineSceneData)||void 0===n||n.destroy(),this._geometryRenderer.destroy(),t.prototype.destroy.call(this)},n._generateConstantMacros=function(){var t="";t+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.getFormatFeatures(pi.RGBA32F)&(Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE)?1:0)+"\n",t+="#define CC_ENABLE_CLUSTERED_LIGHT_CULLING "+(this._clusterEnabled?1:0)+"\n",t+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",t+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",t+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.device.hasFeature(di.INPUT_ATTACHMENT_BENEFIT)?1:0)+"\n",t+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(du.os===au.ANDROID&&du.isBrowser?1:0)+"\n",t+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+(he.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",this._constantMacros=t},n.generateBloomRenderData=function(){if(null==this._pipelineRenderData.bloom){var t=this._pipelineRenderData.bloom=new iT,e=this.device,n=new Lr;n.format=pi.RGBA8,n.loadOp=Fi.CLEAR,n.storeOp=Bi.STORE,n.barrier=e.getGeneralBarrier(new kr(zi.NONE,zi.COLOR_ATTACHMENT_WRITE)),t.renderPass=e.createRenderPass(new Ur([n]));var i=this._width,r=this._height;t.prefiterTex=e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA8,i>>1,r>>1)),t.prefilterFramebuffer=e.createFramebuffer(new Vr(t.renderPass,[t.prefiterTex])),i>>=1,r>>=1;for(var a=0;a<6;++a)t.downsampleTexs.push(e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA8,i>>1,r>>1))),t.downsampleFramebuffers[a]=e.createFramebuffer(new Vr(t.renderPass,[t.downsampleTexs[a]])),t.upsampleTexs.push(e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA8,i,r))),t.upsampleFramebuffers[a]=e.createFramebuffer(new Vr(t.renderPass,[t.upsampleTexs[a]])),i>>=1,r>>=1;t.combineTex=e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA8,this._width,this._height)),t.combineFramebuffer=e.createFramebuffer(new Vr(t.renderPass,[t.combineTex])),t.sampler=this.globalDSManager.linearSampler}},n.on=function(t,e,n,i){return this._eventProcessor.on(t,e,n,i)},n.once=function(t,e,n){return this._eventProcessor.once(t,e,n)},n.off=function(t,e,n){this._eventProcessor.off(t,e,n)},n.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},n.targetOff=function(t){this._eventProcessor.targetOff(t)},n.removeAll=function(t){this._eventProcessor.removeAll(t)},n.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},Q(e,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}},{key:"profiler",get:function(){return this._profiler},set:function(t){this._profiler=t}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"clusterEnabled",get:function(){return this._clusterEnabled},set:function(t){this._clusterEnabled=t}},{key:"bloomEnabled",get:function(){return this._bloomEnabled},set:function(t){this._bloomEnabled=t}}]),e}(Du),jS=ct((WS=qS).prototype,"_tag",[kS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XS=ct(WS.prototype,"_flows",[GS,VS,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HS=WS))||HS));l.RenderPipeline=aT,function(t){t[t.BLOOM=18]="BLOOM",t[t.POST_PROCESS=19]="POST_PROCESS",t[t.UI=20]="UI"}(YS||(YS={})),function(t){t[t.FORWARD=10]="FORWARD"}(KS||(KS={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.FORWARD=1]="FORWARD",t[t.UI=10]="UI"}(QS||(QS={})),function(t){t[t.GBUFFER=10]="GBUFFER",t[t.LIGHTING=15]="LIGHTING",t[t.TRANSPARENT=18]="TRANSPARENT"}(JS||(JS={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.MAIN=1]="MAIN",t[t.UI=10]="UI"}(ZS||(ZS={}));var oT=new Lr;oT.format=pi.RGBA8;var sT=new Fr;sT.format=pi.DEPTH_STENCIL;var cT,lT,uT,hT,fT,_T,dT,pT,mT,gT,vT,yT,ST,TT,xT,ET,AT,CT,bT,wT,IT,PT,RT,DT,OT,NT,MT,LT,FT,BT,zT,UT,kT,GT,VT,HT,WT,jT,XT,qT,YT,KT,QT,JT,ZT,$T,tx,ex,nx,ix,rx,ax,ox,sx,cx,lx,ux,hx,fx,_x,dx,px,mx,gx,vx,yx,Sx,Tx,xx,Ex,Ax,Cx,bx,wx,Ix,Px,Rx,Dx,Ox,Nx=new Ur([oT],sT),Mx={width:1,height:1,renderPassInfo:Nx},Lx=t("RenderTexture",Ec("cc.RenderTexture")($S=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._window=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},n.reset=function(t){this.initialize(t)},n.destroy=function(){if(this._window){var e=l.director.root;null==e||e.destroyWindow(this._window),this._window=null}return t.prototype.destroy.call(this)},n.resize=function(t,e){this._width=Math.floor(un(t,1,2048)),this._height=Math.floor(un(e,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},n._serialize=function(){return{}},n._deserialize=function(e,n){var i=e;this._width=i.w,this._height=i.h,this._name=i.n,t.prototype._deserialize.call(this,i.base,n)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.onLoaded=function(){this._initWindow()},n._initWindow=function(t){var e=l.director.root;Mx.title=this._name,Mx.width=this._width,Mx.height=this._height,Mx.renderPassInfo=t&&t.passInfo?t.passInfo:Nx,oT.barrier=e.device.getGeneralBarrier(new kr(zi.FRAGMENT_SHADER_READ_TEXTURE,zi.FRAGMENT_SHADER_READ_TEXTURE)),this._window?(this._window.destroy(),this._window.initialize(e.device,Mx)):this._window=e.createWindow(Mx)},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this._width=this._height=1,this._initWindow()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},n.readPixels=function(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),n=n||this.width,i=i||this.height;var a=this.getGFXTexture();if(!a)return O(7606),null;var o=4*n*i;if(void 0===r)r=new Uint8Array(o);else if(r.length<o)return O(7607,o),null;var s=this._getGFXDevice(),c=[],l=[],u=new lr;return u.texOffset.x=t,u.texOffset.y=e,u.texExtent.width=n,u.texExtent.height=i,l.push(u),c.push(r),null==s||s.copyTextureToBuffers(a,c,l),r},Q(e,[{key:"window",get:function(){return this._window}}]),e}(Hm))||$S);l.RenderTexture=Lx,le(xi),le(Ei),le(Bi),le(Fi),le(zi),function(t){t[t.SCENE=0]="SCENE",t[t.POSTPROCESS=1]="POSTPROCESS",t[t.UI=2]="UI"}(Ox||(Ox={})),le(Ox),cT=Ec("RenderTextureDesc"),lT=al(xi),uT=al(Ei),hT=al(pi),cT((_T=ct((fT=function(){st(this,"name",_T,this),st(this,"type",dT,this),st(this,"usage",pT,this),st(this,"format",mT,this),st(this,"width",gT,this),st(this,"height",vT,this)}).prototype,"name",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dT=ct(fT.prototype,"type",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xi.TEX2D}}),pT=ct(fT.prototype,"usage",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ei.COLOR_ATTACHMENT}}),mT=ct(fT.prototype,"format",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pi.UNKNOWN}}),gT=ct(fT.prototype,"width",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),vT=ct(fT.prototype,"height",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),fT));var Fx,Bx=(yT=Ec("RenderTextureConfig"),ST=al(Lx),yT((ET=ct((xT=function(){st(this,"name",ET,this),st(this,"texture",AT,this)}).prototype,"name",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),AT=ct(xT.prototype,"texture",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TT=xT))||TT),zx=(CT=Ec("MaterialConfig"),bT=al($g),CT((IT=ct((wT=function(){st(this,"name",IT,this),st(this,"material",PT,this)}).prototype,"name",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),PT=ct(wT.prototype,"material",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wT)),RT=Ec("FrameBufferDesc"),DT=al([Fe]),OT=al(Lx),RT((MT=ct((NT=function(){st(this,"name",MT,this),st(this,"renderPass",LT,this),st(this,"colorTextures",FT,this),st(this,"depthStencilTexture",BT,this),st(this,"texture",zT,this)}).prototype,"name",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),LT=ct(NT.prototype,"renderPass",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FT=ct(NT.prototype,"colorTextures",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BT=ct(NT.prototype,"depthStencilTexture",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),zT=ct(NT.prototype,"texture",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NT)),UT=Ec("ColorDesc"),kT=al(pi),GT=al(Fi),VT=al(Bi),HT=al([zi]),WT=al([zi]),UT((qT=ct((XT=function(){st(this,"format",qT,this),st(this,"loadOp",YT,this),st(this,"storeOp",KT,this),st(this,"sampleCount",QT,this),st(this,"beginAccesses",JT,this),st(this,"endAccesses",ZT,this)}).prototype,"format",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pi.UNKNOWN}}),YT=ct(XT.prototype,"loadOp",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),KT=ct(XT.prototype,"storeOp",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bi.STORE}}),QT=ct(XT.prototype,"sampleCount",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),JT=ct(XT.prototype,"beginAccesses",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.NONE}}),ZT=ct(XT.prototype,"endAccesses",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.COLOR_ATTACHMENT_WRITE}}),jT=XT))||jT),Ux=($T=Ec("DepthStencilDesc"),tx=al(pi),ex=al(Fi),nx=al(Bi),ix=al(Fi),rx=al(Bi),ax=al(zi),ox=al(zi),$T((lx=ct((cx=function(){st(this,"format",lx,this),st(this,"depthLoadOp",ux,this),st(this,"depthStoreOp",hx,this),st(this,"stencilLoadOp",fx,this),st(this,"stencilStoreOp",_x,this),st(this,"sampleCount",dx,this),st(this,"beginAccesses",px,this),st(this,"endAccesses",mx,this)}).prototype,"format",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pi.UNKNOWN}}),ux=ct(cx.prototype,"depthLoadOp",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),hx=ct(cx.prototype,"depthStoreOp",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bi.STORE}}),fx=ct(cx.prototype,"stencilLoadOp",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),_x=ct(cx.prototype,"stencilStoreOp",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bi.STORE}}),dx=ct(cx.prototype,"sampleCount",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),px=ct(cx.prototype,"beginAccesses",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.NONE}}),mx=ct(cx.prototype,"endAccesses",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.DEPTH_STENCIL_ATTACHMENT_WRITE}}),sx=cx))||sx);gx=Ec("RenderPassDesc"),vx=al([zx]),yx=al(Ux),gx((Tx=ct((Sx=function(){st(this,"index",Tx,this),st(this,"colorAttachments",xx,this),st(this,"depthStencilAttachment",Ex,this)}).prototype,"index",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),xx=ct(Sx.prototype,"colorAttachments",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ex=ct(Sx.prototype,"depthStencilAttachment",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ux}}),Sx)),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(Fx||(Fx={})),le(Fx);var kx=(Ax=Ec("RenderQueueDesc"),Cx=al(Fx),bx=al([Fe]),Ax((Px=ct((Ix=function(){st(this,"isTransparent",Px,this),st(this,"sortMode",Rx,this),st(this,"stages",Dx,this)}).prototype,"isTransparent",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rx=ct(Ix.prototype,"sortMode",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fx.FRONT_TO_BACK}}),Dx=ct(Ix.prototype,"stages",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wx=Ix))||wx);function Gx(t,e){return t.hash-e.hash||t.depth-e.depth||t.shaderId-e.shaderId}function Vx(t,e){return t.hash-e.hash||e.depth-t.depth||t.shaderId-e.shaderId}var Hx=function(){function t(t){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=t,this._passPool=new Wl((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new jl(64,this._passDesc.sortFunc)}var e=t.prototype;return e.clear=function(){this.queue.clear(),this._passPool.reset()},e.insertRenderPass=function(t,e,n){var i=t.model.subModels[e],r=i.passes[n],a=i.shaders[n];if(r.blendState.targets[0].blend!==this._passDesc.isTransparent||!(r.phase&this._passDesc.phases))return!1;var o=0|r.priority<<16|i.priority<<8|n,s=this._passPool.add();return s.hash=o,s.depth=t.depth||0,s.shaderId=a.typedID,s.subModel=i,s.passIdx=n,this.queue.push(s),!0},e.sort=function(){this.queue.sort()},e.recordCommandBuffer=function(t,e,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],a=r.subModel,o=r.passIdx,s=a.inputAssembler,c=a.passes[o],l=a.shaders[o],u=Dg.getOrCreatePipelineState(t,c,l,e,s);n.bindPipelineState(u),n.bindDescriptorSet(Bd.MATERIAL,c.descriptorSet),n.bindDescriptorSet(Bd.LOCAL,a.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}();function Wx(t){for(var e=0,n=0;n<t.stages.length;n++)e|=Ag(t.stages[n]);var i=Gx;switch(t.sortMode){case Fx.BACK_TO_FRONT:i=Vx;break;case Fx.FRONT_TO_BACK:i=Gx}return new Hx({isTransparent:t.isTransparent,phases:e,sortFunc:i})}function jx(t){t.clear()}function Xx(t){t.sort()}var qx=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var a=0;a<r.vbs.length;++a)r.vbs[a].update(r.vbDatas[a]);t.updateBuffer(r.vbIdx,r.vbIdxData.buffer),t.updateBuffer(r.ubo,r.uboData)}}n=e.next()}},e.recordCommandBuffer=function(t,e,n,i){void 0===i&&(i=null);for(var r=this.queue.values(),a=r.next();!a.done;){for(var o=!1,s=0;s<a.value.batches.length;++s){var c=a.value.batches[s];if(c.mergeCount){if(!o){var l=c.shader,u=Dg.getOrCreatePipelineState(t,c.pass,l,e,c.ia);n.bindPipelineState(u),n.bindDescriptorSet(Bd.MATERIAL,c.pass.descriptorSet),o=!0}i&&n.bindDescriptorSet(Bd.GLOBAL,i),n.bindDescriptorSet(Bd.LOCAL,c.descriptorSet,a.value.dynamicOffsets),n.bindInputAssembler(c.ia),n.draw(c.ia)}}a=r.next()}},t}(),Yx=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(t),n=e.next()},e.recordCommandBuffer=function(t,e,n,i){void 0===i&&(i=null);for(var r=this.queue.values(),a=r.next();!a.done;){var o=a.value,s=o.instances,c=o.pass;if(o.hasPendingModels){n.bindDescriptorSet(Bd.MATERIAL,c.descriptorSet);for(var l=null,u=0;u<s.length;++u){var h=s[u];if(h.count){var f=h.shader,_=Dg.getOrCreatePipelineState(t,c,f,e,h.ia);l!==_&&(n.bindPipelineState(_),l=_),i&&n.bindDescriptorSet(Bd.GLOBAL,i),n.bindDescriptorSet(Bd.LOCAL,h.descriptorSet,a.value.dynamicOffsets),n.bindInputAssembler(h.ia),n.draw(h.ia)}}}a=r.next()}},t}(),Kx=new Hl((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),Qx=new Float32Array(4),Jx=[],Zx=[],$x=new Xn,tE=new Xn;function eE(t,e){return!(!e.worldBounds||ds.aabbWithAABB(e.worldBounds,t.aabb))}function nE(t,e){return!(!e.worldBounds||ds.aabbWithAABB(e.worldBounds,t.aabb)&&ds.aabbFrustum(e.worldBounds,t.frustum))}var iE=Ag("forward-add"),rE=[];function aE(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===iE){a=o,n=!0;break}e.push(a)}return n}var oE,sE,cE,lE,uE,hE,fE,_E,dE,pE,mE,gE=function(){function t(t){this._pipeline=void 0,this._device=void 0,this._lightPasses=[],this._shadowUBO=new Float32Array(Wd.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._pipeline=t,this._device=t.device,this._instancedQueue=new Yx,this._batchedQueue=new qx;var e=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(sp.SIZE/e)*e,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new mr(this._lightBuffer,0,sp.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount)}var e=t.prototype;return e.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear();for(var t=0;t<this._lightPasses.length;t++){var e=this._lightPasses[t];e.dynamicOffsets.length=0,e.lights.length=0}Kx.freeArray(this._lightPasses),this._lightPasses.length=0},e.destroy=function(){for(var t=this._pipeline.globalDSManager.descriptorSetMap,e=t.keys,n=0;n<e.length;n++){var i=e[n],r=t.get(i);r&&(r.getBuffer(Wd.BINDING).destroy(),r.getTexture(jd).destroy(),r.getTexture(tp).destroy(),r.destroy()),t.delete(i)}},e.gatherLightPasses=function(t,e){this.clear();var n=this._pipeline.pipelineSceneData.validPunctualLights;if(n.length){this._updateUBOs(t,e),this._updateLightDescriptorSet(t,e);for(var i=this._pipeline.pipelineSceneData.renderObjects,r=0;r<i.length;r++){var a=i[r].model,o=a.subModels;if(aE(o,rE)&&(Zx.length=0,this._lightCulling(a,n),Zx.length))for(var s=0;s<o.length;s++){var c=rE[s];if(!(c<0)){var l=o[s],u=l.passes[c];l.passes[0].blendState.targets[0].blend||(l.descriptorSet.bindBuffer(sp.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(u,l,a,c))}}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,n){for(var i=this._pipeline.globalDSManager,r=0;r<Zx.length;r++){var a=Zx[r],o=i.getOrCreateDescriptorSet(a);this._instancedQueue.recordCommandBuffer(t,e,n,o),this._batchedQueue.recordCommandBuffer(t,e,n,o)}for(var s=0;s<this._lightPasses.length;s++){var c=this._lightPasses[s],l=c.subModel,u=c.passIdx,h=c.dynamicOffsets,f=c.lights,_=l.passes[u],d=l.shaders[u],p=l.inputAssembler,m=Dg.getOrCreatePipelineState(t,_,d,e,p),g=_.descriptorSet,v=l.descriptorSet;n.bindPipelineState(m),n.bindDescriptorSet(Bd.MATERIAL,g),n.bindInputAssembler(p);for(var y=0;y<h.length;++y){var S=f[y],T=i.getOrCreateDescriptorSet(S);Jx[0]=h[y],n.bindDescriptorSet(Bd.GLOBAL,T),n.bindDescriptorSet(Bd.LOCAL,v,Jx),n.draw(p)}}},e._lightCulling=function(t,e){for(var n=!1,i=!function(t){for(var e=t.subModels,n=0;n<e.length;++n)for(var i=e[n].passes,r=0;r<i.length;++r){var a=i[r].batchingScheme;if(a===yg.INSTANCING)return!0;if(a===yg.VB_MERGING)return!0}return!1}(t),r=0;r<e.length;r++){var a=e[r];switch(a.type){case Sy.SPHERE:i&&(n=eE(a,t));break;case Sy.SPOT:i&&(n=nE(a,t))}n||Zx.push(r)}},e._addRenderQueue=function(t,e,n,i){var r=t.batchingScheme;if(r===yg.INSTANCING)for(var a=0;a<Zx.length;a++){var o=Zx[a],s=t.getInstancedBuffer(o);s.merge(e,n.instancedAttributes,i),s.dynamicOffsets[0]=this._lightBufferStride*o,this._instancedQueue.queue.add(s)}else if(r===yg.VB_MERGING)for(var c=0;c<Zx.length;c++){var l=Zx[c],u=t.getBatchedBuffer(l);u.merge(e,i,n),u.dynamicOffsets[0]=this._lightBufferStride*l,this._batchedQueue.queue.add(u)}else{var h=Kx.alloc();h.subModel=e,h.passIdx=i;for(var f=0;f<Zx.length;f++){var _=Zx[f];h.lights.push(_),h.dynamicOffsets.push(this._lightBufferStride*_)}this._lightPasses.push(h)}},e._updateLightDescriptorSet=function(t,e){for(var n=this._pipeline.device,i=this._pipeline.pipelineSceneData,r=i.shadows,a=i.shadowFrameBufferMap,o=t.scene.mainLight,s=Wp(n)?0:1,c=this._pipeline.globalDSManager,l=i.validPunctualLights,u=0;u<l.length;u++){var h=l[u],f=c.getOrCreateDescriptorSet(u);if(f){var _=void 0,d=void 0;switch(h.type){case Sy.SPHERE:o&&(Hv(r,o,this._shadowUBO),Wv(r,this._shadowUBO)),this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=1,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=0,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=2,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=0,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,Pn.toArray(this._shadowUBO,r.shadowColor,Wd.SHADOW_COLOR_OFFSET);break;case Sy.SPOT:var p=h;if(o&&(Hv(r,o,this._shadowUBO),Wv(r,this._shadowUBO)),Xn.invert($x,h.node.getWorldMatrix()),Xn.perspective(tE,h.angle,1,.001,h.range),_=tE.clone(),d=tE.clone().invert(),Xn.multiply(tE,tE,$x),Xn.toArray(this._shadowUBO,$x,Wd.MAT_LIGHT_VIEW_OFFSET),Xn.toArray(this._shadowUBO,tE,Wd.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=.01,this._shadowUBO[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=h.range,this._shadowUBO[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,this._shadowUBO[Wd.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=0,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=p.shadowPcf,this._shadowUBO[Wd.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=p.shadowBias,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=1,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=p.shadowNormalBias,this._shadowUBO[Wd.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,this._shadowUBO[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=_.m10,this._shadowUBO[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=_.m14,this._shadowUBO[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=_.m11,this._shadowUBO[Wd.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=_.m15,this._shadowUBO[Wd.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+0]=d.m10,this._shadowUBO[Wd.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+1]=d.m14,this._shadowUBO[Wd.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+2]=d.m11,this._shadowUBO[Wd.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+3]=d.m15,this._shadowUBO[Wd.SHADOW_PROJ_INFO_OFFSET+0]=_.m00,this._shadowUBO[Wd.SHADOW_PROJ_INFO_OFFSET+1]=_.m05,this._shadowUBO[Wd.SHADOW_PROJ_INFO_OFFSET+2]=1/_.m00,this._shadowUBO[Wd.SHADOW_PROJ_INFO_OFFSET+3]=1/_.m05,Pn.toArray(this._shadowUBO,r.shadowColor,Wd.SHADOW_COLOR_OFFSET),a.has(h)){var m,g=null===(m=a.get(h))||void 0===m?void 0:m.colorTextures[0];g&&f.bindTexture(tp,g)}}f.update(),e.updateBuffer(f.getBuffer(Wd.BINDING),this._shadowUBO)}}},e._updateUBOs=function(t,e){var n=t.exposure,i=this._pipeline.pipelineSceneData,r=i.isHDR,a=i.shadows,o=i.validPunctualLights;o.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Tn(o.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new mr(this._lightBuffer,0,sp.SIZE)));for(var s=0,c=0;s<o.length;s++,c+=this._lightBufferElementCount){var l=o[s];switch(l.type){case Sy.SPHERE:if(Dn.toArray(Qx,l.position),Qx[3]=0,this._lightBufferData.set(Qx,c+sp.LIGHT_POS_OFFSET),Qx[0]=l.size,Qx[1]=l.range,Qx[2]=0,Qx[3]=0,this._lightBufferData.set(Qx,c+sp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Dn.toArray(Qx,l.color),l.useColorTemperature){var u=l.colorTemperatureRGB;Qx[0]*=u.x,Qx[1]*=u.y,Qx[2]*=u.z}Qx[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(Qx,c+sp.LIGHT_COLOR_OFFSET);break;case Sy.SPOT:if(Dn.toArray(Qx,l.position),Qx[3]=1,this._lightBufferData.set(Qx,c+sp.LIGHT_POS_OFFSET),Qx[0]=l.size,Qx[1]=l.range,Qx[2]=l.spotAngle,Qx[3]=a.enabled&&l.shadowEnabled&&a.type===uv.ShadowMap?1:0,this._lightBufferData.set(Qx,c+sp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Dn.toArray(Qx,l.direction),this._lightBufferData.set(Qx,c+sp.LIGHT_DIR_OFFSET),Dn.toArray(Qx,l.color),l.useColorTemperature){var h=l.colorTemperatureRGB;Qx[0]*=h.x,Qx[1]*=h.y,Qx[2]*=h.z}Qx[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(Qx,c+sp.LIGHT_COLOR_OFFSET)}}e.updateBuffer(this._lightBuffer,this._lightBufferData)},t}(),vE=new Ys,yE=function(){function t(t){this._pendingModels=[],this._castModels=[],this._instancedQueue=new Yx,this._pipeline=void 0,this._pipeline=t}var e=t.prototype;return e.gatherShadowPasses=function(t,e){var n=this._pipeline.pipelineSceneData,i=(this._pipeline.pipelineUBO,n.shadows);if(this._instancedQueue.clear(),this._pendingModels.length=0,this._castModels.length=0,i.enabled&&i.type===uv.Planar&&!(i.normal.length()<1e-6)){var r=t.scene,a=t.frustum,o=0!=(t.visibility&Cd.BitMask.DEFAULT);if(r.mainLight&&o){for(var s=r.models,c=0;c<s.length;c++){var l=s[c];l.enabled&&l.node&&l.castShadow&&this._castModels.push(l)}var u=i.instancingMaterial.passes[0].getInstancedBuffer();this._instancedQueue.queue.add(u);for(var h=0;h<this._castModels.length;h++){var f=this._castModels[h];if(!f.worldBounds||(Ys.transform(vE,f.worldBounds,i.matLight),ds.aabbFrustum(vE,a)))if(f.isInstancingEnabled)for(var _=f.subModels,d=0;d<_.length;d++){var p=_[d];u.merge(p,f.instancedAttributes,0,p.planarInstanceShader)}else this._pendingModels.push(f)}this._instancedQueue.uploadBuffers(e)}}},e.recordCommandBuffer=function(t,e,n){var i=this._pipeline.pipelineSceneData.shadows;if(i.enabled&&i.type===uv.Planar&&(this._instancedQueue.recordCommandBuffer(t,e,n),this._pendingModels.length)){var r=i.material.passes[0],a=r.descriptorSet;n.bindDescriptorSet(Bd.MATERIAL,a);for(var o=this._pendingModels.length,s=0;s<o;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=u.planarShader,f=u.inputAssembler,_=Dg.getOrCreatePipelineState(t,r,h,e,f);n.bindPipelineState(_),n.bindDescriptorSet(Bd.LOCAL,u.descriptorSet),n.bindInputAssembler(f),n.draw(f)}}},t}(),SE=function(){function t(){this._phaseID=Ag("default")}var e=t.prototype;return e.activate=function(t){this._pipeline=t},e.render=function(t,e){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],a=t.scene.batches,o=0;o<a.length;o++){var s=a[o],c=!1;if(t.visibility&s.visFlags&&(c=!0),c)for(var l=s.shaders.length,u=0;u<l;u++){var h=s.passes[u];if(h.phase===this._phaseID){var f=s.shaders[u],_=s.inputAssembler,d=Dg.getOrCreatePipelineState(i,h,f,e,_);r.bindPipelineState(d),r.bindDescriptorSet(Bd.MATERIAL,h.descriptorSet);var p=s.descriptorSet;r.bindDescriptorSet(Bd.LOCAL,p),r.bindInputAssembler(_),r.draw(_)}}}},t}(),TE=[new hr(0,0,0,1)],xE=t("ForwardStage",(oE=Ec("ForwardStage"),sE=al([kx]),cE=Zc(),oE((_E=fE=function(t){function e(){var e;return st(e=t.call(this)||this,"renderQueues",hE,rt(e)),e._renderQueues=[],e._renderArea=new ir,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Ag("default"),e._clearFlag=4294967295,e._batchedQueue=new qx,e._instancedQueue=new Yx,e._uiPhase=new SE,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=Wx(this.renderQueues[i]);this._additiveLightQueue=new gE(this._pipeline),this._planarQueue=new yE(this._pipeline),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(jx);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(a=0;a<h.length;++a){var f=h[a];if(f.phase===this._phaseID){var _=f.batchingScheme;if(_===yg.INSTANCING){var d=f.getInstancedBuffer();d.merge(u,c.model.instancedAttributes,a),this._instancedQueue.queue.add(d)}else if(_===yg.VB_MERGING){var p=f.getBatchedBuffer();p.merge(u,a,c.model),this._batchedQueue.queue.add(p)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(Xx);var m=e.commandBuffers[0];e.pipelineUBO.updateShadowUBO(t),this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(t,m),this._planarQueue.gatherShadowPasses(t,m),t.clearFlag&Ji.COLOR&&(TE[0].x=t.clearColor.x,TE[0].y=t.clearColor.y,TE[0].z=t.clearColor.z,TE[0].w=t.clearColor.w),e.generateRenderArea(t,this._renderArea);var g=t.window.framebuffer,v=e.getRenderPass(t.clearFlag&this._clearFlag,g);m.beginRenderPass(v,g,this._renderArea,TE,t.clearDepth,t.clearStencil),m.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,v,m),this._instancedQueue.recordCommandBuffer(n,v,m),this._batchedQueue.recordCommandBuffer(n,v,m),this._additiveLightQueue.recordCommandBuffer(n,v,m),m.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet),this._planarQueue.recordCommandBuffer(n,v,m),this._renderQueues[1].recordCommandBuffer(n,v,m),this._pipeline.geometryRenderer.render(v,m),this._uiPhase.render(t,v),Xg(n,v,m,e.profiler,t),m.endRenderPass()},e}(FS),fE.initInfo={name:"ForwardStage",priority:KS.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:Fx.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:Fx.BACK_TO_FRONT,stages:["default","planarShadow"]}]},hE=ct((uE=_E).prototype,"renderQueues",[sE,Dc,cE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lE=uE))||lE)),EE=t("ForwardFlow",Ec("ForwardFlow")((mE=pE=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new xE;n.initialize(xE.initInfo),this._stages.push(n)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(zS),pE.initInfo={name:Pd,priority:QS.FORWARD,stages:[]},dE=mE))||dE),AE=new Xn,CE=new Xn,bE=new Xn,wE=new Ys,IE=Ag("shadow-caster"),PE=[];function RE(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===IE){a=o,n=!0;break}e.push(a)}return n}var DE,OE,NE,ME,LE,FE,BE=function(){function t(t){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=t,this._instancedQueue=new Yx,this._batchedQueue=new qx}var e=t.prototype;return e.gatherLightPasses=function(t,e,n,i){this.clear();var r=this._pipeline.pipelineSceneData,a=r.shadows;if(n&&a.enabled&&a.type===uv.ShadowMap){var o=r.dirShadowObjects,s=r.castShadowObjects;switch(n.type){case Sy.DIRECTIONAL:for(var c=0;c<o.length;c++){var l=o[c].model;RE(l.subModels,PE)&&this.add(l,PE)}break;case Sy.SPOT:Xn.invert(AE,n.node.getWorldMatrix()),Xn.perspective(CE,n.angle,1,.001,n.range),Xn.multiply(bE,CE,AE);for(var u=0;u<s.length;u++){var h=s[u].model;RE(h.subModels,PE)&&(h.worldBounds&&(Ys.transform(wE,h.worldBounds,bE),!ds.aabbFrustum(wE,e.frustum))||this.add(h,PE))}}this._instancedQueue.uploadBuffers(i),this._batchedQueue.uploadBuffers(i)}},e.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},e.add=function(t,e){for(var n=t.subModels,i=0;i<n.length;i++){var r=n[i],a=e[i],o=r.passes[a];if(o.batchingScheme===yg.INSTANCING){var s=o.getInstancedBuffer();s.merge(r,t.instancedAttributes,a),this._instancedQueue.queue.add(s)}else if(o.batchingScheme===yg.VB_MERGING){var c=o.getBatchedBuffer();c.merge(r,a,t),this._batchedQueue.queue.add(c)}else{var l=r.shaders[a];this._subModelsArray.push(r),l&&this._shaderArray.push(l),this._passArray.push(o)}}},e.recordCommandBuffer=function(t,e,n){this._instancedQueue.recordCommandBuffer(t,e,n),this._batchedQueue.recordCommandBuffer(t,e,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],a=this._shaderArray[i],o=this._passArray[i],s=r.inputAssembler,c=Dg.getOrCreatePipelineState(t,o,a,e,s),l=o.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(Bd.MATERIAL,l),n.bindDescriptorSet(Bd.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}(),zE=[new hr(1,1,1,1)],UE=t("ShadowStage",Ec("ShadowStage")((NE=OE=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowFrameBuffer=null,e._renderArea=new ir,e._light=null,e._globalDS=null,e}Z(e,t);var n=e.prototype;return n.setUsage=function(t,e,n){this._globalDS=t,this._light=e,this._shadowFrameBuffer=n},n.destroy=function(){var t;this._shadowFrameBuffer=null,this._globalDS=null,this._light=null,null===(t=this._additiveShadowQueue)||void 0===t||t.clear()},n.clearFramebuffer=function(t){if(this._light&&this._shadowFrameBuffer){zE[0].w=t.clearColor.w;var e=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;e.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,zE,t.clearDepth,t.clearStencil),e.endRenderPass()}},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData,i=n.shadows,r=n.shadingScale,a=this._globalDS,o=e.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._pipeline.pipelineUBO.updateShadowUBOLight(a,this._light),this._additiveShadowQueue.gatherLightPasses(a,t,this._light,o);var s=t.viewport,c=i.size;this._renderArea.x=s.x*c.x,this._renderArea.y=s.y*c.y,this._renderArea.width=s.width*c.x*r,this._renderArea.height=s.height*c.y*r;var l=e.device,u=this._shadowFrameBuffer.renderPass;o.beginRenderPass(u,this._shadowFrameBuffer,this._renderArea,zE,t.clearDepth,t.clearStencil),o.bindDescriptorSet(Bd.GLOBAL,a),this._additiveShadowQueue.recordCommandBuffer(l,u,o),o.endRenderPass()}},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._additiveShadowQueue=new BE(e)},e}(FS),OE.initInfo={name:"ShadowStage",priority:KS.FORWARD,tag:0},DE=NE))||DE),kE=[],GE=t("ShadowFlow",Ec("ShadowFlow")((FE=LE=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowRenderPass=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new UE;n.initialize(UE.initInfo),this._stages.push(n)}return!0},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData.shadows,i=e.pipelineSceneData.shadowFrameBufferMap,r=e.pipelineSceneData.castShadowObjects,a=this._pipeline.pipelineSceneData.validPunctualLights;if(n.enabled&&n.type===uv.ShadowMap){for(var o=0,s=0;o<n.maxReceived&&s<a.length;){var c=a[s];c.type===Sy.SPOT&&(kE.push(c),o++),s++}if(0!==r.length){n.shadowMapDirty&&this.resizeShadowMap();var l=t.scene.mainLight;if(l){var u=e.descriptorSet;i.has(l)||this._initShadowFrameBuffer(e,l,t.window.swapchain);for(var h=i.get(l),f=0;f<this._stages.length;f++){var _=this._stages[f];_.setUsage(u,l,h),_.render(t)}}for(var d=0;d<kE.length;d++){var p=kE[d],m=e.globalDSManager.getOrCreateDescriptorSet(d);i.has(p)||this._initShadowFrameBuffer(e,p,t.window.swapchain);for(var g=i.get(p),v=0;v<this._stages.length;v++){var y=this._stages[v];y.setUsage(m,p,g),y.render(t)}}kE.length=0}else this.clearShadowMap(kE,t)}},n.destroy=function(){if(t.prototype.destroy.call(this),this._pipeline){for(var e=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(e.values()),i=0;i<n.length;i++){var r=n[i];if(r){for(var a=r.colorTextures,o=0;o<a.length;o++){var s=a[i];s&&s.destroy()}a.length=0;var c=r.depthStencilTexture;c&&c.destroy(),r.destroy()}}e.clear()}this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(t,e){var n=t.device,i=t.pipelineSceneData.shadows.size,r=t.pipelineSceneData.shadowFrameBufferMap,a=Wp(n)?pi.R32F:pi.RGBA8;if(!this._shadowRenderPass){var o=new Lr;o.format=a,o.loadOp=Fi.CLEAR,o.storeOp=Bi.STORE,o.sampleCount=1;var s=new Fr;s.format=pi.DEPTH_STENCIL,s.depthLoadOp=Fi.CLEAR,s.depthStoreOp=Bi.DISCARD,s.stencilLoadOp=Fi.CLEAR,s.stencilStoreOp=Bi.DISCARD,s.sampleCount=1;var c=new Ur([o],s);this._shadowRenderPass=n.createRenderPass(c)}var l=[];l.push(n.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,a,i.x,i.y)));var u=n.createTexture(new Sr(xi.TEX2D,Ei.DEPTH_STENCIL_ATTACHMENT,pi.DEPTH_STENCIL,i.x,i.y)),h=n.createFramebuffer(new Vr(this._shadowRenderPass,l,u));r.set(e,h)},n.clearShadowMap=function(t,e){var n=this._pipeline,i=n.pipelineSceneData,r=e.scene.mainLight;if(r){var a=this._pipeline.descriptorSet;i.shadowFrameBufferMap.has(r)||this._initShadowFrameBuffer(this._pipeline,r,e.window.swapchain);for(var o=i.shadowFrameBufferMap.get(r),s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(a,r,o),c.render(e)}}for(var l=0;l<t.length;l++){var u=t[l],h=i.shadowFrameBufferMap.get(u),f=n.globalDSManager.getOrCreateDescriptorSet(l);if(i.shadowFrameBufferMap.has(u))for(var _=0;_<this._stages.length;_++){var d=this._stages[_];d.setUsage(f,u,h),d.clearFramebuffer(e)}}},n.resizeShadowMap=function(){for(var t=this._pipeline.pipelineSceneData.shadows,e=t.size,n=this._pipeline,i=n.device,r=n.pipelineSceneData.shadowFrameBufferMap,a=Wp(i)?pi.R32F:pi.RGBA8,o=r.values(),s=o.next();!s.done;){var c=s.value;if(c){var l=[];l.push(n.device.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,a,e.x,e.y)));var u=c.depthStencilTexture;u&&u.resize(e.x,e.y);var h=c.renderPass;c.destroy(),c.initialize(new Vr(h,l,u)),s=o.next()}else s=o.next()}t.shadowMapDirty=!1},e}(zS),LE.initInfo={name:Rd,priority:QS.SHADOW,tag:Ox.SCENE,stages:[]},ME=FE))||ME);function VE(t,e){for(var n,i=ot(e);!(n=i()).done;){var r=n.value;Array.isArray(r)?VE(t,r):t.push(r)}}function HE(t){var e=[];return VE(e,t),e.join("")}var WE=_l.Flags.Destroyed,jE=_l.Flags.PersistentMask,XE=tn.IDENTIFIER_RE,qE="var ",YE="o",KE={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},QE=tn.escapeForJS,JE=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return qE+this.varName+"="+this.expression+";"},t}();function ZE(t,e){return e instanceof JE?new JE(e.varName,t+e.expression):t+e}function $E(t,e,n){Array.isArray(n)?(n[0]=ZE(e,n[0]),t.push(n)):t.push(ZE(e,n)+";")}var tA=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];$E(t,e+eA(i[0])+"=",i[1])}},t}();function eA(t){return XE.test(t)?"."+t:"["+QE(t)+"]"}tA.pool=void 0,tA.pool=new ee((function(t){t._exps.length=0,t._targetExp=null}),1),tA.pool.get=function(t){var e=this._get()||new tA;return e._targetExp=t,e};var nA=function(){function t(t,e){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=It(),Ut(this.funcModuleCache,KE),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=qE+this.globalVariables.join(",")+";");var i=HE(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,a=this.objsToClear_iN$t.length;r<a;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var n=Pt(t);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var a=this.funcs.indexOf(t);a<0&&(a=this.funcs.length,this.funcs.push(t));var o="F["+a+"]";return e&&(o="("+o+")"),this.funcModuleCache[n]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,n,i){var r=tA.pool.get(i),a=e.constructor.__props__;a||(a=Object.keys(e));for(var o=0;o<a.length;o++){var s=a[o],c=n[s];if(e[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(t),tA.pool.put(r)},e.enumerateCCClass=function(t,e,n){for(var i=n.__values__,r=Re(n),a=0;a<i.length;a++){var o=i[a],s=e[o],c=r[o+"$_$default"];if(!iA(c,s))if("object"==typeof s&&s instanceof l.ValueType&&(c=tn.getDefault(c))&&c.constructor===s.constructor){var u=YE+eA(o);this.setValueType(t,c,s,u)}else this.setObjProp(t,e,o,s)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,n=[new JE(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var i=0;i<t.length;++i)$E(n,e+"["+i+"]=",this.enumerateField(t,i,t[i]));return n},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var n="a"+ ++this.localVariableId,i=[new JE(n,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&$E(i,n+"["+r+"]=",t[r]);return i},e.enumerateField=function(t,e,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var a=i.source[0];i.source[0]=ZE(r+"=",a)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?QE(n):("_objFlags"===e&&t instanceof _l&&(n&=jE),n)},e.setObjProp=function(t,e,n,i){$E(t,YE+eA(n)+"=",this.enumerateField(e,n,i))},e.enumerateObject=function(t,e){var n=e.constructor;if(en(n))this.enumerateCCClass(t,e,n);else for(var i in e)if(e.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=e[i];"object"==typeof r&&r&&r===e._iN$t||this.setObjProp(t,e,i,r)}},e.instantiateObj=function(t){if(t instanceof l.ValueType)return tn.getNewValueTypeCode(t);if(t instanceof l.Asset)return this.getObjRef(t);if(t._objFlags&WE)return null;var e,n=t.constructor;if(en(n)){if(this.parent)if(this.parent instanceof l.Component){if(t instanceof l._BaseNode||t instanceof l.Component)return this.getObjRef(t)}else if(this.parent instanceof l._BaseNode)if(t instanceof l._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof l.Component){var i;if(!(null===(i=t.node)||void 0===i?void 0:i.isChildOf(this.parent)))return this.getObjRef(t)}e=new JE(YE,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)e=new JE(YE,"{}");else{if(n)return this.getObjRef(t);e=new JE(YE,"Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function iA(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof l.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return xt(t)&&xt(e)}return!1}var rA,aA,oA,sA,cA,lA,uA,hA,fA,_A,dA=function(){function t(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=t}return t.prototype.applyOpacity=function(t){this._opacity=this._localOpacity*t},t.markOpacityTree=function(){},Q(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?R(12002):this._uiComp=t}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t,this.colorDirty=!0}}]),t}();_l.Flags.Destroying,function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed",t.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed"}(rA||(rA={}));var pA=_l.Flags.Destroying,mA=_l.Flags.DontDestroy,gA=_l.Flags.Deactivating,vA=new mt("Node");function yA(t){return t?"string"==typeof t?$t(t):t:(O(3804),null)}var SA,TA,xA,EA,AA,CA,bA,wA,IA,PA,RA,DA=t("BaseNode",Ec("cc.BaseNode")((_A=fA=function(t){Z(n,t),n._setScene=function(t){t._updateScene()},n._findComponent=function(t,e){var n=e,i=t._components;if(n._sealed)for(var r=0;r<i.length;++r){var a=i[r];if(a.constructor===e)return a}else for(var o=0;o<i.length;++o){var s=i[o];if(s instanceof e)return s}return null},n._findComponents=function(t,e,n){var i=e,r=t._components;if(i._sealed)for(var a=0;a<r.length;++a){var o=r[a];o.constructor===e&&n.push(o)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof e&&n.push(c)}},n._findChildComponent=function(t,e){for(var i=0;i<t.length;++i){var r=t[i],a=n._findComponent(r,e);if(a)return a;if(r._children.length>0&&(a=n._findChildComponent(r._children,e)))return a}return null},n._findChildComponents=function(t,e,i){for(var r=0;r<t.length;++r){var a=t[r];n._findComponents(a,e,i),a._children.length>0&&n._findChildComponents(a._children,e,i)}};var e=n.prototype;function n(e){var n;return st(n=t.call(this,e)||this,"_parent",sA,rt(n)),st(n,"_children",cA,rt(n)),st(n,"_active",lA,rt(n)),st(n,"_components",uA,rt(n)),st(n,"_prefab",hA,rt(n)),n._scene=null,n._activeInHierarchy=!1,n._id=vA.getNewId(),n._name=void 0,n._eventProcessor=new l.NodeEventProcessor(rt(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._registerIfAttached=void 0,n._name=void 0!==e?e:"New Node",n}return e._updateScene=function(){null==this._parent?T("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},e.attr=function(t){Ut(this,t)},e.getParent=function(){return this._parent},e.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var n=this._parent,i=t;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,e),this.emit&&this.emit(rA.PARENT_CHANGED,n),n&&!(n._objFlags&pA)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(rA.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(rA.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},e.getChildByUuid=function(t){if(!t)return y("Invalid uuid"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._id===t)return e[n];return null},e.getChildByName=function(t){if(!t)return y("Invalid name"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._name===t)return e[n];return null},e.getChildByPath=function(t){for(var e=t.split("/"),n=this,i=function(t){var i=e[t];if(0===i.length)return"continue";var r=n.children.find((function(t){return t.name===i}));if(!r)return{v:null};n=r},r=0;r<e.length;++r){var a=i(r);if("continue"!==a&&"object"==typeof a)return a.v}return n},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&gA)O(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var n=e.indexOf(this);t!==n&&(e.splice(n,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},e.walk=function(t,e){var i=1,r=null,a=null,o=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(a=s[--i])if(!l&&t?t(a):l&&e&&e(a),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++o])s[i]=r[o],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(o=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),o<0))break}else a._children.length>0?(c=a,r=a._children,o=0,s[i]=r[o],i++):(s[i]=a,i++,l=!0);s.length=0,n._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var n=t[e];n&&(n.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=yA(t);return e?n._findComponent(this,e):null},e.getComponents=function(t){var e=yA(t),i=[];return e&&n._findComponents(this,e,i),i},e.getComponentInChildren=function(t){var e=yA(t);return e?n._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=yA(t),i=[];return e&&(n._findComponents(this,e,i),n._findChildComponents(this._children,e,i)),i},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=$t(t)))throw l._RF.peek()&&O(3808,t),TypeError(F(3807,t))}else{if(!t)throw TypeError(F(3804));e=t}if("function"!=typeof e)throw TypeError(F(3809));if(!Vt(e,l.Component))throw TypeError(F(3810));var n=e._requireComponent;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){var r=n[i];this.getComponent(r)||this.addComponent(r)}else{var a=n;this.getComponent(a)||this.addComponent(a)}var o=new e;return o.node=this,this._components.push(o),this._activeInHierarchy&&l.director._nodeActivator.activateComp(o),o},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof Zu?t:this.getComponent(t))&&e.destroy()}else O(3813)},e.on=function(t,e,n,i){switch(void 0===i&&(i=!1),t){case rA.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,n,i)},e.off=function(t,e,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(t,e,n,i),!this._eventProcessor.hasEventListener(t))switch(t){case rA.TRANSFORM_CHANGED:this._eventMask&=-2}},e.once=function(t,e,n,i){this._eventProcessor.once(t,e,n,i)},e.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},e.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(rA.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&pA)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&O(3815)}}else O(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(rA.SIBLING_ORDER_CHANGED)},e._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},e._onPostActivated=function(){},e._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},e._onPreDestroy=function(){this._onPreDestroyBase()},e._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},e._instantiate=function(t,e){return t||(t=l.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof l.Scene||l.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&l.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=pA;var t=this._parent,e=!!t&&0!=(t._objFlags&pA);if(this._persistNode&&l.game.removePersistRootNode(this),!e&&t){this.emit(rA.PARENT_CHANGED,this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(rA.CHILD_REMOVED,this)}this.emit(rA.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var i=this._children,r=0;r<i.length;++r)i[r]._destroyImmediate();for(var a=this._components,o=0;o<a.length;++o)a[o]._destroyImmediate();return e},Q(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&mA)>0},set:function(t){t?this._objFlags|=mA:this._objFlags&=~mA}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&l.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),n}(_l),fA.idGenerator=vA,fA._stacks=[[]],fA._stackId=0,ct((oA=_A).prototype,"_persistNode",[wc],Object.getOwnPropertyDescriptor(oA.prototype,"_persistNode"),oA.prototype),ct(oA.prototype,"name",[Vc],Object.getOwnPropertyDescriptor(oA.prototype,"name"),oA.prototype),ct(oA.prototype,"children",[Vc],Object.getOwnPropertyDescriptor(oA.prototype,"children"),oA.prototype),ct(oA.prototype,"active",[Vc],Object.getOwnPropertyDescriptor(oA.prototype,"active"),oA.prototype),ct(oA.prototype,"activeInHierarchy",[Vc],Object.getOwnPropertyDescriptor(oA.prototype,"activeInHierarchy"),oA.prototype),ct(oA.prototype,"parent",[Vc],Object.getOwnPropertyDescriptor(oA.prototype,"parent"),oA.prototype),sA=ct(oA.prototype,"_parent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cA=ct(oA.prototype,"_children",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lA=ct(oA.prototype,"_active",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uA=ct(oA.prototype,"_components",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hA=ct(oA.prototype,"_prefab",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aA=oA))||aA);l._BaseNode=DA;var OA=new Dn,NA=new zn,MA=new zn,LA=new zn,FA=new Ln,BA=new Ln,zA=new Xn,UA=[],kA=[],GA=[],VA=function(){function t(){this._chunks=[],this._freelists=[],this._createChunk()}var e=t.prototype;return e.alloc=function(){for(var t=this._freelists.length,e=0;e<t;++e)if(this._freelists[e].length)return this._createView(e);return this._createChunk(),this._createView(t)},e.free=function(t,e){for(var n=this._freelists.length,i=0;i<n;++i)if(this._chunks[i]===t)return void this._freelists[i].push(e)},e.clear=function(){for(var t=this._chunks.length,e=0;e<t;++e)this._chunks[e].fill(0)},e._createChunk=function(){this._chunks.push(new Uint32Array(t.CAPACITY_PER_CHUNK));for(var e=[],n=t.CAPACITY_PER_CHUNK-1;n>=0;n--)e.push(n);this._freelists.push(e)},e._createView=function(t){return GA[0]=this._chunks[t],GA[1]=this._freelists[t].pop(),GA},t}();VA.CAPACITY_PER_CHUNK=256;var HA,WA,jA,XA,qA,YA,KA,QA,JA,ZA,$A,tC,eC,nC,iC,rC,aC,oC,sC,cC,lC,uC,hC,fC,_C,dC,pC,mC,gC,vC,yC,SC,TC,xC,EC,AC,CC,bC,wC,IC,PC,RC,DC,OC,NC,MC,LC,FC,BC,zC,UC,kC,GC,VC,HC,WC,jC,XC,qC,YC,KC,QC,JC,ZC,$C,tb,eb,nb,ib,rb=new VA,ab=Symbol("ReserveContentsForAllSyncablePrefab"),ob=t("Node",(SA=Ec("cc.Node"),TA=al(Dn),SA((RA=PA=function(t){Z(n,t);var e=n.prototype;function n(e){var n;return(n=t.call(this,e)||this)._uiProps=new dA(rt(n)),n._static=!1,st(n,"_lpos",AA,rt(n)),st(n,"_lrot",CA,rt(n)),st(n,"_lscale",bA,rt(n)),st(n,"_layer",wA,rt(n)),st(n,"_euler",IA,rt(n)),n._dirtyFlagsPri=yy.NONE,n._eulerDirty=!1,n._nodeHandle=0,n._init(),n}return e._init=function(){var t=rb.alloc(),e=t[0],n=t[1];this._hasChangedFlagsChunk=e,this._hasChangedFlagsOffset=n;var i=new Uint32Array(e.buffer,e.byteOffset+4*n,1);this._hasChangedFlags=i,this._pos=new Dn,this._rot=new zn,this._scale=new Dn(1,1,1),this._mat=new Xn},n.isNode=function(t){return t instanceof n&&(t.constructor===n||!(t instanceof l.Scene))},e._onPreDestroy=function(){var t=this._onPreDestroyBase();return rb.free(this._hasChangedFlagsChunk,this._hasChangedFlagsOffset),t},e[lh]=function(t){t.writeThis()},e.setParent=function(e,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,n)},e._onSetParent=function(e,n){if(t.prototype._onSetParent.call(this,e,n),n){var i=this._parent;i?(i.updateWorldTransform(),ln(Xn.determinant(i._mat),0,sn)?(R(14200),this._dirtyFlags|=yy.TRS,this.updateWorldTransform()):(Xn.multiply(zA,Xn.invert(zA,i._mat),this._mat),Xn.toRTS(zA,this._lrot,this._lpos,this._lscale))):(Dn.copy(this._lpos,this._pos),zn.copy(this._lrot,this._rot),Dn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(yy.TRS)},e._onHierarchyChanged=function(e){this.eventProcessor.reattach(),t.prototype._onHierarchyChangedBase.call(this,e)},e._onBatchCreated=function(t){this.hasChangedFlags=yy.TRS,this._dirtyFlags|=yy.TRS;for(var e=this._children.length,n=0;n<e;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},e._onBeforeSerialize=function(){this.eulerAngles},e._onPostActivated=function(t){t?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(yy.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},e.translate=function(t,e){var n=e||vy.LOCAL;if(n===vy.LOCAL)Dn.transformQuat(OA,t,this._lrot),this._lpos.x+=OA.x,this._lpos.y+=OA.y,this._lpos.z+=OA.z;else if(n===vy.WORLD)if(this._parent){zn.invert(NA,this._parent.worldRotation),Dn.transformQuat(OA,t,NA);var i=this.worldScale;this._lpos.x+=OA.x/i.x,this._lpos.y+=OA.y/i.y,this._lpos.z+=OA.z/i.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(yy.POSITION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.POSITION)},e.rotate=function(t,e){var n=e||vy.LOCAL;if(zn.normalize(NA,t),n===vy.LOCAL)zn.multiply(this._lrot,this._lrot,NA);else if(n===vy.WORLD){var i=this.worldRotation;zn.multiply(MA,NA,i),zn.invert(NA,i),zn.multiply(MA,NA,MA),zn.multiply(this._lrot,this._lrot,MA)}this._eulerDirty=!0,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)},e.lookAt=function(t,e){this.getWorldPosition(OA),Dn.subtract(OA,OA,t),Dn.normalize(OA,OA),zn.fromViewUp(NA,OA,e),this.setWorldRotation(NA)},e._setDirtyNode=function(t,e){UA[t]=e},e.invalidateChildren=function(t){var e,n,i,r=0,a=0,o=0,s=0,c=0,l=t|yy.POSITION;for(UA[0]=this;r>=0;){if(c=(e=UA[r--])._hasChangedFlags[0],s=e._dirtyFlagsPri,e.isValid&&(s&c&t)!==t)for(s|=t,e._dirtyFlagsPri=s,e._hasChangedFlags[0]=c|t,o=(i=e._children).length,a=0;a<o;a++)n=i[a],UA[++r]=n;t=l}},e.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,n=0;e&&e._dirtyFlags;)this._setDirtyNode(n++,e),e=e._parent;for(var i=0;n;)i|=(t=UA[--n])._dirtyFlags,e?(i&yy.POSITION&&(Dn.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&yy.RS&&(Xn.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Xn.multiply(t._mat,e._mat,t._mat),i&yy.ROTATION&&zn.multiply(t._rot,e._rot,t._lrot),Ln.fromQuat(FA,zn.conjugate(LA,t._rot)),Ln.multiplyMat4(FA,FA,t._mat),t._scale.x=FA.m00,t._scale.y=FA.m04,t._scale.z=FA.m08)):(i&yy.POSITION&&(Dn.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&yy.RS&&(i&yy.ROTATION&&zn.copy(t._rot,t._lrot),i&yy.SCALE&&(Dn.copy(t._scale,t._lscale),Xn.fromRTS(t._mat,t._rot,t._pos,t._scale)))),t._dirtyFlags=yy.NONE,e=t}},e.setPosition=function(t,e,n){void 0===e&&void 0===n?Dn.copy(this._lpos,t):void 0===n?Dn.set(this._lpos,t,e,this._lpos.z):Dn.set(this._lpos,t,e,n),this.invalidateChildren(yy.POSITION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.POSITION)},e.getPosition=function(t){return t?Dn.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Dn.copy(new Dn,this._lpos)},e.setRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?zn.copy(this._lrot,t):zn.set(this._lrot,t,e,n,i),this._eulerDirty=!0,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)},e.setRotationFromEuler=function(t,e,n){var i=void 0===n?this._euler.z:n;void 0===e?(Dn.copy(this._euler,t),zn.fromEuler(this._lrot,t.x,t.y,t.z)):(Dn.set(this._euler,t,e,i),zn.fromEuler(this._lrot,t,e,i)),this._eulerDirty=!1,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)},e.getRotation=function(t){return t?zn.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):zn.copy(new zn,this._lrot)},e.setScale=function(t,e,n){void 0===e&&void 0===n?Dn.copy(this._lscale,t):void 0===n?Dn.set(this._lscale,t,e,this._lscale.z):Dn.set(this._lscale,t,e,n),this.invalidateChildren(yy.SCALE),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.SCALE)},e.getScale=function(t){return t?Dn.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Dn.copy(new Dn,this._lscale)},e.inverseTransformPoint=function(t,e){Dn.copy(t,e);for(var n=this,i=0;n._parent;)this._setDirtyNode(i++,n),n=n._parent;for(;i>=0;)Dn.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=UA[--i];return t},e.setWorldPosition=function(t,e,n){void 0===e||void 0===n?Dn.copy(this._pos,t):Dn.set(this._pos,t,e,n);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Dn.transformMat4(r,this._pos,Xn.invert(zA,i._mat))):Dn.copy(r,this._pos),this.invalidateChildren(yy.POSITION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.POSITION)},e.getWorldPosition=function(t){return this.updateWorldTransform(),t?Dn.copy(t,this._pos):Dn.copy(new Dn,this._pos)},e.setWorldRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?zn.copy(this._rot,t):zn.set(this._rot,t,e,n,i),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)},e.setWorldRotationFromEuler=function(t,e,n){zn.fromEuler(this._rot,t,e,n),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)},e.getWorldRotation=function(t){return this.updateWorldTransform(),t?zn.copy(t,this._rot):zn.copy(new zn,this._rot)},e.setWorldScale=function(t,e,n){void 0===e||void 0===n?Dn.copy(this._scale,t):Dn.set(this._scale,t,e,n);var i=this._parent;i?(i.updateWorldTransform(),Ln.fromQuat(FA,zn.conjugate(LA,i._rot)),Ln.multiplyMat4(FA,FA,i._mat),BA.m00=this._scale.x,BA.m04=this._scale.y,BA.m08=this._scale.z,Ln.multiply(FA,BA,Ln.invert(FA,FA)),this._lscale.x=Dn.set(OA,FA.m00,FA.m01,FA.m02).length(),this._lscale.y=Dn.set(OA,FA.m03,FA.m04,FA.m05).length(),this._lscale.z=Dn.set(OA,FA.m06,FA.m07,FA.m08).length()):Dn.copy(this._lscale,this._scale),this.invalidateChildren(yy.SCALE),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.SCALE)},e.getWorldScale=function(t){return this.updateWorldTransform(),t?Dn.copy(t,this._scale):Dn.copy(new Dn,this._scale)},e.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.copy(e,this._mat)},e.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},e.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.fromRT(e,this._rot,this._pos)},e.setRTS=function(t,e,n){var i=0;t&&(i|=yy.ROTATION,void 0!==t.w?(zn.copy(this._lrot,t),this._eulerDirty=!0):(Dn.copy(this._euler,t),zn.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(Dn.copy(this._lpos,e),i|=yy.POSITION),n&&(Dn.copy(this._lscale,n),i|=yy.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,i))},e.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},e.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},n.resetHasChangedFlags=function(){rb.clear()},n.clearNodeArray=function(){n.ClearFrame<n.ClearRound?n.ClearFrame++:(n.ClearFrame=0,UA.length=0,kA.length=0)},e.getPathInHierarchy=function(){for(var t=this.name,e=this.parent;e&&e instanceof n;)t=e.name+"/"+t,e=e.parent;return t},Q(n,[{key:"_dirtyFlags",get:function(){return this._dirtyFlagsPri},set:function(t){this._dirtyFlagsPri=t}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(zn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this._euler.z},set:function(t){Dn.set(this._euler,0,0,t),zn.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(yy.ROTATION),1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Xn.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(yy.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(rA.TRANSFORM_CHANGED,yy.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Dn.transformQuat(new Dn,Dn.FORWARD,this.worldRotation)},set:function(t){var e=t.length();Dn.multiplyScalar(OA,t,-1/e),zn.fromViewUp(NA,OA),this.setWorldRotation(NA)}},{key:"up",get:function(){return Dn.transformQuat(new Dn,Dn.UP,this.worldRotation)}},{key:"right",get:function(){return Dn.transformQuat(new Dn,Dn.RIGHT,this.worldRotation)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(rA.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]},set:function(t){this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]=t}}]),n}(DA),PA.EventType=rA,PA.NodeSpace=vy,PA.TransformDirtyBit=yy,PA.TransformBit=yy,PA.reserveContentsForAllSyncablePrefabTag=ab,PA.ClearFrame=0,PA.ClearRound=1e3,AA=ct((EA=RA).prototype,"_lpos",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn}}),CA=ct(EA.prototype,"_lrot",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn}}),bA=ct(EA.prototype,"_lscale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(1,1,1)}}),wA=ct(EA.prototype,"_layer",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cd.Enum.DEFAULT}}),IA=ct(EA.prototype,"_euler",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn}}),ct(EA.prototype,"eulerAngles",[TA],Object.getOwnPropertyDescriptor(EA.prototype,"eulerAngles"),EA.prototype),ct(EA.prototype,"angle",[Vc],Object.getOwnPropertyDescriptor(EA.prototype,"angle"),EA.prototype),ct(EA.prototype,"layer",[Vc],Object.getOwnPropertyDescriptor(EA.prototype,"layer"),EA.prototype),xA=EA))||xA));l.Node=ob;var sb=Ec("cc.TargetInfo")((jA=ct((WA=function(){st(this,"localID",jA,this)}).prototype,"localID",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HA=WA))||HA,cb=(XA=Ec("cc.TargetOverrideInfo"),qA=al(_l),YA=al(sb),KA=al(ob),QA=al(sb),XA(($A=ct((ZA=function(){st(this,"source",$A,this),st(this,"sourceInfo",tC,this),st(this,"propertyPath",eC,this),st(this,"target",nC,this),st(this,"targetInfo",iC,this)}).prototype,"source",[Dc,qA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tC=ct(ZA.prototype,"sourceInfo",[Dc,YA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=ct(ZA.prototype,"propertyPath",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nC=ct(ZA.prototype,"target",[Dc,KA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iC=ct(ZA.prototype,"targetInfo",[Dc,QA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JA=ZA))||JA),lb=Ec("cc.CompPrefabInfo")((oC=ct((aC=function(){st(this,"fileId",oC,this)}).prototype,"fileId",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rC=aC))||rC,ub=(sC=Ec("CCPropertyOverrideInfo"),cC=al(sb),sC((dC=function(){function t(){st(this,"targetInfo",hC,this),st(this,"propertyPath",fC,this),st(this,"value",_C,this)}return t.prototype.isTarget=function(){},t}(),hC=ct((uC=dC).prototype,"targetInfo",[Dc,cC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fC=ct(uC.prototype,"propertyPath",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_C=ct(uC.prototype,"value",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lC=uC))||lC),hb=(pC=Ec("cc.MountedChildrenInfo"),mC=al(sb),gC=al([ob]),pC((xC=function(){function t(){st(this,"targetInfo",SC,this),st(this,"nodes",TC,this)}return t.prototype.isTarget=function(){},t}(),SC=ct((yC=xC).prototype,"targetInfo",[Dc,mC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TC=ct(yC.prototype,"nodes",[Dc,gC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vC=yC))||vC),fb=(EC=Ec("cc.MountedComponentsInfo"),AC=al(sb),CC=al([Zu]),EC((RC=function(){function t(){st(this,"targetInfo",IC,this),st(this,"components",PC,this)}return t.prototype.isTarget=function(){},t}(),IC=ct((wC=RC).prototype,"targetInfo",[Dc,AC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PC=ct(wC.prototype,"components",[Dc,CC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bC=wC))||bC),_b=(DC=Ec("cc.PrefabInstance"),OC=al(ob),NC=al([hb]),MC=al([fb]),LC=al([ub]),FC=al([sb]),DC((jC=function(){function t(){st(this,"fileId",UC,this),st(this,"prefabRootNode",kC,this),st(this,"mountedChildren",GC,this),st(this,"mountedComponents",VC,this),st(this,"propertyOverrides",HC,this),st(this,"removedComponents",WC,this),this.targetMap={}}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),UC=ct((zC=jC).prototype,"fileId",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),kC=ct(zC.prototype,"prefabRootNode",[Dc,OC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GC=ct(zC.prototype,"mountedChildren",[Dc,NC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VC=ct(zC.prototype,"mountedComponents",[Dc,MC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HC=ct(zC.prototype,"propertyOverrides",[Dc,LC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),WC=ct(zC.prototype,"removedComponents",[Dc,FC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BC=zC))||BC),db=(XC=Ec("cc.PrefabInfo"),qC=al(ob),YC=al(_b),KC=al([cb]),XC((ZC=ct((JC=function(){st(this,"root",ZC,this),st(this,"asset",$C,this),st(this,"fileId",tb,this),st(this,"instance",eb,this),st(this,"targetOverrides",nb,this),st(this,"nestedPrefabInstanceRoots",ib,this)}).prototype,"root",[Dc,qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$C=ct(JC.prototype,"asset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=ct(JC.prototype,"fileId",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eb=ct(JC.prototype,"instance",[Dc,YC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nb=ct(JC.prototype,"targetOverrides",[Dc,KC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ib=ct(JC.prototype,"nestedPrefabInstanceRoots",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QC=JC))||QC);function pb(t){var e=t._prefab;if(e&&e.instance){if(!e.asset)return O(3701,t.name),void(e.instance=void 0);var n=t._objFlags,i=t._parent,r=t._id,a=t._prefab;t[cl],l.game._isCloning=!0,e.asset._doInstantiate(t),l.game._isCloning=!1,t._objFlags=n,t._parent=i,t._id=r,t._prefab&&(t._prefab.instance=null==a?void 0:a.instance)}}function mb(t,e,n){var i;if(e&&t){var r=e,a=null===(i=t._prefab)||void 0===i?void 0:i.instance;!n&&a&&(e[a.fileId]={},r=e[a.fileId]);var o=t._prefab;o&&(r[o.fileId]=t);for(var s=t.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<t.children.length;u++)mb(t.children[u],r,!1)}}function gb(t,e){if(!t)return null;for(var n=e,i=0;i<t.length;i++){if(!n)return null;n=n[t[i]]}return n}function vb(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=gb(r.targetInfo.localID,n);if(!a)continue;var o=n,s=r.targetInfo.localID;if(s.length>0)for(var c=0;c<s.length-1;c++)o=o[s[c]];if(r.nodes)for(var l=0;l<r.nodes.length;l++){var u=r.nodes[l];u&&!a._children.includes(u)&&(a._children.push(u),u._parent=a,mb(u,o,!1),u._siblingIndex=a._children.length-1,Eb(u,!0))}}}}function yb(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=gb(r.targetInfo.localID,n);if(!a)continue;if(r.components)for(var o=0;o<r.components.length;o++){var s=r.components[o];s&&(s.node=a,a._components.push(s))}}}}function Sb(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=gb(r.localID,n);if(!a||!a.node)continue;var o=a.node.components.indexOf(a);o>=0&&a.node._components.splice(o,1)}}}function Tb(t,e,n){if(!(e.length<=0))for(var i=null,r=0;r<e.length;r++){var a=e[r];if(a&&a.targetInfo){if(!(i=gb(a.targetInfo.localID,n)))continue;var o=i,s=a.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(o=o[s[l]]);l++);if(!o)continue;if(Array.isArray(o))if("length"===c)o[c]=a.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<o.length&&(o[c]=a.value)}else o[c]instanceof ue?o[c].set(a.value):o[c]=a.value}}}}function xb(t){var e,n=null===(e=t._prefab)||void 0===e?void 0:e.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,a,o=n[i],s=o.source,c=o.sourceInfo;if(c){var l,u,h=null===(l=o.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;h&&h.targetMap&&(s=gb(c.localID,h.targetMap))}if(s){var f,_=o.targetInfo;if(_){var d=null===(r=o.target)||void 0===r||null===(a=r._prefab)||void 0===a?void 0:a.instance;if(d&&d.targetMap&&(f=gb(_.localID,d.targetMap))){var p=o.propertyPath.slice(),m=s;if(p.length>0){var g=p.pop();if(!g)return;for(var v=0;v<p.length&&(m=m[p[v]]);v++);if(!m)continue;m[g]=f}}}}}}function Eb(t,e){void 0===e&&(e=!1);var n=t._prefab,i=null==n?void 0:n.instance;if(i){pb(t);var r={};i.targetMap=r,mb(t,r,!0),vb(0,i.mountedChildren,r),Sb(0,i.removedComponents,r),yb(0,i.mountedComponents,r),Tb(0,i.propertyOverrides,r)}e&&t&&t.children&&t.children.forEach((function(t){Eb(t,!0)}))}function Ab(t){var e=t._prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((function(t){Eb(t)}))}l._PrefabInfo=db;var Cb,bb,wb,Ib,Pb,Rb,Db,Ob,Nb,Mb,Lb,Fb,Bb,zb,Ub=Object.freeze({__proto__:null,TargetInfo:sb,TargetOverrideInfo:cb,CompPrefabInfo:lb,PropertyOverrideInfo:ub,MountedChildrenInfo:hb,MountedComponentsInfo:fb,PrefabInstance:_b,PrefabInfo:db,createNodeWithPrefab:pb,generateTargetMap:mb,getTarget:gb,applyMountedChildren:vb,applyMountedComponents:yb,applyRemovedComponents:Sb,applyPropertyOverrides:Tb,applyTargetOverrides:xb,expandPrefabInstanceNode:Eb,expandNestedPrefabInstanceNode:Ab}),kb=oe({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Gb=t("Prefab",Ec("cc.Prefab")((Db=Rb=function(t){function e(){var e;return st(e=t.call(this)||this,"data",wb,rt(e)),st(e,"optimizationPolicy",Ib,rt(e)),st(e,"persistent",Pb,rt(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}Z(e,t);var n=e.prototype;return n.createNode=function(t){var e=l.instantiate(this);e.name=this.name,t(null,e)},n.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof l._BaseNode&&t,new nA(t,e).result)},n._doInstantiate=function(t){return this.data._prefab||R(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},n._instantiate=function(){var t;return this.optimizationPolicy!==kb.SINGLE_INSTANCE&&(this.optimizationPolicy===kb.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this._instantiatedTimes,t},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.data=new ob,this.data.name="(Missing Node)";var n=new l._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;Ab(t),xb(t)},e}(Du),Rb.OptimizationPolicy=kb,Rb.OptimizationPolicyThreshold=3,wb=ct((bb=Db).prototype,"data",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ib=ct(bb.prototype,"optimizationPolicy",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kb.AUTO}}),Pb=ct(bb.prototype,"persistent",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Cb=bb))||Cb);ie.value(Gb,"_utils",Ub),l.Prefab=Gb,Rt(l,"cc._Prefab","Prefab"),t("PrefabLink",(Ob=Ec("cc.PrefabLink"),Nb=al(Gb),Mb=Hc(),Ob((zb=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"prefab",Bb,rt(e)),e}return Z(e,t),e}(Zu),Bb=ct((Fb=zb).prototype,"prefab",[Nb,Dc,Mb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lb=Fb))||Lb));var Vb=new Dn;function Hb(t,e,n,i){i||(i=new Dn),t.convertToUINode(e,n,i);var r=n.position;return i.add(r),i}function Wb(t,e,n){return n||(n=new Dn),t.worldToScreen(e,n),n.x/=l.view.getScaleX(),n.y/=l.view.getScaleY(),n}var jb,Xb,qb=t("convertUtils",{WorldNode3DToLocalNodeUI:Hb,WorldNode3DToWorldNodeUI:Wb});l.pipelineUtils=qb,U(l.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=e[3]||Vb;return i.convertToUINode(e[1],e[2],r),r.add(e[2].position),e[3]||r.clone()}}]),k(Hm.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),U(Lx.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var Yb,Kb=t("BufferAsset",Ec("cc.BufferAsset")((ct((Xb=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._buffer=null,e}Z(e,t);var n=e.prototype;return n.buffer=function(){return this._buffer},n.validate=function(){return!!this.buffer},Q(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(Du)).prototype,"_nativeAsset",[sl],Object.getOwnPropertyDescriptor(Xb.prototype,"_nativeAsset"),Xb.prototype),jb=Xb))||jb);l.BufferAsset=Kb;var Qb=((Yb={})[mi.UNORM]="Uint",Yb[mi.SNORM]="Int",Yb[mi.UINT]="Uint",Yb[mi.INT]="Int",Yb[mi.UFLOAT]="Float",Yb[mi.FLOAT]="Float",Yb.default="Uint",Yb);function Jb(t){return""+(Qb[t.type]||Qb.default)+t.size/t.count*8}function Zb(t,e,n,i,r){void 0===n&&(n=pi.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var a=na[n];r||(r=a.size);for(var o="set"+Jb(a),s=a.size/a.count,c=Math.floor(e.length/a.count),l=ch.isLittleEndian,u=0;u<c;++u)for(var h=i+r*u,f=0;f<a.count;++f){var _=h+s*f;t[o](_,e[a.count*u+f],l)}}function $b(t,e,n,i,r,a){void 0===e&&(e=pi.R32F),void 0===n&&(n=0),void 0===i&&(i=t.byteLength-n),void 0===r&&(r=0),void 0===a&&(a=[]);var o=na[e];r||(r=o.size);for(var s="get"+Jb(o),c=o.size/o.count,l=Math.floor(i/r),u=ch.isLittleEndian,h=0;h<l;++h)for(var f=n+r*h,_=0;_<o.count;++_){var d=f+c*_;a[o.count*h+_]=t[s](d,u)}return a}function tw(t,e,n,i,r,a,o){void 0===n&&(n=pi.R32F),void 0===i&&(i=0),void 0===r&&(r=t.byteLength-i),void 0===a&&(a=0),o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var s=na[n];a||(a=s.size);for(var c="set"+Jb(s),l="get"+Jb(s),u=s.size/s.count,h=Math.floor(r/a),f=ch.isLittleEndian,_=0;_<h;++_)for(var d=i+a*_,p=0;p<s.count;++p){var m=d+u*p,g=t[l](m,f);o[c](m,e(g,p,t),f)}return o}var ew,nw,iw=t("RenderingSubMesh",function(){var t=e.prototype;function e(t,e,n,i,r,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!0),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._isOwnerOfIndexBuffer=!0,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new Mr(e,t,i,r),this._isOwnerOfIndexBuffer=a,this._init()}return t._init=function(){},t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(e=n.indexView.count);for(var i=0;i<n.vertexBundelIndices.length;i++){var r=n.vertexBundelIndices[i],a=t.struct.vertexBundles[r],o=n.indexView?n.indexView.count:a.view.count,s=a.view.stride,c=s*o,l=new Uint8Array(t.data.buffer,a.view.offset,a.view.length),u=new Uint8Array(n.indexView?c:a.view.length);if(n.indexView){for(var h=t.readIndices(this.subMeshIdx),f=0;f<e;++f)for(var _=f*s,d=h[f]*s,p=0;p<s;++p)u[_+p]=l[d+p];this._flatBuffers.push({stride:s,count:o,buffer:u})}else u.set(t.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:s,count:o,buffer:u})}}},t.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._isOwnerOfIndexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},t.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(t);this._vertexBuffers.push(i),this._attributes.push(new Or("a_vertexId",pi.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:n}}},t._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(e),i=0;i<e;++i)n[i]=i+.5;var r=t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},Q(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Dn.ZERO,max:Dn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Dn.ZERO,max:Dn.ZERO}};var t=this.mesh,e=this.subMeshIdx,n=t.readAttribute(e,$i.ATTR_POSITION),i=t.readIndices(e),r=new Dn,a=new Dn,o=this.attributes.find((function(t){return t.name===$i.ATTR_POSITION}));if(o){var s=na[o.format].count;2===s?(r.set(n[0],n[1],0),a.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),a.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y,a.z=n[c+2]<a.z?n[c+2]:a.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:a}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,r,a=this.mesh.struct,o=a.primitives[this.subMeshIdx];if(!a.jointMaps||void 0===o.jointMapIndex||!a.jointMaps[o.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=l.director.root.device,c=0;c<o.vertexBundelIndices.length;c++){var u=a.vertexBundles[o.vertexBundelIndices[c]];r=0,i=pi.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var f=u.attributes[h];if(f.name===$i.ATTR_JOINTS){i=f.format;break}r+=na[f.format].size}i?function(){var l=new Uint8Array(t.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(l.slice().buffer),f=a.jointMaps[o.jointMapIndex];tw(h,(function(t){return f.indexOf(t)}),i,r,u.view.length,u.view.stride,h);var _=s.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,u.view.length,u.view.stride));_.update(h.buffer),e.push(_),n.push(c)}():e.push(this.vertexBuffers[o.vertexBundelIndices[c]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(s)),e}},{key:"iaInfo",get:function(){return this._iaInfo}}]),e}());!function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed"}(ew||(ew=t("SystemEventType",{}))),function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.KEY_DOWN="keydown",t.KEY_PRESSING="key-pressing",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion"}(nw||(nw={})),l.SystemEventType=ew;var rw,aw=new Array(16),ow=null,sw=new Qn,cw=[rA.TOUCH_START,rA.TOUCH_MOVE,rA.TOUCH_END,rA.TOUCH_CANCEL],lw=[rA.MOUSE_DOWN,rA.MOUSE_ENTER,rA.MOUSE_MOVE,rA.MOUSE_LEAVE,rA.MOUSE_UP,rA.MOUSE_WHEEL];!function(t){t[t.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",t[t.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",t[t.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(rw||(rw={}));var uw,hw,fw,_w,dw,pw,mw,gw,vw,yw,Sw,Tw,xw,Ew,Aw,Cw,bw,ww,Iw,Pw,Rw,Dw,Ow,Nw,Mw,Lw,Fw,Bw,zw,Uw,kw,Gw,Vw,Hw,Ww,jw,Xw,qw,Yw,Kw,Qw,Jw,Zw,$w,tI,eI,nI,iI,rI,aI,oI,sI,cI,lI,uI,hI,fI,_I,dI,pI,mI,gI,vI,yI,SI,TI,xI,EI,AI,CI,bI,wI,II,PI,RI,DI,OI,NI,MI,LI,FI,BI,zI,UI,kI,GI,VI,HI,WI,jI,XI,qI,YI,KI,QI,JI,ZI,$I,tP,eP,nP,iP,rP,aP,oP,sP,cP,lP,uP,hP,fP,_P,dP,pP,mP,gP,vP,yP,SP,TP,xP,EP,AP,CP,bP,wP,IP,PP,RP,DP,OP,NP,MP,LP,FP,BP,zP,UP,kP,GP,VP,HP,WP,jP,XP=function(){var t=e.prototype;function e(t){this._isEnabled=!1,this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._node=void 0,this._node=t}return t.setEnabled=function(t,n){if(void 0===n&&(n=!1),this._isEnabled!==t){this._isEnabled=t;var i=this.node.children;if(t&&this._attachMask(),e.callbacksInvoker.emit(rw.MARK_LIST_DIRTY),n&&i.length>0)for(var r=0;r<i.length;++r)i[r]._eventProcessor.setEnabled(t,!0)}},t._searchComponentsInParent=function(t){var e=this.node;if(t){for(var n=0,i=[],r=e;r&&ob.isNode(r);r=r.parent,++n){var a=r.getComponent(t);if(a){var o={index:n,comp:a};i?i.push(o):i=[o]}}return i.length>0?i:null}return null},t._attachMask=function(){this.maskList=this._searchComponentsInParent(e._maskComp)},t.reattach=function(){var t,n=this;this.node.walk((function(i){t||(t=n._searchComponentsInParent(e._maskComp)),i.eventProcessor.maskList=t}))},t.destroy=function(){ow===this._node&&(ow=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),e.callbacksInvoker.emit(rw.REMOVE_POINTER_EVENT_PROCESSOR,this)},t._isTouchEvent=function(t){return-1!==cw.indexOf(t)},t._isMouseEvent=function(t){return-1!==lw.indexOf(t)},t._hasTouchListeners=function(){for(var t=0;t<cw.length;++t){var e=cw[t];if(this.hasEventListener(e))return!0}return!1},t._hasMouseListeners=function(){for(var t=0;t<lw.length;++t){var e=lw[t];if(this.hasEventListener(e))return!0}return!1},t._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},t._tryEmittingAddEvent=function(t){var n=this._isTouchEvent(t),i=this._isMouseEvent(t);n?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!n&&!i||this._hasPointerListeners()||e.callbacksInvoker.emit(rw.ADD_POINTER_EVENT_PROCESSOR,this)},t._newCallbacksInvoker=function(){var t=this,n=new Zl;return n._registerOffCallback((function(){t.shouldHandleEventTouch&&!t._hasTouchListeners()&&(t.shouldHandleEventTouch=!1),t.shouldHandleEventMouse&&!t._hasMouseListeners()&&(t.shouldHandleEventMouse=!1),t._hasPointerListeners()||e.callbacksInvoker.emit(rw.REMOVE_POINTER_EVENT_PROCESSOR,t)})),n},t.on=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n),e},t.once=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n,!0),e},t.off=function(t,e,n,i){var r;null===(r=(i=!!i)?this.capturingTarget:this.bubblingTarget)||void 0===r||r.off(t,e,n)},t.targetOff=function(t){var n,i;null===(n=this.capturingTarget)||void 0===n||n.removeAll(t),null===(i=this.bubblingTarget)||void 0===i||i.removeAll(t),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||e.callbacksInvoker.emit(rw.REMOVE_POINTER_EVENT_PROCESSOR,this)},t.emit=function(t,e,n,i,r,a){var o;null===(o=this.bubblingTarget)||void 0===o||o.emit(t,e,n,i,r,a)},t.dispatchEvent=function(t){var e,n=this.node,i=0;for(t.target=n,aw.length=0,this.getCapturingTargets(t.type,aw),t.eventPhase=1,i=aw.length-1;i>=0;--i)if((e=aw[i]).eventProcessor.capturingTarget&&(t.currentTarget=e,e.eventProcessor.capturingTarget.emit(t.type,t,aw),t.propagationStopped))return void(aw.length=0);if(aw.length=0,t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(this.getBubblingTargets(t.type,aw),t.eventPhase=3,i=0;i<aw.length;++i)if((e=aw[i]).eventProcessor.bubblingTarget&&(t.currentTarget=e,e.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void(aw.length=0);aw.length=0},t.hasEventListener=function(t,e,n){var i=!1;return this.bubblingTarget&&(i=this.bubblingTarget.hasEventListener(t,e,n)),!i&&this.capturingTarget&&(i=this.capturingTarget.hasEventListener(t,e,n)),i},t.getCapturingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.capturingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},t.getBubblingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.bubblingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},t._handleEventMouse=function(t){switch(t.type){case nw.MOUSE_DOWN:return this._handleMouseDown(t);case nw.MOUSE_MOVE:return this._handleMouseMove(t);case nw.MOUSE_UP:return this._handleMouseUp(t);case nw.MOUSE_WHEEL:return this._handleMouseWheel(t);default:return!1}},t._handleMouseDown=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(sw),!e._uiProps.uiTransformComp.hitTest(sw)||(t.type=rA.MOUSE_DOWN,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleMouseMove=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(sw),e._uiProps.uiTransformComp.hitTest(sw)?(this.previousMouseIn||(ow&&ow!==e&&(t.type=rA.MOUSE_LEAVE,ow.dispatchEvent(t),ow.eventProcessor.previousMouseIn=!1),ow=e,t.type=rA.MOUSE_ENTER,e.dispatchEvent(t),this.previousMouseIn=!0),t.type=rA.MOUSE_MOVE,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type=rA.MOUSE_LEAVE,e.dispatchEvent(t),this.previousMouseIn=!1,ow=null),1)))},t._handleMouseUp=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(sw),!e._uiProps.uiTransformComp.hitTest(sw)||(t.type=rA.MOUSE_UP,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleMouseWheel=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(sw),!e._uiProps.uiTransformComp.hitTest(sw)||(t.type=rA.MOUSE_WHEEL,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleEventTouch=function(t){switch(t.type){case nw.TOUCH_START:return this._handleTouchStart(t);case nw.TOUCH_MOVE:return this._handleTouchMove(t);case nw.TOUCH_END:return this._handleTouchEnd(t);case nw.TOUCH_CANCEL:return this._handleTouchCancel(t);default:return!1}},t._handleTouchStart=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(sw),!e._uiProps.uiTransformComp.hitTest(sw)||(t.type=rA.TOUCH_START,t.bubbles=!0,e.dispatchEvent(t),0)))},t._handleTouchMove=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.type=rA.TOUCH_MOVE,t.bubbles=!0,e.dispatchEvent(t),0))},t._handleTouchEnd=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.getLocation(sw),e._uiProps.uiTransformComp.hitTest(sw)?t.type=rA.TOUCH_END:t.type=rA.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},t._handleTouchCancel=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.type=rA.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},Q(e,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),e}();XP._maskComp=null,XP.callbacksInvoker=new Zl,l.NodeEventProcessor=XP;var qP=new Dn(0,1,0),YP=new Dn,KP=new ti,QP=new Pn,JP=new zn,ZP=function(t){var e=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);e<1&&(t.x*=e,t.y*=e,t.z*=e)},$P=t("AmbientInfo",(uw=Ec("cc.AmbientInfo"),hw=Oc("_skyColor"),fw=Oc("_skyIllum"),_w=Oc("_groundAlbedo"),dw=Hc(),pw=Xc(),mw=al(Me),gw=Xc(),vw=Hc(),yw=Xc(),uw((Iw=function(){function t(){st(this,"_skyColorHDR",xw,this),st(this,"_skyIllumHDR",Ew,this),st(this,"_groundAlbedoHDR",Aw,this),st(this,"_skyColorLDR",Cw,this),st(this,"_skyIllumLDR",bw,this),st(this,"_groundAlbedoLDR",ww,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},Q(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=l.director.root.pipeline.pipelineSceneData.isHDR;return KP.set(t?this._skyColorHDR:this._skyColorLDR),ZP(KP),QP.set(255*KP.x,255*KP.y,255*KP.z,255)},set:function(t){KP.set(t.x,t.y,t.z,t.w),l.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(KP):this._skyColorLDR.set(KP),this._resource&&this._resource.skyColor.set(KP)}},{key:"skyColor",set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=l.director.root.pipeline.pipelineSceneData.isHDR;return KP.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),ZP(KP),QP.set(255*KP.x,255*KP.y,255*KP.z,255)},set:function(t){KP.set(t.x,t.y,t.z,t.w),l.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(KP):this._groundAlbedoLDR.set(KP),this._resource&&this._resource.groundAlbedo.set(KP)}},{key:"groundAlbedo",set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),xw=ct((Tw=Iw).prototype,"_skyColorHDR",[Dc,hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti(.2,.5,.8,1)}}),Ew=ct(Tw.prototype,"_skyIllumHDR",[Dc,fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sy.SKY_ILLUM}}),Aw=ct(Tw.prototype,"_groundAlbedoHDR",[Dc,_w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti(.2,.2,.2,1)}}),Cw=ct(Tw.prototype,"_skyColorLDR",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti(.2,.5,.8,1)}}),bw=ct(Tw.prototype,"_skyIllumLDR",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sy.SKY_ILLUM}}),ww=ct(Tw.prototype,"_groundAlbedoLDR",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti(.2,.2,.2,1)}}),ct(Tw.prototype,"skyLightingColor",[dw,Vc,pw],Object.getOwnPropertyDescriptor(Tw.prototype,"skyLightingColor"),Tw.prototype),ct(Tw.prototype,"skyIllum",[Vc,mw,gw],Object.getOwnPropertyDescriptor(Tw.prototype,"skyIllum"),Tw.prototype),ct(Tw.prototype,"groundLightingColor",[vw,Vc,yw],Object.getOwnPropertyDescriptor(Tw.prototype,"groundLightingColor"),Tw.prototype),Sw=Tw))||Sw));l.AmbientInfo=$P;var tR=t("SkyboxInfo",(Pw=Ec("cc.SkyboxInfo"),Rw=al(pg),Dw=Oc("_envmap"),Ow=al(pg),Nw=al(pg),Mw=al(pg),Lw=Xc(),Fw=al(fy),Bw=Xc(),zw=Xc(),Uw=al(pg),kw=Xc(),Gw=Hc(),Vw=al(pg),Hw=Zc(),Pw(($w=function(){function t(){st(this,"_envLightingType",Xw,this),st(this,"_envmapHDR",qw,this),st(this,"_envmapLDR",Yw,this),st(this,"_diffuseMapHDR",Kw,this),st(this,"_diffuseMapLDR",Qw,this),st(this,"_enabled",Jw,this),st(this,"_useHDR",Zw,this),this._resource=null}return t.prototype.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.activate()},Q(t,[{key:"applyDiffuseMap",get:function(){return fy.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||fy.HEMISPHERE_DIFFUSE===t?(fy.HEMISPHERE_DIFFUSE===t?(this.useIBL=!1,this.applyDiffuseMap=!1):fy.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===t?(this.useIBL=!0,this.applyDiffuseMap=!1):fy.DIFFUSEMAP_WITH_REFLECTION===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=fy.HEMISPHERE_DIFFUSE,R(15001))}},{key:"useIBL",get:function(){return fy.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR=t,this._useHDR=t,this._resource&&(this.envmap=this._resource.envmap,this.diffuseMap=this._resource.diffuseMap,this.envLightingType===fy.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=fy.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,R(15e3)):this.diffuseMap.isDefault&&R(15002))),this._resource&&(this._resource.useHDR=this._useHDR)}},{key:"envmap",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var e=l.director.root.pipeline.pipelineSceneData.isHDR;e?this._envmapHDR=t:this._envmapLDR=t,t||(e?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=fy.HEMISPHERE_DIFFUSE,R(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=t)}},{key:"diffuseMap",get:function(){return l.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){l.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}}]),t}(),Xw=ct((jw=$w).prototype,"_envLightingType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fy.HEMISPHERE_DIFFUSE}}),qw=ct(jw.prototype,"_envmapHDR",[Dc,Rw,Dw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yw=ct(jw.prototype,"_envmapLDR",[Dc,Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kw=ct(jw.prototype,"_diffuseMapHDR",[Dc,Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qw=ct(jw.prototype,"_diffuseMapLDR",[Dc,Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jw=ct(jw.prototype,"_enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zw=ct(jw.prototype,"_useHDR",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct(jw.prototype,"enabled",[Vc,Lw],Object.getOwnPropertyDescriptor(jw.prototype,"enabled"),jw.prototype),ct(jw.prototype,"envLightingType",[Vc,Fw,Bw],Object.getOwnPropertyDescriptor(jw.prototype,"envLightingType"),jw.prototype),ct(jw.prototype,"useHDR",[Vc,zw],Object.getOwnPropertyDescriptor(jw.prototype,"useHDR"),jw.prototype),ct(jw.prototype,"envmap",[Vc,Uw,kw],Object.getOwnPropertyDescriptor(jw.prototype,"envmap"),jw.prototype),ct(jw.prototype,"diffuseMap",[Gw,Vc,Wc,Vw,Hw],Object.getOwnPropertyDescriptor(jw.prototype,"diffuseMap"),jw.prototype),Ww=jw))||Ww));l.SkyboxInfo=tR;var eR=t("FogInfo",(tI=Ec("cc.FogInfo"),eI=Xc(),nI=Zc(),iI=Xc(),rI=Zc(),aI=Xc(),oI=al(py),sI=Zc(),cI=Xc(),lI=Hc(),uI=al(Me),hI=qc(),fI=Qc(),_I=Xc(),dI=Hc(),pI=al(Me),mI=Qc(),gI=Xc(),vI=Hc(),yI=al(Me),SI=Qc(),TI=Xc(),xI=Hc(),EI=al(Me),AI=Yc(),CI=Qc(),bI=Xc(),wI=Hc(),II=al(Me),PI=Qc(),RI=Xc(),DI=Hc(),OI=al(Me),NI=Qc(),MI=Xc(),tI((YI=qI=function(){function t(){st(this,"_type",BI,this),st(this,"_fogColor",zI,this),st(this,"_enabled",UI,this),st(this,"_fogDensity",kI,this),st(this,"_fogStart",GI,this),st(this,"_fogEnd",VI,this),st(this,"_fogAtten",HI,this),st(this,"_fogTop",WI,this),st(this,"_fogRange",jI,this),st(this,"_accurate",XI,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate!==t&&(this._accurate=t,this._resource&&(this._resource.accurate=t,t&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),qI.FogType=py,BI=ct((FI=YI).prototype,"_type",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return py.LINEAR}}),zI=ct(FI.prototype,"_fogColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn("#C8C8C8")}}),UI=ct(FI.prototype,"_enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kI=ct(FI.prototype,"_fogDensity",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),GI=ct(FI.prototype,"_fogStart",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),VI=ct(FI.prototype,"_fogEnd",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),HI=ct(FI.prototype,"_fogAtten",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),WI=ct(FI.prototype,"_fogTop",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),jI=ct(FI.prototype,"_fogRange",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),XI=ct(FI.prototype,"_accurate",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct(FI.prototype,"enabled",[Vc,eI,nI],Object.getOwnPropertyDescriptor(FI.prototype,"enabled"),FI.prototype),ct(FI.prototype,"accurate",[Vc,iI,rI],Object.getOwnPropertyDescriptor(FI.prototype,"accurate"),FI.prototype),ct(FI.prototype,"fogColor",[Vc,aI],Object.getOwnPropertyDescriptor(FI.prototype,"fogColor"),FI.prototype),ct(FI.prototype,"type",[Vc,oI,sI,cI],Object.getOwnPropertyDescriptor(FI.prototype,"type"),FI.prototype),ct(FI.prototype,"fogDensity",[lI,uI,hI,fI,Jc,_I],Object.getOwnPropertyDescriptor(FI.prototype,"fogDensity"),FI.prototype),ct(FI.prototype,"fogStart",[dI,pI,mI,gI],Object.getOwnPropertyDescriptor(FI.prototype,"fogStart"),FI.prototype),ct(FI.prototype,"fogEnd",[vI,yI,SI,TI],Object.getOwnPropertyDescriptor(FI.prototype,"fogEnd"),FI.prototype),ct(FI.prototype,"fogAtten",[xI,EI,AI,CI,bI],Object.getOwnPropertyDescriptor(FI.prototype,"fogAtten"),FI.prototype),ct(FI.prototype,"fogTop",[wI,II,PI,RI],Object.getOwnPropertyDescriptor(FI.prototype,"fogTop"),FI.prototype),ct(FI.prototype,"fogRange",[DI,OI,NI,MI],Object.getOwnPropertyDescriptor(FI.prototype,"fogRange"),FI.prototype),LI=FI))||LI)),nR=t("ShadowsInfo",(KI=Ec("cc.ShadowsInfo"),QI=Xc(),JI=al(uv),ZI=Hc(),$I=Hc(),tP=Xc(),eP=al(Me),nP=Hc(),iP=Xc(),rP=al(Ne),aP=Xc(),oP=Hc(),sP=al(lv),cP=Xc(),lP=Hc(),KI((yP=function(){function t(){st(this,"_enabled",fP,this),st(this,"_type",_P,this),st(this,"_normal",dP,this),st(this,"_distance",pP,this),st(this,"_shadowColor",mP,this),st(this,"_maxReceived",gP,this),st(this,"_size",vP,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(JP),this.planeDirection=Dn.transformQuat(YP,qP,JP),t.getWorldPosition(YP),this.planeHeight=Dn.dot(this._normal,YP)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){Dn.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=-t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){this._size.set(t,t),this._resource&&(this._resource.size.set(t,t),this._resource.shadowMapDirty=!0)}},{key:"size",get:function(){return this._size}}]),t}(),fP=ct((hP=yP).prototype,"_enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_P=ct(hP.prototype,"_type",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uv.Planar}}),dP=ct(hP.prototype,"_normal",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,1,0)}}),pP=ct(hP.prototype,"_distance",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mP=ct(hP.prototype,"_shadowColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(0,0,0,76)}}),gP=ct(hP.prototype,"_maxReceived",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),vP=ct(hP.prototype,"_size",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(512,512)}}),ct(hP.prototype,"enabled",[Vc,QI],Object.getOwnPropertyDescriptor(hP.prototype,"enabled"),hP.prototype),ct(hP.prototype,"type",[Vc,JI],Object.getOwnPropertyDescriptor(hP.prototype,"type"),hP.prototype),ct(hP.prototype,"shadowColor",[ZI],Object.getOwnPropertyDescriptor(hP.prototype,"shadowColor"),hP.prototype),ct(hP.prototype,"planeDirection",[$I,tP],Object.getOwnPropertyDescriptor(hP.prototype,"planeDirection"),hP.prototype),ct(hP.prototype,"planeHeight",[Vc,eP,nP,iP],Object.getOwnPropertyDescriptor(hP.prototype,"planeHeight"),hP.prototype),ct(hP.prototype,"maxReceived",[rP,aP,oP],Object.getOwnPropertyDescriptor(hP.prototype,"maxReceived"),hP.prototype),ct(hP.prototype,"shadowMapSize",[sP,cP,lP],Object.getOwnPropertyDescriptor(hP.prototype,"shadowMapSize"),hP.prototype),uP=hP))||uP));l.ShadowsInfo=nR;var iR=t("DEFAULT_WORLD_MIN_POS",new Dn(-1024,-1024,-1024)),rR=t("DEFAULT_WORLD_MAX_POS",new Dn(1024,1024,1024)),aR=t("DEFAULT_OCTREE_DEPTH",8),oR=t("OctreeInfo",(SP=Ec("cc.OctreeInfo"),TP=Xc(),xP=Xc(),EP=jc(),AP=Xc(),CP=jc(),bP=qc(),wP=al(Ne),IP=Xc(),SP((LP=function(){function t(){st(this,"_enabled",DP,this),st(this,"_minPos",OP,this),st(this,"_maxPos",NP,this),st(this,"_depth",MP,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),DP=ct((RP=LP).prototype,"_enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OP=ct(RP.prototype,"_minPos",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(iR)}}),NP=ct(RP.prototype,"_maxPos",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(rR)}}),MP=ct(RP.prototype,"_depth",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aR}}),ct(RP.prototype,"enabled",[Vc,TP],Object.getOwnPropertyDescriptor(RP.prototype,"enabled"),RP.prototype),ct(RP.prototype,"minPos",[Vc,xP,EP],Object.getOwnPropertyDescriptor(RP.prototype,"minPos"),RP.prototype),ct(RP.prototype,"maxPos",[Vc,AP,CP],Object.getOwnPropertyDescriptor(RP.prototype,"maxPos"),RP.prototype),ct(RP.prototype,"depth",[Vc,bP,Jc,wP,IP],Object.getOwnPropertyDescriptor(RP.prototype,"depth"),RP.prototype),PP=RP))||PP)),sR=t("SceneGlobals",(FP=Ec("cc.SceneGlobals"),BP=al(tR),FP((jP=function(){function t(){st(this,"ambient",kP,this),st(this,"shadows",GP,this),st(this,"_skybox",VP,this),st(this,"fog",HP,this),st(this,"octree",WP,this)}return t.prototype.activate=function(){var t=l.director.root.pipeline.pipelineSceneData;this.skybox.activate(t.skybox),this.ambient.activate(t.ambient),this.shadows.activate(t.shadows),this.fog.activate(t.fog),this.octree.activate(t.octree)},Q(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),kP=ct((UP=jP).prototype,"ambient",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $P}}),GP=ct(UP.prototype,"shadows",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new nR}}),VP=ct(UP.prototype,"_skybox",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tR}}),HP=ct(UP.prototype,"fog",[Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eR}}),ct(UP.prototype,"skybox",[Vc,BP],Object.getOwnPropertyDescriptor(UP.prototype,"skybox"),UP.prototype),WP=ct(UP.prototype,"octree",[Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oR}}),zP=UP))||zP));l.SceneGlobals=sR;var cR=t("Event",function(){function t(t,e){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}var e=t.prototype;return e.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},e.reuse=function(t,e){this.type=t,this.bubbles=e||!1},e.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},e.getCurrentTarget=function(){return this.currentTarget},e.getType=function(){return this.type},t}());cR.NO_TYPE="no_type",cR.TOUCH="touch",cR.MOUSE="mouse",cR.KEYBOARD="keyboard",cR.ACCELERATION="acceleration",cR.NONE=0,cR.CAPTURING_PHASE=1,cR.AT_TARGET=2,cR.BUBBLING_PHASE=3,l.Event=cR;var lR=t("EventAcceleration",function(t){function e(e,n){var i;return(i=t.call(this,ew.DEVICEMOTION,n)||this).acc=void 0,i.acc=e,i}return Z(e,t),e}(cR));cR.EventAcceleration=lR;var uR=t("EventKeyboard",function(t){function e(e,n,i){var r;return"boolean"==typeof n&&(n=n?ew.KEY_DOWN:ew.KEY_UP),(r=t.call(this,n,i)||this).keyCode=void 0,r.rawEvent=void 0,r._isPressed=void 0,r._isPressed=n!==ew.KEY_UP,"number"==typeof e?r.keyCode=e:(r.keyCode=e.keyCode,r.rawEvent=e),r}return Z(e,t),Q(e,[{key:"isPressed",get:function(){return this._isPressed}}]),e}(cR));cR.EventKeyboard=uR;var hR=t("EventMouse",function(t){function e(n,i,r){var a;return(a=t.call(this,n,i)||this).movementX=0,a.movementY=0,a.preventSwallow=!1,a._eventType=void 0,a._button=e.BUTTON_MISSING,a._x=0,a._y=0,a._prevX=0,a._prevY=0,a._scrollX=0,a._scrollY=0,a._eventType=n,r&&(a._prevX=r.x,a._prevY=r.y),a}Z(e,t);var n=e.prototype;return n.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(t,e){this._x=t,this._y=e},n.getLocation=function(t){return t||(t=new Qn),Qn.set(t,this._x,this._y),t},n.getLocationInView=function(t){return t||(t=new Qn),Qn.set(t,this._x,l.view._designResolutionSize.height-this._y),t},n.getUILocation=function(t){return t||(t=new Qn),Qn.set(t,this._x,this._y),l.view._convertToUISpace(t),t},n.getPreviousLocation=function(t){return t||(t=new Qn),Qn.set(t,this._prevX,this._prevY),t},n.getUIPreviousLocation=function(t){return t||(t=new Qn),Qn.set(t,this._prevX,this._prevY),l.view._convertToUISpace(t),t},n.getDelta=function(t){return t||(t=new Qn),Qn.set(t,this._x-this._prevX,this._y-this._prevY),t},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(t){return t||(t=new Qn),Qn.set(t,(this._x-this._prevX)/l.view.getScaleX(),(this._y-this._prevY)/l.view.getScaleY()),t},n.getUIDeltaX=function(){return(this._x-this._prevX)/l.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/l.view.getScaleY()},n.setButton=function(t){this._button=t},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var t=l.view.getViewportRect();return(this._x-t.x)/l.view.getScaleX()},n.getUILocationY=function(){var t=l.view.getViewportRect();return(this._y-t.y)/l.view.getScaleY()},Q(e,[{key:"eventType",get:function(){return this._eventType}}]),e}(cR));hR.BUTTON_MISSING=-1,hR.BUTTON_LEFT=0,hR.BUTTON_RIGHT=2,hR.BUTTON_MIDDLE=1,hR.BUTTON_4=3,hR.BUTTON_5=4,hR.BUTTON_6=5,hR.BUTTON_7=6,hR.BUTTON_8=7,cR.EventMouse=hR;var fR=new Qn,_R=t("EventTouch",function(t){function e(e,n,i,r){var a;return void 0===r&&(r=[]),(a=t.call(this,i,n)||this).touch=null,a.simulate=!1,a.preventSwallow=!1,a._eventCode=void 0,a._touches=void 0,a._allTouches=void 0,a._eventCode=i,a._touches=e||[],a._allTouches=r,a}Z(e,t);var n=e.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},n.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Qn},n.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Qn},n.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Qn},n.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Qn},n.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Qn},n.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Qn},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Qn},n.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Qn},n.getDeltaX=function(){return this.touch?this.touch.getDelta(fR).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(fR).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(cR));_R.MAX_TOUCHES=5,cR.EventTouch=_R;var dR,pR=t("Acceleration",(function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=n,this.timestamp=i}));!function(t){t[t.NONE=0]="NONE",t[t.MOBILE_BACK=6]="MOBILE_BACK",t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT_LEFT=16]="SHIFT_LEFT",t[t.CTRL_LEFT=17]="CTRL_LEFT",t[t.ALT_LEFT=18]="ALT_LEFT",t[t.PAUSE=19]="PAUSE",t[t.CAPS_LOCK=20]="CAPS_LOCK",t[t.ESCAPE=27]="ESCAPE",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.ARROW_LEFT=37]="ARROW_LEFT",t[t.ARROW_UP=38]="ARROW_UP",t[t.ARROW_RIGHT=39]="ARROW_RIGHT",t[t.ARROW_DOWN=40]="ARROW_DOWN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_1=49]="DIGIT_1",t[t.DIGIT_2=50]="DIGIT_2",t[t.DIGIT_3=51]="DIGIT_3",t[t.DIGIT_4=52]="DIGIT_4",t[t.DIGIT_5=53]="DIGIT_5",t[t.DIGIT_6=54]="DIGIT_6",t[t.DIGIT_7=55]="DIGIT_7",t[t.DIGIT_8=56]="DIGIT_8",t[t.DIGIT_9=57]="DIGIT_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z",t[t.NUM_0=96]="NUM_0",t[t.NUM_1=97]="NUM_1",t[t.NUM_2=98]="NUM_2",t[t.NUM_3=99]="NUM_3",t[t.NUM_4=100]="NUM_4",t[t.NUM_5=101]="NUM_5",t[t.NUM_6=102]="NUM_6",t[t.NUM_7=103]="NUM_7",t[t.NUM_8=104]="NUM_8",t[t.NUM_9=105]="NUM_9",t[t.NUM_MULTIPLY=106]="NUM_MULTIPLY",t[t.NUM_PLUS=107]="NUM_PLUS",t[t.NUM_SUBTRACT=109]="NUM_SUBTRACT",t[t.NUM_DECIMAL=110]="NUM_DECIMAL",t[t.NUM_DIVIDE=111]="NUM_DIVIDE",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUM_LOCK=144]="NUM_LOCK",t[t.SCROLL_LOCK=145]="SCROLL_LOCK",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUAL=187]="EQUAL",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.PERIOD=190]="PERIOD",t[t.SLASH=191]="SLASH",t[t.BACK_QUOTE=192]="BACK_QUOTE",t[t.BRACKET_LEFT=219]="BRACKET_LEFT",t[t.BACKSLASH=220]="BACKSLASH",t[t.BRACKET_RIGHT=221]="BRACKET_RIGHT",t[t.QUOTE=222]="QUOTE",t[t.SHIFT_RIGHT=2e3]="SHIFT_RIGHT",t[t.CTRL_RIGHT=2001]="CTRL_RIGHT",t[t.ALT_RIGHT=2002]="ALT_RIGHT",t[t.NUM_ENTER=2003]="NUM_ENTER"}(dR||(dR=t("KeyCode",{})));var mR=new Qn,gR=t("Touch",function(){function t(t,e,n){void 0===n&&(n=0),this._point=new Qn,this._prevPoint=new Qn,this._lastModified=0,this._id=0,this._startPoint=new Qn,this._startPointCaptured=!1,this.setTouchInfo(n,t,e)}var e=t.prototype;return e.getLocation=function(t){return t||(t=new Qn),t.set(this._point.x,this._point.y),t},e.getLocationX=function(){return this._point.x},e.getLocationY=function(){return this._point.y},e.getUILocation=function(t){return t||(t=new Qn),t.set(this._point.x,this._point.y),l.view._convertToUISpace(t),t},e.getUILocationX=function(){var t=l.view.getViewportRect();return(this._point.x-t.x)/l.view.getScaleX()},e.getUILocationY=function(){var t=l.view.getViewportRect();return(this._point.y-t.y)/l.view.getScaleY()},e.getPreviousLocation=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,this._prevPoint.y),t},e.getUIPreviousLocation=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,this._prevPoint.y),l.view._convertToUISpace(t),t},e.getStartLocation=function(t){return t||(t=new Qn),t.set(this._startPoint.x,this._startPoint.y),t},e.getUIStartLocation=function(t){return t||(t=new Qn),t.set(this._startPoint.x,this._startPoint.y),l.view._convertToUISpace(t),t},e.getDelta=function(t){return t||(t=new Qn),t.set(this._point),t.subtract(this._prevPoint),t},e.getUIDelta=function(t){return t||(t=new Qn),mR.set(this._point),mR.subtract(this._prevPoint),t.set(l.view.getScaleX(),l.view.getScaleY()),Qn.divide(t,mR,t),t},e.getLocationInView=function(t){return t||(t=new Qn),t.set(this._point.x,l.view._designResolutionSize.height-this._point.y),t},e.getPreviousLocationInView=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,l.view._designResolutionSize.height-this._prevPoint.y),t},e.getStartLocationInView=function(t){return t||(t=new Qn),t.set(this._startPoint.x,l.view._designResolutionSize.height-this._startPoint.y),t},e.getID=function(){return this._id},e.setTouchInfo=function(t,e,n){void 0===t&&(t=0),this._prevPoint=this._point,this._point=new Qn(e||0,n||0),this._id=t,this._startPointCaptured||(this._startPoint=new Qn(this._point),this._startPointCaptured=!0)},e.setPoint=function(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=l.game.frameStartTime},e.setPrevPoint=function(t,e){this._prevPoint="object"==typeof t?new Qn(t.x,t.y):new Qn(t||0,e||0),this._lastModified=l.game.frameStartTime},Q(t,[{key:"lastModified",get:function(){return this._lastModified}}]),t}());l.Touch=gR;var vR,yR,SR=function(){function t(){this._intervalInMileSeconds=200,this._accelTimer=0,this._eventTarget=new tu,this._deviceEventName=void 0,this._globalEventClass=void 0,this._didAccelerateFunc=void 0,this._globalEventClass=window.DeviceMotionEvent||window.DeviceOrientationEvent,du.browserType===nu.MOBILE_QQ&&(this._globalEventClass=window.DeviceOrientationEvent),this._deviceEventName=this._globalEventClass===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this._didAccelerateFunc=this._didAccelerate.bind(this)}var e=t.prototype;return e._registerEvent=function(){this._accelTimer=performance.now(),window.addEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},e._unregisterEvent=function(){this._accelTimer=0,window.removeEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},e._didAccelerate=function(t){var e=performance.now();if(!(e-this._accelTimer<this._intervalInMileSeconds)){this._accelTimer=e;var n=0,i=0,r=0;if(this._globalEventClass===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;n=.1*((null==a?void 0:a.x)||0),i=.1*((null==a?void 0:a.y)||0),r=.1*((null==a?void 0:a.z)||0)}else{var o=t;n=(o.gamma||0)/90*.981,i=-(o.beta||0)/90*.981,r=(o.alpha||0)/90*.981}if(ah.isFrameRotated){var s=n;n=-i,i=s}var c=n;90===window.orientation?(n=-i,i=c):-90===window.orientation?(n=i,i=-c):180===window.orientation&&(n=-n,i=-i),du.os===au.ANDROID&&du.browserType!==nu.MOBILE_QQ&&(n=-n,i=-i);var l=performance.now(),u=new pR(n,i,r,l),h=new lR(u);this._eventTarget.emit(nw.DEVICEMOTION,h)}},e.start=function(){var t=this;window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){"granted"===e&&t._registerEvent()})).catch((function(){})):this._registerEvent()},e.stop=function(){this._unregisterEvent()},e.setInterval=function(t){this._intervalInMileSeconds=t},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),TR={Backspace:dR.BACKSPACE,Tab:dR.TAB,Enter:dR.ENTER,ShiftLeft:dR.SHIFT_LEFT,ControlLeft:dR.CTRL_LEFT,AltLeft:dR.ALT_LEFT,ShiftRight:dR.SHIFT_RIGHT,ControlRight:dR.CTRL_RIGHT,AltRight:dR.ALT_RIGHT,Pause:dR.PAUSE,CapsLock:dR.CAPS_LOCK,Escape:dR.ESCAPE,Space:dR.SPACE,PageUp:dR.PAGE_UP,PageDown:dR.PAGE_DOWN,End:dR.END,Home:dR.HOME,ArrowLeft:dR.ARROW_LEFT,ArrowUp:dR.ARROW_UP,ArrowRight:dR.ARROW_RIGHT,ArrowDown:dR.ARROW_DOWN,Insert:dR.INSERT,Delete:dR.DELETE,Digit0:dR.DIGIT_0,Digit1:dR.DIGIT_1,Digit2:dR.DIGIT_2,Digit3:dR.DIGIT_3,Digit4:dR.DIGIT_4,Digit5:dR.DIGIT_5,Digit6:dR.DIGIT_6,Digit7:dR.DIGIT_7,Digit8:dR.DIGIT_8,Digit9:dR.DIGIT_9,KeyA:dR.KEY_A,KeyB:dR.KEY_B,KeyC:dR.KEY_C,KeyD:dR.KEY_D,KeyE:dR.KEY_E,KeyF:dR.KEY_F,KeyG:dR.KEY_G,KeyH:dR.KEY_H,KeyI:dR.KEY_I,KeyJ:dR.KEY_J,KeyK:dR.KEY_K,KeyL:dR.KEY_L,KeyM:dR.KEY_M,KeyN:dR.KEY_N,KeyO:dR.KEY_O,KeyP:dR.KEY_P,KeyQ:dR.KEY_Q,KeyR:dR.KEY_R,KeyS:dR.KEY_S,KeyT:dR.KEY_T,KeyU:dR.KEY_U,KeyV:dR.KEY_V,KeyW:dR.KEY_W,KeyX:dR.KEY_X,KeyY:dR.KEY_Y,KeyZ:dR.KEY_Z,Numpad0:dR.NUM_0,Numpad1:dR.NUM_1,Numpad2:dR.NUM_2,Numpad3:dR.NUM_3,Numpad4:dR.NUM_4,Numpad5:dR.NUM_5,Numpad6:dR.NUM_6,Numpad7:dR.NUM_7,Numpad8:dR.NUM_8,Numpad9:dR.NUM_9,NumpadMultiply:dR.NUM_MULTIPLY,NumpadAdd:dR.NUM_PLUS,NumpadSubtract:dR.NUM_SUBTRACT,NumpadDecimal:dR.NUM_DECIMAL,NumpadDivide:dR.NUM_DIVIDE,NumpadEnter:dR.NUM_ENTER,F1:dR.F1,F2:dR.F2,F3:dR.F3,F4:dR.F4,F5:dR.F5,F6:dR.F6,F7:dR.F7,F8:dR.F8,F9:dR.F9,F10:dR.F10,F11:dR.F11,F12:dR.F12,NumLock:dR.NUM_LOCK,ScrollLock:dR.SCROLL_LOCK,Semicolon:dR.SEMICOLON,Equal:dR.EQUAL,Comma:dR.COMMA,Minus:dR.DASH,Period:dR.PERIOD,Slash:dR.SLASH,Backquote:dR.BACK_QUOTE,BracketLeft:dR.BRACKET_LEFT,Backslash:dR.BACKSLASH,BracketRight:dR.BRACKET_RIGHT,Quote:dR.QUOTE},xR=function(){function t(){this._eventTarget=new tu,this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){var t=this,e=document.getElementById("GameCanvas");null==e||e.addEventListener("keydown",(function(e){if(e.stopPropagation(),e.preventDefault(),e.repeat){var n=t._getInputEvent(e,nw.KEY_PRESSING);t._eventTarget.emit(nw.KEY_PRESSING,n)}else{var i=t._getInputEvent(e,nw.KEY_DOWN);t._eventTarget.emit(nw.KEY_DOWN,i)}})),null==e||e.addEventListener("keyup",(function(e){var n=t._getInputEvent(e,nw.KEY_UP);e.stopPropagation(),e.preventDefault(),t._eventTarget.emit(nw.KEY_UP,n)}))},e._getInputEvent=function(t,e){var n,i=(n=t.code,TR[n]||dR.NONE);return new uR(i,e)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),ER=function(){function t(){this._canvas=void 0,this._eventTarget=new tu,this._pointLocked=!1,this._isPressed=!1,this._preMousePos=new Qn,du.hasFeature(su.EVENT_MOUSE)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var e=t.prototype;return e._getCanvasRect=function(){var t=this._canvas,e=null==t?void 0:t.getBoundingClientRect();return e?new ai(e.x,e.y,e.width,e.height):new ai(0,0,0,0)},e._getLocation=function(t){var e=this._getCanvasRect(),n=ah.devicePixelRatio,i=this._pointLocked?this._preMousePos.x/n+t.movementX:t.clientX-e.x,r=this._pointLocked?this._preMousePos.y/n-t.movementY:e.y+e.height-t.clientY;return new Qn(i*=n,r*=n)},e._registerEvent=function(){var t,e,n,i,r=this;window.addEventListener("mousedown",(function(){r._isPressed=!0})),null===(t=this._canvas)||void 0===t||t.addEventListener("mousedown",this._createCallback(nw.MOUSE_DOWN)),null===(e=this._canvas)||void 0===e||e.addEventListener("mousemove",this._createCallback(nw.MOUSE_MOVE));var a=this._createCallback(nw.MOUSE_UP);window.addEventListener("mouseup",a),null===(n=this._canvas)||void 0===n||n.addEventListener("mouseup",a),null===(i=this._canvas)||void 0===i||i.addEventListener("wheel",this._handleMouseWheel.bind(this)),this._registerPointerLockEvent()},e._registerPointerLockEvent=function(){var t=this,e=function(){var e=t._canvas;document.pointerLockElement===e||document.mozPointerLockElement===e?t._pointLocked=!0:t._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",e,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",e,!1)},e._createCallback=function(t){var e=this;return function(n){var i,r=e._getLocation(n),a=n.button;switch(t){case nw.MOUSE_DOWN:null===(i=e._canvas)||void 0===i||i.focus(),e._isPressed=!0;break;case nw.MOUSE_UP:e._isPressed=!1;break;case nw.MOUSE_MOVE:e._isPressed||(a=hR.BUTTON_MISSING)}var o=new hR(t,!1,e._preMousePos);o.setLocation(r.x,r.y),o.setButton(a),o.movementX=n.movementX,o.movementY=n.movementY,e._preMousePos.set(r.x,r.y),n.stopPropagation(),n.target===e._canvas&&n.preventDefault(),e._eventTarget.emit(t,o)}},e._handleMouseWheel=function(t){var e=nw.MOUSE_WHEEL,n=this._getLocation(t),i=t.button,r=new hR(e,!1,this._preMousePos);r.setLocation(n.x,n.y),r.setButton(i),r.movementX=t.movementX,r.movementY=t.movementY,r.setScrollData(5*t.deltaX,5*-t.deltaY),this._preMousePos.set(n.x,n.y),t.stopPropagation(),t.target===this._canvas&&t.preventDefault(),this._eventTarget.emit(e,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),AR=new Qn,CR=new(function(){function t(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}var e=t.prototype;return e._cloneTouch=function(t){var e=t.getID();t.getStartLocation(AR);var n=new gR(AR.x,AR.y,e);return t.getLocation(AR),n.setPoint(AR.x,AR.y),t.getPreviousLocation(AR),n.setPrevPoint(AR),n},e._createTouch=function(t,e,n){if(this._touchMap.has(t))console.log("Cannot create the same touch object.");else{if(!this._checkTouchMapSizeMoreThanMax(t)){var i=new gR(e,n,t);return this._touchMap.set(t,i),this._updateTouch(i,e,n),this._cloneTouch(i)}console.log("The touches is more than MAX_TOUCHES.")}},e.releaseTouch=function(t){this._touchMap.has(t)&&this._touchMap.delete(t)},e.getTouch=function(t,e,n){var i=this._touchMap.get(t);return i?this._updateTouch(i,e,n):i=this._createTouch(t,e,n),i?this._cloneTouch(i):void 0},e.getAllTouches=function(){var t=this,e=[];return this._touchMap.forEach((function(n){if(n){var i=t._cloneTouch(n);e.push(i)}})),e},e._updateTouch=function(t,e,n){t.getLocation(AR),t.setPrevPoint(AR),t.setPoint(e,n)},e._checkTouchMapSizeMoreThanMax=function(t){var e=this;if(this._touchMap.has(t))return!1;var n=he.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<n)return!1;var i=performance.now();return this._touchMap.forEach((function(t){i-t.lastModified>he.TOUCH_TIMEOUT&&(console.log("The touches is more than MAX_TOUCHES, release touch id "+t.getID()+"."),e.releaseTouch(t.getID()))})),n>=this._touchMap.size},t}()),bR=function(){function t(){this._canvas=void 0,this._eventTarget=new tu,du.hasFeature(su.INPUT_TOUCH)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var e=t.prototype;return e._registerEvent=function(){var t,e,n,i;null===(t=this._canvas)||void 0===t||t.addEventListener("touchstart",this._createCallback(nw.TOUCH_START)),null===(e=this._canvas)||void 0===e||e.addEventListener("touchmove",this._createCallback(nw.TOUCH_MOVE)),null===(n=this._canvas)||void 0===n||n.addEventListener("touchend",this._createCallback(nw.TOUCH_END)),null===(i=this._canvas)||void 0===i||i.addEventListener("touchcancel",this._createCallback(nw.TOUCH_CANCEL))},e._createCallback=function(t){var e=this;return function(n){for(var i,r=e._getCanvasRect(),a=[],o=n.changedTouches.length,s=0;s<o;++s){var c=n.changedTouches[s],l=c.identifier;if(null!==l){var u=e._getLocation(c,r),h=CR.getTouch(l,u.x,u.y);h&&(t!==nw.TOUCH_END&&t!==nw.TOUCH_CANCEL||CR.releaseTouch(l),a.push(h))}}if(n.stopPropagation(),n.target===e._canvas&&n.preventDefault(),t===nw.TOUCH_START&&(null===(i=e._canvas)||void 0===i||i.focus()),a.length>0){var f=new _R(a,!1,t,he.ENABLE_MULTI_TOUCH?CR.getAllTouches():a);e._eventTarget.emit(t,f)}}},e._getCanvasRect=function(){var t=this._canvas,e=null==t?void 0:t.getBoundingClientRect();return e?new ai(e.x,e.y,e.width,e.height):new ai(0,0,0,0)},e._getLocation=function(t,e){var n=t.clientX-e.x,i=e.y+e.height-t.clientY;if(ah.isFrameRotated){var r=n;n=e.height-i,i=r}var a=ah.devicePixelRatio;return new Qn(n*=a,i*=a)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}();!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.UI=1]="UI"}(yR||(yR={}));var wR=function(){function t(t){this.priority=yR.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=t}return t.prototype.dispatchEvent=function(t){return this._inputEventTarget.emit(t.type,t),!0},t}(),IR=((vR={})[nw.MOUSE_DOWN]=nw.TOUCH_START,vR[nw.MOUSE_MOVE]=nw.TOUCH_MOVE,vR[nw.MOUSE_UP]=nw.TOUCH_END,vR),PR=t("Input",function(){function t(){this._dispatchImmediately=!0,this._eventTarget=new tu,this._touchInput=new bR,this._mouseInput=new ER,this._keyboardInput=new xR,this._accelerometerInput=new SR,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new wR(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher)}var e=t.prototype;return e.on=function(t,e,n){return this._eventTarget.on(t,e,n),e},e.once=function(t,e,n){return this._eventTarget.once(t,e,n),e},e.off=function(t,e,n){this._eventTarget.off(t,e,n)},e.setAccelerometerEnabled=function(t){t?this._accelerometerInput.start():this._accelerometerInput.stop()},e.setAccelerometerInterval=function(t){this._accelerometerInput.setInterval(t)},e._simulateEventTouch=function(t){var e=IR[t.type],n=CR.getTouch(0,t.getLocationX(),t.getLocationY());if(n){var i=[n],r=new _R(i,!1,e,i);e===nw.TOUCH_END&&CR.releaseTouch(0),this._dispatchOrPushEventTouch(r,this._eventTouchList)}},e._registerEventDispatcher=function(t){this._eventDispatcherList.push(t),this._eventDispatcherList.sort((function(t,e){return e.priority-t.priority}))},e._emitEvent=function(t){for(var e=this._eventDispatcherList.length,n=0;n<e&&this._eventDispatcherList[n].dispatchEvent(t);++n);},e._registerEvent=function(){var t=this;if(ch.hasFeature(ch.Feature.INPUT_TOUCH)){var e=this._eventTouchList;this._touchInput.on(nw.TOUCH_START,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(nw.TOUCH_MOVE,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(nw.TOUCH_END,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(nw.TOUCH_CANCEL,(function(n){t._dispatchOrPushEventTouch(n,e)}))}if(ch.hasFeature(ch.Feature.EVENT_MOUSE)){var n=this._eventMouseList;this._mouseInput.on(nw.MOUSE_DOWN,(function(e){t._needSimulateTouchMoveEvent=!0,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(nw.MOUSE_MOVE,(function(e){t._needSimulateTouchMoveEvent&&t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(nw.MOUSE_UP,(function(e){t._needSimulateTouchMoveEvent=!1,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(nw.MOUSE_WHEEL,(function(e){t._dispatchOrPushEvent(e,n)}))}if(ch.hasFeature(ch.Feature.EVENT_KEYBOARD)){var i=this._eventKeyboardList;this._keyboardInput.on(nw.KEY_DOWN,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(nw.KEY_PRESSING,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(nw.KEY_UP,(function(e){t._dispatchOrPushEvent(e,i)}))}if(ch.hasFeature(ch.Feature.EVENT_ACCELEROMETER)){var r=this._eventAccelerationList;this._accelerometerInput.on(nw.DEVICEMOTION,(function(e){t._dispatchOrPushEvent(e,r)}))}},e._clearEvents=function(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0},e._dispatchOrPushEvent=function(t,e){this._dispatchImmediately?this._emitEvent(t):e.push(t)},e._dispatchOrPushEventTouch=function(t,e){if(this._dispatchImmediately)for(var n=t.getTouches(),i=n.length,r=0;r<i;++r)t.touch=n[r],t.propagationStopped=t.propagationImmediateStopped=!1,this._emitEvent(t);else e.push(t)},e._frameDispatchEvents=function(){for(var t=this._eventMouseList,e=0,n=t.length;e<n;++e){var i=t[e];this._emitEvent(i)}for(var r=this._eventTouchList,a=0,o=r.length;a<o;++a)for(var s=r[a],c=s.getTouches(),l=c.length,u=0;u<l;++u)s.touch=c[u],s.propagationStopped=s.propagationImmediateStopped=!1,this._emitEvent(s);for(var h=this._eventKeyboardList,f=0,_=h.length;f<_;++f){var d=h[f];this._emitEvent(d)}for(var p=this._eventAccelerationList,m=0,g=p.length;m<g;++m){var v=p[m];this._emitEvent(v)}this._clearEvents()},t}());PR.EventType=nw;var RR=t("input",new PR),DR=t("SystemEvent",function(t){function e(){var e;return e=t.call(this)||this,RR.on(nw.MOUSE_DOWN,(function(t){e.emit(ew.MOUSE_DOWN,t)})),RR.on(nw.MOUSE_MOVE,(function(t){e.emit(ew.MOUSE_MOVE,t)})),RR.on(nw.MOUSE_UP,(function(t){e.emit(ew.MOUSE_UP,t)})),RR.on(nw.MOUSE_WHEEL,(function(t){e.emit(ew.MOUSE_WHEEL,t)})),RR.on(nw.TOUCH_START,(function(t){e.emit(ew.TOUCH_START,t.touch,t)})),RR.on(nw.TOUCH_MOVE,(function(t){e.emit(ew.TOUCH_MOVE,t.touch,t)})),RR.on(nw.TOUCH_END,(function(t){e.emit(ew.TOUCH_END,t.touch,t)})),RR.on(nw.TOUCH_CANCEL,(function(t){e.emit(ew.TOUCH_CANCEL,t.touch,t)})),RR.on(nw.KEY_DOWN,(function(t){e.emit(ew.KEY_DOWN,t)})),RR.on(nw.KEY_PRESSING,(function(t){e.emit(ew.KEY_DOWN,t)})),RR.on(nw.KEY_UP,(function(t){e.emit(ew.KEY_UP,t)})),RR.on(nw.DEVICEMOTION,(function(t){e.emit(ew.DEVICEMOTION,t)})),e}Z(e,t);var n=e.prototype;return n.setAccelerometerEnabled=function(t){RR.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){RR.setAccelerometerInterval(t)},n.on=function(e,n,i,r){return t.prototype.on.call(this,e,n,i,r),n},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i)},e}(tu));DR.EventType=ew,l.SystemEvent=DR;var OR,NR=t("systemEvent",new DR);l.systemEvent=NR,U(ew,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),U(cR,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:DR.EventType,targetName:"SystemEvent.EventType"}]),G(cR,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),U(hR,"EventMouse",["DOWN","UP","MOVE"].map((function(t){return{name:t,newName:"MOUSE_"+t,target:DR.EventType,targetName:"SystemEvent.EventType"}}))),U(hR,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:DR.EventType,targetName:"SystemEvent.EventType"}]),G(hR.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),U(_R,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:DR.EventType,targetName:"SystemEvent.EventType"}]),U(_R,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:DR.EventType,targetName:"SystemEvent.EventType"}]),U(_R,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:DR.EventType,targetName:"SystemEvent.EventType"}]),U(_R,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:DR.EventType,targetName:"SystemEvent.EventType"}]),G(_R.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),U(_R.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:_R,targetName:"EventTouch"}]),G(he.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((function(t){return{name:t}}))),G(he.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),G(he.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),G(he.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),G(he,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),U(DA.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),U(ob.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Qn),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new ii),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){"number"==typeof t?this._uiProps.uiTransformComp.setContentSize(t,e):this._uiProps.uiTransformComp.setContentSize(t)}}]),k(sR.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),U(sR.prototype,"SceneGlobals.prototype",[{name:"distance",newName:"planeHeight"},{name:"normal",newName:"planeDirection"}]),k(ob.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),U(dA.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),k(Cd,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),U(Cd,"Layers",[{name:"Default",newName:"DEFAULT",target:Cd.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Cd.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Cd.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Cd.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Cd.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Cd.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Cd.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Cd.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Cd,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Cd,targetName:"Layers"}]),k(Cd.Enum,"Layers.Enum",[{name:"ALWAYS"}]),k(Cd.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var MR,LR,FR,BR,zR=_l.Flags.HideInHierarchy,UR=_l.Flags.DontSave,kR=t("PrivateNode",Ec("cc.PrivateNode")(OR=function(t){function e(e){var n;return R(12003,(n=t.call(this,e)||this).name),n.hideFlags|=UR|zR,n}return Z(e,t),e}(ob))||OR);U(ew,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((function(t){return{name:t,target:ob.EventType,targetName:"Node.EventType"}}))),U(ob.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:DR.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:DR.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:DR.EventType,targetName:"SystemEvent.EventType"}]),l.PrivateNode=kR;var GR=t("Scene",Ec("cc.Scene")((ct((LR=function(t){Z(n,t);var e=n.prototype;function n(e){var n;return st(n=t.call(this,e)||this,"autoReleaseAssets",FR,rt(n)),st(n,"_globals",BR,rt(n)),n.dependAssets=null,n._renderScene=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Dn.ZERO,n._rot=zn.IDENTITY,n._scale=Dn.ONE,n._mat=Xn.IDENTITY,n._dirtyFlags=0,n._lpos=Dn.ZERO,n._lrot=zn.IDENTITY,n._lscale=Dn.ONE,n._activeInHierarchy=!1,l.director&&l.director.root&&(n._renderScene=l.director.root.createScene({})),n._inited=!l.game||!l.game._isCloning,n._init(),n}return e._updateScene=function(){this._scene=this},e._init=function(){},e.destroy=function(){var t=_l.prototype.destroy.call(this);if(t)for(var e=this._children,n=0;n<e.length;++n)e[n].active=!1;return this._renderScene&&l.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(F(3822))},e._onHierarchyChanged=function(){},e._onBatchCreated=function(e){t.prototype._onBatchCreated.call(this,e);for(var n=this._children.length,i=0;i<n;++i)this.children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},e.getPosition=function(t){return Dn.copy(t||new Dn,Dn.ZERO)},e.getRotation=function(t){return zn.copy(t||new zn,zn.IDENTITY)},e.getScale=function(t){return Dn.copy(t||new Dn,Dn.ONE)},e.getWorldPosition=function(t){return Dn.copy(t||new Dn,Dn.ZERO)},e.getWorldRotation=function(t){return zn.copy(t||new zn,zn.IDENTITY)},e.getWorldScale=function(t){return Dn.copy(t||new Dn,Dn.ONE)},e.getWorldMatrix=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.getWorldRS=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.getWorldRT=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.updateWorldTransform=function(){},e._instantiate=function(){},e._load=function(){this._inited||(Ab(this),xb(this),this._onBatchCreated(false),this._inited=!0),this.walk(DA._setScene)},e._activate=function(t){t=!1!==t,l.director._nodeActivator.activateNode(this,t),this._globals.activate(),this._renderScene&&this._renderScene.activate()},Q(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return Dn.ZERO}},{key:"worldPosition",get:function(){return Dn.ZERO}},{key:"rotation",get:function(){return zn.IDENTITY}},{key:"worldRotation",get:function(){return zn.IDENTITY}},{key:"scale",get:function(){return Dn.ONE}},{key:"worldScale",get:function(){return Dn.ONE}},{key:"eulerAngles",get:function(){return Dn.ZERO}},{key:"worldMatrix",get:function(){return Xn.IDENTITY}}]),n}(DA)).prototype,"globals",[Vc],Object.getOwnPropertyDescriptor(LR.prototype,"globals"),LR.prototype),FR=ct(LR.prototype,"autoReleaseAssets",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BR=ct(LR.prototype,"_globals",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new sR}}),MR=LR))||MR);function VR(t,e){if(!e){var n=l.director.getScene();if(!n)return null;e=n}return e.getChildByPath(t)}l.Scene=GR,l.find=VR;var HR=ne.fastRemoveAt,WR=_l.Flags.IsStartCalled,jR=_l.Flags.IsOnEnableCalled;function XR(t,e){for(var n=e.constructor._executionOrder,i=e._id,r=0,a=t.length-1,o=a>>>1;r<=a;o=r+a>>>1){var s=t[o],c=s.constructor._executionOrder;if(c>n)a=o-1;else if(c<n)r=o+1;else{var l=s._id;if(l>i)a=o-1;else{if(!(l<i))return o;r=o+1}}}return~r}function qR(t,e){for(var n=t.array,i=t.i+1;i<n.length;){var r=n[i];r.node._activeInHierarchy?++i:(t.removeAt(i),e&&(r._objFlags&=~e))}}_l.Flags.IsEditorOnEnableCalled;var YR=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=lt;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function KR(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}YR.stableRemoveInactive=qR;var QR=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){qR(this._zero,t),qR(this._neg,t),qR(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(KR),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(KR),this._invoke(e),e.array.length=0)},e}(YR),JR=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var n=e<0?this._neg.array:this._pos.array,i=XR(n,t);i<0&&n.splice(~i,0,t)}},n.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var n=e<0?this._neg:this._pos,i=XR(n.array,t);i>=0&&n.removeAt(i)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(YR);function ZR(t,e,n){var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",r=e?Function("it","dt",i):Function("it",i);return function(t,e,n){return function(i,r){try{e(i,r)}catch(e){l._throw(e);var a=i.array;for(n&&(a[i.i]._objFlags|=n),++i.i;i.i<a.length;++i.i)try{t(a[i.i],r)}catch(t){l._throw(t),n&&(a[i.i]._objFlags|=n)}}}}(Function("c","dt",t),r,n)}var $R=ZR("c.start();c._objFlags|="+WR,!1,WR),tD=ZR("c.update(dt)",!0),eD=ZR("c.lateUpdate(dt)",!0),nD=function(t){var e=l.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var i=n[t.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||e._onEnabled(i))}},iD=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new QR($R),this.updateInvoker=new JR(tD),this.lateUpdateInvoker=new JR(eD),this._updating=!1},e._onEnabled=function(t){l.director.getScheduler().resumeTarget(t),t._objFlags|=jR,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){l.director.getScheduler().pauseTarget(t),t._objFlags&=~jR;var e=this._deferredComps.indexOf(t);e>=0?HR(this._deferredComps,e):(!t.start||t._objFlags&WR||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&jR)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&jR&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&WR||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,n=t.length;e<n;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),rD=_l.Flags.IsPreloadStarted,aD=_l.Flags.IsOnLoadStarted,oD=_l.Flags.IsOnLoadCalled,sD=_l.Flags.Deactivating,cD=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){YR.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(YR),lD=ZR("c.__preload();"),uD=ZR("c.onLoad();c._objFlags|="+oD,!1,oD),hD=new ee(4);function fD(t,e,n){O(3817,t.name,n),console.log("Corrupted component value:",e),e?t._removeComponent(e):ne.removeAt(t._components,n)}hD.get=function(){var t=this._get()||{preload:new cD(lD),onLoad:new QR(uD),onEnable:new QR(nD)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var _D,dD,pD,mD,gD,vD,yD,SD,TD=t("NodeActivator",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var n=hD.get();this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),hD.put(n)}else{this._deactivateNodeRecursively(t);for(var i,r=ot(this._activatingStack);!(i=r()).done;){var a=i.value;a.preload.cancelInactive(rD),a.onLoad.cancelInactive(aD),a.onEnable.cancelInactive()}}t.emit(rA.ACTIVE_IN_HIERARCHY_CHANGED,t)},e.activateComp=function(t,e,n,i){if(pl(t,!0)&&(t._objFlags&rD||(t._objFlags|=rD,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&aD||(t._objFlags|=aD,t.onLoad?n?n.add(t):(t.onLoad(),t._objFlags|=oD):t._objFlags|=oD),t._enabled)){if(!t.node._activeInHierarchy)return;l.director._compScheduler.enableComp(t,i)}},e.destroyComp=function(t){l.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&oD&&t.onDestroy()},e._activateNodeRecursively=function(t,e,n,i){if(t._objFlags&sD)O(3816,t.name);else{t._activeInHierarchy=!0;for(var r=t._components.length,a=0;a<r;++a){var o=t._components[a];o instanceof l.Component?this.activateComp(o,e,n,i):(fD(t,o,a),--a,--r)}for(var s=0,c=t._children.length;s<c;++s){var u=t._children[s];u._active&&this._activateNodeRecursively(u,e,n,i)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=sD,t._activeInHierarchy=!1;for(var e=t._components.length,n=0;n<e;++n){var i=t._components[n];if(i._enabled&&(l.director._compScheduler.disableComp(i),t._activeInHierarchy))return void(t._objFlags&=~sD)}for(var r=0,a=t._children.length;r<a;++r){var o=t._children[r];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~sD)}t._onPostActivated(!1),t._objFlags&=~sD},t}()),xD=t("SceneAsset",Ec("cc.SceneAsset")((mD=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"scene",pD,rt(e)),e}Z(e,t);var n=e.prototype;return n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.scene=new GR("New Scene")},n.validate=function(){return!!this.scene},e}(Du),pD=ct((dD=mD).prototype,"scene",[Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_D=dD))||_D);l.SceneAsset=xD;var ED,AD,CD,bD,wD=t("TextAsset",Ec("cc.TextAsset")((SD=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"text",yD,rt(e)),e}return Z(e,t),e.prototype.toString=function(){return this.text},e}(Du),yD=ct((vD=SD).prototype,"text",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),gD=vD))||gD);l.TextAsset=wD;var ID=t("JsonAsset",Ec("cc.JsonAsset")((bD=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"json",CD,rt(e)),e}return Z(e,t),e}(Du),CD=ct((AD=bD).prototype,"json",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ED=AD))||ED);l.JsonAsset=ID;var PD,RD,DD,OD,ND,MD,LD,FD,BD,zD,UD,kD,GD,VD,HD,WD,jD,XD,qD,YD,KD,QD,JD,ZD,$D,tO,eO,nO,iO,rO,aO,oO,sO,cO,lO,uO,hO,fO,_O=function(){var t=e.prototype;function e(){this.fog=new gy,this.ambient=new sy,this.skybox=new _y,this.shadows=new _v,this.octree=new Ty,this.validPunctualLights=[],this.renderObjects=[],this.castShadowObjects=[],this.dirShadowObjects=[],this.shadowFrameBufferMap=new Map,this._geometryRendererMaterials=[],this._geometryRendererPasses=[],this._geometryRendererShaders=[],this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._init(),this.shadingScale=1}return t._init=function(){},t.activate=function(t,e){return this._device=t,this._pipeline=e,this.initGeometryRendererMaterials(),this.initOcclusionQuery(),!0},t.initGeometryRendererMaterials=function(){for(var t=0,e=0;e<6;e++){this._geometryRendererMaterials[e]=new $g,this._geometryRendererMaterials[e]._uuid="geometry-renderer-material-"+e,this._geometryRendererMaterials[e].initialize({effectName:"geometry-renderer",technique:e});for(var n=0;n<this._geometryRendererMaterials[e].passes.length;++n)this._geometryRendererPasses[t]=this._geometryRendererMaterials[e].passes[n],this._geometryRendererShaders[t]=this._geometryRendererMaterials[e].passes[n].getShaderVariant(),t++}},t.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this._createOcclusionQueryIA()),!this._occlusionQueryMaterial){var t=new $g;t._uuid="default-occlusion-query-material",t.initialize({effectName:"occlusion-query"}),this._occlusionQueryMaterial=t,this._occlusionQueryShader=t.passes[0].getShaderVariant()}},t.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial.passes[0]},t.onGlobalPipelineStateChanged=function(){},t.destroy=function(){var t,e,n;this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this.octree.destroy(),this.validPunctualLights.length=0,null===(t=this._occlusionQueryInputAssembler)||void 0===t||t.destroy(),this._occlusionQueryInputAssembler=null,null===(e=this._occlusionQueryVertexBuffer)||void 0===e||e.destroy(),this._occlusionQueryVertexBuffer=null,null===(n=this._occlusionQueryIndicesBuffer)||void 0===n||n.destroy(),this._occlusionQueryIndicesBuffer=null},t._createOcclusionQueryIA=function(){var t=this._device,e=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),n=3*Float32Array.BYTES_PER_ELEMENT,i=8*n;this._occlusionQueryVertexBuffer=t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,i,n)),this._occlusionQueryVertexBuffer.update(e);var r=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]),a=Uint16Array.BYTES_PER_ELEMENT,o=36*a;this._occlusionQueryIndicesBuffer=t.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,o,a)),this._occlusionQueryIndicesBuffer.update(r);var s=[new Or("a_position",pi.RGB32F)],c=new Mr(s,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return t.createInputAssembler(c)},Q(e,[{key:"native",get:function(){return this._nativeObj}},{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR=t}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale!==t&&(this._shadingScale=t,this._pipeline.emit(BS.ATTACHMENT_SCALE_CAHNGED,t))}},{key:"geometryRendererPasses",get:function(){return this._geometryRendererPasses}},{key:"geometryRendererShaders",get:function(){return this._geometryRendererShaders}}]),e}(),dO=t("ForwardPipeline",(PD=Ec("ForwardPipeline"),RD=al([Bx]),DD=Zc(),PD((LD=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"renderTextures",MD,rt(e)),e._postRenderPass=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new GE;n.initialize(GE.initInfo),this._flows.push(n);var i=new EE;i.initialize(EE.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:0},this._pipelineSceneData=new _O,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(O(2402),1))},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n)},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n._activeRenderer=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var e=this.globalDSManager.pointSampler;return this._descriptorSet.bindSampler(jd,e),this._descriptorSet.bindTexture(jd,Eg.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(tp,e),this._descriptorSet.bindTexture(tp,Eg.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Vd.BINDING).destroy(),this._descriptorSet.getBuffer(Wd.BINDING).destroy(),this._descriptorSet.getBuffer(Hd.BINDING).destroy(),this._descriptorSet.getTexture(jd).destroy(),this._descriptorSet.getTexture(tp).destroy())},Q(e,[{key:"postRenderPass",get:function(){return this._postRenderPass}}]),e}(aT),MD=ct((ND=LD).prototype,"renderTextures",[RD,Dc,DD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),OD=ND))||OD)),pO=[new hr(0,0,0,0),new hr(0,0,0,0),new hr(0,0,0,0)],mO=t("GbufferStage",(FD=Ec("GbufferStage"),BD=al([kx]),zD=Zc(),FD((HD=VD=function(t){function e(){var e;return st(e=t.call(this)||this,"renderQueues",GD,rt(e)),e._renderQueues=[],e._renderArea=new ir,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Ag("default"),e._batchedQueue=new qx,e._instancedQueue=new Yx,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=Wx(this.renderQueues[i])},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(jx),e.generateRenderArea(t,this._renderArea),e.updateQuadVertexData(this._renderArea,t.window);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(a=0;a<h.length;++a){var f=h[a];if(f.phase===this._phaseID){var _=f.batchingScheme;if(_===yg.INSTANCING){var d=f.getInstancedBuffer();d.merge(u,c.model.instancedAttributes,a),this._instancedQueue.queue.add(d)}else if(_===yg.VB_MERGING){var p=f.getBatchedBuffer();p.merge(u,a,c.model),this._batchedQueue.queue.add(p)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(Xx);var m=e.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),t.clearFlag&Ji.COLOR&&(e.pipelineSceneData.isHDR?Mg(pO[0],t.clearColor):(pO[0].x=t.clearColor.x,pO[0].y=t.clearColor.y,pO[0].z=t.clearColor.z)),pO[0].w=t.clearColor.w;var g=e.getPipelineRenderData().gbufferFrameBuffer,v=g.renderPass;m.beginRenderPass(v,g,this._renderArea,pO,t.clearDepth,t.clearStencil),m.setScissor(e.generateScissor(t)),m.setViewport(e.generateViewport(t)),m.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet);for(var y=0;y<this.renderQueues.length;y++)this._renderQueues[y].recordCommandBuffer(n,v,m);this._instancedQueue.recordCommandBuffer(n,v,m),this._batchedQueue.recordCommandBuffer(n,v,m),m.endRenderPass()},e}(FS),VD.initInfo={name:"GbufferStage",priority:JS.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:Fx.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:Fx.BACK_TO_FRONT,stages:["default"]}]},GD=ct((kD=HD).prototype,"renderQueues",[BD,Dc,zD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UD=kD))||UD)),gO=[new hr(0,0,0,1)],vO=t("LightingStage",(WD=Ec("LightingStage"),jD=al($g),XD=Zc(),qD=al([kx]),YD=Zc(),WD((tO=$D=function(t){function e(){var e;return(e=t.call(this)||this)._deferredLitsBufs=null,e._maxDeferredLights=cp.LIGHTS_PER_PASS,e._lightMeterScale=1e4,e._descriptorSet=null,e._renderArea=new ir,e._uiPhase=void 0,st(e,"_deferredMaterial",JD,rt(e)),st(e,"renderQueues",ZD,rt(e)),e._phaseID=Ag("default"),e._renderQueues=[],e._uiPhase=new SE,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.gatherLights=function(t){for(var e=this._pipeline,n=e.commandBuffers[0],i=t.scene.sphereLights,r=t.scene.spotLights,a=lo.create(0,0,0,1),o=new Float32Array(4),s=t.exposure,c=0,l=ti.length,u=l*this._maxDeferredLights,h=0;h<i.length&&c<this._maxDeferredLights;h++,++c){var f=i[h];if(lo.set(a,f.position.x,f.position.y,f.position.z,f.range),ds.sphereFrustum(a,t.frustum)){if(Dn.toArray(o,f.position),o[3]=0,this._lightBufferData.set(o,c*l),Dn.toArray(o,f.color),f.useColorTemperature){var _=f.colorTemperatureRGB;o[0]*=_.x,o[1]*=_.y,o[2]*=_.z}e.pipelineSceneData.isHDR?o[3]=f.luminance*s*this._lightMeterScale:o[3]=f.luminance,this._lightBufferData.set(o,c*l+1*u),o[0]=f.size,o[1]=f.range,o[2]=0,this._lightBufferData.set(o,c*l+2*u)}}for(var d=0;d<r.length&&c<this._maxDeferredLights;d++,++c){var p=r[d];if(lo.set(a,p.position.x,p.position.y,p.position.z,p.range),ds.sphereFrustum(a,t.frustum)){if(Dn.toArray(o,p.position),o[3]=1,this._lightBufferData.set(o,c*l+0*u),Dn.toArray(o,p.color),p.useColorTemperature){var m=p.colorTemperatureRGB;o[0]*=m.x,o[1]*=m.y,o[2]*=m.z}e.pipelineSceneData.isHDR?o[3]=p.luminance*s*this._lightMeterScale:o[3]=p.luminance,this._lightBufferData.set(o,c*l+1*u),o[0]=p.size,o[1]=p.range,o[2]=p.spotAngle,this._lightBufferData.set(o,c*l+2*u),Dn.toArray(o,p.direction),this._lightBufferData.set(o,c*l+3*u)}}var g=3*u+3;this._lightBufferData.set([c],g),n.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},n._createStageDescriptor=function(t){var e=this._pipeline.device,n=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;n=Math.ceil(n/e.capabilities.uboOffsetAlignment)*e.capabilities.uboOffsetAlignment,this._deferredLitsBufs=e.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,n,e.capabilities.uboOffsetAlignment));var i=e.createBuffer(new mr(this._deferredLitsBufs,0,n));this._lightBufferData=new Float32Array(n/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet=e.createDescriptorSet(new jr(t.localSetLayout)),this._descriptorSet.bindBuffer(sp.BINDING,i);var r=e.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE,ip.SIZE,ip.SIZE));this._descriptorSet.bindBuffer(ip.BINDING,r)},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._uiPhase.activate(e);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=Wx(this.renderQueues[i]);this._planarQueue=new yE(this._pipeline),this._deferredMaterial&&(e.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial)},n.destroy=function(){var t;null===(t=this._deferredLitsBufs)||void 0===t||t.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},n.render=function(t){var e=this._pipeline,n=e.device,i=e.commandBuffers[0],r=e.pipelineSceneData,a=r.renderObjects;this._planarQueue.gatherShadowPasses(t,i),e.generateRenderArea(t,this._renderArea);for(var o=e.getPipelineRenderData(),s=r.deferredLightingMaterial.passes[0],c=s.getShaderVariant(),l=0;l<3;++l)s.descriptorSet.bindTexture(l,o.gbufferRenderTargets[l]),s.descriptorSet.bindSampler(l,o.sampler);s.descriptorSet.bindTexture(3,o.outputDepth),s.descriptorSet.bindSampler(3,o.sampler),s.descriptorSet.update(),this._descriptorSet||this._createStageDescriptor(s),this.gatherLights(t),t.clearFlag&Ji.COLOR&&(gO[0].x=t.clearColor.x,gO[0].y=t.clearColor.y,gO[0].z=t.clearColor.z),gO[0].w=0;var u=o.outputFrameBuffer,h=u.renderPass;e.pipelineUBO.updateShadowUBO(t),i.beginRenderPass(h,u,this._renderArea,gO,t.clearDepth,t.clearStencil),i.setScissor(e.generateScissor(t)),i.setViewport(e.generateViewport(t)),i.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet);var f=e.quadIAOffscreen,_=null;null!=s&&null!=c&&null!=f&&(_=Dg.getOrCreatePipelineState(n,s,c,h,f)),null!=_&&(this._descriptorSet.update(),i.bindPipelineState(_),i.bindDescriptorSet(Bd.MATERIAL,s.descriptorSet),i.bindDescriptorSet(Bd.LOCAL,this._descriptorSet),i.bindInputAssembler(f),i.draw(f)),this._renderQueues.forEach(jx);for(var d=0,p=0,m=0,g=0;g<a.length;++g){var v=a[g],y=v.model.subModels;for(d=0;d<y.length;++d){var S=y[d].passes;for(p=0;p<S.length;++p)if(S[p].phase===this._phaseID)for(m=0;m<this._renderQueues.length;m++)this._renderQueues[m].insertRenderPass(v,d,p)}}if(a.length>0){this._renderQueues.forEach(Xx);for(var T=0;T<this._renderQueues.length;T++)this._renderQueues[T].recordCommandBuffer(n,h,i);this._planarQueue.recordCommandBuffer(n,h,i)}this._pipeline.geometryRenderer.render(h,i),this._uiPhase.render(t,h),i.endRenderPass()},e}(FS),$D.initInfo={name:"LightingStage",priority:JS.LIGHTING,tag:0},JD=ct((QD=tO).prototype,"_deferredMaterial",[jD,Dc,XD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZD=ct(QD.prototype,"renderQueues",[qD,Dc,YD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KD=QD))||KD)),yO=[new hr(0,0,0,1)],SO=t("PostProcessStage",(eO=Ec("PostProcessStage"),nO=al($g),iO=Zc(),rO=al([kx]),aO=Zc(),eO((hO=uO=function(t){function e(){var e;return st(e=t.call(this)||this,"_postProcessMaterial",cO,rt(e)),st(e,"renderQueues",lO,rt(e)),e._renderArea=new ir,e._stageDesc=void 0,e._localUBO=void 0,e._uiPhase=new SE,e}Z(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._postProcessMaterial&&(e.pipelineSceneData.postprocessMaterial=this._postProcessMaterial),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){var e=this._pipeline,n=e.device,i=e.pipelineSceneData,r=e.commandBuffers[0];e.pipelineUBO.updateCameraUBO(t);var a=t.viewport;this._renderArea.x=a.x*t.window.width,this._renderArea.y=a.y*t.window.height,this._renderArea.width=a.width*t.window.width,this._renderArea.height=a.height*t.window.height;var o=e.getPipelineRenderData(),s=t.window.framebuffer,c=e.getRenderPass(t.clearFlag,s);t.clearFlag&Ji.COLOR&&(yO[0].x=t.clearColor.x,yO[0].y=t.clearColor.y,yO[0].z=t.clearColor.z),yO[0].w=t.clearColor.w,r.beginRenderPass(c,s,this._renderArea,yO,t.clearDepth,t.clearStencil),r.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet);var l=i.postprocessMaterial.passes[0],u=l.getShaderVariant();e.bloomEnabled?l.descriptorSet.bindTexture(0,o.bloom.combineTex):l.descriptorSet.bindTexture(0,o.outputRenderTargets[0]),l.descriptorSet.bindSampler(0,o.sampler),l.descriptorSet.update();var h=t.window.swapchain?e.quadIAOnscreen:e.quadIAOffscreen,f=null;null!=l&&null!=u&&null!=h&&(f=Dg.getOrCreatePipelineState(n,l,u,c,h));var _=e.pipelineSceneData.renderObjects;null!=f&&_.length>0&&(this._stageDesc||(this._stageDesc=n.createDescriptorSet(new jr(l.localSetLayout)),this._localUBO=n.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE,ip.SIZE,ip.SIZE)),this._stageDesc.bindBuffer(ip.BINDING,this._localUBO)),this._stageDesc.update(),r.bindPipelineState(f),r.bindDescriptorSet(Bd.MATERIAL,l.descriptorSet),r.bindDescriptorSet(Bd.LOCAL,this._stageDesc),r.bindInputAssembler(h),r.draw(h)),this._uiPhase.render(t,c),Xg(n,c,r,e.profiler,t),r.endRenderPass()},e}(FS),uO.initInfo={name:"PostProcessStage",priority:YS.POST_PROCESS,tag:0},cO=ct((sO=hO).prototype,"_postProcessMaterial",[nO,Dc,iO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lO=ct(sO.prototype,"renderQueues",[rO,Dc,aO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oO=sO))||oO));!function(t){t[t.NONE=0]="NONE",t[t.FXAA=1]="FXAA"}(fO||(fO={}));var TO,xO,EO,AO,CO,bO,wO,IO,PO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._antiAliasing=fO.NONE,e}Z(e,t);var n=e.prototype;return n.onGlobalPipelineStateChanged=function(){this.updatePipelinePassInfo()},n.updateBloomPass=function(){if(this._bloomMaterial){var t=this._bloomMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently();for(var e=[],n=[],i=0;i<6;++i){var r=this._bloomMaterial.passes[1+i];r.beginChangeStatesSilently(),r.tryCompile(),r.endChangeStatesSilently();var a=this._bloomMaterial.passes[7+i];a.beginChangeStatesSilently(),a.tryCompile(),a.endChangeStatesSilently(),e.push(r.native),n.push(a.native)}var o=this._bloomMaterial.passes[13];o.beginChangeStatesSilently(),o.tryCompile(),o.endChangeStatesSilently()}},n.updatePostProcessPass=function(){if(this.postprocessMaterial){var t=this.postprocessMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},n.initPipelinePassInfo=function(){var t=new $g;t._uuid="builtin-deferred-material",t.initialize({effectName:"deferred-lighting"});for(var e=0;e<t.passes.length;++e)t.passes[e].tryCompile();this._deferredLightingMaterial=t;var n=new $g;n._uuid="builtin-bloom-material",n.initialize({effectName:"bloom"});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._bloomMaterial=n;var r=new $g;r._uuid="builtin-post-process-material",he.ENABLE_ANTIALIAS_FXAA&&(this._antiAliasing=fO.FXAA),r.initialize({effectName:"post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(var a=0;a<r.passes.length;++a)r.passes[a].tryCompile();this._postprocessMaterial=r,this.updatePipelinePassInfo()},n.updatePipelinePassInfo=function(){this.updateBloomPass(),this.updatePostProcessPass(),this.updateDeferredPassInfo()},n.activate=function(e,n){return t.prototype.activate.call(this,e,n),this.initPipelinePassInfo(),!0},n.updateDeferredPassInfo=function(){this.updateDeferredLightPass()},n.updateDeferredLightPass=function(){if(this._deferredLightingMaterial){this.shadows.enabled&&(this._pipeline.macros.CC_RECEIVE_SHADOW=1);var t=this._deferredLightingMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},Q(e,[{key:"antiAliasing",get:function(){return this._antiAliasing},set:function(t){if(this._antiAliasing=t,this._postprocessMaterial){var e=this._postprocessMaterial.passes[0].defines;Object.assign(e,{ANTIALIAS_TYPE:t});var n=new $g;n.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:e});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._postprocessMaterial=n}}},{key:"bloomMaterial",get:function(){return this._bloomMaterial},set:function(t){this._bloomMaterial!==t&&t&&(this._bloomMaterial=t,this.updatePipelinePassInfo())}},{key:"postprocessMaterial",get:function(){return this._postprocessMaterial},set:function(t){this._postprocessMaterial!==t&&t&&(this._postprocessMaterial=t,this.updatePipelinePassInfo())}},{key:"deferredLightingMaterial",get:function(){return this._deferredLightingMaterial},set:function(t){this._deferredLightingMaterial!==t&&t&&(this._deferredLightingMaterial=t,this.updatePipelinePassInfo())}}]),e}(_O),RO=[new hr(0,0,0,1)],DO=function(){};DO.SIZE=4*(DO.COUNT=4+(DO.TEXTURE_SIZE_OFFSET=0));var OO,NO,MO,LO,FO,BO,zO,UO,kO,GO,VO=t("BloomStage",(TO=Ec("BloomStage"),xO=al($g),EO=Zc(),TO((IO=wO=function(t){function e(){var e;return(e=t.call(this)||this).threshold=1,e.intensity=.8,e.iterations=2,st(e,"_bloomMaterial",bO,rt(e)),e._renderArea=new ir,e._bloomUBO=[],e}Z(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._bloomMaterial&&(e.pipelineSceneData.bloomMaterial=this._bloomMaterial)},n.destroy=function(){},n.render=function(t){var e,n=this._pipeline;if(n.generateBloomRenderData(),((null===(e=t.window)||void 0===e?void 0:e.swapchain)||n.macros.CC_PIPELINE_TYPE)&&n.bloomEnabled&&0!==n.pipelineSceneData.renderObjects.length){if(0===this._bloomUBO.length)for(var i=0;i<14;++i)this._bloomUBO[i]=n.device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,DO.SIZE,DO.SIZE));t.clearFlag&Ji.COLOR&&(RO[0].x=t.clearColor.x,RO[0].y=t.clearColor.y,RO[0].z=t.clearColor.z),RO[0].w=t.clearColor.w,this._prefilterPass(t,n),this._downsamplePass(t,n),this._upsamplePass(t,n),this._combinePass(t,n)}},n._prefilterPass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial.passes[0],r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(DO.COUNT);o[DO.TEXTURE_SIZE_OFFSET+2]=this.threshold,n.updateBuffer(this._bloomUBO[0],o),n.beginRenderPass(a.renderPass,a.prefilterFramebuffer,this._renderArea,RO,0,0),n.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet),i.descriptorSet.bindBuffer(0,this._bloomUBO[0]),i.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),i.descriptorSet.bindSampler(1,a.sampler),i.descriptorSet.update(),n.bindDescriptorSet(Bd.MATERIAL,i.descriptorSet);var s=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,c=null,l=i.getShaderVariant();null!=i&&null!=l&&null!=s&&(c=Dg.getOrCreatePipelineState(e.device,i,l,a.renderPass,s)),null!=c&&(n.bindPipelineState(c),n.bindInputAssembler(s),n.draw(s)),n.endRenderPass()},n._downsamplePass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;for(var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData().bloom,a=new Float32Array(DO.COUNT),o=0;o<this.iterations;++o){a[DO.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[DO.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,n.updateBuffer(this._bloomUBO[o+1],a),this._renderArea.width>>=1,this._renderArea.height>>=1,n.beginRenderPass(r.renderPass,r.downsampleFramebuffers[o],this._renderArea,RO,0,0);var s=i.passes[1+o],c=s.getShaderVariant();s.descriptorSet.bindBuffer(0,this._bloomUBO[o+1]),0===o?s.descriptorSet.bindTexture(1,r.prefiterTex):s.descriptorSet.bindTexture(1,r.downsampleTexs[o-1]),s.descriptorSet.bindSampler(1,r.sampler),s.descriptorSet.update(),n.bindDescriptorSet(Bd.MATERIAL,s.descriptorSet);var l=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,u=null;null!=s&&null!=c&&null!=l&&(u=Dg.getOrCreatePipelineState(e.device,s,c,r.renderPass,l)),null!=u&&(n.bindPipelineState(u),n.bindInputAssembler(l),n.draw(l)),n.endRenderPass()}},n._upsamplePass=function(t,e){var n=e.getPipelineRenderData().bloom;e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=this.iterations+1,this._renderArea.height>>=this.iterations+1;for(var i=e.commandBuffers[0],r=e.pipelineSceneData.bloomMaterial,a=new Float32Array(DO.COUNT),o=0;o<this.iterations;++o){var s=o+6+1;a[DO.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[DO.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,i.updateBuffer(this._bloomUBO[s],a),this._renderArea.width<<=1,this._renderArea.height<<=1,i.beginRenderPass(n.renderPass,n.upsampleFramebuffers[this.iterations-1-o],this._renderArea,RO,0,0);var c=r.passes[7+o],l=c.getShaderVariant();c.descriptorSet.bindBuffer(0,this._bloomUBO[s]),0===o?c.descriptorSet.bindTexture(1,n.downsampleTexs[this.iterations-1]):c.descriptorSet.bindTexture(1,n.upsampleTexs[this.iterations-o]),c.descriptorSet.bindSampler(1,n.sampler),c.descriptorSet.update(),i.bindDescriptorSet(Bd.MATERIAL,c.descriptorSet);var u=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,h=null;null!=c&&null!=l&&null!=u&&(h=Dg.getOrCreatePipelineState(e.device,c,l,n.renderPass,u)),null!=h&&(i.bindPipelineState(h),i.bindInputAssembler(u),i.draw(u)),i.endRenderPass()}},n._combinePass=function(t,e){e.generateRenderArea(t,this._renderArea);var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(DO.COUNT);o[DO.TEXTURE_SIZE_OFFSET+3]=this.intensity,n.updateBuffer(this._bloomUBO[13],o),n.beginRenderPass(a.renderPass,a.combineFramebuffer,this._renderArea,RO,0,0),n.bindDescriptorSet(Bd.GLOBAL,e.descriptorSet);var s=i.passes[13];s.descriptorSet.bindBuffer(0,this._bloomUBO[13]),s.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),s.descriptorSet.bindTexture(2,a.upsampleTexs[0]),s.descriptorSet.bindSampler(1,a.sampler),s.descriptorSet.bindSampler(2,a.sampler),s.descriptorSet.update(),n.bindDescriptorSet(Bd.MATERIAL,s.descriptorSet);var c=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,l=null,u=s.getShaderVariant();null!=s&&null!=u&&null!=c&&(l=Dg.getOrCreatePipelineState(e.device,s,u,a.renderPass,c)),null!=l&&(n.bindPipelineState(l),n.bindInputAssembler(c),n.draw(c)),n.endRenderPass()},e}(FS),wO.initInfo={name:"BloomStage",priority:YS.BLOOM,tag:0},bO=ct((CO=IO).prototype,"_bloomMaterial",[xO,Dc,EO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AO=CO))||AO)),HO=t("MainFlow",Ec("MainFlow")((MO=NO=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new mO;n.initialize(mO.initInfo),this._stages.push(n);var i=new vO;i.initialize(vO.initInfo),this._stages.push(i);var r=new VO;r.initialize(VO.initInfo),this._stages.push(r);var a=new SO;a.initialize(SO.initInfo),this._stages.push(a)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(zS),NO.initInfo={name:Id,priority:ZS.MAIN,stages:[]},OO=MO))||OO),WO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).gbufferFrameBuffer=null,e.gbufferRenderTargets=[],e}return Z(e,t),e}((function(){this.outputFrameBuffer=null,this.outputRenderTargets=[],this.outputDepth=null,this.sampler=null,this.bloom=null})),jO=t("DeferredPipeline",(LO=Ec("DeferredPipeline"),FO=al([Bx]),BO=Zc(),LO((GO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gbufferRenderPass=null,e._lightingRenderPass=null,st(e,"renderTextures",kO,rt(e)),e}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new GE;n.initialize(GE.initInfo),this._flows.push(n);var i=new HO;i.initialize(HO.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:1},this._pipelineSceneData=new PO,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(O(2402),1))},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler(),this._destroyDeferredData();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n.getPipelineRenderData=function(){return this._pipelineRenderData||this._generateDeferredRenderData(),this._pipelineRenderData},n._activeRenderer=function(t){var e=this.device;this._commandBuffers.push(e.commandBuffer);var n=this.globalDSManager.pointSampler;this._descriptorSet.bindSampler(jd,n),this._descriptorSet.bindTexture(jd,Eg.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(tp,n),this._descriptorSet.bindTexture(tp,Eg.get("default-texture").getGFXTexture()),this._descriptorSet.update();var i=new rT;if(!(i=this._createQuadInputAssembler()).quadIB||!i.quadVB||!i.quadIA)return!1;this._quadIB=i.quadIB,this._quadVBOffscreen=i.quadVB,this._quadIAOffscreen=i.quadIA;var r=this._createQuadInputAssembler();if(!r.quadIB||!r.quadVB||!r.quadIA)return!1;if(this._quadVBOnscreen=r.quadVB,this._quadIAOnscreen=r.quadIA,!this._gbufferRenderPass){var a=new Lr;a.format=pi.RGBA16F,a.loadOp=Fi.CLEAR,a.storeOp=Bi.STORE;var o=new Lr;o.format=pi.RGBA16F,o.loadOp=Fi.CLEAR,o.storeOp=Bi.STORE;var s=new Lr;s.format=pi.RGBA16F,s.loadOp=Fi.CLEAR,s.storeOp=Bi.STORE;var c=new Fr;c.format=pi.DEPTH_STENCIL,c.depthLoadOp=Fi.CLEAR,c.depthStoreOp=Bi.STORE,c.stencilLoadOp=Fi.CLEAR,c.stencilStoreOp=Bi.STORE;var l=new Ur([a,o,s],c);this._gbufferRenderPass=e.createRenderPass(l)}if(!this._lightingRenderPass){var u=new Lr;u.format=pi.RGBA8,u.loadOp=Fi.CLEAR,u.storeOp=Bi.STORE,u.barrier=e.getGeneralBarrier(new kr(zi.NONE,zi.COLOR_ATTACHMENT_WRITE));var h=new Fr;h.format=pi.DEPTH_STENCIL,h.depthLoadOp=Fi.LOAD,h.depthStoreOp=Bi.DISCARD,h.stencilLoadOp=Fi.LOAD,h.stencilStoreOp=Bi.DISCARD,u.barrier=e.getGeneralBarrier(new kr(zi.DEPTH_STENCIL_ATTACHMENT_WRITE,zi.DEPTH_STENCIL_ATTACHMENT_WRITE));var f=new Ur([u],h);this._lightingRenderPass=e.createRenderPass(f)}return this._width=t.width,this._height=t.height,this._generateDeferredRenderData(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Vd.BINDING).destroy(),this._descriptorSet.getBuffer(Wd.BINDING).destroy(),this._descriptorSet.getBuffer(Hd.BINDING).destroy(),this._descriptorSet.getTexture(jd).destroy(),this._descriptorSet.getTexture(tp).destroy())},n._destroyDeferredData=function(){var t=this._pipelineRenderData;if(t){t.gbufferFrameBuffer&&t.gbufferFrameBuffer.destroy(),t.outputFrameBuffer&&t.outputFrameBuffer.destroy(),t.outputDepth&&t.outputDepth.destroy();for(var e=0;e<t.gbufferRenderTargets.length;e++)t.gbufferRenderTargets[e].destroy();t.gbufferRenderTargets.length=0;for(var n=0;n<t.outputRenderTargets.length;n++)t.outputRenderTargets[n].destroy();t.outputRenderTargets.length=0,this._destroyBloomData()}this._pipelineRenderData=null},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n,this._destroyDeferredData(),this._generateDeferredRenderData())},n._generateDeferredRenderData=function(){for(var t=this,e=this.device,n=this._pipelineRenderData=new WO,i=this.pipelineSceneData,r=0;r<3;++r)n.gbufferRenderTargets.push(e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale)));n.outputDepth=e.createTexture(new Sr(xi.TEX2D,Ei.DEPTH_STENCIL_ATTACHMENT|Ei.SAMPLED,pi.DEPTH_STENCIL,this._width*i.shadingScale,this._height*i.shadingScale)),n.gbufferFrameBuffer=e.createFramebuffer(new Vr(this._gbufferRenderPass,n.gbufferRenderTargets,n.outputDepth)),n.outputRenderTargets.push(e.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED,pi.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale))),n.outputFrameBuffer=e.createFramebuffer(new Vr(this._lightingRenderPass,n.outputRenderTargets,null)),n.sampler=this.globalDSManager.pointSampler,this.on(BS.ATTACHMENT_SCALE_CAHNGED,(function(e){n.sampler=e<1?t.globalDSManager.pointSampler:t.globalDSManager.linearSampler,t.applyFramebufferRatio(n.gbufferFrameBuffer),t.applyFramebufferRatio(n.outputFrameBuffer)}))},e}(aT),kO=ct((UO=GO).prototype,"renderTextures",[FO,Dc,BO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zO=UO))||zO));function XO(){var t=new dO;return t.initialize({flows:[]}),t}var qO=new Qn,YO=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.isPause=!1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.pauseRendering=function(){this.isPause=!0},t.resumeRendering=function(){this.isPause=!1},t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.settings=window._CCSettings.splashScreen;e.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,e.base64src=this.settings.base64src||"",e.effect=this.settings.effect||"FADE-INOUT",e.clearColor=this.settings.clearColor||new hr(.88,.88,.88,1),e.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,e.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new hr(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{l.view.resizeWithBrowserSize(!0);var n=window._CCSettings.designResolution;n?l.view.setDesignResolutionSize(n.width,n.height,n.policy):l.view.setDesignResolutionSize(960,640,4),this.device=t.device,this.swapchain=t.mainWindow.swapchain,this.framebuffer=t.mainWindow.framebuffer,l.game.once(l.Game.EVENT_GAME_INITED,(function(){l.director._lateUpdate=performance.now()}),l.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else T("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),l.game.resume())},t.preInit=function(){var t=this.settings.clearColor;this.clearColors=[new hr(t.x,t.y,t.z,t.w)];var e=this.device,n=this.swapchain;this.renderArea=new ir(0,0,n.width,n.height),this.cmdBuff=e.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),r=4*Float32Array.BYTES_PER_ELEMENT,a=4*r;this.vertexBuffers=e.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,a,r)),this.vertexBuffers.update(i);var o=new Uint16Array([0,1,2,1,3,2]),s=Uint16Array.BYTES_PER_ELEMENT,c=6*s;this.indicesBuffers=e.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,c,s)),this.indicesBuffers.update(o);var l=[new Or("a_position",pi.RG32F),new Or("a_texCoord",pi.RG32F)],u=new Mr(l,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=e.createInputAssembler(u),this.projection=new Xn,Xn.ortho(this.projection,-1,1,-1,1,-1,1,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY,n.surfaceTransform)},t.init=function(){var t=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),l.game.pause(),this.handle=requestAnimationFrame((function e(n){if(!t.cancelAnimate){var i=t.settings,r=t.device,a=t.swapchain;Xn.ortho(t.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,a.surfaceTransform);var o=a.width,s=a.height,c=o<s?o:s;t.startTime<0&&(t.startTime=n);var l=n-t.startTime,u=_f(hn(l/i.totalTime));"NONE"===i.effect&&(u=1);var h=t.logoTexture.width,f=t.logoTexture.height,_=c*i.displayRatio,d=_*h/f,p=_;if(a.surfaceTransform!==_i.ROTATE_90&&a.surfaceTransform!==_i.ROTATE_270||(d=_*o/s,p=_*f/h*s/o),t.logoMat.setProperty("resolution",qO.set(o,s),0),t.logoMat.setProperty("scale",qO.set(d,p),0),t.logoMat.setProperty("translate",qO.set(.5*o,.5*s),0),t.logoMat.setProperty("percent",u),t.logoMat.setProperty("u_projection",t.projection),t.logoMat.passes[0].update(),i.displayWatermark&&t.watermarkMat){var m=.5*c,g=t.watermarkTexture.width,v=m,y=m*t.watermarkTexture.height/g;a.surfaceTransform!==_i.ROTATE_90&&a.surfaceTransform!==_i.ROTATE_270||(v=.5*m,y=m*o/s*.5),t.watermarkMat.setProperty("resolution",qO.set(o,s),0),t.watermarkMat.setProperty("scale",qO.set(v,y),0),t.watermarkMat.setProperty("translate",qO.set(.5*o,.1*s),0),t.watermarkMat.setProperty("percent",u),t.watermarkMat.setProperty("u_projection",t.projection),t.watermarkMat.passes[0].update()}t.isPause||(t.frame(),l>i.totalTime&&(t.splashFinish=!0)),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.initLogo=function(){var t=this.device;this.logoMat=new $g,this.logoMat.initialize({effectName:"splash-screen"});var e=new xr;e.addressU=Pi.CLAMP,e.addressV=Pi.CLAMP,e.addressW=Pi.CLAMP,this.sampler=t.getSampler(e),this.logoTexture=t.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED|Ei.TRANSFER_DST,pi.RGBA8,this.logoImage.width,this.logoImage.height));var n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=n.getShaderVariant();var r=n.descriptorSet;r.bindSampler(i,this.sampler),r.update();var a=new lr;a.texExtent.width=this.logoImage.width,a.texExtent.height=this.logoImage.height,a.texExtent.depth=1,t.copyTexImagesToTexture([this.logoImage],this.logoTexture,[a])},t.initWarterMark=function(){var t=document.createElement("canvas");t.width=330,t.height=30,t.style.width=""+t.width,t.style.height=""+t.height;var e=t.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var n="Powered by Cocos Creator",i=e.measureText(n);e.fillText(n,(330-i.width)/2,6);var r=new lr;r.texExtent.width=t.width,r.texExtent.height=t.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED|Ei.TRANSFER_DST,pi.RGBA8,t.width,t.height)),this.device.copyTexImagesToTexture([t],this.watermarkTexture,[r]),this.watermarkMat=new $g,this.watermarkMat.initialize({effectName:"splash-screen"});var a=this.watermarkMat.passes[0],o=a.getBinding("mainTexture");a.bindTexture(o,this.watermarkTexture),a.descriptorSet.update()},t.frame=function(){var t=this.device,e=this.swapchain;t.acquire([e]);var n=this.cmdBuff,i=this.framebuffer,r=this.renderArea;r.width=e.width,r.height=e.height,n.begin(),n.beginRenderPass(i.renderPass,i,r,this.clearColors,1,0);var a=this.logoMat.passes[0],o=Dg.getOrCreatePipelineState(t,a,this.shader,i.renderPass,this.quadAssmebler);if(n.bindPipelineState(o),n.bindDescriptorSet(Bd.MATERIAL,a.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var s=this.watermarkMat.passes[0],c=Dg.getOrCreatePipelineState(t,s,this.shader,i.renderPass,this.quadAssmebler);n.bindPipelineState(c),n.bindDescriptorSet(Bd.MATERIAL,s.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler)}n.endRenderPass(),n.end(),t.flushCommands([n]),t.queue.submit([n]),t.present()},t.destroy=function(){this.callBack=null,this.device=null,this.swapchain=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,e._ins=void 0},Q(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();YO._ins=void 0,l.internal.SplashScreen=YO;var KO=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},Q(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}());KO.Priority=oe({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var QO=new mt("Scheduler"),JO=function(t,e,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=n,this.markedForDeletion=i};JO.get=function(t,e,n,i){var r=JO._listEntries.pop();return r?(r.target=t,r.priority=e,r.paused=n,r.markedForDeletion=i):r=new JO(t,e,n,i),r},JO.put=function(t){JO._listEntries.length<20&&(t.target=null,JO._listEntries.push(t))},JO._listEntries=[];var ZO=function(t,e,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=n,this.callback=i};ZO.get=function(t,e,n,i){var r=ZO._hashUpdateEntries.pop();return r?(r.list=t,r.entry=e,r.target=n,r.callback=i):r=new ZO(t,e,n,i),r},ZO.put=function(t){ZO._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,ZO._hashUpdateEntries.push(t))},ZO._hashUpdateEntries=[];var $O=function(t,e,n,i,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=a};$O.get=function(t,e,n,i,r,a){var o=$O._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=n,o.currentTimer=i,o.currentTimerSalvaged=r,o.paused=a):o=new $O(t,e,n,i,r,a),o},$O.put=function(t){$O._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,$O._hashTimerEntries.push(t))},$O._hashTimerEntries=[];var tN=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,n,i,r,a){return this._lock=!1,this._scheduler=t,this._target=n,this._callback=e,this._elapsed=-1,this._interval=i,this._delay=a,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===l.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();tN._timers=[],tN.get=function(){return tN._timers.pop()||new tN},tN.put=function(t){tN._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,tN._timers.push(t))};var eN,nN=t("Scheduler",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=It(!0),e._hashForTimers=It(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}Z(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?R(1513):t.id=QO.getNewId())};var n=e.prototype;return n.setTimeScale=function(t){this._timeScale=t},n.getTimeScale=function(){return this._timeScale},n.update=function(t){var e,n,i,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,i=(n=this._updatesNegList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updates0List).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updatesPosList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);var o=this._arrayForTimers;for(e=0;e<o.length;e++){if(a=o[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,n=this._updatesNegList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updates0List;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updatesPosList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(t,e,n,i,r,a){if("function"!=typeof t){var o=t;t=e,e=o}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!i,i=l.macro.REPEAT_FOREVER,r=0),L(e,1502);var s=e.uuid||e.id;if(s){var c,u,h=this._hashForTimers[s];if(h?h.paused!==a&&R(1511):(h=$O.get(null,e,0,null,null,a),this._arrayForTimers.push(h),this._hashForTimers[s]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((c=h.timers[u])&&t===c._callback)return I(1507,c.getInterval(),n),void(c._interval=n);(c=tN.get()).initWithCallback(this,t,e,n,i,r),h.timers.push(c),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else O(1510)},n.scheduleUpdate=function(t,e,n){var i=t.uuid||t.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return I(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(t)}var a,o=JO.get(t,e,n,!1);0===e?(a=this._updates0List,this._appendIn(a,o)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,o,e)),this._hashForUpdates[i]=ZO.get(a,o,t,null)}else O(1510)},n.unschedule=function(t,e){if(e&&t){var n=e.uuid||e.id;if(n){var i=this._hashForTimers[n];if(i)for(var r=i.timers,a=0,o=r.length;a<o;a++){var s=r[a];if(t===s._callback)return s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(a,1),tN.put(s),i.timerIndex>=a&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}else O(1510)}},n.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForUpdates[e];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else O(1510)}},n.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,a=i.length;r<a;r++)tN.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(t)}else O(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(KO.Priority.SCHEDULER)},n.unscheduleAllWithMinPriority=function(t){var e,n,i,r=this._arrayForTimers;for(e=r.length-1;e>=0;e--)n=r[e],this.unscheduleAllForTarget(n.target);var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),a===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesPosList.length&&e++},n.isScheduled=function(t,e){L(t,1508),L(e,1509);var n=e.uuid||e.id;if(!n)return O(1510),!1;var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,a=0;a<r.length;++a)if(t===r[a]._callback)return!0;return!1},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(KO.Priority.SCHEDULER)},n.pauseAllTargetsWithMinPriority=function(t){var e,n,i,r,a=[],o=this._arrayForTimers;for(n=0,i=o.length;n<i;n++)(e=o[n])&&(e.paused=!0,a.push(e.target));if(t<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));if(t<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,a.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));return a},n.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},n.pauseTarget=function(t){L(t,1503);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!0);var i=this._hashForUpdates[e];i&&(i.entry.paused=!0)}else O(1510)},n.resumeTarget=function(t){L(t,1504);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!1);var i=this._hashForUpdates[e];i&&(i.entry.paused=!1)}else O(1510)},n.isTargetPaused=function(t){L(t,1505);var e=t.uuid||t.id;if(!e)return O(1510),!1;var n=this._hashForTimers[e];if(n)return n.paused;var i=this._hashForUpdates[e];return!!i&&i.entry.paused},n._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}$O.put(t)},n._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,n=this._hashForUpdates[e];if(n){for(var i=n.list,r=n.entry,a=0,o=i.length;a<o;a++)if(i[a]===r){i.splice(a,1);break}delete this._hashForUpdates[e],JO.put(r),ZO.put(n)}},n._priorityIn=function(t,e,n){for(var i=0;i<t.length;i++)if(n<t[i].priority)return void t.splice(i,0,e);t.push(e)},n._appendIn=function(t,e){t.push(e)},e}(KO));nN.ID="scheduler",l.Scheduler=nN;var iN=((eN={})[th.PORTRAIT]=_i.IDENTITY,eN[th.LANDSCAPE_RIGHT]=_i.ROTATE_90,eN[th.PORTRAIT_UPSIDE_DOWN]=_i.ROTATE_180,eN[th.LANDSCAPE_LEFT]=_i.ROTATE_270,eN),rN=function(){function t(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t,e){if(this._init(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchain&&(this._swapchain=e.swapchain),this._width=e.width,this._height=e.height,this._renderPass=t.createRenderPass(e.renderPassInfo),e.swapchain)this._setSwapchain(e.swapchain),this._colorTextures.push(e.swapchain.colorTexture),this._depthStencilTexture=e.swapchain.depthStencilTexture;else{for(var n=0;n<e.renderPassInfo.colorAttachments.length;n++)this._colorTextures.push(t.createTexture(new Sr(xi.TEX2D,Ei.COLOR_ATTACHMENT|Ei.SAMPLED|Ei.TRANSFER_SRC,e.renderPassInfo.colorAttachments[n].format,this._width,this._height)));e.renderPassInfo.depthStencilAttachment.format!==pi.UNKNOWN&&(this._depthStencilTexture=t.createTexture(new Sr(xi.TEX2D,Ei.DEPTH_STENCIL_ATTACHMENT|Ei.SAMPLED,e.renderPassInfo.depthStencilAttachment.format,this._width,this._height)))}return this._setFrameBuffer(t.createFramebuffer(new Vr(this._renderPass,this._colorTextures,this._depthStencilTexture))),!0},e.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._destroy()},e.resize=function(t,e){if(this._swapchain)this._swapchain.resize(t,e,iN[ah.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(t,e);this._depthStencilTexture&&this._depthStencilTexture.resize(t,e),this._width=t,this._height=e}this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer.initialize(new Vr(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var i,r=ot(this._cameras);!(i=r()).done;)i.value.resize(t,e)},e.extractRenderCameras=function(t){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];n.enabled&&(n.update(),t.push(n))}},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortCameras()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.sortCameras=function(){this._cameras.sort((function(t,e){return t.priority-e.priority}))},e._init=function(){},e._destroy=function(){},e._setSwapchain=function(t){this._swapchain=t},e._setFrameBuffer=function(t){this._framebuffer=t},Q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"native",get:function(){return this._nativeObj}}]),t}(),aN=function(){var t=e.prototype;function e(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=t,this._dataPoolMgr=l.internal.DataPoolManager&&new l.internal.DataPoolManager(t),zy.registerCreateFunc(this),rN.registerCreateFunc(this),this._cameraPool=new Hl((function(){return new cv(e._device)}),4,(function(t){return t.destroy()}))}return t._init=function(){},t._destroy=function(){},t._setCumulativeTime=function(t){this._cumulativeTime+=t},t._setFrameTime=function(t){this._frameTime=t},t.initialize=function(){this._init();var t=l.game._swapchain,e=new Lr;e.format=t.colorTexture.format;var n=new Fr;n.format=t.depthStencilTexture.format,n.depthStoreOp=Bi.DISCARD,n.stencilStoreOp=Bi.DISCARD;var i=new Ur([e],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:t.width,height:t.height,renderPassInfo:i,swapchain:t}),this._curWindow=this._mainWindow,Promise.resolve(Eg.initBuiltinRes(this._device))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()},t.resize=function(t,e){for(var n,i=ot(this._windows);!(n=i()).done;){var r=n.value;r.swapchain&&r.resize(t,e)}},t.setRenderPipeline=function(t){t instanceof jO&&(this._useDeferredPipeline=!0);var e=!1;if(t||(t=XO(),e=!0),this._pipeline=t,this._useDeferredPipeline&&this.device.hasFeature(di.COMPUTE_SHADER)||(this._pipeline.clusterEnabled=!1),this._pipeline.bloomEnabled=!1,!this._pipeline.activate(this._mainWindow.swapchain))return e&&this._pipeline.destroy(),this._pipeline=null,!1;var n=l.director.getScene();return n&&n.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&l.internal.Batcher2D&&(this._batcher=new l.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._scenes.length;t++)this._scenes[t].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()},t.activeWindow=function(t){this._curWindow=t},t.resetCumulativeTime=function(){this._setCumulativeTime(0)},t.frameMove=function(t){this._setFrameTime(t),++this._frameCount,this._setCumulativeTime(t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var e=0;e<this._scenes.length;++e)this._scenes[e].removeBatches();for(var n=this._windows,i=[],r=0;r<n.length;r++)n[r].extractRenderCameras(i);if(this._pipeline&&i.length>0){this._device.acquire([l.game._swapchain]);var a=this._scenes,o=l.director.getTotalFrames();this._batcher&&(this._batcher.update(),this._batcher.uploadBuffers());for(var s=0;s<a.length;s++)a[s].update(o);l.director.emit(l.Director.EVENT_BEFORE_COMMIT),i.sort((function(t,e){return t.priority-e.priority})),this._pipeline.render(i),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},t.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},t.destroyWindows=function(){for(var t,e=ot(this._windows);!(t=e()).done;)t.value.destroy();this._windows.length=0},t.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},t.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},t.destroyScenes=function(){for(var t,e=ot(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes.length=0},t.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new Hl((function(){return new t}),10,(function(t){return t.destroy()}))),e=this._modelPools.get(t));var n=e.alloc();return n.initialize(),n},t.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.scene&&t.scene.removeModel(t)):R(1300,t.constructor.name),t.destroy()},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new Hl((function(){return new t}),4,(function(t){return t.destroy()}))),e=this._lightPools.get(t));var n=e.alloc();return n.initialize(),n},t.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(e&&(e.free(t),t.scene))switch(t.type){case Sy.SPHERE:t.scene.removeSphereLight(t);break;case Sy.SPOT:t.scene.removeSpotLight(t)}t.destroy()},Q(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(t){this._curWindow=t}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(t){this._tempWindow=t}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();l.Root=aN;var oN=t("Game",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).frame=null,e.container=null,e.canvas=null,e.renderType=-1,e.eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e.config={},e.onStart=null,e.frameTime=1e3/60,e.collisionMatrix=[],e.groupList=[],e._persistRootNodes={},e._gfxDevice=null,e._swapchain=null,e._configLoaded=!1,e._isCloning=!1,e._inited=!1,e._engineInited=!1,e._rendererInitialized=!1,e._paused=!0,e._frameRate=60,e._intervalId=0,e._initTime=0,e._startTime=0,e._deltaTime=0,e._onEngineInitedCallback=[],e}Z(e,t);var i=e.prototype;return i.setFrameRate=function(t){this.frameRate=t},i.getFrameRate=function(){return this.frameRate},i.step=function(){l.director.tick(this.frameTime/1e3)},i.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},i.resume=function(){this._paused&&(RR._clearEvents(),this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._paused=!1,this._updateCallback(),this._intervalId=window.rAF(this._frameCB))},i.isPaused=function(){return this._paused},i.restart=function(){var t=this;return new Promise((function(t){return l.director.once(l.Director.EVENT_END_FRAME,(function(){return t()}))})).then((function(){for(var n in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[n]);return l.director.getScene().destroy(),l.Object._deferredDestroy(),l.director.reset(),l.profiler.reset(),t.pause(),t._setRenderPipelineNShowSplash().then((function(){t.resume(),t._safeEmit(e.EVENT_RESTART)}))}))},i.end=function(){du.close()},i.on=function(t,n,i,r){return(this._engineInited&&t===e.EVENT_ENGINE_INITED||this._inited&&t===e.EVENT_GAME_INITED||this._rendererInitialized&&t===e.EVENT_RENDERER_INITED)&&n.call(i),this.eventTargetOn(t,n,i,r)},i.once=function(t,n,i){return this._engineInited&&t===e.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(t,n,i)},i.init=function(t){var e=this;if(this._initConfig(t),sh._init({configOrientation:t.orientation||"auto",exactFitScreen:t.exactFitScreen}),this.config.assetOptions&&l.assetManager.init(this.config.assetOptions),this.config.layers)for(var i=this.config.layers,r=0;r<i.length;r++){var a=i[r],o=n(a.value);Cd.addLayer(a.name,o)}return this._initEngine().then((function(){return e._initEvents(),l.director.root&&l.director.root.dataPoolManager&&l.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(t.customJointTextureLayouts),e._engineInited}))},i.run=function(t,e){var n,i=this;return"function"!=typeof t&&t?(n=this.init(t),this.onStart=null!=e?e:null):this.onStart=null!=t?t:null,cu.init(),Promise.resolve(n).then((function(){return i._setRenderPipelineNShowSplash()})).then((function(){}))},i.addPersistRootNode=function(t){if(l.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var n=l.director._scene;if(l.isValid(n))if(t.parent){if(!(t.parent instanceof l.Scene))return void R(3801);if(t.parent!==n)return void R(3802);t._originalSceneId=n.uuid}else t.parent=n;this._persistRootNodes[e]=t,t._persistNode=!0,l.assetManager._releaseManager._addPersistNodeRef(t)}}else R(3800)},i.removePersistRootNode=function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,t._originalSceneId="",l.assetManager._releaseManager._removePersistNodeRef(t))},i.isPersistRootNode=function(t){return!!t._persistNode},i.onEngineInitedAsync=function(t){this._onEngineInitedCallback.push(t)},i._initEngine=function(){var t=this;this._initDevice();var n=l.director;return Promise.resolve(n._init()).then((function(){l.view.init(),y("Cocos Creator v"+u),t.emit(e.EVENT_ENGINE_INITED),t._engineInited=!0,l.internal.dynamicAtlasManager&&(l.internal.dynamicAtlasManager.enabled=!he.CLEANUP_IMAGE_CACHE)})).then((function(){var e=t._onEngineInitedCallback.map((function(t){return t()})).filter(Boolean);return t._onEngineInitedCallback.length=0,Promise.all(e)}))},i._setAnimFrame=function(){var t=this._frameRate,e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.rAF=this._stTime.bind(this),window.cAF=this._ctTime):(window.rAF=e||this._stTime.bind(this),window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime,this._updateCallback())},i._stTime=function(t){var e=performance.now(),n=Math.max(0,e-this._startTime),i=Math.max(0,this.frameTime-n);return window.setTimeout(t,i)},i._ctTime=function(t){window.clearTimeout(t)},i._calculateDT=function(t){return t||(t=performance.now()),this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>e.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},i._updateCallback=function(){var t,e=this,n=l.director;if(30===this._frameRate){var i=!0;t=function(t){e._intervalId=window.rAF(e._frameCB),(i=!i)||n.tick(e._calculateDT(t))}}else t=function(t){n.tick(e._calculateDT(t)),e._intervalId=window.rAF(e._frameCB)};this._frameCB=t},i._runMainLoop=function(){if(this._inited){var t=this.config,e=l.director;z(!!t.showFPS),e.startAnimation(),this.resume()}},i._initConfig=function(t){"number"!=typeof t.debugMode&&(t.debugMode=N.NONE),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>3||e<0)&&(t.renderMode=0),t.showFPS=!!t.showFPS,A(t.debugMode),this.config=t,this._configLoaded=!0,this.frameRate=t.frameRate},i._determineRenderType=function(){var t=this.config,n=parseInt(t.renderMode,10);this.renderType=e.RENDER_TYPE_CANVAS;var i=!1;if(1===n?(this.renderType=e.RENDER_TYPE_CANVAS,i=!0):0===n||2===n?(this.renderType=e.RENDER_TYPE_WEBGL,i=!0):3===n&&(this.renderType=e.RENDER_TYPE_HEADLESS,i=!0),!i)throw new Error(F(3820,n))},i._initDevice=function(){if(!this._rendererInitialized){var t=this.config.adapter;if(t&&(this.canvas=t.canvas,this.frame=t.frame,this.container=t.container),this._determineRenderType(),this.renderType===e.RENDER_TYPE_WEBGL){var n=new dr(Gd),i=!!window.WebGL2RenderingContext,r=window.navigator.userAgent.toLowerCase();(-1!==r.indexOf("safari")&&-1===r.indexOf("chrome")||ch.browserType===nu.UC)&&(i=!1);var a=[];i&&l.WebGL2Device&&a.push(l.WebGL2Device),l.WebGLDevice&&a.push(l.WebGLDevice),l.EmptyDevice&&a.push(l.EmptyDevice),pa.canvas=this.canvas;for(var o=0;o<a.length&&(this._gfxDevice=new a[o],!this._gfxDevice.initialize(n));o++);}else this.renderType===e.RENDER_TYPE_HEADLESS&&l.EmptyDevice&&(this._gfxDevice=new l.EmptyDevice,this._gfxDevice.initialize(new dr(Gd)));if(!this._gfxDevice)return T("can not support canvas rendering in 3D"),void(this.renderType=e.RENDER_TYPE_CANVAS);var s=new _r(this.canvas),c=sh.windowSize;s.width=c.width,s.height=c.height,this._swapchain=this._gfxDevice.createSwapchain(s),this.canvas.oncontextmenu=function(){return!1}}},i._initEvents=function(){du.on("show",this._onShow,this),du.on("hide",this._onHide,this)},i._onHide=function(){this.emit(e.EVENT_HIDE),this.pause()},i._onShow=function(){this.emit(e.EVENT_SHOW),this.resume()},i._setRenderPipelineNShowSplash=function(){var t=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(t._showSplashScreen()).then((function(){t._inited=!0,t._initTime=performance.now(),t._runMainLoop(),t._safeEmit(e.EVENT_GAME_INITED),t.onStart&&t.onStart()}))}))},i._setupRenderPipeline=function(){var t=this,e=this.config.renderPipeline;return e?new Promise((function(t,n){l.assetManager.loadAny(e,(function(e,i){return!e&&i instanceof aT?t(i):n(e)}))})).then((function(e){t._setRenderPipeline(e)})).catch((function(n){S(n),S("Failed load render pipeline: "+e+", engine failed to initialize, will fallback to default pipeline"),t._setRenderPipeline()})):this._setRenderPipeline()},i._showSplashScreen=function(){if(l.internal.SplashScreen){var t=l.internal.SplashScreen.instance;return t.main(l.director.root),new Promise((function(e){t.setOnFinish((function(){return e()})),t.loadFinish=!0}))}return null},i._setRenderPipeline=function(t){l.director.root.setRenderPipeline(t)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(e.EVENT_RENDERER_INITED)},i._safeEmit=function(t){this.emit(t)},Q(e,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this._frameRate=t,this.frameTime=1e3/t,this._setAnimFrame()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),e}(tu));oN.EVENT_HIDE="game_on_hide",oN.EVENT_SHOW="game_on_show",oN.EVENT_LOW_MEMORY="game_on_low_memory",oN.EVENT_GAME_INITED="game_inited",oN.EVENT_ENGINE_INITED="engine_inited",oN.EVENT_RENDERER_INITED="renderer_inited",oN.EVENT_RESTART="game_on_restart",oN.RENDER_TYPE_CANVAS=0,oN.RENDER_TYPE_WEBGL=1,oN.RENDER_TYPE_OPENGL=2,oN.RENDER_TYPE_HEADLESS=3,oN.DEBUG_DT_THRESHOLD=1,l.Game=oN;var sN=t("game",l.game=new oN),cN=t("Director",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._scheduler=new nN,e._compScheduler=new iD,e._nodeActivator=new TD,e._systems=[],sN.once(oN.EVENT_RENDERER_INITED,e._initOnRendererInitialized,rt(e)),e}Z(e,t);var n=e.prototype;return n.calculateDeltaTime=function(){},n.end=function(){var t=this;this.once(e.EVENT_END_FRAME,(function(){t.purgeDirector()}))},n.pause=function(){this._paused||(this._paused=!0)},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),l.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),l.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),this.startAnimation()},n.runSceneImmediate=function(t,e,n){t instanceof xD&&(t=t.scene),L(t instanceof GR,1216),t._load();for(var i=Object.keys(sN._persistRootNodes).map((function(t){return sN._persistRootNodes[t]})),r=0;r<i.length;r++){var a=i[r];a.emit(l.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var o=t.uuid===a._originalSceneId&&t.getChildByUuid(a.uuid);if(o){var s=o.getSiblingIndex();o._destroyImmediate(),t.insertChild(a,s)}else a.parent=t}var c=this._scene;l.isValid(c)&&c.destroy(),l.assetManager._releaseManager._autoRelease(c,t,sN._persistRootNodes),this._scene=null,_l._deferredDestroy(),e&&e(),this.emit(l.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,t),this.emit(l.Director.EVENT_AFTER_SCENE_LAUNCH,t)},n.runScene=function(t,e,n){var i=this;t instanceof xD&&(t=t.scene),L(t,1205),L(t instanceof GR,1216),t._load(),this.once(l.Director.EVENT_END_FRAME,(function(){i.runSceneImmediate(t,e,n)}))},n.loadScene=function(t,e,n){var i=this;if(this._loadingScene)return R(1208,t,this._loadingScene),!1;var r=l.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));return r?(this.emit(l.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),r.loadScene(t,(function(r,a){console.timeEnd("LoadScene "+t),i._loadingScene="",r?(T(r),e&&e(r)):i.runSceneImmediate(a,n,e)})),!0):(O(1209,t),!1)},n.preloadScene=function(t,e,n){var i=l.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));if(i)i.preloadScene(t,null,e,n);else{var r='Can not preload the scene "'+t+'" because it is not in the build settings.';n&&n(new Error(r)),T("preloadScene: "+r)}},n.resume=function(){this._paused&&(this._paused=!1)},n.getScene=function(){return this._scene},n.getDeltaTime=function(){return sN.deltaTime},n.getTotalTime=function(){return sN.totalTime},n.getCurrentTime=function(){return sN.frameStartTime},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(nN.ID,t,200))},n.registerSystem=function(t,e,n){e.id=t,e.priority=n,e.init(),this._systems.push(e),this._systems.sort(KO.sortByPriority)},n.unregisterSystem=function(t){ne.fastRemove(this._systems,t),this._systems.sort(KO.sortByPriority)},n.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},n.getAnimationManager=function(){return this.getSystem(l.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(t){var e;e=sN._calculateDT(t),this.tick(e)},n.tick=function(t){if(!this._invalid){if(this.emit(e.EVENT_BEGIN_FRAME),RR._frameDispatchEvents(),!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var n=0;n<this._systems.length;++n)this._systems[n].update(t);this._compScheduler.lateUpdatePhase(t),this.emit(e.EVENT_AFTER_UPDATE),_l._deferredDestroy();for(var i=0;i<this._systems.length;++i)this._systems[i].postUpdate(t)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(t),this.emit(e.EVENT_AFTER_DRAW),ob.resetHasChangedFlags(),ob.clearNodeArray(),Gl.update(t),this.emit(e.EVENT_END_FRAME),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._paused=!1,this.registerSystem(nN.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},n._init=function(){return this._root=new aN(sN._gfxDevice),this._root.initialize({}).catch((function(t){return O(1217),Promise.reject(t)}))},Q(e,[{key:"root",get:function(){return this._root}}]),e}(tu));cN.EVENT_INIT="director_init",cN.EVENT_RESET="director_reset",cN.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cN.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cN.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cN.EVENT_BEFORE_UPDATE="director_before_update",cN.EVENT_AFTER_UPDATE="director_after_update",cN.EVENT_BEFORE_DRAW="director_before_draw",cN.EVENT_AFTER_DRAW="director_after_draw",cN.EVENT_BEFORE_COMMIT="director_before_commit",cN.EVENT_BEFORE_PHYSICS="director_before_physics",cN.EVENT_AFTER_PHYSICS="director_after_physics",cN.EVENT_BEGIN_FRAME="director_begin_frame",cN.EVENT_END_FRAME="director_end_frame",cN.instance=void 0,l.Director=cN;var lN=t("director",cN.instance=l.director=new cN),uN={};U(uN,"vmath",[{name:"vec2",newName:"Vec2",target:li,targetName:"math"},{name:"vec3",newName:"Vec3",target:li,targetName:"math"},{name:"vec4",newName:"Vec4",target:li,targetName:"math"},{name:"quat",newName:"Quat",target:li,targetName:"math"},{name:"mat3",newName:"Mat3",target:li,targetName:"math"},{name:"mat4",newName:"Mat4",target:li,targetName:"math"},{name:"color4",newName:"Color",target:li,targetName:"math"},{name:"rect",newName:"Rect",target:li,targetName:"math"},{name:"approx",newName:"approx",target:li,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:li,targetName:"math"},{name:"equals",newName:"equals",target:li,targetName:"math"},{name:"clamp",newName:"clamp",target:li,targetName:"math"},{name:"clamp01",newName:"clamp01",target:li,targetName:"math"},{name:"lerp",newName:"lerp",target:li,targetName:"math"},{name:"toRadian",newName:"toRadian",target:li,targetName:"math"},{name:"toDegree",newName:"toDegree",target:li,targetName:"math"},{name:"random",newName:"random",target:li,targetName:"math"},{name:"randomRange",newName:"randomRange",target:li,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:li,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:li,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:li,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:li,targetName:"math"},{name:"repeat",newName:"repeat",target:li,targetName:"math"},{name:"pingPong",newName:"pingPong",target:li,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:li,targetName:"math"}]),l.vmath=uN,U(nN.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:nN,targetName:"Scheduler"}]),U(nN,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return KO.Priority.SCHEDULER}}]),k(nN,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),U(ty.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),k(ty.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),U(aN.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),G(sN,"game",[{name:"collisionMatrix"},{name:"groupList"}]),G(cN.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),k(cN.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]);var hN,fN={topLeft:l.v2(0,0),topRight:l.v2(0,0),top:l.v2(0,0),bottomLeft:l.v2(0,0),bottomRight:l.v2(0,0),bottom:l.v2(0,0),center:l.v2(0,0),left:l.v2(0,0),right:l.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,n=this.height=t.height,i=t.x,r=t.y,a=r+n,o=i+e;this.topLeft.x=i,this.topLeft.y=a,this.topRight.x=o,this.topRight.y=a,this.top.x=i+e/2,this.top.y=a,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=i+e/2,this.bottom.y=r,this.center.x=i+e/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=o,this.right.y=r+n/2}};l.visibleRect=fN;var _N=new ii,dN=((hN={})[he.ORIENTATION_AUTO]=th.AUTO,hN[he.ORIENTATION_LANDSCAPE]=th.LANDSCAPE,hN[he.ORIENTATION_PORTRAIT]=th.PORTRAIT,hN),pN=t("View",function(t){function e(){var e;(e=t.call(this)||this)._designResolutionSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;var n=mN,i=gN;return e._designResolutionSize=new ii(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new ai(0,0,0,0),e._visibleRect=new ai(0,0,0,0),e._autoFullScreen=!1,e._retinaEnabled=!1,e._resizeCallback=null,e._rpExactFit=new vN(n.EQUAL_TO_FRAME,i.EXACT_FIT),e._rpShowAll=new vN(n.EQUAL_TO_FRAME,i.SHOW_ALL),e._rpNoBorder=new vN(n.EQUAL_TO_FRAME,i.NO_BORDER),e._rpFixedHeight=new vN(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),e._rpFixedWidth=new vN(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,e}Z(e,t);var n=e.prototype;return n.init=function(){var t=sh.windowSize,e=t.width,n=t.height;this._designResolutionSize.width=e,this._designResolutionSize.height=n,this._viewportRect.width=e,this._viewportRect.height=n,this._visibleRect.width=e,this._visibleRect.height=n,_N.width=this._visibleRect.width,_N.height=this._visibleRect.height,fN&&fN.init(this._visibleRect),ah.on("window-resize",this._updateAdaptResult,this),ah.on("orientation-change",this._updateAdaptResult,this),ah.on("fullscreen-change",this._updateAdaptResult,this)},n.resizeWithBrowserSize=function(t){ah.handleResizeEvent=t},n.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},n.setOrientation=function(t){ah.orientation=dN[t]},n.adjustViewportMeta=function(){},n.enableRetina=function(t){this._retinaEnabled=!!t},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(t){t!==this._autoFullScreen&&(this._autoFullScreen=t,t&&sh.requestFullScreen().catch((function(){})))},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(t,e){ah.resolutionScale=1;var n=ah.devicePixelRatio,i=new ii(t*n,e*n);sh.windowSize=i},n.getCanvasSize=function(){return sh.windowSize},n.getFrameSize=function(){var t=ah.devicePixelRatio,e=sh.windowSize;return e.width/=t,e.height/=t,e},n.setFrameSize=function(t,e){var n=ah.devicePixelRatio;sh.windowSize=new ii(t*n,e*n)},n.getVisibleSize=function(){return new ii(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new ii(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new Qn(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new Qn(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n._updateResolutionPolicy=function(t){if(t instanceof vN)this._resolutionPolicy=t;else{var e=vN;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setResolutionPolicy=function(t){this._updateResolutionPolicy(t);var e=yN.getDesignResolutionSize();yN.setDesignResolutionSize(e.width,e.height,t)},n.setDesignResolutionSize=function(t,e,n){if(t>0&&e>0){this._updateResolutionPolicy(n);var i=this._resolutionPolicy;i&&i.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=e;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var a=this._viewportRect,o=this._visibleRect,s=r.viewport;a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,o.x=0,o.y=0,o.width=s.width/this._scaleX,o.height=s.height/this._scaleY}i.postApply(this),_N.width=this._visibleRect.width,_N.height=this._visibleRect.height,fN&&fN.init(this._visibleRect),this.emit("design-resolution-changed")}else O(2200)},n.getDesignResolutionSize=function(){return new ii(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(t,e,n){document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return ah.devicePixelRatio},n.convertToLocationInView=function(t,e,n,i){void 0===i&&(i=new Qn);var r=ah.devicePixelRatio*(t-n.left),a=ah.devicePixelRatio*(n.top+n.height-e);return ah.isFrameRotated?(i.x=sh.windowSize.width-a,i.y=r):(i.x=r,i.y=a),i},n._convertToUISpace=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},n._updateAdaptResult=function(){var t;l.director.root.resize(sh.windowSize.width,sh.windowSize.height);var e=this._designResolutionSize.width,n=this._designResolutionSize.height;e>0&&this.setDesignResolutionSize(e,n,this._resolutionPolicy),this.emit("canvas-resize"),null===(t=this._resizeCallback)||void 0===t||t.call(this)},e}(tu));pN.instance=void 0;var mN=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupCanvas=function(){var t=sN.canvas;if(t){var e=sh.windowSize;t.width=e.width,t.height=e.height}},t}();mN.EQUAL_TO_FRAME=void 0,mN.PROPORTION_TO_FRAME=void 0;var gN=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,n,i,r,a){Math.abs(t-n)<2&&(n=t),Math.abs(e-i)<2&&(i=e);var o=new ai(Math.round((t-n)/2),Math.round((e-i)/2),n,i);return this._result.scale=[r,a],this._result.viewport=o,this._result},t}();gN.EXACT_FIT=void 0,gN.SHOW_ALL=void 0,gN.NO_BORDER=void 0,gN.FIXED_HEIGHT=void 0,gN.FIXED_WIDTH=void 0,function(){var t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="EqualToFrame",e}return Z(e,t),e.prototype.apply=function(){ah.isProportionalToFrame=!1,this._setupCanvas()},e}(mN),e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ProportionalToFrame",e}return Z(e,t),e.prototype.apply=function(){ah.isProportionalToFrame=!0,this._setupCanvas()},e}(mN);mN.EQUAL_TO_FRAME=new t,mN.PROPORTION_TO_FRAME=new e;var n=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ExactFit",e}return Z(e,t),e.prototype.apply=function(t,e){var n=sh.windowSize,i=n.width,r=n.height,a=i/e.width,o=r/e.height;return this._buildResult(i,r,i,r,a,o)},e}(gN),i=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ShowAll",e}return Z(e,t),e.prototype.apply=function(t,e){var n,i,r=sh.windowSize,a=r.width,o=r.height,s=e.width,c=e.height,l=a/s,u=o/c,h=0;return l<u?(n=a,i=c*(h=l)):(n=s*(h=u),i=o),this._buildResult(a,o,n,i,h,h)},e}(gN),r=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="NoBorder",e}return Z(e,t),e.prototype.apply=function(t,e){var n,i,r,a=sh.windowSize,o=a.width,s=a.height,c=e.width,l=e.height,u=o/c,h=s/l;return u<h?(i=c*(n=h),r=s):(i=o,r=l*(n=u)),this._buildResult(o,s,i,r,n,n)},e}(gN),a=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedHeight",e}return Z(e,t),e.prototype.apply=function(t,e){var n=sh.windowSize,i=n.width,r=n.height,a=r/e.height,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(gN),o=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedWidth",e}return Z(e,t),e.prototype.apply=function(t,e){var n=sh.windowSize,i=n.width,r=n.height,a=i/e.width,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(gN);gN.EXACT_FIT=new n,gN.SHOW_ALL=new i,gN.NO_BORDER=new r,gN.FIXED_HEIGHT=new a,gN.FIXED_WIDTH=new o}();var vN=t("ResolutionPolicy",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof mN&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof gN&&(this._contentStrategy=t)},Q(t,[{key:"canvasSize",get:function(){return sh.windowSize}}]),t}());vN.EXACT_FIT=0,vN.NO_BORDER=1,vN.SHOW_ALL=2,vN.FIXED_HEIGHT=3,vN.FIXED_WIDTH=4,vN.UNKNOWN=5,vN.ContainerStrategy=mN,vN.ContentStrategy=gN,l.ResolutionPolicy=vN;var yN=t("view",pN.instance=l.view=new pN);l.winSize=_N,k(pN.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),G(pN.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"}]),G(l,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),G(ch,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),U(ch,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(t){return{name:"LANGUAGE_"+t,newName:t,target:ch.Language,targetName:"sys.Language"}}))),U(ch,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(t){return{name:"OS_"+t,newName:t,target:ch.OS,targetName:"sys.OS"}}))),U(ch,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(t){return{name:"BROWSER_TYPE_"+t,newName:t,target:ch.BrowserType,targetName:"sys.BrowserType"}}))),U(ch,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:ch.BrowserType,targetName:"sys.BrowserType"}]),U(ch,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((function(t){return{name:t,target:ch.Platform,targetName:"sys.Platform"}}))),U(ch,"sys",[{name:"IPHONE",newName:"IOS",target:ch.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:ch.Platform,targetName:"sys.Platform"}]),k(ch,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(t){return{name:t}}))),U(ch,"sys",[{name:"windowPixelResolution",target:sh,targetName:"screen",newName:"windowSize"}]),G(sh,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);var SN=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new ml,this.scenes=new ml,this.paths=new ml}var e=t.prototype;return e.init=function(t){var e=this;!function(t){var e=t.uuids,n=t.paths,i=t.types,r=t.deps,a=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,s=e.length;o<s;o++)e[o]=Nl(e[o]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),f=0,_=e.length;f<_;f++){var d=e[f];e[f]=h[d]=Nl(d)}e=h}for(var p in n){var m=n[p];a[e[p]]=m}var g=t.scenes;for(var v in g){var y=g[v];g[v]=e[y]}var S=t.packs;for(var T in S)for(var x=S[T],E=0;E<x.length;++E)x[E]=e[x[E]];var A=t.versions;if(A)for(var C in A)for(var b=A[C],w=0;w<b.length;w+=2){var I=b[w];b[w]=e[I]||I}var P=t.redirect;if(P)for(var R=0;R<P.length;R+=2)P[R]=e[P[R]],P[R+1]=r[P[R+1]];if(t.extensionMap){var D=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(i,r){t.extensionMap[n][r]=e[i]||i}))};for(var O in t.extensionMap)D(O)}}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(t){var i=e.assetInfos.get(t);i&&(i.extension=n)}))};for(var i in t.extensionMap)n(i)},e.getInfoWithPath=function(t,e){if(!t)return null;t=zl(t);var n=this.paths.get(t);if(n){if(!e)return n[0];for(var i=0,r=n.length;i<r;i++){var a=n[i];if(ie.isChildClassOf(a.ctor,e))return a}}return null},e.getDirWithPath=function(t,e,n){"/"===(t=zl(t))[t.length-1]&&(t=t.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(r,t)||!t)for(var a=0,o=n.length;a<o;a++){var s=n[a];e&&!ie.isChildClassOf(s.ctor,e)||i.push(s)}})),i},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,n){return n.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,n=t.length;e<n;e++){var i=t[e];this.assetInfos.add(i,{uuid:i})}}},e._initPath=function(t){if(t){var e=this.paths;for(var n in e.clear(),t){var i=t[n],r=i[0],a=i[1],o=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=ie._getClassById(a),e.has(r)?o?e.get(r).push(s):e.get(r).unshift(s):e.add(r,[s])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var n=this.assetInfos;for(var i in t){var r=t[i],a=n.get(r);a.url=i,e.add(i,a)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var n in t){var i=t[n],r={uuid:n,packedUuids:i,ext:".json"};e.add(n,r);for(var a=0,o=i.length;a<o;a++){var s=i[a],c=e.get(s),l=c.packs;l?1===o?l.unshift(r):l.push(r):c.packs=[r]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,n=t.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var a=n[i];e.get(a).ver=n[i+1]}if(n=t.native)for(var o=0,s=n.length;o<s;o+=2){var c=n[o];e.get(c).nativeVer=n[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,n=0,i=t.length;n<i;n+=2){var r=t[n];e.get(r).redirect=t[n+1]}},t}();function TN(t,e){t._uuid&&e.push(t._uuid)}function xN(t,e){for(var n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var a=t[r];if("object"==typeof a&&a)if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];s instanceof Du&&TN(s,e)}else if(a.constructor&&a.constructor!==Object)a instanceof Du&&TN(a,e);else for(var c=Object.getOwnPropertyNames(a),l=0;l<c.length;l++){var u=a[c[l]];u instanceof Du&&TN(u,e)}}}}function EN(t,e){for(var n=0;n<t._components.length;n++)xN(t._components[n],e);for(var i=0;i<t._children.length;i++)EN(t._children[i],e)}function AN(t,e,n,i){n.push(t._uuid);for(var r=Jm.getDeps(t._uuid),a=0,o=r.length;a<o;a++){var s=yl.get(r[a]);if(s){var c=s._uuid;c in e?e[c]+=i:e[c]=s.refCount+i,n.includes(c)||AN(s,e,n,i)}}}var CN=[],bN=new(function(){function t(){this._persistNodeDeps=new ml,this._toDelete=new ml,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];EN(t,e);for(var n=0,i=e.length;n<i;n++){var r=yl.get(e[n]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),n=0,i=e.length;n<i;n++){var r=yl.get(e[n]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,n){if(t){for(var i=Jm.getDeps(t.uuid),r=0,a=i.length;r<a;r++){var o=yl.get(i[r]);o&&o.decRef(t.autoReleaseAssets)}var s=Jm._depends.get(t.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=yl.get(c[l]);h&&h.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&Jm.remove(t.uuid)}var f=Jm._depends.get(e.uuid);for(var _ in f&&(f.persistDeps=[]),n){for(var d,p,m=n[_],g=this._persistNodeDeps.get(m.uuid),v=ot(g);!(p=v()).done;){var y=p.value,S=yl.get(y);S&&S.addRef()}f&&(d=f.persistDeps).push.apply(d,g)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof Du&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,Te(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var n=t._uuid;if(this._toDelete.remove(n),pl(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,AN(t,e,CN,-1),CN.length=0,0!==e[t._uuid])return e[t._uuid];for(var n in e)0!==e[n]&&AN(yl.get(n),e,CN,1);return CN.length=0,e[t._uuid]}(t)>0)){yl.remove(n);for(var i=Jm.getDeps(n),r=0,a=i.length;r<a;r++){var o=yl.get(i[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),Jm.remove(n)}},t}()),wN=null;function IN(t,e){for(var n=0,i=t.input.length;n<i;n++){var r=t.input[n];e&&!r.isNative&&r.content instanceof Du&&r.content.decRef(!1),r.recycle()}t.input=null}function PN(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function RN(t,e,n,i,r){void 0===r&&(r=0),t(r,(function(a,o){r++,!a||r>e?i&&i(a,o):setTimeout((function(){RN(t,e,n,i,r)}),n)}))}function DN(t,e,n,i,r){try{for(var a=Jm.parse(t,e),o=0,s=a.deps.length;o<s;o++){var c=a.deps[o];c in n||(n[c]=!0,i.push({uuid:c,bundle:r&&r.name}))}a.nativeDep&&(r&&(a.nativeDep.bundle=r.name),i.push(J({},a.nativeDep)))}catch(t){T(t.message,t.stack)}}function ON(t,e,n){e&&(n=void 0!==n?n:l.assetManager.cacheAsset,Bl(e)||!n||e.isDefault||yl.add(t,e))}function NN(t,e,n){var i=0,r=[],a=t.length;0===a&&n&&n(r);for(var o=function(t){t&&r.push(t),++i===a&&n&&n(r)},s=0;s<a;s++)e(t[s],o)}function MN(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o="function"==typeof t;e?(a=e,o||(r=null)):void 0===e&&o&&(a=t,i=null,r=null),void 0!==e&&o&&(r=t,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:a}}function LN(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o=ie.isChildClassOf(t,Du);e?(a=e,o&&(r=null)):void 0!==e||o||(a=t,r=null,i=null),void 0===e||o||(r=t,i=null)}return{type:i,onProgress:r||wN,onComplete:a}}function FN(t,e,n,i){if(void 0===i&&(i={}),!n[e]||i[e])return!1;i[e]=!0;var r=!1,a=Jm.getDeps(e);if(a)for(var o=0,s=a.length;o<s;o++){var c=a[o];if(c===t||FN(t,c,n,i)){r=!0;break}}return r}function BN(t){return function(e,n){if(t){var i=[];Array.isArray(n)?n.forEach((function(t){return t instanceof Du&&i.push(t.addRef())})):n instanceof Du&&i.push(n.addRef()),Te((function(){i.forEach((function(t){return t.decRef(!1)})),t(e,n)}))}}}var zN=function(){function t(){this._config=new SN}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,n){return this._config.getDirWithPath(t,e,n)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),xl.add(t.name,this)},e.load=function(t,e,n,i){var r=LN(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete,c={__requestType__:vl.PATH,type:a,bundle:this.name,__outputAsArray__:Array.isArray(t)};l.assetManager.loadAny(t,c,o,s)},e.preload=function(t,e,n,i){var r=LN(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;l.assetManager.preloadAny(t,{__requestType__:vl.PATH,type:a,bundle:this.name},o,s)},e.loadDir=function(t,e,n,i){var r=LN(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;l.assetManager.loadAny(t,{__requestType__:vl.DIR,type:a,bundle:this.name,__outputAsArray__:!0},o,s)},e.preloadDir=function(t,e,n,i){var r=LN(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;l.assetManager.preloadAny(t,{__requestType__:vl.DIR,type:a,bundle:this.name},o,s)},e.loadScene=function(t,e,n,i){var r=MN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"scene",a.bundle=this.name,l.assetManager.loadAny({scene:t},a,o,(function(t,e){if(t)T(t.message,t.stack);else if(e instanceof xD&&e.scene){var n=e.scene;n._id=e._uuid,n.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");s&&s(t,e)}))},e.preloadScene=function(t,e,n,i){var r=MN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.bundle=this.name,l.assetManager.preloadAny({scene:t},a,o,(function(e){e&&O(1210,t,e.message),s&&s(e)}))},e.get=function(t,e){var n=this.getInfoWithPath(t,e);return n&&yl.get(n.uuid)||null},e.release=function(t,e){var n=this.get(t,e);n&&bN.tryRelease(n,!0)},e.releaseUnusedAssets=function(){var t=this;yl.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&bN.tryRelease(e)}))},e.releaseAll=function(){var t=this;yl.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&bN.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},Q(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),UN=t("resources",new zN);function kN(t,e,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(null,i)}function a(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(new Error(F(4930,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",a),i.src=t,i}function GN(t,e,n,i){var r=new XMLHttpRequest,a="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+a+r.status+"(no response)"))},n&&(r.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),r.onerror=function(){i&&i(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+a+r.status+"(abort)"))},r.send(null),r}l.resources=UN;var VN={};function HN(t,e,n){if(VN[t])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),VN[t]=!0,n&&n(null)}function a(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),n&&n(new Error(F(4928,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=e.scriptAsyncLoading||!1,i.src=t,i.addEventListener("load",r,!1),i.addEventListener("error",a,!1),document.body.appendChild(i),i}var WN=/^(?:\w+:\/\/|\.+\/).+/,jN=function(t,e,n){(ch.hasFeature(ch.Feature.IMAGE_BITMAP)&&l.assetManager.allowImageBitmap?XN:kN)(t,e,n)},XN=function(t,e,n){e.xhrResponseType="blob",GN(t,e,e.onFileProgress,n)},qN=function(t,e,n){e.xhrResponseType="json",GN(t,e,e.onFileProgress,n)},YN=function(t,e,n){e.xhrResponseType="arraybuffer",GN(t,e,e.onFileProgress,n)},KN=function(t,e,n){qN(t,e,(function(e,i){if(e)n(e);else{var r=fh(i);Promise.all(r.chunks.map((function(n){return new Promise((function(i,r){YN(""+Su(t)+n,{},(function(t,n){e?r(e):i(new Uint8Array(n))}))}))}))).then((function(t){var e=new hh(r.document,t);n(null,e)})).catch((function(t){n(t)}))}}))},QN=function(t,e,n){YN(t,e,(function(t,e){if(t)n(t);else try{var i=_h(new Uint8Array(e));n(null,i)}catch(t){n(t)}}))},JN=function(t,e,n){e.xhrResponseType="text",GN(t,e,e.onFileProgress,n)},ZN=function(t,e,n){var i=Tu(t),r=t;WN.test(r)||(r=-1!==$N.remoteBundles.indexOf(i)?$N.remoteServerAddress+"remote/"+i:"assets/"+i);var a=e.version||$N.bundleVers[i],o=0,s=null,c=null;qN(r+"/config."+(a?a+".":"")+"json",e,(function(t,e){c=t,(s=e)&&(s.base=r+"/"),2==++o&&n(c,s)})),HN(r+"/index."+(a?a+".":"")+"js",e,(function(t){c=t,2==++o&&n(t,s)}))},$N=new(function(){function t(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=kN,this.downloadDomAudio=null,this.downloadFile=GN,this.downloadScript=HN,this._downloaders={".png":jN,".jpg":jN,".bmp":jN,".jpeg":jN,".gif":jN,".ico":jN,".tiff":jN,".webp":jN,".image":jN,".pvr":YN,".pkm":YN,".astc":YN,".txt":JN,".xml":JN,".vsh":JN,".fsh":JN,".atlas":JN,".tmx":JN,".tsx":JN,".json":qN,".ExportJson":qN,".plist":JN,".ccon":KN,".cconb":QN,".fnt":JN,".binary":YN,".bin":YN,".dbbin":YN,".skel":YN,".js":HN,bundle:ZN,default:JN},this._downloading=new ml,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var e=t.prototype;return e.init=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=n},e.register=function(t,e){"object"==typeof t?Ut(this._downloaders,t):this._downloaders[t]=e},e.download=function(t,e,n,i,r){var a=this,o=Sl.get(t);if(o)r(null,o);else{var s=this._downloading.get(t);if(s){s.push(r);var c=this._queue.find((function(e){return e.id===t}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,f=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,_=this._downloaders[n]||this._downloaders.default;RN((function(n,o){if(0===n&&a._downloading.add(t,[r]),a.limited){a._updateTime();var s=function(t,e){a._totalNum--,a._handleQueueInNextFrame(h,f),o(t,e)};a._totalNum<h&&a._totalNumThisPeriod<f?(_(PN(e,a.appendTimeStamp),i,s),a._totalNum++,a._totalNumThisPeriod++):(a._queue.push({id:t,priority:i.priority||0,url:e,options:i,done:s,handler:_}),a._queueDirty=!0,a._totalNum<h&&a._handleQueueInNextFrame(h,f))}else _(PN(e,a.appendTimeStamp),i,o)}),u,this.retryInterval,(function(e,n){e||Sl.add(t,n);for(var i=a._downloading.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))}}},e.loadSubpackage=function(t,e){l.assetManager.loadBundle(t,null,e)},e._updateTime=function(){var t=performance.now(),e=l.game.deltaTime,n=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=t)},e._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(PN(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(t,e)},e._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(Te(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},Q(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}());function tM(t,e,n,i){var r=null,a=null;try{(r=new jm)._nativeUrl=t,r._nativeAsset=e}catch(t){a=t}i(a,r)}function eM(t,e,n,i){var r=new ID;r.json=e,i(null,r)}function nM(t,e,n,i){var r=new wD;r.text=e,i(null,r)}function iM(t,e,n,i){var r=new Kb;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function rM(t,e,n,i){var r=new Du;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function aM(t,n,i,r){var a=xl.get(n.name);a||(a=n.name===bl.RESOURCES?UN:new zN,n.base=n.base||t+"/",a.init(n)),e.import("virtual:///prerequisite-imports/"+a.name).then((function(){r(null,a)})).catch(r)}var oM=new(function(){function t(){this._creating=new ml,this._producers={".png":tM,".jpg":tM,".bmp":tM,".jpeg":tM,".gif":tM,".ico":tM,".tiff":tM,".webp":tM,".image":tM,".pvr":tM,".pkm":tM,".txt":nM,".xml":nM,".vsh":nM,".fsh":nM,".atlas":nM,".tmx":nM,".tsx":nM,".fnt":nM,".json":eM,".ExportJson":eM,".binary":iM,".bin":iM,".dbbin":iM,".skel":iM,bundle:aM,default:rM}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?ie.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,n,i,r){var a=this,o=this._producers[n]||this._producers.default,s=yl.get(t);if(i.reloadAsset||!s){var c=this._creating.get(t);c?c.push(r):(this._creating.add(t,[r]),o(t,e,i,(function(e,n){!e&&n instanceof Du&&(n._uuid=t,ON(t,n,i.cacheAsset));for(var r=a._creating.remove(t),o=0,s=r.length;o<s;o++)r[o](e,n)})))}else r(null,s)},t}()),sM=new(function(){function t(){this._loading=new ml,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,n,i){var r=ie.createMap(!0),a=null;if(Array.isArray(e)){(e=function(t){if(t[0]<1)throw new Error(F(5304,t[0]));Nh(t,!0,void 0,Lh.reportMissingClass),Mh(t);for(var e=new Fh(t[0]),n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=0;s<o.length;++s)o[s].unshift(e,n,i,r,a);return o}(e)).length!==t.length&&O(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var s=ie._getClassId(dg),c=ie._getClassId(jm);if(e.type===s&&e.data){var l=e.data;l.length!==t.length&&O(4915);for(var u=0;u<t.length;u++)r[t[u]+"@import"]=Bh(s,{base:l[u][0],mipmaps:l[u][1]})}else if(e.type===c&&e.data){var h=e.data;h.length!==t.length&&O(4915);for(var f=0;f<t.length;f++)r[t[f]+"@import"]=h[f]}else a=new Error("unmatched type pack!"),r=null}i(a,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?ie.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,n,i,r){e?(0,this._unpackers[n])(t,e,i,r):r(new Error("package data is wrong!"))},e.load=function(t,e,n){var i=this;if(!t.isNative&&t.info&&t.info.packs)if(Sl.has(t.id))n(null,Sl.get(t.id));else{var r=t.info.packs,a=r.find((function(t){return i._loading.has(t.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:n,id:t.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:n,id:t.id}]);var o=Ul(a.uuid,{ext:a.ext,bundle:t.config.name});$N.download(a.uuid,o,a.ext,t.options,(function(e,n){Sl.remove(a.uuid),e&&T(e.message,e.stack),i.unpack(a.packedUuids,n,a.ext,t.options,(function(t,n){if(!t)for(var r in n)Sl.add(r,n[r]);for(var o=i._loading.remove(a.uuid),s=0,c=o.length;s<c;s++){var l=o[s];if(e||t)l.onComplete(e||t);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else $N.download(t.id,t.url,t.ext,t.options,n)},t}());function cM(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var i=t.options,r=t.progress,a=[],o=r.total,s=i.__exclude__=i.__exclude__||Object.create(null);t.output=[],NN(t.input,(function(i,c){if(!i.isNative&&yl.has(i.uuid)){var u=yl.get(i.uuid);return i.content=u.addRef(),t.output.push(i),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),void c()}sM.load(i,t.options,(function(u,h){u?t.isFinish||(!l.assetManager.force||n?(T(u.message,u.stack),r.canInvoke=!1,e(u)):(t.output.push(i),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i))):t.isFinish||(i.file=h,t.output.push(i),i.isNative||(s[i.uuid]=!0,DN(i.uuid,h,s,a,i.config),r.total=o+a.length),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i)),c()}))}),(function(){if(t.isFinish)return IN(t,!0),void t.dispatch("error");if(a.length>0){var o=Il.create({input:a,progress:r,options:i,onProgress:t.onProgress,onError:Il.prototype.recycle,onComplete:function(i){var r;i||((r=t.output).push.apply(r,o.output),o.recycle()),n&&lM(t),e(i)}});Al.async(o)}else n&&lM(t),e()}))}function lM(t){for(var e=t.output,n=0,i=e.length;n<i;n++)e[n].content&&e[n].content.decRef(!1)}var uM=function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}(),hM=new(function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return R(5100),{};for(var n=null,i=0,r=e.childNodes.length;i<r&&1!==(n=e.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(t){var e=null,n=t.tagName;if("dict"===n)e=this._parseDict(t);else if("array"===n)e=this._parseArray(t);else if("string"===n)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===n?e=!1:"true"===n?e=!0:"real"===n?e=parseFloat(t.firstChild.nodeValue):"integer"===n&&(e=parseInt(t.firstChild.nodeValue,10));return e},n._parseArray=function(t){for(var e=[],n=0,i=t.childNodes.length;n<i;n++){var r=t.childNodes[n];1===r.nodeType&&e.push(this._parseNode(r))}return e},n._parseDict=function(t){for(var e={},n="",i=0,r=t.childNodes.length;i<r;i++){var a=t.childNodes[i];1===a.nodeType&&("key"===a.tagName?n=a.firstChild.nodeValue:e[n]=this._parseNode(a))}return e},e}(uM));function fM(t,e){return t[e]<<8|t[e+1]}var _M=new(function(){function t(){this._parsing=new ml,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},e.parsePVRTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(a,0,13);if(55727696===o[0]){var s=o[7],c=o[6],l=o[12]+52;r={_data:new Uint8Array(a,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var u=o[0],h=o[1],f=o[2];r={_data:new Uint8Array(a,u),_compressed:!0,width:f,height:h,format:0}}}catch(t){i=t}n(i,r)},e.parsePKMTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a),s=fM(o,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=fM(o,12),l=fM(o,14);fM(o,8),fM(o,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:c,height:l,format:0}}catch(t){i=t}n(i,r)},e.parseASTCTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=o[4],c=o[5],l=o[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(t,e){return 4===t?xm.RGBA_ASTC_4x4:5===t?4===e?xm.RGBA_ASTC_5x4:xm.RGBA_ASTC_5x5:6===t?5===e?xm.RGBA_ASTC_6x5:xm.RGBA_ASTC_6x6:8===t?5===e?xm.RGBA_ASTC_8x5:6===e?xm.RGBA_ASTC_8x6:xm.RGBA_ASTC_8x8:10===t?5===e?xm.RGBA_ASTC_10x5:6===e?xm.RGBA_ASTC_10x6:8===e?xm.RGBA_ASTC_10x8:xm.RGBA_ASTC_10x10:10===e?xm.RGBA_ASTC_12x10:xm.RGBA_ASTC_12x12}(s,c),h=o[7]+(o[8]<<8)+(o[9]<<16),f=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:h,height:f,format:u}}catch(t){i=t}n(i,r)},e.parsePlist=function(t,e,n){var i=null,r=hM.parse(t);r||(i=new Error("parse failed")),n(i,r)},e.parseImport=function(t,e,n){if(t){var i=null,r=null;try{i=Km(t,e)}catch(t){r=t}n(r,i)}else n(new Error("The json file of asset "+e.__uuid__+" is empty or missing"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?Ut(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,n,i,r){var a=this,o=Tl.get(t);if(o)r(null,o);else{var s=this._parsing.get(t);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(t,[r]),c(e,i,(function(e,n){e?Sl.remove(t):Bl(n)||Tl.add(t,n);for(var i=a._parsing.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))):r(null,e)}}},t}());function dM(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var i=t.options,r=t.progress;i.__exclude__=i.__exclude__||Object.create(null),t.output=[],NN(t.input,(function(a,o){var s=Il.create({input:a,onProgress:t.onProgress,options:i,progress:r,onComplete:function(i,c){i&&!t.isFinish&&(!l.assetManager.force||n?(T(i.message,i.stack),r.canInvoke=!1,e(i)):r.canInvoke&&t.dispatch("progress",++r.finish,r.total,a)),t.output.push(c),s.recycle(),o(null)}});pM.async(s)}),(function(){if(i.__exclude__=null,t.isFinish)return IN(t,!0),void t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var n=t.output=[],i=0,r=e.length;i<r;i++)n.push(e[i].content);else t.output=e[0].content}(t),IN(t,!0),e()}))}var pM=new gl("loadOneAsset",[function(t,e){var n=t.output=t.input,i=n.options,r=n.isNative,a=n.uuid,o=n.file,s=i.reloadAsset;o||!s&&!r&&yl.has(a)?e():sM.load(n,t.options,(function(t,i){n.file=i,e(t)}))},function(t,e){var n=t.output=t.input,i=t.progress,r=t.options.__exclude__,a=n.id,o=n.file,s=n.options;if(n.isNative)_M.parse(a,o,n.ext,s,(function(r,o){r?e(r):(n.content=o,i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),Sl.remove(a),Tl.remove(a),e())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,f=l.err,_=l.callbacks;i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),u||FN(c,c,r)?(h&&h.addRef(),n.content=h,e(f)):_.push({done:e,item:n})}else if(!s.reloadAsset&&yl.has(c)){var d=yl.get(c);n.content=d.addRef(),i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),e()}else s.__uuid__=c,_M.parse(a,o,"import",s,(function(n,i){n?e(n):function(t,e,n){var i=t.input,r=t.progress,a=i,o=a.uuid,s=a.id,c=a.options,l=a.config,u=c.cacheAsset,h=[];e.addRef&&e.addRef(),DN(o,e,Object.create(null),h,l),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=h.length,i);var f=t.options.__exclude__[o]={content:e,finish:!1,callbacks:[{done:n,item:i}]},_=Il.create({input:h,options:t.options,onProgress:t.onProgress,onError:Il.prototype.recycle,progress:r,onComplete:function(t){if(e.decRef&&e.decRef(!1),f.finish=!0,f.err=t,!t){for(var n,i=Array.isArray(_.output)?_.output:[_.output],r=Object.create(null),a=ot(i);!(n=a()).done;){var c=n.value;c&&(r[c instanceof Du?c._uuid+"@import":o+"@native"]=c)}!function(t,e,n){var i=Xm.get(e);if(i){for(var r=0,a=i.length;r<a;r++){var o=i[r],s=n[o.uuid+"@import"];if(s)o.owner[o.prop]=s.addRef();else{if(T("The asset "+o.uuid+" is missing!"),o.type&&o.type!==Du){var c=new o.type;c.initDefault(o.uuid),o.owner[o.prop]=c}!0}}Xm.delete(e)}qm.has(e)&&(n[t+"@native"]?e._nativeAsset=n[t+"@native"]:(!0,console.error("the native asset of "+t+" is missing!")),qm.delete(e))}(o,e,r);try{"function"!=typeof e.onLoaded||Ym.has(e)||qm.has(e)||(e.onLoaded(),Ym.add(e))}catch(t){T("The asset "+o+" is invalid for some reason, detail message: "+t.message+", stack: "+t.stack)}Sl.remove(s),Tl.remove(s),ON(o,e,u),_.recycle()}for(var l=f.callbacks,h=0,d=l.length;h<d;h++){var p=l[h];e.addRef&&e.addRef(),p.item.content=e,p.done(t)}l.length=0}});El.async(_)}(t,i,e)}))}}]);function mM(t,e){var n=t.options,i=Object.create(null),r=Object.create(null);for(var a in n)switch(a){case vl.PATH:case vl.UUID:case vl.DIR:case vl.SCENE:case vl.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[a]=n[a];break;case"__exclude__":case"__outputAsArray__":r[a]=n[a];break;default:i[a]=n[a],r[a]=n[a]}t.options=r;var o=Il.create({input:t.input,options:i}),s=null;try{t.output=t.source=Cl.sync(o)}catch(t){s=t;for(var c=0,l=o.output.length;c<l;c++)o.output[c].recycle()}o.recycle(),e(s)}var gM=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},Q(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();gM.MAX_DEAD_NUM=500,gM._deadPool=[];var vM=[];function yM(t){var e=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var i=function(i){var r,a=n[i],o=gM.create(),s=null,c=null;if("string"==typeof a&&((a=Object.create(null))[e.__requestType__||vl.UUID]=n[i]),"object"==typeof a)for(var l in zt(a,e),a.preset&&zt(a,wl[a.preset]),a){switch(l){case vl.UUID:if("break"===function(){var t,e=o.uuid=Nl(a.uuid);if(!a.bundle){var n=xl.find((function(t){return!!t.getAssetInfo(e)}));a.bundle=n&&n.name}if(xl.has(a.bundle)){if(s=xl.get(a.bundle).config,(c=s.getAssetInfo(e))&&c.redirect){if(!xl.has(c.redirect))throw new Error("Please load bundle "+c.redirect+" first");s=xl.get(c.redirect).config,c=s.getAssetInfo(e)}o.config=s,o.info=c}return o.ext=a.ext||(null===(t=c)||void 0===t?void 0:t.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case vl.DIR:if(xl.has(a.bundle)){xl.get(a.bundle).config.getDirWithPath(a.dir,a.type,vM);for(var u,h=ot(vM);!(u=h()).done;){var f=u.value;n.push({uuid:f.uuid,__isNative__:!1,ext:f.extension||".json",bundle:a.bundle})}vM.length=0}o.recycle(),o=null;break;case vl.PATH:if(xl.has(a.bundle)){if(s=xl.get(a.bundle).config,(c=s.getInfoWithPath(a.path,a.type))&&c.redirect){if(!xl.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=xl.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+a.bundle+" doesn't contain "+a.path);o.config=s,o.uuid=c.uuid,o.info=c}o.ext=a.ext||(null===(r=c)||void 0===r?void 0:r.extension)||".json";break;case vl.SCENE:if(!a.bundle){var _=xl.find((function(t){return!!t.getSceneInfo(a.scene)}));a.bundle=_&&_.name}if(xl.has(a.bundle)){if(s=xl.get(a.bundle).config,(c=s.getSceneInfo(a.scene))&&c.redirect){if(!xl.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=xl.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+s.name+" doesn't contain scene "+a.scene);o.config=s,o.uuid=c.uuid,o.info=c}break;case"__isNative__":o.isNative=a.__isNative__;break;case vl.URL:o.url=a.url,o.uuid=a.uuid||a.url,o.ext=a.ext||yu(a.url),o.isNative=void 0===a.__isNative__||a.__isNative__;break;default:o.options[l]=a[l]}if(!o)break}if(!o)return"continue";if(t.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(a))},r=0;r<n.length;r++)i(r);return null}function SM(t){for(var e=t.output=t.input,n=0;n<e.length;n++){var i=e[n];if(!i.url){var r,a,o=i.config;a=i.isNative?o&&o.nativeBase?o.base+o.nativeBase:l.assetManager.generalNativeBase:o&&o.importBase?o.base+o.importBase:l.assetManager.generalImportBase;var s=i.uuid,c="";i.info&&(c=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),r=".ttf"===i.ext?a+"/"+s.slice(0,2)+"/"+s+c+"/"+i.options.__nativeName__:a+"/"+s.slice(0,2)+"/"+s+c+i.ext,i.url=r}}return null}var TM=t("AssetManager",function(){function t(){this.pipeline=El.append(mM).append(dM),this.fetchPipeline=Al.append(mM).append(cM),this.transformPipeline=Cl.append(yM).append(SM),this.bundles=xl,this.assets=yl,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Jm,this.force=!1,this.allowImageBitmap=!ch.isMobile,this.utils=kl,this.downloader=$N,this.parser=_M,this.packManager=sM,this.cacheAsset=!0,this.cacheManager=null,this.presets=wl,this.factory=oM,this.preprocessPipe=mM,this.fetchPipe=cM,this.loadPipe=dM,this.references=null,this._releaseManager=bN,this._files=Sl,this._parsed=Tl,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var n=t.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=e,this.generalNativeBase=n},e.getBundle=function(t){return xl.get(t)||null},e.removeBundle=function(t){t._destroy(),xl.remove(t.name)},e.loadAny=function(t,e,n,i){var r=MN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"default",t=Array.isArray(t)?t.slice():t;var c=Il.create({input:t,onProgress:o,onComplete:BN(s),options:a});El.async(c)},e.preloadAny=function(t,e,n,i){var r=MN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"preload",t=Array.isArray(t)?t.slice():t;var c=Il.create({input:t,onProgress:o,onComplete:BN(s),options:a});Al.async(c)},e.loadRemote=function(t,e,n){var i=MN(e,void 0,n),r=i.options,a=i.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,n){e?(T(e.message,e.stack),a&&a(e,n)):oM.create(t,n,r.ext||yu(t),r,(function(t,e){a&&a(t,e)}))}))):BN(a)(null,this.assets.get(t))},e.loadBundle=function(t,e,n){var i=MN(e,void 0,n),r=i.options,a=i.onComplete,o=Tu(t);this.bundles.has(o)?BN(a)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,n){e?(T(e.message,e.stack),a&&a(e,n)):oM.create(t,n,"bundle",r,(function(t,e){a&&a(t,e)}))})))},e.releaseAsset=function(t){bN.tryRelease(t,!0)},e.releaseUnusedAssets=function(){yl.forEach((function(t){bN.tryRelease(t)}))},e.releaseAll=function(){yl.forEach((function(t){bN.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},Q(t,[{key:"main",get:function(){return xl.get(bl.MAIN)||null}},{key:"resources",get:function(){return xl.get(bl.RESOURCES)||null}}]),t}());TM.Pipeline=gl,TM.Task=Il,TM.Cache=ml,TM.RequestItem=gM,TM.Bundle=zN,TM.BuiltinBundleName=bl;var xM=t("assetManager",l.assetManager=new TM);l.AssetManager=TM;var EM=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],AM=[".mp3",".ogg",".wav",".m4a"];function CM(){return!0}var bM={transformURL:function(t){var e=Ll(t);if(!e)return t;var n=xl.find((function(t){return!!t.getAssetInfo(e)}));if(!n)return t;var i,r=n.getAssetInfo(e);if(!(i=t.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==t.indexOf(i))return t;var a=!1;if(".ttf"===yu(t)&&(a=!0),a){var o=xu(t),s=Tu(t);t=o+"."+i+"/"+s}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(function(t){return t+"."+i}));return t}},wM=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=LN}var e=t.prototype;return e.load=function(t,e,n){void 0===n&&void 0!==e&&(n=e,e=null);for(var i=Array.isArray(t)?t:[t],r=0;r<i.length;r++){var a=i[r];"string"==typeof a?i[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var o=[],s=[];xM.loadAny(i,null,(function(t,n,i){i.content&&(EM.includes(i.ext)?o.push(i.content):AM.includes(i.ext)&&s.push(i.content)),e&&e(t,n,i)}),(function(t,e){var r=null;if(!t){e=Array.isArray(e)?e:[e];for(var a=function(t){var n=e[t];if(!(n instanceof Du)){var r=n,a=i[t].url;o.includes(r)?oM.create(a,n,".png",{},(function(n,i){r=e[t]=i})):s.includes(r)&&oM.create(a,n,".mp3",{},(function(n,i){r=e[t]=i})),yl.add(a,r)}},c=0;c<e.length;c++)a(c);if(e.length>1){var l=Object.create(null);e.forEach((function(t){l[t._uuid]=t})),r={isCompleted:CM,_map:l}}else r=e[0]}n&&n(t,r)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return xM.assets.has(t)?{content:xM.assets.get(t)}:null},e.loadRes=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete,c=yu(t);c&&!UN.getInfoWithPath(t,a)&&(t=t.slice(0,-c.length)),UN.load(t,a,o,s)},e.loadResArray=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;t.forEach((function(e,n){var i=yu(e);i&&!UN.getInfoWithPath(e,a)&&(t[n]=e.slice(0,-i.length))})),UN.load(t,a,o,s)},e.loadResDir=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;UN.loadDir(t,a,o,(function(e,n){var i=[];e||(i=UN.getDirWithPath(t,a).map((function(t){return t.path}))),s&&s(e,n,i)}))},e.getRes=function(t,e){return yl.has(t)?yl.get(t):UN.get(t,e)},e.getResCount=function(){return yl.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return Jm.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({url:t},n)}};for(var i in t)n(i);$N.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({content:t},n)}};for(var i in t)n(i);_M.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];"string"==typeof n&&(n=yl.get(n)),xM.releaseAsset(n)}else t&&("string"==typeof t&&(t=yl.get(t)),xM.releaseAsset(t))},e.releaseAsset=function(t){xM.releaseAsset(t)},e.releaseRes=function(t,e){UN.release(t,e)},e.releaseAll=function(){xM.releaseAll(),yl.clear()},e.removeItem=function(t){return!!yl.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var n=Jm.getDepsRecursively(t),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},Q(t,[{key:"onProgress",set:function(t){wN=t}},{key:"_cache",get:function(){if(yl instanceof ml)return yl._map;var t={};return yl.forEach((function(e,n){t[n]=e})),t}},{key:"md5Pipe",get:function(){return bM}},{key:"downloader",get:function(){return $N}},{key:"loader",get:function(){return xM.parser}}]),t}()),IM=t("loader",new wM),PM=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,xM.init(t),t.rawAssets&&UN.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:bl.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets),extensionMap:{}})},loadAsset:function(t,e){xM.loadAny(t,e)}}),RM=t("url",{});U(RM,"url",[{name:"normalize",target:xM.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?Ul({path:Eu(t.substr(10)),bundle:bl.RESOURCES,__isNative__:!0,ext:yu(t)}):""}}]),k(PM,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),k(IM,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"loader.assetLoader was removed, assetLoader and md5Pipe were merged into assetManager.transformPipeline"}]),U(l,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return IM}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return PM}},{name:"Pipeline",target:TM,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return RM}}]),k(l,"cc",[{name:"LoadingItems",suggest:F(1400,"LoadingItems","AssetManager.Task")}]),U(he,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:$N,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),U(lN,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return xM.main?null===(e=xM.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),U(sN,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return xM.main&&xM.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var DM,OM,NM,MM,LM,FM,BM,zM,UM,kM,GM,VM,HM,WM,jM=bN._autoRelease;bN._autoRelease=function(t,e,n){jM.call(bN,t,e,n);for(var i=IM._autoReleaseSetting,r=Object.keys(i),a=0;a<r.length;a++){var o=r[a];if(!0===i[o]){var s=yl.get(o);s&&bN.tryRelease(s)}}};var XM,qM,YM,KM,QM,JM,ZM,$M,tL,eL,nL,iL,rL,aL,oL,sL,cL,lL,uL,hL,fL,_L,dL,pL,mL,gL,vL,yL,SL,TL,xL,EL,AL,CL,bL,wL,IL,PL,RL,DL,OL,NL,ML,LL,FL,BL,zL,UL,kL,GL,VL,HL,WL,jL,XL,qL,YL,KL,QL,JL,ZL,$L,tF,eF,nF,iF,rF,aF,oF,sF,cF=t("EventHandler",(DM=Ec("cc.ClickEvent"),OM=al(l.Node),NM=Xc(),MM=Xc(),LM=Xc(),FM=Xc(),DM((WM=function(){function t(){st(this,"target",UM,this),st(this,"component",kM,this),st(this,"_componentId",GM,this),st(this,"handler",VM,this),st(this,"customEventData",HM,this)}t.emitEvents=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var a=0,o=e.length;a<o;a++){var s=e[a];s instanceof t&&s.emit(i)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(l.isValid(e)){this._genCompIdIfNeeded();var n=l.js._getClassById(this._componentId),i=e.getComponent(n);if(l.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),r.apply(i,t))}}},e._compName2Id=function(t){var e=l.js.getClassByName(t);return l.js._getClassId(e)},e._compId2Name=function(t){var e=l.js._getClassById(t);return l.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},Q(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),UM=ct((zM=WM).prototype,"target",[Dc,OM,Dc,NM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kM=ct(zM.prototype,"component",[Dc,Vc,MM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GM=ct(zM.prototype,"_componentId",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),VM=ct(zM.prototype,"handler",[Dc,Vc,LM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HM=ct(zM.prototype,"customEventData",[Dc,Vc,FM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),BM=zM))||BM));l.Component.EventHandler=cF;var lF,uF,hF,fF,_F,dF,pF,mF,gF,vF,yF,SF=new Dn,TF=oe(Yg),xF=oe(qg),EF=oe(Kg),AF=oe(Jg),CF=oe(Qg),bF=oe({SKYBOX:ov|Ji.DEPTH_STENCIL,SOLID_COLOR:Ji.ALL,DEPTH_ONLY:Ji.DEPTH_STENCIL,DONT_CLEAR:Ji.NONE}),wF=(XM=Ec("cc.Camera"),qM=Gc(),YM=Bc(),KM=Zc(),QM=Xc(),JM=al(Cd.BitMask),ZM=Zc(),$M=Xc(),tL=al(bF),eL=Zc(),nL=Xc(),iL=Zc(),rL=Xc(),aL=Zc(),oL=Xc(),sL=Zc(),cL=Xc(),lL=al(TF),uL=Zc(),hL=Xc(),fL=al(xF),_L=Zc(),dL=Hc(),pL=Xc(),mL=Zc(),gL=Hc(),vL=Xc(),yL=Zc(),SL=Hc(),TL=Xc(),xL=Zc(),EL=Xc(),AL=Zc(),CL=Xc(),bL=al(EF),wL=Zc(),IL=Xc(),PL=al(AF),RL=Zc(),DL=Xc(),OL=al(CF),NL=Zc(),ML=Xc(),LL=Zc(),FL=Xc(),BL=al(Lx),zL=Zc(),UL=Xc(),lF=XM(kL=qM(kL=YM(kL=Fc((sF=oF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_projection",VL,rt(e)),st(e,"_priority",HL,rt(e)),st(e,"_fov",WL,rt(e)),st(e,"_fovAxis",jL,rt(e)),st(e,"_orthoHeight",XL,rt(e)),st(e,"_near",qL,rt(e)),st(e,"_far",YL,rt(e)),st(e,"_color",KL,rt(e)),st(e,"_depth",QL,rt(e)),st(e,"_stencil",JL,rt(e)),st(e,"_clearFlags",ZL,rt(e)),st(e,"_rect",$L,rt(e)),st(e,"_aperture",tF,rt(e)),st(e,"_shutter",eF,rt(e)),st(e,"_iso",nF,rt(e)),st(e,"_screenScale",iF,rt(e)),st(e,"_visibility",rF,rt(e)),st(e,"_targetTexture",aF,rt(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=yy.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(t,e,n){return n||(n=no.create()),this._camera&&this._camera.screenPointToRay(n,t,e),n},n.worldToScreen=function(t,e){return e||(e=new Dn),this._camera&&this._camera.worldToScreen(e,t),e},n.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},n.convertToUINode=function(t,e,n){if(n||(n=new Dn),!this._camera)return n;this.worldToScreen(t,SF);var i=e.getComponent("cc.UITransform"),r=yN.getVisibleSize(),a=SF.x-.5*this._camera.width,o=SF.y-.5*this._camera.height;return SF.x=a/l.view.getScaleX()+.5*r.width,SF.y=o/l.view.getScaleY()+.5*r.height,i&&i.convertToNodeSpaceAR(SF,n),n},n._createCamera=function(){this._camera||(this._camera=l.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?l.director.root&&l.director.root.mainWindow:l.director.root&&l.director.root.tempWindow,priority:this._priority}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=_n(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},Q(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===qg.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=_n(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var n=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(n),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?l.director.root&&l.director.root.mainWindow:l.director.root&&l.director.root.tempWindow)}}]),e}(Zu),oF.ProjectionType=TF,oF.FOVAxis=xF,oF.ClearFlag=bF,oF.Aperture=EF,oF.Shutter=AF,oF.ISO=CF,oF.TARGET_TEXTURE_CHANGE="tex-change",VL=ct((GL=sF).prototype,"_projection",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return TF.PERSPECTIVE}}),HL=ct(GL.prototype,"_priority",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WL=ct(GL.prototype,"_fov",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),jL=ct(GL.prototype,"_fovAxis",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xF.VERTICAL}}),XL=ct(GL.prototype,"_orthoHeight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),qL=ct(GL.prototype,"_near",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),YL=ct(GL.prototype,"_far",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),KL=ct(GL.prototype,"_color",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn("#333333")}}),QL=ct(GL.prototype,"_depth",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),JL=ct(GL.prototype,"_stencil",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZL=ct(GL.prototype,"_clearFlags",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bF.SOLID_COLOR}}),$L=ct(GL.prototype,"_rect",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ai(0,0,1,1)}}),tF=ct(GL.prototype,"_aperture",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return EF.F16_0}}),eF=ct(GL.prototype,"_shutter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return AF.D125}}),nF=ct(GL.prototype,"_iso",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return CF.ISO100}}),iF=ct(GL.prototype,"_screenScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rF=ct(GL.prototype,"_visibility",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gp}}),aF=ct(GL.prototype,"_targetTexture",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct(GL.prototype,"priority",[KM,QM],Object.getOwnPropertyDescriptor(GL.prototype,"priority"),GL.prototype),ct(GL.prototype,"visibility",[JM,ZM,$M],Object.getOwnPropertyDescriptor(GL.prototype,"visibility"),GL.prototype),ct(GL.prototype,"clearFlags",[tL,eL,nL],Object.getOwnPropertyDescriptor(GL.prototype,"clearFlags"),GL.prototype),ct(GL.prototype,"clearColor",[iL,rL],Object.getOwnPropertyDescriptor(GL.prototype,"clearColor"),GL.prototype),ct(GL.prototype,"clearDepth",[aL,oL],Object.getOwnPropertyDescriptor(GL.prototype,"clearDepth"),GL.prototype),ct(GL.prototype,"clearStencil",[sL,cL],Object.getOwnPropertyDescriptor(GL.prototype,"clearStencil"),GL.prototype),ct(GL.prototype,"projection",[lL,uL,hL],Object.getOwnPropertyDescriptor(GL.prototype,"projection"),GL.prototype),ct(GL.prototype,"fovAxis",[fL,_L,dL,pL],Object.getOwnPropertyDescriptor(GL.prototype,"fovAxis"),GL.prototype),ct(GL.prototype,"fov",[mL,gL,vL],Object.getOwnPropertyDescriptor(GL.prototype,"fov"),GL.prototype),ct(GL.prototype,"orthoHeight",[yL,SL,TL],Object.getOwnPropertyDescriptor(GL.prototype,"orthoHeight"),GL.prototype),ct(GL.prototype,"near",[xL,EL],Object.getOwnPropertyDescriptor(GL.prototype,"near"),GL.prototype),ct(GL.prototype,"far",[AL,CL],Object.getOwnPropertyDescriptor(GL.prototype,"far"),GL.prototype),ct(GL.prototype,"aperture",[bL,wL,IL],Object.getOwnPropertyDescriptor(GL.prototype,"aperture"),GL.prototype),ct(GL.prototype,"shutter",[PL,RL,DL],Object.getOwnPropertyDescriptor(GL.prototype,"shutter"),GL.prototype),ct(GL.prototype,"iso",[OL,NL,ML],Object.getOwnPropertyDescriptor(GL.prototype,"iso"),GL.prototype),ct(GL.prototype,"rect",[LL,FL],Object.getOwnPropertyDescriptor(GL.prototype,"rect"),GL.prototype),ct(GL.prototype,"targetTexture",[BL,zL,UL],Object.getOwnPropertyDescriptor(GL.prototype,"targetTexture"),GL.prototype),kL=GL))||kL)||kL)||kL)||kL,t({Camera:lF,CameraComponent:lF}),lF);l.Camera=wF;var IF={parent:null,owner:null,subModelIdx:0},PF=t("RenderableComponent",(uF=Ec("cc.RenderableComponent"),hF=al($g),fF=Zc(),_F=jc(),dF=al([$g]),uF((yF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_visFlags",gF,rt(e)),st(e,"_materials",vF,rt(e)),e._materialInstances=[],e._models=[],e}Z(e,t);var n=e.prototype;return n.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},n.setMaterial=function(t,e){t&&t instanceof ly&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var n=this._materialInstances[e];n&&(n.destroy(),this._materialInstances[e]=null),this._onMaterialModified(e,this._materials[e])},n.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){IF.parent=this._materials[t],IF.owner=this,IF.subModelIdx=t;var e=new ly(IF);IF.parent=null,IF.owner=null,IF.subModelIdx=0,this.setMaterialInstance(e,t)}return this._materialInstances[t]},n.setMaterialInstance=function(t,e){if("number"==typeof t){R(12007);var n=t;t=e,e=n}var i=this._materialInstances[e];t&&t.parent?t!==i&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):(t!==this._materials[e]||i)&&this.setMaterial(t,e)},n.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},Q(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){for(var e=t.length,n=this._materials.length,i=e;i<n;i++)this.setMaterialInstance(null,i);this._materials.length=e,this._materialInstances.length=e;for(var r=0;r<e;r++)this._materialInstances[r]!=t[r]&&this.setMaterialInstance(t[r],r)}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}}]),e}(Zu),gF=ct((mF=yF).prototype,"_visFlags",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cd.Enum.NONE}}),ct(mF.prototype,"sharedMaterials",[hF,fF,_F],Object.getOwnPropertyDescriptor(mF.prototype,"sharedMaterials"),mF.prototype),vF=ct(mF.prototype,"_materials",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pF=mF))||pF));l.RenderableComponent=PF,U(wF,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),U(wF.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),l.CameraComponent=wF,ie.setClassAlias(wF,"cc.CameraComponent"),l.math=li,l.geometry=Ed;var RF=new Dn,DF=new Xn;function OF(t,e,n,i){var r=n.chunk,a=n.data,o=r.vb,s=n.vertexCount;t.getWorldMatrix(DF);for(var c=0,l=0;l<s;l++){var u=a[l];Dn.set(RF,u.x,u.y,0),Dn.transformMat4(RF,RF,DF),o[c++]=RF.x,o[c++]=RF.y,o[c++]=RF.z,Pn.toArray(o,i,c+2),c+=6}for(var h=r.bufferId,f=r.vertexOffset,_=r.vertexAccessor.getMeshBuffer(r.bufferId),d=r.vertexAccessor.getIndexBuffer(h),p=_.indexOffset,m=0,g=s/4;m<g;m++){var v=f+4*m;d[p++]=v,d[p++]=v+1,d[p++]=v+2,d[p++]=v+1,d[p++]=v+3,d[p++]=v+2}_.indexOffset+=n.indexCount,_.setDirty()}var NF={},MF=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var n=new LF;n.initWithSize(t,e),this._texture=n,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,n=t.texture,i=this._innerTextureInfos[n.getId()],r=e.x,a=e.y;if(i)r+=i.x,a+=i.y;else{var o=n.width,s=n.height;if(this._x+o+2>this._width&&(this._x=2,this._y=this._nexty),this._y+s+2>this._nexty&&(this._nexty=this._y+s+2),this._nexty>this._height)return null;l.internal.dynamicAtlasManager.textureBleeding&&((o<=8||s<=8)&&(this._texture.drawTextureAt(n.image,this._x-1,this._y-1),this._texture.drawTextureAt(n.image,this._x-1,this._y+1),this._texture.drawTextureAt(n.image,this._x+1,this._y-1),this._texture.drawTextureAt(n.image,this._x+1,this._y+1)),this._texture.drawTextureAt(n.image,this._x-1,this._y),this._texture.drawTextureAt(n.image,this._x+1,this._y),this._texture.drawTextureAt(n.image,this._x,this._y-1),this._texture.drawTextureAt(n.image,this._x,this._y+1)),this._texture.drawTextureAt(n.image,this._x,this._y),this._innerTextureInfos[n.getId()]={x:this._x,y:this._y,texture:n},this._count++,r+=this._x,a+=this._y,this._x+=o+2}var c={x:r,y:a,texture:this._texture};return this._innerSpriteFrames.push(t),c},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,n=t.length;e<n;e++){var i=t[e];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),LF=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=xm.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new lr;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(dg),FF=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new MF(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=t.texture.getSamplerInfo();if(e.minFilter!==Am.LINEAR||e.magFilter!==Am.LINEAR||e.mipFilter!==Am.NONE)return null;var n=this._atlases[this._atlasIndex];n||(n=this.newAtlas());var i=n.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(n=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){for(var e,n=this._atlases.length-1;n>=0;n--)e=this._atlases[n],ie.array.fastRemove(e._innerSpriteFrames,t);var i=t._original._texture;this.deleteAtlasTexture(i)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(e&&!e._original&&e.packable&&e.texture&&e.texture.width>0&&e.texture.height>0){var n=this.insertSpriteFrame(e);n&&e._setDynamicAtlasFrame(n)}},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),l.director.on(l.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),l.director.off(l.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();FF.instance=void 0;var BF,zF,UF,kF=t("dynamicAtlasManager",FF.instance=new FF);l.internal.dynamicAtlasManager=kF;var GF,VF,HF,WF,jF=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],XF=t("SpriteFrame",Ec("cc.SpriteFrame")((UF=zF=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.unbiasUV=[],e.uvSliced=[],e._rect=new ai,e._offset=new Qn,e._originalSize=new ii,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}Z(e,t),e.createWithImage=function(t){var n=t instanceof jm?t:new jm(t),i=new dg;i.image=n;var r=new e;return r.texture=i,r};var n=e.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,e){void 0===e&&(e=!1);var n=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,n=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),n=!0),n&&this.texture&&this._calculateUV()},n.checkRect=function(t){var e=this._rect,n=e.x,i=e.y;return this._rotated?(n+=e.height,i+=e.width):(n+=e.width,i+=e.height),n>t.width?(O(3300,this.name+"/"+t.name,n,t.width),!1):!(i>t.height&&(O(3301,this.name+"/"+t.name,i,t.height),1))},n.destroy=function(){return this._packable&&kF&&kF.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var t=this._rect,n=this.texture,i=n.width,r=n.height,a=this._capInsets[0],o=this._capInsets[2],s=t.width-a-o,c=this._capInsets[1],l=this._capInsets[3],u=t.height-c-l,h=this.uvSliced;if(h.length=0,this._rotated){jF[0].u=t.x/i,jF[1].u=(t.x+l)/i,jF[2].u=(t.x+l+u)/i,jF[3].u=(t.x+t.height)/i,jF[3].v=t.y/r,jF[2].v=(t.y+a)/r,jF[1].v=(t.y+a+s)/r,jF[0].v=(t.y+t.width)/r;for(var f=0;f<4;++f)for(var _=jF[f],d=0;d<4;++d){var p=jF[3-d];h.push({u:_.u,v:p.v})}}else{jF[0].u=t.x/i,jF[1].u=(t.x+a)/i,jF[2].u=(t.x+a+s)/i,jF[3].u=(t.x+t.width)/i,jF[3].v=t.y/r,jF[2].v=(t.y+c)/r,jF[1].v=(t.y+c+u)/r,jF[0].v=(t.y+t.height)/r;for(var m=0;m<4;++m)for(var g=jF[m],v=0;v<4;++v){var y=jF[v];h.push({u:y.u,v:g.v})}}this.emit(e.EVENT_UV_UPDATED,this)},n._calculateUV=function(){var t=this._rect,e=this.uv,n=this.unbiasUV,i=this.texture,r=i.width,a=i.height;if(this._rotated){var o=0===r?0:t.x/r,s=0===r?1:(t.x+t.height)/r,c=0===a?0:t.y/a,l=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=s,e[1]=l,e[2]=s,e[3]=c,e[4]=o,e[5]=l,e[6]=o,e[7]=c):this._isFlipUVX?(e[0]=s,e[1]=c,e[2]=s,e[3]=l,e[4]=o,e[5]=c,e[6]=o,e[7]=l):this._isFlipUVY?(e[0]=o,e[1]=l,e[2]=o,e[3]=c,e[4]=s,e[5]=l,e[6]=s,e[7]=c):(e[0]=o,e[1]=c,e[2]=o,e[3]=l,e[4]=s,e[5]=c,e[6]=s,e[7]=l);var u=0===r?0:t.x/r,h=0===r?1:(t.x+t.height)/r,f=0===a?0:t.y/a,_=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=h,n[1]=_,n[2]=h,n[3]=f,n[4]=u,n[5]=_,n[6]=u,n[7]=f):this._isFlipUVX?(n[0]=h,n[1]=f,n[2]=h,n[3]=_,n[4]=u,n[5]=f,n[6]=u,n[7]=_):this._isFlipUVY?(n[0]=u,n[1]=_,n[2]=u,n[3]=f,n[4]=h,n[5]=_,n[6]=h,n[7]=f):(n[0]=u,n[1]=f,n[2]=u,n[3]=_,n[4]=h,n[5]=f,n[6]=h,n[7]=_)}else{var d=0===r?0:t.x/r,p=0===r?1:(t.x+t.width)/r,m=0===a?1:(t.y+t.height)/a,g=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=p,e[1]=g,e[2]=d,e[3]=g,e[4]=p,e[5]=m,e[6]=d,e[7]=m):this._isFlipUVX?(e[0]=p,e[1]=m,e[2]=d,e[3]=m,e[4]=p,e[5]=g,e[6]=d,e[7]=g):this._isFlipUVY?(e[0]=d,e[1]=g,e[2]=p,e[3]=g,e[4]=d,e[5]=m,e[6]=p,e[7]=m):(e[0]=d,e[1]=m,e[2]=p,e[3]=m,e[4]=d,e[5]=g,e[6]=p,e[7]=g);var v=0===r?0:t.x/r,y=0===r?1:(t.x+t.width)/r,S=0===a?1:(t.y+t.height)/a,T=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=y,n[1]=T,n[2]=v,n[3]=T,n[4]=y,n[5]=S,n[6]=v,n[7]=S):this._isFlipUVX?(n[0]=y,n[1]=S,n[2]=v,n[3]=S,n[4]=y,n[5]=T,n[6]=v,n[7]=T):this._isFlipUVY?(n[0]=v,n[1]=T,n[2]=y,n[3]=T,n[4]=v,n[5]=S,n[6]=y,n[7]=S):(n[0]=v,n[1]=S,n[2]=y,n[3]=S,n[4]=v,n[5]=T,n[6]=y,n[7]=T)}var x=this.vertices;if(x){x.nu.length=0,x.nv.length=0;for(var E=0;E<x.u.length;E++)x.nu[E]=x.u[E]/r,x.nv[E]=x.v[E]/a}this._calculateSlicedUV()},n._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},n._checkPackable=function(){var t=kF;if(t){var e=this._texture;if(e instanceof dg&&!e.isCompressed){var n=this.width,i=this.height;!e.image||n>t.maxFrameSize||i>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var e=t,n=e.rect;n&&(this._rect=new ai(n.x,n.y,n.width,n.height));var i=e.offset;e.offset&&(this._offset=new Qn(i.x,i.y));var r=e.originalSize;e.originalSize&&(this._originalSize=new ii(r.width,r.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var a=e.capInsets;a&&(this._capInsets[0]=a[0],this._capInsets[1]=a[1],this._capInsets[2]=a[2],this._capInsets[3]=a[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},n.clone=function(){var t,n,i,r,a,o,s,c,l=new e,u=this.vertices;return l.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(t=u.nu)||void 0===t?void 0:t.slice(0),u:null===(n=u.u)||void 0===n?void 0:n.slice(0),nv:null===(i=u.nv)||void 0===i?void 0:i.slice(0),v:null===(r=u.v)||void 0===r?void 0:r.slice(0)}:null,(a=l.uv).splice.apply(a,[0,l.uv.length].concat(this.uv)),(o=l.unbiasUV).splice.apply(o,[0,l.unbiasUV.length].concat(this.unbiasUV)),(s=l.uvSliced).splice.apply(s,[0,l.uvSliced.length].concat(this.uvSliced)),l._rect.set(this._rect),l._offset.set(this._offset),l._originalSize.set(this._originalSize),l._rotated=this._rotated,(c=l._capInsets).splice.apply(c,[0,l._capInsets.length].concat(this._capInsets)),l._atlasUuid=this._atlasUuid,l._texture=this._texture,l._isFlipUVX=this._isFlipUVX,l._isFlipUVY=this._isFlipUVY,l},n._refreshTexture=function(t){this._texture=t;var e=this._texture,n={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(n.rect=new ai(0,0,e.width,e.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(n.originalSize=new ii(e.width,e.height),i=!0),i&&(this.reset(n),this.onLoaded()),this._checkPackable()},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new dg;n.initDefault(),this._refreshTexture(n),this._calculateUV()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},Q(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?t!==this._texture&&this.reset({texture:t},!0):R(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),e}(Du),zF.EVENT_UV_UPDATED="uv_updated",BF=UF))||BF);l.SpriteFrame=XF;var qF,YF=t("SpriteAtlas",Ec("cc.SpriteAtlas")((WF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"spriteFrames",HF,rt(e)),e}Z(e,t);var n=e.prototype;return n.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},n.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},n.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];t.push(e[r])}return t},n._serialize=function(){},n._deserialize=function(t,e){var n=t;this._name=n.name;var i=n.spriteFrames;this.spriteFrames=It();for(var r=0;r<i.length;r+=2)e.result.push(this.spriteFrames,i[r],i[r+1],te(XF))},e}(Du),HF=ct((VF=WF).prototype,"spriteFrames",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return It()}}),GF=VF))||GF);l.SpriteAtlas=YF;var KF,QF,JF,ZF,$F=t("Font",Ec("cc.Font")(qF=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(Du))||qF);l.Font=$F;var tB,eB,nB,iB,rB,aB,oB,sB,cB,lB=t("TTFFont",Ec("cc.TTFFont")((ZF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_fontFamily",JF,rt(e)),e}return Z(e,t),e.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},Q(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:yu(this._native),__isNative__:!0}}}]),e}($F),JF=ct((QF=ZF).prototype,"_fontFamily",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct(QF.prototype,"_nativeAsset",[sl,rl],Object.getOwnPropertyDescriptor(QF.prototype,"_nativeAsset"),QF.prototype),ct(QF.prototype,"_nativeDep",[sl],Object.getOwnPropertyDescriptor(QF.prototype,"_nativeDep"),QF.prototype),KF=QF))||KF);l.TTFFont=lB;var uB,hB=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},fB=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,n=Object.keys(this.letterDefinitions);e<n.length;e++){var i=n[e],r=new hB;Ut(r,this.letterDefinitions[i]),t[i]=r}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),_B=t("BitmapFont",(tB=Ec("cc.BitmapFont"),eB=al(XF),tB((cB=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"fntDataStr",rB,rt(e)),st(e,"spriteFrame",aB,rt(e)),st(e,"fontSize",oB,rt(e)),st(e,"fntConfig",sB,rt(e)),e}return Z(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new fB(t.texture));var e=this.fntConfig;if(e){var n=e.fontDefDictionary;for(var i in n){var r=new hB,a=n[i].rect;r.offsetX=n[i].xOffset,r.offsetY=n[i].yOffset,r.w=a.width,r.h=a.height,r.u=a.x,r.v=a.y,r.textureID=0,r.valid=!0,r.xAdvance=n[i].xAdvance,this.fontDefDictionary.addLetterDefinitions(i,r)}}else S("The fnt config is not exists!")},e}($F),rB=ct((iB=cB).prototype,"fntDataStr",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),aB=ct(iB.prototype,"spriteFrame",[eB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oB=ct(iB.prototype,"fontSize",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),sB=ct(iB.prototype,"fntConfig",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nB=iB))||nB));l.BitmapFont=_B;var dB=t("LabelAtlas",Ec("cc.LabelAtlas")(uB=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(_B))||uB);l.LabelAtlas=dB;var pB=t("BASELINE_RATIO",.26),mB=t("MIDDLE_RATIO",(pB+1)/2-pB);var gB=new ee(2);gB.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var vB,yB=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var n=gB.get();if(n.key=t,n.value=e,this.count>=this.limit){var i=this.tail;delete this.datas[i.key],this.count--,this.tail=i.prev,this.tail.next=null,i.prev=null,i.next=null,gB.put(i)}this.moveToHead(n)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),SB=/([a-zA-Z0-9--]+|\S)/,TB=/^[!,.:;'}\]%\?>]/,xB=/([a-zA-Z0-9--iI]+|\S)$/,EB=/[a-zA-Z0-9--iI]+$/,AB=/^[a-zA-Z0-9--iI]/;function CB(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function bB(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function wB(t,e,n){var i=(n||t.font)+""+e,r=yB.get(i);if(null!==r)return r;var a=t.measureText(e),o=a&&a.width||0;return yB.put(i,o),o}function IB(t,e,n){var i=e,r=n,a=t[e];if(a>="\udc00"&&a<="\udfff"&&i--,void 0!==n)if(n-1!==e){var o=t[n-1];o>="\ud800"&&o<="\udbff"&&r--}else a>="\ud800"&&a<="\udbff"&&r++;return t.substring(i,r)}function PB(t){return AB.exec(t)}function RB(t){return EB.exec(t)}function DB(t,e,n,i){var r=[];if(0===t.length||n<0)return r.push(""),r;for(var a=t;e>n&&a.length>1;){for(var o=a.length*(n/e)|0,s=IB(a,o),c=e-i(s),l=s,u=0,h=0;c>n&&h++<100;)o*=n/c,c=e-i(s=IB(a,o|=0));for(h=0;s&&c<=n&&h++<100;){var f=SB.exec(s);l=s,c=e-i(s=IB(a,o+=u=f?f[0].length:1))}0==(o-=u)?(o=1,l=IB(a,1)):1===o&&a[0]>="\ud800"&&a[0]<="\udbff"&&(o=2,l=IB(a,2));var _=IB(a,0,o),d=void 0;TB.test(l||s)&&(0==(o-=(d=xB.exec(_))?d[0].length:0)&&(o=1),l=IB(a,o),_=IB(a,0,o)),AB.test(l)&&(d=EB.exec(_))&&_!==d[0]&&(l=IB(a,o-=d[0].length),_=IB(a,0,o)),(0===r.length||(_=_.trim()).length>0)&&r.push(_),e=i(a=l||s)}return(0===r.length||(a=a.trim()).length>0)&&r.push(a),r}var OB=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return vB||(vB=new t),vB};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),n=e.getContext("2d");t={canvas:e,context:n}}return t},e.put=function(t){this.pool.length>=he.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),NB=Pn.WHITE.clone(),MB=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},LB="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",FB=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=OB.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=wB(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+pB)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*pB/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new jm),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,n=this.canvas.width,i=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,n,i),t.fillStyle=LB,t.fillRect(0,0,n,i),t.font=e.fontDesc;var r=e.fontSize,a=n/2,o=i/2+r*mB+0*r,s=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1)",e.isOutlined){var c=e.out||NB;t.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,a,o)}t.fillText(this.char,a,o)}},t}(),BB=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=xm.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new lr;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(dg),zB=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var n=new BB;n.initWithSize(t,e),this.fontDefDictionary=new fB(n),this._halfBleed=1,this._width=t,this._height=e,lN.on(cN.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,n=lN.root.device;if(!e||!this.fontDefDictionary||!n)return null;var i=e.width,r=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return R(12100),null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var a=new MB;return a.u=this._x+this._halfBleed,a.v=this._y+this._halfBleed,a.texture=this.fontDefDictionary.texture,a.valid=!0,a.w=t.width-2,a.h=t.height-2,a.xAdvance=a.w,a.offsetY=t.offsetY,this._x+=i+0,this.fontDefDictionary.addLetterDefinitions(t.hash,a),a},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new BB;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var n=t.charCodeAt(0)+e.hash,i=this.fontDefDictionary.letterDefinitions[n];if(!i){var r=new FB(t,e);r.updateRenderData(),i=this.insertLetterTexture(r),r.destroy()}return i},Q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(),UB={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Pn.WHITE.clone(),isOutlined:!1,out:Pn.WHITE.clone(),margin:0},kB=[new Or($i.ATTR_POSITION,pi.RGB32F)],GB=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_COLOR,pi.RGBA32F)],VB=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_TEX_COORD,pi.RG32F),new Or($i.ATTR_COLOR,pi.RGBA32F)],HB=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_TEX_COORD,pi.RG32F),new Or($i.ATTR_COLOR,pi.RGBA32F),new Or($i.ATTR_COLOR2,pi.RGBA32F)];function WB(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=na[i.format].count}return e}function jB(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=na[i.format].size}return e}l.internal.vfmtPosUvColor=VB,l.internal.vfmtPosUvTwoColor=HB,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:kB,vfmtPosColor:GB,vfmtPosUvColor:VB,vfmtPosUvTwoColor:HB,getComponentPerVertex:WB,getAttributeStride:jB}));var XB,qB,YB,KB,QB,JB,ZB,$B,tz,ez,nz,iz,rz,az,oz,sz=jB(VB)>>2,cz=new Hl((function(){return{x:0,y:0,z:0,u:0,v:0,color:Pn.WHITE.clone()}}),128),lz=null,uz=t("BaseRenderData",function(){function t(t){void 0===t&&(t=VB),this.material=null,this.chunk=null,this.dataHash=0,this.isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=VB,this._floatStride=t===VB?sz:jB(t)>>2,this._vertexFormat=t}return t.prototype.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},Q(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}}]),t}()),hz=t("RenderData",function(t){function e(e,n){var i;return void 0===e&&(e=VB),(i=t.call(this,e)||this).indices=null,i.vertDirty=!0,i.frame=void 0,i.layer=0,i.blendHash=-1,i.textureHash=0,i.nodeDirty=!0,i.passDirty=!0,i.textureDirty=!0,i.hashDirty=!0,i._data=[],i._pivotX=0,i._pivotY=0,i._width=0,i._height=0,i._accessor=null,n||(n=lN.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i}Z(e,t),e.add=function(t,n){void 0===t&&(t=VB),lz||(lz=new Wl((function(){return new e}),32));var i=lz.add();return i._floatStride=t===VB?sz:jB(t)>>2,i._vertexFormat=t,n||(n=lN.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i},e.remove=function(t){var e=lz.data.indexOf(t);-1!==e&&(t.clear(),t._accessor=null,lz.removeAt(e))};var n=e.prototype;return n.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},n.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var n=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),n&&(this.chunk.vb.set(n.vb),this._accessor.recycleChunk(n)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.blendHash+" "+this.textureHash;this.dataHash=Sa(t,666),this.hashDirty=!1},n.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var n=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==n&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},n.updateSizeNPivot=function(t,e,n,i){t===this._width&&e===this._height&&n===this._pivotX&&i===this._pivotY||(this._width=t,this._height=e,this._pivotX=n,this._pivotY=i,this.vertDirty=!0)},n.clear=function(){this.resize(0,0),this._data.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.blendHash=-1,this.frame=null,this.textureHash=0,this.dataHash=0},Q(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var n=e.length,i=0;for(i=t;i<n;i++)cz.free(e[i]);for(i=n;i<t;i++)e[i]=cz.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(uz)),fz=t("MeshRenderData",function(t){function e(e){var n;return void 0===e&&(e=VB),(n=t.call(this,e)||this).isMeshBuffer=!0,n.vData=void 0,n.iData=void 0,n.vertexStart=0,n.vertexRange=0,n.indexStart=0,n.indexRange=0,n.lastFilledIndex=0,n.lastFilledVertex=0,n._byteLength=0,n._vertexBuffers=[],n._indexBuffer=null,n._iaPool=null,n._iaInfo=null,n.vData=new Float32Array(256*n.stride),n.iData=new Uint16Array(1536),n}Z(e,t),e.add=function(t){void 0===t&&(t=VB);var e=_z.add();return e._floatStride=t===VB?sz:jB(t)>>2,e._vertexFormat=t,e},e.remove=function(t){var e=_z.data.indexOf(t);-1!==e&&(_z.data[e].clear(),_z.removeAt(e))};var n=e.prototype;return n.request=function(t,e){var n=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=n,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var n=this._byteLength+t*this.stride,i=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,a=this.iData.length,o=this.vData.length,s=this.iData.length;if(n>r||i>a){for(;r<n||a<i;)r=4*(o*=2),a=s*=2;this._reallocBuffer(o,s)}return!0},n.resize=function(t,e){var n=t*this.stride;t>=0&&e>=0&&n<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=e,this._byteLength=n,this.updateRange(0,t,0,e)},n.updateRange=function(t,e,n,i){e>=0&&i>=0&&e<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=n,this.vertexRange=e,this.indexRange=i},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),n=new Uint16Array(this.iData.buffer,0,t),i=this._vertexBuffers[0];this._byteLength>i.size&&i.resize(this._byteLength),i.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(n)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var n=this.stride,i=this._vertexBuffers;i.length||i.push(t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,n,n)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,r,r))),this._iaInfo=new Mr(this._vertexFormat,i,this._indexBuffer),this._iaPool=new Wl((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var n=this.vData;this.vData=new Float32Array(t),n&&this.vData.set(n,0);var i=this.iData;this.iData=new Uint16Array(e),i&&this.iData.set(i,0)},Q(e,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),e}(uz)),_z=new Wl((function(){return new fz}),32),dz=new Qn,pz=new Qn,mz=new Dn,gz=new Xn,vz=new Xn,yz=new Xn,Sz=new Xn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Tz=new ai,xz=function(e){return t({UITransform:e,UITransformComponent:e}),e}((XB=Ec("cc.UITransform"),qB=Gc(),YB=Cc(110),KB=Bc(),QB=Zc(),JB=Xc(),ZB=Zc(),$B=Xc(),XB(tz=qB(tz=YB(tz=KB(tz=bc(tz=Fc((az=rz=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._priority=0,st(e,"_contentSize",nz,rt(e)),st(e,"_anchorPoint",iz,rt(e)),e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},n.onEnable=function(){this.node.on(rA.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},n.onDisable=function(){this.node.off(rA.PARENT_CHANGED,this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,e){var n=this._contentSize;if(void 0===e){if(ln((t=t).width,n.width,sn)&&ln(t.height,n.height,sn))return;n.width=t.width,n.height=t.height}else{if(ln(t=t,n.width,sn)&&ln(e,n.height,sn))return;n.width=t,n.height=e}this.node.emit(rA.SIZE_CHANGED),this._markRenderDataDirty()},n.setAnchorPoint=function(t,e){var n=this._anchorPoint;if(void 0===e){if((t=t).x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&e===n.y)return;n.x=t,n.y=e}this.node.emit(rA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},n.isHit=function(t){for(var e=this._contentSize.width,n=this._contentSize.height,i=dz,r=pz,a=this._getRenderScene().cameras,o=0;o<a.length;o++){var s=a[o];if(s.visibility&this.node.layer){s.node.getWorldRT(gz);var c=gz.m12,l=gz.m13,u=fN.center;if(gz.m12=u.x-(gz.m00*c+gz.m04*l),gz.m13=u.y-(gz.m01*c+gz.m05*l),Xn.invert(gz,gz),Qn.transformMat4(i,t,gz),this.node.getWorldMatrix(yz),Xn.invert(gz,yz),!Xn.strictEquals(gz,Sz)){Qn.transformMat4(r,i,gz),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*n;var h=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=n&&(h=this._maskTest(i)),h)return!0}}}return!1},n.hitTest=function(t){for(var e=this._contentSize.width,n=this._contentSize.height,i=mz,r=dz,a=pz,o=this._getRenderScene().cameras,s=0;s<o.length;s++){var c=o[s];if(c.visibility&this.node.layer&&(Dn.set(i,t.x,t.y,0),c.screenToWorld(i,i),Qn.set(r,i.x,i.y),this.node.getWorldMatrix(yz),Xn.invert(gz,yz),!Xn.strictEquals(gz,Sz))){Qn.transformMat4(a,r,gz),a.x+=this._anchorPoint.x*e,a.y+=this._anchorPoint.y*n;var l=!1;if(a.x>=0&&a.y>=0&&a.x<=e&&a.y<=n&&(l=this._maskTest(r)),l)return!0}}return!1},n._maskTest=function(t){var e,n,i=null===(e=this.node)||void 0===e||null===(n=e.eventProcessor)||void 0===n?void 0:n.maskList;if(i)for(var r=this.node,a=i.length,o=0,s=0;r&&s<a;++o,r=r.parent){var c=i[s];if(o===c.index){if(r!==c.comp.node){i.length=s;break}var l=c.comp;if(l&&l._enabled&&!l.isHit(t))return!1;s++}else if(o>c.index){i.length=s;break}}return!0},n.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(yz),Xn.invert(gz,yz),e||(e=new Dn),Dn.transformMat4(e,t,gz)},n.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(yz),e||(e=new Dn),Dn.transformMat4(e,t,yz)},n.getBoundingBox=function(){Xn.fromRTS(vz,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,n=new ai(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return n.transformMat4(vz),n},n.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(yz),this.getBoundingBoxTo(yz)):this.getBoundingBox()},n.getBoundingBoxTo=function(t){Xn.fromRTS(vz,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var n=this._contentSize.width,i=this._contentSize.height,r=new ai(-this._anchorPoint.x*n,-this._anchorPoint.y*i,n,i);if(Xn.multiply(yz,t,vz),r.transformMat4(yz),!this.node.children)return r;for(var a,o=ot(this.node.children);!(a=o()).done;){var s=a.value;if(s&&s.active){var c=s.getComponent(e);if(c){var l=c.getBoundingBoxTo(t);l&&ai.union(r,r,l)}}}return r},n.getComputeAABB=function(t){var e=this._contentSize.width,n=this._contentSize.height;Tz.set(-this._anchorPoint.x*e,-this._anchorPoint.y*n,e,n),Tz.transformMat4(this.node.worldMatrix);var i=Tz.x+.5*Tz.width,r=Tz.y+.5*Tz.height,a=this.node.worldPosition.z,o=Tz.width/2,s=Tz.height/2;return null!=t?(Ys.set(t,i,r,a,o,s,.001),t):new Ys(i,r,a,o,s,.001)},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},n._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&(t.markForUpdateRenderData(),t.renderData&&(t.renderData.vertDirty=!0))},e.insertChangeMap=function(t){var n=t.uuid;e.priorityChangeNodeMap.has(n)||e.priorityChangeNodeMap.set(n,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var n=t._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp,r=(n?n._priority:0)-(i?i._priority:0);return 0===r?t.getSiblingIndex()-e.getSiblingIndex():r}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},Q(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(rA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(rA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(rA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(rA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(rA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(rA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?R(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=lN.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=lN.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(Zu),rz.EventType=rA,rz.priorityChangeNodeMap=new Map,ct((ez=az).prototype,"contentSize",[QB,JB],Object.getOwnPropertyDescriptor(ez.prototype,"contentSize"),ez.prototype),ct(ez.prototype,"anchorPoint",[ZB,$B],Object.getOwnPropertyDescriptor(ez.prototype,"anchorPoint"),ez.prototype),nz=ct(ez.prototype,"_contentSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ii(100,100)}}),iz=ct(ez.prototype,"_anchorPoint",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(.5,.5)}}),tz=ez))||tz)||tz)||tz)||tz)||tz)||tz));lN.on(cN.EVENT_AFTER_UPDATE,xz._sortSiblings),lN.on(cN.EVENT_BEFORE_SCENE_LAUNCH,xz._cleanChangeMap),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(oz||(oz={}));var Ez,Az,Cz,bz,wz,Iz,Pz,Rz,Dz,Oz,Nz,Mz,Lz,Fz,Bz,zz,Uz,kz,Gz,Vz,Hz=t("StencilManager",function(){function t(){this.stage=oz.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Ri.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Di.KEEP,zFailOp:Di.KEEP,passOp:Di.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?oz.CLEAR_INVERTED:oz.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?oz.ENTER_LEVEL_INVERTED:oz.ENTER_LEVEL},e.enableMask=function(){this.stage=oz.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=oz.DISABLED:this.stage=oz.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=oz.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var n=0,i=!1,r=!1,a=Ri.LESS,o=this.stencilStateMap;if(e&&e.passes[0]){var s=e.passes[0].depthStencilState,c=0,l=0;s.depthTest&&(c=1),s.depthWrite&&(l=1),n=c|l<<1|s.depthFunc<<2|t<<6|this._maskStack.length<<9,i=s.depthTest,r=s.depthWrite,a=s.depthFunc,o=this.stencilStateMapWithDepth}else n=t<<16|this._maskStack.length;if(o&&o.has(n))return o.get(n);this.setStateFromStage(t);var u=new ba(i,r,a,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return o.set(n,u),u},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===oz.DISABLED?(e.stencilTest=!1,e.func=Ri.ALWAYS,e.failOp=Di.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===oz.ENABLED?(e.func=Ri.EQUAL,e.failOp=Di.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===oz.CLEAR?(e.func=Ri.NEVER,e.failOp=Di.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===oz.CLEAR_INVERTED||t===oz.ENTER_LEVEL?(e.func=Ri.NEVER,e.failOp=Di.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===oz.ENTER_LEVEL_INVERTED&&(e.func=Ri.NEVER,e.failOp=Di.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},Q(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());Hz.sharedManager=null,Hz.sharedManager=new Hz,le(Oi),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(Vz||(Vz=t("InstanceMaterialType",{})));var Wz,jz,Xz,qz,Yz,Kz,Qz,Jz,Zz,$z,tU,eU,nU,iU,rU,aU,oU,sU,cU,lU,uU,hU,fU,_U,dU,pU,mU,gU,vU,yU,SU,TU,xU,EU,AU,CU,bU,wU,IU,PU,RU,DU,OU,NU,MU,LU,FU,BU,zU,UU,kU,GU,VU,HU,WU,jU,XU,qU,YU,KU,QU,JU,ZU,$U,tk,ek,nk,ik,rk,ak,ok=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}((Ez=Ec("cc.Renderable2D"),Az=Ac(xz),Cz=Hc(),bz=al($g),wz=al($g),Iz=Zc(),Pz=Xc(),Rz=jc(),Dz=Zc(),Oz=Xc(),Ez(Nz=Az(Nz=bc(Nz=Fc((Gz=kz=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_materials",Lz,rt(e)),st(e,"_customMaterial",Fz,rt(e)),e.stencilStage=oz.DISABLED,st(e,"_srcBlendFactor",Bz,rt(e)),st(e,"_dstBlendFactor",zz,rt(e)),st(e,"_color",Uz,rt(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=-1,e._blendState=new Ia,e._blendHash=0,e._useVertexOpacity=!1,e._lastParent=null,e}Z(e,t);var n=e.prototype;return n.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on(rA.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(rA.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(rA.PARENT_CHANGED,this._colorDirty,this),this.updateMaterial(),this._renderFlag=this._canRender(),this._colorDirty()},n.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},n.onDisable=function(){this.node.off(rA.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(rA.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(rA.PARENT_CHANGED,this._colorDirty,this),this._renderFlag=!1},n.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var e=this._materialInstances[t];e&&e.destroy()}this._blendState&&this._blendState.destroy()},n.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else this._renderDataFlag=t},n.requestRenderData=function(){var t=hz.add();return this._renderData=t,t},n.destroyRenderData=function(){this._renderData&&(hz.remove(this._renderData),this._renderData=null)},n.updateAssembler=function(t){this._renderDataFlag&&(this._assembler.updateRenderData(this,t),this._renderDataFlag=!1),this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),this._renderData&&(this._renderData.material=this._customMaterial,this.markForUpdateRenderData(),this._renderData.passDirty=!0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._renderData&&(this._renderData.material=t,this.markForUpdateRenderData()),this._updateBlendFunc()},n._updateColor=function(){this.node._uiProps.colorDirty=!0,this._assembler&&(this._assembler.updateColor(this),this._renderFlag=this._canRender())},n._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new wa,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=Oi.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,this.renderData&&(this.renderData.passDirty=!0)),this.updateBlendHash()},n.getBlendState=function(){return this._blendState},n._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var n=this.node.children[t].getComponent(e);n&&n.markForUpdateRenderData()}},n._colorDirty=function(){this.node._uiProps.colorDirty=!0},n._onMaterialModified=function(e,n){this._renderData&&(this.markForUpdateRenderData(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,n)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case Vz.ADD_COLOR:t=Eg.get("ui-base-material");break;case Vz.GRAYSCALE:t=Eg.get("ui-sprite-gray-material");break;case Vz.USE_ALPHA_SEPARATED:t=Eg.get("ui-sprite-alpha-sep-material");break;case Vz.USE_ALPHA_SEPARATED_AND_GRAY:t=Eg.get("ui-sprite-gray-alpha-sep-material");break;default:t=Eg.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this.renderData&&(this.renderData.nodeDirty=!0)},n.setTextureDirty=function(){this.renderData&&(this.renderData.textureDirty=!0)},Q(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}}]),e}(PF),kz.BlendState=Oi,kz.Assembler=null,kz.PostAssembler=null,Lz=ct((Mz=Gz).prototype,"_materials",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ct(Mz.prototype,"sharedMaterials",[sl,Cz],Object.getOwnPropertyDescriptor(Mz.prototype,"sharedMaterials"),Mz.prototype),Fz=ct(Mz.prototype,"_customMaterial",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct(Mz.prototype,"customMaterial",[wz,Iz,Pz,Rz,tl],Object.getOwnPropertyDescriptor(Mz.prototype,"customMaterial"),Mz.prototype),ct(Mz.prototype,"color",[Dz,Oz],Object.getOwnPropertyDescriptor(Mz.prototype,"color"),Mz.prototype),Bz=ct(Mz.prototype,"_srcBlendFactor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oi.SRC_ALPHA}}),zz=ct(Mz.prototype,"_dstBlendFactor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oi.ONE_MINUS_SRC_ALPHA}}),Uz=ct(Mz.prototype,"_color",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pn.WHITE.clone()}}),Nz=Mz))||Nz)||Nz)||Nz)||Nz));l.internal.Renderable2D=ok,function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(nk||(nk=t("HorizontalTextAlignment",{}))),le(nk),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(ik||(ik=t("VerticalTextAlignment",{}))),le(ik),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(rk||(rk=t("Overflow",{}))),le(rk),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(ak||(ak=t("CacheMode",{}))),le(ak);var sk,ck,lk,uk=function(e){return t({Label:e,LabelComponent:e}),e}((Wz=Ec("cc.Label"),jz=Gc(),Xz=Cc(110),qz=Bc(),Yz=Zc(),Kz=Xc(),Qz=al(nk),Jz=Zc(),Zz=Xc(),$z=al(ik),tU=Zc(),eU=Xc(),nU=Zc(),iU=Xc(),rU=Zc(),aU=Hc(),oU=Xc(),sU=Zc(),cU=Xc(),lU=Hc(),uU=Zc(),hU=Xc(),fU=al(rk),_U=Zc(),dU=Xc(),pU=Zc(),mU=Xc(),gU=al($F),vU=Zc(),yU=Hc(),SU=Xc(),TU=Zc(),xU=Xc(),EU=al(ak),AU=Zc(),CU=Xc(),bU=Zc(),wU=Xc(),IU=Zc(),PU=Xc(),RU=Zc(),DU=Xc(),OU=Hc(),NU=Zc(),MU=Xc(),Wz(LU=jz(LU=Xz(LU=qz((ek=tk=function(t){function e(){var e;return st(e=t.call(this)||this,"_string",BU,rt(e)),st(e,"_horizontalAlign",zU,rt(e)),st(e,"_verticalAlign",UU,rt(e)),st(e,"_actualFontSize",kU,rt(e)),st(e,"_fontSize",GU,rt(e)),st(e,"_fontFamily",VU,rt(e)),st(e,"_lineHeight",HU,rt(e)),st(e,"_overflow",WU,rt(e)),st(e,"_enableWrapText",jU,rt(e)),st(e,"_font",XU,rt(e)),st(e,"_isSystemFontUsed",qU,rt(e)),st(e,"_spacingX",YU,rt(e)),st(e,"_isItalic",KU,rt(e)),st(e,"_isBold",QU,rt(e)),st(e,"_isUnderline",JU,rt(e)),st(e,"_underlineHeight",ZU,rt(e)),st(e,"_cacheMode",$U,rt(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}Z(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},n.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var e=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),e){var n=e;n.image&&n.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},n.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture(),this._assembler&&this._assembler.updateRenderData(this))},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},n._updateColor=function(){t.prototype._updateColor.call(this),this.updateRenderData(!1)},n._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof _B){var n=e.spriteFrame;if(!n||!n.texture)return!1}return!0},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n._applyFontTexture=function(){this.markForUpdateRenderData();var t=this._font;if(t instanceof _B){var e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===ak.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new XF,this._assemblerData=this._assembler.getAssemblerData();var n=new jm(this._assemblerData.canvas),i=new dg;i.image=n,this._ttfSpriteFrame.texture=i}this.cacheMode!==ak.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},n.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==ak.CHAR){var e=this._texture.texture;if(e instanceof Hm){var n=e.getPixelFormat();t=n===xm.RGBA_ETC1||n===xm.RGB_A_PVRTC_4BPPV1||n===xm.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?Vz.USE_ALPHA_SEPARATED:Vz.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},n._updateBlendFunc=function(){t.prototype._updateBlendFunc.call(this)},Q(e,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==ak.BITMAP||this._font instanceof _B||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===ak.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof _B?this._font.fontSize:-1}}]),e}(ok),tk.HorizontalAlign=nk,tk.VerticalAlign=ik,tk.Overflow=rk,tk.CacheMode=ak,tk._canvasPool=OB.getInstance(),ct((FU=ek).prototype,"string",[Yz,Kz,$c],Object.getOwnPropertyDescriptor(FU.prototype,"string"),FU.prototype),ct(FU.prototype,"horizontalAlign",[Qz,Jz,Zz],Object.getOwnPropertyDescriptor(FU.prototype,"horizontalAlign"),FU.prototype),ct(FU.prototype,"verticalAlign",[$z,tU,eU],Object.getOwnPropertyDescriptor(FU.prototype,"verticalAlign"),FU.prototype),ct(FU.prototype,"fontSize",[nU,iU],Object.getOwnPropertyDescriptor(FU.prototype,"fontSize"),FU.prototype),ct(FU.prototype,"fontFamily",[rU,aU,oU],Object.getOwnPropertyDescriptor(FU.prototype,"fontFamily"),FU.prototype),ct(FU.prototype,"lineHeight",[sU,cU],Object.getOwnPropertyDescriptor(FU.prototype,"lineHeight"),FU.prototype),ct(FU.prototype,"spacingX",[lU,uU,hU],Object.getOwnPropertyDescriptor(FU.prototype,"spacingX"),FU.prototype),ct(FU.prototype,"overflow",[fU,_U,dU],Object.getOwnPropertyDescriptor(FU.prototype,"overflow"),FU.prototype),ct(FU.prototype,"enableWrapText",[pU,mU],Object.getOwnPropertyDescriptor(FU.prototype,"enableWrapText"),FU.prototype),ct(FU.prototype,"font",[gU,vU,yU,SU],Object.getOwnPropertyDescriptor(FU.prototype,"font"),FU.prototype),ct(FU.prototype,"useSystemFont",[TU,xU],Object.getOwnPropertyDescriptor(FU.prototype,"useSystemFont"),FU.prototype),ct(FU.prototype,"cacheMode",[EU,AU,CU],Object.getOwnPropertyDescriptor(FU.prototype,"cacheMode"),FU.prototype),ct(FU.prototype,"isBold",[bU,wU],Object.getOwnPropertyDescriptor(FU.prototype,"isBold"),FU.prototype),ct(FU.prototype,"isItalic",[IU,PU],Object.getOwnPropertyDescriptor(FU.prototype,"isItalic"),FU.prototype),ct(FU.prototype,"isUnderline",[RU,DU],Object.getOwnPropertyDescriptor(FU.prototype,"isUnderline"),FU.prototype),ct(FU.prototype,"underlineHeight",[OU,Vc,NU,MU],Object.getOwnPropertyDescriptor(FU.prototype,"underlineHeight"),FU.prototype),BU=ct(FU.prototype,"_string",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),zU=ct(FU.prototype,"_horizontalAlign",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nk.CENTER}}),UU=ct(FU.prototype,"_verticalAlign",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ik.CENTER}}),kU=ct(FU.prototype,"_actualFontSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GU=ct(FU.prototype,"_fontSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),VU=ct(FU.prototype,"_fontFamily",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),HU=ct(FU.prototype,"_lineHeight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),WU=ct(FU.prototype,"_overflow",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rk.NONE}}),jU=ct(FU.prototype,"_enableWrapText",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),XU=ct(FU.prototype,"_font",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qU=ct(FU.prototype,"_isSystemFontUsed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YU=ct(FU.prototype,"_spacingX",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KU=ct(FU.prototype,"_isItalic",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),QU=ct(FU.prototype,"_isBold",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JU=ct(FU.prototype,"_isUnderline",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZU=ct(FU.prototype,"_underlineHeight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),$U=ct(FU.prototype,"_cacheMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ak.NONE}}),LU=FU))||LU)||LU)||LU)||LU));l.Label=uk,function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(sk||(sk={})),le(sk),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(ck||(ck={})),le(ck),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(lk||(lk={})),le(lk);var hk=Math.PI,fk=Math.min,_k=Math.max,dk=Math.cos,pk=Math.sin,mk=Math.abs,gk=Math.sign,vk=.5522847493;function yk(t,e,n,i,r){t.moveTo(e-i,n),t.bezierCurveTo(e-i,n+r*vk,e-i*vk,n+r,e,n+r),t.bezierCurveTo(e+i*vk,n+r,e+i,n+r*vk,e+i,n),t.bezierCurveTo(e+i,n-r*vk,e+i*vk,n-r,e,n-r),t.bezierCurveTo(e-i*vk,n-r,e-i,n-r*vk,e-i,n),t.close()}function Sk(t,e,n,i,r,a,o,s,c,l,u){var h,f,_,d,p,m,g,v,y,S,T,x,E,A,C,b;l>10||(p=.5*(a+s),m=.5*(o+c),g=.5*((h=.5*(e+i))+(_=.5*(i+a))),v=.5*((f=.5*(n+r))+(d=.5*(r+o))),((C=mk((i-s)*(A=c-n)-(r-c)*(E=s-e)))+(b=mk((a-s)*A-(o-c)*E)))*(C+b)<t.tessTol*(E*E+A*A)?t.addPoint(s,c,0===u?u|lk.PT_BEVEL:u):(Sk(t,e,n,h,f,g,v,T=.5*(g+(y=.5*(_+p))),x=.5*(v+(S=.5*(d+m))),l+1,0),Sk(t,T,x,y,S,p,m,s,c,l+1,u)))}var Tk,xk,Ek,Ak,Ck,bk,wk,Ik,Pk,Rk,Dk,Ok,Nk,Mk,Lk,Fk,Bk,zk,Uk,kk,Gk,Vk,Hk,Wk,jk,Xk,qk,Yk,Kk,Qk,Jk,Zk,$k,tG,eG,nG,iG,rG,aG,oG,sG,cG,lG,uG,hG,fG,_G,dG=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).dx=0,i.dy=0,i.dmx=0,i.dmy=0,i.flags=0,i.len=0,i.reset(),i}return Z(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Qn),pG=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),mG=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Pn.WHITE.clone(),this.lineCap=sk.BUTT,this.strokeColor=Pn.BLACK.clone(),this.lineJoin=ck.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,lk.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,lk.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,n,i,r,a){var o=this._curPath,s=o.points[o.points.length-1];s&&(s.x!==t||s.y!==e||n!==r||i!==a?(Sk(this,s.x,s.y,t,e,n,i,r,a,0,lk.PT_CORNER),this._commandX=r,this._commandY=a):this.lineTo(r,a))},e.quadraticCurveTo=function(t,e,n,i){var r=this._commandX,a=this._commandY;this.bezierCurveTo(r+2/3*(t-r),a+2/3*(e-a),n+2/3*(t-n),i+2/3*(e-i),n,i)},e.arc=function(t,e,n,i,r,a){!function(t,e,n,i,r,a,o){var s,c,l=0,u=0,h=0,f=0,_=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,T=0,x=0;if(u=a-r,o=o||!1)if(mk(u)>=2*hk)u=2*hk;else for(;u<0;)u+=2*hk;else if(mk(u)>=2*hk)u=2*-hk;else for(;u>0;)u-=2*hk;for(c=0|_k(1,fk(mk(u)/(.5*hk)+.5,5)),h=mk(4/3*(1-dk(s=u/c/2))/pk(s)),o||(h=-h),x=0;x<=c;x++)d=e+(f=dk(l=r+u*(x/c)))*i,p=n+(_=pk(l))*i,m=-_*i*h,g=f*i*h,0===x?t.moveTo(d,p):t.bezierCurveTo(v+S,y+T,d-m,p-g,d,p),v=d,y=p,S=m,T=g}(this,t,e,n,i,r,a)},e.ellipse=function(t,e,n,i){yk(this,t,e,n,i),this._curPath.complex=!1},e.circle=function(t,e,n){yk(this,t,e,n,n),this._curPath.complex=!1},e.rect=function(t,e,n,i){this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,n,i,r){!function(t,e,n,i,r,a){if(a<.1)t.rect(e,n,i,r);else{var o=fk(a,.5*mk(i))*gk(i),s=fk(a,.5*mk(r))*gk(r);t.moveTo(e,n+s),t.lineTo(e,n+r-s),t.bezierCurveTo(e,n+r-s*(1-vk),e+o*(1-vk),n+r,e+o,n+r),t.lineTo(e+i-o,n+r),t.bezierCurveTo(e+i-o*(1-vk),n+r,e+i,n+r-s*(1-vk),e+i,n+r-s),t.lineTo(e+i,n+s),t.bezierCurveTo(e+i,n+s*(1-vk),e+i-o*(1-vk),n,e+i-o,n),t.lineTo(e+o,n),t.bezierCurveTo(e+o*(1-vk),n,e,n+s*(1-vk),e,n+s),t.close()}}(this,t,e,n,i,r),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,n=t.length;e<n;e++){var i=t[e];i&&fz.remove(i)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=fz.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,n){var i=this._curPath;if(i){var r=this._points,a=i.points,o=r[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new dG(t,e),r.push(o)),o.flags=n,a.push(o)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new pG,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),gG=GB.concat([new Or("a_dist",pi.R32F)]),vG=WB(gG),yG=jB(gG),SG=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((Tk=Ec("cc.Graphics"),xk=Gc(),Ek=Cc(110),Ak=Bc(),Ck=Xc(),bk=al(ck),wk=Xc(),Ik=al(sk),Pk=Xc(),Rk=Xc(),Dk=Xc(),Ok=Xc(),Nk=Hc(),Tk(Mk=xk(Mk=Ek(Mk=Ak((Hk=Vk=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,st(e,"_lineWidth",Fk,rt(e)),st(e,"_strokeColor",Bk,rt(e)),st(e,"_lineJoin",zk,rt(e)),st(e,"_lineCap",Uk,rt(e)),st(e,"_fillColor",kk,rt(e)),st(e,"_miterLimit",Gk,rt(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=Vz.ADD_COLOR,e.impl=new mG,e}Z(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){this.model=lN.root.createModel(oy),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDisable=function(){t.prototype.onDisable.call(this)},n.onDestroy=function(){this._sceneGetter=null,this.model&&(lN.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var n=0;n<e;++n)this._graphicsUseSubMeshes[n].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,n,i,r,a){this.impl&&this.impl.bezierCurveTo(t,e,n,i,r,a)},n.quadraticCurveTo=function(t,e,n,i){this.impl&&this.impl.quadraticCurveTo(t,e,n,i)},n.arc=function(t,e,n,i,r,a){this.impl&&this.impl.arc(t,e,n,i,r,a)},n.ellipse=function(t,e,n,i){this.impl&&this.impl.ellipse(t,e,n,i)},n.circle=function(t,e,n){this.impl&&this.impl.circle(t,e,n)},n.rect=function(t,e,n,i){this.impl&&this.impl.rect(t,e,n,i)},n.roundRect=function(t,e,n,i,r){this.impl&&this.impl.roundRect(t,e,n,i,r)},n.fillRect=function(t,e,n,i){this.rect(t,e,n,i),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Eg.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=l.director.root.device,n=e.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,65535*yG,yG)),i=e.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),r=new iw([n],gG,Gi.TRIANGLE_LIST,i);r.subMeshIdx=0,this.model.initSubModel(t,r,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(r)}}else R(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var n=this.model.subModels,i=0;i<e.length;i++){var r=e[i],a=n[i].inputAssembler;if(r.lastFilledVertex!==r.vertexStart){var o=new Float32Array(r.vData.buffer,0,r.vertexStart*vG);a.vertexBuffers[0].update(o),a.vertexCount=r.vertexStart;var s=new Uint16Array(r.iData.buffer,0,r.indexStart);a.indexBuffer.update(s),a.indexCount=r.indexStart,r.lastFilledVertex=r.vertexStart,r.lastFilledIndex=r.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),n=this.model.subModels.length;if(e.length>n)for(var i=n;i<e.length;i++)this.activeSubModel(i)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},Q(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),e}(ok),Vk.LineJoin=ck,Vk.LineCap=sk,ct((Lk=Hk).prototype,"lineWidth",[Vc,Ck],Object.getOwnPropertyDescriptor(Lk.prototype,"lineWidth"),Lk.prototype),ct(Lk.prototype,"lineJoin",[bk,wk],Object.getOwnPropertyDescriptor(Lk.prototype,"lineJoin"),Lk.prototype),ct(Lk.prototype,"lineCap",[Ik,Pk],Object.getOwnPropertyDescriptor(Lk.prototype,"lineCap"),Lk.prototype),ct(Lk.prototype,"strokeColor",[Rk],Object.getOwnPropertyDescriptor(Lk.prototype,"strokeColor"),Lk.prototype),ct(Lk.prototype,"fillColor",[Dk],Object.getOwnPropertyDescriptor(Lk.prototype,"fillColor"),Lk.prototype),ct(Lk.prototype,"miterLimit",[Ok],Object.getOwnPropertyDescriptor(Lk.prototype,"miterLimit"),Lk.prototype),ct(Lk.prototype,"color",[sl,Nk],Object.getOwnPropertyDescriptor(Lk.prototype,"color"),Lk.prototype),Fk=ct(Lk.prototype,"_lineWidth",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Bk=ct(Lk.prototype,"_strokeColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pn.BLACK.clone()}}),zk=ct(Lk.prototype,"_lineJoin",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ck.MITER}}),Uk=ct(Lk.prototype,"_lineCap",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sk.BUTT}}),kk=ct(Lk.prototype,"_fillColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pn.WHITE.clone()}}),Gk=ct(Lk.prototype,"_miterLimit",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Mk=Lk))||Mk)||Mk)||Mk)||Mk));l.Graphics=SG;var TG,xG=new Xn,EG=new Qn,AG=new Xn,CG=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(TG||(TG={})),le(TG);var bG=function(e){return t({Mask:e,MaskComponent:e}),e}((Wk=Ec("cc.Mask"),jk=Gc(),Xk=Cc(110),qk=Bc(),Yk=al(TG),Kk=Xc(),Qk=Zc(),Jk=Xc(),Zk=Hc(),$k=al(XF),tG=Hc(),eG=Hc(),nG=qc(),iG=Hc(),rG=Hc(),Wk(aG=jk(aG=Xk(aG=qk((_G=fG=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,st(e,"_type",sG,rt(e)),st(e,"_inverted",cG,rt(e)),st(e,"_segments",lG,rt(e)),st(e,"_spriteFrame",uG,rt(e)),st(e,"_alphaThreshold",hG,rt(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=Vz.ADD_COLOR,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._enableGraphics()},n.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},n.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},n.onDestroy=function(){this._clearModel&&this._clearModelMesh&&(lN.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics(),t.prototype.onDestroy.call(this)},n.isHit=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=n.width,r=n.height,a=EG;this.node.getWorldMatrix(xG),Xn.invert(AG,xG),Qn.transformMat4(a,t,AG);var o=e.anchorPoint;a.x+=o.x*i,a.y+=o.y*r;var s=!1;if(this.type===TG.RECT||this.type===TG.GRAPHICS_STENCIL||this.type===TG.IMAGE_STENCIL)s=a.x>=0&&a.y>=0&&a.x<=i&&a.y<=r;else if(this.type===TG.ELLIPSE){var c=i/2,l=r/2,u=a.x-.5*i,h=a.y-.5*r;s=u*u/(c*c)+h*h/(l*l)<1}return this._inverted&&(s=!s),s},n._render=function(t){t.commitComp(this,this.renderData,null,this._assembler,null)},n._postRender=function(t){this._postAssembler&&t.commitComp(this,null,null,this._postAssembler,null)},n._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},n._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==TG.IMAGE_STENCIL||null!==this._spriteFrame)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this),n=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==n&&(this._postAssembler=n),this._useRenderData()},n._createGraphics=function(){if(!this._graphics){var t=this._graphics=new SG;t._objFlags|=_l.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=Pn.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},n._updateGraphics=function(){if(this._graphics&&(this._type===TG.RECT||this._type===TG.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var n=t.contentSize,i=n.width,r=n.height,a=t.anchorPoint,o=-i*a.x,s=-r*a.y;if(this._type===TG.RECT)e.rect(o,s,i,r);else if(this._type===TG.ELLIPSE){for(var c=function(t,e,n){CG.length=0;for(var i=2*Math.PI/n,r=0;r<n;++r)CG.push(new Dn(e.x*Math.cos(i*r)+t.x,e.y*Math.sin(i*r)+t.y,0));return CG}(new Dn(o+i/2,s+r/2,0),new Dn(i/2,r/2,0),this._segments),l=0;l<c.length;++l){var u=c[l];0===l?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},n._createClearModel=function(){if(!this._clearModel){var t=Eg.get("default-clear-stencil");this._clearStencilMtl=new ly({parent:t,owner:this,subModelIdx:0}),this._clearModel=lN.root.createModel(oy),this._clearModel.node=this._clearModel.transform=this.node;var e=jB(kB),n=l.director.root.device,i=n.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.DEVICE,4*e,e)),r=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);i.update(r);var a=n.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);a.update(o),this._clearModelMesh=new iw([i],kB,Gi.TRIANGLE_LIST,a),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},n._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=oz.DISABLED,this._type===TG.IMAGE_STENCIL?(t=Eg.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=Eg.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},n._enableGraphics=function(){this._graphics&&(this._graphics._renderFlag=this._graphics._canRender())},n._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},n._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},n._useRenderData=function(){this._type!==TG.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},Q(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==TG.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.stencilStage=oz.DISABLED,this._graphics&&(this._graphics.stencilStage=oz.DISABLED)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=un(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===TG.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===TG.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),e}(ok),fG.Type=TG,ct((oG=_G).prototype,"type",[Yk,Kk],Object.getOwnPropertyDescriptor(oG.prototype,"type"),oG.prototype),ct(oG.prototype,"inverted",[Qk,Jk],Object.getOwnPropertyDescriptor(oG.prototype,"inverted"),oG.prototype),ct(oG.prototype,"segments",[Zk],Object.getOwnPropertyDescriptor(oG.prototype,"segments"),oG.prototype),ct(oG.prototype,"spriteFrame",[$k,tG],Object.getOwnPropertyDescriptor(oG.prototype,"spriteFrame"),oG.prototype),ct(oG.prototype,"alphaThreshold",[eG,nG,Jc],Object.getOwnPropertyDescriptor(oG.prototype,"alphaThreshold"),oG.prototype),ct(oG.prototype,"color",[sl,iG],Object.getOwnPropertyDescriptor(oG.prototype,"color"),oG.prototype),ct(oG.prototype,"customMaterial",[sl,rG],Object.getOwnPropertyDescriptor(oG.prototype,"customMaterial"),oG.prototype),sG=ct(oG.prototype,"_type",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return TG.RECT}}),cG=ct(oG.prototype,"_inverted",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lG=ct(oG.prototype,"_segments",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),uG=ct(oG.prototype,"_spriteFrame",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hG=ct(oG.prototype,"_alphaThreshold",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),aG=oG))||aG)||aG)||aG)||aG));XP._maskComp=bG,l.Mask=bG;var wG,IG,PG,RG,DG,OG,NG,MG,LG,FG,BG,zG,UG,kG,GG,VG,HG,WG,jG,XG,qG,YG,KG,QG,JG,ZG,$G,tV,eV,nV,iV,rV,aV,oV,sV,cV,lV,uV,hV,fV,_V,dV,pV,mV,gV,vV,yV,SV,TV,xV,EV,AV,CV,bV,wV,IV,PV,RV,DV,OV,NV,MV,LV=/^(click)(\s)*=|(param)(\s)*=/,FV=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,BV=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,n=t.length;e<n;){var i=t.indexOf(">",e),r=-1;if(i>=0&&(r=t.lastIndexOf("<",i))<e-1&&(r=t.indexOf("<",i+1),i=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=n;else{var a=t.substring(e,r),o=t.substring(r+1,i);""===o&&(a=t.substring(e,i+1)),this._processResult(a),-1===i?i=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=i+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},n=/^(color|size)(\s)*=/.exec(t),i="",r=0,a="";if(n){if(i=n[0],""===(t=t.substring(i.length).trim()))return e;switch(r=t.indexOf(" "),i[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(a=t.substring(r+1).trim(),e.event=this._processEventHandler(a)),e}if((n=/^(br(\s)*\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("br")&&"/"===i[i.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="",s=-1;if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("img")&&"/"===i[i.length-1]){var c;n=FV.exec(t);for(var l=!1;n;){var u=(i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length)).length;if(i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),o=t.substring(u).trim(),s="src"===i?this.getRightQuotationIndex(o):-1,c=(r=o.indexOf(" ",s+1>=o.length?-1:s+1))>-1?o.substr(0,r):o,t=o.substring(r).trim(),c.endsWith("/")&&(c=c.slice(0,-1)),"src"===i){switch(c.charCodeAt(0)){case 34:case 39:l=!0,c=c.slice(1,-1)}e.isImage=!0,e.src=c}else if("height"===i)e.imageHeight=parseInt(c);else if("width"===i)e.imageWidth=parseInt(c);else if("align"===i){switch(c.charCodeAt(0)){case 34:case 39:c=c.slice(1,-1)}e.imageAlign=c.toLowerCase()}else"offset"===i?e.imageOffset=c:"click"===i&&(e.event=this._processEventHandler(i+"="+c));e.event&&"param"===i&&(e.event[i]=c.replace(/^"|"$/g,"")),n=FV.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(t)){var h={color:"#ffffff",width:1};if(t=n[0].substring("outline".length).trim()){var f,_=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=_.exec(t);n;)i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length),f=(r=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+f):"color"===i?h.color=f:"width"===i&&(h.width=parseInt(f)),e.event&&"param"===i&&(e.event[i]=f.replace(/^"|"$/g,"")),n=_.exec(t)}e.outline=h}if((n=/^(on|u|b|i)(\s)*/.exec(t))&&n[0].length>0){switch(i=n[0],t=t.substring(i.length).trim(),i[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e.getRightQuotationIndex=function(t){var e=-1,n=-1,i=t.indexOf("'"),r=t.indexOf('"'),a=r>-1&&(r<i||-1===i);return i>-1&&(i<r||-1===r)?(e=i,n=t.indexOf("'",e+1>=t.length?-1:e+1)):a&&(e=r,n=t.indexOf('"',e+1>=t.length?-1:e+1)),n},e._processEventHandler=function(t){for(var e={},n=0,i=!1,r=LV.exec(t);r;){var a=r[0],o="";if(i=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))(n=t.indexOf('"',1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else if("'"===t.charAt(0))(n=t.indexOf("'",1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else{var s=/(\S)+/.exec(t);n=(o=s?s[0]:"").length}i&&(e[a=a.substring(0,a.length-1).trim()]=o),t=t.substring(n).trim(),r=LV.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var n=this._stack[this._stack.length-1];for(var i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,n=ot(this._specialSymbolArray);!(e=n()).done;){var i=e.value,r=i[0],a=i[1];t=t.replace(r,a)}return t},t}()),zV=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((wG=Ec("cc.LabelOutline"),IG=Gc(),PG=Cc(110),RG=Bc(),DG=Ac(uk),OG=Xc(),NG=Xc(),wG(MG=IG(MG=PG(MG=RG(MG=DG(MG=Fc((zG=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_color",FG,rt(e)),st(e,"_width",BG,rt(e)),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(uk);t&&t.updateRenderData(!0)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(Zu),FG=ct((LG=zG).prototype,"_color",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(0,0,0,255)}}),BG=ct(LG.prototype,"_width",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ct(LG.prototype,"color",[OG],Object.getOwnPropertyDescriptor(LG.prototype,"color"),LG.prototype),ct(LG.prototype,"width",[NG],Object.getOwnPropertyDescriptor(LG.prototype,"width"),LG.prototype),MG=LG))||MG)||MG)||MG)||MG)||MG)||MG));l.LabelOutline=zV,function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(DV||(DV={})),le(DV),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(OV||(OV={})),le(OV),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(NV||(NV={})),le(NV),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(MV||(MV={}));var UV,kV=function(e){return t({Sprite:e,SpriteComponent:e}),e}((UG=Ec("cc.Sprite"),kG=Gc(),GG=Cc(110),VG=Bc(),HG=al(YF),WG=Zc(),jG=Xc(),XG=al(XF),qG=Zc(),YG=Xc(),KG=al(DV),QG=Zc(),JG=Xc(),ZG=al(OV),$G=Zc(),tV=Xc(),eV=Zc(),nV=Xc(),iV=qc(),rV=Zc(),aV=Xc(),oV=qc(),sV=Zc(),cV=Xc(),lV=Hc(),uV=Zc(),hV=Xc(),fV=Zc(),_V=Xc(),dV=al(NV),pV=Zc(),mV=Xc(),UG(gV=kG(gV=GG(gV=VG((RV=PV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_spriteFrame",yV,rt(e)),st(e,"_type",SV,rt(e)),st(e,"_fillType",TV,rt(e)),st(e,"_sizeMode",xV,rt(e)),st(e,"_fillCenter",EV,rt(e)),st(e,"_fillStart",AV,rt(e)),st(e,"_fillRange",CV,rt(e)),st(e,"_isTrimmedMode",bV,rt(e)),st(e,"_useGrayscale",wV,rt(e)),st(e,"_atlas",IV,rt(e)),e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},n.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial();var e=this._spriteFrame;e&&(this._updateUVs(),this._type===DV.SLICED&&e.on(XF.EVENT_UV_UPDATED,this._updateUVs,this))},n.onDisable=function(){this._spriteFrame&&this._type===DV.SLICED&&this._spriteFrame.off(XF.EVENT_UV_UPDATED,this._updateUVs,this)},n.onDestroy=function(){t.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},n.changeMaterialForDefine=function(){var t,e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var n=!1;if(t instanceof Hm){var i=t.getPixelFormat();n=i===xm.RGBA_ETC1||i===xm.RGB_A_PVRTC_4BPPV1||i===xm.RGB_A_PVRTC_2BPPV1}n&&this.grayscale?this._instanceMaterialType=Vz.USE_ALPHA_SEPARATED_AND_GRAY:n?this._instanceMaterialType=Vz.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=Vz.GRAYSCALE:this._instanceMaterialType=Vz.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var e=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof Lx){var n=J({SAMPLE_FROM_RT:!0},e.passes[0].defines),i=new $g;i.initialize({effectAsset:e.effectAsset,defines:n}),e=i}return e},n._render=function(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.texture)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateUVs(this),this._updateColor()),this._spriteFrame&&(this._type===DV.SLICED?this._spriteFrame.on(XF.EVENT_UV_UPDATED,this._updateUVs,this):this._spriteFrame.off(XF.EVENT_UV_UPDATED,this._updateUVs,this))},n._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(NV.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(NV.TRIMMED===this._sizeMode){var e=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},n._resized=function(){},n._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)},n._updateUVs=function(){this._assembler&&this._assembler.updateUVs(this)},n._applySpriteFrame=function(t){var e=this._spriteFrame;t&&this._type===DV.SLICED&&t.off(XF.EVENT_UV_UPDATED,this._updateUVs,this),this._updateUVs();var n=!1;e&&(t&&t.texture===e.texture||(n=!0),n&&(this._renderData&&(this._renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize(),this._type===DV.SLICED&&e.on(XF.EVENT_UV_UPDATED,this._updateUVs,this))},Q(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===OV.RADIAL||this._fillType===OV.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===DV.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=un(t,0,1),this._type===DV.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=un(t,-1,1),this._type===DV.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===DV.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==NV.CUSTOM&&this._applySpriteSize())}}]),e}(ok),PV.FillType=OV,PV.Type=DV,PV.SizeMode=NV,PV.EventType=MV,ct((vV=RV).prototype,"spriteAtlas",[HG,WG,jG],Object.getOwnPropertyDescriptor(vV.prototype,"spriteAtlas"),vV.prototype),ct(vV.prototype,"spriteFrame",[XG,qG,YG],Object.getOwnPropertyDescriptor(vV.prototype,"spriteFrame"),vV.prototype),ct(vV.prototype,"type",[KG,QG,JG],Object.getOwnPropertyDescriptor(vV.prototype,"type"),vV.prototype),ct(vV.prototype,"fillType",[ZG,$G,tV],Object.getOwnPropertyDescriptor(vV.prototype,"fillType"),vV.prototype),ct(vV.prototype,"fillCenter",[eV,nV],Object.getOwnPropertyDescriptor(vV.prototype,"fillCenter"),vV.prototype),ct(vV.prototype,"fillStart",[iV,rV,aV],Object.getOwnPropertyDescriptor(vV.prototype,"fillStart"),vV.prototype),ct(vV.prototype,"fillRange",[oV,sV,cV],Object.getOwnPropertyDescriptor(vV.prototype,"fillRange"),vV.prototype),ct(vV.prototype,"trim",[lV,uV,hV],Object.getOwnPropertyDescriptor(vV.prototype,"trim"),vV.prototype),ct(vV.prototype,"grayscale",[Vc,fV,_V],Object.getOwnPropertyDescriptor(vV.prototype,"grayscale"),vV.prototype),ct(vV.prototype,"sizeMode",[dV,pV,mV],Object.getOwnPropertyDescriptor(vV.prototype,"sizeMode"),vV.prototype),yV=ct(vV.prototype,"_spriteFrame",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SV=ct(vV.prototype,"_type",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DV.SIMPLE}}),TV=ct(vV.prototype,"_fillType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return OV.HORIZONTAL}}),xV=ct(vV.prototype,"_sizeMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NV.TRIMMED}}),EV=ct(vV.prototype,"_fillCenter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(0,0)}}),AV=ct(vV.prototype,"_fillStart",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CV=ct(vV.prototype,"_fillRange",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bV=ct(vV.prototype,"_isTrimmedMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),wV=ct(vV.prototype,"_useGrayscale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IV=ct(vV.prototype,"_atlas",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gV=vV))||gV)||gV)||gV)||gV));l.Sprite=kV;var GV,VV,HV,WV,jV,XV,qV,YV,KV,QV,JV,ZV,$V,tH,eH,nH,iH,rH,aH,oH,sH,cH,lH,uH,hH,fH,_H,dH,pH,mH,gH,vH,yH,SH,TH,xH,EH,AH,CH,bH,wH,IH,PH,RH,DH,OH,NH,MH,LH,FH,BH,zH,UH=t("RenderRoot2D",Ec("cc.RenderRoot2D")(UV=Cc(100)(UV=Bc()(UV=Ac(xz)(UV=bc(UV=Fc(UV=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.onEnable=function(){l.director.root.batcher2D.addScreen(this)},n.onDisable=function(){l.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){l.director.root.batcher2D.removeScreen(this)},e}(Zu))||UV)||UV)||UV)||UV)||UV)||UV),kH=new Dn,GH=oe({OVERLAY:0,INTERSPERSE:1}),VH=function(e){return t({Canvas:e,CanvasComponent:e}),e}((GV=Ec("cc.Canvas"),VV=Gc(),HV=Cc(100),WV=Bc(),jV=al(wF),XV=Xc(),qV=Xc(),YV=al(wF),GV(KV=VV(KV=HV(KV=WV(KV=Fc(KV=bc((ct((QV=function(t){function e(){var e;return st(e=t.call(this)||this,"_cameraComponent",JV,rt(e)),st(e,"_alignCanvasWithScreen",ZV,rt(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new Dn,e._renderMode=GH.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(rt(e)),e}Z(e,t);var n=e.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on(wF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(rA.TRANSFORM_CHANGED,this._thisOnCameraResized)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on(wF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off(wF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(rA.TRANSFORM_CHANGED,this._thisOnCameraResized)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=fN.height/2;else{var t=sh.windowSize;this._cameraComponent.orthoHeight=t.height/yN.getScaleY()/2}this.node.getWorldPosition(kH),this._cameraComponent.node.setWorldPosition(kH.x,kH.y,1e3)}},n._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===GH.OVERLAY?e|1<<30:e&~(1<<30)}return 0},Q(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),e}(UH)).prototype,"cameraComponent",[jV,XV],Object.getOwnPropertyDescriptor(QV.prototype,"cameraComponent"),QV.prototype),ct(QV.prototype,"alignCanvasWithScreen",[qV],Object.getOwnPropertyDescriptor(QV.prototype,"alignCanvasWithScreen"),QV.prototype),JV=ct(QV.prototype,"_cameraComponent",[YV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZV=ct(QV.prototype,"_alignCanvasWithScreen",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),KV=QV))||KV)||KV)||KV)||KV)||KV)||KV));l.Canvas=VH,k(t("UIComponent",Ec("cc.UIComponent")($V=Ac(xz)($V=Cc(110)($V=bc($V=Fc($V=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastParent=null,e.stencilStage=oz.DISABLED,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},e}(Zu))||$V)||$V)||$V)||$V)||$V).prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),k(ok.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor"},{name:"dstBlendFactor"}]),U(VH.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:Pn.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),G(xz.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),l.UITransformComponent=xz,ie.setClassAlias(xz,"cc.UITransformComponent"),ie.setClassAlias(ok,"cc.RenderComponent"),l.CanvasComponent=VH,ie.setClassAlias(VH,"cc.CanvasComponent");var HH=new BV,WH="RICHTEXT_CHILD",jH="RICHTEXT_Image_CHILD",XH=new ee((function(t){if(!l.isValid(t.node))return!1;var e=t.node.getComponent(zV);return e&&(e.width=0),!0}),20),qH=new ee((function(t){return l.isValid(t.node)}),10);function YH(t){return{node:new ob(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function KH(t,e){var n;t===WH?n=XH._get():t===jH&&(n=qH._get());var i=(n=n||YH(t)).node;return i||(i=new ob(t)),i.hideFlags|=_l.Flags.DontSave|_l.Flags.HideInHierarchy,t===jH?(n.comp=i.getComponent(kV)||i.addComponent(kV),n.comp.spriteFrame=e,n.comp.type=kV.Type.SLICED,n.comp.sizeMode=kV.SizeMode.CUSTOM):(n.comp=i.getComponent(uk)||i.addComponent(uk),n.comp.string=e,n.comp.horizontalAlign=nk.LEFT,n.comp.verticalAlign=ik.TOP,n.comp.underlineHeight=2),i.setPosition(0,0,0),i._uiProps.uiTransformComp.setAnchorPoint(.5,.5),n.node=i,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var QH,JH=function(e){return t({RichText:e,RichTextComponent:e}),e}((tH=Ec("cc.RichText"),eH=Gc(),nH=Cc(110),iH=Bc(),rH=Xc(),aH=al(nk),oH=Xc(),sH=al(ik),cH=Xc(),lH=Xc(),uH=Xc(),hH=al($F),fH=Xc(),_H=Xc(),dH=Zc(),pH=al(ak),mH=Xc(),gH=Xc(),vH=Xc(),yH=al(YF),SH=Xc(),TH=Xc(),tH(xH=eH(xH=nH(xH=iH(xH=Fc((zH=BH=function(t){function e(){var e;return st(e=t.call(this)||this,"_lineHeight",AH,rt(e)),st(e,"_string",CH,rt(e)),st(e,"_horizontalAlign",bH,rt(e)),st(e,"_verticalAlign",wH,rt(e)),st(e,"_fontSize",IH,rt(e)),st(e,"_maxWidth",PH,rt(e)),st(e,"_fontFamily",RH,rt(e)),st(e,"_font",DH,rt(e)),st(e,"_isSystemFontUsed",OH,rt(e)),st(e,"_userDefinedFont",NH,rt(e)),st(e,"_cacheMode",MH,rt(e)),st(e,"_imageAtlas",LH,rt(e)),st(e,"_handleTouchEvent",FH,rt(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._labelChildrenNum=0,e._updateRichTextStatus=e._updateRichText,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this.node.on(rA.LAYER_CHANGED,this._applyLayer,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.start=function(){this._onTTFLoaded(),this.node.on(rA.ANCHOR_CHANGED,this._updateRichTextPosition,this)},n.onRestore=function(){},n.onDestroy=function(){for(var t,e=ot(this._segments);!(t=e()).done;){var n=t.value;n.node.removeFromParent(),n.type===WH?XH.put(n):n.type===jH&&qH.put(n)}this.node.off(rA.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(rA.LAYER_CHANGED,this._applyLayer,this)},n._addEventListeners=function(){this.node.on(rA.TOUCH_END,this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off(rA.TOUCH_END,this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},n._createFontLabel=function(t){return KH(WH,t)},n._createImage=function(t){return KH(jH,t)},n._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},n.SplitLongStringApproximatelyIn2048=function(t,e){var n=[];if(this._calculateSize(e,t).x<2048)n.push(t);else for(var i=t.split("\n"),r=0;r<i.length;r++)if(this._calculateSize(e,i[r]).x<2048)n.push(i[r]);else{var a=this.splitLongStringOver2048(i[r],e);n.push.apply(n,a)}return n},n.splitLongStringOver2048=function(t,e){for(var n=[],i=t,r=0,a=i.length/2,o=i.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o),l=(this._calculateSize(e,s),1*this.maxWidth);c.x>l;){if((a/=2)<1){a*=2;break}o=o.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o)}for(var u=1e3,h=1;u&&r<t.length;){for(;u&&c.x<l;){var f=PB(s);f&&f.length>0&&(h=f[0].length),a+=h,o=i.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o),u--}for(;u&&o.length>=2&&c.x>l;)a-=h,o=i.substring(r,a),c=this._calculateSize(e,o),h=1,u--;if(o.length>=2){var _=RB(o);_&&_.length>0&&o!==_[0]&&(a-=_[0].length,o=i.substring(r,a))}if(n.push(o),r=a,a+=o.length,o=i.substring(r,a),s=i.substring(a),u--,this._calculateSize(e,s).x<2048){r=t.length,a=t.length,o=s,n.push(o);break}c=this._calculateSize(e,o)}return n},n._measureText=function(t,e){var n=this,i=function(e){return n._calculateSize(t,e).width};return e?i(e):i},n._calculateSize=function(t,e){var n;return 0===this._labelSegmentsCache.length?(n=this._createFontLabel(e),this._labelSegmentsCache.push(n)):(n=this._labelSegmentsCache[0]).node.getComponent(uk).string=e,n.styleIndex=t,this._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize},n._onTouchEnded=function(t){for(var e,n=this,i=this.node.getComponents(Zu),r=function(){var r=e.value,a=r.clickHandler,o=r.clickParam;a&&n._containsTouchLocation(r,t.touch.getUILocation())&&(i.forEach((function(e){var n=e[a];e.enabledInHierarchy&&n&&n.call(e,t,o)})),t.propagationStopped=!0)},a=ot(this._segments);!(e=a()).done;)r()},n._containsTouchLocation=function(t,e){var n=t.node.getComponent(xz);return!!n&&n.getBoundingBoxToWorld().contains(e)},n._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var n=t[e];if(n.name===WH||n.name===jH){n.parent===this.node?n.parent=null:t.splice(e,1);var i=YH(n.name);i.node=n,n.name===WH?(i.comp=n.getComponent(uk),XH.put(i)):(i.comp=n.getComponent(kV),qH.put(i)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var n=this.node.children[e];n.name!==WH&&n.name!==jH||(n.active=t)}},n._addLabelSegment=function(t,e){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(t);else{var i=(n=this._labelSegmentsCache.pop()).node.getComponent(uk);i&&(i.string=t)}var r=n.comp;return r.verticalAlign!==this._verticalAlign&&(r.verticalAlign=this._verticalAlign),n.styleIndex=e,n.lineCount=this._lineCount,n.node._uiProps.uiTransformComp.setAnchorPoint(0,0),n.node.layer=this.node.layer,this.node.insertChild(n.node,this._labelChildrenNum++),this._applyTextAttribute(n),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(t,e,n){var i=e;if(this._lineOffsetX>0&&i+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var a=this._getFirstWordLen(t,r,t.length),o=t.substr(r,a),s=this._measureText(n,o);if(!(this._lineOffsetX+s<=this._maxWidth)){if(r>0){var c=t.substr(0,r);this._addLabelSegment(c,n),t=t.substr(r,t.length),i=this._measureText(n,t)}this._updateLineInfo();break}this._lineOffsetX+=s,r+=a}if(i>this._maxWidth)for(var l=DB(t,i,this._maxWidth,this._measureText(n)),u=0;u<l.length;++u){var h=l[u],f=this._addLabelSegment(h,n).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=f.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(t,n)},n._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var n=this._textArray[e],i=t[e];if(n.text!==i.text)return!0;var r=n.style,a=i.style;if(r){if(a){if(!!a.outline!=!!r.outline)return!0;if(r.size!==a.size||r.italic!==a.italic||r.isImage!==a.isImage)return!0;if(r.src!==a.src||r.imageAlign!==a.imageAlign||r.imageHeight!==a.imageHeight||r.imageWidth!==a.imageWidth||r.imageOffset!==a.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(a&&(a.size||a.italic||a.isImage||a.outline))return!0}return!1},n._addRichTextImageElement=function(t){if(t.style){var e=t.style,n=e.src,i=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(i){var r=this._createImage(i);switch(r.comp,e.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(r.imageOffset=e.imageOffset),r.node.layer=this.node.layer,this.node.insertChild(r.node,this._labelChildrenNum++),this._segments.push(r);var a=i.rect.clone(),o=1,s=a.width,c=a.height,l=e.imageWidth||0,u=e.imageHeight||0;u>0?(s*=o=u/c,c*=o):(s*=o=this._lineHeight/c,c*=o),l>0&&(s=l),this._maxWidth>0?(this._lineOffsetX+s>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(s,c),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var h=e.event;h&&(r.clickHandler=h.click,r.clickParam=h.param)}else R(4400)}},n._updateRichText=function(){if(this.enabledInHierarchy){var t=HH.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,n=!1,i=0;i<this._textArray.length;++i){var r=this._textArray[i],a=r.text;if(void 0!==a){if(""===a){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=(a=this.SplitLongStringApproximatelyIn2048(a,i).join("\n")).split("\n"),s=0;s<o.length;++s){var c=o[s];if(""!==c)if(n=!1,this._maxWidth>0){var l=this._measureText(i,c);this._updateRichTextWithMaxWidth(c,l,i),o.length>1&&s<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(c,i),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&s<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&s===o.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+pB)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(t,e,n){var i=t.charAt(e);if(CB(i)||bB(i))return 1;for(var r=1,a=e+1;a<n&&!bB(i=t.charAt(a))&&!CB(i);++a)r++;return r},n._updateRichTextPosition=function(){for(var t=0,e=1,n=this._lineCount,i=this.node._uiProps.uiTransformComp,r=i.anchorX,a=i.anchorY,o=0;o<this._segments.length;++o){var s=this._segments[o],c=s.lineCount;c>e&&(t=0,e=c);var l=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case nk.LEFT:break;case nk.CENTER:l-=this._linesWidth[c-1]/2;break;case nk.RIGHT:l-=this._linesWidth[c-1]}var u=s.node.position;if(s.node.setPosition(t+l,this._lineHeight*(n-c)-this._labelHeight*a,u.z),c===e&&(t+=s.node._uiProps.uiTransformComp.width),s.node.getComponent(kV)){var h=s.node.position.clone(),f=this._lineHeight,_=this._lineHeight*(1+pB);switch(s.node._uiProps.uiTransformComp.anchorY){case 1:h.y+=f+(_-f)/2;break;case.5:h.y+=_/2;break;default:h.y+=(_-f)/2}if(s.imageOffset){var d=s.imageOffset.split(",");if(1===d.length&&d[0]){var p=parseFloat(d[0]);Number.isInteger(p)&&(h.y+=p)}else if(2===d.length){var m=parseFloat(d[0]),g=parseFloat(d[1]);Number.isInteger(m)&&(h.x+=m),Number.isInteger(g)&&(h.y+=g)}}s.node.position=h}var v=s.node.getComponent(zV);if(v){var y=s.node.position.clone();y.y-=v.width,s.node.position=y}}},n._convertLiteralColorValue=function(t){var e=t.toUpperCase();return Pn[e]?Pn[e]:(new Pn).fromHEX(t)},n._applyTextAttribute=function(t){var e=t.node.getComponent(uk);if(e){this._resetLabelState(e);var n,i=t.styleIndex;if(this._textArray[i]&&(n=this._textArray[i].style),n){if(e.color=this._convertLiteralColorValue(n.color||"white"),e.isBold=!!n.bold,e.isItalic=!!n.italic,e.isUnderline=!!n.underline,n.outline){var r=t.node.getComponent(zV);r||(r=t.node.addComponent(zV)),r.color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width}e.fontSize=n.size||this._fontSize,t.clickHandler="",t.clickParam="";var a=n.event;a&&(t.clickHandler=a.click||"",t.clickParam=a.param||"")}e.cacheMode=this._cacheMode,this._font instanceof $F&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},n._applyLayer=function(){for(var t,e=ot(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},n._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=Pn.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},Q(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(Zu),BH.HorizontalAlign=nk,BH.VerticalAlign=ik,ct((EH=zH).prototype,"string",[$c,rH],Object.getOwnPropertyDescriptor(EH.prototype,"string"),EH.prototype),ct(EH.prototype,"horizontalAlign",[aH,oH],Object.getOwnPropertyDescriptor(EH.prototype,"horizontalAlign"),EH.prototype),ct(EH.prototype,"verticalAlign",[sH,cH],Object.getOwnPropertyDescriptor(EH.prototype,"verticalAlign"),EH.prototype),ct(EH.prototype,"fontSize",[lH],Object.getOwnPropertyDescriptor(EH.prototype,"fontSize"),EH.prototype),ct(EH.prototype,"fontFamily",[uH],Object.getOwnPropertyDescriptor(EH.prototype,"fontFamily"),EH.prototype),ct(EH.prototype,"font",[hH,fH],Object.getOwnPropertyDescriptor(EH.prototype,"font"),EH.prototype),ct(EH.prototype,"useSystemFont",[_H,dH],Object.getOwnPropertyDescriptor(EH.prototype,"useSystemFont"),EH.prototype),ct(EH.prototype,"cacheMode",[pH,mH],Object.getOwnPropertyDescriptor(EH.prototype,"cacheMode"),EH.prototype),ct(EH.prototype,"maxWidth",[gH],Object.getOwnPropertyDescriptor(EH.prototype,"maxWidth"),EH.prototype),ct(EH.prototype,"lineHeight",[vH],Object.getOwnPropertyDescriptor(EH.prototype,"lineHeight"),EH.prototype),ct(EH.prototype,"imageAtlas",[yH,SH],Object.getOwnPropertyDescriptor(EH.prototype,"imageAtlas"),EH.prototype),ct(EH.prototype,"handleTouchEvent",[TH],Object.getOwnPropertyDescriptor(EH.prototype,"handleTouchEvent"),EH.prototype),AH=ct(EH.prototype,"_lineHeight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),CH=ct(EH.prototype,"_string",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),bH=ct(EH.prototype,"_horizontalAlign",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nk.LEFT}}),wH=ct(EH.prototype,"_verticalAlign",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ik.TOP}}),IH=ct(EH.prototype,"_fontSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),PH=ct(EH.prototype,"_maxWidth",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RH=ct(EH.prototype,"_fontFamily",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),DH=ct(EH.prototype,"_font",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OH=ct(EH.prototype,"_isSystemFontUsed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),NH=ct(EH.prototype,"_userDefinedFont",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MH=ct(EH.prototype,"_cacheMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ak.NONE}}),LH=ct(EH.prototype,"_imageAtlas",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FH=ct(EH.prototype,"_handleTouchEvent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xH=EH))||xH)||xH)||xH)||xH)||xH));l.RichText=JH;var ZH=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(Ec("cc.UIMeshRenderer")(QH=Gc()(QH=Cc(110)(QH=Bc()(QH=Fc(QH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._modelComponent=null,e.stencilStage=oz.DISABLED,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent||console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},n.updateAssembler=function(t){if(this._modelComponent){var e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var n=0;n<e.length;n++)e[n].enabled&&t.commitModel(this,e[n],this._modelComponent.material);return!0}return!1},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var n=this._modelComponent.getMaterialInstance(e);if(null!=n)for(var i=n.passes,r=i.length,a=0;a<r;a++)i[a]._priority=wd.MAX-11,n.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},a)}},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},Q(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(Zu))||QH)||QH)||QH)||QH)||QH);l.UIMeshRenderer=ZH;var $H,tW,eW,nW,iW,rW,aW,oW,sW,cW,lW,uW,hW,fW,_W,dW,pW,mW,gW,vW,yW,SW,TW,xW,EW,AW,CW,bW,wW,IW=Cd.Enum.NONE|Cd.Enum.UI_3D,PW=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=IW,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this.bufferBatch=null,this.inputAssembler=null,this.descriptorSet=null,this.camera=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=IW,this.renderScene=null},e.fillPasses=function(t,e,n,i,r,a){if(t){var o=t.passes;if(!o)return;var s=0;this._shaders.length=o.length;for(var c=0;c<o.length;c++){this._passes[c]||(this._passes[c]=new Rg(l.director.root));var u=o[c],h=this._passes[c];u.update(),e||(e=u.depthStencilState,n=0),i||(i=u.blendState,r=0),-1===r&&(r=0),s=n<<16|r,h._initPassFromTarget(u,e,i,s),this._shaders[c]=h.getShaderVariant(a)}}},Q(t,[{key:"native",get:function(){return this._nativeObj}},{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),RW=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}(($H=Ec("cc.UIStaticBatch"),tW=Gc(),eW=Bc(),nW=Cc(110),iW=Hc(),$H(rW=tW(rW=eW(rW=nW((ct((aW=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}Z(e,t);var n=e.prototype;return n.onLoad=function(){},n.onDestroy=function(){},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new PW;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return lN.root&&lN.root.batcher2D?lN.root.batcher2D:(R(9301),null)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(ok)).prototype,"color",[sl,iW],Object.getOwnPropertyDescriptor(aW.prototype,"color"),aW.prototype),rW=aW))||rW)||rW)||rW)||rW)),DW=t("LabelShadow",(oW=Ec("cc.LabelShadow"),sW=Gc(),cW=Cc(110),lW=Bc(),uW=Ac(uk),hW=Xc(),fW=Xc(),_W=Xc(),oW(dW=sW(dW=cW(dW=lW(dW=uW(dW=Fc((yW=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_color",mW,rt(e)),st(e,"_offset",gW,rt(e)),st(e,"_blur",vW,rt(e)),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(uk);t&&t.updateRenderData(!0)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(Zu),mW=ct((pW=yW).prototype,"_color",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(0,0,0,255)}}),gW=ct(pW.prototype,"_offset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(2,2)}}),vW=ct(pW.prototype,"_blur",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ct(pW.prototype,"color",[hW],Object.getOwnPropertyDescriptor(pW.prototype,"color"),pW.prototype),ct(pW.prototype,"offset",[fW],Object.getOwnPropertyDescriptor(pW.prototype,"offset"),pW.prototype),ct(pW.prototype,"blur",[_W],Object.getOwnPropertyDescriptor(pW.prototype,"blur"),pW.prototype),dW=pW))||dW)||dW)||dW)||dW)||dW)||dW)),OW=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}((SW=Ec("cc.UIOpacity"),TW=Gc(),xW=Cc(110),EW=Bc(),AW=Xc(),SW(CW=TW(CW=xW(CW=EW(CW=Fc(CW=bc((ct((bW=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_opacity",wW,rt(e)),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},n.onDisable=function(){this.node._uiProps.localOpacity=1},Q(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Ee(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}(Zu)).prototype,"opacity",[Vc,AW],Object.getOwnPropertyDescriptor(bW.prototype,"opacity"),bW.prototype),wW=ct(bW.prototype,"_opacity",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),CW=bW))||CW)||CW)||CW)||CW)||CW)||CW));l.MaskComponent=bG,ie.setClassAlias(bG,"cc.MaskComponent"),l.LabelComponent=uk,ie.setClassAlias(uk,"cc.LabelComponent"),l.LabelOutlineComponent=zV,ie.setClassAlias(zV,"cc.LabelOutlineComponent"),l.RichTextComponent=JH,ie.setClassAlias(JH,"cc.RichTextComponent"),l.SpriteComponent=kV,ie.setClassAlias(kV,"cc.SpriteComponent"),l.UIModelComponent=ZH,ie.setClassAlias(ZH,"cc.UIModelComponent"),l.GraphicsComponent=SG,ie.setClassAlias(SG,"cc.GraphicsComponent"),ie.setClassAlias(RW,"cc.UIStaticBatchComponent"),ie.setClassAlias(OW,"cc.UIOpacityComponent");var NW=function(t,e,n){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=n};function MW(t,e,n,i,r){var a=0,o=null;if(r===function(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(a=e;a<n;a+=i)o=ZW(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=ZW(a,t[a],t[a+1],o);return o&&YW(o,o.next)&&($W(o),o=o.next),o}function LW(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var n=t,i=!1;do{if(i=!1,n.steiner||!YW(n,n.next)&&0!==qW(n.prev,n,n.next))n=n.next;else{if($W(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function FW(t,e,n,i,r,a,o){if(void 0===o&&(o=0),t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=HW(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e=0,n=null,i=null,r=null,a=null,o=0,s=0,c=0,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(c=l;s>0||c>0&&i;)0===s?(r=i,i=i.nextZ,c--):0!==c&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--):(r=n,n=n.nextZ,s--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s=t,c=null,l=null;t.prev!==t.next;)if(c=t.prev,l=t.next,a?zW(t,i,r,a):BW(t))e.push(c.i/n),e.push(t.i/n),e.push(l.i/n),$W(t),t=l.next,s=l.next;else if((t=l)===s){o?1===o?FW(t=UW(t,e,n),e,n,i,r,a,2):2===o&&kW(t,e,n,i,r,a):FW(LW(t),e,n,i,r,a,1);break}}}function BW(t){var e=t.prev,n=t,i=t.next;if(qW(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(jW(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&qW(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function zW(t,e,n,i){var r=t.prev,a=t,o=t.next;if(qW(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,c=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=HW(s,c,e,n,i),f=HW(l,u,e,n,i),_=t.nextZ;_&&_.z<=f;){if(_!==t.prev&&_!==t.next&&jW(r.x,r.y,a.x,a.y,o.x,o.y,_.x,_.y)&&qW(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(_=t.prevZ;_&&_.z>=h;){if(_!==t.prev&&_!==t.next&&jW(r.x,r.y,a.x,a.y,o.x,o.y,_.x,_.y)&&qW(_.prev,_,_.next)>=0)return!1;_=_.prevZ}return!0}function UW(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!YW(r,a)&&KW(r,i,i.next,a)&&QW(r,a)&&QW(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),$W(i),$W(i.next),i=t=a),i=i.next}while(i!==t);return i}function kW(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&XW(o,s)){var c=JW(o,s);return o=LW(o,o.next),c=LW(c,c.next),FW(o,e,n,i,r,a),void FW(c,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function GW(t,e){return t.x-e.x}function VW(t,e){if(e=function(t,e){var n=e,i=t.x,r=t.y,a=-1/0,o=null;do{if(r<=n.y&&r>=n.next.y){var s=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===a)return o.prev;var c,l=o,u=o.x,h=o.y,f=1/0;for(n=o.next;n!==l;)i>=n.x&&n.x>=u&&jW(r<h?i:a,r,u,h,r<h?a:i,r,n.x,n.y)&&((c=Math.abs(r-n.y)/(i-n.x))<f||c===f&&n.x>o.x)&&QW(n,t)&&(o=n,f=c),n=n.next;return o}(t,e)){var n=JW(e,t);LW(n,n.next)}}function HW(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function WW(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function jW(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function XW(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&KW(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&QW(t,e)&&QW(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function qW(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function YW(t,e){return t.x===e.x&&t.y===e.y}function KW(t,e,n,i){return!!(YW(t,e)&&YW(n,i)||YW(t,i)&&YW(n,e))||qW(t,e,n)>0!=qW(t,e,i)>0&&qW(n,i,t)>0!=qW(n,i,e)>0}function QW(t,e){return qW(t.prev,t,t.next)<0?qW(t,e,t.next)>=0&&qW(t,t.prev,e)>=0:qW(t,e,t.prev)<0||qW(t,t.next,e)<0}function JW(t,e){var n=new NW(t.i,t.x,t.y),i=new NW(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function ZW(t,e,n,i){var r=new NW(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function $W(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tj(t,e,n){n=n||3;var i=e?e.length:0,r=i?e[0]*n:t.length,a=MW(t,0,r,n,!0),o=[];if(!a)return o;var s=0,c=0,l=0,u=0,h=0,f=0,_=0;if(i&&(a=function(t,e,n,i){var r,a=[],o=0,s=null;for(o=0,r=e.length;o<r;o++)(s=MW(t,e[o]*i,o<r-1?e[o+1]*i:t.length,i,!1))&&(s===s.next&&(s.steiner=!0),a.push(WW(s)));if(a.sort(GW),!n)return n;for(o=0;o<a.length;o++)VW(a[o],n),n=LW(n,n.next);return n}(t,e,a,n)),t.length>80*n){s=l=t[0],c=u=t[1];for(var d=n;d<r;d+=n)(h=t[d])<s&&(s=h),(f=t[d+1])<c&&(c=f),h>l&&(l=h),f>u&&(u=f);_=Math.max(l-s,u-c)}return FW(a,o,n,s,c,_),o}for(var ej=Math.PI,nj=Math.min,ij=Math.max,rj=Math.ceil,aj=Math.acos,oj=Math.cos,sj=Math.sin,cj=Math.atan2,lj=null,uj=null,hj=new Pn,fj=[],_j=0;_j<4;_j++)fj.push(new Dn);function dj(t,e,n){return t<e?e:t>n?n:t}var pj={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!uj)return null;var n=uj.getRenderDataList(),i=n[uj.dataOffset];if(!i)return null;var r=i,a=r?r.vertexStart+e:0;return(a>65535||3*a>131070)&&(++uj.dataOffset,uj.dataOffset<n.length?i=n[uj.dataOffset]:(i=uj.requestRenderData(),n[uj.dataOffset]=i),r=i),r&&r.vertexCount<a&&r.request(e,3*e),i},stroke:function(t){Pn.copy(hj,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){Pn.copy(hj,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e,n,i,r,a=.5*t.lineWidth,o=t.lineCap,s=t.lineJoin,c=t.miterLimit;if(uj=t.impl){var l=(e=a,n=ej,i=uj.tessTol,r=2*aj(e/(e+i)),ij(2,rj(n/r)));this._calculateJoins(uj,a,s,c);for(var u=uj.paths,h=0,f=uj.pathOffset,_=uj.pathLength;f<_;f++){var d=u[f],p=d.points.length;s===ck.ROUND?h+=2*(p+d.bevel*(l+2)+1):h+=2*(p+5*d.bevel+1),d.closed||(o===sk.ROUND?h+=2*(2*l+2):h+=12)}var m=lj=this.getRenderData(t,h);if(m){for(var g=m.vData,v=m.iData,y=uj.pathOffset,S=uj.pathLength;y<S;y++){var T=u[y],x=T.points,E=x.length,A=m.vertexStart,C=void 0,b=void 0,w=0,I=0,P=T.closed;if(P?(C=x[E-1],b=x[0],w=0,I=E):(C=x[0],b=x[1],w=1,I=E-1),b=b||C,!P){var R=new dG(b.x,b.y);R.subtract(C),R.normalize();var D=R.x,O=R.y;o===sk.BUTT?this._buttCapStart(C,D,O,a,0):o===sk.SQUARE?this._buttCapStart(C,D,O,a,a):o===sk.ROUND&&this._roundCapStart(C,D,O,a,l)}for(var N=w;N<I;++N)s===ck.ROUND?this._roundJoin(C,b,a,a,l):0!=(b.flags&(lk.PT_BEVEL|lk.PT_INNERBEVEL))?this._bevelJoin(C,b,a,a):(this._vSet(b.x+b.dmx*a,b.y+b.dmy*a,1),this._vSet(b.x-b.dmx*a,b.y-b.dmy*a,-1)),C=b,b=x[N+1];if(P){var M=8*A;this._vSet(g[M],g[M+1],1),this._vSet(g[M+8],g[M+8+1],-1)}else{var L=new dG(b.x,b.y);L.subtract(C),L.normalize();var F=L.x,B=L.y;o===sk.BUTT?this._buttCapEnd(b,F,B,a,0):o===sk.SQUARE?this._buttCapEnd(b,F,B,a,a):o===sk.ROUND&&this._roundCapEnd(b,F,B,a,l)}for(var z=m.indexStart,U=A+2,k=m.vertexStart;U<k;U++)v[z++]=U-2,v[z++]=U-1,v[z++]=U;m.indexStart=z}lj=null,uj=null}}},_expandFill:function(t){if(uj=t.impl){for(var e=uj.paths,n=0,i=uj.pathOffset,r=uj.pathLength;i<r;i++)n+=e[i].points.length;var a=lj=this.getRenderData(t,n);if(a){for(var o=a,s=o.vData,c=o.iData,l=uj.pathOffset,u=uj.pathLength;l<u;l++){var h=e[l],f=h.points,_=f.length;if(0!==_){for(var d=a.vertexStart,p=0;p<_;++p)this._vSet(f[p].x,f[p].y);var m=a.indexStart;if(h.complex){for(var g=[],v=d,y=a.vertexStart;v<y;v++){var S=8*v;g.push(s[S++]),g.push(s[S++]),g.push(s[S++])}var T=tj(g,null,3);if(!T||0===T.length)continue;for(var x=0,E=T.length;x<E;x++)c[m++]=T[x]+d}else for(var A=d,C=d+2,b=o.vertexStart;C<b;C++)c[m++]=A,c[m++]=C-1,c[m++]=C;o.indexStart=m}}lj=null,uj=null}}},_calculateJoins:function(t,e,n,i){var r=0;e>0&&(r=1/e);for(var a=t.paths,o=t.pathOffset,s=t.pathLength;o<s;o++){var c=a[o],l=c.points,u=l.length,h=l[u-1],f=l[0];c.bevel=0;for(var _=0;_<u;_++){var d,p,m=h.dy,g=-h.dx,v=f.dy,y=-f.dx;if(f.dmx=.5*(m+v),f.dmy=.5*(g+y),(d=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var S=1/d;S>600&&(S=600),f.dmx*=S,f.dmy*=S}f.dx*h.dy-h.dx*f.dy>0&&(f.flags|=lk.PT_LEFT),d*(p=ij(11,nj(h.len,f.len)*r))*p<1&&(f.flags|=lk.PT_INNERBEVEL),f.flags&lk.PT_CORNER&&(d*i*i<1||n===ck.BEVEL||n===ck.ROUND)&&(f.flags|=lk.PT_BEVEL),0!=(f.flags&(lk.PT_BEVEL|lk.PT_INNERBEVEL))&&c.bevel++,h=f,f=l[_+1]}}},_flattenPaths:function(t){for(var e=t.paths,n=t.pathOffset,i=t.pathLength;n<i;n++){var r=e[n],a=r.points,o=a[a.length-1],s=a[0];a.length>2&&o.equals(s)&&(r.closed=!0,a.pop(),o=a[a.length-1]);for(var c=0,l=a.length;c<l;c++){var u=new dG(s.x,s.y);u.subtract(o),o.len=u.length(),(u.x||u.y)&&u.normalize(),o.dx=u.x,o.dy=u.y,o=s,s=a[c+1]}}},_chooseBevel:function(t,e,n,i){var r=n.x,a=n.y,o=0,s=0,c=0,l=0;return 0!==t?(o=r+e.dy*i,s=a-e.dx*i,c=r+n.dy*i,l=a-n.dx*i):(o=c=r+n.dmx*i,s=l=a+n.dmy*i),[o,s,c,l]},_buttCapStart:function(t,e,n,i,r){var a=t.x-e*r,o=t.y-n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_buttCapEnd:function(t,e,n,i,r){var a=t.x+e*r,o=t.y+n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapStart:function(t,e,n,i,r){for(var a=t.x,o=t.y,s=n,c=-e,l=0;l<r;l++){var u=l/(r-1)*ej,h=oj(u)*i,f=sj(u)*i;this._vSet(a-s*h-e*f,o-c*h-n*f,1),this._vSet(a,o,0)}this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapEnd:function(t,e,n,i,r){var a=t.x,o=t.y,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1);for(var l=0;l<r;l++){var u=l/(r-1)*ej,h=oj(u)*i,f=sj(u)*i;this._vSet(a,o,0),this._vSet(a-s*h+e*f,o-c*h+n*f,1)}},_roundJoin:function(t,e,n,i,r){var a=t.dy,o=-t.dx,s=e.dy,c=-e.dx,l=e.x,u=e.y;if(0!=(e.flags&lk.PT_LEFT)){var h=this._chooseBevel(e.flags&lk.PT_INNERBEVEL,t,e,n),f=h[0],_=h[1],d=h[2],p=h[3],m=cj(-o,-a),g=cj(-c,-s);g>m&&(g-=2*ej),this._vSet(f,_,1),this._vSet(l-a*i,e.y-o*i,-1);for(var v=dj(rj((m-g)/ej)*r,2,r),y=0;y<v;y++){var S=m+y/(v-1)*(g-m),T=l+oj(S)*i,x=u+sj(S)*i;this._vSet(l,u,0),this._vSet(T,x,-1)}this._vSet(d,p,1),this._vSet(l-s*i,u-c*i,-1)}else{var E=this._chooseBevel(e.flags&lk.PT_INNERBEVEL,t,e,-i),A=E[0],C=E[1],b=E[2],w=E[3],I=cj(o,a),P=cj(c,s);P<I&&(P+=2*ej),this._vSet(l+a*i,u+o*i,1),this._vSet(A,C,-1);for(var R=dj(rj((P-I)/ej)*r,2,r),D=0;D<R;D++){var O=I+D/(R-1)*(P-I),N=l+oj(O)*n,M=u+sj(O)*n;this._vSet(N,M,1),this._vSet(l,u,0)}this._vSet(l+s*i,u+c*i,1),this._vSet(b,w,-1)}},_bevelJoin:function(t,e,n,i){var r=0,a=0,o=0,s=0,c=0,l=0,u=0,h=0,f=t.dy,_=-t.dx,d=e.dy,p=-e.dx;if(e.flags&lk.PT_LEFT){var m=this._chooseBevel(e.flags&lk.PT_INNERBEVEL,t,e,n);c=m[0],l=m[1],u=m[2],h=m[3],this._vSet(c,l,1),this._vSet(e.x-f*i,e.y-_*i,-1),this._vSet(u,h,1),this._vSet(e.x-d*i,e.y-p*i,-1)}else{var g=this._chooseBevel(e.flags&lk.PT_INNERBEVEL,t,e,-i);r=g[0],a=g[1],o=g[2],s=g[3],this._vSet(e.x+f*n,e.y+_*n,1),this._vSet(r,a,-1),this._vSet(e.x+d*n,e.y+p*n,1),this._vSet(o,s,-1)}},_vSet:function(t,e,n){if(void 0===n&&(n=0),lj){var i=lj,r=8*i.vertexStart,a=i.vData;a[r++]=t,a[r++]=e,a[r++]=0,Pn.toArray(a,hj,r),r+=4,a[r++]=n,i.vertexStart++}}},mj=t("graphicsAssembler",{getAssembler:function(){return pj}});SG.Assembler=mj;var gj=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},vj=new ai,yj=null,Sj=null,Tj=[],xj=[],Ej=[],Aj=[],Cj=new ii,bj=new ii,wj=new Qn,Ij=null,Pj=0,Rj=0,Dj=0,Oj=0,Nj=0,Mj=1,Lj=null,Fj="",Bj=0,zj=0,Uj=0,kj=0,Gj=0,Vj=0,Hj=0,Wj=!1,jj=0,Xj=0,qj=0,Yj={updateRenderData:function(t){t.renderData&&yj!==t&&(t.renderData.vertDirty&&(Sj=(yj=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),yj.actualFontSize=Bj,Sj.setContentSize(bj),this.updateUVs(t),yj.renderData.vertDirty=!1,yj.markForUpdateRenderData(!1),yj=null,this._resetProperties()),t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame))},updateUVs:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.vertexCount,r=e.data,a=3,o=0;o<i;o++){var s=r[o];n[a]=s.u,n[a+1]=s.v,a+=9}},_updateFontScale:function(){Mj=Bj/zj},_updateFontFamily:function(t){var e=t.font;Lj=e.spriteFrame,Ij=e.fntConfig,UB.fontAtlas=e.fontDefDictionary,kF.packToDynamicAtlas(t,Lj)},_updateLabelInfo:function(){UB.hash="",UB.margin=0},_updateProperties:function(t){Fj=t.string.toString(),Bj=t.fontSize,zj=Ij?Ij.fontSize:t.fontSize,Uj=t.horizontalAlign,kj=t.verticalAlign,Gj=t.spacingX,Hj=t.overflow,Vj=t._lineHeight;var e=Sj.contentSize;bj.width=e.width,bj.height=e.height,Hj===rk.NONE?(Wj=!1,bj.width+=2*UB.margin,bj.height+=2*UB.margin):Hj===rk.RESIZE_HEIGHT?(Wj=!0,bj.height+=2*UB.margin):Wj=t.enableWrapText,UB.lineHeight=Vj,UB.fontSize=Bj,this._setupBMFontOverflowMetrics()},_resetProperties:function(){Ij=null,Lj=null,UB.hash="",UB.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=Fj,e=t.length,n=Ij.kerningDict,i=Tj,r=-1,a=0;a<e;++a){var o=t.charCodeAt(a),s=n[r<<16|65535&o]||0;i[a]=a<e-1?s:0,r=o}},_multilineTextWrap:function(t){for(var e=Fj.length,n=0,i=0,r=0,a=0,o=0,s=0,c=0,l=null,u=0;u<e;){var h=Fj.charAt(u);if("\n"!==h){for(var f=t(Fj,u,e),_=s,d=c,p=o,m=i,g=!1,v=0;v<f;++v){var y=u+v;if("\r"!==(h=Fj.charAt(y)))if(l=UB.fontAtlas.getLetterDefinitionForChar(h,UB)){var S=m+l.offsetX*Mj-UB.margin;if(Wj&&qj>0&&i>0&&S+l.w*Mj>qj&&!bB(h)){Ej.push(o),o=0,n++,i=0,r-=Vj*this._getFontScale()+0,g=!0;break}wj.x=S,wj.y=r-l.offsetY*Mj,this._recordLetterInfo(wj,h,y,n),y+1<Tj.length&&y<e-1&&(m+=Tj[y+1]),m+=l.xAdvance*Mj+Gj,p=wj.x+l.w*Mj,_<wj.y&&(_=wj.y),d>wj.y-l.h*Mj&&(d=wj.y-l.h*Mj)}else this._recordPlaceholderInfo(y,h),console.log("Can't find letter definition in texture atlas "+Ij.atlasName+" for letter:"+h);else this._recordPlaceholderInfo(y,h)}g||(i=m,s<_&&(s=_),c>d&&(c=d),a<(o=p)&&(a=o),u+=f)}else Ej.push(o),o=0,n++,i=0,r-=Vj*this._getFontScale()+0,this._recordPlaceholderInfo(u,h),u++}return Ej.push(o),Rj=(Pj=n+1)*Vj*this._getFontScale(),Pj>1&&(Rj+=0*(Pj-1)),bj.width=jj,bj.height=Xj,jj<=0&&(bj.width=parseFloat(a.toFixed(2))+2*UB.margin),Xj<=0&&(bj.height=parseFloat(Rj.toFixed(2))+2*UB.margin),Oj=bj.height,Nj=0,s>0&&(Oj=bj.height+s),c<-Rj&&(Nj=Rj+c),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return Hj===rk.SHRINK?Mj:1},_getFirstWordLen:function(t,e,n){var i=t.charAt(e);if(CB(i)||"\n"===i||bB(i))return 1;var r=1,a=UB.fontAtlas.getLetterDefinitionForChar(i,UB);if(!a)return r;for(var o=a.xAdvance*Mj+Gj,s=e+1;s<n&&(i=t.charAt(s),a=UB.fontAtlas.getLetterDefinitionForChar(i,UB));++s){if(o+a.offsetX*Mj+a.w*Mj>qj&&!bB(i)&&qj>0)return r;if(o+=a.xAdvance*Mj+Gj,"\n"===i||bB(i)||CB(i))break;r++}return r},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=xj.length){var n=new gj;xj.push(n)}xj[t].char=e,xj[t].hash=""+e.charCodeAt(0)+UB.hash,xj[t].valid=!1},_recordLetterInfo:function(t,e,n,i){if(n>=xj.length){var r=new gj;xj.push(r)}var a=""+e.charCodeAt(0)+UB.hash;xj[n].line=i,xj[n].char=e,xj[n].hash=a,xj[n].valid=UB.fontAtlas.getLetter(a).valid,xj[n].x=t.x,xj[n].y=t.y},_alignText:function(){Rj=0,Ej.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),Hj===rk.SHRINK&&Bj>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||Hj===rk.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),Bj=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,n=0|Bj,i=0;e<n;){var r=i=e+n+1>>1;if(r<=0)break;Mj=r/zj,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?n=i-1:e=i}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return Rj>bj.height},_isHorizontalClamp:function(){for(var t=!1,e=0,n=Fj.length;e<n;++e){var i=xj[e];if(i.valid){var r=UB.fontAtlas.getLetterDefinitionForChar(i.char,UB);if(!r)continue;var a=i.x+r.w*Mj,o=i.line;if(jj>0)if(Wj){if(Ej[o]>bj.width&&(a>bj.width||a<0)){t=!0;break}}else if(a>bj.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var n=Ej[e],i=t>bj.width||t<0;return Wj?n>bj.width&&i:i},_updateQuads:function(){if(!yj)return!1;var t=Lj?Lj.texture:UB.fontAtlas.getTexture(),e=yj.renderData;e.dataLength=0,e.resize(0,0);for(var n=Sj.anchorPoint,i=bj,r=n.x*i.width,a=n.y*i.height,o=!0,s=0,c=Fj.length;s<c;++s){var l=xj[s];if(l.valid){var u=UB.fontAtlas.getLetter(l.hash);if(u){vj.height=u.h,vj.width=u.w,vj.x=u.u,vj.y=u.v;var h=l.y+Dj;if(Xj>0){if(h>Oj){var f=h-Oj;vj.y+=f,vj.height-=f,h-=f}h-u.h*Mj<Nj&&Hj===rk.CLAMP&&(vj.height=h<Nj?0:(h-Nj)/Mj)}var _=l.line,d=l.x+u.w/2*Mj+Aj[_];if(jj>0&&this._isHorizontalClamped(d,_))if(Hj===rk.CLAMP)vj.width=0;else if(Hj===rk.SHRINK){if(bj.width>u.w){o=!1;break}vj.width=0}if(vj.height>0&&vj.width>0){var p=this._determineRect(),m=l.x+Aj[l.line];this.appendQuad(yj,t,vj,p,m-r,h-a,Mj)}}else console.warn("Can't find letter in this bitmap-font")}}return o},appendQuad:function(){},_determineRect:function(){var t=Lj.isRotated(),e=Lj.getOriginalSize(),n=Lj.getRect(),i=Lj.getOffset(),r=i.x+(e.width-n.width)/2,a=i.y-(e.height-n.height)/2;if(t){var o=vj.x;vj.x=n.x+n.height-vj.y-vj.height-a,vj.y=o+n.y-r,vj.y<0&&(vj.height+=a)}else vj.x+=n.x-r,vj.y+=n.y+a;return t},_computeAlignmentOffset:function(){switch(Aj.length=0,Uj){case nk.LEFT:for(var t=0;t<Pj;++t)Aj.push(0);break;case nk.CENTER:for(var e=0,n=Ej.length;e<n;e++)Aj.push((bj.width-Ej[e])/2);break;case nk.RIGHT:for(var i=0,r=Ej.length;i<r;i++)Aj.push(bj.width-Ej[i])}if(Dj=bj.height,kj!==ik.TOP){var a=bj.height-Rj+Vj*this._getFontScale()-zj*Mj;kj===ik.BOTTOM?Dj-=a:Dj-=a/2}},_setupBMFontOverflowMetrics:function(){var t=bj.width,e=bj.height;Hj===rk.RESIZE_HEIGHT&&(e=0),Hj===rk.NONE&&(t=0,e=0),jj=t,Xj=e,Cj.width=t,Cj.height=e,qj=t}},Kj=new Pn(255,255,255,255),Qj={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){var e=t.node;Kj.set(t.color),Kj.a=255*e._uiProps.opacity,OF(e,0,t.renderData,Kj)},appendQuad:function(t,e,n,i,r,a,o){var s=t.renderData;if(s){var c=s.dataLength;s.dataLength+=4,s.resize(s.dataLength,s.dataLength/2*3);var l=s.data,u=e.width,h=e.height,f=n.width,_=n.height,d=0,p=0,m=0,g=0;i?(d=n.x/u,g=(n.x+_)/u,p=(n.y+f)/h,m=n.y/h,l[c].u=d,l[c].v=m,l[c+1].u=d,l[c+1].v=p,l[c+2].u=g,l[c+2].v=m,l[c+3].u=g,l[c+3].v=p):(d=n.x/u,g=(n.x+f)/u,p=(n.y+_)/h,m=n.y/h,l[c].u=d,l[c].v=p,l[c+1].u=g,l[c+1].v=p,l[c+2].u=d,l[c+2].v=m,l[c+3].u=g,l[c+3].v=m),l[c].x=r,l[c].y=a-_*o,l[c+1].x=r+f*o,l[c+1].y=a-_*o,l[c+2].x=r,l[c+2].y=a,l[c+3].x=r+f*o,l[c+3].y=a}},updateColor:function(){}};zt(Qj,Yj);var Jj=null,Zj=Ut(Yj,{getAssemblerData:function(){return Jj||(Jj=new zB(1024,1024)),Jj.getTexture()},_updateFontFamily:function(t){UB.fontAtlas=Jj,UB.fontFamily=this._getFontFamily(t);var e=t.getComponent(zV);e&&e.enabled?(UB.isOutlined=!0,UB.margin=e.width,UB.out=e.color.clone(),UB.out.a=e.color.a*t.color.a/255):(UB.isOutlined=!1,UB.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){UB.fontDesc=this._getFontDesc(),UB.color=t.color,UB.hash=function(t){var e=t.color.toHEX(),n="";return t.isOutlined&&t.margin>0&&(n=n+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+n}(UB)},_getFontDesc:function(){return UB.fontSize.toString()+"px "+UB.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),$j=new Pn(255,255,255,255),tX={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){if(t.renderData){var e=t.node;$j.a=255*e._uiProps.opacity,OF(e,0,t.renderData,$j)}},updateColor:function(){},appendQuad:Qj.appendQuad};zt(tX,Zj);var eX=uk.Overflow,nX=(1/255).toFixed(3),iX=null,rX=null,aX=null,oX="",sX="",cX=0,lX=0,uX=[],hX=new ii,fX=0,_X=0,dX=0,pX=new Pn,mX="",gX=eX.NONE,vX=!1,yX=null,SX=Pn.BLACK.clone(),TX=null,xX=Pn.BLACK.clone(),EX=new ai,AX=ii.ZERO.clone(),CX=ii.ZERO.clone(),bX=Qn.ZERO.clone(),wX=Qn.ZERO.clone(),IX=0,PX=0,RX=!1,DX=!1,OX=!1,NX=["left","center","right"],MX={getAssemblerData:function(){return uk._canvasPool.get()},resetAssemblerData:function(t){t&&uk._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData){if(t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this._calDynamicAtlas(t),t.actualFontSize=cX,e.setContentSize(hX),this.updateVertexData(t),this.updateUVs(t),t.markForUpdateRenderData(!1),iX=null,rX=null,aX=null}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},updateVertexData:function(){},updateUVs:function(){},_updateFontFamily:function(t){mX=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var n=t.assemblerData;n&&(iX=n.context,rX=n.canvas,aX=t.spriteFrame,sX=t.string.toString(),cX=t.fontSize,lX=cX,gX=t.overflow,CX.width=hX.width=e.width,CX.height=hX.height=e.height,PX=t.underlineHeight,fX=t.lineHeight,_X=t.horizontalAlign,dX=t.verticalAlign,pX=t.color,t.node._uiProps.opacity,RX=t.isBold,DX=t.isItalic,OX=t.isUnderline,vX=gX!==eX.NONE&&(gX===eX.RESIZE_HEIGHT||t.enableWrapText),(yX=(yX=zV&&t.getComponent(zV))&&yX.enabled&&yX.width>0?yX:null)&&SX.set(yX.color),(TX=(TX=DW&&t.getComponent(DW))&&TX.enabled?TX:null)&&xX.set(TX.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,n=0,i=0,r=0;if(AX.width=AX.height=0,yX&&(t=e=n=i=r=yX.width,AX.width=AX.height=2*r),TX){var a=TX.blur+r,o=TX.offset.x,s=TX.offset.y;n=Math.max(n,-o+a),i=Math.max(i,o+a),t=Math.max(t,s+a),e=Math.max(e,-s+a)}if(DX){var c=lX*Math.tan(.20943951);i+=c,AX.width+=c}EX.x=n,EX.y=t,EX.width=n+i,EX.height=t+e},_calculateFillTextStartPosition:function(){var t=0;_X===nk.RIGHT?t=hX.width-EX.width:_X===nk.CENTER&&(t=(hX.width-EX.width)/2);var e=this._getLineHeight()*(uX.length-1),n=cX*(1-pB/2);if(dX!==ik.TOP){var i=e+EX.height+cX-hX.height;dX===ik.BOTTOM?n-=i+=pB/2*cX:n-=i/2}n+=0*cX,bX.set(t+EX.x,n+EX.y)},_updateTexture:function(t){if(iX&&rX){iX.clearRect(0,0,rX.width,rX.height),iX.font=oX,this._calculateFillTextStartPosition();var e=this._getLineHeight();iX.lineJoin="round",yX?(iX.fillStyle="rgba("+SX.r+", "+SX.g+", "+SX.b+", "+nX+")",iX.fillRect(0,0,rX.width,rX.height)):t._srcBlendFactor===Oi.SRC_ALPHA&&(iX.fillStyle="rgba("+pX.r+", "+pX.g+", "+pX.b+", "+nX+")",iX.fillRect(0,0,rX.width,rX.height)),iX.fillStyle="rgb("+pX.r+", "+pX.g+", "+pX.b+")";var n=bX.x,i=0;this._drawTextEffect(bX,e);for(var r=0;r<uX.length;++r)i=bX.y+r*e,yX&&iX.strokeText(uX[r],n,i),iX.fillText(uX[r],n,i);TX&&(iX.shadowColor="transparent"),this._uploadTexture(t)}},_uploadTexture:function(t){if(t.cacheMode===uk.CacheMode.BITMAP){var e=t.ttfSpriteFrame;kF.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}var n;aX&&rX&&(n=aX instanceof XF?aX.texture:aX,0!==rX.width&&0!==rX.height&&(n.reset({width:rX.width,height:rX.height,mipmapLevel:1}),n.uploadData(rX),n.setWrapMode(Em.CLAMP_TO_EDGE,Em.CLAMP_TO_EDGE),aX instanceof XF&&(aX.rect=new ai(0,0,rX.width,rX.height),aX._calculateUV()),t.renderData&&(t.renderData.textureDirty=!0),l.director.root&&l.director.root.batcher2D&&l.director.root.batcher2D._releaseDescriptorSetCache(n.getHash())))},_calDynamicAtlas:function(t){if(!(t.cacheMode!==uk.CacheMode.BITMAP||!rX||rX.width<=0||rX.height<=0)){var e=t.ttfSpriteFrame;kF.packToDynamicAtlas(t,e)}},_setupOutline:function(){iX.strokeStyle="rgba("+SX.r+", "+SX.g+", "+SX.b+", "+SX.a/255+")",iX.lineWidth=2*yX.width},_setupShadow:function(){iX.shadowColor="rgba("+xX.r+", "+xX.g+", "+xX.b+", "+xX.a/255+")",iX.shadowBlur=TX.blur,iX.shadowOffsetX=TX.offset.x,iX.shadowOffsetY=-TX.offset.y},_drawTextEffect:function(t,e){if(TX||yX||OX){var n=uX.length>1&&TX,i=this._measureText(iX,oX),r=0,a=0;TX&&this._setupShadow(),yX&&this._setupOutline();for(var o=0;o<uX.length;++o)r=t.x,a=t.y+o*e,n&&(yX&&iX.strokeText(uX[o],r,a),iX.fillText(uX[o],r,a)),OX&&(IX=i(uX[o]),_X===nk.RIGHT?wX.x=t.x-IX:_X===nk.CENTER?wX.x=t.x-IX/2:wX.x=t.x,wX.y=a+lX/8,iX.fillRect(wX.x,wX.y,IX,PX));n&&(iX.shadowColor="transparent")}},_updateLabelDimensions:function(){hX.width=Math.min(hX.width,2048),hX.height=Math.min(hX.height,2048);var t=!1;rX.width!==hX.width&&(rX.width=hX.width,t=!0),rX.height!==hX.height&&(rX.height=hX.height,t=!0),t&&(iX.font=oX),iX.textAlign=NX[_X],iX.textBaseline="alphabetic"},_getFontDesc:function(){var t=cX.toString()+"px ";return t+=mX,RX&&(t="bold "+t),DX&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===fX?cX:fX*cX/lX)},_calculateParagraphLength:function(t,e){for(var n,i=[],r=ot(t);!(n=r()).done;){var a=wB(e,n.value,oX);i.push(a)}return i},_measureText:function(t,e){return function(n){return wB(t,n,e)}},_calculateShrinkFont:function(t){if(iX){var e=this._calculateParagraphLength(t,iX),n=0,i=0,r=0;if(vX){var a=CX.width,o=CX.height;if(a<0||o<0)return;i=o+1;for(var s=0,c=0|cX+1,l=0;s<c;){if((l=s+c+1>>1)<=0){I(4003);break}cX=l,oX=this._getFontDesc(),iX.font=oX;var u=this._getLineHeight();for(i=0,n=0;n<t.length;++n){var h=wB(iX,t[n],oX);i+=DB(t[n],h,a,this._measureText(iX,oX)).length*u}i>o?c=l-1:s=l}0===s?I(4003):(cX=s,oX=this._getFontDesc(),iX.font=oX)}else{for(i=t.length*this._getLineHeight(),n=0;n<t.length;++n)r<e[n]&&(r=e[n]);var f=(hX.width-EX.width)/r,_=hX.height/i;cX=lX*Math.min(1,f,_)|0,oX=this._getFontDesc(),iX.font=oX}}},_calculateWrapText:function(t){if(vX&&iX){uX=[];for(var e=CX.width,n=0;n<t.length;++n){var i=wB(iX,t[n],oX),r=DB(t[n],i,e,this._measureText(iX,oX));uX=uX.concat(r)}}},_calculateLabelFont:function(){if(iX){var t=sX.split("\n");switch(uX=t,oX=this._getFontDesc(),iX.font=oX,gX){case eX.NONE:for(var e=0,n=0,i=0;i<t.length;++i){var r=wB(iX,t[i],oX);e=e>r?e:r}n=(uX.length+pB)*this._getLineHeight();var a=parseFloat(e.toFixed(2)),o=parseFloat(n.toFixed(2));hX.width=a+EX.width,hX.height=o+EX.height,CX.width=a+AX.width,CX.height=o+AX.height;break;case eX.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case eX.CLAMP:this._calculateWrapText(t);break;case eX.RESIZE_HEIGHT:this._calculateWrapText(t);var s=(uX.length+pB)*this._getLineHeight();hX.height=s+EX.height,CX.height=s+AX.height}}}},LX=Pn.WHITE.clone(),FX={createData:function(t){var e=t.requestRenderData();e.dataLength=2,e.resize(4,6);var n=e.chunk.vb;n[3]=n[21]=n[22]=n[31]=0,n[4]=n[12]=n[13]=n[30]=1;for(var i=5,r=0;r<4;r++)Pn.toArray(n,LX,i),i+=9;return e},fillBuffers:function(t){var e=t.renderData.chunk,n=t.renderData.data,i=t.node,r=e.vb,a=n[0],o=n[1];i.updateWorldTransform();var s=i._pos,c=i._rot,l=i._scale,u=a.x*l.x,h=o.x*l.x,f=a.y*l.y,_=o.y*l.y,d=c.x,p=c.y,m=c.z,g=c.w,v=d*p,y=m*g,S=d*d-p*p,T=g*g-m*m,x=T+S,E=2*(v-y),A=T-S,C=2*(v+y),b=s.x,w=s.y;r[0]=x*u+E*f+b,r[1]=A*f+C*u+w,r[9]=x*h+E*f+b,r[10]=A*f+C*h+w,r[18]=x*u+E*_+b,r[19]=A*_+C*u+w,r[27]=x*h+E*_+b,r[28]=A*_+C*h+w;var I=e.bufferId,P=e.vertexOffset,R=e.vertexAccessor.getMeshBuffer(e.bufferId),D=e.vertexAccessor.getIndexBuffer(I),O=R.indexOffset;D[O++]=P,D[O++]=P+1,D[O++]=P+2,D[O++]=P+2,D[O++]=P+1,D[O++]=P+3,R.indexOffset+=6},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=e.data;s[0].x=-a,s[0].y=-o,s[1].x=i-a,s[1].y=r-o}},updateUVs:function(t){var e=t.renderData;if(e&&t.ttfSpriteFrame){var n=e.chunk.vb,i=t.ttfSpriteFrame.uv;n[3]=i[0],n[4]=i[1],n[12]=i[2],n[13]=i[3],n[21]=i[4],n[22]=i[5],n[30]=i[6],n[31]=i[7]}},updateColor:function(){}};zt(FX,MX);var BX=t("labelAssembler",{getAssembler:function(t){var e=FX;return t.font instanceof _B?e=Qj:t.cacheMode===uk.CacheMode.CHAR&&(e=tX),e}});uk.Assembler=BX;var zX=kV.FillType,UX=new Xn,kX=new Dn,GX={updateRenderData:function(t){var e=t.spriteFrame;kF.packToDynamicAtlas(t,e);var n=t.renderData;if(n&&e){if(n.updateRenderData(t,e),!n.vertDirty)return;var i=t.fillStart,r=t.fillRange;r<0&&(i+=r,r=-r),r=(r=(r=i+r)>1?1:r)<0?0:r;var a=(i=(i=i>1?1:i)<0?0:i)+(r=(r-=i)<0?0:r);a=a>1?1:a,this.updateUVs(t,i,a),this.updateVertexData(t,i,a)}},updateUVs:function(t,e,n){var i=t.spriteFrame,r=t.renderData.chunk.vb,a=i.width,o=i.height,s=i.rect,c=0,l=0,u=0,h=0,f=0,_=0,d=0,p=0,m=0,g=0;switch(i.isRotated()?(c=s.x/a,l=(s.y+s.width)/o,u=f=c,d=m=(s.x+s.height)/a,_=g=l,h=p=s.y/o):(c=s.x/a,l=(s.y+s.height)/o,u=d=c,f=m=(s.x+s.width)/a,h=_=l,p=g=s.y/o),t.fillType){case zX.HORIZONTAL:r[3]=u+(f-u)*e,r[4]=h+(_-h)*e,r[12]=u+(f-u)*n,r[13]=h+(_-h)*n,r[21]=d+(m-d)*e,r[22]=p+(g-p)*e,r[30]=d+(m-d)*n,r[31]=p+(g-p)*n;break;case zX.VERTICAL:r[3]=u+(d-u)*e,r[4]=h+(p-h)*e,r[12]=f+(m-f)*e,r[13]=_+(g-_)*e,r[21]=u+(d-u)*n,r[22]=h+(p-h)*n,r[30]=f+(m-f)*n,r[31]=_+(g-_)*n;break;default:O(2626)}},updateVertexData:function(t,e,n){var i=t.renderData.data,r=t.node._uiProps.uiTransformComp,a=r.width,o=r.height,s=r.anchorX*a,c=r.anchorY*o,l=-s,u=-c,h=a-s,f=o-c,_=0;switch(t.fillType){case zX.HORIZONTAL:_=l+(h-l)*n,l+=(h-l)*e,h=_;break;case zX.VERTICAL:_=u+(f-u)*n,u+=(f-u)*e,f=_;break;default:O(2626)}i[0].x=l,i[0].y=u,i[1].x=h,i[1].y=u,i[2].x=l,i[2].y=f,i[3].x=h,i[3].y=f},createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.resize(4,6);for(var n,i=ot(e.data);!(n=i()).done;)n.value.z=0;return e},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(UX);for(var n=t.renderData.floatStride,i=t.renderData.data,r=e.vb,a=0,o=0;o<4;o++){var s=i[o];Dn.transformMat4(kX,s,UX),r[a=o*n]=kX.x,r[a+1]=kX.y,r[a+2]=kX.z}},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,u=0;u<4;u++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},VX=2*Math.PI,HX=1e-6,WX=new Xn,jX=new Dn,XX=[new Qn,new Qn,new Qn,new Qn],qX=new Array(4),YX=new Array(8),KX=[new Qn,new Qn,new Qn,new Qn],QX=[new Qn,new Qn,new Qn,new Qn],JX=new Qn,ZX=[new Qn,new Qn,new Qn,new Qn];function $X(t,e,n,i,r,a,o){var s=Math.sin(a);s=Math.abs(s)>HX?s:0;var c=Math.cos(a),l=0,u=0;if(0!==(c=Math.abs(c)>HX?c:0)){if(l=s/c,(t-r.x)*c>0){var h=r.y+l*(t-r.x);o[0].x=t,o[0].y=h}if((e-r.x)*c>0){var f=r.y+l*(e-r.x);o[2].x=e,o[2].y=f}}if(0!==s){if(u=c/s,(i-r.y)*s>0){var _=r.x+u*(i-r.y);o[3].x=_,o[3].y=i}if((n-r.y)*s>0){var d=r.x+u*(n-r.y);o[1].x=d,o[1].y=n}}}function tq(t,e){var n=e.x-t.x,i=e.y-t.y;if(0===n&&0===i)return 0;if(0===n)return i>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(i/n);return n<0&&(r+=Math.PI),r}function eq(t,e,n,i,r){var a=qX,o=a[0],s=a[1],c=a[2],l=a[3];t[e].x=n.x,t[e].y=n.y,t[e+1].x=i.x,t[e+1].y=i.y,t[e+2].x=r.x,t[e+2].y=r.y,nq((n.x-o)/(c-o),(n.y-s)/(l-s),t,e),nq((i.x-o)/(c-o),(i.y-s)/(l-s),t,e+1),nq((r.x-o)/(c-o),(r.y-s)/(l-s),t,e+2)}function nq(t,e,n,i){var r=YX,a=r[0]+(r[2]-r[0])*t,o=r[4]+(r[6]-r[4])*t,s=r[1]+(r[3]-r[1])*t,c=r[5]+(r[7]-r[5])*t,l=n[i];l.u=a+(o-a)*e,l.v=s+(c-s)*e}for(var iq={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;kF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;if(n&&e){if(!n.vertDirty)return;var i=n.data,r=t.fillStart,a=t.fillRange;for(a<0&&(r+=a,a=-a);r>=1;)r-=1;for(;r<0;)r+=1;var o=(r*=VX)+(a*=VX);!function(t){var e=t.node._uiProps.uiTransformComp,n=e.width,i=e.height,r=e.anchorX*n,a=e.anchorY*i,o=-r,s=-a,c=n-r,l=i-a,u=qX;u[0]=o,u[1]=s,u[2]=c,u[3]=l;var h=t.fillCenter,f=JX.x=Math.min(Math.max(0,h.x),1)*(c-o)+o,_=JX.y=Math.min(Math.max(0,h.y),1)*(l-s)+s;XX[0].x=XX[3].x=o,XX[1].x=XX[2].x=c,XX[0].y=XX[1].y=s,XX[2].y=XX[3].y=l;for(var d,p=ot(ZX);!(d=p()).done;){var m=d.value;Qn.set(m,0,0)}f!==u[0]&&Qn.set(ZX[0],3,0),f!==u[2]&&Qn.set(ZX[2],1,2),_!==u[1]&&Qn.set(ZX[1],0,1),_!==u[3]&&Qn.set(ZX[3],2,3)}(t),function(t){var e=t.width,n=t.height,i=t.getRect(),r=0,a=0,o=0,s=0,c=YX;t.isRotated()?(r=i.x/e,a=(i.x+i.height)/e,o=i.y/n,s=(i.y+i.width)/n,c[0]=c[2]=r,c[4]=c[6]=a,c[3]=c[7]=s,c[1]=c[5]=o):(r=i.x/e,a=(i.x+i.width)/e,o=i.y/n,s=(i.y+i.height)/n,c[0]=c[4]=r,c[2]=c[6]=a,c[1]=c[3]=s,c[5]=c[7]=o)}(e),$X(qX[0],qX[2],qX[1],qX[3],JX,r,KX),$X(qX[0],qX[2],qX[1],qX[3],JX,r+a,QX);for(var s=0,c=0;c<4;++c){var l=ZX[c];if(l)if(a>=VX)n.dataLength=s+3,eq(i,s,JX,XX[l.x],XX[l.y]),s+=3;else{var u=tq(JX,XX[l.x]),h=tq(JX,XX[l.y]);h<u&&(h+=VX),u-=VX,h-=VX;for(var f=0;f<3;++f)u>=o||(u>=r?(n.dataLength=s+3,eq(i,s,JX,XX[l.x],h>=o?QX[c]:XX[l.y]),s+=3):h>r&&(h<=o?(n.dataLength=s+3,eq(i,s,JX,KX[c],XX[l.y]),s+=3):(n.dataLength=s+3,eq(i,s,JX,KX[c],QX[c]),s+=3))),u+=VX,h+=VX}}n.resize(s,s),n.updateRenderData(t,e)}},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l++)s[c+l]=a+l;o.indexOffset+=n.indexCount,o.setDirty()},updateWorldVertexAndUVData:function(t,e){t.node.getWorldMatrix(WX);for(var n=t.renderData,i=n.floatStride,r=t.renderData.data,a=e.vb,o=n.vertexCount,s=0,c=0;c<o;c++){var l=r[c];Dn.set(jX,l.x,l.y,0),Dn.transformMat4(jX,jX,WX),a[s+0]=jX.x,a[s+1]=jX.y,a[s+2]=jX.z,a[s+3]=l.u,a[s+4]=l.v,s+=i}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,u=t.node._uiProps.opacity,h=0;h<r;h++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=u,a+=i},updateColor:function(){}},rq=[],aq=0;aq<4;aq++)rq.push(new Dn);for(var oq={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){var e=t.spriteFrame;kF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateWorldVerts:function(t,e){var n=t.renderData,i=e.vb,r=n.data,a=t.node,o=r[0],s=r[1],c=a.worldMatrix,l=c.m00,u=c.m01,h=c.m04,f=c.m05,_=1===l&&0===u&&0===h&&1===f,d=c.m12,p=c.m13,m=o.x,g=s.x,v=o.y,y=s.y;if(_){var S=m+d,T=g+d,x=v+p,E=y+p;i[0]=S,i[1]=x,i[9]=T,i[10]=x,i[18]=S,i[19]=E,i[27]=T,i[28]=E}else{var A=l*m,C=l*g,b=u*m,w=u*g,I=h*v+d,P=h*y+d,R=f*v+p,D=f*y+p;i[0]=A+I,i[1]=b+R,i[9]=C+I,i[10]=w+R,i[18]=A+P,i[19]=b+D,i[27]=C+P,i[28]=w+D}},fillBuffers:function(t){if(null!==t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(i),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6}},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=e.data,r=n.width,a=n.height,o=n.anchorX*r,s=n.anchorY*a,c=0,l=0,u=0,h=0;if(t.trim)c=-o,l=-s,u=r-o,h=a-s;else{var f=t.spriteFrame,_=f.getOriginalSize(),d=f.getRect(),p=_.width,m=_.height,g=d.width,v=d.height,y=f.getOffset(),S=r/p,T=a/m,x=y.x+(p-g)/2,E=y.x-(p-g)/2;c=x*S-o,l=(y.y+(m-v)/2)*T-s,u=r+E*S-o,h=a+(y.y-(m-v)/2)*T-s}i[0].x=c,i[0].y=l,i[1].x=u,i[1].y=h,e.vertDirty=!0}},updateUVs:function(t){if(t.spriteFrame){var e=t.renderData.chunk.vb,n=t.spriteFrame.uv;e[3]=n[0],e[4]=n[1],e[12]=n[2],e[13]=n[3],e[21]=n[4],e[22]=n[5],e[30]=n[6],e[31]=n[7]}},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=5,r=t.color,a=r.r/255,o=r.g/255,s=r.b/255,c=r.a/255,l=0;l<4;l++,i+=e.floatStride)n[i]=a,n[i+1]=o,n[i+2]=s,n[i+3]=c}},sq=new Dn,cq=new Xn,lq={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,54),e},updateRenderData:function(t){var e=t.spriteFrame;kF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateVertexData:function(t){var e=t.renderData.data,n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=t.spriteFrame,c=s.insetLeft,l=s.insetRight,u=s.insetTop,h=s.insetBottom,f=i-c-l,_=r-u-h,d=i/(c+l),p=r/(u+h);d=Number.isNaN(d)||d>1?1:d,p=Number.isNaN(p)||p>1?1:p,f=f<0?0:f,_=_<0?0:_,e[0].x=-a,e[0].y=-o,e[1].x=c*d-a,e[1].y=h*p-o,e[2].x=e[1].x+f,e[2].y=e[1].y+_,e[3].x=i-a,e[3].y=r-o},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);for(var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset,c=0;c<3;++c)for(var l=0;l<3;++l){var u=r+4*c+l;o[s++]=u,o[s++]=u+1,o[s++]=u+4,o[s++]=u+1,o[s++]=u+5,o[s++]=u+4}a.indexOffset=s},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(cq);for(var n=t.renderData,i=n.floatStride,r=n.data,a=e.vb,o=0,s=0;s<4;++s)for(var c=r[s],l=0;l<4;++l){var u=r[l];Dn.set(sq,u.x,c.y,0),Dn.transformMat4(sq,sq,cq),o=(4*s+l)*i,a[o++]=sq.x,a[o++]=sq.y,a[o++]=sq.z}},updateUVs:function(t){if(t.spriteFrame)for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=t.spriteFrame.uvSliced,a=3,o=0;o<16;o++)n[a]=r[o].u,n[a+1]=r[o].v,a+=i},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,u=0;u<16;u++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},uq=[],hq=0;hq<4;hq++)uq.push(new Dn);var fq=new Xn,_q={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,n=t.spriteFrame;if(n&&e&&(e.updateRenderData(t,n),e.vertDirty)){var i=t.node._uiProps.uiTransformComp,r=Math.abs(i.width),a=Math.abs(i.height),o=n.getRect(),s=n.insetLeft,c=n.insetRight,l=o.width-s-c,u=n.insetTop,h=n.insetBottom,f=o.height-u-h,_=r-s-c,d=a-u-h;_=_>0?_:0,d=d>0?d:0;var p=0===l?_:_/l,m=0===f?d:d/f,g=Math.ceil(m+2),v=Math.ceil(p+2);e.dataLength=Math.max(8,g+1,v+1),this.updateVerts(t,_,d,g,v),e.resize(g*v*4,g*v*6)}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l+=6)s[c++]=a,s[c++]=a+1,s[c++]=a+2,s[c++]=a+1,s[c++]=a+3,s[c++]=a+2,a+=4,o.indexOffset+=6;o.setDirty()},updateWorldVertexAndUVData:function(t,e){var n=t.node;n.getWorldMatrix(fq);var i=t.renderData,r=i.floatStride,a=i.data,o=e.vb,s=n._uiProps.uiTransformComp,c=Math.abs(s.width),l=Math.abs(s.height),u=t.spriteFrame,h=u.rotated,f=u.uv,_=u.uvSliced,d=u.rect,p=u.insetLeft,m=u.insetRight,g=d.width-p-m,v=u.insetTop,y=u.insetBottom,S=d.height-v-y,T=c-p-m,x=l-v-y;T=T>0?T:0,x=x>0?x:0;for(var E=0===g?T:T/g,A=0===S?x:x/S,C=Math.ceil(A+2),b=Math.ceil(E+2),w=0,I=0,P=0,R=0,D=0,O=0,N=C;O<N;++O){R=a[O].y,D=a[O+1].y;for(var M=0,L=b;M<L;++M){I=a[M].x,P=a[M+1].x,Dn.set(uq[0],I,R,0),Dn.set(uq[1],P,R,0),Dn.set(uq[2],I,D,0),Dn.set(uq[3],P,D,0);for(var F=0;F<4;F++){var B=uq[F];Dn.transformMat4(B,B,fq);var z=F*r;o[w+z]=B.x,o[w+z+1]=B.y,o[w+z+2]=B.z}w+=4*r}}w=0;for(var U=r,k=2*r,G=3*r,V=4*r,H=0,W=0,j=[],X=[],q=0,Y=C;q<Y;++q){W=x>S?x>=q*S?1:A%1:A;for(var K=0,Q=b;K<Q;++K){H=T>g?T>=K*g?1:E%1:E;var J=w+3,Z=J+1;h?(0===q?(j[0]=_[0].u,j[1]=_[0].u,j[2]=_[4].u+(_[8].u-_[4].u)*W):q<C-1?(j[0]=_[4].u,j[1]=_[4].u,j[2]=_[4].u+(_[8].u-_[4].u)*W):q===C-1&&(j[0]=_[8].u,j[1]=_[8].u,j[2]=_[12].u),0===K?(X[0]=_[0].v,X[1]=_[1].v+(_[2].v-_[1].v)*H,X[2]=_[0].v):K<b-1?(X[0]=_[1].v,X[1]=_[1].v+(_[2].v-_[1].v)*H,X[2]=_[1].v):K===b-1&&(X[0]=_[2].v,X[1]=_[3].v,X[2]=_[2].v),j[3]=j[2],X[3]=X[1]):(0===K?(j[0]=_[0].u,j[1]=_[1].u+(_[2].u-_[1].u)*H,j[2]=f[0]):K<b-1?(j[0]=_[1].u,j[1]=_[1].u+(_[2].u-_[1].u)*H,j[2]=_[1].u):K===b-1&&(j[0]=_[2].u,j[1]=_[3].u,j[2]=_[2].u),0===q?(X[0]=_[0].v,X[1]=_[0].v,X[2]=_[4].v+(_[8].v-_[4].v)*W):q<C-1?(X[0]=_[4].v,X[1]=_[4].v,X[2]=_[4].v+(_[8].v-_[4].v)*W):q===C-1&&(X[0]=_[8].v,X[1]=_[8].v,X[2]=_[12].v),j[3]=j[1],X[3]=X[2]),o[J]=j[0],o[Z]=X[0],o[J+U]=j[1],o[Z+U]=X[1],o[J+k]=j[2],o[Z+k]=X[2],o[J+G]=j[3],o[Z+G]=X[3],w+=V}}},updateVerts:function(t,e,n,i,r){var a,o,s=t.node._uiProps.uiTransformComp,c=t.renderData.data,l=t.spriteFrame,u=l.rect,h=Math.abs(s.width),f=Math.abs(s.height),_=s.anchorX*h,d=s.anchorY*f,p=l.insetLeft,m=l.insetRight,g=u.width-p-m,v=l.insetTop,y=l.insetBottom,S=u.height-v-y,T=s.width/(p+m)>1?1:s.width/(p+m),x=s.height/(v+y)>1?1:s.height/(v+y);a=g>0?Math.floor(1e3*e)/1e3%g==0?g:e%g:e,o=S>0?Math.floor(1e3*n)/1e3%S==0?S:n%S:n;for(var E=0;E<=r;E++)0===E?c[E].x=-_:E>0&&E<r?c[E].x=1===E?p*T+Math.min(g,e)-_:g>0?E===r-1?p+a+g*(E-2)-_:p+Math.min(g,e)+g*(E-2)-_:p+e-_:E===r&&(c[E].x=Math.min(p+e+m,h)-_);for(var A=0;A<=i;A++)0===A?c[A].y=-d:A>0&&A<i?c[A].y=1===A?y*x+Math.min(S,n)-d:S>0?A===i-1?y+o+(A-2)*S-d:y+Math.min(S,n)+(A-2)*S-d:y+n-d:A===i&&(c[A].y=Math.min(y+n+v,f)-d)},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,u=t.node._uiProps.opacity,h=0;h<r;h++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=u,a+=i},updateColor:function(){}},dq=kV.Type,pq=kV.FillType,mq=t("spriteAssembler",{getAssembler:function(t){var e=oq,n=t;switch(n.type){case dq.SLICED:e=lq;break;case dq.TILED:e=_q;break;case dq.FILLED:e=n.fillType===pq.RADIAL?iq:GX}return e}});kV.Assembler=mq;var gq=Hz.sharedManager,vq={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){t.type===TG.IMAGE_STENCIL&&(oq.updateRenderData(t),oq.updateColor(t))},fillBuffers:function(t,e){(t.type!==TG.IMAGE_STENCIL||t.spriteFrame)&&(gq.pushMask(t),e.finishMergeBatches(),function(t,e){gq.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(gq.enterLevel(t),t.type===TG.IMAGE_STENCIL){oq.fillBuffers(t,e);var n=t.graphics.getMaterialInstance(0);e.forceMergeBatches(n,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),gq.enableMask())}},yq={fillBuffers:function(){gq.exitMask()}},Sq={getAssembler:function(){return vq}},Tq={getAssembler:function(){return yq}};bG.Assembler=Sq,bG.PostAssembler=Tq;var xq=t("MeshBuffer",function(){function t(){this.byteOffset=0,this.vertexOffset=0,this.indexOffset=0,this.vData=null,this.iData=null,this._dirty=!1,this._vertexFormatBytes=0,this._floatsPerVertex=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0}var e=t.prototype;return e.initialize=function(t,e,n,i){this._initVDataCount=n,this._initIDataCount=i,this._attributes=e,this._floatsPerVertex=WB(e),this._initVDataCount,this._floatsPerVertex,F(9005),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},e.reset=function(){this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t];e.vertexBuffers[0]&&e.vertexBuffers[0].destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.ia.destroy()}this._iaPool.length=0},e.setDirty=function(){this._dirty=!0},e.request=function(){return R(9002),!1},e.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},e.recycleIA=function(t){for(var e=this._iaPool,n=0;n<this._nextFreeIAHandle;++n)if(t===e[n].ia){var i=e[n];return e[n]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=i)}},e.checkCapacity=function(t,e){var n=(this.vertexOffset+t)*this._floatsPerVertex,i=this.indexOffset+e;return!(n>this._initVDataCount||i>this._initIDataCount)},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){for(var t=ch.__isWebIOS14OrIPadOS14Env?this._nextFreeIAHandle:1,e=this.byteOffset,n=this.indexOffset,i=0;i<t;++i){var r=this._iaPool[i],a=new Float32Array(this.vData.buffer,0,e>>2),o=new Uint16Array(this.iData.buffer,0,n),s=r.vertexBuffers[0];e>s.size&&s.resize(e),s.update(a),2*n>r.indexBuffer.size&&r.indexBuffer.resize(2*n),r.indexBuffer.update(o)}this._dirty=!1}},e.createNewIA=function(t){var e,n,i;if(ch.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,a=Uint16Array.BYTES_PER_ELEMENT,o=t.createBuffer(new pr(vi.VERTEX|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,r,r));i=t.createBuffer(new pr(vi.INDEX|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,a,a)),n=[o],this._iaInfo=new Mr(this._attributes,n,i),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),n=this._iaInfo.vertexBuffers,i=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:n,indexBuffer:i}},Q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}()),Eq=[PR.EventType.MOUSE_DOWN,PR.EventType.MOUSE_MOVE,PR.EventType.MOUSE_UP,PR.EventType.MOUSE_WHEEL],Aq=[PR.EventType.TOUCH_START,PR.EventType.TOUCH_MOVE,PR.EventType.TOUCH_END,PR.EventType.TOUCH_CANCEL],Cq=(new(function(){function t(){this.priority=yR.UI,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],RR._registerEventDispatcher(this),XP.callbacksInvoker.on(rw.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),XP.callbacksInvoker.on(rw.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this),XP.callbacksInvoker.on(rw.MARK_LIST_DIRTY,this._markListDirty,this)}var e=t.prototype;return e.dispatchEvent=function(t){var e=t.type;return Aq.includes(e)?this.dispatchEventTouch(t):!Eq.includes(e)||this.dispatchEventMouse(t)},e.addPointerEventProcessor=function(t){0===this._inDispatchCount?this._pointerEventProcessorList.includes(t)||(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.includes(t)||this._processorListToAdd.push(t),ie.array.remove(this._processorListToRemove,t)},e.removePointerEventProcessor=function(t){0===this._inDispatchCount?(ie.array.remove(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.includes(t)||this._processorListToRemove.push(t),ie.array.remove(this._processorListToAdd,t)},e.dispatchEventMouse=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=!0,r=0;r<n;++r){var a=e[r];if(a.isEnabled&&a.shouldHandleEventMouse&&a._handleEventMouse(t)){if(i=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),i},e.dispatchEventTouch=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=t.touch,r=!0,a=0;a<n;++a){var o=e[a];if(o.isEnabled&&o.shouldHandleEventTouch)if(t.type===nw.TOUCH_START){if(o._handleEventTouch(t)){if(o.claimedTouchIdList.push(i.getID()),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(o.claimedTouchIdList.length>0){var s=o.claimedTouchIdList.indexOf(i.getID());if(-1!==s){if(o._handleEventTouch(t),t.type!==nw.TOUCH_END&&t.type!==nw.TOUCH_CANCEL||ie.array.removeAt(o.claimedTouchIdList,s),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),r},e._updatePointerEventProcessorList=function(){for(var t=this._processorListToAdd,e=t.length,n=0;n<e;++n)this.addPointerEventProcessor(t[n]);t.length=0;for(var i=this._processorListToRemove,r=i.length,a=0;a<r;++a)this.removePointerEventProcessor(i[a]);i.length=0},e._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var t=this._pointerEventProcessorList,e=t.length,n=0;n<e;++n){var i=t[n],r=i.node;if(r._uiProps){var a=r._uiProps.uiTransformComp;i.cachedCameraPriority=a.cameraPriority}}t.sort(this._sortByPriority),this._isListDirty=!1}},e._sortByPriority=function(t,e){var n=t.node,i=e.node;if(!(e&&i&&i.activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(t&&n&&n.activeInHierarchy&&n._uiProps.uiTransformComp))return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;for(var r=n,a=i,o=!1;(null===(s=r.parent)||void 0===s?void 0:s._id)!==(null===(c=a.parent)||void 0===c?void 0:c._id);){var s,c,l,u,h,f;r=null===(null===(l=r)||void 0===l||null===(u=l.parent)||void 0===u?void 0:u.parent)?(o=!0)&&i:r&&r.parent,a=null===(null===(h=a)||void 0===h||null===(f=h.parent)||void 0===f?void 0:f.parent)?(o=!0)&&n:a&&a.parent}if(r._id===a._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var _=r?r.getSiblingIndex():0,d=a?a.getSiblingIndex():0;return o?_-d:d-_},e._markListDirty=function(){this._isListDirty=!0},t}()),function(){function t(t,e){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=WB(e),this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},Q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}()),bq=new Hl((function(){return{offset:0,length:0}}),32),wq=function(t,e,n,i){this.vertexAccessor=t,this.bufferId=e,this.vertexOffset=n,this.vb=i},Iq=function(t){function e(n,i,r,a){var o;return(o=t.call(this,n,i)||this)._freeLists=[],o._vCount=0,o._iCount=0,o._vCount=r||Math.floor(1024*he.BATCHER2D_MEM_INCREMENT/o._vertexFormatBytes),o._iCount=a||o._vCount*e.IB_SCALE,o._allocateBuffer(),o}Z(e,t);var n=e.prototype;return n.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var n=this._freeLists[e],i=0;i<n.length;++i)bq.free(n[i])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],n=this._buffers[t];(!e||e.length<n.vData.byteLength)&&n.uploadBuffers()}},n.appendIndices=function(t,e){var n=this._buffers[t];e.length&&(n.iData.set(e,n.indexOffset),n.indexOffset+=e.length)},n.allocateChunk=function(t,e){for(var n,i=t*this.vertexFormatBytes,r=null,a=0,o=-1,s=null,c=0;c<this._buffers.length;++c){r=this._buffers[c],n=this._freeLists[c];for(var l=0;l<n.length;++l)if(n[l].length>=i){s=n[l],a=c,o=l;break}if(s)break}if(s||(a=this._allocateBuffer(),(r=this._buffers[a])&&r.checkCapacity(t,e)&&(o=0,s=this._freeLists[a][o])),s){var u=s.offset/this.vertexFormatBytes,h=new Float32Array(r.vData.buffer,s.offset,i>>2).fill(0);return this._allocateChunkFromEntry(a,o,s,i),new wq(this,a,u,h,e)}return O(9004,i),null},n.recycleChunk=function(t){var e=this._freeLists[t.bufferId],n=this._buffers[t.bufferId],i=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var a=!1,o=0,s=null,c=e[o];c&&c.offset<i;)s=c,c=e[++o];if(s&&0==i-(s.offset+s.length)&&(s.length+=r,i=s.offset,r=s.length,c&&c.offset-(i+r)==0&&(s.length+=c.length,e.splice(o,1),bq.free(c),c=null),a=!0),!a&&c){if(0==c.offset-(i+r))c.offset=i,c.length+=r;else{var l=bq.alloc();l.offset=i,l.length=r,e.splice(o,0,l)}a=!0}if(a)i+r===n.byteOffset&&(n.byteOffset=i);else{var u=bq.alloc();u.offset=i,u.length=r,e.push(u)}}},n._allocateChunkFromEntry=function(t,e,n,i){var r=n.length-i,a=n.offset+i,o=this._buffers[t];o.byteOffset<a&&(o.byteOffset=a),L(r>=0,9004,t,n.offset,n.length),0===r?(this._freeLists[t].splice(e,1),bq.free(n)):(n.offset+=i,n.length=r)},n._allocateBuffer=function(){L(this._buffers.length===this._freeLists.length,9003);var t=new xq,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var n=bq.alloc();n.offset=0,n.length=t.vData.byteLength;var i=[n];return this._freeLists.push(i),this._buffers.length-1},e}(Cq);Iq.IB_SCALE=4;var Pq=new jr(null),Rq=new Xn,Dq=t("UI",function(){function t(t){var e=this;this.device=void 0,this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._drawBatchPool=void 0,this._batches=void 0,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new $g,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new Nq,this._meshDataArray=[],this._root=t,this.device=t.device,this._batches=new jl(64),this._drawBatchPool=new Hl((function(){return new PW}),128,(function(t){return t.destroy(e)}))}var e=t.prototype;return e.initialize=function(){return!0},e.destroy=function(){for(var t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy(),this._bufferAccessors.forEach((function(t){t.destroy()})),this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),Hz.sharedManager.destroy()},e.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},e.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,n=0;n<e.length;n++){var i=e[n];if(i.visibility&t.layer)return i}return null},e.update=function(){for(var t=this._screens,e=0,n=0;n<t.length;++n){var i=t[n],r=i._getRenderScene();if(i.enabledInHierarchy&&r){this._opacityDirty=0,this._pOpacity=1,this.walk(i.node),this.autoMergeBatches(this._currComponent),this.resetRenderStates();var a=0;if(this._batches.length>e)for(;e<this._batches.length;++e){var o=this._batches.array[e];if(o.model)for(var s=o.model.subModels,c=0;c<s.length;c++)s[c].priority=a++;else o.descriptorSet=this._descriptorSetCache.getDescriptorSet(o);r.addBatch(o)}}}},e.uploadBuffers=function(){this._batches.length>0&&(this._meshDataArray.forEach((function(t){t.uploadBuffers()})),this._bufferAccessors.forEach((function(t){t.uploadBuffers(),t.reset()})),this._descriptorSetCache.update())},e.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._bufferAccessors.forEach((function(t){t.reset()})),this._meshDataArray.forEach((function(t){t.freeIAPool()})),this._meshDataArray.length=0,this._staticVBBuffer=null,this._currBID=-1,this._indexStart=0,this._currHash=0,this._currLayer=0,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._batches.clear(),Hz.sharedManager.reset()},e.switchBufferAccessor=function(t){void 0===t&&(t=VB);var e=t===VB?36:jB(t);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==e){var n=this._bufferAccessors.get(e);n||(n=new Iq(this.device,t),this._bufferAccessors.set(e,n)),this._staticVBBuffer=n,this._currBID=-1}return this._staticVBBuffer},e.registerBufferAccessor=function(t,e){this._bufferAccessors.set(t,e)},e.updateBuffer=function(t,e){var n=this.switchBufferAccessor(t);this._currBID!==e&&(this._currBID=e,this._indexStart=n.getMeshBuffer(e).indexOffset)},e.commitComp=function(t,e,n,i,r){var a,o=0,s=-1;if(e&&e.chunk){if(!e.isValid())return;o=e.dataHash,a=e.material,s=e.chunk.bufferId}t.stencilStage=Hz.sharedManager.stage;var c=t.stencilStage;this._currHash===o&&0!==o&&this._currMaterial===a&&this._currDepthStencilStateStage===c||(this.autoMergeBatches(this._currComponent),e&&!e.isMeshBuffer&&this.updateBuffer(e.vertexFormat,s),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=r,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=c,this._currLayer=t.node.layer,n?(this._currTexture=n.getGFXTexture(),this._currSampler=n.getGFXSampler(),this._currTextureHash=n.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),i.fillBuffers(t,this)},e.commitIA=function(t,e,n,i,r){var a,o;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var s=0,c=0;t&&(a=-1===t.blendHash?null:t.getBlendState(),c=t.blendHash,t.stencilStage=Hz.sharedManager.stage,o=null!==t.customMaterial?Hz.sharedManager.getStencilStage(t.stencilStage,i):Hz.sharedManager.getStencilStage(t.stencilStage),s=Hz.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.visFlags=t.node.layer,l.inputAssembler=e,l.useLocalData=r||null,n&&(l.texture=n.getGFXTexture(),l.sampler=n.getGFXSampler(),l.textureHash=n.getHash(),l.samplerHash=l.sampler.hash),l.fillPasses(i||null,o,s,a,c,null,this),this._batches.push(l)},e.commitModel=function(t,e,n){var i;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var r=0;n&&(t.stencilStage!==oz.ENABLED&&t.stencilStage!==oz.DISABLED||(t.stencilStage=Hz.sharedManager.stage),i=Hz.sharedManager.getStencilStage(t.stencilStage,n),r=Hz.sharedManager.getStencilHash(t.stencilStage));var a=l.director.getTotalFrames();e&&(e.updateTransform(a),e.updateUBOs(a));for(var o=0;o<e.subModels.length;o++){var s=this._drawBatchPool.alloc(),c=e.subModels[o];s.visFlags=t.node.layer,s.model=e,s.texture=null,s.sampler=null,s.useLocalData=null,i||(i=null),s.fillPasses(n,i,r,null,0,c.patches,this),s.inputAssembler=c.inputAssembler,s.model.visFlags=s.visFlags,s.descriptorSet=c.descriptorSet,this._batches.push(s)}},e.setupStaticBatch=function(t,e){this.finishMergeBatches(),this._staticVBBuffer=e,this.currStaticRoot=t},e.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()},e.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(t){var e=this._currMaterial;if(e){var n,i=this._currRenderData,r=this._staticVBBuffer;if(i&&i.isMeshBuffer)n=i.requestIA(this.device),-1===this._meshDataArray.indexOf(i)&&this._meshDataArray.push(i);else if(r){var a=this._currBID,o=r.getMeshBuffer(a);if(!o)return;var s=o.indexOffset-this._indexStart;if(s<=0)return;this._indexStart,o.indexOffset,o.setDirty(),(n=o.requireFreeIA(this.device)).firstIndex=this._indexStart,n.indexCount=s,this._indexStart=o.indexOffset}if(this._currBID=-1,n){var c,l,u=0,h=0;t&&(c=-1===t.blendHash?null:t.getBlendState(),h=t.blendHash,l=null!==t.customMaterial?Hz.sharedManager.getStencilStage(t.stencilStage,e):Hz.sharedManager.getStencilStage(t.stencilStage),u=Hz.sharedManager.getStencilHash(t.stencilStage));var f=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();f.visFlags=this._currLayer,f.texture=this._currTexture,f.sampler=this._currSampler,f.inputAssembler=n,f.useLocalData=this._currTransform,f.textureHash=this._currTextureHash,f.samplerHash=this._currSamplerHash,f.fillPasses(e,l,u,c,h,null,this),this._batches.push(f)}}},e.forceMergeBatches=function(t,e,n){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=n.node.layer,this.autoMergeBatches(n)},e.resetRenderStates=function(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},e.flushMaterial=function(t){this._currMaterial=t},e.walk=function(t,e){if(void 0===e&&(e=0),t.activeInHierarchy){var n=t.children,i=t._uiProps,r=i.uiComp,a=this._pOpacity,o=a,s=r&&r.color?r.color.a/255:1;if(this._pOpacity=o*=s*i.localOpacity,i._opacity=o,i.colorDirty&&this._opacityDirty++,r&&r.enabledInHierarchy&&r.updateAssembler(this),this._opacityDirty&&r&&!r.useVertexOpacity&&r.renderData&&r.renderData.vertexCount>0){!function(t,e){for(var n,i,r,a=t.vertexFormat,o=t.chunk.vb,s=0,c=0;c<a.length;++c){if(n=a[c],(i=na[n.format]).hasAlpha)if(r=t.floatStride,i.size/i.count==1)for(var l=~~un(Math.round(255*e),0,255),u=s;u<o.length;u+=r)o[u]=(4294967040&o[u]|l)>>>0;else if(i.size/i.count==4)for(var h=s+3;h<o.length;h+=r)o[h]=e;s+=i.size>>2}}(r.renderData,o);var c=r.renderData.getMeshBuffer();c&&c.setDirty()}if(n.length>0&&!t._static)for(var l=0;l<n.length;++l){var u=n[l];this.walk(u,e)}i.colorDirty&&(this._opacityDirty--,i.colorDirty=!1),this._pOpacity=a,r&&r.enabledInHierarchy&&r.postUpdateAssembler(this),e+=1}},e._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},e._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},Q(t,[{key:"currBufferAccessor",get:function(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),t}()),Oq=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=l.director.root.device;this._localData=new Float32Array(ip.COUNT),this._localBuffer=t.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,ip.SIZE,ip.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=l.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,Pq.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(Pq),this._descriptorSet.bindBuffer(ip.BINDING,this._localBuffer);var n=Md.SAMPLER_SPRITE;this._descriptorSet.bindTexture(n,t.texture),this._descriptorSet.bindSampler(n,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.equals=function(t,e,n){return this._transform===t&&this._textureHash===e&&this._samplerHash===n},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.isValid=function(){return this._transform&&this._transform.isValid},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){var e=t.worldMatrix;Xn.toArray(this._localData,e,ip.MAT_WORLD_OFFSET),Xn.inverseTranspose(Rq,e);var n=Xn.determinant(Rq),i=1/Math.sqrt(n);Xn.multiplyScalar(Rq,Rq,i),Xn.toArray(this._localData,Rq,ip.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},Q(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),Nq=function(){function t(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new Hl((function(){return new Oq}),16,(function(t){return t.destroy()}))}var e=t.prototype;return e.getDescriptorSet=function(t){var e,n=l.director.root;if(t.useLocalData){for(var i=this._localDescriptorSetCache,r=0,a=i.length;r<a;r++){var o=i[r];if(o.equals(t.useLocalData,t.textureHash,t.samplerHash))return o.descriptorSet}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.descriptorSet}if(e=t.textureHash^t.samplerHash,this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);Pq.layout=t.passes[0].localSetLayout;var c=n.device.createDescriptorSet(Pq),u=Md.SAMPLER_SPRITE;return c.bindTexture(u,t.texture),c.bindSampler(u,t.sampler),c.update(),this._descriptorSetCache.set(e,c),this._dsCacheHashByTexture.set(t.textureHash,e),c},e.update=function(){var t=this._localDescriptorSetCache,e=[];t.forEach((function(n){if(n.isValid())n.uploadLocalData();else{n.reset();var i=t.indexOf(n);e.push(i)}}));for(var n=e.length-1;n>=0;n--)t.splice(e[n],1)},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){var e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.destroy()})),this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t}();l.internal.Batcher2D=Dq,G(xq.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((function(t){return{name:t,suggest:"please use meshBuffer.accessor."+t+" instead"}}))),U(xq.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),k(xq.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),U(Dq.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),k(fz.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),U(fz.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("QuadRenderData",function(t){function e(e){var n;return n=t.call(this,e)||this,R(9006),n}return Z(e,t),e}(fz));var Mq,Lq,Fq,Bq,zq,Uq,kq,Gq,Vq,Hq=null,Wq=-1,jq="BES bswy:->@123",Xq=Object.create(null),qq=[],Yq=3e3;function Kq(){for(var t=!0,e=Date.now(),n=qq.length-1;n>=0;n--){var i=qq[n],r=i.fontFamilyName;if(e-i.startTime>Yq)R(4933,r),i.onComplete(null,r),qq.splice(n,1);else{var a=i.refWidth,o="40px "+r;Hq.font=o,a!==wB(Hq,jq,o)?(qq.splice(n,1),i.onComplete(null,r)):t=!1}}t&&(clearInterval(Wq),Wq=-1)}function Qq(t,e,n){var i=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var n,i=t.lastIndexOf("/");return-1!==(n=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}(t);if(Xq[i])n(null,i);else{if(!Hq){var r=document.createElement("canvas");r.width=100,r.height=100,Hq=r.getContext("2d")}var a=wB(Hq,jq,"40px "+i),o=document.createElement("style");o.type="text/css";var s="";Number.isNaN(i)?s+="@font-face { font-family:"+i+"; src:":s+='@font-face { font-family:"'+i+'"; src:',s+='url("'+t+'");',o.textContent=s+"}",document.body.appendChild(o);var c=document.createElement("div"),l=c.style;if(l.fontFamily=i,c.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(c),function(){if(void 0===Mq)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Mq=t?parseInt(t[1],10)>42:!e}else Mq=!1;return Mq}())!function(t,e,n){var i=new Promise((function(n,i){!function r(){Date.now()-t>=Yq?i():document.fonts.load("40px "+e).then((function(t){t.length>=1?n():setTimeout(r,100)}),(function(){i()}))}()})),r=null,a=new Promise((function(t,e){r=setTimeout(e,Yq)}));Promise.race([a,i]).then((function(){r&&(clearTimeout(r),r=null),n(null,e)}),(function(){R(4933,e),n(null,e)}))}(Date.now(),i,n);else{var u={fontFamilyName:i,refWidth:a,onComplete:n,startTime:Date.now()};qq.push(u),-1===Wq&&(Wq=setInterval(Kq,100))}Xq[i]=o}}function Jq(t,e,n,i){var r=new lB;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function Zq(t){return"string"==typeof t||"number"==typeof t}$N.register({".font":Qq,".eot":Qq,".ttf":Qq,".woff":Qq,".svg":Qq,".ttc":Qq}),oM.register({".font":Jq,".eot":Jq,".ttf":Jq,".woff":Jq,".svg":Jq,".ttc":Jq}),l.UI={MeshBuffer:xq,spriteAssembler:mq,graphicsAssembler:mj,labelAssembler:BX,RenderData:hz,MeshRenderData:fz};var $q,tY,eY,nY,iY,rY,aY,oY,sY,cY,lY,uY,hY,fY,_Y,dY,pY,mY,gY,vY,yY,SY,TY=Ec("cc.animation.HierarchyPath")((zq=function(){function t(t){st(this,"path",Bq,this),this.path=t||""}return t.prototype.get=function(t){return t instanceof ob?t.getChildByPath(this.path)||(R(3926,t.name,this.path),null):(R(3925),null)},t}(),Bq=ct((Fq=zq).prototype,"path",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Lq=Fq))||Lq,xY=Ec("cc.animation.ComponentPath")((Vq=function(){function t(t){st(this,"component",Gq,this),this.component=t||""}return t.prototype.get=function(t){return t instanceof ob?t.getComponent(this.component)||(R(3928,t.name,this.component),null):(R(3927),null)},t}(),Gq=ct((kq=Vq).prototype,"component",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Uq=kq))||Uq,EY=Ec("cc.animation.UniformProxyFactory")((rY=function(){function t(t,e){st(this,"passIndex",eY,this),st(this,"uniformName",nY,this),st(this,"channelIndex",iY,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],n=e.getHandle(this.uniformName);if(!n)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');if(Rg.getTypeFromHandle(n)<gi.SAMPLER1D){var i=void 0===this.channelIndex?n:e.getHandle(this.uniformName,this.channelIndex,gi.FLOAT);if(!i)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var n,i=ot(t.shaderInfo.blocks);!(n=i()).done;)for(var r,a=ot(n.value.members);!(r=a()).done;){var o=r.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(i,t)}}:{set:function(t){e.setUniform(i,t)}}}var r=Rg.getBindingFromHandle(n),a=e.properties[this.uniformName],o=a&&a.value?a.value+"-texture":im(a.type),s=Eg.get(o);return s||(S("Illegal texture default value: "+o+"."),s=Eg.get("default-texture")),{set:function(t){t||(t=s);var n=t.getGFXTexture();n&&n.width&&n.height&&(e.bindTexture(r,n),t instanceof Hm&&e.bindSampler(r,l.game._gfxDevice.getSampler(t.getSamplerInfo())))}}},t}(),eY=ct((tY=rY).prototype,"passIndex",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nY=ct(tY.prototype,"uniformName",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iY=ct(tY.prototype,"channelIndex",[nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),$q=tY))||$q,AY=Ec("cc.animation.MorphWeightValueProxy")((lY=function(){function t(){st(this,"subMeshIndex",sY,this),st(this,"shapeIndex",cY,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),sY=ct((oY=lY).prototype,"subMeshIndex",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cY=ct(oY.prototype,"shapeIndex",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aY=oY))||aY,CY=Ec("cc.animation.MorphWeightsValueProxy")((_Y=function(){function t(){st(this,"subMeshIndex",fY,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),fY=ct((hY=_Y).prototype,"subMeshIndex",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uY=hY))||uY,bY=Ec("cc.animation.MorphWeightsAllValueProxy")(dY=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||dY;function wY(t,e,n,i){var r,a,o,s,c,l,u=new e,h=new e,f=new e,_=Ec(t)((l=function(){function t(t,n,i){st(this,"dataPoint",o,this),st(this,"inTangent",s,this),st(this,"outTangent",c,this),this.dataPoint=t||new e,this.inTangent=n||new e,this.outTangent=i||new e}var r=t.prototype;return r.lerp=function(t,e,r){var a=this.dataPoint,o=t.dataPoint;h=n(h,this.inTangent,r),f=n(f,t.outTangent,r);var s=e*e*e,c=e*e,l=s-2*c+e,_=-2*s+3*c,d=s-c;return u=n(u,a,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,o,_),u=i(u,u,f,d)},r.getNoLerp=function(){return this.dataPoint},t}(),o=ct((a=l).prototype,"dataPoint",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),s=ct(a.prototype,"inTangent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),c=ct(a.prototype,"outTangent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),r=a))||r;if(e===zn){var d=_.prototype.lerp;_.prototype.lerp=function(t,e,n){var i=d.call(this,t,e,n);return zn.normalize(i,i),i}}return _}var IY,PY,RY,DY,OY,NY,MY,LY,FY,BY,zY,UY,kY,GY,VY,HY,WY,jY,XY,qY,YY,KY,QY,JY,ZY,$Y,tK,eK=wY("cc.CubicSplineVec2Value",Qn,Qn.multiplyScalar,Qn.scaleAndAdd),nK=wY("cc.CubicSplineVec3Value",Dn,Dn.multiplyScalar,Dn.scaleAndAdd),iK=wY("cc.CubicSplineVec4Value",ti,ti.multiplyScalar,ti.scaleAndAdd),rK=wY("cc.CubicSplineQuatValue",zn,zn.multiplyScalar,zn.scaleAndAdd),aK=Ec("cc.CubicSplineNumberValue")((SY=function(){function t(t,e,n){st(this,"dataPoint",gY,this),st(this,"inTangent",vY,this),st(this,"outTangent",yY,this),this.dataPoint=t,this.inTangent=e,this.outTangent=n}var e=t.prototype;return e.lerp=function(t,e,n){var i=this.dataPoint,r=t.dataPoint,a=e*e*e,o=e*e;return i*(2*a-3*o+1)+this.outTangent*n*(a-2*o+e)+r*(-2*a+3*o)+t.inTangent*n*(a-o)},e.getNoLerp=function(){return this.dataPoint},t}(),gY=ct((mY=SY).prototype,"dataPoint",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vY=ct(mY.prototype,"inTangent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yY=ct(mY.prototype,"outTangent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pY=mY))||pY,oK=Symbol("CreateEval"),sK=Symbol("NormalizedFollow"),cK=Symbol("ConvertAsTrsPath"),lK=Symbol("TrackBinding"),uK=Ec("cc.animation.TrackPath")((DY=function(){function t(){st(this,"_paths",RY,this)}var e=t.prototype;return e.toProperty=function(t){return this._paths.push(t),this},e.toElement=function(t){return this._paths.push(t),this},e.toHierarchy=function(t){return this._paths.push(new TY(t)),this},e.toComponent=function(t){var e=new xY("string"==typeof t?t:ie.getClassName(t));return this._paths.push(e),this},e.toCustomized=function(t){return this._paths.push(t),this},e.append=function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=(t=this._paths).concat.apply(t,n.map((function(t){return t._paths})));return this._paths=r,this},e.isPropertyAt=function(t){return"string"==typeof this._paths[t]},e.parsePropertyAt=function(t){return this._paths[t]},e.isElementAt=function(t){return"number"==typeof this._paths[t]},e.parseElementAt=function(t){return this._paths[t]},e.isHierarchyAt=function(t){return this._paths[t]instanceof TY},e.parseHierarchyAt=function(t){return this.isHierarchyAt(t),this._paths[t].path},e.isComponentAt=function(t){return this._paths[t]instanceof xY},e.parseComponentAt=function(t){return this.isComponentAt(t),this._paths[t].component},e.slice=function(e,n){var i=new t;return i._paths=this._paths.slice(e,n),i},e.trace=function(t,e,n){var i,r;return null!==(i=e)&&void 0!==i||(e=0),null!==(r=n)&&void 0!==r||(n=this._paths.length),this[sK](t,e,n)},e[cK]=function(){for(var t,e=this._paths,n=e.length,i=0,r="";i<n;++i){var a=e[i];if(!(a instanceof TY))break;a.path&&(r?r+="/"+a.path:r=a.path)}if(i===n)return null;if(i!==n-1)return null;switch(e[i]){case"position":case"scale":case"rotation":case"eulerAngles":t=e[i];break;default:return null}return{node:r,property:t}},e[sK]=function(t,e,n){for(var i=this._paths,r=t,a=e;a<n;++a){var o=i[a];if(Zq(o)){if(!(o in r))return R(3929,o),null;r=r[o]}else r=o.get(r);if(null===r)break}return r},Q(t,[{key:"length",get:function(){return this._paths.length}}]),t}(),RY=ct((PY=DY).prototype,"_paths",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IY=PY))||IY,hK=Ec("cc.animation.TrackBinding")(OY=Lc((FY=function(){function t(){st(this,"path",MY,this),st(this,"proxy",LY,this)}var e=t.prototype;return e.parseTrsPath=function(){return this.proxy?null:this.path[cK]()},e.createRuntimeBinding=function(t,e,n){var i=this.path,r=this.proxy,a=i.length,o=a-1;if(0===a||!i.isPropertyAt(o)&&!i.isElementAt(o)||r){if(r){var s=i[sK](t,0,a);if(null===s)return null;var c=r.forTarget(s),l={setValue:function(t){c.set(t)}},u=c.get;return u&&(l.getValue=function(){return u.call(c)}),l}return O(3921),null}var h=i.isPropertyAt(o)?i.parsePropertyAt(o):i.parseElementAt(o),f=i[sK](t,0,a-1);return null===f?null:e&&f instanceof ob&&function(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}(h)?e.createPoseWriter(f,h,n):{setValue:function(t){f[h]=t},getValue:function(){return f[h]}}},e.isMaskedOff=function(t){var e=this.parseTrsPath();if(!e)return!1;for(var n=t.joints[Symbol.iterator](),i=n.next();!i.done;i=n.next()){var r=i.value;if(r.path===e.node)return!r.enabled}return!1},t}(),MY=ct((NY=FY).prototype,"path",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new uK}}),LY=ct(NY.prototype,"proxy",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OY=NY))||OY)||OY,fK=Ec("cc.animation.Track")((kY=function(){function t(){st(this,"_binding",UY,this)}var e=t.prototype;return e.channels=function(){return[]},e.range=function(){for(var t,e={min:1/0,max:-1/0},n=ot(this.channels());!(t=n()).done;){var i=t.value;e.min=Math.min(e.min,i.curve.rangeMin),e.max=Math.max(e.max,i.curve.rangeMax)}return e},Q(t,[{key:"path",get:function(){return this._binding.path},set:function(t){this._binding.path=t}},{key:"proxy",get:function(){return this._binding.proxy},set:function(t){this._binding.proxy=t}},{key:lK,get:function(){return this._binding}}]),t}(),UY=ct((zY=kY).prototype,"_binding",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hK}}),BY=zY))||BY,_K=Ec("cc.animation.Channel")((WY=function(){function t(t){this.name="",st(this,"_curve",HY,this),this._curve=t}return Q(t,[{key:"curve",get:function(){return this._curve}}]),t}(),HY=ct((VY=WY).prototype,"_curve",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GY=VY))||GY,dK=Ec("cc.animation.SingleChannelTrack")((YY=function(t){function e(){var e;return st(e=t.call(this)||this,"_channel",qY,rt(e)),e._channel=new _K(e.createCurve()),e}Z(e,t);var n=e.prototype;return n.channels=function(){return[this._channel]},n.createCurve=function(){throw new Error("Not impl")},n[oK]=function(){var t=this._channel.curve;return new pK(t)},Q(e,[{key:"channel",get:function(){return this._channel}}]),e}(fK),qY=ct((XY=YY).prototype,"_channel",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jY=XY))||jY,pK=function(){function t(t){this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t)},t}(),mK=Ec("cc.animation.RealTrack")(KY=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.prototype.createCurve=function(){return new h_},e}(dK))||KY;function gK(t){return 0===t.keyFramesCount?void 0:t}var vK,yK,SK,TK,xK,EK,AK,CK,bK,wK,IK,PK,RK=["X","Y","Z","W"],DK=Ec("cc.animation.VectorTrack")((tK=function(t){function e(){var e;st(e=t.call(this)||this,"_channels",ZY,rt(e)),st(e,"_nComponents",$Y,rt(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new _K(new h_);i.name=RK[n],e._channels[n]=i}return e}Z(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[oK]=function(){switch(this._nComponents){default:case 2:return new OK(gK(this._channels[0].curve),gK(this._channels[1].curve));case 3:return new NK(gK(this._channels[0].curve),gK(this._channels[1].curve),gK(this._channels[2].curve));case 4:return new MK(gK(this._channels[0].curve),gK(this._channels[1].curve),gK(this._channels[2].curve),gK(this._channels[3].curve))}},Q(e,[{key:"componentsCount",get:function(){return this._nComponents},set:function(t){this._nComponents=t}}]),e}(fK),ZY=ct((JY=tK).prototype,"_channels",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$Y=ct(JY.prototype,"_nComponents",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),QY=JY))||QY,OK=function(){function t(t,e){this._result=new Qn,this._x=t,this._y=e}return t.prototype.evaluate=function(t,e){return this._x&&this._y||!e.getValue||Qn.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._result},t}(),NK=function(){function t(t,e,n){this._result=new Dn,this._x=t,this._y=e,this._z=n}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z||!e.getValue||Dn.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._result},t}(),MK=function(){function t(t,e,n,i){this._result=new ti,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||ti.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._w&&(this._result.w=this._w.evaluate(t)),this._result},t}(),LK=Ec("cc.animation.QuatTrack")(vK=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.createCurve=function(){return new J_},n[oK]=function(){return new FK(this.channels()[0].curve)},e}(dK))||vK,FK=function(){function t(t){this._result=new zn,this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t,this._result),this._result},t}(),BK=["Red","Green","Blue","Alpha"],zK=Ec("cc.animation.ColorTrack")((xK=function(t){function e(){var e;st(e=t.call(this)||this,"_channels",TK,rt(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new _K(new h_);i.name=BK[n],e._channels[n]=i}return e}Z(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[oK]=function(){return new UK(gK(this._channels[0].curve),gK(this._channels[1].curve),gK(this._channels[2].curve),gK(this._channels[3].curve))},e}(fK),TK=ct((SK=xK).prototype,"_channels",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yK=SK))||yK,UK=function(){function t(t,e,n,i){this._result=new Pn,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||Pn.copy(this._result,e.getValue()),this._x&&(this._result.r=this._x.evaluate(t)),this._y&&(this._result.g=this._y.evaluate(t)),this._z&&(this._result.b=this._z.evaluate(t)),this._w&&(this._result.a=this._w.evaluate(t)),this._result},t}(),kK=["Width","Height"],GK=Ec("cc.animation.SizeTrack")((bK=function(t){function e(){var e;st(e=t.call(this)||this,"_channels",CK,rt(e)),e._channels=new Array(2);for(var n=0;n<e._channels.length;++n){var i=new _K(new h_);i.name=kK[n],e._channels[n]=i}return e}Z(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[oK]=function(){return new VK(gK(this._channels[0].curve),gK(this._channels[1].curve))},e}(fK),CK=ct((AK=bK).prototype,"_channels",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EK=AK))||EK,VK=function(){function t(t,e){this._result=new ii,this._width=t,this._height=e}return t.prototype.evaluate=function(t,e){if((!this._width||!this._height)&&e.getValue){var n=e.getValue();this._result.x=n.x,this._result.y=n.y}return this._width&&(this._result.width=this._width.evaluate(t)),this._height&&(this._result.height=this._height.evaluate(t)),this._result},t}(),HK=Ec("cc.animation.ObjectTrack")(wK=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.prototype.createCurve=function(){return new sd},e}(dK))||wK,WK=Symbol("[[Owner]]");function jK(t){t[WK]}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER"}(IK||(IK={})),function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(PK||(PK={}));var XK,qK,YK,KK,QK,JK,ZK,$K,tQ,eQ,nQ,iQ,rQ,aQ,oQ,sQ,cQ,lQ,uQ,hQ,fQ,_Q,dQ,pQ,mQ,gQ,vQ,yQ,SQ,TQ,xQ,EQ,AQ,CQ,bQ,wQ,IQ,PQ,RQ,DQ,OQ,NQ,MQ,LQ,FQ,BQ,zQ,UQ,kQ,GQ,VQ,HQ,WQ,jQ,XQ,qQ,YQ,KQ,QQ,JQ,ZQ,$Q,tJ,eJ,nJ,iJ,rJ,aJ=function(){function t(t,e){this.type=void 0,this.resetMode=PK.AFTER_CONSUMED,this._value=void 0,this._refs=[],this.type=t,this._value=e}return t.prototype.bind=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._refs.push({fn:t,thisArg:e,args:i}),this._value},Q(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t;for(var e,n=ot(this._refs);!(e=n()).done;){var i=e.value,r=i.fn,a=i.thisArg,o=i.args;r.call.apply(r,[a,t].concat(o))}}}]),t}(),oJ=function(t){function e(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return Z(e,t),e}(it(Error)),sJ=function(t){function e(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return Z(e,t),e}(it(Error)),cJ=function(t){function e(e,n,i){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=i?i:typeof i)+"'")||this}return Z(e,t),e}(it(Error)),lJ=Symbol("[[createEval]]"),uJ=Symbol("[[Outgoing transitions]]"),hJ=Symbol("[[Incoming transitions]]"),fJ=Ec("cc.animation.State")((KK=function(t){function e(){var e;return st(e=t.call(this)||this,"name",YK,rt(e)),e[uJ]=[],e[hJ]=[],e}return Z(e,t),e}(ll),YK=ct((qK=KK).prototype,"name",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),XK=qK))||XK,_J=Ec("cc.animation.InteractiveState")(($K=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_components",ZK,rt(e)),e}Z(e,t);var n=e.prototype;return n.addComponent=function(t){var e=new t;return this._components.push(e),e},n.removeComponent=function(t){ft(this._components,t)},n.instantiateComponents=function(){return this._components.map((function(t){return Zh(t)}))},Q(e,[{key:"components",get:function(){return this._components}}]),e}(fJ),ZK=ct((JK=$K).prototype,"_components",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QK=JK))||QK,dJ=Ec("cc.animation.Motion")((oQ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"motion",nQ,rt(e)),st(e,"speed",iQ,rt(e)),st(e,"speedMultiplier",rQ,rt(e)),st(e,"speedMultiplierEnabled",aQ,rt(e)),e}return Z(e,t),e.prototype.clone=function(){var t,n,i=new e;return i.motion=null!==(t=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==t?t:null,i.speed=this.speed,i.speedMultiplier=this.speedMultiplier,i.speedMultiplierEnabled=this.speedMultiplierEnabled,i},e}(_J),nQ=ct((eQ=oQ).prototype,"motion",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iQ=ct(eQ.prototype,"speed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rQ=ct(eQ.prototype,"speedMultiplier",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),aQ=ct(eQ.prototype,"speedMultiplierEnabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tQ=eQ))||tQ,pJ=Symbol("[[OnAfterDeserialized]]"),mJ=Ec("cc.animation.Transition")((fQ=function(t){function e(e,n,i){var r;return st(r=t.call(this)||this,"from",lQ,rt(r)),st(r,"to",uQ,rt(r)),st(r,"conditions",hQ,rt(r)),r[WK]=void 0,r.from=e,r.to=n,i&&(r.conditions=i),r}return Z(e,t),e}(ll),lQ=ct((cQ=fQ).prototype,"from",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uQ=ct(cQ.prototype,"to",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hQ=ct(cQ.prototype,"conditions",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sQ=cQ))||sQ,gJ=Ec("cc.animation.AnimationTransition")((yQ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"duration",pQ,rt(e)),st(e,"relativeDuration",mQ,rt(e)),st(e,"exitConditionEnabled",gQ,rt(e)),st(e,"_exitCondition",vQ,rt(e)),e}return Z(e,t),Q(e,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}}]),e}(mJ),pQ=ct((dQ=yQ).prototype,"duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),mQ=ct(dQ.prototype,"relativeDuration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gQ=ct(dQ.prototype,"exitConditionEnabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vQ=ct(dQ.prototype,"_exitCondition",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_Q=dQ))||_Q,vJ=Ec("cc.animation.EmptyState")(SQ=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(fJ))||SQ,yJ=Ec("cc.animation.EmptyStateTransition")((AQ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"duration",EQ,rt(e)),e}return Z(e,t),e}(mJ),EQ=ct((xQ=AQ).prototype,"duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),TQ=xQ))||TQ,SJ=Ec("cc.animation.StateMachine")((OQ=function(t){Z(n,t);var e=n.prototype;function n(){var e;return st(e=t.call(this)||this,"_states",wQ,rt(e)),st(e,"_transitions",IQ,rt(e)),st(e,"_entryState",PQ,rt(e)),st(e,"_exitState",RQ,rt(e)),st(e,"_anyState",DQ,rt(e)),e._entryState=e._addState(new fJ),e._entryState.name="Entry",e._exitState=e._addState(new fJ),e._exitState.name="Exit",e._anyState=e._addState(new fJ),e._anyState.name="Any",e}return e.__callOnAfterDeserializeRecursive=function(){this[pJ]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof TJ&&n.stateMachine.__callOnAfterDeserializeRecursive()}},e[pJ]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[uJ].push(t),t.to[hJ].push(t)}))},e[lJ]=function(){throw new Error("Method not implemented.")},e.states=function(){return this._states},e.transitions=function(){return this._transitions},e.getTransitionsBetween=function(t,e){return jK(t),jK(e),t[uJ].filter((function(t){return t.to===e}))},e.getOutgoings=function(t){return jK(t),t[uJ]},e.getIncomings=function(t){return jK(t),t[hJ]},e.addMotion=function(){return this._addState(new dJ)},e.addSubStateMachine=function(){return this._addState(new TJ)},e.addEmpty=function(){return this._addState(new vJ)},e.remove=function(t){jK(t),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),ft(this._states,t))},e.connect=function(t,e,n){if(jK(t),jK(e),e===this.entryState)throw new oJ("to-entry");if(e===this.anyState)throw new oJ("to-any");if(t===this.exitState)throw new oJ("from-exit");var i=t instanceof dJ||t===this._anyState?new gJ(t,e,n):t instanceof vJ?new yJ(t,e,n):new mJ(t,e,n);return this._transitions.push(i),t[uJ].push(i),e[hJ].push(i),i},e.disconnect=function(t,e){jK(t),jK(e);for(var n=t[uJ],i=e[hJ],r=this._transitions,a=n.filter((function(t){return t.to===e})),o=a.length,s=function(t){var e=a[t];ft(n,e),ft(r,e),_t(i,(function(t){return t===e}))},c=0;c<o;++c)s(c)},e.removeTransition=function(t){ft(this._transitions,t),_t(t.from[uJ],(function(e){return e===t})),_t(t.to[hJ],(function(e){return e===t}))},e.eraseOutgoings=function(t){var e=this;jK(t);for(var n=t[uJ],i=function(t){var i=n[t],r=i.to;ft(e._transitions,i),_t(r[hJ],(function(t){return t===i}))},r=0;r<n.length;++r)i(r);n.length=0},e.eraseIncomings=function(t){var e=this;jK(t);for(var n=t[hJ],i=function(t){var i=n[t],r=i.from;ft(e._transitions,i),_t(r[uJ],(function(t){return t===i}))},r=0;r<n.length;++r)i(r);n.length=0},e.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},e.clone=function(){for(var t,e=new n,i=new Map,r=ot(this._states);!(t=r()).done;){var a=t.value;switch(a){case this._entryState:i.set(a,e._entryState);break;case this._exitState:i.set(a,e._exitState);break;case this._anyState:i.set(a,e._anyState);break;default:if(a instanceof dJ||a instanceof TJ){var o=a.clone();e._addState(o),i.set(a,o)}}}for(var s,c=ot(this._transitions);!(s=c()).done;){var l=s.value,u=i.get(l.from),h=i.get(l.to),f=e.connect(u,h);f.conditions=l.conditions.map((function(t){return t.clone()})),f instanceof gJ&&(f.duration=l.duration,f.exitConditionEnabled=l.exitConditionEnabled,f.exitCondition=l.exitCondition)}return e},e._addState=function(t){return this._states.push(t),t},Q(n,[{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),n}(ll),wQ=ct((bQ=OQ).prototype,"_states",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IQ=ct(bQ.prototype,"_transitions",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PQ=ct(bQ.prototype,"_entryState",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RQ=ct(bQ.prototype,"_exitState",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DQ=ct(bQ.prototype,"_anyState",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CQ=bQ))||CQ,TJ=Ec("cc.animation.SubStateMachine")((FQ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_stateMachine",LQ,rt(e)),e}return Z(e,t),e.prototype.clone=function(){var t=new e;return t._stateMachine=this._stateMachine.clone(),t},Q(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(_J),LQ=ct((MQ=FQ).prototype,"_stateMachine",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new SJ}}),NQ=MQ))||NQ,xJ=Ec("cc.animation.Layer")((HQ=function(){function t(){this[WK]=void 0,st(this,"_stateMachine",UQ,this),st(this,"name",kQ,this),st(this,"weight",GQ,this),st(this,"mask",VQ,this),this._stateMachine=new SJ}return Q(t,[{key:"stateMachine",get:function(){return this._stateMachine}}]),t}(),UQ=ct((zQ=HQ).prototype,"_stateMachine",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kQ=ct(zQ.prototype,"name",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GQ=ct(zQ.prototype,"weight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),VQ=ct(zQ.prototype,"mask",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BQ=zQ))||BQ;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(rJ||(rJ={})),PK.AFTER_CONSUMED;var EJ=Ec("cc.animation.PlainVariable")((YQ=function(){function t(t){if(st(this,"_type",XQ,this),st(this,"_value",qQ,this),void 0!==t)switch(this._type=t,t){default:break;case IK.FLOAT:case IK.INTEGER:this._value=0;break;case IK.BOOLEAN:this._value=!1}}return Q(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),XQ=ct((jQ=YQ).prototype,"_type",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return IK.FLOAT}}),qQ=ct(jQ.prototype,"_value",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WQ=jQ))||WQ,AJ=Ec("cc.animation.TriggerVariable")((ZQ=function(){function t(){st(this,"_flags",JQ,this)}return Q(t,[{key:"type",get:function(){return IK.TRIGGER}},{key:"value",get:function(){return!!((1&this._flags)>>0)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),JQ=ct((QQ=ZQ).prototype,"_flags",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KQ=QQ))||KQ,CJ=Ec("cc.animation.AnimationGraph")((iJ=function(t){function e(){var e;return st(e=t.call(this)||this,"_layers",eJ,rt(e)),st(e,"_variables",nJ,rt(e)),e}Z(e,t);var n=e.prototype;return n.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].stateMachine.__callOnAfterDeserializeRecursive()},n.addLayer=function(){var t=new xJ;return this._layers.push(t),t},n.removeLayer=function(t){ne.removeAt(this._layers,t)},n.moveLayer=function(t,e){!function(t,e,n){if(ae(t,e),ae(t,n),e===n)return t;var i=t[e];if(e<n)for(var r=e+1;r<=n;++r)t[r-1]=t[r];else for(var a=e;a!==n;--a)t[a]=t[a-1];t[n]=i}(this._layers,t,e)},n.addBoolean=function(t,e){void 0===e&&(e=!1);var n=new EJ(IK.BOOLEAN);n.value=e,this._variables[t]=n},n.addFloat=function(t,e){void 0===e&&(e=0);var n=new EJ(IK.FLOAT);n.value=e,this._variables[t]=n},n.addInteger=function(t,e){void 0===e&&(e=0);var n=new EJ(IK.INTEGER);n.value=e,this._variables[t]=n},n.addTrigger=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=PK.AFTER_CONSUMED);var i=new AJ;i.resetMode=n,i.value=e,this._variables[t]=i},n.removeVariable=function(t){delete this._variables[t]},n.getVariable=function(t){return this._variables[t]},Q(e,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),e}(Du),eJ=ct((tJ=iJ).prototype,"_layers",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nJ=ct(tJ.prototype,"_variables",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),$Q=tJ))||$Q,bJ=Symbol("BakeNodeCurves"),wJ=t("SkelAnimDataHub",function(){function t(){}return t.getOrExtract=function(e){var n=t.pool.get(e);if(!n||n.samples!==e.sample){n&&l.director.root.dataPoolManager.releaseAnimationClip(e);var i=Math.ceil(e.sample*e.duration)+1,r=e.sample;n=e[bJ](0,r,i),t.pool.set(e,n)}return n},t.destroy=function(e){t.pool.delete(e)},t}());wJ.pool=new Map;var IJ=t("RatioSampler",function(){function t(t){var e,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var i=!0,r=1,a=t.length;r<a;r++)if(e=t[r]-t[r-1],1===r)n=e;else if(Math.abs(e-n)>1e-6){i=!1;break}this._findRatio=i?OJ:lc}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());l.RatioSampler=IJ;var PJ=t("AnimCurve",function(){function t(e,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=e.values;var i=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=i(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(i);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,a=Object.keys(e.easingMethods);r<a.length;r++){var o=a[r];this.types[o]=i(e.easingMethods[o])}}else this.type=null;var s=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=GJ(s)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*t+n];return this._array},e.valueBetween=function(t,e,n,i,r){if(this._lerp){var a=this.types?this.types[e]:this.type,o=r-n,s=(t-n)/o;if(a&&(s=DJ(s,a)),void 0===this._array){var c=this._values[e],l=this._values[i];return this._lerp(c,l,s,o*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*e+u],f=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,f,s,o*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var _=0;_<this._array.length;++_)this._array[_]=this._values[this._array.length*e+_];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function RJ(t,e,n){var i=e.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=e.ratios.length))return t.valueBetween(n,i-1,e.ratios[i-1],i,e.ratios[i]);i=e.ratios.length-1}return t.valueAt(i)}function DJ(t,e){if("string"==typeof e){var n=t_[e];n?t=n(t):O(3906,e)}else Array.isArray(e)&&(t=q_(e,t));return t}function OJ(t,e){var n=t.length-1;if(0===n)return 0;var i=t[0];if(e<i)return 0;var r=t[n];if(e>r)return n;var a=(e=(e-i)/(r-i))/(1/n),o=0|a,s=1e-6;return a-o<s?o:o+1-a<s?o+1:~(o+1)}PJ.Linear=null,l.AnimCurve=PJ,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),l.sampleAnimationCurve=RJ;var NJ,MJ,LJ,FJ,BJ,zJ,UJ,kJ,GJ=function(){function t(t,e,n,i){return t.lerp(e,n,i)}return function(e){if(null!==e){if("number"==typeof e)return fn;if("object"==typeof e&&e.constructor){if(e instanceof zn)return n=new zn,function(t,e,i){return zn.slerp(n,t,e,i)};if(e instanceof ue)return function(t){var e=new t;return function(n,i,r){return t.lerp(e,n,i,r),e}}(e.constructor);if(e.constructor===Number)return fn;if("function"==typeof e.lerp)return t}var n}}}(),VJ=Ec("cc.animation.UntypedTrackChannel")((FJ=function(t){function e(){var e;return st(e=t.call(this,new h_)||this,"property",LJ,rt(e)),e}return Z(e,t),e}(_K),LJ=ct((MJ=FJ).prototype,"property",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),NJ=MJ))||NJ,HJ=Ec("cc.animation.UntypedTrack")((kJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_channels",UJ,rt(e)),e}Z(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[oK]=function(t){var e=this;if(!t.getValue)throw new Error(F(3930));var n=function(t){var n;return null===(n=e._channels.find((function(e){return e.property===t})))||void 0===n?void 0:n.curve},i=t.getValue();switch(!0){default:throw new Error(F(3931));case i instanceof Qn:return new OK(n("x"),n("y"));case i instanceof Dn:return new NK(n("x"),n("y"),n("z"));case i instanceof ti:return new MK(n("x"),n("y"),n("z"),n("w"));case i instanceof Pn:return new UK(n("r"),n("g"),n("b"),n("a"));case i instanceof ii:return new VK(n("width"),n("height"))}},n.addChannel=function(t){var e=new VJ;return e.property=t,this._channels.push(e),e},n.upgrade=function(t){var e=this,n=function(t,n){var i=e.channels().find((function(e){return e.property===t}));i&&(n.name=i.name,n.curve.assignSorted(Array.from(i.curve.times()),Array.from(i.curve.values())))},i=t(this.path,this.proxy);switch(i){default:break;case"vec2":case"vec3":case"vec4":var r=new DK;r.path=this.path,r.proxy=this.proxy,r.componentsCount="vec2"===i?2:"vec3"===i?3:4;var a=r.channels(),o=a[0],s=a[1],c=a[2],l=a[3];switch(i){case"vec4":n("w",l);case"vec3":n("z",c);default:case"vec2":n("x",o),n("y",s)}return r;case"color":var u=new zK,h=u.channels(),f=h[0],_=h[1],d=h[2],p=h[3];return n("r",f),n("g",_),n("b",d),n("a",p),n("x",f),n("y",_),n("z",d),n("w",p),u;case"size":}return null},e}(fK),UJ=ct((zJ=kJ).prototype,"_channels",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BJ=zJ))||BJ,WJ=function(){function t(t){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=t}var e=t.prototype;return e.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},e.toTracks=function(){for(var t,e=[],n=this.keys,i=this.curves,r=this.commonTargets,a=function(t,e,n){for(var i,r=new uK,a=ot(e);!(i=a()).done;){var o=i.value;"string"==typeof o?r.toProperty(o):"number"==typeof o?r.toElement(o):o instanceof TY?r.toHierarchy(o.path):o instanceof xY?r.toComponent(o.component):r.toCustomized(o)}t.path=r,t.proxy=n},o=r.map((function(t){var n=new HJ;return a(n,t.modifiers,t.valueAdapter),e.push(n),n})),s=function(){var i,r=t.value,s=r.data,c=s.values;if(0===c.length)return"continue";var l=s.keys<0?[0]:n[s.keys],u=c[0],h=null===(i=s.interpolate)||void 0===i||i;s._arrayLength;var f=new XJ(s,l.length),_=function(t){a(t,r.modifiers,r.valueAdapter)},d=void 0;if("number"==typeof r.commonTarget){if(!c.every((function(t){return"number"==typeof t})))return R(3932),"continue";if(r.valueAdapter||1!==r.modifiers.length||"string"!=typeof r.modifiers[0])return R(3933),"continue";var p=r.modifiers[0],m=o[r.commonTarget].addChannel(p).curve;d=m}!function(){if("number"==typeof u){if(!c.every((function(t){return"number"==typeof t})))return void R(3934);var t;if(d)t=d;else{var n=new mK;_(n),e.push(n),t=n.channel.curve}var i=h?uc.LINEAR:uc.CONSTANT;return t.assignSorted(l,c.map((function(t){return{value:t,interpolationMode:i}}))),void f.convert(t)}if("object"==typeof u)switch(!0){default:break;case jJ(c,Qn):case jJ(c,Dn):case jJ(c,ti):var r=u instanceof Qn?2:u instanceof Dn?3:4,a=new DK;_(a),a.componentsCount=r;var o=a.channels(),s=o[0].curve,p=o[1].curve,m=o[2].curve,g=o[3].curve,v=h?uc.LINEAR:uc.CONSTANT,y=function(t){return{value:t,interpolationMode:v}};switch(r){case 4:g.assignSorted(l,c.map((function(t){return y(t.w)}))),f.convert(g);case 3:m.assignSorted(l,c.map((function(t){return y(t.z)}))),f.convert(m);default:s.assignSorted(l,c.map((function(t){return y(t.x)}))),f.convert(s),p.assignSorted(l,c.map((function(t){return y(t.y)}))),f.convert(p)}return void e.push(a);case jJ(c,zn):var S=new LK;_(S);var T=h?k_.SLERP:k_.CONSTANT;return S.channel.curve.assignSorted(l,c.map((function(t){return{value:zn.clone(t),interpolationMode:T}}))),f.convertQuatCurve(S.channel.curve),void e.push(S);case jJ(c,Pn):var x=new zK;_(x);var E=x.channels(),A=E[0].curve,C=E[1].curve,b=E[2].curve,w=E[3].curve,I=h?uc.LINEAR:uc.CONSTANT,P=function(t){return{value:t,interpolationMode:I}};return A.assignSorted(l,c.map((function(t){return P(t.r)}))),f.convert(A),C.assignSorted(l,c.map((function(t){return P(t.g)}))),f.convert(C),b.assignSorted(l,c.map((function(t){return P(t.b)}))),f.convert(b),w.assignSorted(l,c.map((function(t){return P(t.a)}))),f.convert(w),void e.push(x);case jJ(c,ii):var D=new GK;_(D);var O=D.channels(),N=O[0].curve,M=O[1].curve,L=h?uc.LINEAR:uc.CONSTANT,F=function(t){return{value:t,interpolationMode:L}};return N.assignSorted(l,c.map((function(t){return F(t.width)}))),f.convert(N),M.assignSorted(l,c.map((function(t){return F(t.height)}))),f.convert(M),void e.push(D);case jJ(c,aK):var B=new mK;_(B);var z=h?uc.CUBIC:uc.CONSTANT;return B.channel.curve.assignSorted(l,c.map((function(t){return{value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:z}}))),void e.push(B);case jJ(c,eK):case jJ(c,nK):case jJ(c,iK):var U=u instanceof eK?2:u instanceof nK?3:4,k=new DK;_(k),k.componentsCount=U;var G=k.channels(),V=G[0],H=G[1],W=G[2],j=G[3],X=h?uc.LINEAR:uc.CONSTANT,q=function(t,e,n){return{value:t,leftTangent:e,rightTangent:n,interpolationMode:X}};switch(U){case 4:j.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.w,t.inTangent.w,t.outTangent.w)})));case 3:W.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.z,t.inTangent.z,t.outTangent.z)})));default:V.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.y,t.inTangent.y,t.outTangent.y)}))),H.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.x,t.inTangent.x,t.outTangent.x)})))}return void e.push(k);case c.every((function(t){return t instanceof rK})):R(3935)}var Y=new HK;_(Y),Y.channel.curve.assignSorted(l,c),e.push(Y)}()},c=ot(i);!(t=c()).done;)s();return e},e._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new IJ(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new PJ(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}}))},Q(t,[{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}},{key:"data",get:function(){return this._data}}]),t}();function jJ(t,e){return t.every((function(t){return t instanceof e}))}var XJ=function(){function t(t,e){this._easingMethods=void 0;var n=t.easingMethods;Array.isArray(n)?0===n.length&&0!==e?this._easingMethods=new Array(e).fill(null):this._easingMethods=n:this._easingMethods=void 0===n?new Array(e).fill(t.easingMethod):Array.from({length:e},(function(t,e){var i;return null!==(i=n[e])&&void 0!==i?i:null}))}var e=t.prototype;return e.convert=function(t){var e,n,i,r,a,o,s,c,l,u,h,f,_,d,p,m,g,v,y,S,T,x,E=this._easingMethods;if(E){var A=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(E)&&E.length;for(var C=A-1,b=0;b<C;++b){var w=E[b];w&&(Array.isArray(w)?(e=w,n=t.getKeyframeTime(b),i=t.getKeyframeValue(b),r=t.getKeyframeTime(b+1),a=t.getKeyframeValue(b+1),o=void 0,s=void 0,c=void 0,l=void 0,u=void 0,h=void 0,f=void 0,_=void 0,d=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,S=void 0,T=void 0,x=void 0,s=e[0],c=e[1],l=e[2],u=e[3],h=i.value,f=3*(r-n),_=3*(a.value-h),m=(1-l)*f,g=(1-u)*_,v=1/3,y=(p=c*_)/(d=s*f),S=Math.sqrt(d*d+p*p)*v,T=g/m,x=Math.sqrt(m*m+g*g)*v,i.interpolationMode=uc.CUBIC,i.tangentWeightMode=(o=i.tangentWeightMode)===fc.NONE?fc.RIGHT:o===fc.LEFT?fc.BOTH:o,i.rightTangent=y,i.rightTangentWeight=S,a.tangentWeightMode=function(t){return t===fc.NONE?fc.LEFT:t===fc.RIGHT?fc.BOTH:t}(a.tangentWeightMode),a.leftTangent=T,a.leftTangentWeight=x):qJ(w,t,b))}}}},e.convertQuatCurve=function(t){var e=this._easingMethods;if(e){var n=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(e)&&e.length;for(var i=n-1,r=0;r<i;++r){var a=e[r];a&&(Array.isArray(a)?t.getKeyframeValue(r).easingMethod=a.slice():YJ(a,t,r))}}}},Q(t,[{key:"nil",get:function(){return!this._easingMethods||this._easingMethods.every((function(t){return null==t}))}}]),t}();function qJ(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=AZ[t];r===$f.CONSTANT?i.interpolationMode=uc.CONSTANT:(i.interpolationMode=uc.LINEAR,i.easingMethod=r)}function YJ(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=AZ[t];i.easingMethod=r}var KJ,QJ,JJ,ZJ,$J,tZ,eZ,nZ,iZ,rZ,aZ,oZ,sZ,cZ,lZ,uZ,hZ,fZ,_Z,dZ,pZ,mZ,gZ,vZ,yZ,SZ,TZ,xZ,EZ,AZ={constant:$f.CONSTANT,linear:$f.LINEAR,quadIn:$f.QUAD_IN,quadOut:$f.QUAD_OUT,quadInOut:$f.QUAD_IN_OUT,quadOutIn:$f.QUAD_OUT_IN,cubicIn:$f.CUBIC_IN,cubicOut:$f.CUBIC_OUT,cubicInOut:$f.CUBIC_IN_OUT,cubicOutIn:$f.CUBIC_OUT_IN,quartIn:$f.QUART_IN,quartOut:$f.QUART_OUT,quartInOut:$f.QUART_IN_OUT,quartOutIn:$f.QUART_OUT_IN,quintIn:$f.QUINT_IN,quintOut:$f.QUINT_OUT,quintInOut:$f.QUINT_IN_OUT,quintOutIn:$f.QUINT_OUT_IN,sineIn:$f.SINE_IN,sineOut:$f.SINE_OUT,sineInOut:$f.SINE_IN_OUT,sineOutIn:$f.SINE_OUT_IN,expoIn:$f.EXPO_IN,expoOut:$f.EXPO_OUT,expoInOut:$f.EXPO_IN_OUT,expoOutIn:$f.EXPO_OUT_IN,circIn:$f.CIRC_IN,circOut:$f.CIRC_OUT,circInOut:$f.CIRC_IN_OUT,circOutIn:$f.CIRC_OUT_IN,elasticIn:$f.ELASTIC_IN,elasticOut:$f.ELASTIC_OUT,elasticInOut:$f.ELASTIC_IN_OUT,elasticOutIn:$f.ELASTIC_OUT_IN,backIn:$f.BACK_IN,backOut:$f.BACK_OUT,backInOut:$f.BACK_IN_OUT,backOutIn:$f.BACK_OUT_IN,bounceIn:$f.BOUNCE_IN,bounceOut:$f.BOUNCE_OUT,bounceInOut:$f.BOUNCE_IN_OUT,bounceOutIn:$f.BOUNCE_OUT_IN,smooth:$f.SMOOTH,fade:$f.FADE};function CZ(){throw new Error("split() only valid in Editor.")}Ec("cc.animation.ExoticAnimation")((JJ=function(){function t(){st(this,"_nodeAnimations",QJ,this)}var e=t.prototype;return e.createEvaluator=function(t){return new LZ(this._nodeAnimations,t)},e.addNodeAnimation=function(t){var e=new bZ(t);return this._nodeAnimations.push(e),e},e.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map((function(t){return t.path}))))},e.split=function(){return CZ()},e.toHashString=function(){return this._nodeAnimations.map((function(t){return t.toHashString()})).join("\n")},t}(),QJ=ct((KJ=JJ).prototype,"_nodeAnimations",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KJ));var bZ=Ec("cc.animation.ExoticNodeAnimation")((rZ=function(){function t(t){st(this,"_path",tZ,this),st(this,"_position",eZ,this),st(this,"_rotation",nZ,this),st(this,"_scale",iZ,this),this._path=t}var e=t.prototype;return e.createPosition=function(t,e){this._position=new OZ(t,new RZ(e))},e.createRotation=function(t,e){this._rotation=new OZ(t,new DZ(e))},e.createScale=function(t,e){this._scale=new OZ(t,new RZ(e))},e.createEvaluator=function(t){return new FZ(this._path,this._position,this._rotation,this._scale,t)},e.split=function(){return CZ()},e.toHashString=function(){var t,e,n,i,r,a;return this._path+"\n"+(null!==(t=null===(e=this._position)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"")+(null!==(n=null===(i=this._scale)||void 0===i?void 0:i.toHashString())&&void 0!==n?n:"")+(null!==(r=null===(a=this._rotation)||void 0===a?void 0:a.toHashString())&&void 0!==r?r:"")},Q(t,[{key:"path",get:function(){return this._path}}]),t}(),tZ=ct(($J=rZ).prototype,"_path",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eZ=ct($J.prototype,"_position",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nZ=ct($J.prototype,"_rotation",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iZ=ct($J.prototype,"_scale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZJ=$J))||ZJ;function wZ(t){return t.toPrecision(2)}function IZ(t){return t.map(wZ).join(" ")}var PZ=Ec("cc.animation.ExoticVectorLikeTrackValues")((lZ=function(){function t(t){st(this,"_values",sZ,this),st(this,"_isQuantized",cZ,this),this._values=t,this._isQuantized=!1}var e=t.prototype;return e.quantize=function(t){this._isQuantized,this._values=function(t,e){var n=zZ[e],i=1<<n.BYTES_PER_ELEMENT,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;t.forEach((function(t){r=Math.min(t,r),a=Math.max(t,a)}));var o=a-r,s=n.from(t,(function(t){return(t-r)/o*i}));return new $Z(UZ(t),s,o,r)}(this._values,t),this._isQuantized=!0},e.toHashString=function(){var t=this._isQuantized,e=this._values;return t+" "+(t?e.toHashString():IZ(e))},Q(t,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:UZ(this._values)}}]),t}(),sZ=ct((oZ=lZ).prototype,"_values",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cZ=ct(oZ.prototype,"_isQuantized",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aZ=oZ))||aZ,RZ=Ec("cc.animation.ExoticVec3TrackValues")(uZ=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?n$(n,t,e):Dn.fromArray(e,n,3*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(n$(o,t,i),n$(o,e,r)):(Dn.fromArray(i,o,3*t),Dn.fromArray(r,o,3*e)),Dn.lerp(a,i,r,n)},e}(PZ))||uZ,DZ=Ec("cc.animation.ExoticQuatTrackValues")(hZ=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?i$(n,t,e):zn.fromArray(e,n,4*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(i$(o,t,i),i$(o,e,r)):(zn.fromArray(i,o,4*t),zn.fromArray(r,o,4*e)),zn.slerp(a,i,r,n)},e}(PZ))||hZ,OZ=Ec("cc.animation.ExoticTrack")((mZ=function(){function t(t,e){st(this,"times",dZ,this),st(this,"values",pZ,this),this.times=t,this.values=e}return t.prototype.toHashString=function(){var t=this.times,e=this.values;return"times: "+IZ(t)+"; values: "+e.toHashString()},t}(),dZ=ct((_Z=mZ).prototype,"times",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pZ=ct(_Z.prototype,"values",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fZ=_Z))||fZ;function NZ(t,e){t.length,t.length;var n=0,i=0,r=lc(t,e);if(r>=0)n=r;else{var a=~r,o=a-1;n=o;var s=t[a],c=t[o];i=(e-c)/(s-c)}return{index:n,ratio:i}}!function(){function t(){this._reset()}var e=t.prototype;e.transformTime=function(t){return t-this._timeOffset},e.calculate=function(t,e,n){this._reset();var i=t.length;if(i){var r=t[0],a=t[i-1],o=un(e,r,a),s=un(n,r,a);this._timeOffset=o;var c=function(t,e,n){var i=t.length;n>=e&&e>=t[0]&&t[i-1];var r=NZ(t,e),a=r.index,o=r.ratio,s=NZ(t,n);return{fromIndex:a,fromRatio:o,toIndex:s.index,toRatio:s.ratio}}(t,o,s),l=c.fromIndex,u=c.fromRatio,h=c.toIndex,f=c.toRatio,_=!u,d=!f;l!==h||u!==f?(_||(this.preLerpIndex=l,this.preLerpRatio=u),this.directKeyframesBegin=_?l:l+1,this.directKeyframesEnd=h+1,d||(this.postLerpIndex=h,this.postLerpRatio=f)):_?(this.directKeyframesBegin=l,this.directKeyframesEnd=l+1):(this.preLerpIndex=l,this.preLerpRatio=u)}},e._reset=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0,this._timeOffset=0},Q(t,[{key:"keyframesCount",get:function(){var t=this.preLerpIndex,e=this.directKeyframesBegin;return 0+(t<0?0:1)+(this.directKeyframesEnd-e)+(this.postLerpIndex<0?0:1)}}])}();var MZ,LZ=function(){function t(t,e){this._nodeEvaluations=void 0,this._nodeEvaluations=t.map((function(t){return t.createEvaluator(e)}))}return t.prototype.evaluate=function(t){this._nodeEvaluations.forEach((function(e){e.evaluate(t)}))},t}(),FZ=function(){function t(t,e,n,i,r){this._position=null,this._rotation=null,this._scale=null,e&&(this._position=e$(e.times,e.values,Dn,t,"position",r)),n&&(this._rotation=e$(n.times,n.values,zn,t,"rotation",r)),i&&(this._scale=e$(i.times,i.values,Dn,t,"scale",r))}return t.prototype.evaluate=function(t){if(this._position){var e=this._position.evaluator.evaluate(t);this._position.runtimeBinding.setValue(e)}if(this._rotation){var n=this._rotation.evaluator.evaluate(t);this._rotation.runtimeBinding.setValue(n)}if(this._scale){var i=this._scale.evaluator.evaluate(t);this._scale.runtimeBinding.setValue(i)}},t}(),BZ=function(){function t(t,e,n){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=t,this._values=e,this._prevValue=new n,this._nextValue=new n,this._resultValue=new n}return t.prototype.evaluate=function(t){var e=this._times,n=this._values,i=this._resultValue;if(0===e.length)return i;var r=function(t,e,n){var i=t.length,r=t[0],a=t[i-1];if(e<r)n.just=!0,n.index=0;else if(e>a)n.just=!0,n.index=i-1;else{var o=lc(t,e);if(o>=0)n.just=!0,n.index=o;else{var s=~o,c=s-1,l=t[c],u=t[s],h=(e-t[c])/(u-l);n.just=!1,n.index=c,n.nextIndex=s,n.ratio=h}}return n}(e,t,this._inputSampleResultCache);return r.just?n.get(r.index,i):n.lerp(r.index,r.nextIndex,r.ratio,this._prevValue,this._nextValue,i),i},t}(),zZ={uint8:Uint8Array,uint16:Uint16Array};function UZ(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return MZ.FLOAT_32;case 8:return MZ.FLOAT_64}}!function(t){t[t.FLOAT_32=0]="FLOAT_32",t[t.FLOAT_64=1]="FLOAT_64"}(MZ||(MZ={}));var kZ,GZ,VZ,HZ,WZ,jZ,XZ,qZ,YZ,KZ,QZ,JZ,ZZ,$Z=Ec("cc.animation.QuantizedFloatArray")((EZ=function(){function t(t,e,n,i){void 0===i&&(i=0),st(this,"originalPrecision",yZ,this),st(this,"min",SZ,this),st(this,"extent",TZ,this),st(this,"values",xZ,this),this.originalPrecision=t,this.values=e,this.extent=n,this.min=i}return t.prototype.toHashString=function(){var t=this.originalPrecision,e=this.min,n=this.extent,i=this.values;return t+" "+wZ(e)+" "+wZ(n)+" "+i.join(" ")},Q(t,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t}(),yZ=ct((vZ=EZ).prototype,"originalPrecision",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SZ=ct(vZ.prototype,"min",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TZ=ct(vZ.prototype,"extent",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xZ=ct(vZ.prototype,"values",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gZ=vZ))||gZ;function t$(t,e){return t.values[e]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function e$(t,e,n,i,r,a){var o=new hK;o.path=(new uK).toHierarchy(i).toProperty(r);var s=a(o);return s?{runtimeBinding:s,evaluator:new BZ(t,e,n)}:null}function n$(t,e,n){Dn.set(n,t$(t,3*e+0),t$(t,3*e+1),t$(t,3*e+2))}function i$(t,e,n){zn.set(n,t$(t,4*e+0),t$(t,4*e+1),t$(t,4*e+2),t$(t,4*e+3))}function r$(){return l.director.getAnimationManager()}var a$=Symbol("SearchForRootBonePath"),o$=Symbol("ExoticAnimation"),s$=t("AnimationClip",Ec("cc.AnimationClip")((ZZ=JZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"sample",VZ,rt(e)),st(e,"speed",HZ,rt(e)),st(e,"wrapMode",WZ,rt(e)),st(e,"enableTrsBlending",jZ,rt(e)),st(e,"_duration",XZ,rt(e)),st(e,"_hash",qZ,rt(e)),e.frameRate=0,st(e,"_tracks",YZ,rt(e)),st(e,"_exoticAnimation",KZ,rt(e)),e._legacyData=void 0,e._legacyDataDirty=!1,st(e,"_events",QZ,rt(e)),e._runtimeEvents={ratios:[],eventGroups:[]},e}Z(e,t),e.createWithSpriteFrames=function(t,n){var i=new e;i.sample=n||i.sample,i.duration=t.length/i.sample;var r=1/i.sample,a=new HK;return a.path=(new uK).toComponent("cc.Sprite").toProperty("spriteFrame"),a.channels()[0].curve.assignSorted(t.map((function(t,e){return[r*e,t]}))),i.addTrack(a),i};var n=e.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this.events=this._events},n.range=function(){for(var t={min:1/0,max:-1/0},e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i].range();t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max)}return t},n.getTrack=function(t){return this._tracks[t]},n.addTrack=function(t){var e=this._tracks.length;return this._tracks.push(t),e},n.removeTrack=function(t){this._tracks.splice(t,1)},n.clearTracks=function(){this._tracks.length=0},n.createEventEvaluator=function(t){return new p$(t,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)},n.createEvaluator=function(t){var e=this,n=t.target;return this._createEvalWithBinder(n,(function(i){if(!t.mask||!i.isMaskedOff(t.mask)){var r=i.createRuntimeBinding(n,e.enableTrsBlending?t.pose:void 0,!1);return null!=r?r:void 0}}),t.rootMotion)},n.destroy=function(){var e;return(null===(e=l.director.root)||void 0===e?void 0:e.dataPoolManager)&&l.director.root.dataPoolManager.releaseAnimationClip(this),wJ.destroy(this),t.prototype.destroy.call(this)},n[bJ]=function(t,e,n){for(var i=1/e,r=this._collectAnimatedJoints(),a=r.length,o={},s=0;s<a;++s)o[r[s]]={transforms:Array.from({length:n},(function(){return new Xn}))};var c=r.reduce((function(t,e){return t[e]=new u$,t}),{});for(var l in c){var u=c[l],h=l.lastIndexOf("/");if(h>=0){var f=l.substring(0,h),_=c[f];_&&(u.parent=_)}}for(var d=this._createEvalWithBinder(void 0,(function(t){var e=t.parseTrsPath();if(e){var n=c[e.node];if(n)return d$(n,e.property)}}),void 0),p=0;p<n;++p){var m=t+i*p;d.evaluate(m);for(var g=0;g<a;++g){var v=r[g];Xn.copy(o[v].transforms[p],c[v].globalTransform)}for(var y=0;y<a;++y){var S=r[y];c[S].invalidate()}}return{samples:e,frames:n,joints:o}},n.upgradeUntypedTracks=function(t){for(var e=[],n=[],i=this._tracks,r=i.length,a=0;a<r;++a){var o=i[a];if(o instanceof HJ){var s=o.upgrade(t);s&&(e.push(s),n.push(o))}}for(var c=n.length,l=0;l<c;++l)ne.remove(i,n[l]);i.push.apply(i,e)},n[a$]=function(){return this._searchForRootBonePath()},n.getPropertyCurves=function(){return this._getLegacyData().getPropertyCurves()},n.updateEventDatas=function(){this.events=this._events},n.hasEvents=function(){return 0!==this.events.length},n.syncLegacyData=function(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)},n._createEvalWithBinder=function(t,e,n){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());var i,r=[];n&&(i=this._createRootMotionEvaluation(t,n,r));for(var a,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var u=s[l];if(!r.includes(u)&&!Array.from(u.channels()).every((function(t){return 0===t.curve.keyFramesCount}))){var h=e(u[lK]);if(h){var f=u[oK](h);o.push({binding:h,trackEval:f})}}}return this._exoticAnimation&&(a=this._exoticAnimation.createEvaluator(e)),new c$(o,a,i)},n._createRootMotionEvaluation=function(t,e,n){if(t instanceof ob){var i=this._searchForRootBonePath();if(i){var r=t.getChildByPath(i);if(r){for(var a=new l$,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var u=s[l],h=u[lK].parseTrsPath();if(h&&h.node===i){n.push(u);var f=d$(a,h.property);if(f){var _=u[oK](f);o.push({binding:f,trackEval:_})}}}return new f$(r,this._duration,a,o)}R(3924)}else R(3923)}else O(3920)},n._searchForRootBonePath=function(){var t=this._tracks.map((function(t){var e=t[lK].parseTrsPath();if(e){var n=e.node;return{path:n,rank:n.split("/").length}}return{path:"",rank:0}}));t.sort((function(t,e){return t.rank-e.rank}));var e=t.findIndex((function(t){return 0!==t.rank}));if(e<0)return"";for(var n=t.length,i=t[e],r=!0,a=e+1;a<n;++a){var o=t[a];if(o.rank!==i.rank)break;if(o.path!==i.path){r=!1;break}}return r?i.path:""},n._getLegacyData=function(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData},n._toLegacy=function(){var t=new WJ(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t},n._fromLegacy=function(t){for(var e=t.toTracks(),n=e.length,i=0;i<n;++i)this.addTrack(e[i])},n._collectAnimatedJoints=function(){for(var t=new Set,e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i][lK].parseTrsPath();r&&t.add(r.node)}if(this._exoticAnimation)for(var a=this._exoticAnimation.collectAnimatedJoints(),o=a.length,s=0;s<o;++s)t.add(a[s]);return Array.from(t)},Q(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var t,e;if(this._hash)return this._hash;var n="Exotic:"+(null!==(t=null===(e=this._exoticAnimation)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"");return this._hash=Sa(n,666)}},{key:"events",get:function(){return this._events},set:function(t){var e=this;this._events=t;for(var n=[],i=[],r=this.events.sort((function(t,e){return t.frame-e.frame})),a=r.length,o=function(t){var a=r[t],o=a.frame/e._duration,s=n.findIndex((function(t){return t===o}));s<0&&(s=n.length,n.push(o),i.push({events:[]})),i[s].events.push({functionName:a.func,parameters:a.params})},s=0;s<a;++s)o(s);this._runtimeEvents={ratios:n,eventGroups:i}}},{key:o$,get:function(){return this._exoticAnimation}},{key:o$,set:function(t){this._exoticAnimation=t}},{key:"keys",get:function(){return this._getLegacyData().keys}},{key:"keys",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().keys=t}},{key:"curves",get:function(){return this._legacyDataDirty=!0,this._getLegacyData().curves}},{key:"curves",set:function(t){this._getLegacyData().curves=t}},{key:"commonTargets",get:function(){return this._getLegacyData().commonTargets}},{key:"commonTargets",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=t}},{key:"data",get:function(){return this._getLegacyData().data}},{key:"eventGroups",get:function(){return this._runtimeEvents.eventGroups}}]),e}(Du),JZ.WrapMode=nc,VZ=ct((GZ=ZZ).prototype,"sample",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),HZ=ct(GZ.prototype,"speed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),WZ=ct(GZ.prototype,"wrapMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nc.Normal}}),jZ=ct(GZ.prototype,"enableTrsBlending",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),XZ=ct(GZ.prototype,"_duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qZ=ct(GZ.prototype,"_hash",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YZ=ct(GZ.prototype,"_tracks",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KZ=ct(GZ.prototype,"_exoticAnimation",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QZ=ct(GZ.prototype,"_events",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kZ=GZ))||kZ);l.AnimationClip=s$;var c$=function(){function t(t,e,n){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=t,this._exoticAnimationEvaluator=e,this._rootMotionEvaluation=n}var e=t.prototype;return e.evaluate=function(t){for(var e=this._trackEvalStatues,n=this._exoticAnimationEvaluator,i=e.length,r=0;r<i;++r){var a=e[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}n&&n.evaluate(t)},e.evaluateRootMotion=function(t,e){var n=this._rootMotionEvaluation;n&&n.evaluate(t,e)},t}(),l$=function(){function t(){this.position=new Dn,this.scale=new Dn(1,1,1),this.rotation=new zn,this.eulerAngles=new Dn}return t.prototype.getTransform=function(t){Xn.fromRTS(t,this.rotation,this.position,this.scale)},t}(),u$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).parent=null,e._dirty=!0,e._transform=new Xn,e}return Z(e,t),e.prototype.invalidate=function(){this._dirty=!0},Q(e,[{key:"globalTransform",get:function(){var t=this._transform;return this._dirty&&(this._dirty=!1,Xn.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&Xn.multiply(t,this.parent.globalTransform,t)),this._transform}}]),e}(l$),h$=new Xn,f$=function(){function t(t,e,n,i){this._initialTransformCache=new Xn,this._clipEndTransformCache=new Xn,this._startTransformCache=new Xn,this._endTransformCache=new Xn,this._motionTransformCache=new Xn,this._translationMotionCache=new Dn,this._rotationMotionCache=new zn,this._scaleMotionCache=new Dn,this._rootBone=t,this._duration=e,this._boneTransform=n,this._trackEvalStatuses=i}var e=t.prototype;return e.evaluate=function(t,e){var n=this._calcMotionTransform(t,e,this._motionTransformCache),i=this._translationMotionCache,r=this._rotationMotionCache,a=this._scaleMotionCache,o=this._rootBone;Xn.toRTS(n,r,i,a),Dn.add(i,i,o.position),o.setPosition(i),zn.multiply(r,r,o.rotation),o.setRotation(r),Dn.multiply(a,a,o.scale),o.setScale(a)},e._calcMotionTransform=function(t,e,n){var i=this._duration,r=i-t,a=this._evaluateAt(t,this._startTransformCache);if(e<r){var o=this._evaluateAt(t+e,this._endTransformCache);_$(n,a,o)}else{Xn.identity(n);var s=function(t,e){_$(h$,t,e),Xn.multiply(n,n,h$)},c=e-r,l=Math.floor(c/i),u=c-l*i,h=this._evaluateAt(0,this._initialTransformCache),f=this._evaluateAt(i,this._clipEndTransformCache),_=this._evaluateAt(u,this._endTransformCache);s(a,f),_$(h$,h,f);for(var d=0;d<l;++d)Xn.multiply(n,n,h$);s(h,_)}return n},e._evaluateAt=function(t,e){for(var n=this._trackEvalStatuses,i=n.length,r=0;r<i;++r){var a=n[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}return this._boneTransform.getTransform(e),e},t}();function _$(t,e,n){Xn.invert(t,e),Xn.multiply(t,n,t)}function d$(t,e){switch(e){default:return;case"position":return{setValue:function(e){Dn.copy(t.position,e)}};case"rotation":return{setValue:function(e){zn.copy(t.rotation,e)}};case"scale":return{setValue:function(e){Dn.copy(t.scale,e)}};case"eulerAngles":return{setValue:function(e){Dn.copy(t.eulerAngles,e)}}}}var p$=function(){function t(t,e,n,i){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=t,this._ratios=e,this._eventGroups=n,this._wrapMode=i}var e=t.prototype;return e.setWrapMode=function(t){this._wrapMode=t},e.ignore=function(t,e){this._ignoreIndex=-1,this._sampled=!1;var n=g$(t,this._ratios);n<0&&(n=~n-1,e<0&&(n+=1),this._ignoreIndex=n)},e.sample=function(t,e,n){var i=this._eventGroups.length,r=g$(t,this._ratios);if(r<0&&(r=~r-1,e<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(r,!1),this._lastFrameIndex=r,this._lastIterations=n,void(this._lastDirection=e);var a=this._wrapMode,o=m$(n),s=m$(this._lastIterations),c=this._lastFrameIndex,l=this._lastDirection,u=-1!==s&&o!==s;if(c===r&&u&&1===i)this._doFire(0,!1);else if(c!==r||u){e=l;do{if(c!==r){if(-1===e&&0===c&&r>0?((a&ec.PingPong)===ec.PingPong?e*=-1:c=i,s++):1===e&&c===i-1&&r<i-1&&((a&ec.PingPong)===ec.PingPong?e*=-1:c=-1,s++),c===r)break;if(s>o)break}c+=e,this._doFire(c,!0)}while(c!==r&&c>-1&&c<i)}this._lastFrameIndex=r,this._lastIterations=n,this._lastDirection=e},e._doFire=function(t,e){e?r$().pushDelayEvent(this._checkAndFire,this,[t]):this._checkAndFire(t)},e._checkAndFire=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var n=e[t],i=this._targetNode.components,r=n.events.length,a=0;a<r;++a)for(var o=n.events[a],s=o.functionName,c=i.length,l=0;l<c;++l){var u=i[l],h=u[s];"function"==typeof h&&h.apply(u,o.parameters)}}},t}();function m$(t){return t-(0|t)==0&&(t-=1),0|t}function g$(t,e){return lc(e,t)}var v$,y$=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(F(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},Q(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),S$=function(){function t(t){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._pose.destroyWriter(this._blendStateWriters[t]);this._blendStateWriters.length=0},e.createPoseWriter=function(t,e,n){var i=this._pose.createWriter(t,e,this,n);return this._blendStateWriters.push(i),i},t}();!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(v$||(v$={})),le(v$);var T$=t("AnimationState",function(t){function e(e,n){var i;return void 0===n&&(n=""),(i=t.call(this)||this).duration=1,i.speed=1,i.time=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._useSimpleProcess=!1,i._target=null,i._wrapMode=nc.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=NaN,i._lastWrapInfo=null,i._wrappedInfo=new cc,i._allowLastFrame=!1,i._blendStateWriterHost={weight:0},i._playbackDuration=0,i._invDuration=1,i._poseOutput=null,i._weight=1,i._clipEval=void 0,i._clipEventEval=void 0,i._doNotCreateEval=!1,i._clip=e,i._name=n||e&&e.name,i._playbackRange={min:0,max:e.duration},i._playbackDuration=e.duration,e.duration||E("Clip "+e.name+" has zero duration."),i}Z(e,t);var n=e.prototype;return n.initialize=function(t,e,n){if(!this._curveLoaded){this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._targetNode=t;var i=this._clip;if(this.duration=i.duration,this._invDuration=1/this.duration,this.speed=i.speed,this.wrapMode=i.wrapMode,this.frameRate=i.sample,this._playbackRange.min=0,this._playbackRange.max=i.duration,this._playbackDuration=i.duration,(this.wrapMode&ec.Loop)===ec.Loop?this.repeatCount=1/0:this.repeatCount=1,!this._doNotCreateEval){var r,a,o,s=null!==(r=null!=e?e:null===(a=r$())||void 0===a?void 0:a.blendState)&&void 0!==r?r:null;s&&(this._poseOutput=new S$(s)),this._clipEval=i.createEvaluator({target:t,pose:null!==(o=this._poseOutput)&&void 0!==o?o:void 0,mask:n})}this._clipEventEval=i.createEventEvaluator(this._targetNode)}},n.destroy=function(){this.isMotionless||r$().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0},n.emit=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];r$().pushDelayEvent(this._emit,this,e)},n.on=function(t,e,n){return this._target&&this._target.isValid?this._target.on(t,e,n):null},n.once=function(t,e,n){return this._target&&this._target.isValid?this._target.once(t,e,n):null},n.off=function(t,e,n){this._target&&this._target.isValid&&this._target.off(t,e,n)},n.allowLastFrameEvent=function(t){this._allowLastFrame=t},n._setEventTarget=function(t){this._target=t},n.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;var e,n=this.getWrappedInfo(t,this._wrappedInfo);null===(e=this._clipEventEval)||void 0===e||e.ignore(n.ratio,n.direction)},n.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.time),this._sampleEvents(t),t},n.onPlay=function(){this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(v$.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(v$.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(v$.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(v$.PAUSE,this)},n._sampleCurves=function(t){var e=this._poseOutput,n=this._clipEval;e&&(e.weight=this.weight),n&&n.evaluate(t)},n._process=function(){this._useSimpleProcess?this.simpleProcess():this.process()},n.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new cc(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(v$.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(v$.FINISHED,this))},n.simpleProcess=function(){var t=this._playbackRange.min,e=this._playbackDuration,n=this.time%e;n<0&&(n+=e);var i=(t+n)*this._invDuration;this._sampleCurves(t+n),this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(v$.LASTFRAME,this),this._lastIterations=i)},n._needReverse=function(t){var e=this.wrapMode,n=!1;return(e&ec.PingPong)===ec.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(n=!n)),(e&ec.Reverse)===ec.Reverse&&(n=!n),n},n.getWrappedInfo=function(t,e){e=e||new cc;var n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n,r=!1,a=this.repeatCount,o=(t-=n)>0?t/i:-t/i;if(o>=a){o=a,r=!0;var s=a-(0|a);0===s&&(s=1),t=s*i*(t>0?1:-1)}if(t>i){var c=t%i;t=0===c?i:c}else t<0&&0!=(t%=i)&&(t+=i);var l=!1,u=this._wrapMode&ec.ShouldWrap;u&&(l=this._needReverse(o));var h=l?-1:1;return this.speed<0&&(h*=-1),u&&l&&(t=i-t),e.time=n+t,e.ratio=e.time/this.duration,e.direction=h,e.stopped=r,e.iterations=o,e},n._getPlaybackStart=function(){return this._playbackRange.min},n._getPlaybackEnd=function(){return this._playbackRange.max},n._sampleEvents=function(t){var e;null===(e=this._clipEventEval)||void 0===e||e.sample(t.ratio,t.direction,t.iterations)},n._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},n._onReplayOrResume=function(){r$().addAnimation(this)},n._onPauseOrStop=function(){r$().removeAnimation(this)},Q(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){var e;this._wrapMode=t,this.time=0,t&ec.Loop?this.repeatCount=1/0:this.repeatCount=1,null===(e=this._clipEventEval)||void 0===e||e.setWrapMode(t)}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&ec.ShouldWrap,n=(this.wrapMode&ec.Reverse)===ec.Reverse;this._useSimpleProcess=t===1/0&&!e&&!n}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(t){t.max,t.min,this._playbackRange.min=Math.max(t.min,0),this._playbackRange.max=Math.min(t.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}},{key:"weight",get:function(){return this._weight},set:function(t){this._weight=t,this._poseOutput&&(this._poseOutput.weight=t)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(y$));l.AnimationState=T$;var x$,E$,A$,C$,b$,w$=P$,I$=P$;function P$(){}x$=Ec("cc.animation.ClipMotion"),E$=al(s$),x$((b$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"clip",C$,rt(e)),e}Z(e,t);var n=e.prototype;return n[lJ]=function(t){return this.clip?new Y$(t,this.clip):null},n.clone=function(){var t=new e;return t.clip=this.clip,t},e}(ll),C$=ct((A$=b$).prototype,"clip",[E$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A$));var R$,D$,O$,N$,M$,L$,F$,B$,z$,U$,k$,G$,V$,H$,W$,j$,X$,q$,Y$=function(){function t(t,e){this.duration=e.duration/e.speed,this._state=new T$(e),this._state.initialize(t.node,t.blendBuffer,t.mask)}var e=t.prototype;return e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._state.clip,weight:t}})}}},e.sample=function(t,e){if(0!==e){var n=this._state.duration*t;this._state.time=n,this._state.weight=e,this._state.sample(),this._state.weight=0}},Q(t,[{key:"progress",get:function(){return this._state.time/this.duration}}]),t}(),K$=Ec("cc.animation.BindableNumber")((M$=function(){function t(t){void 0===t&&(t=0),st(this,"variable",O$,this),st(this,"value",N$,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),O$=ct((D$=M$).prototype,"variable",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),N$=ct(D$.prototype,"value",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R$=D$))||R$,Q$=Ec("cc.animation.BindableBoolean")((U$=function(){function t(t){void 0===t&&(t=!1),st(this,"variable",B$,this),st(this,"value",z$,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),B$=ct((F$=U$).prototype,"variable",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),z$=ct(F$.prototype,"value",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L$=F$))||L$;function J$(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!$$(s,a))return o;if(s.type!==n)throw new cJ(a,"number");for(var c=arguments.length,l=new Array(c>5?c-5:0),u=5;u<c;u++)l[u-5]=arguments[u];var h=s.bind.apply(s,[i,r].concat(l));return h}function Z$(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!$$(s,a))return o;if(n!==IK.FLOAT&&n!==IK.INTEGER)throw new cJ(a,"number or integer");for(var c=arguments.length,l=new Array(c>5?c-5:0),u=5;u<c;u++)l[u-5]=arguments[u];var h=s.bind.apply(s,[i,r].concat(l));return h}function $$(t,e){if(t)return!0;throw new sJ(e)}var t0,e0,n0,i0,r0,a0,o0,s0,c0,l0,u0,h0=Ec("cc.animation.AnimationBlendItem")((H$=function(){function t(){st(this,"motion",V$,this)}var e=t.prototype;return e.clone=function(){var e=new t;return this._assign(e),e},e._assign=function(t){var e,n;return t.motion=null!==(e=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==e?e:null,t},t}(),V$=ct((G$=H$).prototype,"motion",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k$=G$))||k$,f0=Ec("cc.animation.AnimationBlend")((q$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"name",X$,rt(e)),e}return Z(e,t),e}(ll),X$=ct((j$=q$).prototype,"name",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),W$=j$))||W$,_0=function(){function t(t,e,n,i){this._childEvaluators=n.map((function(e){var n,i;return null!==(n=null===(i=e.motion)||void 0===i?void 0:i[lJ](t))&&void 0!==n?n:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(i)}var e=t.prototype;return e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,i=this._weights,r=n.length,a=0;return{next:function(){for(;;){if(e){var o=e.next();if(!o.done)return o}if(a>=r)return{done:!0,value:void 0};var s=n[a];e=null==s?void 0:s.getClipStatuses(t*i[a]),++a}}}},e.sample=function(t,e){for(var n=0;n<this._childEvaluators.length;++n){var i;null===(i=this._childEvaluators[n])||void 0===i||i.sample(t,e*this._weights[n])}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},e.eval=function(){},Q(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,i;t+=(null!==(n=null===(i=this._childEvaluators[e])||void 0===i?void 0:i.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),d0=Ec("cc.animation.AnimationBlend1DItem")((i0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"threshold",n0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),e.threshold=this.threshold,e},e}(h0),n0=ct((e0=i0).prototype,"threshold",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t0=e0))||t0,p0=(Ec("cc.animation.AnimationBlend1D")((c0=s0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_items",a0,rt(e)),st(e,"param",o0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},n[lJ]=function(t){var e=new p0(t,this,this._items,this._items.map((function(t){return t.threshold})),0),n=J$(t,this.param,IK.FLOAT,e.setInput,e,0);return e.setInput(n,0),e},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),e}(f0),s0.Item=d0,a0=ct((r0=c0).prototype,"_items",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o0=ct(r0.prototype,"param",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K$}}),r0)),function(t){function e(e,n,i,r,a){var o;return(o=t.call(this,e,n,i,[a])||this)._thresholds=r,o.doEval(),o}return Z(e,t),e.prototype.eval=function(t,e){var n=e[0];!function(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var i=0,r=1;r<e.length;++r)if(e[r]>n){i=r;break}var a=e[i-1],o=e[i],s=o-a;t[i-1]=(o-n)/s,t[i]=(n-a)/s}}(t,this._thresholds,n)},e}(_0)),m0=(l0=new Qn,u0={wA:0,wB:0},function(t,e,n){if(t.length,e.length,0!==e.length)if(1!==e.length)if(Qn.strictEquals(n,Qn.ZERO)){var i=e.findIndex((function(t){return Qn.strictEquals(t,Qn.ZERO)}));i>=0?t[i]=1:t.fill(1/e.length)}else{for(var r=-1,a=-1,o=-1,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=n.x,u=n.y,h=0;h<e.length;++h){var f=e[h];if(Qn.equals(f,Qn.ZERO))o=h;else{var _=Qn.normalize(l0,f),d=Qn.dot(_,n);_.x*u-_.y*l>0?d>=c&&(c=d,r=h):d>=s&&(s=d,a=h)}}var p=0;if(r<0||a<0)p=1;else{var m=(A=e[r],C=e[a],b=n,w=u0,(I=Qn.cross(A,C))?(w.wA=Qn.cross(b,C)/I,w.wB=Qn.cross(b,A)/-I):(w.wA=0,w.wB=0),w),g=m.wA,v=m.wB,y=0,S=0,T=g+v;T>1?(y=g/T,S=v/T):T<0?(y=0,S=0,p=1):(y=g,S=v,p=1-T),t[r]=y,t[a]=S}if(p>0)if(o>=0)t[o]=p;else for(var x=p/t.length,E=0;E<t.length;++E)t[E]+=x}else t[0]=1;var A,C,b,w,I});function g0(t,e,n,i){t.fill(0);for(var r=new Qn(0,0),a=new Qn(0,0),o=0,s=e.length,c=0;c<s;++c){for(var l=Number.MAX_VALUE,u=!1,h=0;h<s;++h)if(c!==h){i(e[c],e[h],n,r,a);var f=1-Qn.dot(r,a)/Qn.lengthSqr(a);if(f<0){u=!0;break}l=Math.min(l,f)}u||(t[c]=l,o+=l)}o>0&&t.forEach((function(e,n){return t[n]=e/o}))}var v0,y0,S0,T0,x0,E0,A0,C0,b0,w0,I0,P0,R0,D0,O0,N0,M0,L0,F0=function(t,e,n,i,r){Qn.subtract(i,n,t),Qn.subtract(r,e,t)},B0=(v0=new Dn(0,0,0),y0=new Dn(0,0,0),S0=new Dn(0,0,0),T0=new Dn(0,0,0),x0=new Dn(0,0,0),E0=new Dn(0,0,0),function(t,e,n,i,r){var a=0,o=0,s=2;Dn.set(S0,n.x,n.y,0),Qn.equals(t,Qn.ZERO)?(a=Qn.angle(n,e),o=0,s=1):Qn.equals(e,Qn.ZERO)?(o=a=Qn.angle(n,t),s=1):(a=Qn.angle(t,e))<=0?o=0:Qn.equals(n,Qn.ZERO)?o=a:(Dn.set(T0,t.x,t.y,0),Dn.set(x0,e.x,e.y,0),Dn.set(E0,n.x,n.y,0),Dn.cross(v0,T0,x0),Dn.projectOnPlane(S0,E0,v0),o=Dn.angle(T0,S0),a<.99*Math.PI&&Dn.dot(Dn.cross(y0,T0,S0),v0)<0&&(o=-o));var c=Qn.len(t),l=Qn.len(e),u=(l+c)/2;Qn.set(r,(l-c)/u,a*s),Qn.set(i,(Dn.len(S0)-c)/u,o*s)});!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(L0||(L0={})),le(L0);var z0,U0,k0,G0,V0,H0,W0,j0,X0,q0,Y0,K0,Q0,J0,Z0,$0,t1,e1,n1,i1,r1,a1,o1,s1,c1,l1,u1,h1,f1,_1,d1,p1=Ec("cc.animation.AnimationBlend2DItem")((w0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"threshold",b0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),Qn.copy(e.threshold,this.threshold),e},e}(h0),b0=ct((C0=w0).prototype,"threshold",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),A0=C0))||A0,m1=(Ec("cc.animation.AnimationBlend2D")((M0=N0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"algorithm",P0,rt(e)),st(e,"_items",R0,rt(e)),st(e,"paramX",D0,rt(e)),st(e,"paramY",O0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t},n[lJ]=function(t){var e=new m1(t,this,this._items,this._items.map((function(t){return t.threshold})),this.algorithm,[0,0]),n=J$(t,this.paramX,IK.FLOAT,e.setInput,e,0),i=J$(t,this.paramY,IK.FLOAT,e.setInput,e,1);return e.setInput(n,0),e.setInput(i,1),e},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(f0),N0.Algorithm=L0,N0.Item=p1,P0=ct((I0=M0).prototype,"algorithm",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L0.SIMPLE_DIRECTIONAL}}),R0=ct(I0.prototype,"_items",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D0=ct(I0.prototype,"paramX",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K$}}),O0=ct(I0.prototype,"paramY",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K$}}),I0)),function(t){function e(e,n,i,r,a,o){var s;return(s=t.call(this,e,n,i,o)||this)._thresholds=void 0,s._algorithm=void 0,s._value=new Qn,s._thresholds=r,s._algorithm=a,s.doEval(),s}return Z(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];switch(Qn.set(this._value,n,i),t.fill(0),this._algorithm){case L0.SIMPLE_DIRECTIONAL:m0(t,this._thresholds,this._value);break;case L0.FREEFORM_CARTESIAN:!function(t,e,n){g0(t,e,n,F0)}(t,this._thresholds,this._value);break;case L0.FREEFORM_DIRECTIONAL:!function(t,e,n){g0(t,e,n,B0)}(t,this._thresholds,this._value)}},e}(_0)),g1=Ec("cc.animation.AnimationBlendDirectItem")((G0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"weight",k0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),e.weight=this.weight,e},e}(h0),k0=ct((U0=G0).prototype,"weight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),z0=U0))||z0,v1=(Ec("cc.animation.AnimationBlendDirect")((j0=W0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_items",H0,rt(e)),e}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},n[lJ]=function(t){return new v1(t,this,this._items,this._items.map((function(t){return t.weight})))},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(f0),W0.Item=g1,H0=ct((V0=j0).prototype,"_items",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V0)),function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).doEval(),e}return Z(e,t),e.prototype.eval=function(t,e){for(var n=t.length,i=0;i<n;++i)t[i]=e[i]},e}(_0)),y1=(Ec("cc.animation.AnimationMask")((Y0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_jointMasks",q0,rt(e)),e}Z(e,t);var n=e.prototype;return n.addJoint=function(t,e){var n=new y1;n.path=t,n.enabled=e,this._jointMasks.push(n)},n.removeJoint=function(t){_t(this._jointMasks,(function(e){return e.path===t}))},n.clear=function(){this._jointMasks.length=0},n.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,i=new Set,r=0;r<n;++r){var a=e[r],o=a.path;if(!a.enabled){var s=t.getChildByPath(o);s&&i.add(s)}}return i},Q(e,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=ot(t);!(e=n()).done;){var i=e.value;this.addJoint(i.path,i.enabled)}}}]),e}(Du),q0=ct((X0=Y0).prototype,"_jointMasks",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ct(X0.prototype,"joints",[Vc],Object.getOwnPropertyDescriptor(X0.prototype,"joints"),X0.prototype),X0)),Ec("cc.JointMask")((J0=ct((Q0=function(){st(this,"path",J0,this),st(this,"enabled",Z0,this)}).prototype,"path",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Z0=ct(Q0.prototype,"enabled",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),K0=Q0))||K0);!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(d1||(d1={})),Ec("cc.animation.BinaryCondition")((r1=i1=function(){function t(){st(this,"operator",t1,this),st(this,"lhs",e1,this),st(this,"rhs",n1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs.clone(),e.rhs=this.rhs.clone(),e},e[lJ]=function(t){var e=this.operator,n=this.lhs,i=this.rhs,r=new T1(e,0,0),a=Z$(t,n,IK.FLOAT,r.setLhs,r),o=Z$(t,i,IK.FLOAT,r.setRhs,r);return r.reset(a,o),r},t}(),i1.Operator=d1,t1=ct(($0=r1).prototype,"operator",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d1.EQUAL_TO}}),e1=ct($0.prototype,"lhs",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K$}}),n1=ct($0.prototype,"rhs",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K$}}),$0));var S1,T1=function(){function t(t,e,n){this._operator=t,this._lhs=e,this._rhs=n,this._eval()}var e=t.prototype;return e.reset=function(t,e){this._lhs=t,this._rhs=e,this._eval()},e.setLhs=function(t){this._lhs=t,this._eval()},e.setRhs=function(t){this._rhs=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._lhs,e=this._rhs;switch(this._operator){default:case d1.EQUAL_TO:this._result=t===e;break;case d1.NOT_EQUAL_TO:this._result=t!==e;break;case d1.LESS_THAN:this._result=t<e;break;case d1.LESS_THAN_OR_EQUAL_TO:this._result=t<=e;break;case d1.GREATER_THAN:this._result=t>e;break;case d1.GREATER_THAN_OR_EQUAL_TO:this._result=t>=e}},t}();!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(S1||(S1={})),Ec("cc.animation.UnaryCondition")((l1=c1=function(){function t(){st(this,"operator",o1,this),st(this,"operand",s1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[lJ]=function(t){var e=this.operator,n=this.operand,i=new E1(e,!1),r=J$(t,n,IK.BOOLEAN,i.setOperand,i);return i.reset(r),i},t}(),c1.Operator=S1,o1=ct((a1=l1).prototype,"operator",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S1.TRUTHY}}),s1=ct(a1.prototype,"operand",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q$}}),a1));var x1,E1=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case S1.TRUTHY:this._result=!!t;break;case S1.FALSY:this._result=!t}},t}(),A1=Ec("cc.animation.TriggerCondition")((_1=function(){function t(){st(this,"trigger",f1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[lJ]=function(t){var e=new C1(!1),n=t.getVar(this.trigger);return $$(n,this.trigger)&&(function(t,e){if(t!==IK.TRIGGER)throw new cJ(e,"trigger")}(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),f1=ct((h1=_1).prototype,"trigger",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),u1=h1))||u1,C1=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),b1=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new w1(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),w1=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},Q(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(x1||(x1={}));var I1,P1=x1.POSITION|x1.ROTATION|x1.SCALE|x1.EULER_ANGLES,R1=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new Dn}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=U1(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,Dn.zero(this.result)},t}(),D1=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new zn}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=k1(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,zn.identity(this.result)},t}(),O1=function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,i,r,a=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":r=null!==(n=a[e])&&void 0!==n?n:a[e]=this._createVec3BlendState(t[e]);break;case"rotation":r=null!==(i=a[e])&&void 0!==i?i:a[e]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._transformApplyFlags,a=this._properties,o=a.position,s=a.scale,c=a.rotation,l=a.eulerAngles;r&&(o&&r&x1.POSITION&&(e=o.result),s&&r&x1.SCALE&&(n=s.result),l&&r&x1.EULER_ANGLES&&(i=l.result),c&&r&x1.ROTATION&&(i=c.result),(i||e||n)&&t.setRTS(i,e,n),this._transformApplyFlags=0)},Q(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),N1=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.apply=function(e){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.accumulatedWeight&&(this._transformApplyFlags|=x1.POSITION,i.accumulatedWeight<1&&i.blend(e.position,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=x1.SCALE,r.accumulatedWeight<1&&r.blend(e.scale,1-r.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=x1.EULER_ANGLES,o.accumulatedWeight<1&&o.blend(e.eulerAngles,1-o.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=x1.ROTATION,a.accumulatedWeight<1&&a.blend(e.rotation,1-a.accumulatedWeight)),t.prototype.apply.call(this,e),null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},n._createVec3BlendState=function(){return new R1},n._createQuatBlendState=function(){return new D1},e}(O1),M1=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.prototype.createNodeBlendState=function(){return new N1},e}(b1),L1=function(){function t(t){this.refCount=0,this.result=new Dn,this._defaultValue=new Dn,this._clipBlendResult=new Dn,this._accumulatedWeight=0,Dn.copy(this._defaultValue,t),Dn.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=U1(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),Dn.lerp(e,e,n,t),Dn.zero(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){Dn.copy(this.result,this._defaultValue)},t}(),F1=function(){function t(t){this.refCount=0,this.result=new zn,this._defaultValue=new zn,this._clipBlendResult=new zn,this._accumulatedWeight=0,zn.copy(this._defaultValue,t),zn.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=k1(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),zn.slerp(e,e,n,t),zn.identity(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){zn.copy(this.result,this._defaultValue)},t}(),B1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._layerMask=-1>>>0,e}Z(e,t);var n=e.prototype;return n.setLayerMask=function(t){this._layerMask&=~(1<<t)},n.commitLayerChanges=function(t,e){if(this._layerMask&1<<t){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.commitLayerChange(e),r&&r.commitLayerChange(e),a&&a.commitLayerChange(e),o&&o.commitLayerChange(e)}},n.apply=function(e){this._transformApplyFlags=P1,t.prototype.apply.call(this,e);var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},n._createVec3BlendState=function(t){return new L1(t)},n._createQuatBlendState=function(t){return new F1(t)},e}(O1),z1=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.setMask=function(t,e){this._nodeBlendStates.forEach((function(n,i){e.has(i)&&n.setLayerMask(t)}))},n.commitLayerChanges=function(t,e){this._nodeBlendStates.forEach((function(n){n.commitLayerChanges(t,e)}))},n.createNodeBlendState=function(){return new B1},e}(b1);function U1(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;Dn.lerp(t,t,i,o)}}else Dn.copy(t,i);return a}function k1(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;zn.slerp(t,e,i,o)}}else zn.copy(t,i);return a}var G1,V1,H1=Ec("cc.animation.StateMachineComponent")(I1=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||I1,W1=function(){function t(t,e,n){var i=this;this._blendBuffer=new z1,this._currentTransitionCache={duration:0,time:0},this._varInstances={},this._hasAutoTrigger=!1;for(var r,a=ot(t.variables);!(r=a()).done;){var o=r.value,s=o[0],c=o[1],l=this._varInstances[s]=new aJ(c.type,c.value);if(c.type===IK.TRIGGER){var u=c.resetMode;l.resetMode=u,u===PK.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}}for(var h={controller:n,blendBuffer:this._blendBuffer,node:e,getVar:function(t){return i._varInstances[t]},triggerResetFn:function(t){i.setValue(t,!1)}},f=(this._layerEvaluations=t.layers.map((function(t){var e;return new j1(t,J({},h,{mask:null!==(e=t.mask)&&void 0!==e?e:void 0}))}))).length,_=0;_<f;++_){var d=t.layers[_].mask;if(d){var p=d.filterDisabledNodes(h.node);this._blendBuffer.setMask(_,p)}}}var e=t.prototype;return e.update=function(t){for(var e=this._blendBuffer,n=this._layerEvaluations,i=n.length,r=0;r<i;++r){var a=n[r];a.update(t),e.commitLayerChanges(r,a.weight*a.passthroughWeight)}if(this._hasAutoTrigger){var o=this._varInstances;for(var s in o){var c=o[s];c.type===IK.TRIGGER&&c.resetMode===PK.NEXT_FRAME_OR_AFTER_CONSUMED&&(c.value=!1)}}this._blendBuffer.apply()},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._layerEvaluations[t].getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._layerEvaluations[t].getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._layerEvaluations,n=this._currentTransitionCache;return e[t].getCurrentTransition(n)?n:null},e.getNextStateStatus=function(t){return this._layerEvaluations[t].getNextStateStatus()},e.getNextClipStatuses=function(t){return this.getCurrentTransition(t),this._layerEvaluations[t].getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.setLayerWeight=function(t,e){this._layerEvaluations[t].weight=e},t}(),j1=function(){function t(t,e){this.passthroughWeight=1,this._nodes=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._currentTransitionToNode=null,this._currentTransitionPath=[],this._transitionProgress=0,this._fromWeight=0,this._toWeight=0,this._fromUpdated=!1,this._toUpdated=!1,this.name=t.name,this._controller=e.controller,this.weight=t.weight;var n=this._addStateMachine(t.stateMachine,null,J({},e),t.name),i=n.entry,r=n.exit;this._topLevelEntry=i,this._topLevelExit=r,this._currentNode=i,this._resetTrigger=e.triggerResetFn}var e=t.prototype;return e.update=function(t){this.exited||(this._fromWeight=1,this._toWeight=0,this._eval(t),this._sample())},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===V1.animation?t.getFromPortStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===V1.animation?t.getClipStatuses(this._fromWeight):q1},e.getCurrentTransition=function(t){var e=this._currentTransitionPath;if(0!==e.length){if(e[e.length-1].to.kind!==V1.animation)return!1;var n=e[0],i=n.duration,r=n.normalizedDuration,a=t.duration=r?i*(this._currentNode.kind===V1.animation?this._currentNode.duration:0):i;return t.time=this._transitionProgress*a,!0}return!1},e.getNextStateStatus=function(){return this._currentTransitionToNode&&(this._currentTransitionToNode.kind,V1.empty),this._currentTransitionToNode.getToPortStatus()},e.getNextClipStatuses=function(){var t,e=this._currentTransitionPath,n=e[e.length-1].to;return n.kind,V1.animation,null!==(t=n.getClipStatuses(this._toWeight))&&void 0!==t?t:q1},e._addStateMachine=function(t,e,n,i){for(var r,a,o,s=this,c=Array.from(t.states()),l=c.map((function(e){return e instanceof dJ?new t2(e,n):e===t.entryState?r=new u2(e,V1.entry,e.name):e===t.exitState?o=new u2(e,V1.exit,e.name):e===t.anyState?a=new u2(e,V1.any,e.name):e instanceof vJ?new h2(e):null})),u={components:null,parent:e,entry:r,exit:o,any:a},h=0;h<c.length;++h){var f=l[h];f&&(f.stateMachine=u)}for(var _=c.map((function(t){if(t instanceof TJ){var e=s._addStateMachine(t.stateMachine,u,n,i+"/"+t.name);return e.components=new $1(t),e}return null})),d=0;d<c.length;++d){var p=c[d],m=t.getOutgoings(p),g=[],v=void 0;v=p instanceof TJ?_[d].exit:l[d];for(var y,S=function(){var t=y.value,e=t.to,i=c.findIndex((function(e){return e===t.to})),r=void 0;r=e instanceof TJ?_[i].entry:l[i];var a={conditions:t.conditions.map((function(t){return t[lJ](n)})),to:r,triggers:void 0,duration:0,normalizedDuration:!1,exitCondition:0,exitConditionEnabled:!1};t instanceof gJ?(a.duration=t.duration,a.normalizedDuration=t.relativeDuration,a.exitConditionEnabled=t.exitConditionEnabled,a.exitCondition=t.exitCondition):t instanceof yJ&&(a.duration=t.duration),a.conditions.forEach((function(e,n){var i,r=t.conditions[n];r instanceof A1&&r.trigger&&(null!==(i=a.triggers)&&void 0!==i?i:a.triggers=[]).push(r.trigger)})),g.push(a)},T=ot(m);!(y=T()).done;)S();v.outgoingTransitions=g}return u},e._eval=function(t){if(this.exited,I$("[Layer "+this.name+"]: UpdateStart "+t+"s"),this._continueDanglingTransition())return 0;for(var e=t,n=!0,i=0;n||e>0;){if(n=!1,100===i){R(14e3,100);break}if(++i,this._currentTransitionPath.length>0){if(e-=this._updateCurrentTransition(e),this._currentNode.kind===V1.exit)break;0===this._currentTransitionPath.length&&(n=!0)}else{var r=this._currentNode,a=this._matchCurrentNodeTransition(e);if(a){var o=a.transition,s=a.requires;if(w$("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),e-=s,r.kind===V1.animation&&(r.updateFromPort(s),this._fromUpdated=!0),this._switchTo(o))break;n=!0}else w$("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),r.kind===V1.animation?(r.updateFromPort(e),this._fromUpdated=!0,e=0):e=0}}return w$("[SubStateMachine "+this.name+"]: UpdateEnd"),this._fromUpdated&&this._currentNode.kind===V1.animation&&(this._fromUpdated=!1,this._currentNode.triggerFromPortUpdate(this._controller)),this._currentTransitionToNode&&this._toUpdated&&this._currentTransitionToNode.kind===V1.animation&&(this._toUpdated=!1,this._currentTransitionToNode.triggerToPortUpdate(this._controller)),e},e._sample=function(){var t=this._currentNode,e=this._currentTransitionToNode,n=this._fromWeight,i=this._toWeight;t.kind===V1.empty?(this.passthroughWeight=i,e&&e.kind===V1.animation&&e.sampleToPort(1)):e&&e.kind===V1.empty?(this.passthroughWeight=n,t.kind===V1.animation&&t.sampleFromPort(1)):(this.passthroughWeight=1,t.kind===V1.animation&&t.sampleFromPort(n),e&&e.kind===V1.animation&&e.sampleToPort(i))},e._matchCurrentNodeTransition=function(t){var e=this._currentNode,n=1/0,i=null,r=this._matchTransition(e,e,t,Q1);if(r&&(n=r.requires,i=r.transition),e.kind===V1.animation)for(var a=e.stateMachine;null!==a;a=a.parent){var o=this._matchTransition(a.any,e,t,J1);o&&o.requires<n&&(n=o.requires,i=o.transition)}return i?K1.set(i,n):null},e._matchTransition=function(t,e,n,i){t===e||(t.kind,V1.any);for(var r=t.outgoingTransitions,a=r.length,o=1/0,s=null,c=0;c<a;++c){var l=r[c],u=l.conditions,h=u.length;if(0===h){if(t.kind===V1.entry||t.kind===V1.exit)return i.set(l,0);if(!l.exitConditionEnabled)continue}var f=0;if(e.kind===V1.animation&&l.exitConditionEnabled){var _=e.duration*l.exitCondition;if((f=Math.max(_-e.fromPortTime,0))>n)continue}for(var d=!0,p=0;p<h;++p)if(!u[p].eval()){d=!1;break}if(d){if(0===f)return i.set(l,0);f<o&&(o=f,s=l)}}return s?i.set(s,o):null},e._switchTo=function(t){var e=this._currentNode;I$("[SubStateMachine "+this.name+"]: STARTED "+e.name+" -> "+t.to.name+".");var n=this._currentTransitionPath;this._consumeTransition(t),n.push(t);var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)},e._continueDanglingTransition=function(){var t=this._currentTransitionPath,e=t.length;if(0===e)return!1;var n=t[e-1].to;if(n.kind!==V1.animation&&n.kind!==V1.empty){var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)}return!1},e._matchTransitionPathUntilMotion=function(){for(var t=this._currentTransitionPath,e=t[t.length-1].to;e.kind!==V1.animation&&e.kind!==V1.empty;){var n=this._matchTransition(e,e,0,K1);if(!n)break;var i=n.transition;this._consumeTransition(i),t.push(i),e=i.to}return e.kind===V1.animation||e.kind===V1.empty?e:null},e._consumeTransition=function(t){var e=t.to;e.kind===V1.entry&&this._callEnterMethods(e)},e._resetTriggersAlongThePath=function(){for(var t=this._currentTransitionPath,e=t.length,n=0;n<e;++n){var i=t[n];this._resetTriggersOnTransition(i)}},e._doTransitionToMotion=function(t){this._resetTriggersAlongThePath(),this._transitionProgress=0,this._currentTransitionToNode=t,this._toUpdated=!1,t.kind===V1.animation&&t.resetToPort(),this._callEnterMethods(t)},e._updateCurrentTransition=function(t){var e,n=this._currentTransitionPath,i=this._currentTransitionToNode;n.length;var r=n[0],a=r.duration,o=r.normalizedDuration,s=this._currentNode,c=i,l=0,u=0;if(a<=0)l=0,u=1;else{s.kind===V1.animation||(s.kind,V1.empty);var h=this._transitionProgress,f=s.kind===V1.empty?a:o?a*s.duration:a,_=h*f,d=f-_;l=Math.min(d,t),u=this._transitionProgress=(_+l)/f}var p=null!==(e=null==c?void 0:c.name)&&void 0!==e?e:"<Empty>";this._fromWeight=1-u,this._toWeight=u;var m=0!==l,g=1===u;if(s.kind===V1.animation&&m&&(I$("Update "+s.name),s.updateFromPort(l),this._fromUpdated=!0),c.kind===V1.animation&&m&&(I$("Update "+c.name),c.updateToPort(l),this._toUpdated=!0),g){w$("[SubStateMachine "+this.name+"]: Transition finished:  "+s.name+" -> "+p+"."),this._callExitMethods(s);for(var v=this._currentTransitionPath,y=v.length,S=0;S<y;++S){var T=v[S].to;T.kind===V1.exit&&this._callExitMethods(T)}this._fromUpdated=this._toUpdated,this._toUpdated=!1,c.kind===V1.animation&&c.finishTransition(),this._currentNode=c,this._currentTransitionToNode=null,this._currentTransitionPath.length=0,this._fromWeight=1,this._toWeight=0}return l},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,i=0;i<n;++i){var r=e[i];this._resetTrigger(r)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case V1.animation:t.components.callMotionStateEnterMethods(n,t.getToPortStatus());break;case V1.entry:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case V1.animation:t.components.callMotionStateExitMethods(n,t.getFromPortStatus());break;case V1.exit:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineExitMethods(n)}},Q(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}(),X1=Object.freeze({next:function(){return{done:!0,value:void 0}}}),q1=Object.freeze(((G1={})[Symbol.iterator]=function(){return X1},G1)),Y1=function(){function t(){this.transition=null,this.requires=0}return t.prototype.set=function(t,e){return this.transition=t,this.requires=e,this},t}(),K1=new Y1,Q1=new Y1,J1=new Y1;!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty"}(V1||(V1={}));var Z1=function(t){this.name=void 0,this.outgoingTransitions=[],this.name=t.name},$1=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var i=this._components,r=i.length,a=0;a<r;++a){var o=i[a];o[t]!==H1.prototype[t]&&o[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,i=n.length,r=0;r<i;++r){var a=n[r];a[t]!==H1.prototype[t]&&a[t](e)}},t}(),t2=function(t){function e(e,n){var i,r,a;if((a=t.call(this,e)||this).kind=V1.animation,a._source=null,a._baseSpeed=1,a._speed=1,a._fromPort={progress:0,statusCache:{progress:0}},a._toPort={progress:0,statusCache:{progress:0}},a._baseSpeed=e.speed,a._setSpeedMultiplier(1),e.speedMultiplierEnabled&&e.speedMultiplier){var o=e.speedMultiplier,s=n.getVar(o);if($$(s,o)){!function(t,e,n){if(t!==e)throw new cJ(n,"number")}(s.type,IK.FLOAT,o),s.bind(a._setSpeedMultiplier,rt(a));var c=s.value;a._setSpeedMultiplier(c)}}var l=J({},n),u=null!==(i=null===(r=e.motion)||void 0===r?void 0:r[lJ](l))&&void 0!==i?i:null;return u&&Object.defineProperty(u,"__DEBUG_ID__",{value:a.name}),a._source=u,a.components=new $1(e),a}Z(e,t);var n=e.prototype;return n.updateFromPort=function(t){this._fromPort.progress=e2(this._fromPort.progress,this.duration,t*this._speed)},n.updateToPort=function(t){this._toPort.progress=e2(this._toPort.progress,this.duration,t*this._speed)},n.triggerFromPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getFromPortStatus())},n.triggerToPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getToPortStatus())},n.getFromPortStatus=function(){var t=this._fromPort.statusCache;return t.progress=n2(this._fromPort.progress),t},n.getToPortStatus=function(){var t=this._toPort.statusCache;return t.progress=n2(this._toPort.progress),t},n.resetToPort=function(){this._toPort.progress=0},n.finishTransition=function(){this._fromPort.progress=this._toPort.progress},n.sampleFromPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._fromPort.progress,t)},n.sampleToPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._toPort.progress,t)},n.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):q1},n._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},Q(e,[{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._source)||void 0===e?void 0:e.duration)&&void 0!==t?t:0}},{key:"fromPortTime",get:function(){return this._fromPort.progress*this.duration}}]),e}(Z1);function e2(t,e,n){return 0===e?0:t+n/e}function n2(t){return t-Math.trunc(t)}var i2,r2,a2,o2,s2,c2,l2,u2=function(t){function e(e,n){var i;return(i=t.call(this,e)||this).kind=void 0,i.kind=n,i}return Z(e,t),e}(Z1),h2=function(t){function e(e){var n;return(n=t.call(this,e)||this).kind=V1.empty,n}return Z(e,t),e}(Z1),f2=(i2=Ec("cc.animation.AnimationController"),r2=Bc(),a2=wc(CJ),i2(o2=r2((l2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"graph",c2,rt(e)),e._graphEval=null,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.graph&&(this._graphEval=new W1(this.graph,this.node,this))},n.update=function(t){var e;null===(e=this._graphEval)||void 0===e||e.update(t)},n.getVariables=function(){return this._graphEval.getVariables()},n.setValue=function(t,e){this._graphEval.setValue(t,e)},n.getValue=function(t){return this._graphEval.getValue(t)},n.getCurrentStateStatus=function(t){return this._graphEval.getCurrentStateStatus(t)},n.getCurrentClipStatuses=function(t){return this._graphEval.getCurrentClipStatuses(t)},n.getCurrentTransition=function(t){return this._graphEval.getCurrentTransition(t)},n.getNextStateStatus=function(t){return this._graphEval.getNextStateStatus(t)},n.getNextClipStatuses=function(t){return this._graphEval.getNextClipStatuses(t)},n.setLayerWeight=function(t,e){return this._graphEval.setLayerWeight(t,e)},e}(Zu),c2=ct((s2=l2).prototype,"graph",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o2=s2))||o2)||o2);t("animation",Object.freeze({__proto__:null,UniformProxyFactory:EY,MorphWeightValueProxy:AY,MorphWeightsValueProxy:CY,MorphWeightsAllValueProxy:bY,Track:fK,TrackPath:uK,RealTrack:mK,VectorTrack:DK,QuatTrack:LK,ColorTrack:zK,SizeTrack:GK,ObjectTrack:HK,isPropertyPath:Zq,isCustomPath:function(t,e){return t instanceof e},HierarchyPath:TY,ComponentPath:xY,CubicSplineVec2Value:eK,CubicSplineVec3Value:nK,CubicSplineVec4Value:iK,CubicSplineQuatValue:rK,CubicSplineNumberValue:aK,AnimationController:f2,get VariableType(){return IK},StateMachineComponent:H1}));var _2,d2,p2,m2=[],g2=new Map;function v2(t,e){for(var n=0,i=Xn.IDENTITY;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){i=t.world,t.stamp=e;break}t.stamp=e,m2[n++]=t,t=t.parent}for(;n>0;){t=m2[--n],m2[n]=null;var r=t.node;Xn.fromRTS(t.local,r.rotation,r.position,r.scale),i=Xn.multiply(t.world,i,t.local)}return i}function y2(t,e){for(var n,i=null,r=0;t!==e;){var a=t.uuid;if(g2.has(a)){i=g2.get(a);break}i={node:t,local:new Xn,world:new Xn,stamp:-1,parent:null},g2.set(a,i),m2[r++]=i,t=t.parent,i=null}for(;r>0;)n=m2[--r],m2[r]=null,n.parent=i,i=n;return i}function S2(t){for(var e=g2.get(t.uuid)||null;e;)g2.delete(e.node.uuid),e=e.parent}var T2=t("AnimationManager",Ec((p2=d2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new lt([]),e._crossFades=new lt([]),e._delayEvents=[],e._blendStateBuffer=new M1,e._sockets=[],e}Z(e,t);var n=e.prototype;return n.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},n.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):O(3907)},n.update=function(t){var e=this._delayEvents,n=this._crossFades,i=this._sockets,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var a=this._anims,o=a.array;for(a.i=0;a.i<o.length;++a.i){var s=o[a.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var c=l.director.getTotalFrames(),u=0,h=i.length;u<h;u++){var f=i[u],_=f.target,d=f.transform;_.matrix=v2(d,c)}for(var p=0,m=e.length;p<m;p++){var g=e[p];g.fn.apply(g.thisArg,g.args)}e.length=0},n.destruct=function(){},n.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},n.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):O(3907)},n.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},n.addSockets=function(t,e){for(var n=this,i=function(i){var r=e[i];if(n._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),o=r.target&&a&&y2(a,t);o&&n._sockets.push({target:r.target,transform:o})},r=0;r<e.length;++r)i(r)},n.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===i.target){S2(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},Q(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(KO),d2.ID="animation",_2=p2))||_2);lN.on(cN.EVENT_INIT,(function(){var t=new T2;lN.registerSystem(T2.ID,t,KO.Priority.HIGH)})),l.AnimationManager=T2;var x2,E2,A2,C2,b2,w2,I2,P2,R2,D2,O2,N2,M2,L2,F2,B2,z2,U2=function(t){function e(e){var n;return(n=t.call(this)||this)._managedStates=[],n._fadings=[],n._scheduled=!1,n._scheduler=null!=e?e:r$(),n}Z(e,t);var n=e.prototype;return n.update=function(t){if(!this.isMotionless){var e=this._managedStates,n=this._fadings;if(1===e.length&&1===n.length){var i=e[0].state;i&&(i.weight=1)}else this._calculateWeights(t);1===e.length&&1===n.length&&this._unscheduleThis()}},n.crossFade=function(t,e){var n;0===this._managedStates.length&&(e=0),0===e&&this.clear();var i=this._managedStates.find((function(e){return e.state===t}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:t,reference:0},t&&t.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:i}),this.isMotionless||this._scheduleThis()},n.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){t.prototype.onPlay.call(this),this._scheduleThis()},n.onPause=function(){t.prototype.onPause.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.pause()}this._unscheduleThis()},n.onResume=function(){t.prototype.onResume.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.resume()}this._scheduleThis()},n.onStop=function(){t.prototype.onStop.call(this),this.clear()},n._calculateWeights=function(t){for(var e=this._managedStates,n=this._fadings,i=0;i<e.length;++i){var r=e[i].state;r&&(r.weight=0)}for(var a=1,o=n.length,s=0;s<n.length;++s){var c=n[s];c.easeTime+=t;var l=0===c.easeDuration?1:hn(c.easeTime/c.easeDuration),u=l*a;if(a*=1-l,c.target.state&&(c.target.state.weight+=u),c.easeTime>=c.easeDuration){o=s+1,c.easeTime=c.easeDuration;break}}if(o!==n.length){for(var h=o;h<n.length;++h){var f=n[h];--f.target.reference,f.target.reference<=0&&(f.target.state&&f.target.state.stop(),ft(this._managedStates,f.target))}n.splice(o)}},n._scheduleThis=function(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)},n._unscheduleThis=function(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)},e}(y$),k2=function(e){return t({Animation:e,AnimationComponent:e}),e}((x2=Ec("cc.Animation"),E2=Gc(),A2=Cc(99),C2=Bc(),b2=al([s$]),w2=Xc(),I2=al(s$),P2=Xc(),R2=Xc(),D2=al([s$]),x2(O2=E2(O2=A2(O2=Fc(O2=C2((z2=B2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"playOnLoad",M2,rt(e)),e._crossFade=new U2,e._nameToState=It(!0),st(e,"_clips",L2,rt(e)),st(e,"_defaultClip",F2,rt(e)),e._hasBeenPlayed=!1,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=It(!0)},n.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},n.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var n=this._nameToState[t];n&&this.doPlayOrCrossFade(n,e)},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},n.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},n.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},n.addClip=function(t,e){return dt(this._clips,t)||this._clips.push(t),this.createState(t,e)},n.removeClip=function(t,e){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===t){n=r;break}}if(t===this._defaultClip){if(!e)return void R(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!e)return void R(3903);n.stop()}this._clips=this._clips.filter((function(e){return e!==t})),n&&delete this._nameToState[n.name]},n.on=function(e,n,i,r){var a=t.prototype.on.call(this,e,n,i,r);return e===v$.LASTFRAME&&this._syncAllowLastFrameEvent(),a},n.once=function(e,n,i){var r=t.prototype.once.call(this,e,n,i);return e===v$.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i),e===v$.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(t,e){return new T$(t,e)},n._doCreateState=function(t,e){var n=this._createState(t,e);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(v$.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n.doPlayOrCrossFade=function(t,e){this._crossFade.play(),this._crossFade.crossFade(t,e)},n._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var n=this._nameToState[e];G2(t,n.clip)&&(n.stop(),delete this._nameToState[e])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(v$.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(v$.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},Q(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var n,i=ot(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var a,o=ot(t);!(a=o()).done;){var s=a.value;s&&this.createState(s)}var c=t.find((function(t){return G2(t,e._defaultClip)}));this._defaultClip=c||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return G2(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}($l(Zu)),B2.EventType=v$,ct((N2=z2).prototype,"clips",[b2,w2],Object.getOwnPropertyDescriptor(N2.prototype,"clips"),N2.prototype),ct(N2.prototype,"defaultClip",[I2,P2],Object.getOwnPropertyDescriptor(N2.prototype,"defaultClip"),N2.prototype),M2=ct(N2.prototype,"playOnLoad",[Dc,R2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L2=ct(N2.prototype,"_clips",[D2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F2=ct(N2.prototype,"_defaultClip",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O2=N2))||O2)||O2)||O2)||O2)||O2));function G2(t,e){return t===e||!!t&&!!e&&t._uuid===e._uuid&&t._uuid}l.Animation=k2,l.AnimationComponent=k2,ie.setClassAlias(k2,"cc.AnimationComponent");var V2,H2,W2,j2=new Xn;function X2(t,e,n){for(Xn.identity(n);t!==e;)Xn.fromRTS(j2,t.rotation,t.position,t.scale),Xn.multiply(n,j2,n),t=t.parent;return n}l.easing=t_,function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(V2||(V2={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(H2||(H2={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(W2||(W2={}));var q2,Y2=0;function K2(t,e){var n;e.invoking||(e.invoking=!0,(n=e.func).call.apply(n,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var n=t._operationQueue[0];n&&K2(t,n)})).catch((function(){})))}function Q2(t,e,n){var i=n.value;n.value=function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new Promise((function(e){var r=Y2++,a=t;a._operationQueue.push({id:r,func:i,args:n,invoking:!1}),a._eventTarget.once(r.toString(),e),K2(a,a._operationQueue[0])}))}}function J2(t){return new Promise((function(e){var n=t.play();return void 0===n?e():(n.then(e).catch((function(){var n=function(){t.play().catch((function(){})),e()},i=document.getElementById("GameCanvas");null==i||i.addEventListener("touchend",n,{once:!0}),null==i||i.addEventListener("mousedown",n,{once:!0})})),null)}))}var Z2,$2,t4=function(){function t(t,e){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=t,t.volume=e}var e=t.prototype;return e.play=function(){var t=this;J2(this._domAudio).then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t)})).catch((function(){}))},e.stop=function(){this._domAudio.pause()},Q(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=t,t&&this._domAudio.addEventListener("ended",t)}}]),t}(),e4=(ct((q2=function(){function t(t){var e=this;this._domAudio=void 0,this._state=W2.INIT,this._onEnded=void 0,this._eventTarget=new tu,this._operationQueue=[],this._domAudio=t,du.on("hide",this._onHide,this),du.on("show",this._onShow,this),this._onEnded=function(){e.seek(0).catch((function(){})),e._state=W2.INIT,e._eventTarget.emit(V2.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var e=t.prototype;return e.destroy=function(){du.off("hide",this._onHide,this),du.off("show",this._onShow,this),this._domAudio.removeEventListener("ended",this._onEnded),this._domAudio=null},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(e){n(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=document.createElement("audio"),r="canplaythrough";du.os===au.IOS?r="loadedmetadata":du.browserType===nu.FIREFOX&&(r="canplay");var a=setTimeout((function(){0===i.readyState?c():s()}),8e3),o=function(){clearTimeout(a),i.removeEventListener(r,s,!1),i.removeEventListener("error",c,!1)},s=function(){o(),e(i)},c=function(){o(),n("load audio failure - "+t)};i.addEventListener(r,s,!1),i.addEventListener("error",c,!1),i.src=t}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){var e=new t4(t,n);i(e)})).catch(r)}))},e._onHide=function(){var t=this;this._state===W2.PLAYING&&this.pause().then((function(){t._state=W2.INTERRUPTED,t._eventTarget.emit(V2.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===W2.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(V2.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){return t=un(t,0,this.duration),this._domAudio.currentTime=t,Promise.resolve()},e.play=function(){var t=this;return new Promise((function(e){J2(t._domAudio).then((function(){t._state=W2.PLAYING,e()})).catch((function(){}))}))},e.pause=function(){return this._domAudio.pause(),this._state=W2.PAUSED,Promise.resolve()},e.stop=function(){var t=this;return new Promise((function(e){t._domAudio.pause(),t._domAudio.currentTime=0,t._state=W2.STOPPED,e()}))},e.onInterruptionBegin=function(t){this._eventTarget.on(V2.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(V2.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(V2.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(V2.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(V2.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(V2.ENDED,t)},Q(t,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return H2.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(t){this._domAudio.loop=t}},{key:"volume",get:function(){return this._domAudio.volume},set:function(t){t=hn(t),this._domAudio.volume=t}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}}]),t}()).prototype,"seek",[Q2],Object.getOwnPropertyDescriptor(q2.prototype,"seek"),q2.prototype),ct(q2.prototype,"play",[Q2],Object.getOwnPropertyDescriptor(q2.prototype,"play"),q2.prototype),ct(q2.prototype,"pause",[Q2],Object.getOwnPropertyDescriptor(q2.prototype,"pause"),q2.prototype),ct(q2.prototype,"stop",[Q2],Object.getOwnPropertyDescriptor(q2.prototype,"stop"),q2.prototype),q2),n4=function(){function t(t){this._nativeAudio=void 0,this._startTime=0,this._startOffset=0,this._isPaused=!0,this._nativeAudio=t}var e=t.prototype;return e.destroy=function(){this._nativeAudio=void 0},e._now=function(){return performance.now()/1e3},e._calculateCurrentTime=function(){var t=this._now()-this._startTime,e=this._startOffset+t;return e>=this.duration&&(this._startTime=this._now(),this._startOffset=0),e%this.duration},e.start=function(){this._isPaused=!1,this._startTime=this._now()},e.pause=function(){this._isPaused||(this._isPaused=!0,this._startOffset=this._calculateCurrentTime())},e.stop=function(){this._isPaused=!0,this._startOffset=0},e.seek=function(t){this._startTime=this._now(),this._startOffset=un(t,0,this.duration)},Q(t,[{key:"duration",get:function(){return this._nativeAudio.duration}},{key:"currentTime",get:function(){return this._isPaused?this._startOffset:this._calculateCurrentTime()}}]),t}(),i4=new(function(){function t(){this._audioBufferDataMap={}}var e=t.prototype;return e.addCache=function(t,e){this._audioBufferDataMap[t]?console.warn("Audio buffer "+t+" has been cached"):this._audioBufferDataMap[t]={usedCount:1,audioBuffer:e}},e.retainCache=function(t){var e=this._audioBufferDataMap[t];e?e.usedCount++:console.warn("Audio buffer cache "+t+" has not been added.")},e.getCache=function(t){var e=this._audioBufferDataMap[t];return null==e?void 0:e.audioBuffer},e.tryReleasingCache=function(t){var e=this._audioBufferDataMap[t];e?--e.usedCount<=0&&delete this._audioBufferDataMap[t]:console.warn("Audio buffer cache "+t+" has not been added.")},t}()),r4=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,a4=function(){function t(){this._context=void 0,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}var e=t.prototype;return e.decodeAudioData=function(t){var e=this;return new Promise((function(n){var i=e._context.decodeAudioData(t,(function(t){n(t)}),(function(t){console.error("failed to load Web Audio",t)}));null==i||i.catch((function(){}))}))},e.runContext=function(){var t=this;return new Promise((function(e){var n=t._context;if(n.resume)if("running"!==n.state){var i=document.getElementById("GameCanvas"),r=function(){n.resume().then(e).catch((function(){}))};null==i||i.addEventListener("touchend",r,{once:!0,capture:!0}),null==i||i.addEventListener("mouseup",r,{once:!0,capture:!0})}else e();else e()}))},e.createBufferSource=function(t,e){var n=this._context.createBufferSource();return void 0!==t&&(n.buffer=t),void 0!==e&&(n.loop=e),n},e.createGain=function(t){void 0===t&&(t=1);var e=this._context.createGain();return this.setGainValue(e,t),e},e.setGainValue=function(t,e){if(t.gain.setTargetAtTime)try{t.gain.setTargetAtTime(e,this._context.currentTime,0)}catch(n){t.gain.setTargetAtTime(e,this._context.currentTime,.01)}else t.gain.value=e},e.connectContext=function(t){this._context&&t.connect(this._context.destination)},Q(t,[{key:"currentTime",get:function(){return this._context.currentTime}}]),t}();a4.support=!!r4,a4.support&&($2=new a4);var o4,s4,c4,l4,u4,h4=function(){function t(t,e,n){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._currentTimer=0,this._url=void 0,this._onEndCb=void 0,this._duration=t.duration,this._url=n,this._bufferSourceNode=$2.createBufferSource(t,!1);var i=$2.createGain(e);this._bufferSourceNode.connect(i),$2.connectContext(i)}var e=t.prototype;return e.play=function(){var t=this;this._bufferSourceNode.start(),$2.runContext().then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t),t._currentTimer=window.setTimeout((function(){var e;i4.tryReleasingCache(t._url),null===(e=t.onEnd)||void 0===e||e.call(t)}),1e3*t._duration)})).catch((function(){}))},e.stop=function(){clearTimeout(this._currentTimer),i4.tryReleasingCache(this._url),this._bufferSourceNode.stop(),this._bufferSourceNode.buffer=null},Q(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),f4=(ct((Z2=function(){function t(t,e){this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._state=W2.INIT,this._audioTimer=void 0,this._eventTarget=new tu,this._operationQueue=[],this._audioBuffer=t,this._audioTimer=new n4(t),this._gainNode=$2.createGain(),$2.connectContext(this._gainNode),this._src=e,du.on("hide",this._onHide,this),du.on("show",this._onShow,this)}var e=t.prototype;return e.destroy=function(){this._audioTimer.destroy(),this._audioBuffer&&(this._audioBuffer=null),i4.tryReleasingCache(this._src),du.off("hide",this._onHide,this),du.off("show",this._onShow,this)},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(i){n(new t(i,e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=i4.getCache(t);if(i)return i4.retainCache(t),void e(i);var r=new XMLHttpRequest,a="load audio failed: "+t+", status: ";r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200===r.status||0===r.status?$2.decodeAudioData(r.response).then((function(n){i4.addCache(t,n),e(n)})).catch((function(){})):n(new Error(""+a+r.status+"(no response)"))},r.onerror=function(){n(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){n(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){n(new Error(""+a+r.status+"(abort)"))},r.send(null)}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){var r=new h4(t,n,e);i(r)})).catch(r)}))},e._onHide=function(){var t=this;this._state===W2.PLAYING&&this.pause().then((function(){t._state=W2.INTERRUPTED,t._eventTarget.emit(V2.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===W2.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(V2.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){var e=this;return new Promise((function(n){e._audioTimer.seek(t),e._state===W2.PLAYING?e._doPlay().then(n).catch((function(){})):n()}))},e.play=function(){return this._doPlay()},e._doPlay=function(){var t=this;return new Promise((function(e){t._stopSourceNode(),t._sourceNode=$2.createBufferSource(t._audioBuffer,t.loop),t._sourceNode.connect(t._gainNode),t._sourceNode.start(0,t._audioTimer.currentTime),$2.runContext().then((function(){t._state=W2.PLAYING,t._audioTimer.start(),window.clearTimeout(t._currentTimer),t._currentTimer=window.setTimeout((function e(){t.loop?t._currentTimer=window.setTimeout(e,1e3*t._audioBuffer.duration):(t._audioTimer.stop(),t._eventTarget.emit(V2.ENDED),t._state=W2.INIT)}),1e3*(t._audioBuffer.duration-t._audioTimer.currentTime)),e()})).catch((function(){}))}))},e._stopSourceNode=function(){try{this._sourceNode&&(this._sourceNode.stop(),this._sourceNode.buffer=null)}catch(t){}},e.pause=function(){return this._state===W2.PLAYING&&this._sourceNode?(this._audioTimer.pause(),this._state=W2.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.stop=function(){return this._sourceNode?(this._audioTimer.stop(),this._state=W2.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.onInterruptionBegin=function(t){this._eventTarget.on(V2.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(V2.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(V2.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(V2.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(V2.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(V2.ENDED,t)},Q(t,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return H2.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._sourceNode&&(this._sourceNode.loop=t)}},{key:"volume",get:function(){return this._volume},set:function(t){t=hn(t),this._volume=t,$2.setGainValue(this._gainNode,t)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._audioTimer.currentTime}}]),t}()).prototype,"seek",[Q2],Object.getOwnPropertyDescriptor(Z2.prototype,"seek"),Z2.prototype),ct(Z2.prototype,"play",[Q2],Object.getOwnPropertyDescriptor(Z2.prototype,"play"),Z2.prototype),ct(Z2.prototype,"pause",[Q2],Object.getOwnPropertyDescriptor(Z2.prototype,"pause"),Z2.prototype),ct(Z2.prototype,"stop",[Q2],Object.getOwnPropertyDescriptor(Z2.prototype,"stop"),Z2.prototype),Z2),_4=function(){function t(t){this._audio=void 0,this._audio=t}var e=t.prototype;return e.play=function(){this._audio.play()},e.stop=function(){this._audio.stop()},Q(t,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(t){this._audio.onPlay=t}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(t){this._audio.onEnd=t}}]),t}(),d4=function(){function t(t){this._player=void 0,this._player=t}t.load=function(e,n){return new Promise((function(i){(null==n?void 0:n.audioLoadMode)!==H2.DOM_AUDIO&&a4.support?f4.load(e).then((function(e){i(new t(e))})).catch((function(){})):(a4.support||R(5201),e4.load(e).then((function(e){i(new t(e))})).catch((function(){})))}))};var e=t.prototype;return e.destroy=function(){this._player.destroy()},t.loadNative=function(t,e){return(null==e?void 0:e.audioLoadMode)!==H2.DOM_AUDIO&&a4.support?f4.loadNative(t):(a4.support||R(5201),e4.loadNative(t))},t.loadOneShotAudio=function(t,e,n){return new Promise((function(i,r){(null==n?void 0:n.audioLoadMode)!==H2.DOM_AUDIO&&a4.support?f4.loadOneShotAudio(t,e).then((function(t){i(new _4(t))})).catch(r):(a4.support||R(5201),e4.loadOneShotAudio(t,e).then((function(t){i(new _4(t))})).catch(r))}))},e.seek=function(t){return this._player.seek(t)},e.play=function(){return this._player.play()},e.pause=function(){return this._player.pause()},e.stop=function(){return this._player.stop()},e.onInterruptionBegin=function(t){this._player.onInterruptionBegin(t)},e.offInterruptionBegin=function(t){this._player.offInterruptionBegin(t)},e.onInterruptionEnd=function(t){this._player.onInterruptionEnd(t)},e.offInterruptionEnd=function(t){this._player.offInterruptionEnd(t)},e.onEnded=function(t){this._player.onEnded(t)},e.offEnded=function(t){this._player.offEnded(t)},Q(t,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(t){this._player.loop=t}},{key:"volume",get:function(){return this._player.volume},set:function(t){this._player.volume=t}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),t}();d4.maxAudioChannel=24;var p4=t("AudioClip",Ec("cc.AudioClip")((u4=l4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_duration",c4,rt(e)),e._loadMode=H2.UNKNOWN_AUDIO,e._meta=null,e._player=null,e}Z(e,t);var n=e.prototype;return n.destroy=function(){var e,n=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),this._player=null,this._meta&&(this._meta.player=null),n},n.validate=function(){return!!this._meta},n.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},n.getCurrentTime=function(){return this._player?this._player.currentTime:0},n.getVolume=function(){return this._player?this._player.volume:0},n.getLoop=function(){return!!this._player&&this._player.loop},n.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},n.setVolume=function(t){this._player&&(this._player.volume=t)},n.setLoop=function(t){this._player&&(this._player.loop=t)},n.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},n.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},n.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},n.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&d4.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},Q(e,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this._loadMode=t.type,this._player=t.player):(this._meta=null,this._loadMode=H2.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:W2.INIT}}]),e}(Du),l4.AudioType=H2,c4=ct((s4=u4).prototype,"_duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct(s4.prototype,"_nativeDep",[sl],Object.getOwnPropertyDescriptor(s4.prototype,"_nativeDep"),s4.prototype),o4=s4))||o4);function m4(t,e,n){d4.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var i={player:e,url:t,duration:e.duration,type:e.type};n(null,i)})).catch((function(t){n(t)}))}function g4(t,e,n,i){var r=new p4;r._nativeUrl=t,r._nativeAsset=e,r._duration=e.duration,i(null,r)}l.AudioClip=p4,$N.register({".mp3":m4,".ogg":m4,".wav":m4,".m4a":m4}),oM.register({".mp3":g4,".ogg":g4,".wav":g4,".m4a":g4});var v4,y4,S4,T4,x4,E4,A4,C4,b4,w4,I4,P4,R4,D4,O4,N4,M4,L4,F4,B4=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var n=this._findIndex(t,e);return n>-1?(t[n].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof d4){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var n=this._findIndex(t,e);return-1!==n&&(ht(t,n),!0)},e.removePlaying=function(t){if(t instanceof d4){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<d4.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}());!function(t){t.STARTED="started",t.ENDED="ended"}(F4||(F4={}));var z4=function(e){return t({AudioSource:e,AudioSourceComponent:e}),e}((v4=Ec("cc.AudioSource"),y4=Gc(),S4=Bc(),T4=al(p4),x4=al(p4),E4=Xc(),A4=Xc(),C4=Xc(),b4=qc(),w4=Xc(),v4(I4=y4(I4=S4((L4=M4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_clip",R4,rt(e)),e._player=null,st(e,"_loop",D4,rt(e)),st(e,"_playOnAwake",O4,rt(e)),st(e,"_volume",N4,rt(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=null,e}Z(e,t);var n=e.prototype;return n._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,this._lastSetClip!==e&&(e?e._nativeAsset?(this._lastSetClip=e,d4.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(n){t._lastSetClip===e?(t._isLoaded=!0,t._player&&(B4.removePlaying(t._player),t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=n,n.onEnded((function(){B4.removePlaying(n),t.node.emit(F4.ENDED,t)})),n.onInterruptionBegin((function(){B4.removePlaying(n)})),n.onInterruptionEnd((function(){B4.addPlaying(n)})),t._syncStates()):n.destroy()})).catch((function(){}))):console.error("Invalid audio clip"):this._lastSetClip=null)},n.onLoad=function(){this._syncPlayer()},n.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},n.onDisable=function(){var t=this._getRootNode();(null==t?void 0:t._persistNode)||this.pause()},n.onDestroy=function(){var t;this.stop(),null===(t=this._player)||void 0===t||t.destroy(),this._player=null},n._getRootNode=function(){for(var t,e,n=this.node,i=null===(t=n)||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.parent;i;){var r,a,o;i=null===(a=n=null===(r=n)||void 0===r?void 0:r.parent)||void 0===a||null===(o=a.parent)||void 0===o?void 0:o.parent}return n},n.play=function(){var t,e,n=this;this._isLoaded?(B4.discardOnePlayingIfNeeded(),this.state===W2.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){B4.addPlaying(n._player),n.node.emit(F4.STARTED,n)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},n.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){B4.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},n.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){B4.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},n.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?d4.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){B4.discardOnePlayingIfNeeded(),t.onPlay=function(){B4.addPlaying(t)},t.onEnd=function(){B4.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},n._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var n;null===(n=t[e])||void 0===n||n.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},Q(e,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=un(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=un(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.duration:0}},{key:"state",get:function(){return this._player?this._player.state:W2.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return d4.maxAudioChannel}}]),e}(Zu),M4.AudioState=W2,M4.EventType=F4,R4=ct((P4=L4).prototype,"_clip",[T4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D4=ct(P4.prototype,"_loop",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),O4=ct(P4.prototype,"_playOnAwake",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N4=ct(P4.prototype,"_volume",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ct(P4.prototype,"clip",[x4,E4],Object.getOwnPropertyDescriptor(P4.prototype,"clip"),P4.prototype),ct(P4.prototype,"loop",[A4],Object.getOwnPropertyDescriptor(P4.prototype,"loop"),P4.prototype),ct(P4.prototype,"playOnAwake",[C4],Object.getOwnPropertyDescriptor(P4.prototype,"playOnAwake"),P4.prototype),ct(P4.prototype,"volume",[b4,w4],Object.getOwnPropertyDescriptor(P4.prototype,"volume"),P4.prototype),I4=P4))||I4)||I4)||I4));U(p4,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:z4,targetName:"AudioSource"}]),G(p4.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),l.AudioSourceComponent=z4,ie.setClassAlias(z4,"cc.AudioSourceComponent"),l.log=y,l.warn=S,l.error=T,l.assert=x,l._throw=C,l.logID=I,l.warnID=R,l.errorID=O,l.assertID=L,l.debug=j,l.path={join:vu,extname:yu,mainFileName:Su,basename:Tu,dirname:xu,changeExtname:Eu,changeBasename:Au,_normalize:Cu,stripSep:bu,get sep(){return wu()}};var U4=t("NodePool",function(){function t(t){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=t,this._pool=[]}var e=t.prototype;return e.size=function(){return this._pool.length},e.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},e.put=function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},e.get=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var a=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return a&&a.reuse&&a.reuse(arguments),r},t}());l.NodePool=U4,l.renderer=Xy;var k4=Object.setPrototypeOf,G4={};G4||(G4={}),function(t){var e=function(){function e(n){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=n,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var n=0,i=this._objects;n<i.length;n++)i[n].returnToPool();this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var r=0;r<this._events.length;++r){var a=this._events[r],o=a.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(a.type,a),a.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(a.type,a)),this.bufferObject(a)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}();t.DragonBones=e}(G4||(G4={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),k4=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var n=String(e.constructor),i=n in t._maxCountMap?t._maxCountMap[n]:t._defaultMaxCount,r=t._poolsMap[n]=t._poolsMap[n]||[];r.length<i&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,r.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,n){if((n<0||n!=n)&&(n=0),null!==e)null!==(r=(i=String(e))in t._poolsMap?t._poolsMap[i]:null)&&r.length>n&&(r.length=n),t._maxCountMap[i]=n;else for(var i in t._defaultMaxCount=n,t._poolsMap){var r;(r=t._poolsMap[i]).length>n&&(r.length=n),i in t._maxCountMap&&(t._maxCountMap[i]=n)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var n=String(e);null!==(r=n in t._poolsMap?t._poolsMap[n]:null)&&r.length>0&&(r.length=0)}else for(var i in t._poolsMap){var r;(r=t._poolsMap[i]).length=0}},t.borrowObject=function(e){var n=String(e),i=n in t._poolsMap?t._poolsMap[n]:null;if(null!==i&&i.length>0){var r=i.pop();return r._isInPool=!1,r}var a=new e;return a._onClear(),a},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(G4||(G4={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,n=0,i=0,r=this.d*t.d,a=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,n+=this.b*t.d,i+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(n+=this.a*t.b,i+=this.d*t.c,a+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=n,this.c=i,this.d=r,this.tx=a,this.ty=o,this},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,i=this.d,r=this.tx,a=this.ty;if(0===e&&0===n)return this.b=this.c=0,0===t||0===i?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,i=this.d=1/i,this.tx=-t*r,this.ty=-i*a),this;var o=t*i-e*n;if(0===o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var s=this.a=i*o;return e=this.b=-e*o,n=this.c=-n*o,i=this.d=t*o,this.tx=-(s*r+n*a),this.ty=-(e*r+i*a),this},t.prototype.transformPoint=function(t,e,n,i){void 0===i&&(i=!1),n.x=this.a*t+this.c*e,n.y=this.b*t+this.d*e,i||(n.x+=this.tx,n.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var n=this.a,i=this.b,r=this.c,a=this.d,o=e?0:this.tx,s=e?0:this.ty,c=t.x,l=t.y,u=c+t.width,h=l+t.height,f=n*c+r*l+o,_=i*c+a*l+s,d=n*u+r*l+o,p=i*u+a*l+s,m=n*u+r*h+o,g=i*u+a*h+s,v=n*c+r*h+o,y=i*c+a*h+s,S=0;f>d&&(S=f,f=d,d=S),m>v&&(S=m,m=v,v=S),t.x=Math.floor(f<m?f:m),t.width=Math.ceil((d>v?d:v)-t.x),_>p&&(S=_,_=p,p=S),g>y&&(S=g,g=y,y=S),t.y=Math.floor(_<g?_:g),t.height=Math.ceil((p>y?p:y)-t.y)},t}();t.Matrix=e}(G4||(G4={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=1),this.x=t,this.y=e,this.skew=n,this.rotation=i,this.scaleX=r,this.scaleY=a}return t.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(t>0?-Math.PI:Math.PI)},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var n=this.scaleX,i=this.scaleY,r=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var a=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-r&&this.rotation<r?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=a>-r&&a<r?e.d/Math.cos(a):-e.c/Math.sin(a),n>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,a-=Math.PI),this.skew=a-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(G4||(G4={})),function(t){var e=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=n,this.blueMultiplier=i,this.alphaOffset=r,this.redOffset=a,this.greenOffset=o,this.blueOffset=s}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(G4||(G4={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(G4||(G4={})),function(t){var e=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return k4(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=n}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return k4(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e.prototype.dispose=function(){console.warn(""),this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(G4||(G4={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.aabb=new t.Rectangle,n.animationNames=[],n.sortedBones=[],n.sortedSlots=[],n.defaultActions=[],n.actions=[],n.bones={},n.slots={},n.constraints={},n.skins={},n.animations={},n.canvas=null,n.userData=null,n}return k4(n,e),n.toString=function(){return"[class dragonBones.ArmatureData]"},n.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this.actions;n<i.length;n++)i[n].returnToPool();for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},n.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),n=0,i=0;for(this.sortedBones.length=0;i<t;){var r=e[n++];if(n>=t&&(n=0),!(this.sortedBones.indexOf(r)>=0)){var a=!1;for(var o in this.constraints){var s=this.constraints[o];if(s.root===r&&this.sortedBones.indexOf(s.target)<0){a=!0;break}}a||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),i++)}}}},n.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},n.prototype.setCacheFrame=function(t,e){var n=this.parent.cachedFrames,i=n.length;return n.length+=10,n[i]=t.a,n[i+1]=t.b,n[i+2]=t.c,n[i+3]=t.d,n[i+4]=t.tx,n[i+5]=t.ty,n[i+6]=e.rotation,n[i+7]=e.skew,n[i+8]=e.scaleX,n[i+9]=e.scaleY,i},n.prototype.getCacheFrame=function(t,e,n){var i=this.parent.cachedFrames;t.a=i[n],t.b=i[n+1],t.c=i[n+2],t.d=i[n+3],t.tx=i[n+4],t.ty=i[n+5],e.rotation=i[n+6],e.skew=i[n+7],e.scaleX=i[n+8],e.scaleY=i[n+9],e.x=t.tx,e.y=t.ty},n.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},n.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},n.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},n.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},n.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},n.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},n.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},n.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},n.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},n.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},n.prototype.getMesh=function(t,e,n){var i=this.getSkin(t);return null===i?null:i.getDisplay(e,n)},n.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},n}(t.BaseObject);t.ArmatureData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n.userData=null,n}return k4(n,e),n.toString=function(){return"[class dragonBones.BoneData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},n}(t.BaseObject);t.BoneData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.SurfaceData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},e}(n);t.SurfaceData=i;var r=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return k4(n,e),n.createColor=function(){return new t.ColorTransform},n.toString=function(){return"[class dragonBones.SlotData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},n.DEFAULT_COLOR=new t.ColorTransform,n}(t.BaseObject);t.SlotData=r}(G4||(G4={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=i}(G4||(G4={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return k4(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,n=this.displays[t];e<n.length;e++){var i=n[e];null!==i&&i.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var n=this.getDisplays(t);if(null!==n)for(var i=0,r=n;i<r.length;i++){var a=r[i];if(null!==a&&a.name===e)return a}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(G4||(G4={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},t}();t.VerticesData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n}return k4(n,e),n.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},n}(t.BaseObject);t.DisplayData=n;var i=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.pivot=new t.Point,n}return k4(n,e),n.toString=function(){return"[class dragonBones.ImageDisplayData]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},n}(n);t.ImageDisplayData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,n=this.actions;e<n.length;e++)n[e].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(n);t.ArmatureDisplayData=r;var a=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n}return k4(n,t),n.toString=function(){return"[class dragonBones.MeshDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null},n}(n);t.MeshDisplayData=a;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return k4(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(n);t.BoundingBoxDisplayData=o;var s=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n.curveLengths=[],n}return k4(n,t),n.toString=function(){return"[class dragonBones.PathDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0},n}(n);t.PathDisplayData=s;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=c}(G4||(G4={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,n,i,r,a){var o=0;return t<n?o|=1:t>r&&(o|=2),e<i?o|=4:e>a&&(o|=8),o},e.rectangleIntersectsSegment=function(t,n,i,r,a,o,s,c,l,u,h){void 0===l&&(l=null),void 0===u&&(u=null),void 0===h&&(h=null);var f=t>a&&t<s&&n>o&&n<c,_=i>a&&i<s&&r>o&&r<c;if(f&&_)return-1;for(var d=0,p=e._computeOutCode(t,n,a,o,s,c),m=e._computeOutCode(i,r,a,o,s,c);;){if(0==(p|m)){d=2;break}if(0!=(p&m))break;var g=0,v=0,y=0,S=0!==p?p:m;0!=(4&S)?(g=t+(i-t)*(o-n)/(r-n),v=o,null!==h&&(y=.5*-Math.PI)):0!=(8&S)?(g=t+(i-t)*(c-n)/(r-n),v=c,null!==h&&(y=.5*Math.PI)):0!=(2&S)?(v=n+(r-n)*(s-t)/(i-t),g=s,null!==h&&(y=0)):0!=(1&S)&&(v=n+(r-n)*(a-t)/(i-t),g=a,null!==h&&(y=Math.PI)),S===p?(t=g,n=v,p=e._computeOutCode(t,n,a,o,s,c),null!==h&&(h.x=y)):(i=g,r=v,m=e._computeOutCode(i,r,a,o,s,c),null!==h&&(h.y=y))}return d&&(f?(d=2,null!==l&&(l.x=i,l.y=r),null!==u&&(u.x=i,u.y=i),null!==h&&(h.x=h.y+Math.PI)):_?(d=1,null!==l&&(l.x=t,l.y=n),null!==u&&(u.x=t,u.y=n),null!==h&&(h.y=h.x+Math.PI)):(d=3,null!==l&&(l.x=t,l.y=n),null!==u&&(u.x=i,u.y=r))),d},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return!0}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var c=.5*this.width,l=.5*this.height;return e.rectangleIntersectsSegment(t,n,i,r,-c,-l,c,l,a,o,s)},e}(e);t.RectangleBoundingBoxData=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,n,i,r,a,o,s,c,l,u){void 0===c&&(c=null),void 0===l&&(l=null),void 0===u&&(u=null);var h=o/s,f=h*h,_=n-t,d=(i*=h)-(e*=h),p=Math.sqrt(_*_+d*d),m=_/p,g=d/p,v=(r-t)*m+(a-e)*g,y=o*o,S=y-(t*t+e*e)+v*v,T=0;if(S>=0){var x=Math.sqrt(S),E=v-x,A=v+x,C=E<0?-1:E<=p?0:1,b=A<0?-1:A<=p?0:1,w=C*b;if(w<0)return-1;0===w&&(-1===C?(T=2,n=t+A*m,i=(e+A*g)/h,null!==c&&(c.x=n,c.y=i),null!==l&&(l.x=n,l.y=i),null!==u&&(u.x=Math.atan2(i/y*f,n/y),u.y=u.x+Math.PI)):1===b?(T=1,t+=E*m,e=(e+E*g)/h,null!==c&&(c.x=t,c.y=e),null!==l&&(l.x=t,l.y=e),null!==u&&(u.x=Math.atan2(e/y*f,t/y),u.y=u.x+Math.PI)):(T=3,null!==c&&(c.x=t+E*m,c.y=(e+E*g)/h,null!==u&&(u.x=Math.atan2(c.y/y*f,c.x/y))),null!==l&&(l.x=t+A*m,l.y=(e+A*g)/h,null!==u&&(u.y=Math.atan2(l.y/y*f,l.x/y)))))}return T},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return e*=n/i,Math.sqrt(t*t+e*e)<=n}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){return void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),e.ellipseIntersectsSegment(t,n,i,r,0,0,.5*this.width,.5*this.height,a,o,s)},e}(e);t.EllipseBoundingBoxData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),t===n&&(t=n+1e-6),e===i&&(e=i+1e-6);for(var c=r.length,l=t-n,u=e-i,h=t*i-e*n,f=0,_=r[c-2],d=r[c-1],p=0,m=0,g=0,v=0,y=0,S=0,T=0;T<c;T+=2){var x=r[T],E=r[T+1];_===x&&(_=x+1e-4),d===E&&(d=E+1e-4);var A=_-x,C=d-E,b=_*E-d*x,w=l*C-u*A,I=(h*A-l*b)/w;if((I>=_&&I<=x||I>=x&&I<=_)&&(0===l||I>=t&&I<=n||I>=n&&I<=t)){var P=(h*C-u*b)/w;if((P>=d&&P<=E||P>=E&&P<=d)&&(0===u||P>=e&&P<=i||P>=i&&P<=e)){if(null===o){g=I,v=P,y=I,S=P,f++,null!==s&&(s.x=Math.atan2(E-d,x-_)-.5*Math.PI,s.y=s.x);break}var R=I-t;R<0&&(R=-R),0===f?(p=R,m=R,g=I,v=P,y=I,S=P,null!==s&&(s.x=Math.atan2(E-d,x-_)-.5*Math.PI,s.y=s.x)):(R<p&&(p=R,g=I,v=P,null!==s&&(s.x=Math.atan2(E-d,x-_)-.5*Math.PI)),R>m&&(m=R,y=I,S=P,null!==s&&(s.y=Math.atan2(E-d,x-_)-.5*Math.PI))),f++}}_=x,d=E}return 1===f?(null!==a&&(a.x=g,a.y=v),null!==o&&(o.x=g,o.y=v),null!==s&&(s.y=s.x+Math.PI)):f>1&&(f++,null!==a&&(a.x=g,a.y=v),null!==o&&(o.x=y,o.y=S)),f},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var n=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var i=0,r=this.vertices.length,a=r-2;i<r;i+=2){var o=this.vertices[a+1],s=this.vertices[i+1];if(s<e&&o>=e||o<e&&s>=e){var c=this.vertices[a],l=this.vertices[i];(e-s)*(c-l)/(o-s)+l<t&&(n=!n)}a=i}return n},e.prototype.intersectsSegment=function(t,i,r,a,o,s,c){void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null);var l=0;return 0!==n.rectangleIntersectsSegment(t,i,r,a,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,i,r,a,this.vertices,o,s,c)),l},e}(e);t.PolygonBoundingBoxData=r}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.surfaceTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return k4(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,n=this.boneTimelines[t];e<n.length;e++)n[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var i=0,r=this.surfaceTimelines[t];i<r.length;i++)r[i].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var a=0,o=this.slotTimelines[t];a<o.length;a++)o[a].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,c=this.constraintTimelines[t];s<c.length;s++)c[s].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var l=0,u=this.animationTimelines[t];l<u.length;l++)u[l].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var n=0,i=this.cacheFrames.length;n<i;++n)this.cachedFrames[n]=!1;for(var r=0,a=this.parent.sortedBones;r<a.length;r++){var o=a[r];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.boneCachedFrameIndices[o.name]=l}for(var s=0,c=this.parent.sortedSlots;s<c.length;s++){var l,u=c[s];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.slotCachedFrameIndices[u.name]=l}}},e.prototype.addBoneTimeline=function(t,e){var n=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSurfaceTimeline=function(t,e){var n=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSlotTimeline=function(t,e){var n=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addConstraintTimeline=function(t,e){var n=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addAnimationTimeline=function(t,e){var n=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=n}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,n=this.boneMask.length;e<n;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=t.getBone(e);if(null!==i&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),n))for(var r=0,a=t.getBones();r<a.length;r++){var o=a[r];this.boneMask.indexOf(o.name)<0&&i.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=this.boneMask.indexOf(e);if(i>=0&&this.boneMask.splice(i,1),n){var r=t.getBone(e);if(null!==r)if(this.boneMask.length>0)for(var a=0,o=t.getBones();a<o.length;a++){var s=o[a],c=this.boneMask.indexOf(s.name);c>=0&&r.contains(s)&&this.boneMask.splice(c,1)}else for(var l=0,u=t.getBones();l<u.length;l++)(s=u[l])!==r&&(r.contains(s)||this.boneMask.push(s.name))}},e}(t.BaseObject);t.AnimationConfig=e}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return k4(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var n=this.createTexture();n.copyFrom(t.textures[e]),this.textures[e]=n}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.region=new t.Rectangle,n.frame=null,n}return k4(n,e),n.createRectangle=function(){return new t.Rectangle},n.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},n.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=n.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},n}(t.BaseObject);t.TextureData=n}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e.bones=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.DeformVertices]"},e.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){var n;n=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=n,this.bones.length=0;for(var i=0,r=this.vertices.length;i<r;++i)this.vertices[i]=0;if(null!==this.verticesData.weight)for(i=0,r=this.verticesData.weight.bones.length;i<r;++i){var a=e.getBone(this.verticesData.weight.bones[i].name);this.bones.push(a)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];if(null!==n&&n._childrenTransformDirty)return!0}return!1},e}(t.BaseObject);t.DeformVertices=e}(G4||(G4={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return k4(n,e),n.toString=function(){return"[class dragonBones.Armature]"},n._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},n.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._slots;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._constraints;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._actions;o<s.length;o++)s[o].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},n.prototype._sortZOrder=function(t,e){var n=this._armatureData.sortedSlots,i=null===t;if(this._zOrderDirty||!i){for(var r=0,a=n.length;r<a;++r){var o=i?r:t[e+r];if(!(o<0||o>=a)){var s=n[o],c=this.getSlot(s.name);null!==c&&c._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!i}},n.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},n.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},n.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},n.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},n.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},n.prototype.init=function(e,n,i,r){null===this._armatureData&&(this._armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=n,this._display=i,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},n.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(n._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var i=0,r=0;for(i=0,r=this._bones.length;i<r;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,r=this._slots.length;i<r;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){this._lockUpdate=!0;for(var a=0,o=this._actions;a<o.length;a++){var s=o[a],c=s.actionData;if(null!==c&&0===c.type)if(null!==s.slot)null!==(h=s.slot.childArmature)&&h.animation.fadeIn(c.name);else if(null!==s.bone)for(var l=0,u=this.getSlots();l<u.length;l++){var h,f=u[l];f.parent===s.bone&&null!==(h=f.childArmature)&&h.animation.fadeIn(c.name)}else this._animation.fadeIn(c.name);s.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},n.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(o=this.getBone(t))&&(o.invalidUpdate(),e))for(var n=0,i=this._slots;n<i.length;n++)(l=i[n]).parent===o&&l.invalidUpdate()}else{for(var r=0,a=this._bones;r<a.length;r++){var o;(o=a[r]).invalidUpdate()}if(e)for(var s=0,c=this._slots;s<c.length;s++){var l;(l=c[s]).invalidUpdate()}}},n.prototype.containsPoint=function(t,e){for(var n=0,i=this._slots;n<i.length;n++){var r=i[n];if(r.containsPoint(t,e))return r}return null},n.prototype.intersectsSegment=function(t,e,n,i,r,a,o){void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null);for(var s=t===n,c=0,l=0,u=0,h=0,f=0,_=0,d=0,p=0,m=null,g=null,v=0,y=this._slots;v<y.length;v++){var S=y[v];if(S.intersectsSegment(t,e,n,i,r,a,o)>0){if(null===r&&null===a){m=S;break}var T;null!==r&&((T=s?r.y-e:r.x-t)<0&&(T=-T),(null===m||T<c)&&(c=T,u=r.x,h=r.y,m=S,o&&(d=o.x))),null!==a&&((T=a.x-t)<0&&(T=-T),(null===g||T>l)&&(l=T,f=a.x,_=a.y,g=S,null!==o&&(p=o.y)))}}return null!==m&&null!==r&&(r.x=u,r.y=h,null!==o&&(o.x=d)),null!==g&&null!==a&&(a.x=f,a.y=_,null!==o&&(o.y=p)),m},n.prototype.getBone=function(t){for(var e=0,n=this._bones;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},n.prototype.getSlot=function(t){for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.display===t)return i}return null},n.prototype.getBones=function(){return this._bones},n.prototype.getSlots=function(){return this._slots},Object.defineProperty(n.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];i.invalidUpdate(),i.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.replaceTexture=function(t){this.replacedTexture=t},n.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},n.prototype.addEventListener=function(t,e,n){this._proxy.addDBEventListener(t,e,n)},n.prototype.removeEventListener=function(t,e,n){this._proxy.removeDBEventListener(t,e,n)},n.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},n.prototype.getDisplay=function(){return this._display},n}(t.BaseObject);t.Armature=e}(G4||(G4={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.globalTransformMatrix=new t.Matrix,n.global=new t.Transform,n.offset=new t.Transform,n}return k4(n,e),n.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},n.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(n.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.TransformObject=e}(G4||(G4={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.animationPose=new t.Transform,n._blendState=new t.BlendState,n}return k4(n,e),n.toString=function(){return"[class dragonBones.Bone]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._updateGlobalTransformMatrix=function(e){var n=this._boneData,i=this.global,r=this.globalTransformMatrix,a=this.origin,o=this.offset,s=this.animationPose,c=this._parent,l=this._armature.flipX,u=this._armature.flipY===t.DragonBones.yDown,h=null!==c,f=0;if(1===this.offsetMode?null!==a?(i.x=a.x+o.x+s.x,i.scaleX=a.scaleX*o.scaleX*s.scaleX,i.scaleY=a.scaleY*o.scaleY*s.scaleY,t.DragonBones.yDown?(i.y=a.y+o.y+s.y,i.skew=a.skew+o.skew+s.skew,i.rotation=a.rotation+o.rotation+s.rotation):(i.y=a.y-o.y+s.y,i.skew=a.skew-o.skew+s.skew,i.rotation=a.rotation-o.rotation+s.rotation)):(i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation),i.add(s)):0===this.offsetMode?null!==a?i.copyFrom(a).add(s):i.copyFrom(s):(h=!1,i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation)),h){var _=0===c._boneData.type?c.globalTransformMatrix:c._getGlobalTransformMatrix(i.x,i.y);if(n.inheritScale)n.inheritRotation||(c.updateGlobalTransform(),f=l&&u?i.rotation-(c.global.rotation+Math.PI):l?i.rotation+c.global.rotation+Math.PI:u?i.rotation+c.global.rotation:i.rotation-c.global.rotation,i.rotation=f),i.toMatrix(r),r.concat(_),n.inheritTranslation?(i.x=r.tx,i.y=r.ty):(r.tx=i.x,r.ty=i.y),e?i.fromMatrix(r):this._globalDirty=!0;else{if(n.inheritTranslation){var d=i.x,p=i.y;i.x=_.a*d+_.c*p+_.tx,i.y=_.b*d+_.d*p+_.ty}else l&&(i.x=-i.x),u&&(i.y=-i.y);n.inheritRotation?(c.updateGlobalTransform(),f=c.global.scaleX<0?i.rotation+c.global.rotation+Math.PI:i.rotation+c.global.rotation,_.a*_.d-_.b*_.c<0&&(f-=2*i.rotation,(l!==u||n.inheritReflection)&&(i.skew+=Math.PI),t.DragonBones.yDown||(i.skew=-i.skew)),i.rotation=f):(l||u)&&(l&&u?f=i.rotation+Math.PI:(f=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=f),i.toMatrix(r)}}else(l||u)&&(l&&(i.x=-i.x),u&&(i.y=-i.y),l&&u?f=i.rotation+Math.PI:(f=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=f),i.toMatrix(r)},n.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},n.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var n=0,i=this._armature._constraints;n<i.length;n++)(o=i[n])._root===this&&o.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,a=this._armature._constraints;r<a.length;r++){var o;(o=a[r])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var s=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(s),s&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},n.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},n.prototype.invalidUpdate=function(){this._transformDirty=!0},n.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(n.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&i._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getBones();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},n.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},Object.defineProperty(n.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var n=e[t];if(n.parent===this)return n}return null},enumerable:!0,configurable:!0}),n}(t.TransformObject);t.Bone=e}(G4||(G4={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},e.prototype._getAffineTransform=function(t,e,n,i,r,a,o,s,c,l,u,h,f){var _=o-r,d=s-a,p=c-r,m=l-a;u.rotation=Math.atan2(d,_),u.skew=Math.atan2(m,p)-.5*Math.PI-u.rotation,f&&(u.rotation+=Math.PI),u.scaleX=Math.sqrt(_*_+d*d)/n,u.scaleY=Math.sqrt(p*p+m*m)/i,u.toMatrix(h),u.x=h.tx=r-(h.a*t+h.c*e),u.y=h.ty=a-(h.b*t+h.d*e)},e.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,n=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var i=0,r=t.length;i<r;i+=2){var a=t[i]+n[i],o=t[i+1]+n[i],s=this._parent._getGlobalTransformMatrix(a,o);e[i]=s.a*a+s.c*o+s.tx,e[i+1]=s.b*a+s.d*o+s.ty}else{var c=this._parent.globalTransformMatrix;for(i=0,r=t.length;i<r;i+=2)a=t[i]+n[i],o=t[i+1]+n[i+1],e[i]=c.a*a+c.c*o+c.tx,e[i+1]=c.b*a+c.d*o+c.ty}else for(i=0,r=t.length;i<r;i+=2)e[i]=t[i]+n[i],e[i+1]=t[i+1]+n[i+1]},e.prototype._updateGlobalTransformMatrix=function(){var t=2*this._boneData.segmentX,e=this._vertices.length-2,n=this._vertices[0],i=this._vertices[1],r=this._vertices[t],a=this._vertices[t+1],o=this._vertices[e],s=this._vertices[e+1],c=this._vertices[e-t],l=this._vertices[e-t+1],u=n+.5*(o-n),h=i+.5*(s-i),f=u+.5*(r+.5*(c-r)-u),_=h+.5*(a+.5*(l-a)-h),d=r+.5*(o-r),p=a+.5*(s-a),m=c+.5*(o-c),g=l+.5*(s-l);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,f,_,d,p,m,g,this.global,this.globalTransformMatrix,!1)},e.prototype._getGlobalTransformMatrix=function(t,n){var i=1e3;if(t<-i||i<t||n<-i||i<n)return this.globalTransformMatrix;var r=!1,a=200,o=this._boneData,s=o.segmentX,c=o.segmentY,l=2*o.segmentX,u=this._dX,h=this._dY,f=Math.floor((t+a)/u),_=Math.floor((n+a)/h),d=0,p=f*u-a,m=_*h-a,g=this._matrixCahce,v=e._helpMatrix;if(t<-a){if(n<-a||n>=a)return this.globalTransformMatrix;if(d=7*(2*(s*(c+1)+2*s+c+_)+((r=n>this._kX*(t+a)+m)?1:0)),this._matrixCahce[d]>0)v.copyFromArray(g,d+1);else{var y=_*(l+2),S=this._hullCache[4],T=this._hullCache[5],x=this._hullCache[2]-(c-_)*S,E=this._hullCache[3]-(c-_)*T,A=this._vertices;r?this._getAffineTransform(-a,m+h,800,h,A[y+l+2],A[y+l+3],x+S,E+T,A[y],A[y+1],e._helpTransform,v,!0):this._getAffineTransform(-i,m,800,h,x,E,A[y],A[y+1],x+S,E+T,e._helpTransform,v,!1),g[d]=1,g[d+1]=v.a,g[d+2]=v.b,g[d+3]=v.c,g[d+4]=v.d,g[d+5]=v.tx,g[d+6]=v.ty}}else if(t>=a){if(n<-a||n>=a)return this.globalTransformMatrix;d=7*(2*(s*(c+1)+s+_)+((r=n>this._kX*(t-i)+m)?1:0)),this._matrixCahce[d]>0?v.copyFromArray(g,d+1):(y=(_+1)*(l+2)-2,S=this._hullCache[4],T=this._hullCache[5],x=this._hullCache[0]+_*S,E=this._hullCache[1]+_*T,A=this._vertices,r?this._getAffineTransform(i,m+h,800,h,x+S,E+T,A[y+l+2],A[y+l+3],x,E,e._helpTransform,v,!0):this._getAffineTransform(a,m,800,h,A[y],A[y+1],x,E,A[y+l+2],A[y+l+3],e._helpTransform,v,!1),g[d]=1,g[d+1]=v.a,g[d+2]=v.b,g[d+3]=v.c,g[d+4]=v.d,g[d+5]=v.tx,g[d+6]=v.ty)}else if(n<-a){if(t<-a||t>=a)return this.globalTransformMatrix;d=7*(s*(c+1)+2*f+((r=n>this._kY*(t-p-u)-i)?1:0)),this._matrixCahce[d]>0?v.copyFromArray(g,d+1):(y=2*f,S=this._hullCache[10],T=this._hullCache[11],x=this._hullCache[8]+f*S,E=this._hullCache[9]+f*T,A=this._vertices,r?this._getAffineTransform(p+u,-a,u,800,A[y+2],A[y+3],A[y],A[y+1],x+S,E+T,e._helpTransform,v,!0):this._getAffineTransform(p,-i,u,800,x,E,x+S,E+T,A[y],A[y+1],e._helpTransform,v,!1),g[d]=1,g[d+1]=v.a,g[d+2]=v.b,g[d+3]=v.c,g[d+4]=v.d,g[d+5]=v.tx,g[d+6]=v.ty)}else if(n>=a){if(t<-a||t>=a)return this.globalTransformMatrix;d=7*(2*(s*(c+1)+s+c+_)+((r=n>this._kY*(t-p-u)+a)?1:0)),this._matrixCahce[d]>0?v.copyFromArray(g,d+1):(y=c*(l+2)+2*f,S=this._hullCache[10],T=this._hullCache[11],x=this._hullCache[6]-(s-f)*S,E=this._hullCache[7]-(s-f)*T,A=this._vertices,r?this._getAffineTransform(p+u,i,u,800,x+S,E+T,x,E,A[y+2],A[y+3],e._helpTransform,v,!0):this._getAffineTransform(p,a,u,800,A[y],A[y+1],A[y+2],A[y+3],x,E,e._helpTransform,v,!1),g[d]=1,g[d+1]=v.a,g[d+2]=v.b,g[d+3]=v.c,g[d+4]=v.d,g[d+5]=v.tx,g[d+6]=v.ty)}else d=7*(2*(s*_+f)+((r=n>this._k*(t-p-u)+m)?1:0)),this._matrixCahce[d]>0?v.copyFromArray(g,d+1):(y=2*f+_*(l+2),A=this._vertices,r?this._getAffineTransform(p+u,m+h,u,h,A[y+l+4],A[y+l+5],A[y+l+2],A[y+l+3],A[y+2],A[y+3],e._helpTransform,v,!0):this._getAffineTransform(p,m,u,h,A[y],A[y+1],A[y+2],A[y+3],A[y+l+2],A[y+l+3],e._helpTransform,v,!1),g[d]=1,g[d+1]=v.a,g[d+2]=v.b,g[d+3]=v.c,g[d+4]=v.d,g[d+5]=v.tx,g[d+6]=v.ty);return v},e.prototype.init=function(e,n){if(null===this._boneData){t.prototype.init.call(this,e,n);var i=e.segmentX,r=e.segmentY,a=e.vertices.length;this._dX=400/i,this._dY=400/r,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=a,this._deformVertices.length=a,this._matrixCahce.length=14*(i*r+2*i+2*r),this._hullCache.length=10;for(var o=0;o<a;++o)this._deformVertices[o]=0}},e.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var n=this._cachedFrameIndices[t];if(n>=0&&this._cachedFrameIndex===n)this._transformDirty=!1;else if(n>=0)this._transformDirty=!0,this._cachedFrameIndex=n;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++)(s=r[i])._root===this&&s.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,o=this._armature._constraints;a<o.length;a++){var s;(s=o[a])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var c=0,l=this._matrixCahce.length;c<l;c+=7)this._matrixCahce[c]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var u=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(u),u&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var h=2*this.global.x,f=2*this.global.y,_=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,_),this._hullCache[0]=_.x,this._hullCache[1]=_.y,this._hullCache[2]=h-_.x,this._hullCache[3]=f-_.y,this.globalTransformMatrix.transformPoint(0,this._dY,_,!0),this._hullCache[4]=_.x,this._hullCache[5]=_.y,this.globalTransformMatrix.transformPoint(200,1e3,_),this._hullCache[6]=_.x,this._hullCache[7]=_.y,this._hullCache[8]=h-_.x,this._hullCache[9]=f-_.y,this.globalTransformMatrix.transformPoint(this._dX,0,_,!0),this._hullCache[10]=_.x,this._hullCache[11]=_.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(G4||(G4={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n._localMatrix=new t.Matrix,n._colorTransform=new t.ColorTransform,n._displayDatas=[],n._displayList=[],n._deformVertices=null,n._rawDisplay=null,n._meshDisplay=null,n}return k4(n,e),n.prototype._onClear=function(){e.prototype._onClear.call(this);for(var n=[],i=0,r=this._displayList;i<r.length;i++)null!==(s=r[i])&&s!==this._rawDisplay&&s!==this._meshDisplay&&n.indexOf(s)<0&&n.push(s);for(var a=0,o=n;a<o.length;a++){var s;(s=o[a])instanceof t.Armature?s.dispose():this._disposeDisplay(s,!0)}null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){var n=e.getDisplays(this._slotData.name);if(null!==n)return t<n.length?n[t]:null}return null},n.prototype._updateDisplayData=function(){var e=this._displayData,i=null!==this._deformVertices?this._deformVertices.verticesData:null,r=this._textureData,a=null,o=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(a=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===a&&(a=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?o=this._displayData.vertices:null!==a&&(2===a.type||4===a.type)&&(o=a.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==a&&3===a.type&&(this._boundingBoxData=a.boundingBox),(0===this._displayData.type||2===this._displayData.type)&&(this._textureData=this._displayData.texture)),this._displayData!==e||o!==i||this._textureData!==r){if(null===o&&null!==this._textureData){var s=this._displayData,c=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=s.pivot.x,this._pivotY=s.pivot.y;var u=null!==l?l:this._textureData.region,h=u.width,f=u.height;this._textureData.rotated&&null===l&&(h=u.height,f=u.width),this._pivotX*=h*c,this._pivotY*=f*c,null!==l&&(this._pivotX+=l.x*c,this._pivotY+=l.y*c),null!==this._displayData&&null!==a&&this._displayData!==a&&(a.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX-=n._helpPoint.x,this._pivotY-=n._helpPoint.y,this._displayData.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX+=n._helpPoint.x,this._pivotY+=n._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*c-this._pivotY)}else this._pivotX=0,this._pivotY=0;null!==a?this.origin=a.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,o!==i?(null===this._deformVertices&&(this._deformVertices=t.BaseObject.borrowObject(t.DeformVertices)),this._deformVertices.init(o,this._armature)):null!==this._deformVertices&&this._textureData!==r&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0}},n.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,n=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var i=null!==this._display?this._display:this._rawDisplay;if(i!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),i!==this._rawDisplay&&i!==this._meshDisplay||this._updateFrame(),this._childArmature!==n&&(null!==n&&(n._parent=null,n.clock=null,n.inheritAnimation&&n.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}var a=null;if(null!==this._displayData&&1===this._displayData.type)a=this._displayData.actions;else if(this._displayIndex>=0&&null!==this._rawDisplayDatas){var o=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===o&&(o=this._getDefaultRawDisplayData(this._displayIndex)),null!==o&&1===o.type&&(a=o.actions)}if(null!==a&&a.length>0)for(var s=0,c=a;s<c.length;s++){var l=c[s],u=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,u,this._armature),u.slot=this,this._armature._bufferAction(u,!1)}else this._childArmature.animation.play()}},n.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},n.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},n.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},n.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},n.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var n=0,i=e.length;n<i;++n){var r=e[n];null!==r&&r!==this._rawDisplay&&r!==this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r,!0),this._displayList[n]=r}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},n.prototype.init=function(t,e,n,i){if(null===this._slotData){this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=n,this._meshDisplay=i,this._armature=e;var r=this._armature.getBone(this._slotData.parent.name);null!==r&&(this._parent=r),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},n.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var n=null!==this._deformVertices.verticesData.weight,i=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||n&&this._deformVertices.isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),n||i)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var r=t>=0;this._updateGlobalTransformMatrix(r),r&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},n.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},n.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var n=0,i=this._displayDatas.length;n<i;++n)this._displayDatas[n]||(this._displayDatas[n]=null)}this._displayDatas[e]=t},n.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),this._boundingBoxData.containsPoint(n._helpPoint.x,n._helpPoint.y))},n.prototype.intersectsSegment=function(t,e,i,r,a,o,s){if(void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),t=n._helpPoint.x,e=n._helpPoint.y,n._helpMatrix.transformPoint(i,r,n._helpPoint),i=n._helpPoint.x,r=n._helpPoint.y;var c=this._boundingBoxData.intersectsSegment(t,e,i,r,a,o,s);return c>0&&(1===c||2===c?null!==a?(this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&(o.x=a.x,o.y=a.y)):null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o):(null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),n._helpPoint,!0),s.x=Math.atan2(n._helpPoint.y,n._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),n._helpPoint,!0),s.y=Math.atan2(n._helpPoint.y,n._helpPoint.x))),c},n.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var n=this._displayList.concat(),i=new Array;this._setDisplayList(e)&&this.update(-1);for(var r=0,a=n;r<a.length;r++)null!==(c=a[r])&&c!==this._rawDisplay&&c!==this._meshDisplay&&this._displayList.indexOf(c)<0&&i.indexOf(c)<0&&i.push(c);for(var o=0,s=i;o<s.length;o++){var c;(c=s[o])instanceof t.Armature||this._disposeDisplay(c,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,n=this._displayDatas.length;e<n;++e){var i=this._rawDisplayDatas[e];null===i&&(i=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=i}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var n=this.displayList;e<=this._displayIndex&&(n.length=this._displayIndex+1),n[this._displayIndex]=t,this.displayList=n}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getDisplay=function(){return this._display},n.prototype.setDisplay=function(t){this.display=t},n}(t.TransformObject);t.Slot=e}(G4||(G4={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(n.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.Constraint=e;var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.toString=function(){return"[class dragonBones.IKConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},n.prototype._computeA=function(){var e=this._target.global,n=this._root.global,i=this._root.globalTransformMatrix,r=Math.atan2(e.y-n.y,e.x-n.x);n.scaleX<0&&(r+=Math.PI),n.rotation+=t.Transform.normalizeRadian(r-n.rotation)*this._weight,n.toMatrix(i)},n.prototype._computeB=function(){var e=this._bone._boneData.length,n=this._root,i=this._target.global,r=n.global,a=this._bone.global,o=this._bone.globalTransformMatrix,s=o.a*e,c=o.b*e,l=s*s+c*c,u=Math.sqrt(l),h=a.x-r.x,f=a.y-r.y,_=h*h+f*f,d=Math.sqrt(_),p=a.rotation,m=r.rotation,g=Math.atan2(f,h),v=(h=i.x-r.x)*h+(f=i.y-r.y)*f,y=Math.sqrt(v),S=0;if(u+d<=y||y+u<=d||y+d<=u)S=Math.atan2(i.y-r.y,i.x-r.x),u+d<=y||d<u&&(S+=Math.PI);else{var T=(_-l+v)/(2*v),x=Math.sqrt(_-T*T*v)/y,E=r.x+h*T,A=r.y+f*T,C=-f*x,b=h*x,w=!1,I=n.parent;if(null!==I){var P=I.globalTransformMatrix;w=P.a*P.d-P.b*P.c<0}w!==this._bendPositive?(a.x=E-C,a.y=A-b):(a.x=E+C,a.y=A+b),S=Math.atan2(a.y-r.y,a.x-r.x)}var R=t.Transform.normalizeRadian(S-g);r.rotation=m+R*this._weight,r.toMatrix(n.globalTransformMatrix);var D=g+R*this._weight;a.x=r.x+Math.cos(D)*d,a.y=r.y+Math.sin(D)*d;var O=Math.atan2(i.y-a.y,i.x-a.x);a.scaleX<0&&(O+=Math.PI),a.rotation=r.rotation+p-m+t.Transform.normalizeRadian(O-R-p)*this._weight,a.toMatrix(o)},n.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var n=this._constraintData;this._scaleEnabled=n.scaleEnabled,this._bendPositive=n.bendPositive,this._weight=n.weight,this._root._hasConstraint=!0}},n.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},n.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},n}(e);t.IKConstraint=n;var i=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return k4(n,e),n.toString=function(){return"[class dragonBones.PathConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},n.prototype._updatePathVertices=function(t){var e=this._armature,n=e.armatureData.parent,i=e.armatureData.scale,r=n.intArray,a=n.floatArray,o=t.offset,s=r[o+0],c=r[o+2];this._pathGlobalVertices.length=2*s;var l=t.weight;if(null!==l)for(var u=this._pathSlot._deformVertices.bones,h=l.bones.length,f=l.offset,_=r[f+1],d=f+2+h,p=(A=0,0);A<s;A++){for(var m=0,g=0,v=0,y=r[d++];v<y;v++){var S=u[r[d++]];if(null!==S){S.updateByConstraint(),E=S.globalTransformMatrix;var T=a[_++];b=a[_++]*i,w=a[_++]*i,m+=(E.a*b+E.c*w+E.tx)*T,g+=(E.b*b+E.d*w+E.ty)*T}}this._pathGlobalVertices[p++]=m,this._pathGlobalVertices[p++]=g}else{var x=this._pathSlot.parent;x.updateByConstraint();for(var E=x.globalTransformMatrix,A=0,C=c;A<s;A+=2){var b=a[C++]*i,w=a[C++]*i,I=E.a*b+E.c*w+E.tx,P=E.b*b+E.d*w+E.ty;this._pathGlobalVertices[A]=I,this._pathGlobalVertices[A+1]=P}}},n.prototype._computeVertices=function(t,e,n,i){for(var r=n,a=t;r<e;r+=2)i[r]=this._pathGlobalVertices[a++],i[r+1]=this._pathGlobalVertices[a++]},n.prototype._computeBezierCurve=function(t,e,n,i,r){var a=this._armature.armatureData.parent.intArray[t.vertices.offset+0],o=this._positions,s=this._spaces,c=t.closed,l=Array(),u=2*a,h=u/6,f=-1,_=this.position;o.length=3*e+2;var d=0;if(t.constantSpeed){c?(u+=2,l.length=a,this._computeVertices(2,u-4,0,l),this._computeVertices(0,2,u-4,l),l[u-2]=l[0],l[u-1]=l[1]):(h--,u-=4,l.length=u,this._computeVertices(2,u,0,l));var p=new Array(h);d=0;for(var m,g,v,y,S,T,x,E,A=l[0],C=l[1],b=0,w=0,I=0,P=0,R=0,D=0,O=(V=0,2);V<h;V++,O+=6)b=l[O],w=l[O+1],I=l[O+2],P=l[O+3],S=2*(m=.1875*(A-2*b+I))+(v=.09375*(3*(b-I)-A+(R=l[O+4]))),T=2*(g=.1875*(C-2*w+P))+(y=.09375*(3*(w-P)-C+(D=l[O+5]))),x=.75*(b-A)+m+.16666667*v,E=.75*(w-C)+g+.16666667*y,d+=Math.sqrt(x*x+E*E),x+=S,E+=T,S+=v,T+=y,d+=Math.sqrt(x*x+E*E),x+=S,E+=T,d+=Math.sqrt(x*x+E*E),x+=S+v,E+=T+y,d+=Math.sqrt(x*x+E*E),p[V]=d,A=R,C=D;if(i&&(_*=d),r)for(V=0;V<e;V++)s[V]*=d;for(var N=this._segments,M=0,L=(V=0,H=0,W=0,0);V<e;V++,H+=3){var F=_+=s[V];if(c)(F%=d)<0&&(F+=d),W=0;else{if(F<0)continue;if(F>d)continue}for(;;W++){var B=p[W];if(!(F>B)){0===W?F/=B:F=(F-(k=p[W-1]))/(B-k);break}}if(W!==f){f=W;var z=6*W;for(A=l[z],C=l[z+1],b=l[z+2],w=l[z+3],I=l[z+4],P=l[z+5],S=2*(m=.03*(A-2*b+I))+(v=.006*(3*(b-I)-A+(R=l[z+6]))),T=2*(g=.03*(C-2*w+P))+(y=.006*(3*(w-P)-C+(D=l[z+7]))),x=.3*(b-A)+m+.16666667*v,E=.3*(w-C)+g+.16666667*y,M=Math.sqrt(x*x+E*E),N[0]=M,z=1;z<8;z++)x+=S,E+=T,S+=v,T+=y,M+=Math.sqrt(x*x+E*E),N[z]=M;x+=S,E+=T,M+=Math.sqrt(x*x+E*E),N[8]=M,x+=S+v,E+=T+y,M+=Math.sqrt(x*x+E*E),N[9]=M,L=0}for(F*=M;;L++){var U=N[L];if(!(F>U)){var k;0===L?F/=U:F=L+(F-(k=N[L-1]))/(U-k);break}}this.addCurvePosition(.1*F,A,C,b,w,I,P,R,D,o,H,n)}}else{var G=t.curveLengths;if(d=G[h-=c?1:2],i&&(_*=d),r)for(var V=0;V<e;V++)s[V]*=d;l.length=8;V=0;for(var H=0,W=0;V<e;V++,H+=3){if(_+=s[V],c)(_%=d)<0&&(_+=d),W=0;else{if(_<0)continue;if(_>d)continue}for(var j=0;;W++){var X=G[W];if(!(_>X)){if(0===W)j=_/X;else{var q=G[W-1];j=(_-q)/(X-q)}break}}W!==f&&(f=W,c&&W===h?(this._computeVertices(u-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*W+2,8,0,l)),this.addCurvePosition(j,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,H,n)}}},n.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,u,h){if(0===t)return l[u]=e,l[u+1]=n,void(l[u+2]=0);if(1===t)return l[u]=s,l[u+1]=c,void(l[u+2]=0);var f=1-t,_=f*f,d=t*t,p=_*f,m=_*t*3,g=f*d*3,v=t*d,y=p*e+m*i+g*a+v*s,S=p*n+m*r+g*o+v*c;l[u]=y,l[u+1]=S,l[u+2]=h?Math.atan2(S-(p*n+m*r+g*o),y-(p*e+m*i+g*a)):0},n.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var n=t;this.pathOffset=n.pathDisplayData.vertices.offset,this.position=n.position,this.spacing=n.spacing,this.rotateOffset=n.rotateOffset,this.rotateMix=n.rotateMix,this.translateMix=n.translateMix,this._root=this._armature.getBone(n.root.name),this._target=this._armature.getBone(n.target.name),this._pathSlot=this._armature.getSlot(n.pathSlot.name);for(var i=0,r=n.bones.length;i<r;i++){var a=this._armature.getBone(n.bones[i].name);null!==a&&this._bones.push(a)}2===n.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},n.prototype.update=function(){var e=this._pathSlot;if(null!==e._deformVertices&&null!==e._deformVertices.verticesData&&e._deformVertices.verticesData.offset===this.pathOffset){var n=this._constraintData,i=e._displayData,r=!1,a=e._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(i.vertices),r=!0):null!==a&&(a.verticesDirty||a.isBonesUpdate())&&(this._updatePathVertices(i.vertices),a.verticesDirty=!1,r=!0),r||this.dirty){var o=n.positionMode,s=n.spacingMode,c=n.rotateMode,l=this._bones,u=0===s,h=2===c,f=0===c,_=l.length,d=f?_:_+1,p=this.spacing,m=this._spaces;if(m.length=d,h||u){m[0]=0;for(var g=0,v=d-1;g<v;g++){(D=l[g]).updateByConstraint();var y=D._boneData.length,S=y*(O=D.globalTransformMatrix).a,T=y*O.b,x=Math.sqrt(S*S+T*T);h&&(this._boneLengths[g]=x),m[g+1]=(y+p)*x/y}}else for(g=0;g<d;g++)m[g]=p;this._computeBezierCurve(i,d,f,1===o,2===s);var E,A=this._positions,C=this.rotateOffset,b=A[0],w=A[1];0===C?E=1===c:(E=!1,null!==(D=e.parent)&&(C*=(O=D.globalTransformMatrix).a*O.d-O.b*O.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD));for(var I=this.rotateMix,P=this.translateMix,R=(g=0,3);g<_;g++,R+=3){var D,O;(D=l[g]).updateByConstraint(),(O=D.globalTransformMatrix).tx+=(b-O.tx)*P,O.ty+=(w-O.ty)*P;var N=(S=A[R])-b,M=(T=A[R+1])-w;if(h){var L=this._boneLengths[g],F=(Math.sqrt(N*N+M*M)/L-1)*I+1;O.a*=F,O.b*=F}if(b=S,w=T,I>0){var B=O.a,z=O.b,U=O.c,k=O.d,G=void 0,V=void 0,H=void 0;if(G=f?A[R-1]:Math.atan2(M,N),G-=Math.atan2(z,B),E){V=Math.cos(G),H=Math.sin(G);var W=D._boneData.length;b+=(W*(V*B-H*z)-N)*I,w+=(W*(H*B+V*z)-M)*I}else G+=C;G>t.Transform.PI?G-=t.Transform.PI_D:G<-t.Transform.PI&&(G+=t.Transform.PI_D),G*=I,V=Math.cos(G),H=Math.sin(G),O.a=V*B-H*z,O.b=H*B+V*z,O.c=V*U-H*k,O.d=H*U+V*k}D.global.fromMatrix(O)}this.dirty=!1}}},n.prototype.invalidUpdate=function(){},n}(e);t.PathConstraint=i}(G4||(G4={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var n=0,i=0,r=this._animatebles.length;n<r;++n){var a=this._animatebles[n];null!==a?(i>0&&(this._animatebles[n-i]=a,this._animatebles[n]=null),a.advanceTime(t)):i++}if(i>0){for(r=this._animatebles.length;n<r;++n){var o=this._animatebles[n];null!==o?this._animatebles[n-i]=o:i++}this._animatebles.length-=i}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var n=e[t];null!==n&&(n.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}();t.WorldClock=e}(G4||(G4={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return k4(n,e),n.toString=function(){return"[class dragonBones.Animation]"},n.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();for(var n in this._animations)delete this._animations[n];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},n.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,n=this._animationStates;e<n.length;e++)null===(l=n[e])._parent&&l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var i=0,r=this._animationStates;i<r.length;i++)null===(l=r[i])._parent&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var a=0,o=this._animationStates;a<o.length;a++)null===(l=o[a])._parent&&l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var s=0,c=this._animationStates;s<c.length;s++){var l;null===(l=c[s])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},n.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},n.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if((d=this._animationStates[0])._fadeState>0&&d._subFadeState>0)this._armature._dragonBones.bufferObject(d),this._animationStates.length=0,this._lastAnimationState=null;else{var n=d._animationData,i=n.cacheFrameRate;if(this._animationDirty&&i>0){this._animationDirty=!1;for(var r=0,a=this._armature.getBones();r<a.length;r++){var o=a[r];o._cachedFrameIndices=n.getBoneCachedFrameIndices(o.name)}for(var s=0,c=this._armature.getSlots();s<c.length;s++){var l=c[s],u=l.rawDisplayDatas;if(null!==u&&u.length>0){var h=u[0];if(null!==h&&h.parent===this._armature.armatureData.defaultSkin){l._cachedFrameIndices=n.getSlotCachedFrameIndices(l.name);continue}}l._cachedFrameIndices=null}}d.advanceTime(t,i)}else if(e>1){for(var f=0,_=0;f<e;++f){var d;(d=this._animationStates[f])._fadeState>0&&d._subFadeState>0?(_++,this._armature._dragonBones.bufferObject(d),this._animationDirty=!0,this._lastAnimationState===d&&(this._lastAnimationState=null)):(_>0&&(this._animationStates[f-_]=d),d.advanceTime(t,0)),f===e-1&&_>0&&(this._animationStates.length-=_,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},n.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},n.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(i=this.getState(t))&&i.stop();else for(var e=0,n=this._animationStates;e<n.length;e++){var i;(i=n[e]).stop()}},n.prototype.playConfig=function(e){var n=e.animation;if(!(n in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+n),null;var i=this._animations[n];if(5===e.fadeOutMode)for(var r=0,a=this._animationStates;r<a.length;r++){var o=a[r];if(o._animationData===i)return o}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=i.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/i.scale),i.frameCount>1?(e.position<0?(e.position%=i.duration,e.position=i.duration-e.position):e.position===i.duration?e.position-=1e-6:e.position>i.duration&&(e.position%=i.duration),e.duration>0&&e.position+e.duration>i.duration&&(e.duration=i.duration-e.position),e.playTimes<0&&(e.playTimes=i.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var s=t.BaseObject.borrowObject(t.AnimationState);if(s.init(this._armature,i,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var c=!1,l=0,u=this._animationStates.length;l<u;++l){if(s.layer>this._animationStates[l].layer){c=!0,this._animationStates.splice(l,0,s);break}if(l!==u-1&&s.layer>this._animationStates[l+1].layer){c=!0,this._animationStates.splice(l+1,0,s);break}}c||this._animationStates.push(s)}else this._animationStates.push(s);for(var h=0,f=this._armature.getSlots();h<f.length;h++){var _=f[h].childArmature;null!==_&&_.inheritAnimation&&_.animation.hasAnimation(n)&&null===_.animation.getState(n)&&_.animation.fadeIn(n)}var d=!1;for(var p in i.animationTimelines){this._lockUpdate||(d=!0,this._lockUpdate=!0);var m=this.fadeIn(p,e.fadeInTime,1,s.layer,null,0);null!==m&&(m.resetToPose=!1,m._parent=s,m.stop())}return d&&(this._lockUpdate=!1),this._lockUpdate||(e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=s),s},n.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var n=this._armature.armatureData.defaultAnimation;null!==n&&(this._animationConfig.animation=n.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},n.prototype.fadeIn=function(t,e,n,i,r,a){return void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=0),void 0===r&&(r=null),void 0===a&&(a=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=n,this._animationConfig.layer=i,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByTime=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByFrame=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*e/i.frameCount),this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByProgress=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},n.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByTime(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByFrame(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByProgress(t,e,1);return null!==n&&n.stop(),n},n.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var n=this._animationStates[e];if(n.name===t)return n}return null},n.prototype.hasAnimation=function(t){return t in this._animations},n.prototype.getStates=function(){return this._animationStates},Object.defineProperty(n.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),n.prototype.gotoAndPlay=function(t,e,n,i,r,a,o){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===a&&(a=null),void 0===o&&(o=3),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==a?a:"";var s=this._animations[t];return s&&n>0&&(this._animationConfig.timeScale=s.duration/n),this.playConfig(this._animationConfig)},n.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(n.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,n=this._animationNames.length;e<n;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),n}(t.BaseObject);t.Animation=e}(G4||(G4={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new i,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return k4(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._surfaceTimelines;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._constraintTimelines;o<s.length;o++)s[o].returnToPool();for(var c=0,l=this._animationTimelines;c<l.length;c++)l[c].returnToPool();for(var u in this._bonePoses)this._bonePoses[u].returnToPool(),delete this._bonePoses[u];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,n=this._armature._constraints;e<n.length;e++){var i=n[e];if(null!==(c=this._animationData.getConstraintTimelines(i.name)))for(var r=0,a=c;r<a.length;r++)switch((f=a[r]).type){case 30:(_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,_.init(this._armature,this,f),this._constraintTimelines.push(_)}else this.resetToPose&&((_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,_.init(this._armature,this,null),this._constraintTimelines.push(_),this._poseTimelines.push(_))}for(var o=0,s=this._armature.animation.getStates();o<s.length;o++){var c,l=s[o];if(l._parent===this&&null!==(c=this._animationData.getAnimationTimelines(l.name)))for(var u=0,h=c;u<h.length;u++){var f;switch((f=h[u]).type){case 40:var _;(_=t.BaseObject.borrowObject(t.AnimationTimelineState)).animationState=l,_.init(this._armature,this,f),this._animationTimelines.push(_)}}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},i=0,r=this._boneTimelines;i<r.length;i++)(c=(v=r[i]).bone.name)in e||(e[c]=[]),e[c].push(v);for(var a=0,o=this._armature.getBones();a<o.length;a++){var s=o[a],c=s.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else if(0===s._boneData.type){var l=this._animationData.getBoneTimelines(c),u=c in this._bonePoses?this._bonePoses[c]:this._bonePoses[c]=t.BaseObject.borrowObject(n);if(null!==l)for(var h=0,f=l;h<f.length;h++)switch((D=f[h]).type){case 10:(v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 11:(v=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 12:(v=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 13:(v=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v)}else this.resetToPose&&((v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,null),this._boneTimelines.push(v),this._poseTimelines.push(v))}else if(1===s._boneData.type)if(null!==(l=this._animationData.getSurfaceTimelines(c)))for(var _=0,d=l;_<d.length;_++)switch((D=d[_]).type){case 50:(v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,v.init(this._armature,this,D),this._surfaceTimelines.push(v)}else this.resetToPose&&((v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,v.init(this._armature,this,null),this._surfaceTimelines.push(v),this._poseTimelines.push(v))}for(var p in e)for(var m=0,g=e[p];m<g.length;m++){var v=g[m];this._boneTimelines.splice(this._boneTimelines.indexOf(v),1),v.returnToPool()}for(var y={},S=[],T=0,x=this._slotTimelines;T<x.length;T++)(c=(v=x[T]).slot.name)in y||(y[c]=[]),y[c].push(v);for(var E=0,A=this._armature.getSlots();E<A.length;E++){var C=A[E],b=C.parent.name;if(this.containsBoneMask(b))if(c=C.name,l=this._animationData.getSlotTimelines(c),c in y)delete y[c];else{var w=!1,I=!1;if(S.length=0,null!==l)for(var P=0,R=l;P<R.length;P++){var D;switch((D=R[P]).type){case 20:(v=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),w=!0;break;case 21:(v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),I=!0;break;case 22:(v=t.BaseObject.borrowObject(t.DeformTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),S.push(v.vertexOffset)}}if(this.resetToPose&&(w||((v=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v)),I||((v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v)),null!==C.rawDisplayDatas))for(var O=0,N=C.rawDisplayDatas;O<N.length;O++){var M=N[O];if(null!==M&&2===M.type){var L=M.vertices.offset;S.indexOf(L)<0&&((v=t.BaseObject.borrowObject(t.DeformTimelineState)).vertexOffset=L,v.slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v))}}}}for(var p in y)for(var F=0,B=y[p];F<B.length;F++)v=B[F],this._slotTimelines.splice(this._slotTimelines.indexOf(v),1),v.returnToPool()},r.prototype._advanceFadeTime=function(e){var n,i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var r=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n))}(e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),r=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n)))},r.prototype.init=function(e,n,i){if(null===this._armature){if(this._armature=e,this._animationData=n,this.resetToPose=i.resetToPose,this.additiveBlending=i.additiveBlending,this.displayControl=i.displayControl,this.actionEnabled=i.actionEnabled,this.layer=i.layer,this.playTimes=i.playTimes,this.timeScale=i.timeScale,this.fadeTotalTime=i.fadeInTime,this.autoFadeOutTime=i.autoFadeOutTime,this.weight=i.weight,this.name=i.name.length>0?i.name:i.animation,this.group=i.group,i.pauseFadeIn?this._playheadState=2:this._playheadState=3,i.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==i.position?this.timeScale>=0?this._time=i.position:this._time=i.position-this._duration:this._time=0):(this._position=i.position,this._duration=i.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),i.boneMask.length>0){this._boneMask.length=i.boneMask.length;for(var r=0,a=this._boneMask.length;r<a;++r)this._boneMask[r]=i.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(e,n){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var i=0===this._fadeState&&n>0,r=!0,a=!0,o=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),i){var s=2*n;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*s)/s}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),i){var c=Math.floor(this._actionTimeline.currentTime*n);this._armature._cacheFrameIndex===c?(r=!1,a=!1):(this._armature._cacheFrameIndex=c,this._animationData.cachedFrames[c]?a=!1:this._animationData.cachedFrames[c]=!0)}if(r){if(a)for(var l=0,u=this._boneTimelines.length;l<u;++l)(p=this._boneTimelines[l]).playState<=0&&p.update(o),(l===u-1||p.bone!==this._boneTimelines[l+1].bone)&&0!==(h=p.bone._blendState.update(this._weightResult,this.layer))&&p.blend(h);for(l=0,u=this._surfaceTimelines.length;l<u;++l){var h=(p=this._surfaceTimelines[l]).surface._blendState.update(this._weightResult,this.layer);p.playState<=0&&p.update(o),0!==h&&p.blend(h)}if(this.displayControl)for(l=0,u=this._slotTimelines.length;l<u;++l){var f=(p=this._slotTimelines[l]).slot.displayController;null!==f&&f!==this.name&&f!==this.group||p.playState<=0&&p.update(o)}for(l=0,u=this._constraintTimelines.length;l<u;++l)(p=this._constraintTimelines[l]).playState<=0&&p.update(o);for(l=0,u=this._animationTimelines.length;l<u;++l)h=(p=this._animationTimelines[l]).animationState._blendState.update(this._weightResult,this.layer),p.playState<=0&&p.update(o),0!==h&&p.blend(h)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var _=0,d=this._poseTimelines;_<d.length;_++){var p;(p=d[_])instanceof t.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(p),1):p instanceof t.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(p),1):p instanceof t.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(p),1):p instanceof t.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(p),1),p.returnToPool()}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var n=0,i=this._boneTimelines;n<i.length;n++)(f=i[n]).fadeOut();for(var r=0,a=this._surfaceTimelines;r<a.length;r++)(f=a[r]).fadeOut();for(var o=0,s=this._slotTimelines;o<s.length;o++)(f=s[o]).fadeOut();for(var c=0,l=this._constraintTimelines;c<l.length;c++)(f=l[c]).fadeOut();for(var u=0,h=this._animationTimelines;u<h.length;u++){var f;(f=h[u]).animationState.fadeOut(t,e),f.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._armature.getBone(t);if(null!==n){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var i=0,r=this._armature.getBones();i<r.length;i++){var a=r[i];this._boneMask.indexOf(a.name)<0&&n.contains(a)&&this._boneMask.push(a.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._boneMask.indexOf(t);if(n>=0&&this._boneMask.splice(n,1),e){var i=this._armature.getBone(t);if(null!==i){var r=this._armature.getBones();if(this._boneMask.length>0)for(var a=0,o=r;a<o.length;a++){var s=o[a],c=this._boneMask.indexOf(s.name);c>=0&&i.contains(s)&&this._boneMask.splice(c,1)}else for(var l=0,u=r;l<u.length;l++)(s=u[l])!==i&&(i.contains(s)||this._boneMask.push(s.name))}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var n=0,i=this._boneTimelines;n<i.length;n++)i[n].playState=-1;for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.current=new t.Transform,n.delta=new t.Transform,n.result=new t.Transform,n}return k4(n,e),n.toString=function(){return"[class dragonBones.BonePose]"},n.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},n}(t.BaseObject);t.BonePose=n;var i=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();t.BlendState=i}(G4||(G4={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,n=this.currentPlayTimes,i=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,a=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=a||t<=-a)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==n||this.currentTime!==i)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==n)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,n){this._armature=t,this._animationState=e,this._timelineData=n,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),n=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==n&&(this._frameIndex=n,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e._getEasingValue=function(t,e,n){var i=e;switch(t){case 3:i=Math.pow(e,2);break;case 4:i=1-Math.pow(1-e,2);break;case 5:i=.5*(1-Math.cos(e*Math.PI))}return(i-e)*n+e},e._getEasingCurveValue=function(t,e,n,i){if(t<=0)return 0;if(t>=1)return 1;var r=n+1,a=Math.floor(t*r),o=0===a?0:e[i+a-1];return 1e-4*(o+((a===r-1?1e4:e[i+a])-o)*(t*r-a))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,n=this.bone.animationPose,i=this.bonePose.result;2===t?(n.x+=i.x*e,n.y+=i.y*e,n.rotation+=i.rotation*e,n.skew+=i.skew*e,n.scaleX+=(i.scaleX-1)*e,n.scaleY+=(i.scaleY-1)*e):1!==e?(n.x=i.x*e,n.y=i.y*e,n.rotation=i.rotation*e,n.skew=i.skew*e,n.scaleX=(i.scaleX-1)*e+1,n.scaleY=(i.scaleY-1)*e+1):(n.x=i.x,n.y=i.y,n.rotation=i.rotation,n.skew=i.skew,n.scaleX=i.scaleX,n.scaleY=i.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(n);t.BoneTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(n);t.SlotTimelineState=r;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(n);t.ConstraintTimelineState=a}(G4||(G4={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.toString=function(){return"[class dragonBones.ActionTimelineState]"},n.prototype._onCrossFrame=function(e){var n=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._frameArray[i+1],a=this._animationData.parent.actions,o=0;o<r;++o){var s=a[this._frameArray[i+2+o]];if(0===s.type)(c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._bufferAction(c,!0);else{var c,l=10===s.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;(11===s.type||n.hasDBEventListener(l))&&((c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._dragonBones.bufferEvent(c))}}},n.prototype._onArriveAtFrame=function(){},n.prototype._onUpdateFrame=function(){},n.prototype.update=function(e){var n=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(this._setCurrentTime(e)){var a=this._armature.eventDispatcher;if(n<0){if(this.playState===n)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),i=this.currentPlayTimes,a.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var s=this._animationState.timeScale<0,c=null,l=null;if(this.currentPlayTimes!==i&&(a.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,c.armature=this._armature,c.animationState=this._animationState),this.playState>0&&a.hasDBEventListener(t.EventObject.COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,l.armature=this._armature,l.animationState=this._animationState)),this._frameCount>1){var u=this._timelineData,h=Math.floor(this.currentTime*this._frameRate),f=this._frameIndices[u.frameIndicesOffset+h];if(this._frameIndex!==f){var _=this._frameIndex;if(this._frameIndex=f,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex],s){if(_<0){var d=Math.floor(r*this._frameRate);_=this._frameIndices[u.frameIndicesOffset+d],this.currentPlayTimes===i&&_===f&&(_=-1)}for(;_>=0;){var p=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[p]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(_),null!==c&&0===_&&(this._armature._dragonBones.bufferEvent(c),c=null),_>0?_--:_=this._frameCount-1,_===f)break}}else for(_<0&&(d=Math.floor(r*this._frameRate),_=this._frameIndices[u.frameIndicesOffset+d],p=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[p]/this._frameRate,this.currentPlayTimes===i&&(r<=m?_>0?_--:_=this._frameCount-1:_===f&&(_=-1)));_>=0&&(_<this._frameCount-1?_++:_=0,p=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[p]/this._frameRate,this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(_),null!==c&&0===_&&(this._armature._dragonBones.bufferEvent(c),c=null),_!==f););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],m=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===i?r<=m&&this._onCrossFrame(this._frameIndex):this._position<=m&&(s||null===c||(this._armature._dragonBones.bufferEvent(c),c=null),this._onCrossFrame(this._frameIndex)));null!==c&&this._armature._dragonBones.bufferEvent(c),null!==l&&this._armature._dragonBones.bufferEvent(l)}},n.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},n}(t.TimelineState);t.ActionTimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=n;var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[t++]*n,r.y=i[t++]*n,r.rotation=i[t++],r.skew=i[t++],r.scaleX=i[t++],r.scaleY=i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[t++]*n-r.x,a.y=i[t++]*n-r.y,a.rotation=i[t++]-r.rotation,a.skew=i[t++]-r.skew,a.scaleX=i[t++]-r.scaleX,a.scaleY=i[t++]-r.scaleY):(a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=1,r.scaleY=1,a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+n.x*this._tweenProgress,i.y=t.y+n.y*this._tweenProgress,i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress,i.scaleX=t.scaleX+n.scaleX*this._tweenProgress,i.scaleY=t.scaleY+n.scaleY*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneAllTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[e++]*n,r.y=i[e++]*n,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[e++]*n-r.x,a.y=i[e++]*n-r.y):(a.x=0,a.y=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,a.x=0,a.y=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=e.x+n.x*this._tweenProgress,i.y=e.y+n.y*this._tweenProgress},e}(t.BoneTimelineState);t.BoneTranslateTimelineState=r;var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var n=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.rotation=i[n++],r.skew=i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(n=this._animationData.frameFloatOffset+this._frameValueOffset,a.rotation=t.Transform.normalizeRadian(i[n++]-r.rotation)):a.rotation=i[n++]-r.rotation,a.skew=i[n++]-r.skew):(a.rotation=0,a.skew=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.rotation=0,r.skew=0,a.rotation=0,a.skew=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneRotateTimelineState=a;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.scaleX=n[e++],i.scaleY=n[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),r.scaleX=n[e++]-i.scaleX,r.scaleY=n[e++]-i.scaleY):(r.scaleX=0,r.scaleY=0)}else i=this.bonePose.current,r=this.bonePose.delta,i.scaleX=1,i.scaleY=1,r.scaleX=0,r.scaleY=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.scaleX=e.scaleX+n.scaleX*this._tweenProgress,i.scaleY=e.scaleY+n.scaleY*this._tweenProgress},e}(t.BoneTimelineState);t.BoneScaleTimelineState=o;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var a=0;a<this._valueCount;++a)this._delta[a]=0},e.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,n=this.surface._deformVertices,i=0;i<this._deformCount;++i){var r;r=i<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?this._result[i-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+i-this._valueCount],2===t?n[i]+=r*e:n[i]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},e}(t.TweenTimelineState);t.SurfaceTimelineState=s;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayTimelineState=c;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return k4(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,n=this._frameIntArray,i=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,r=n[i];r<0&&(r+=65536),this._current[0]=e[r++],this._current[1]=e[r++],this._current[2]=e[r++],this._current[3]=e[r++],this._current[4]=e[r++],this._current[5]=e[r++],this._current[6]=e[r++],this._current[7]=e[r++],2===this._tweenState&&((r=this._frameIndex===this._frameCount-1?n[this._animationData.frameIntOffset+this._frameValueOffset]:n[i+1])<0&&(r+=65536),this._delta[0]=e[r++]-this._current[0],this._delta[1]=e[r++]-this._current[1],this._delta[2]=e[r++]-this._current[2],this._delta[3]=e[r++]-this._current[3],this._delta[4]=e[r++]-this._current[4],this._delta[5]=e[r++]-this._current[5],this._delta[6]=e[r++]-this._current[6],this._delta[7]=e[r++]-this._current[7])}else{var a=this.slot._slotData.color;this._current[0]=100*a.alphaMultiplier,this._current[1]=100*a.redMultiplier,this._current[2]=100*a.greenMultiplier,this._current[3]=100*a.blueMultiplier,this._current[4]=a.alphaOffset,this._current[5]=a.redOffset,this._current[6]=a.greenOffset,this._current[7]=a.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var n=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(n.alphaMultiplier!==this._result[0]||n.redMultiplier!==this._result[1]||n.greenMultiplier!==this._result[2]||n.blueMultiplier!==this._result[3]||n.alphaOffset!==this._result[4]||n.redOffset!==this._result[5]||n.greenOffset!==this._result[6]||n.blueOffset!==this._result[7]){var i=Math.pow(this._animationState._fadeProgress,4);n.alphaMultiplier+=(this._result[0]-n.alphaMultiplier)*i,n.redMultiplier+=(this._result[1]-n.redMultiplier)*i,n.greenMultiplier+=(this._result[2]-n.greenMultiplier)*i,n.blueMultiplier+=(this._result[3]-n.blueMultiplier)*i,n.alphaOffset+=(this._result[4]-n.alphaOffset)*i,n.redOffset+=(this._result[5]-n.redOffset)*i,n.greenOffset+=(this._result[6]-n.greenOffset)*i,n.blueOffset+=(this._result[7]-n.blueOffset)*i,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,n.alphaMultiplier===this._result[0]&&n.redMultiplier===this._result[1]&&n.greenMultiplier===this._result[2]&&n.blueMultiplier===this._result[3]&&n.alphaOffset===this._result[4]&&n.redOffset===this._result[5]&&n.greenOffset===this._result[6]&&n.blueOffset===this._result[7]||(n.alphaMultiplier=this._result[0],n.redMultiplier=this._result[1],n.greenMultiplier=this._result[2],n.blueMultiplier=this._result[3],n.alphaOffset=this._result[4],n.redOffset=this._result[5],n.greenOffset=this._result[6],n.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=l;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return k4(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.vertexOffset=this._frameIntArray[r+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else{var a=this.slot._deformVertices;this._deformCount=null!==a?a.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0}this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var o=0;o<this._valueCount;++o)this._delta[o]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){var n=this.slot._deformVertices;if(null!==n&&null!==n.verticesData&&n.verticesData.offset===this.vertexOffset&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var i=n.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,2),a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]+=(this._frameFloatArray[this._frameFloatOffset+a]-i[a])*r:a<this._valueOffset+this._valueCount?i[a]+=(this._result[a-this._valueOffset]-i[a])*r:i[a]+=(this._frameFloatArray[this._frameFloatOffset+a-this._valueCount]-i[a])*r;n.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]=this._frameFloatArray[this._frameFloatOffset+a]:a<this._valueOffset+this._valueCount?i[a]=this._result[a-this._valueOffset]:i[a]=this._frameFloatArray[this._frameFloatOffset+a-this._valueCount];n.verticesDirty=!0}}},e}(t.SlotTimelineState);t.DeformTimelineState=u;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._delta=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this.constraint;if(null!==this._timelineData){var n=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameIntArray,r=0!==i[n++];this._current=.01*i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(n=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*i[n+1]-this._current):this._delta=0,e._bendPositive=r}else{var a=e._constraintData;this._current=a.weight,this._delta=0,e._bendPositive=a.bendPositive}e.invalidUpdate()},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var e=this.constraint;e._weight=this._current+this._delta*this._tweenProgress,e.invalidUpdate()},e}(t.ConstraintTimelineState);t.IKConstraintTimelineState=h;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._floats=[0,0,0,0,0,0],e}return k4(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.animationState=null},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,n=1/this.animationState._animationData.parent.frameRate,i=this._frameIntArray;this._floats[0]=i[e++]*n,this._floats[3]=.01*i[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=i[e++]*n-this._floats[0],this._floats[4]=.01*i[e++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},e.prototype.blend=function(t){var e=this.animationState,n=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*n,e.currentTime+=this._floats[2]*n):(e.weight=this._floats[5]*n,e.currentTime=this._floats[2]*n)},e}(t.TweenTimelineState);t.AnimationTimelineState=f}(G4||(G4={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k4(e,t),e.actionDataToInstance=function(t,n,i){0===t.type?n.type=e.FRAME_EVENT:n.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,n.name=t.name,n.armature=i,n.actionData=t,n.data=t.data,null!==t.bone&&(n.bone=i.getBone(t.bone.name)),null!==t.slot&&(n.slot=i.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(G4||(G4={})),function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},e._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},e._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},e._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},e._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},e.parseDragonBonesData=function(e){return console.warn("Deprecated."),e instanceof ArrayBuffer?t.BinaryDataParser.getInstance().parseDragonBonesData(e):t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(n,i){void 0===i&&(i=1),console.warn("");for(var r={},a=n[e.SUB_TEXTURE],o=0,s=a.length;o<s;o++){var c=a[o],l=c[e.NAME],u=new t.Rectangle,h=null;u.x=c[e.X]/i,u.y=c[e.Y]/i,u.width=c[e.WIDTH]/i,u.height=c[e.HEIGHT]/i,e.FRAME_WIDTH in c&&((h=new t.Rectangle).x=c[e.FRAME_X]/i,h.y=c[e.FRAME_Y]/i,h.width=c[e.FRAME_WIDTH]/i,h.height=c[e.FRAME_HEIGHT]/i),r[l]={region:u,frame:h,rotated:!1}}return r},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION=e.DATA_VERSION_5_5,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.IK="ik",e.PATH_CONSTRAINT="path",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.CANVAS="canvas",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.GLUE_WEIGHTS="glueWeights",e.GLUE_MESHES="glueMeshes",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();t.DataParser=e}(G4||(G4={})),function(t){var e=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n._rawTextureAtlasIndex=0,n._rawBones=[],n._data=null,n._armature=null,n._bone=null,n._surface=null,n._slot=null,n._skin=null,n._mesh=null,n._animation=null,n._timeline=null,n._rawTextureAtlases=null,n._defaultColorOffset=-1,n._prevClockwise=0,n._prevRotation=0,n._helpMatrixA=new t.Matrix,n._helpMatrixB=new t.Matrix,n._helpTransform=new t.Transform,n._helpColorTransform=new t.ColorTransform,n._helpPoint=new t.Point,n._helpArray=[],n._intArray=[],n._floatArray=[],n._frameIntArray=[],n._frameFloatArray=[],n._frameArray=[],n._timelineArray=[],n._cacheRawMeshes=[],n._cacheMeshes=[],n._actionFrames=[],n._weightSlotPose={},n._weightBonePoses={},n._cacheBones={},n._slotChildActions={},n}return k4(i,e),i._getBoolean=function(t,e,n){if(e in t){var i=t[e],r=typeof i;if("boolean"===r)return i;if("string"!==r)return!!i;switch(i){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return n},i._getNumber=function(t,e,n){if(e in t){var i=t[e];return null===i||"NaN"===i?n:+i||0}return n},i._getString=function(e,n,i){if(n in e){var r=e[n];if("string"==typeof r){if(t.DragonBones.webAssembly)for(var a=0,o=r.length;a<o;++a)if(r.charCodeAt(a)>255)return encodeURI(r);return r}return String(r)}return i},i.prototype._getCurvePoint=function(t,e,n,i,r,a,o,s,c,l){var u=1-c,h=u*u,f=c*c,_=u*h,d=3*c*h,p=3*u*f,m=c*f;l.x=_*t+d*n+p*r+m*o,l.y=_*e+d*i+p*a+m*s},i.prototype._samplingEasingCurve=function(t,e){for(var n=t.length,i=-2,r=0,a=e.length;r<a;++r){for(var o=(r+1)/(a+1);(i+6<n?t[i+6]:1)<o;)i+=6;for(var s=i>=0&&i+6<n,c=s?t[i]:0,l=s?t[i+1]:0,u=t[i+2],h=t[i+3],f=t[i+4],_=t[i+5],d=s?t[i+6]:1,p=s?t[i+7]:1,m=0,g=1;g-m>1e-4;){var v=.5*(g+m);this._getCurvePoint(c,l,u,h,f,_,d,p,v,this._helpPoint),o-this._helpPoint.x>0?m=v:g=v}e[r]=this._helpPoint.y}},i.prototype._parseActionDataInFrame=function(e,n,i,r){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],n,10,i,r),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],n,11,i,r),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],n,0,i,r),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],n,10,i,r),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],n,0,i,r)},i.prototype._mergeActionFrame=function(e,i,r,a,o){for(var s=t.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,c=this._parseActionData(e,r,a,o),l=0,u=null,h=0,f=c;h<f.length;h++){var _=f[h];this._armature.addAction(_,!1)}0===this._actionFrames.length&&((u=new n).frameStart=0,this._actionFrames.push(u),u=null);for(var d=0,p=this._actionFrames;d<p.length;d++){var m=p[d];if(m.frameStart===i){u=m;break}if(m.frameStart>i)break;l++}null===u&&((u=new n).frameStart=i,this._actionFrames.splice(l+1,0,u));for(var g=0;g<c.length;++g)u.actions.push(s+g)},i.prototype._parseArmature=function(e,n){var r=t.BaseObject.borrowObject(t.ArmatureData);if(r.name=i._getString(e,t.DataParser.NAME,""),r.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),r.scale=n,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?r.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):r.type=i._getNumber(e,t.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,t.DataParser.CANVAS in e){var a=e[t.DataParser.CANVAS],o=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in a?o.hasBackground=!0:o.hasBackground=!1,o.color=i._getNumber(a,t.DataParser.COLOR,0),o.x=i._getNumber(a,t.DataParser.X,0)*r.scale,o.y=i._getNumber(a,t.DataParser.Y,0)*r.scale,o.width=i._getNumber(a,t.DataParser.WIDTH,0)*r.scale,o.height=i._getNumber(a,t.DataParser.HEIGHT,0)*r.scale,r.canvas=o}if(t.DataParser.AABB in e){var s=e[t.DataParser.AABB];r.aabb.x=i._getNumber(s,t.DataParser.X,0)*r.scale,r.aabb.y=i._getNumber(s,t.DataParser.Y,0)*r.scale,r.aabb.width=i._getNumber(s,t.DataParser.WIDTH,0)*r.scale,r.aabb.height=i._getNumber(s,t.DataParser.HEIGHT,0)*r.scale}if(t.DataParser.BONE in e)for(var c=0,l=e[t.DataParser.BONE];c<l.length;c++){var u=l[c],h=i._getString(u,t.DataParser.PARENT,""),f=this._parseBone(u);if(h.length>0){var _=r.getBone(h);null!==_?f.parent=_:(h in this._cacheBones||(this._cacheBones[h]=[]),this._cacheBones[h].push(f))}if(f.name in this._cacheBones){for(var d=0,p=this._cacheBones[f.name];d<p.length;d++)p[d].parent=f;delete this._cacheBones[f.name]}r.addBone(f),this._rawBones.push(f)}if(t.DataParser.IK in e)for(var m=0,g=e[t.DataParser.IK];m<g.length;m++){var v=g[m];(I=this._parseIKConstraint(v))&&r.addConstraint(I)}if(r.sortBones(),t.DataParser.SLOT in e)for(var y=0,S=0,T=e[t.DataParser.SLOT];S<T.length;S++){var x=T[S];r.addSlot(this._parseSlot(x,y++))}if(t.DataParser.SKIN in e)for(var E=0,A=e[t.DataParser.SKIN];E<A.length;E++){var C=A[E];r.addSkin(this._parseSkin(C))}if(t.DataParser.PATH_CONSTRAINT in e)for(var b=0,w=e[t.DataParser.PATH_CONSTRAINT];b<w.length;b++){var I,P=w[b];(I=this._parsePathConstraint(P))&&r.addConstraint(I)}for(var R=0,D=this._cacheRawMeshes.length;R<D;++R){var O=this._cacheRawMeshes[R];t.DataParser.GLUE_WEIGHTS in O&&t.DataParser.GLUE_MESHES in O&&this._parseMeshGlue(O,this._cacheMeshes[R])}for(R=0,D=this._cacheRawMeshes.length;R<D;++R){var N=this._cacheRawMeshes[R],M=i._getString(N,t.DataParser.SHARE,"");if(0!==M.length){var L=i._getString(N,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===L.length&&(L=t.DataParser.DEFAULT_NAME);var F=r.getMesh(L,"",M);null!==F&&this._cacheMeshes[R].vertices.shareFrom(F.vertices)}}if(t.DataParser.ANIMATION in e)for(var B=0,z=e[t.DataParser.ANIMATION];B<z.length;B++){var U=z[B],k=this._parseAnimation(U);r.addAnimation(k)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var G=0,V=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);G<V.length;G++){var H=V[G];r.addAction(H,!0),0===H.type&&null!==(k=r.getAnimation(H.name))&&(r.defaultAnimation=k)}if(t.DataParser.ACTIONS in e)for(var W=0,j=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);W<j.length;W++)H=j[W],r.addAction(H,!1);for(var X in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[X];for(var X in this._weightBonePoses)delete this._weightBonePoses[X];for(var X in this._cacheBones)delete this._cacheBones[X];for(var X in this._slotChildActions)delete this._slotChildActions[X];return r},i.prototype._parseBone=function(e){var n=this._armature.scale;if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,0))){var r=t.BaseObject.borrowObject(t.BoneData);return r.inheritTranslation=i._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),r.inheritRotation=i._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),r.inheritScale=i._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),r.inheritReflection=i._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),r.length=i._getNumber(e,t.DataParser.LENGTH,0)*n,r.name=i._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],r.transform,n),r}var a=t.BaseObject.borrowObject(t.SurfaceData);if(a.name=i._getString(e,t.DataParser.NAME,""),a.segmentX=i._getNumber(e,t.DataParser.SEGMENT_X,0),a.segmentY=i._getNumber(e,t.DataParser.SEGMENT_Y,0),a.vertices.length=(a.segmentX+1)*(a.segmentY+1)*2,t.DataParser.VERTICES in e)for(var o=e[t.DataParser.VERTICES],s=0,c=a.vertices.length;s<c;++s)s<o.length?a.vertices[s]=o[s]*n:a.vertices[s]=0;return a},i.prototype._parseIKConstraint=function(e){var n=this._armature.getBone(i._getString(e,t.DataParser.BONE,""));if(null===n)return null;var r=this._armature.getBone(i._getString(e,t.DataParser.TARGET,""));if(null===r)return null;var a=t.BaseObject.borrowObject(t.IKConstraintData);return a.scaleEnabled=i._getBoolean(e,t.DataParser.SCALE,!1),a.bendPositive=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),a.weight=i._getNumber(e,t.DataParser.WEIGHT,1),a.name=i._getString(e,t.DataParser.NAME,""),a.type=0,a.target=r,i._getNumber(e,t.DataParser.CHAIN,0)>0&&null!==n.parent?(a.root=n.parent,a.bone=n):(a.root=n,a.bone=null),a},i.prototype._parsePathConstraint=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var r=this._armature.defaultSkin;if(null===r)return null;var a=r.getDisplay(n.name,i._getString(e,t.DataParser.TARGET_DISPLAY,n.name));if(null===a||!(a instanceof t.PathDisplayData))return null;var o=e[t.DataParser.BONES];if(null===o||0===o.length)return null;var s=t.BaseObject.borrowObject(t.PathConstraintData);s.name=i._getString(e,t.DataParser.NAME,""),s.type=1,s.pathSlot=n,s.pathDisplayData=a,s.target=n.parent,s.positionMode=t.DataParser._getPositionMode(i._getString(e,t.DataParser.POSITION_MODE,"")),s.spacingMode=t.DataParser._getSpacingMode(i._getString(e,t.DataParser.SPACING_MODE,"")),s.rotateMode=t.DataParser._getRotateMode(i._getString(e,t.DataParser.ROTATE_MODE,"")),s.position=i._getNumber(e,t.DataParser.POSITION,0),s.spacing=i._getNumber(e,t.DataParser.SPACING,0),s.rotateOffset=i._getNumber(e,t.DataParser.ROTATE_OFFSET,0),s.rotateMix=i._getNumber(e,t.DataParser.ROTATE_MIX,1),s.translateMix=i._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var c=0,l=o;c<l.length;c++){var u=l[c],h=this._armature.getBone(u);null!==h&&(s.AddBone(h),null===s.root&&(s.root=h))}return s},i.prototype._parseSlot=function(e,n){var r=t.BaseObject.borrowObject(t.SlotData);return r.displayIndex=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),r.zOrder=n,r.name=i._getString(e,t.DataParser.NAME,""),r.parent=this._armature.getBone(i._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?r.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):r.blendMode=i._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(r.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],r.color)):r.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[r.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),r},i.prototype._parseSkin=function(e){var n=t.BaseObject.borrowObject(t.SkinData);if(n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var r=e[t.DataParser.SLOT];this._skin=n;for(var a=0,o=r;a<o.length;a++){var s=o[a],c=i._getString(s,t.DataParser.NAME,""),l=this._armature.getSlot(c);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in s)for(var u=0,h=s[t.DataParser.DISPLAY];u<h.length;u++){var f=h[u];f?n.addDisplay(c,this._parseDisplay(f)):n.addDisplay(c,null)}this._slot=null}}this._skin=null}return n},i.prototype._parseDisplay=function(e){var n=i._getString(e,t.DataParser.NAME,""),r=i._getString(e,t.DataParser.PATH,""),a=0,o=null;switch(a=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,a)){case 0:var s=o=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=n,s.path=r.length>0?r:n,this._parsePivot(e,s);break;case 1:var c=o=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(c.name=n,c.path=r.length>0?r:n,c.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,u=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<u.length;l++){var h=u[l];c.addAction(h)}else if(this._slot.name in this._slotChildActions){var f=this._skin.getDisplays(this._slot.name);if(null===f?0===this._slot.displayIndex:this._slot.displayIndex===f.length){for(var _=0,d=this._slotChildActions[this._slot.name];_<d.length;_++)h=d[_],c.addAction(h);delete this._slotChildActions[this._slot.name]}}break;case 2:var p=o=t.BaseObject.borrowObject(t.MeshDisplayData);p.vertices.inheritDeform=i._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),p.name=n,p.path=r.length>0?r:n,p.vertices.data=this._data,t.DataParser.SHARE in e?(this._cacheRawMeshes.push(e),this._cacheMeshes.push(p)):this._parseMesh(e,p),t.DataParser.GLUE_WEIGHTS in e&&t.DataParser.GLUE_MESHES in e&&(this._cacheRawMeshes.push(e),this._cacheMeshes.push(p));break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var g=o=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);g.name=n,g.path=r.length>0?r:n,g.boundingBox=m}break;case 4:var v=e[t.DataParser.LENGTHS],y=o=t.BaseObject.borrowObject(t.PathDisplayData);y.closed=i._getBoolean(e,t.DataParser.CLOSED,!1),y.constantSpeed=i._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),y.name=n,y.path=r.length>0?r:n,y.vertices.data=this._data,y.curveLengths.length=v.length;for(var S=0,T=v.length;S<T;++S)y.curveLengths[S]=v[S];this._parsePath(e,y)}return null!==o&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],o.transform,this._armature.scale),o},i.prototype._parsePath=function(e,n){var r=e[t.DataParser.VERTICES],a=i._getNumber(e,t.DataParser.VERTEX_COUNT,0),o=this._floatArray.length,s=this._intArray.length;if(n.vertices.offset=s,this._intArray.length+=2,this._intArray[s+0]=a,this._intArray[s+2]=o,t.DataParser.WEIGHTS in e){var c=e[t.DataParser.WEIGHTS],l=e[t.DataParser.BONES],u=l.length,h=Math.floor(c.length-a)/2,f=this._intArray.length,_=this._floatArray.length,d=this._armature.sortedBones,p=t.BaseObject.borrowObject(t.WeightData);for(p.count=h,p.offset=f,this._intArray.length+=2+u+a+h,this._intArray[f+0]=u,this._intArray[f+1]=_,I=0;I<u;I++){var m=l[I],g=this._rawBones[m];p.addBone(g),this._intArray[f+2+I]=d.indexOf(g)}this._floatArray.length+=3*h,I=0;for(var v=0,y=0,S=f+2+u,T=_;I<h;I++){var x=c[v++];this._intArray[S++]=x;for(var E=0;E<x;E++){var A=c[v++],C=c[v++],b=r[y++],w=r[y++];this._intArray[S++]=l.indexOf(A),this._floatArray[T++]=C,this._floatArray[T++]=b,this._floatArray[T++]=w}}n.vertices.weight=p}else{this._floatArray.length+=r.length;for(var I=0,P=r.length;I<P;++I)this._floatArray[o+I]=r[I]}},i.prototype._parsePivot=function(e,n){if(t.DataParser.PIVOT in e){var r=e[t.DataParser.PIVOT];n.pivot.x=i._getNumber(r,t.DataParser.X,0),n.pivot.y=i._getNumber(r,t.DataParser.Y,0)}else n.pivot.x=.5,n.pivot.y=.5},i.prototype._parseMesh=function(e,n){var i=e[t.DataParser.VERTICES],r=e[t.DataParser.UVS],a=e[t.DataParser.TRIANGLES],o=Math.floor(i.length/2),s=Math.floor(a.length/3),c=this._floatArray.length,l=c+2*o,u=this._intArray.length,h=this._skin.name+"_"+this._slot.name+"_"+n.name;n.vertices.offset=u,this._intArray.length+=4+3*s,this._intArray[u+0]=o,this._intArray[u+1]=s,this._intArray[u+2]=c;for(var f=0,_=3*s;f<_;++f)this._intArray[u+4+f]=a[f];for(this._floatArray.length+=2*o+2*o,f=0,_=2*o;f<_;++f)this._floatArray[c+f]=i[f],this._floatArray[l+f]=r[f];if(t.DataParser.WEIGHTS in e){var d=e[t.DataParser.WEIGHTS],p=e[t.DataParser.SLOT_POSE],m=e[t.DataParser.BONE_POSE],g=this._armature.sortedBones,v=new Array,y=Math.floor(m.length/7),S=this._floatArray.length,T=Math.floor(d.length-o)/2,x=this._intArray.length,E=t.BaseObject.borrowObject(t.WeightData);for(E.count=T,E.offset=x,v.length=y,this._intArray.length+=2+y+o+T,this._intArray[x+1]=S,f=0;f<y;++f){var A=m[7*f],C=this._rawBones[A];E.addBone(C),v[f]=A,this._intArray[x+2+f]=g.indexOf(C)}this._floatArray.length+=3*T,this._helpMatrixA.copyFromArray(p,0),f=0;for(var b=0,w=x+2+y,I=S;f<o;++f){var P=2*f,R=this._intArray[w++]=d[b++],D=this._floatArray[c+P],O=this._floatArray[c+P+1];this._helpMatrixA.transformPoint(D,O,this._helpPoint),D=this._helpPoint.x,O=this._helpPoint.y;for(var N=0;N<R;++N){A=d[b++];var M=v.indexOf(A);this._helpMatrixB.copyFromArray(m,7*M+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(D,O,this._helpPoint),this._intArray[w++]=M,this._floatArray[I++]=d[b++],this._floatArray[I++]=this._helpPoint.x,this._floatArray[I++]=this._helpPoint.y}}n.vertices.weight=E,this._weightSlotPose[h]=p,this._weightBonePoses[h]=m}},i.prototype._parseMeshGlue=function(){},i.prototype._parseBoundingBox=function(e){var n=null,r=0;switch(r=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):i._getNumber(e,t.DataParser.SUB_TYPE,r)){case 0:n=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:n=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:n=this._parsePolygonBoundingBox(e)}return null!==n&&(n.color=i._getNumber(e,t.DataParser.COLOR,0),0!==n.type&&1!==n.type||(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0))),n},i.prototype._parsePolygonBoundingBox=function(e){var n=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var i=this._armature.scale,r=e[t.DataParser.VERTICES],a=n.vertices;t.DragonBones.webAssembly?a.resize(r.length,0):a.length=r.length;for(var o=0,s=r.length;o<s;o+=2){var c=r[o]*i,l=r[o+1]*i;t.DragonBones.webAssembly?(a.set(o,c),a.set(o+1,l)):(a[o]=c,a[o+1]=l),0===o?(n.x=c,n.y=l,n.width=c,n.height=l):(c<n.x?n.x=c:c>n.width&&(n.width=c),l<n.y?n.y=l:l>n.height&&(n.height=l))}n.width-=n.x,n.height-=n.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return n},i.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);if(n.frameCount=Math.max(i._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=i._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=i._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=i._getNumber(e,t.DataParser.SCALE,1),n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),n.frameIntOffset=this._frameIntArray.length,n.frameFloatOffset=this._frameFloatArray.length,n.frameOffset=this._frameArray.length,this._animation=n,t.DataParser.FRAME in e){var r=e[t.DataParser.FRAME],a=r.length;if(a>0)for(var o=0,s=0;o<a;++o){var c=r[o];this._parseActionDataInFrame(c,s,null,null),s+=i._getNumber(c,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,u=e[t.DataParser.BONE];l<u.length;l++){var h=u[l];this._parseBoneTimeline(h)}if(t.DataParser.SURFACE in e)for(var f=0,_=e[t.DataParser.SURFACE];f<_.length;f++){h=_[f];var d=i._getString(h,t.DataParser.NAME,"");this._surface=this._armature.getBone(d),null!==this._surface&&(null!==(I=this._parseTimeline(h,null,t.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,I),this._surface=null)}if(t.DataParser.SLOT in e)for(var p=0,m=e[t.DataParser.SLOT];p<m.length;p++)h=m[p],this._parseSlotTimeline(h);if(t.DataParser.FFD in e)for(var g=0,v=e[t.DataParser.FFD];g<v.length;g++){h=v[g];var y=i._getString(h,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),S=i._getString(h,t.DataParser.SLOT,""),T=i._getString(h,t.DataParser.NAME,"");0===y.length&&(y=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(S),this._mesh=this._armature.getMesh(y,S,T),null!==this._slot&&null!==this._mesh&&(null!==(I=this._parseTimeline(h,null,t.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,I),this._slot=null,this._mesh=null)}if(t.DataParser.IK in e)for(var x=0,E=e[t.DataParser.IK];x<E.length;x++){h=E[x];var A=i._getString(h,t.DataParser.NAME,""),C=this._armature.getConstraint(A);null!==C&&null!==(I=this._parseTimeline(h,null,t.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(C,I)}if(t.DataParser.ANIMATION in e)for(var b=0,w=e[t.DataParser.ANIMATION];b<w.length;b++){h=w[b];var I,P=i._getString(h,t.DataParser.NAME,"");null!==(I=this._parseTimeline(h,null,t.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(P,I)}return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,n},i.prototype._parseTimeline=function(e,r,a,o,s,c,l,u){if(null!==e&&a.length>0&&a in e&&(r=e[a]),null===r)return null;var h=r.length;if(0===h)return null;var f=this._frameIntArray.length,_=this._frameFloatArray.length,d=t.BaseObject.borrowObject(t.TimelineData),p=this._timelineArray.length;if(this._timelineArray.length+=5+h,null!==e?(this._timelineArray[p+0]=Math.round(100*i._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[p+1]=Math.round(100*i._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[p+0]=100,this._timelineArray[p+1]=0),this._timelineArray[p+2]=h,this._timelineArray[p+3]=l,this._timelineArray[p+4]=s?f-this._animation.frameIntOffset:c?_-this._animation.frameFloatOffset:0,this._timeline=d,d.type=o,d.offset=p,1===h)d.frameIndicesOffset=-1,this._timelineArray[p+5+0]=u.call(this,r[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,g=this._data.frameIndices,v=0;t.DragonBones.webAssembly?(v=g.size(),g.resize(v+m,0)):(v=g.length,g.length+=m),d.frameIndicesOffset=v;for(var y=0,S=0,T=0,x=0;y<m;++y){if(T+x<=y&&S<h){var E=r[S];T=y,x=S===h-1?this._animation.frameCount-T:E instanceof n?this._actionFrames[S+1].frameStart-T:i._getNumber(E,t.DataParser.DURATION,1),this._timelineArray[p+5+S]=u.call(this,E,T,x)-this._animation.frameOffset,S++}t.DragonBones.webAssembly?g.set(v+y,S-1):g[v+y]=S-1}}return this._timeline=null,d},i.prototype._parseBoneTimeline=function(e){var n,r=this._armature.getBone(i._getString(e,t.DataParser.NAME,""));null!==r&&(this._bone=r,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.ROTATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.SCALE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(r,n),this._bone=null,this._slot=null)},i.prototype._parseSlotTimeline=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.NAME,""));if(null!==n){this._slot=n;var r;null!==(r=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(n,r);var a;null!==(a=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(n,a),this._slot=null}},i.prototype._parseFrame=function(t,e){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},i.prototype._parseTweenFrame=function(e,n,r){var a=this._parseFrame(e,n,r);if(r>0)if(t.DataParser.CURVE in e){var o=r+1;this._helpArray.length=o,this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[a+1]=2,this._frameArray[a+2]=o;for(var s=0;s<o;++s)this._frameArray[a+3+s]=Math.round(1e4*this._helpArray[s])}else{var c=-2;t.DataParser.TWEEN_EASING in e&&(c=i._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===c?(this._frameArray.length+=1,this._frameArray[a+1]=0):0===c?(this._frameArray.length+=1,this._frameArray[a+1]=1):c<0?(this._frameArray.length+=2,this._frameArray[a+1]=3,this._frameArray[a+2]=Math.round(100*-c)):c<=1?(this._frameArray.length+=2,this._frameArray[a+1]=4,this._frameArray[a+2]=Math.round(100*c)):(this._frameArray.length+=2,this._frameArray[a+1]=5,this._frameArray[a+2]=Math.round(100*c-100))}else this._frameArray.length+=1,this._frameArray[a+1]=0;return a},i.prototype._parseActionFrame=function(t,e){var n=this._frameArray.length,i=t.actions.length;this._frameArray.length+=2+i,this._frameArray[n+0]=e,this._frameArray[n+0+1]=i;for(var r=0;r<i;++r)this._frameArray[n+0+2+r]=t.actions[r];return n},i.prototype._parseZOrderFrame=function(e,n,i){var r=this._parseFrame(e,n,i);if(t.DataParser.Z_ORDER in e){var a=e[t.DataParser.Z_ORDER];if(a.length>0){for(var o=this._armature.sortedSlots.length,s=new Array(o-a.length/2),c=new Array(o),l=0;l<s.length;++l)s[l]=0;for(var u=0;u<o;++u)c[u]=-1;for(var h=0,f=0,_=0,d=a.length;_<d;_+=2){for(var p=a[_],m=a[_+1];h!==p;)s[f++]=h++;c[h+m]=h++}for(;h<o;)s[f++]=h++;this._frameArray.length+=1+o,this._frameArray[r+1]=o;for(var g=o;g--;)-1===c[g]?this._frameArray[r+2+g]=s[--f]||0:this._frameArray[r+2+g]=c[g]||0;return r}}return this._frameArray.length+=1,this._frameArray[r+1]=0,r},i.prototype._parseBoneAllFrame=function(e,n,r){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var a=this._helpTransform.rotation;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[s++]=this._helpTransform.x,this._frameFloatArray[s++]=this._helpTransform.y,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=this._helpTransform.skew,this._frameFloatArray[s++]=this._helpTransform.scaleX,this._frameFloatArray[s++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,n,this._bone,this._slot),o},i.prototype._parseBoneTranslateFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,0),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,0),a},i.prototype._parseBoneRotateFrame=function(e,n,r){var a=i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,o},i.prototype._parseBoneScaleFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,1),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,1),a},i.prototype._parseSurfaceFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=e[t.DataParser.VERTICES],c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._surface.vertices.length/2,u=0,h=0;this._frameFloatArray.length+=2*l;for(var f=0;f<2*l;f+=2)u=f<c||f-c>=s.length?0:s[f-c],h=f+1<c||f+1-c>=s.length?0:s[f+1-c],this._frameFloatArray[a+f]=u,this._frameFloatArray[a+f+1]=h;if(0===n){var _=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[_+0]=0,this._frameIntArray[_+1]=this._frameFloatArray.length-a,this._frameIntArray[_+2]=this._frameFloatArray.length-a,this._frameIntArray[_+3]=0,this._frameIntArray[_+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=_-this._animation.frameIntOffset}return o},i.prototype._parseSlotDisplayFrame=function(e,n,r){var a=this._parseFrame(e,n,r);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[a+1]=i._getNumber(e,t.DataParser.VALUE,0):this._frameArray[a+1]=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,n,this._slot.parent,this._slot),a},i.prototype._parseSlotColorFrame=function(e,n,i){var r=this._parseTweenFrame(e,n,i),a=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var o=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var s in o){this._parseColorTransform(o,this._helpColorTransform),a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[a++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[a++]=Math.round(this._helpColorTransform.redOffset),this._intArray[a++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[a++]=Math.round(this._helpColorTransform.blueOffset),a-=8;break}}a<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0),a=this._defaultColorOffset);var c=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[c]=a,r},i.prototype._parseSlotFFDFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.vertices.offset+0],u=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,h=this._mesh.vertices.weight,f=0,_=0,d=0,p=0;if(null!==h){var m=this._weightSlotPose[u];this._helpMatrixA.copyFromArray(m,0),this._frameFloatArray.length+=2*h.count,d=h.offset+2+h.bones.length}else this._frameFloatArray.length+=2*l;for(var g=0;g<2*l;g+=2)if(null===s?(f=0,_=0):(f=g<c||g-c>=s.length?0:s[g-c],_=g+1<c||g+1-c>=s.length?0:s[g+1-c]),null!==h){var v=this._weightBonePoses[u],y=this._intArray[d++];this._helpMatrixA.transformPoint(f,_,this._helpPoint,!0),f=this._helpPoint.x,_=this._helpPoint.y;for(var S=0;S<y;++S){var T=this._intArray[d++];this._helpMatrixB.copyFromArray(v,7*T+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(f,_,this._helpPoint,!0),this._frameFloatArray[a+p++]=this._helpPoint.x,this._frameFloatArray[a+p++]=this._helpPoint.y}}else this._frameFloatArray[a+g]=f,this._frameFloatArray[a+g+1]=_;if(0===n){var x=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[x+0]=this._mesh.vertices.offset,this._frameIntArray[x+1]=this._frameFloatArray.length-a,this._frameIntArray[x+2]=this._frameFloatArray.length-a,this._frameIntArray[x+3]=0,this._frameIntArray[x+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=x-this._animation.frameIntOffset}return o},i.prototype._parseIKConstraintFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseAnimationFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getNumber(e,t.DataParser.VALUE,0),this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseActionData=function(e,n,r,a){var o=new Array;if("string"==typeof e)(u=t.BaseObject.borrowObject(t.ActionData)).type=n,u.name=e,u.bone=r,u.slot=a,o.push(u);else if(e instanceof Array)for(var s=0,c=e;s<c.length;s++){var l=c[s],u=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(u.type=0,u.name=i._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?u.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):u.type=i._getNumber(l,t.DataParser.TYPE,n),u.name=i._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var h=i._getString(l,t.DataParser.BONE,"");u.bone=this._armature.getBone(h)}else u.bone=r;if(t.DataParser.SLOT in l){var f=i._getString(l,t.DataParser.SLOT,"");u.slot=this._armature.getSlot(f)}else u.slot=a;var _=null;if(t.DataParser.INTS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var d=0,p=l[t.DataParser.INTS];d<p.length;d++){var m=p[d];_.addInt(m)}}if(t.DataParser.FLOATS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var g=0,v=l[t.DataParser.FLOATS];g<v.length;g++)m=v[g],_.addFloat(m)}if(t.DataParser.STRINGS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var y=0,S=l[t.DataParser.STRINGS];y<S.length;y++)m=S[y],_.addString(m)}u.data=_,o.push(u)}return o},i.prototype._parseTransform=function(e,n,r){n.x=i._getNumber(e,t.DataParser.X,0)*r,n.y=i._getNumber(e,t.DataParser.Y,0)*r,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-n.rotation),n.scaleX=i._getNumber(e,t.DataParser.SCALE_X,1),n.scaleY=i._getNumber(e,t.DataParser.SCALE_Y,1)},i.prototype._parseColorTransform=function(e,n){n.alphaMultiplier=.01*i._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),n.redMultiplier=.01*i._getNumber(e,t.DataParser.RED_MULTIPLIER,100),n.greenMultiplier=.01*i._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),n.blueMultiplier=.01*i._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),n.alphaOffset=i._getNumber(e,t.DataParser.ALPHA_OFFSET,0),n.redOffset=i._getNumber(e,t.DataParser.RED_OFFSET,0),n.greenOffset=i._getNumber(e,t.DataParser.GREEN_OFFSET,0),n.blueOffset=i._getNumber(e,t.DataParser.BLUE_OFFSET,0)},i.prototype._parseArray=function(){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},i.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,a=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=e+n+i+r+a+o;if(t.DragonBones.webAssembly){for(var c=t.webAssemblyModule.HEAP16.buffer,l=t.webAssemblyModule._malloc(s),u=new Int16Array(c,l,this._intArray.length),h=new Float32Array(c,l+e,this._floatArray.length),f=new Int16Array(c,l+e+n,this._frameIntArray.length),_=new Float32Array(c,l+e+n+i,this._frameFloatArray.length),d=new Int16Array(c,l+e+n+i+r,this._frameArray.length),p=new Uint16Array(c,l+e+n+i+r+a,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)u[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)h[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)f[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)_[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)d[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)p[m]=this._timelineArray[m];t.webAssemblyModule.setDataBinary(this._data,l,e,n,i,r,a,o)}else{var v=new ArrayBuffer(s);for(u=new Int16Array(v,0,this._intArray.length),h=new Float32Array(v,e,this._floatArray.length),f=new Int16Array(v,e+n,this._frameIntArray.length),_=new Float32Array(v,e+n+i,this._frameFloatArray.length),d=new Int16Array(v,e+n+i+r,this._frameArray.length),p=new Uint16Array(v,e+n+i+r+a,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)u[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)h[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)f[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)_[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)d[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)p[m]=this._timelineArray[m];this._data.binary=v,this._data.intArray=u,this._data.floatArray=h,this._data.frameIntArray=f,this._data.frameFloatArray=_,this._data.frameArray=d,this._data.timelineArray=p}this._defaultColorOffset=-1},i.prototype.parseDragonBonesData=function(e,n){void 0===n&&(n=1),console.assert(null!=e,"Data error.");var r=i._getString(e,t.DataParser.VERSION,""),a=i._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(r)>=0||t.DataParser.DATA_VERSIONS.indexOf(a)>=0){var o=t.BaseObject.borrowObject(t.DragonBonesData);if(o.version=r,o.name=i._getString(e,t.DataParser.NAME,""),o.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),t.DataParser.ARMATURE in e){this._data=o,this._parseArray(e);for(var s=0,c=e[t.DataParser.ARMATURE];s<c.length;s++){var l=c[s];o.addArmature(this._parseArmature(l,n))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?o.stage=o.getArmature(i._getString(e,t.DataParser.STAGE,"")):o.armatureNames.length>0&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+r+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},i.prototype.parseTextureAtlasData=function(e,n,r){if(void 0===r&&(r=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var a=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(a,n,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0),n.scale=1===r?1/i._getNumber(e,t.DataParser.SCALE,1):r,n.name=i._getString(e,t.DataParser.NAME,""),n.imagePath=i._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var o=e[t.DataParser.SUB_TEXTURE],s=0,c=o.length;s<c;++s){var l=o[s],u=n.createTexture();u.rotated=i._getBoolean(l,t.DataParser.ROTATED,!1),u.name=i._getString(l,t.DataParser.NAME,""),u.region.x=i._getNumber(l,t.DataParser.X,0),u.region.y=i._getNumber(l,t.DataParser.Y,0),u.region.width=i._getNumber(l,t.DataParser.WIDTH,0),u.region.height=i._getNumber(l,t.DataParser.HEIGHT,0);var h=i._getNumber(l,t.DataParser.FRAME_WIDTH,-1),f=i._getNumber(l,t.DataParser.FRAME_HEIGHT,-1);h>0&&f>0&&(u.frame=t.TextureData.createRectangle(),u.frame.x=i._getNumber(l,t.DataParser.FRAME_X,0),u.frame.y=i._getNumber(l,t.DataParser.FRAME_Y,0),u.frame.width=h,u.frame.height=f),n.addTexture(u)}return!0},i.getInstance=function(){return null===i._objectDataParserInstance&&(i._objectDataParserInstance=new i),i._objectDataParserInstance},i._objectDataParserInstance=null,i}(t.DataParser);t.ObjectDataParser=e;var n=function(){this.frameStart=0,this.actions=[]};t.ActionFrame=n}(G4||(G4={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return k4(n,e),n.prototype._inRange=function(t,e,n){return e<=t&&t<=n},n.prototype._decodeUTF8=function(t){for(var e,n=0,i="",r=0,a=0,o=0,s=0;t.length>n;){var c=t[n++];if(-1===c)e=0!==a?65533:-1;else if(0===a)this._inRange(c,0,127)?e=c:(this._inRange(c,194,223)?(a=1,s=128,r=c-192):this._inRange(c,224,239)?(a=2,s=2048,r=c-224):this._inRange(c,240,244)&&(a=3,s=65536,r=c-240),r*=Math.pow(64,a),e=null);else if(this._inRange(c,128,191))if(o+=1,r+=(c-128)*Math.pow(64,a-o),o!==a)e=null;else{var l=r,u=s;r=0,a=0,o=0,s=0,e=this._inRange(l,u,1114111)&&!this._inRange(l,55296,57343)?l:c}else r=0,a=0,o=0,s=0,n--,e=c;null!==e&&-1!==e&&(e<=65535?e>0&&(i+=String.fromCharCode(e)):(e-=65536,i+=String.fromCharCode(55296+(e>>10&1023)),i+=String.fromCharCode(56320+(1023&e))))}return i},n.prototype._getUTF16Key=function(t){for(var e=0,n=t.length;e<n;++e)if(t.charCodeAt(e)>255)return encodeURI(t);return t},n.prototype._parseBinaryTimeline=function(e,n,i){void 0===i&&(i=null);var r=null!==i?i:t.BaseObject.borrowObject(t.TimelineData);r.type=e,r.offset=n,this._timeline=r;var a=this._timelineArrayBuffer[r.offset+2];if(1===a)r.frameIndicesOffset=-1;else{var o=0,s=this._animation.frameCount+1,c=this._data.frameIndices;t.DragonBones.webAssembly?(o=c.size(),c.resize(o+s,0)):(o=c.length,c.length+=s),r.frameIndicesOffset=o;for(var l=0,u=0,h=0,f=0;l<s;++l)h+f<=l&&u<a&&(h=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+u]],f=u===a-1?this._animation.frameCount-h:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+u+1]]-h,u++),t.DragonBones.webAssembly?c.set(o+l,u-1):c[o+l]=u-1}return this._timeline=null,r},n.prototype._parseVertices=function(e,n){n.offset=e[t.DataParser.OFFSET];var i=this._intArrayBuffer[n.offset+3];if(i>=0){var r=t.BaseObject.borrowObject(t.WeightData),a=this._intArrayBuffer[n.offset+0],o=this._intArrayBuffer[i+0];r.offset=i;for(var s=0;s<o;++s){var c=this._intArrayBuffer[i+2+s];r.addBone(this._rawBones[c])}for(var l=i+2+o,u=0,h=(s=0,a);s<h;++s){var f=this._intArrayBuffer[l++];u+=f,l+=f}r.count=u,n.weight=r}},n.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);n.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),n.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME);var i=e[t.DataParser.OFFSET];if(n.frameIntOffset=i[0],n.frameFloatOffset=i[1],n.frameOffset=i[2],this._animation=n,t.DataParser.ACTION in e&&(n.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(n.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var r=e[t.DataParser.BONE];for(var a in r){var o=r[a];t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var s=this._armature.getBone(a);if(null!==s)for(var c=0,l=o.length;c<l;c+=2){var u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h);this._animation.addBoneTimeline(s,f)}}}if(t.DataParser.SURFACE in e)for(var a in r=e[t.DataParser.SURFACE]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var _=this._armature.getBone(a);if(null!==_)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addSurfaceTimeline(_,f)}if(t.DataParser.SLOT in e)for(var a in r=e[t.DataParser.SLOT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var d=this._armature.getSlot(a);if(null!==d)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addSlotTimeline(d,f)}if(t.DataParser.CONSTRAINT in e)for(var a in r=e[t.DataParser.CONSTRAINT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var p=this._armature.getConstraint(a);if(null!==p)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addConstraintTimeline(p,f)}if(t.DataParser.ANIMATION in e)for(var a in r=e[t.DataParser.ANIMATION])for(o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a)),c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addAnimationTimeline(a,f);return this._animation=null,n},n.prototype._parseArray=function(e){var n=e[t.DataParser.OFFSET],i=n[1],r=n[3],a=n[5],o=n[7],s=n[9],c=n[11],l=new Int16Array(this._binary,this._binaryOffset+n[0],i/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+n[2],r/Float32Array.BYTES_PER_ELEMENT),h=new Int16Array(this._binary,this._binaryOffset+n[4],a/Int16Array.BYTES_PER_ELEMENT),f=new Float32Array(this._binary,this._binaryOffset+n[6],o/Float32Array.BYTES_PER_ELEMENT),_=new Int16Array(this._binary,this._binaryOffset+n[8],s/Int16Array.BYTES_PER_ELEMENT),d=new Uint16Array(this._binary,this._binaryOffset+n[10],c/Uint16Array.BYTES_PER_ELEMENT);if(t.DragonBones.webAssembly){for(var p=i+r+a+o+s+c,m=t.webAssemblyModule._malloc(p),g=new Uint8Array(this._binary,this._binaryOffset,p/Uint8Array.BYTES_PER_ELEMENT),v=new Uint8Array(t.webAssemblyModule.HEAP16.buffer,m,g.length),y=0,S=g.length;y<S;++y)v[y]=g[y];t.webAssemblyModule.setDataBinary(this._data,m,i,r,a,o,s,c),this._intArrayBuffer=l,this._floatArrayBuffer=u,this._frameIntArrayBuffer=h,this._frameFloatArrayBuffer=f,this._frameArrayBuffer=_,this._timelineArrayBuffer=d}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=u,this._data.frameIntArray=this._frameIntArrayBuffer=h,this._data.frameFloatArray=this._frameFloatArrayBuffer=f,this._data.frameArray=this._frameArrayBuffer=_,this._data.timelineArray=this._timelineArrayBuffer=d},n.prototype.parseDragonBonesData=function(t,n){void 0===n&&(n=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var r=new Uint32Array(t,8,1)[0],a=new Uint8Array(t,12,r),o=this._decodeUTF8(a),s=JSON.parse(o);return this._binaryOffset=12+r,this._binary=t,e.prototype.parseDragonBonesData.call(this,s,n)},n.getInstance=function(){return null===n._binaryDataParserInstance&&(n._binaryDataParserInstance=new n),n._binaryDataParserInstance},n._binaryDataParserInstance=null,n}(t.ObjectDataParser);t.BinaryDataParser=e}(G4||(G4={})),function(t){var e=function(){function e(n){void 0===n&&(n=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==n?n:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var n=0,i=this._textureAtlasDataMap[t];n<i.length;n++)if(null!==(c=(s=i[n]).getTexture(e)))return c;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var a=0,o=this._textureAtlasDataMap[r];a<o.length;a++){var s,c;if((s=o[a]).autoSearch&&null!==(c=s.getTexture(e)))return c}return null},e.prototype._fillBuildArmaturePackage=function(t,e,n,i,r){var a=null,o=null;if(e.length>0&&e in this._dragonBonesDataMap&&(o=(a=this._dragonBonesDataMap[e]).getArmature(n)),null===o&&(0===e.length||this.autoSearch))for(var s in this._dragonBonesDataMap)if(a=this._dragonBonesDataMap[s],(0===e.length||a.autoSearch)&&null!==(o=a.getArmature(n))){e=s;break}if(null!==o){if(t.dataName=e,t.textureAtlasName=r,t.data=a,t.armature=o,t.skin=null,i.length>0&&(t.skin=o.getSkin(i),null===t.skin&&this.autoSearch))for(var s in this._dragonBonesDataMap){var c=this._dragonBonesDataMap[s].getArmature(i);if(null!==c){t.skin=c.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,n){for(var i=0,r=e.armature.sortedBones;i<r.length;i++){var a=r[i];t.BaseObject.borrowObject(0===a.type?t.Bone:t.Surface).init(a,n)}},e.prototype._buildSlots=function(e,n){var i=e.skin,r=e.armature.defaultSkin;if(null!==i&&null!==r){var a={};for(var o in r.displays){var s=r.getDisplays(o);a[o]=s}if(i!==r)for(var o in i.displays)s=i.getDisplays(o),a[o]=s;for(var c=0,l=e.armature.sortedSlots;c<l.length;c++){var u=l[c],h=u.name in a?a[u.name]:null,f=this._buildSlot(e,u,n);if(f.rawDisplayDatas=h,null!==h){for(var _=new Array,d=0,p=t.DragonBones.webAssembly?h.size():h.length;d<p;++d){var m=t.DragonBones.webAssembly?h.get(d):h[d];null!==m?_.push(this._getSlotDisplay(e,m,null,f)):_.push(null)}f._setDisplayList(_)}f._setDisplayIndex(u.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,n){var i=e.armature.constraints;for(var r in i){var a=i[r];switch(a.type){case 0:var o=t.BaseObject.borrowObject(t.IKConstraint);o.init(a,n),n._addConstraint(o);break;case 1:var s=t.BaseObject.borrowObject(t.PathConstraint);s.init(a,n),n._addConstraint(s);break;default:var c=t.BaseObject.borrowObject(t.IKConstraint);c.init(a,n),n._addConstraint(c)}}},e.prototype._buildChildArmature=function(t,e,n){return this.buildArmature(n.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,n,i,r){var a=null!==e?e.dataName:n.parent.parent.parent.name,o=null;switch(n.type){case 0:var s=n;null!==e&&e.textureAtlasName.length>0&&(s.texture=this._getTextureData(e.textureAtlasName,n.path)),null===s.texture&&(s.texture=this._getTextureData(a,n.path)),o=null!==i&&2===i.type&&this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 2:var c=n;null!==e&&e.textureAtlasName.length>0&&(c.texture=this._getTextureData(e.textureAtlasName,c.path)),null===c.texture&&(c.texture=this._getTextureData(a,c.path)),o=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var l=n,u=this._buildChildArmature(e,r,n);if(null!==u){if(u.inheritAnimation=l.inheritAnimation,!u.inheritAnimation){var h=l.actions.length>0?l.actions:u.armatureData.defaultActions;if(h.length>0)for(var f=0,_=h;f<_.length;f++){var d=_[f],p=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(d,p,r.armature),p.slot=r,r.armature._bufferAction(p,!1)}else u.animation.play()}l.armature=u.armatureData}o=u}return o},e.prototype.parseDragonBonesData=function(t,n,i){void 0===n&&(n=null),void 0===i&&(i=1);for(var r=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,a=r.parseDragonBonesData(t,i);;){var o=this._buildTextureAtlasData(null,null);if(!r.parseTextureAtlasData(null,o,i)){o.returnToPool();break}this.addTextureAtlasData(o,n)}return null!==a&&this.addDragonBonesData(a,n),a},e.prototype.parseTextureAtlasData=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,i),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,n),r},e.prototype.updateTextureAtlasData=function(t,e){var n=this.getTextureAtlasData(t);if(null!==n)for(var i=0,r=n.length;i<r;++i)i<e.length&&this._buildTextureAtlasData(n[i],e[i])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var n=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];n.indexOf(t)<0&&n.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var n=this._textureAtlasDataMap[t];if(e)for(var i=0,r=n;i<r.length;i++){var a=r[i];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var i=new n;return this._fillBuildArmaturePackage(i,e,t,"","")?i.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var n=0,i=this._textureAtlasDataMap[e];n<i.length;n++){var r=i[n];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,i,r){void 0===e&&(e=""),void 0===i&&(i=""),void 0===r&&(r="");var a=new n;if(!this._fillBuildArmaturePackage(a,e||"",t,i||"",r||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var o=this._buildArmature(a);return this._buildBones(a,o),this._buildSlots(a,o),this._buildConstraints(a,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},e.prototype.replaceDisplay=function(e,n,i){void 0===i&&(i=-1),i<0&&(i=e.displayIndex),i<0&&(i=0),e.replaceDisplayData(n,i);var r=e.displayList;if(r.length<=i){r.length=i+1;for(var a=0,o=r.length;a<o;++a)r[a]||(r[a]=null)}if(null!==n){var s=e.rawDisplayDatas,c=null;s&&(t.DragonBones.webAssembly?i<s.size()&&(c=s.get(i)):i<s.length&&(c=s[i])),r[i]=this._getSlotDisplay(null,n,c,e)}else r[i]=null;e.displayList=r},e.prototype.replaceSlotDisplay=function(t,e,n,i,r,a){void 0===a&&(a=-1);var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var s=o.defaultSkin.getDisplay(n,i);return!!s&&(this.replaceDisplay(r,s,a),!0)},e.prototype.replaceSlotDisplayList=function(e,n,i,r){var a=this.getArmatureData(n,e||"");if(!a||!a.defaultSkin)return!1;var o=a.defaultSkin.getDisplays(i);if(!o)return!1;for(var s=0,c=0,l=t.DragonBones.webAssembly?o.size():o.length;c<l;++c){var u=t.DragonBones.webAssembly?o.get(c):o[c];this.replaceDisplay(r,u,s++)}return!0},e.prototype.replaceSkin=function(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var a=!1,o=n.parent.defaultSkin,s=0,c=e.getSlots();s<c.length;s++){var l=c[s];if(!(null!==r&&r.indexOf(l.name)>=0)){var u=n.getDisplays(l.name);if(u||(null!==o&&n!==o&&(u=o.getDisplays(l.name)),u)){var h=t.DragonBones.webAssembly?u.size():u.length,f=l.displayList;f.length=h;for(var _=0,d=h;_<d;++_){var p=t.DragonBones.webAssembly?u.get(_):u[_];f[_]=null!==p?this._getSlotDisplay(null,p,null,l):null}a=!0,l.rawDisplayDatas=u,l.displayList=f}else i&&(l.rawDisplayDatas=null,l.displayList=[])}}return a},e.prototype.replaceAnimation=function(e,n,i){void 0===i&&(i=!0);var r=n.defaultSkin;if(null===r)return!1;if(i)e.animation.animations=n.animations;else{var a=e.animation.animations,o={};for(var s in a)o[s]=a[s];for(var s in n.animations)o[s]=n.animations[s];e.animation.animations=o}for(var c=0,l=e.getSlots();c<l.length;c++)for(var u=l[c],h=0,f=0,_=u.displayList;f<_.length;f++){var d=_[f];if(d instanceof t.Armature){var p=r.getDisplays(u.name);if(null!==p&&h<(t.DragonBones.webAssembly?p.size():p.length)){var m=t.DragonBones.webAssembly?p.get(h):p[h];if(null!==m&&1===m.type){var g=this.getArmatureData(m.path,m.parent.parent.parent.name);g&&this.replaceAnimation(d,g,i)}}}h++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e.prototype.changeSkin=function(t,e,n){return void 0===n&&(n=null),this.replaceSkin(t,e,!1,n)},e.prototype.copyAnimationsToArmature=function(t,e,n,i,r){void 0===i&&(i=""),void 0===r&&(r=!0);var a=this.getArmatureData(e,i);return!!a&&this.replaceAnimation(t,a,r)},e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var n=function(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=n}(G4||(G4={})),function(t){t.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},t.ArmatureType={Armature:0,MovieClip:1,Stage:2},t.BoneType={Bone:0,Surface:1},t.DisplayType={Image:0,Armature:1,Mesh:2,BoundingBox:3},t.BoundingBoxType={Rectangle:0,Ellipse:1,Polygon:2},t.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5,Frame:10,Sound:11},t.BlendMode={Normal:0,Add:1,Alpha:2,Darken:3,Difference:4,Erase:5,HardLight:6,Invert:7,Layer:8,Lighten:9,Multiply:10,Overlay:11,Screen:12,Subtract:13},t.TweenType={None:0,Line:1,Curve:2,QuadIn:3,QuadOut:4,QuadInOut:5},t.TimelineType={Action:0,ZOrder:1,BoneAll:10,BoneTranslate:11,BoneRotate:12,BoneScale:13,Surface:50,SlotDisplay:20,SlotColor:21,SlotFFD:22,IKConstraint:30,AnimationTime:40,AnimationWeight:41}}(G4||(G4={}));var V4,H4,W4,j4,X4,q4,Y4,K4,Q4,J4,Z4,$4,t3,e3=G4.DragonBones,n3=G4.BaseObject,i3=G4.Matrix,r3=G4.Transform,a3=G4.ColorTransform,o3=G4.Point,s3=G4.Rectangle,c3=G4.UserData,l3=G4.ActionData,u3=G4.DragonBonesData,h3=G4.ArmatureData,f3=G4.BoneData,_3=G4.SurfaceData,d3=G4.SlotData,p3=G4.ConstraintData,m3=G4.IKConstraintData,g3=G4.PathConstraintData,v3=G4.CanvasData,y3=G4.SkinData,S3=G4.VerticesData,T3=G4.DisplayData,x3=G4.ImageDisplayData,E3=G4.ArmatureDisplayData,A3=G4.MeshDisplayData,C3=G4.BoundingBoxDisplayData,b3=G4.PathDisplayData,w3=G4.WeightData,I3=G4.BoundingBoxData,P3=G4.RectangleBoundingBoxData,R3=G4.EllipseBoundingBoxData,D3=G4.PolygonBoundingBoxData,O3=G4.AnimationData,N3=G4.TimelineData,M3=G4.AnimationConfig,L3=G4.TextureAtlasData,F3=G4.TextureData,B3=G4.DeformVertices,z3=G4.Armature,U3=G4.TransformObject,k3=G4.Bone,G3=G4.Surface,V3=G4.Slot,H3=G4.Constraint,W3=G4.IKConstraint,j3=G4.PathConstraint,X3=G4.WorldClock,q3=G4.Animation,Y3=G4.AnimationState,K3=G4.BonePose,Q3=G4.BlendState,J3=G4.TimelineState,Z3=G4.TweenTimelineState,$3=G4.BoneTimelineState,t5=G4.SlotTimelineState,e5=G4.ConstraintTimelineState,n5=G4.ActionTimelineState,i5=G4.ZOrderTimelineState,r5=G4.BoneAllTimelineState,a5=G4.BoneTranslateTimelineState,o5=G4.BoneRotateTimelineState,s5=G4.BoneScaleTimelineState,c5=G4.SurfaceTimelineState,l5=G4.SlotDislayTimelineState,u5=G4.SlotColorTimelineState,h5=G4.DeformTimelineState,f5=G4.IKConstraintTimelineState,_5=G4.AnimationTimelineState,d5=G4.EventObject,p5=G4.DataParser,m5=G4.ObjectDataParser,g5=G4.ActionFrame,v5=G4.BinaryDataParser,y5=G4.BaseFactory,S5=G4.BuildArmaturePackage,T5=G4.BinaryOffset,x5=G4.ArmatureType,E5=G4.BoneType,A5=G4.DisplayType,C5=G4.BoundingBoxType,b5=G4.ActionType,w5=G4.BlendMode,I5=G4.TweenType,P5=G4.TimelineType,R5=Ec("dragonBones.CCTextureAtlasData")(V4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._renderTexture=null,e}Z(e,t),e.toString=function(){return"[class dragonBones.CCTextureAtlasData]"};var n=e.prototype;return n.createTexture=function(){return n3.borrowObject(D5)},n._onClear=function(){t.prototype._onClear.call(this),this.renderTexture=null},Q(e,[{key:"renderTexture",get:function(){return this._renderTexture},set:function(t){if(this._renderTexture=t,t)for(var e in this.textures){var n=this.textures[e];if(!n.spriteFrame){var i=null;n.rotated?i=new ai(n.region.x,n.region.y,n.region.height,n.region.width):(i=new ai(n.region.x,n.region.y,n.region.width,n.region.height),n.spriteFrame=new XF,n.spriteFrame.texture=t,n.spriteFrame.rect=i)}}else for(var r in this.textures)this.textures[r].spriteFrame=null}}]),e}(L3))||V4,D5=Ec("dragonBones.CCTextureData")(H4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).spriteFrame=null,e}return Z(e,t),e.toString=function(){return"[class dragonBones.CCTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.spriteFrame=null},e}(F3))||H4,O5=Ec("dragonBones.CCSlot")(W4=function(t){function e(){var e;return(e=t.call(this)||this)._localVertices=void 0,e._indices=void 0,e._matrix=void 0,e._worldMatrix=void 0,e._worldMatrixDirty=void 0,e._color=void 0,e._localVertices=[],e._indices=[],e._matrix=new Xn,e._worldMatrix=new Xn,e._worldMatrixDirty=!0,e._visible=!1,e._color=new Pn,e}Z(e,t),e.toString=function(){return"[class dragonBones.CCSlot]"};var n=e.prototype;return n.getTexture=function(){return this._textureData?this._textureData.spriteFrame.texture:null},n.calculWorldMatrix=function(){var t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):Xn.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1},n._onClear=function(){t.prototype._onClear.call(this),this._localVertices.length=0,this._indices.length=0,Xn.identity(this._matrix),Xn.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=new Pn,this._visible=!1},n._onUpdateDisplay=function(){},n._initDisplay=function(){},n._addDisplay=function(){this._visible=!0},n._replaceDisplay=function(){},n._removeDisplay=function(){this._visible=!1},n._disposeDisplay=function(){},n._updateVisible=function(){this._visible=this.parent.visible},n._updateGlueMesh=function(){},n._updateZOrder=function(){},n._updateBlendMode=function(){if(this._childArmature)for(var t=this._childArmature.getSlots(),e=0,n=t.length;e<n;e++){var i=t[e];i._blendMode=this._blendMode,i._updateBlendMode()}},n._updateColor=function(){var t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier},n._updateFrame=function(){this._indices.length=0;var t=this._indices,e=this._localVertices,n=0,i=0,r=this._textureData;if(this._display&&!(this._displayIndex<0)&&r&&r.spriteFrame){var a=r.spriteFrame.texture,o=a.width,s=a.height,c=r.region;if(0!==o&&0!==s){var l=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(l){var u=l.data,h=u.intArray,f=u.floatArray,_=h[l.offset+T5.MeshVertexCount],d=h[l.offset+T5.MeshTriangleCount],p=h[l.offset+T5.MeshFloatOffset];p<0&&(p+=65536);for(var m=p+2*_,g=this._armature._armatureData.scale,v=0,y=2*_;v<y;v+=2)e[i++]=f[p+v]*g,e[i++]=-f[p+v+1]*g,l.rotated?(e[i++]=(c.x+(1-f[m+v])*c.width)/o,e[i++]=(c.y+f[m+v+1]*c.height)/s):(e[i++]=(c.x+f[m+v]*c.width)/o,e[i++]=(c.y+f[m+v+1]*c.height)/s);for(var S=0;S<3*d;++S)t[n++]=h[l.offset+T5.MeshVertexIndices+S];e.length=i,t.length=n,l.weight&&this._identityTransform()}else{var T=c.x/o,x=(c.y+c.height)/s,E=(c.x+c.width)/o,A=c.y/s;e[i++]=0,e[i++]=0,e[i++]=T,e[i++]=x,e[i++]=c.width,e[i++]=0,e[i++]=E,e[i++]=x,e[i++]=0,e[i++]=c.height,e[i++]=T,e[i++]=A,e[i++]=c.width,e[i++]=c.height,e[i++]=E,e[i++]=A,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=i,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}else console.error("SpriteFrame "+r.spriteFrame.name+" incorrect size "+o+" x "+s)}},n._updateMesh=function(){var t=this._armature._armatureData.scale,e=this._deformVertices.vertices,n=this._deformVertices.bones,i=this._deformVertices.verticesData,r=i.weight,a=e.length>0&&i.inheritDeform,o=this._localVertices;if(r){var s=i.data,c=s.intArray,l=s.floatArray,u=c[i.offset+T5.MeshVertexCount],h=c[r.offset+T5.WeigthFloatOffset];h<0&&(h+=65536);for(var f=0,_=r.offset+T5.WeigthBoneIndices+n.length,d=h,p=0,m=0;f<u;f++,m+=4){for(var g=c[_++],v=0,y=0,S=0;S<g;++S){var T=n[c[_++]];if(null!==T){var x=T.globalTransformMatrix,E=l[d++],A=l[d++]*t,C=l[d++]*t;a&&(A+=e[p++],C+=e[p++]),v+=(x.a*A+x.c*C+x.tx)*E,y+=(x.b*A+x.d*C+x.ty)*E}}o[m]=v,o[m+1]=-y}}else if(a){var b=this._parent._boneData.type!==E5.Bone,w=i.data,I=w.intArray,P=w.floatArray,R=I[i.offset+T5.MeshVertexCount],D=I[i.offset+T5.MeshFloatOffset];D<0&&(D+=65536);for(var O=0,N=R,M=0;O<N;O++,M+=4){var L=P[D+2*O]*t+e[2*O],F=P[D+2*O+1]*t+e[2*O+1];if(b){var B=this._parent._getGlobalTransformMatrix(L,F);o[M]=B.a*L+B.c*F+B.tx,o[M+1]=-B.b*L+B.d*F+B.ty}else o[M]=L,o[M+1]=-F}}r&&this._identityTransform()},n._identityTransform=function(){var t=this._matrix;t.m00=1,t.m01=0,t.m04=-0,t.m05=-1,t.m12=0,t.m13=0,this._worldMatrixDirty=!0},n._updateTransform=function(){var t=this._matrix;t.m00=this.globalTransformMatrix.a,t.m01=this.globalTransformMatrix.b,t.m04=-this.globalTransformMatrix.c,t.m05=-this.globalTransformMatrix.d,this._childArmature?(t.m12=this.globalTransformMatrix.tx,t.m13=this.globalTransformMatrix.ty):(t.m12=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t.m13=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0},n.updateWorldMatrix=function(){if(this._armature){var t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();var e=this.childArmature;if(!e)return;for(var n=e.getSlots(),i=0,r=n.length;i<r;i++){var a=n[i];a&&(a._worldMatrixDirty=!0)}}}},n._mulMat=function(t,e,n){var i=e.m00,r=e.m01,a=e.m04,o=e.m05,s=e.m12,c=e.m13,l=n.m00,u=n.m01,h=n.m04,f=n.m05,_=n.m12,d=n.m13;0!==r||0!==a?(t.m00=l*i+u*a,t.m01=l*r+u*o,t.m04=h*i+f*a,t.m05=h*r+f*o,t.m12=i*_+a*d+s,t.m13=r*_+o*d+c):(t.m00=l*i,t.m01=u*o,t.m04=h*i,t.m05=f*o,t.m12=i*_+s,t.m13=o*d+c)},e}(V3))||W4,N5=Ec("dragonBones.CCArmatureDisplay")(j4=function(t){function e(){var e;return(e=t.call(this)||this).shouldAdvanced=!1,e._ccNode=null,e._ccComponent=null,e._eventTarget=void 0,e._armature=null,e._eventTarget=new tu,e}Z(e,t);var n=e.prototype;return n.hasEvent=function(){return console.warn("Method not implemented."),!1},n.addEvent=function(){console.warn("Method not implemented.")},n.removeEvent=function(){console.warn("Method not implemented.")},n.setEventTarget=function(t){this._eventTarget=t},n.getRootDisplay=function(){var t,e=this._armature._parent;if(!e)return this;for(;e;)t=e,e=e._armature._parent;return t._armature.display},n.convertToRootSpace=function(t){var e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();var n=e._worldMatrix,i=new Dn(0,0);return i.x=t.x*n.m00+t.y*n.m04+n.m12,i.y=t.x*n.m01+t.y*n.m05+n.m13,i},n.convertToWorldSpace=function(t){var e,n=this.convertToRootSpace(t),i=this.getRootNode();return null==i||null===(e=i._uiProps.uiTransformComp)||void 0===e?void 0:e.convertToWorldSpaceAR(n)},n.getRootNode=function(){var t=this.getRootDisplay();return t&&t._ccNode},n.dbInit=function(t){this._armature=t},n.dbClear=function(){this._armature=null},n.dbUpdate=function(){this._ccComponent&&this._ccComponent.markForUpdateRenderData()},n.advanceTimeBySelf=function(t){this.shouldAdvanced=!!t},n.hasDBEventListener=function(t){return this._eventTarget.hasEventListener(t)},n.addDBEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeDBEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.dispatchDBEvent=function(t,e){this._eventTarget.emit(t,e)},Q(e,[{key:"node",get:function(){return this}}]),e}(T3))||j4,M5=Ec("CCFactory")((Y4=q4=function(t){function e(){var e;(e=t.call(this)||this).id=void 0,e.uuid=void 0,e._slots=void 0;var n=new N5;return e._dragonBones=new e3(n),lN.getScheduler()&&(sN.on(oN.EVENT_RESTART,e.onRestart,rt(e)),e.initUpdate()),e.id=e.uuid="CCFactory",e}Z(e,t),e.getInstance=function(){return e._factory||(e._factory=new e),e._factory};var n=e.prototype;return n.onRestart=function(){e._factory=null},n.initUpdate=function(){nN.enableForTarget(this),lN.getScheduler().scheduleUpdate(this,KO.Priority.HIGH,!1)},n.update=function(t){this._dragonBones.advanceTime(t)},n.getDragonBonesDataByRawData=function(t){return(t instanceof ArrayBuffer?y5._binaryParser:this._dataParser).parseDragonBonesData(t,1)},n.buildArmatureDisplay=function(t,e,n,i){var r=this.buildArmature(t,e,n,i);return r?r._display:null},n.createArmatureNode=function(t,e,n){var i=(n=n||new ob).getComponent("dragonBones.ArmatureDisplay");return i||(i=n.addComponent("dragonBones.ArmatureDisplay")),n.name=e,i._armatureName=e,i._dragonAsset=t.dragonAsset,i._dragonAtlasAsset=t.dragonAtlasAsset,i._init(),i},n._buildTextureAtlasData=function(t,e){return t?t.renderTexture=e:t=n3.borrowObject(R5),t},n._sortSlots=function(){for(var t=this._slots,e=[],n=0,i=t.length;n<i;n++){for(var r=t[n],a=r._zOrder,o=!1,s=e.length-1;s>=0;s--)if(a>=e[s]._zOrder){e.splice(s+1,0,r),o=!0;break}o||e.unshift(r)}this._slots=e},n._buildArmature=function(t){var e=n3.borrowObject(z3);e._skinData=t.skin,e._animation=n3.borrowObject(q3),e._animation._armature=e,e._animation.animations=t.armature.animations,e._isChildArmature=!1;var n=new N5;return e.init(t.armature,n,n,this._dragonBones),e},n._buildSlot=function(t,e,n){var i=n3.borrowObject(O5),r=i;return i.init(e,n,r,r),i},n.getDragonBonesDataByUUID=function(t){for(var e in this._dragonBonesDataMap)if(-1!==e.indexOf(t))return this._dragonBonesDataMap[e];return null},n.removeDragonBonesDataByUUID=function(t,e){for(var n in void 0===e&&(e=!0),this._dragonBonesDataMap)-1!==n.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[n]),delete this._dragonBonesDataMap[n])},e}(y5),q4._factory=null,X4=Y4))||X4,L5=1/60,F5=[],B5=[],z5=0,U5=0,k5=0,G5=null,V5=null,H5=0,W5=0,j5=0,X5=0,q5=0,Y5=function(){function t(){this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.begin=function(){if(this._invalid){var t=this._armatureInfo,e=t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),t.curAnimationCache=this,this._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1}},e.end=function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},e._needToUpdate=function(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._armatureInfo.armature;do{e.advanceTime(L5),this._frameIdx++,this.updateFrame(e,this._frameIdx),this.totalTime+=L5}while(this._needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.updateFrame=function(t,e){k5=0,z5=0,U5=0,G5=null,V5=null,H5=0,W5=0,j5=0,X5=0,q5=0,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var n=this.frames[e],i=this._tempSegments=n.segments,r=this._tempColors=n.colors,a=this._tempBoneInfos=n.boneInfos;this._traverseArmature(t,1),X5>0&&(r[X5-1].vfOffset=k5),r.length=X5,a.length=z5;var o=j5-1;if(o>=0)if(W5>0){var s=i[o];s.indexCount=W5,s.vfCount=9*H5,s.vertexCount=H5,i.length=j5}else i.length=j5-1;if(0!==i.length){var c,l=n.vertices,u=k5/5,h=9*u;(!l||l.length<k5)&&(l=n.vertices=new Float32Array(h));for(var f=0,_=0;f<h;)l[f]=F5[_++],l[f+1]=F5[_++],l[f+3]=F5[_++],l[f+4]=F5[_++],c=F5[_++],l[f+5]=(255&c)/255,l[f+6]=(c>>8&255)/255,l[f+7]=(c>>16&255)/255,l[f+8]=(c>>24&255)/255,f+=9;var d=n.indices;(!d||d.length<U5)&&(d=n.indices=new Uint16Array(U5));for(var p=0;p<U5;p++)d[p]=B5[p];n.vertices=l,n.indices=d,this.maxVertexCount=u>this.maxVertexCount?u:this.maxVertexCount,this.maxIndexCount=d.length>this.maxIndexCount?d.length:this.maxIndexCount}},e._traverseArmature=function(t,e){var n,i,r,a,o,s,c,l,u,h=this._tempColors,f=this._tempSegments,_=this._tempBoneInfos,d=t._slots,p=t._bones;if(this._enableCacheAttachedInfo)for(var m=0,g=p.length;m<g;m++,z5++){var v=p[m],y=_[z5];y||(y=_[z5]={globalTransformMatrix:new i3});var S=v.globalTransformMatrix;y.globalTransformMatrix.copyFrom(S)}for(var T=0,x=d.length;T<x;T++)if((r=d[T])._visible&&r._displayData)if(r.updateWorldMatrix(),o=r._color,r.childArmature)this._traverseArmature(r.childArmature,e*o.a/255);else if(c=r.getTexture()){G5===c.nativeUrl&&V5===r._blendMode||(G5=c.nativeUrl,V5=r._blendMode,(l=j5-1)>=0&&(W5>0?((u=f[l]).indexCount=W5,u.vertexCount=H5,u.vfCount=9*H5):j5--),f[j5]={tex:c,blendMode:r._blendMode,indexCount:0,vertexCount:0,vfCount:0},j5++,W5=0,H5=0),s=(o.a*e<<24>>>0)+(o.b<<16)+(o.g<<8)+o.r,q5!==s&&(q5=s,X5>0&&(h[X5-1].vfOffset=k5),h[X5++]={r:o.r,g:o.g,b:o.b,a:o.a*e,vfOffset:0}),n=r._localVertices,i=r._indices,a=r._worldMatrix;for(var E=0,A=n.length;E<A;)K4=n[E++],Q4=n[E++],F5[k5++]=K4*a.m00+Q4*a.m04+a.m12,F5[k5++]=K4*a.m01+Q4*a.m05+a.m13,F5[k5++]=n[E++],F5[k5++]=n[E++],F5[k5++]=s;for(var C=0,b=i.length;C<b;C++)B5[U5++]=H5+i[C];W5+=i.length,H5+=n.length/4}},t}(),K5=function(){function t(){this._privateMode=!1,this._animationPool={},this._armatureCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.dispose=function(){for(var t in this._armatureCache){var e=this._armatureCache[t];if(e){var n=e.armature;n&&n.dispose()}}this._armatureCache={},this._animationPool={}},e._removeArmature=function(t){var e=this._armatureCache[t],n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}var a=e.armature;a&&a.dispose(),delete this._armatureCache[t]},e.resetArmature=function(t){for(var e in this._armatureCache)-1!==e.indexOf(t)&&this._removeArmature(e)},e.getArmatureCache=function(e,n,i){var r,a=this._armatureCache[n];if(a)r=a.armature;else{var o=M5.getInstance().buildArmatureDisplay(e,n,"",i);if(!o||!o._armature)return null;if(r=o._armature,!t.canCache(r))return r.dispose(),null;this._armatureCache[n]={armature:r,animationsCache:{},curAnimationCache:null}}return r},e.getAnimationCache=function(t,e){var n=this._armatureCache[t];return n?n.animationsCache[e]:null},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._armatureCache[t],i=n&&n.armature;if(!i)return null;if(!i.animation.hasAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new Y5)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.invalidAnimationCache=function(t){var e=this._armatureCache[t];if(e&&e.armature){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._armatureCache[t];if(!i||!i.armature)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t.canCache=function(t){for(var e=t._slots,n=0,i=e.length;n<i;n++)if(e[n].childArmature)return!1;return!0},t}();K5.FrameTime=L5,K5.sharedCache=new K5;var Q5,J5,Z5,$5,t6,e6,n6,i6,r6,a6=Ec("dragonBones.DragonBonesAsset")((t3=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_dragonBonesJson",$4,rt(e)),e._factory=null,e._dragonBonesJsonData=void 0,e._armaturesEnum=null,e}Z(e,t);var n=e.prototype;return n.constructctor=function(){this.reset()},n.createNode=function(t){var e=new ob(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAsset=this,t(null,e)},n.reset=function(){this._clear()},n.init=function(t,e){this._factory=t,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson));var n;if(n=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,!this._uuid){var i=this._factory.getDragonBonesDataByRawData(n);i?this._uuid=i.name:console.warn("dragonbones name is empty")}var r=this._uuid+"#"+e;return this._factory.getDragonBonesData(r)||this._factory.parseDragonBonesData(n instanceof ArrayBuffer?n:n.buffer instanceof ArrayBuffer?n.buffer:n,r),r},n.getArmatureEnum=function(){if(this._armaturesEnum)return this._armaturesEnum;this.init();var t=this._factory.getDragonBonesDataByUUID(this._uuid);if(t){for(var e=t.armatureNames,n={},i=0;i<e.length;i++)n[e[i]]=i;return this._armaturesEnum=oe(n)}return null},n.getAnimsEnum=function(t){this.init();var e=this._factory.getDragonBonesDataByUUID(this._uuid);if(e){var n=e.getArmature(t);if(!n)return null;var i={"<None>":0},r=n.animations,a=0;for(var o in r)r.hasOwnProperty(o)&&(i[o]=a+1,a++);return oe(i)}return null},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(K5.sharedCache.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},Q(e,[{key:"dragonBonesJson",get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}}]),e}(Du),$4=ct((Z4=t3).prototype,"_dragonBonesJson",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),J4=Z4))||J4;l.internal.DragonBonesAsset=a6;var o6,s6=(Q5=Ec("dragonBones.DragonBonesAtlasAsset"),J5=al(dg),Q5((r6=function(t){function e(){var e;return st(e=t.call(this)||this,"_atlasJson",t6,rt(e)),st(e,"_texture",e6,rt(e)),st(e,"_atlasJsonData",n6,rt(e)),e._factory=null,st(e,"_textureAtlasData",i6,rt(e)),e._clear(),e}Z(e,t);var n=e.prototype;return n.createNode=function(t){var e=new ob(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAtlasAsset=this,t(null,e)},n.init=function(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(K5.sharedCache.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0)),this._textureAtlasData=null},Q(e,[{key:"atlasJson",get:function(){return this._atlasJson},set:function(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._clear()}}]),e}(Du),t6=ct(($5=r6).prototype,"_atlasJson",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),e6=ct($5.prototype,"_texture",[Dc,J5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),n6=ct($5.prototype,"_atlasJsonData",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),i6=ct($5.prototype,"_textureAtlasData",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z5=$5))||Z5);l.internal.DragonBonesAtlasAsset=s6;var c6,l6,u6,h6,f6,_6,d6,p6,m6,g6,v6,y6,S6,T6,x6,E6,A6,C6,b6,w6,I6,P6,R6,D6,O6,N6,M6,L6,F6,B6,z6,U6,k6,G6,V6,H6,W6,j6,X6,q6,Y6,K6,Q6,J6,Z6,$6,t8,e8,n8,i8,r8=new Xn,a8=Ec("dragonBones.AttachUtil")(o6=function(){function t(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t},e.reset=function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null},e._syncAttachedNode=function(){if(this._inited){this._armatureNode.worldMatrix;var t=null,e=this._armatureDisplay.isAnimationCached();if(!e||!this._armatureDisplay||(t=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos))for(var n,i,r,a=this._armatureDisplay.sockets,o=this._armatureDisplay.socketNodes,s=this._armature.getBones(),c=a.length-1;c>=0;c--){var l=a[c],u=l.target;if(u)if(u.isValid){var h=e?t[l.boneIndex]:s[l.boneIndex];h&&(n=u,i=h.globalTransformMatrix,r=void 0,(r=r8).m00=i.a,r.m01=i.b,r.m04=-i.c,r.m05=-i.d,r.m12=i.tx,r.m13=i.ty,n.matrix=r8)}else o.delete(l.path),a.splice(c,1)}}},t}())||o6,o8=function(t){function e(){var e;return(e=t.call(this)||this)._armatures=new Set,e}Z(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,lN.registerSystem(e.ID,e._instance,KO.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._armatures.has(t)||this._armatures.add(t))},n.remove=function(t){t&&this._armatures.has(t)&&this._armatures.delete(t)},n.postUpdate=function(t){this._armatures&&this._armatures.forEach((function(e){e.updateAnimation(t)}))},e}(KO);function s8(t,e,n){tn.Attr.setClassAttr(t,e,"type","Enum"),tn.Attr.setClassAttr(t,e,"enumList",oe.getList(n))}o8.ID="ARMATURE",o8._instance=void 0,l.internal.ArmatureSystem=o8,function(t){t[t.default=-1]="default"}(t8||(t8={})),le(t8),function(t){t[t["<None>"]=0]="<None>"}(e8||(e8={})),le(e8),function(t){t[t.REALTIME=0]="REALTIME"}(n8||(n8={})),le(e8),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(i8||(i8={})),le(i8);var c8=(c6=Ec("dragonBones.ArmatureDisplay.DragonBoneSocket"),l6=al(ob),c6((f6=ct((h6=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),st(this,"path",f6,this),st(this,"target",_6,this),this.boneIndex=null,this.path=t,this.target=e}).prototype,"path",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_6=ct(h6.prototype,"target",[l6,Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u6=h6))||u6);Qt(c8,"dragonBones.ArmatureDisplay.DragonBoneSocket");var l8=(d6=Ec("dragonBones.ArmatureDisplay"),p6=Gc(),m6=Bc(),g6=al(a6),v6=Xc(),y6=al(s6),S6=Xc(),T6=Hc(),x6=Hc(),E6=jc(),A6=al(t8),C6=Xc(),b6=al(e8),w6=jc(),I6=Xc(),P6=jc(),R6=Xc(),D6=Xc(),O6=Xc(),N6=Xc(),M6=Xc(),L6=al([c8]),F6=Xc(),d6(B6=p6(B6=m6(B6=Fc(($6=Z6=function(t){function e(){var e;return st(e=t.call(this)||this,"playTimes",U6,rt(e)),st(e,"premultipliedAlpha",k6,rt(e)),e._armature=null,e.attachUtil=void 0,st(e,"_defaultArmatureIndexValue",G6,rt(e)),st(e,"_dragonAsset",V6,rt(e)),st(e,"_dragonAtlasAsset",H6,rt(e)),st(e,"_armatureName",W6,rt(e)),st(e,"_animationName",j6,rt(e)),st(e,"_animationIndexValue",X6,rt(e)),e._preCacheMode=-1,e._cacheMode=i8.REALTIME,st(e,"_defaultCacheModeValue",q6,rt(e)),st(e,"_timeScale",Y6,rt(e)),st(e,"_playTimes",K6,rt(e)),st(e,"_debugBones",Q6,rt(e)),e._debugDraw=null,e._armatureKey="",e._accTime=0,e._playCount=0,e._frameCache=null,e._curFrame=null,e._playing=!1,e._armatureCache=null,e._eventTarget=void 0,e._factory=null,e._displayProxy=null,e._drawIdx=0,e._drawList=new Wl((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumArmatures=oe({}),e._enumAnimations=oe({}),e._socketNodes=new Map,e._cachedSockets=new Map,st(e,"_sockets",J6,rt(e)),e._inited=void 0,e._cacheModeEnum=void 0,e._eventTarget=new tu,e._inited=!1,e.attachUtil=new a8,e.initFactory(),s8(rt(e),"_animationIndex",e._enumAnimations),s8(rt(e),"_defaultArmatureIndex",e._enumArmatures),e._useVertexOpacity=!0,e}Z(e,t);var n=e.prototype;return n.initFactory=function(){this._factory=M5.getInstance()},n.onLoad=function(){for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];0===(i.name&&i.name.search("CHILD_ARMATURE-"))&&i.destroy()}},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlend=function(t,e){var n=t+"/"+e,i=this._materialCache[n];if(i)return i;var r=this.getMaterial(0);return(i=new ly({parent:r,subModelIdx:0,owner:this})).recompileShaders({USE_LOCAL:!0},0),this._materialCache[n]=i,i.overridePipelineStates({blendState:{targets:[{blendSrc:t,blendDst:e}]}}),i},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n.__preload=function(){t.prototype.__preload.call(this),this._init()},n._init=function(){if(this._cacheMode=this._defaultCacheMode,!this._inited){this._inited=!0,this._parseDragonAtlasAsset(),this._refresh();for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];i&&"DEBUG_DRAW_NODE"===i.name&&i.destroy()}this._updateDebugDraw(),this._indexBoneSockets(),this._updateSocketBindings()}},n.getArmatureKey=function(){return this._armatureKey},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==i8.REALTIME},n.onEnable=function(){t.prototype.onEnable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._flushAssembler(),o8.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),o8.getInstance().remove(this)},n._emitCacheCompleteEvent=function(){this._eventTarget.emit(d5.LOOP_COMPLETE),this._eventTarget.emit(d5.COMPLETE)},n.updateAnimation=function(t){if(this.isAnimationCached()&&this._frameCache){this.markForUpdateRenderData();var e=this._frameCache;if(e.isInited()){var n=e.frames;if(this._playing){var i=K5.FrameTime;0===this._accTime&&0===this._playCount&&this._eventTarget.emit(d5.START),this._accTime+=t*this.timeScale*1;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playing=!1,this._playCount=0,this._emitCacheCompleteEvent(),void this.attachUtil._syncAttachedNode();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r],this.attachUtil._syncAttachedNode()}else e.isInvalid()&&(e.updateToFrame(),this._curFrame=n[n.length-1],this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount))))}}},n.onDestroy=function(){this._materialInstances=this._materialInstances.filter((function(t){return!!t})),this._inited=!1,this._cacheMode===i8.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===i8.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n._updateDebugDraw=function(){if(this.debugBones){if(!this._debugDraw){var t=new ob("DEBUG_DRAW_NODE");t.hideFlags|=_l.Flags.DontSave|_l.Flags.HideInHierarchy;var e=t.addComponent(SG);e.lineWidth=1,e.strokeColor=new Pn(255,0,0,255),this._debugDraw=e}this._debugDraw.node.parent=this.node}else this._debugDraw&&(this._debugDraw.node.parent=null);this.markForUpdateRenderData()},n._buildArmature=function(){if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){this._armature&&(this._preCacheMode===i8.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===i8.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=-1),this._cacheMode===i8.SHARED_CACHE?this._armatureCache=K5.sharedCache:this._cacheMode===i8.PRIVATE_CACHE&&(this._armatureCache=new K5,this._armatureCache.enablePrivateMode());var t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=i8.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===i8.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy._ccComponent=this,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale}if(this._cacheMode!==i8.REALTIME&&this.debugBones&&console.warn("Debug bones is invalid in cached mode"),this._armature){var e=this._armature.armatureData.aabb;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this.attachUtil.init(this),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this._flushAssembler()}},n.querySockets=function(){return this._armature?(0===this._cachedSockets.size&&this._indexBoneSockets(),Array.from(this._cachedSockets.keys()).sort()):[]},n.setBlendHash=function(){-1!==this._blendHash&&(this._blendHash=-1)},n.querySocketPathByName=function(t){for(var e,n=[],i=ot(this._cachedSockets.keys());!(e=i()).done;){var r=e.value;r.endsWith(t)&&n.push(r)}return n},n._parseDragonAtlasAsset=function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},n._refresh=function(){this._buildArmature(),this._indexBoneSockets(),this.markForUpdateRenderData()},n._updateCacheModeEnum=function(){this._cacheModeEnum=oe({}),this._armature?Object.assign(this._cacheModeEnum,i8):Object.assign(this._cacheModeEnum,n8),s8(this,"_defaultCacheMode",this._cacheModeEnum)},n._updateAnimEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getAnimsEnum(this.armatureName):e8,this._enumAnimations=oe({}),Object.assign(this._enumAnimations,t||e8),oe.update(this._enumAnimations),s8(this,"_animationIndex",this._enumAnimations)},n._updateArmatureEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getArmatureEnum():t8,this._enumArmatures=oe({}),Object.assign(this._enumArmatures,t||t8),oe.update(this._enumArmatures),s8(this,"_defaultArmatureIndex",this._enumArmatures)},n._indexBoneSockets=function(){if(this._armature){this._cachedSockets.clear();var t=this._cachedSockets,e=function t(e,n,i){if(i.has(e))return i.get(e);var r=n[e];if(!r.parent)return i.set(e,r.name),r.path=r.name,r.name;var a=t(r.parent._boneIndex,n,i)+"/"+r.name;return i.set(e,a),r.path=a,a};!function n(i,r){for(var a=r.getBones(),o=new Map,s=0;s<a.length;s++)a[s]._boneIndex=s;for(var c=0;c<a.length;c++)e(c,a,o);for(var l,u=ot(o.keys());!(l=u()).done;){var h=l.value;t.set(""+i+o.get(h),h)}for(var f=r.getSlots(),_=0;_<f.length;_++)f[_].childArmature&&n(f[_].name,f[_].childArmature)}("",this._armature)}},n.playAnimation=function(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){var n=this._armatureCache.getAnimationCache(this._armatureKey,t);n||(n=this._armatureCache.initAnimationCache(this._armatureKey,t)),n&&(this._accTime=0,this._playCount=0,this._frameCache=n,this._sockets.length>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes);return this.markForUpdateRenderData(),null},n.updateAnimationCache=function(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},n.getArmatureNames=function(){var t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]},n.getAnimationNames=function(t){var e=[],n=this._factory.getDragonBonesData(this._armatureKey);if(n){var i=n.getArmature(t);if(i)for(var r in i.animations)i.animations.hasOwnProperty(r)&&e.push(r)}return e},n.on=function(t,e,n){this.addEventListener(t,e,n)},n.off=function(t,e,n){this.removeEventListener(t,e,n)},n.once=function(t,e,n){this._eventTarget.once(t,e,n)},n.addEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.buildArmature=function(t,e){return this._factory.createArmatureNode(this,t,e)},n.armature=function(){return this._armature},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._armature&&this._assembler&&(this._renderData=this._assembler.createData(this),this._renderData&&(this.maxVertexCount=this._renderData.vertexCount,this.maxIndexCount=this._renderData.indexCount),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._armature){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}n.boneIndex=i,this._socketNodes.set(n.path,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}},Q(e,[{key:"dragonAsset",get:function(){return this._dragonAsset},set:function(t){this._dragonAsset=t,this.destroyRenderData(),this._refresh()}},{key:"dragonAtlasAsset",get:function(){return this._dragonAtlasAsset},set:function(t){this._dragonAtlasAsset=t,this._parseDragonAtlasAsset(),this._refresh()}},{key:"armatureName",get:function(){return this._armatureName},set:function(t){this._armatureName=t;var e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)}},{key:"animationName",get:function(){return this._animationName},set:function(t){this._animationName=t}},{key:"_defaultArmatureIndex",get:function(){return this._defaultArmatureIndexValue},set:function(t){this._defaultArmatureIndexValue=t;var e="";if(this.dragonAsset){var n;if(this.dragonAsset&&(n=this.dragonAsset.getArmatureEnum()),!n)return void O(7400,this.name);e=n[this._defaultArmatureIndex]}void 0!==e?this.armatureName=e:O(7401,this.name),this.markForUpdateRenderData()}},{key:"_animationIndex",get:function(){return this._animationIndexValue},set:function(t){var e;if(this._animationIndexValue=t,0!==this._animationIndex){if(this.dragonAsset&&(e=this.dragonAsset.getAnimsEnum(this.armatureName)),e){var n=e[this._animationIndex];void 0!==n?this.playAnimation(n,this.playTimes):O(7402,this.name)}}else this.animationName=""}},{key:"_defaultCacheMode",get:function(){return this._defaultCacheModeValue},set:function(t){if(this._defaultCacheModeValue=t,this._defaultCacheMode!==i8.REALTIME&&this._armature&&!K5.canCache(this._armature))return this._defaultCacheMode=i8.REALTIME,void console.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){this._timeScale=t,this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){this._debugBones=t,this._updateDebugDraw()}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._verifySockets(t),this._sockets=t,this._updateSocketBindings(),t.length>0&&this._frameCache&&this._frameCache.enableCacheAttachedInfo()}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"drawList",get:function(){return this._drawList}}]),e}(ok),Z6.AnimationCacheMode=i8,ct((z6=$6).prototype,"dragonAsset",[Vc,g6,v6],Object.getOwnPropertyDescriptor(z6.prototype,"dragonAsset"),z6.prototype),ct(z6.prototype,"dragonAtlasAsset",[Vc,y6,S6],Object.getOwnPropertyDescriptor(z6.prototype,"dragonAtlasAsset"),z6.prototype),ct(z6.prototype,"armatureName",[T6],Object.getOwnPropertyDescriptor(z6.prototype,"armatureName"),z6.prototype),ct(z6.prototype,"animationName",[x6],Object.getOwnPropertyDescriptor(z6.prototype,"animationName"),z6.prototype),ct(z6.prototype,"_defaultArmatureIndex",[E6,Vc,A6,C6],Object.getOwnPropertyDescriptor(z6.prototype,"_defaultArmatureIndex"),z6.prototype),ct(z6.prototype,"_animationIndex",[Vc,b6,w6,I6],Object.getOwnPropertyDescriptor(z6.prototype,"_animationIndex"),z6.prototype),ct(z6.prototype,"_defaultCacheMode",[Vc,P6,R6],Object.getOwnPropertyDescriptor(z6.prototype,"_defaultCacheMode"),z6.prototype),ct(z6.prototype,"timeScale",[Vc,D6,Dc],Object.getOwnPropertyDescriptor(z6.prototype,"timeScale"),z6.prototype),U6=ct(z6.prototype,"playTimes",[O6,Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),k6=ct(z6.prototype,"premultipliedAlpha",[Dc,Vc,N6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct(z6.prototype,"debugBones",[M6,Vc],Object.getOwnPropertyDescriptor(z6.prototype,"debugBones"),z6.prototype),ct(z6.prototype,"sockets",[L6,F6],Object.getOwnPropertyDescriptor(z6.prototype,"sockets"),z6.prototype),G6=ct(z6.prototype,"_defaultArmatureIndexValue",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t8.default}}),V6=ct(z6.prototype,"_dragonAsset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H6=ct(z6.prototype,"_dragonAtlasAsset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W6=ct(z6.prototype,"_armatureName",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),j6=ct(z6.prototype,"_animationName",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),X6=ct(z6.prototype,"_animationIndexValue",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q6=ct(z6.prototype,"_defaultCacheModeValue",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return i8.REALTIME}}),Y6=ct(z6.prototype,"_timeScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),K6=ct(z6.prototype,"_playTimes",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Q6=ct(z6.prototype,"_debugBones",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),J6=ct(z6.prototype,"_sockets",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B6=z6))||B6)||B6)||B6)||B6);l.internal.ArmatureDisplay=l8;var u8,h8,f8,_8,d8,p8,m8,g8,v8,y8,S8,T8,x8,E8,A8,C8,b8,w8,I8,P8=new Pn(255,0,0,255),R8=new Pn(0,0,255,255),D8=new Pn(0,255,0,255),O8=0,N8=0,M8=0,L8=0,F8=0,B8=0,z8=0,U8=0,k8=0,G8=new Float32Array(4),V8=new Xn,H8=null,W8=null;function j8(t,e){if(!t)return null;var n,i;switch(e){case 1:n=d8?Oi.ONE:Oi.SRC_ALPHA,i=Oi.ONE;break;case 10:n=Oi.DST_COLOR,i=Oi.ONE_MINUS_SRC_ALPHA;break;case 12:n=Oi.ONE,i=Oi.ONE_MINUS_SRC_COLOR;break;case 0:default:n=d8?Oi.ONE:Oi.SRC_ALPHA,i=Oi.ONE_MINUS_SRC_ALPHA}return y8.setBlendHash(),y8.getMaterialForBlend(n,i)}function X8(t,e){var n=t.a*e*_8,i=d8?n/255:1,r=t.r*u8*i/255,a=t.g*h8*i/255,o=t.b*f8*i/255;G8[0]=r,G8[1]=a,G8[2]=o,G8[3]=d8?1:n/255}var q8=null,Y8={accessor:q8,vCount:32767,ensureAccessor:function(){if(!q8){var t=lN.root.device,e=lN.root.batcher2D,n=VB;this.accessor=q8=new Iq(t,n,this.vCount),e.registerBufferAccessor(Number.parseInt("DRAGONBONES",36),q8)}return this.accessor},createData:function(t){var e=t.renderData;if(!e){this.ensureAccessor();for(var n=t._armature._slots,i=0,r=0,a=0;a<n.length;++a){var o=n[a];i+=o._localVertices.length/4,r+=o._indices.length}(e=hz.add(VB,this.accessor)).resize(i,r),e.indices&&r===e.indices.length||(e.indices=new Uint16Array(r))}return e},updateRenderData:function(t){y8=t,t._armature&&function(t){var e=t._armature;if(e){p8=!0,d8=t.premultipliedAlpha,t.drawList.reset(),y8=t,t.node,m8=t.renderData,y8=t,x8=0,H8=null;var n,i=t.color;if(u8=i.r/255,h8=i.g/255,f8=i.b/255,_8=t.node._uiProps.opacity,4294967295!==i._val&&(x8|=1),O8=0,M8=0,L8=0,F8=0,B8=0,k8=0,z8=y8.maxVertexCount,U8=y8.maxIndexCount,t.isAnimationCached())!function(t){if(t){var e=t.segments;if(0!==e.length){var n=null,i=t.vertices,r=t.indices,a=0,o=0,s=0,c=0,l=0,u=t.colors,h=u[l++],f=h.vfOffset;X8(h,1);for(var _=m8,d=_.chunk.vb,p=_.indices,m=0,g=e.length;m<g;m++){var v=e[m];if(n=j8(v.tex,v.blendMode)){if(H8||(H8=n),p8||n.hash!==H8.hash||v.tex&&v.tex!==W8){p8=!1;var y=B8-k8;y>0&&(y8._requestDrawData(H8,W8,k8,y),k8=B8),H8=n,W8=v.tex}N8=v.vertexCount,F8=v.indexCount,a=_.chunk.vertexOffset;for(var S=B8,T=B8+F8;S<T;S++)p[S]=a+M8+r[s++];c=v.vfCount;var x=i.subarray(o,c);d.set(x,o);if(1&x8)for(var E=o/9*5,A=o,C=o+c;A<C;A+=9,E+=5)E>=f&&(X8(h=u[l++],1),f=h.vfOffset),d.set(G8,A+5);o+=c,M8+=N8,B8+=F8,N8=0,F8=0}}var b=B8-k8;W8&&b>0&&y8._requestDrawData(H8,W8,k8,b)}}}(t._curFrame);else{K8(e,1,n);var r=t._debugDraw;if(t.debugBones&&r){r.clear(),r.lineWidth=5,r.strokeColor=P8,r.fillColor=R8;for(var a=e.getBones(),o=0,s=a.length;o<s;o++){var c=a[o],l=Math.max(c.boneData.length,5),u=c.globalTransformMatrix.tx,h=c.globalTransformMatrix.ty,f=u+c.globalTransformMatrix.a*l,_=h+c.globalTransformMatrix.b*l;r.moveTo(u,h),r.lineTo(f,_),r.stroke(),r.circle(u,h,2*Math.PI),r.fill(),0===o&&(r.fillColor=D8)}}}q8.getMeshBuffer(m8.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),y8=void 0}}(t)},updateColor:function(t){t&&(y8=t).markForUpdateRenderData()}};function K8(t,e,n){var i=m8;v8=i.chunk.vb,g8=i.indices;for(var r,a,o,s,c,l,u=t._slots,h=0,f=u.length;h<f;h++)if(s=(c=u[h])._color,c._visible&&c._displayData)if(n?c._mulMat(c._worldMatrix,n,c._matrix):Xn.copy(c._worldMatrix,c._matrix),c.childArmature)K8(c.childArmature,s.a/255,c._worldMatrix);else if(r=j8(c.getTexture(),c._blendMode)){H8||(H8=r);var _=c.getTexture();if(p8||r.hash!==H8.hash||_&&W8!==_){p8=!1;var d=B8-k8;d>0&&(y8._requestDrawData(H8,W8,k8,d),k8=B8),W8=_,H8=r}X8(s,e),V8.set(c._worldMatrix),a=c._localVertices,N8=a.length/4,O8=9*N8,o=c._indices,F8=o.length;var p=!1;if(M8+N8>z8&&(z8=M8+N8,p=!0),B8+F8>U8&&(U8=B8+F8,p=!0),p){var m=g8,g=i.chunk.vertexOffset;i.resizeAndCopy(z8,U8>i.indexCount?U8:i.indexCount),v8=i.chunk.vb,U8>g8.length&&(g8=i.indices=new Uint16Array(U8));for(var v=i.chunk.vertexOffset-g,y=0;y<B8;++y)g8[y]=m[y]+v}E8=V8.m00,A8=V8.m04,C8=V8.m12,b8=V8.m01,w8=V8.m05,I8=V8.m13;for(var S=0,T=a.length,x=L8;S<T;x+=9)S8=a[S++],T8=a[S++],v8[x]=S8*E8+T8*A8+C8,v8[x+1]=S8*b8+T8*w8+I8,v8[x+3]=a[S++],v8[x+4]=a[S++],v8.set(G8,x+5);for(var E=i.chunk.vertexOffset,A=0,C=o.length,b=B8;A<C;A++,b++)g8[b]=M8+o[A]+E;L8+=O8,M8+=N8,B8+=F8,N8=0,F8=0}l=B8-k8,W8&&l>0&&(y8._requestDrawData(H8,W8,k8,l),k8=B8),y8.maxIndexCount<U8&&(y8.maxIndexCount=U8),y8.maxVertexCount<z8&&(y8.maxVertexCount=z8)}l.internal.DragonBonesAssembler=Y8;var Q8,J8,Z8,$8={getAssembler:function(){return Y8}};l8.Assembler=$8,k(l8.prototype,"ArmatureDisplay",[{name:"_enableBatch",suggest:"Not support batch render mode"}]),function(t){t[t.FFD=0]="FFD",t[t.AdjustColor=10]="AdjustColor",t[t.BevelFilter=11]="BevelFilter",t[t.BlurFilter=12]="BlurFilter",t[t.DropShadowFilter=13]="DropShadowFilter",t[t.GlowFilter=14]="GlowFilter",t[t.GradientBevelFilter=15]="GradientBevelFilter",t[t.GradientGlowFilter=16]="GradientGlowFilter"}(Q8||(Q8={})),function(t){t[t.Frame=0]="Frame",t[t.Sound=1]="Sound"}(J8||(J8={})),function(t){t[t.None=0]="None",t[t.SameLayer=1]="SameLayer",t[t.SameGroup=2]="SameGroup",t[t.SameLayerAndGroup=3]="SameLayerAndGroup",t[t.All=4]="All"}(Z8||(Z8={})),t("dragonBones",Object.freeze({__proto__:null,get ExtensionType(){return Q8},get EventType(){return J8},get AnimationFadeOutMode(){return Z8},CCFactory:M5,CCSlot:O5,CCTextureAtlasData:R5,CCTextureData:D5,CCArmatureDisplay:N5,AnimationCache:Y5,ArmatureCache:K5,DragonBonesAsset:a6,DragonBonesAtlasAsset:s6,timeScale:1,get AnimationCacheMode(){return i8},DragonBoneSocket:c8,ArmatureDisplay:l8,AttachUtil:a8,simpleDragonBoneAssembler:$8,DragonBones:e3,BaseObject:n3,Matrix:i3,Transform:r3,ColorTransform:a3,Point:o3,Rectangle:s3,UserData:c3,ActionData:l3,DragonBonesData:u3,ArmatureData:h3,BoneData:f3,SurfaceData:_3,SlotData:d3,ConstraintData:p3,IKConstraintData:m3,PathConstraintData:g3,CanvasData:v3,SkinData:y3,VerticesData:S3,DisplayData:T3,ImageDisplayData:x3,ArmatureDisplayData:E3,MeshDisplayData:A3,BoundingBoxDisplayData:C3,PathDisplayData:b3,WeightData:w3,BoundingBoxData:I3,RectangleBoundingBoxData:P3,EllipseBoundingBoxData:R3,PolygonBoundingBoxData:D3,AnimationData:O3,TimelineData:N3,AnimationConfig:M3,TextureAtlasData:L3,TextureData:F3,DeformVertices:B3,Armature:z3,TransformObject:U3,Bone:k3,Surface:G3,Slot:V3,Constraint:H3,IKConstraint:W3,PathConstraint:j3,WorldClock:X3,Animation:q3,AnimationState:Y3,BonePose:K3,BlendState:Q3,TimelineState:J3,TweenTimelineState:Z3,BoneTimelineState:$3,SlotTimelineState:t5,ConstraintTimelineState:e5,ActionTimelineState:n5,ZOrderTimelineState:i5,BoneAllTimelineState:r5,BoneTranslateTimelineState:a5,BoneRotateTimelineState:o5,BoneScaleTimelineState:s5,SurfaceTimelineState:c5,SlotDislayTimelineState:l5,SlotColorTimelineState:u5,DeformTimelineState:h5,IKConstraintTimelineState:f5,AnimationTimelineState:_5,EventObject:d5,DataParser:p5,ObjectDataParser:m5,ActionFrame:g5,BinaryDataParser:v5,BaseFactory:y5,BuildArmaturePackage:S5,BinaryOffset:T5,ArmatureType:x5,BoneType:E5,DisplayType:A5,BoundingBoxType:C5,ActionType:b5,BlendMode:w5,TweenType:I5,TimelineType:P5}));var t7,e7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSet=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,n=e.bindings,i=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:i};for(var o=0;o<n.length;++o)for(var s=n[o],c=0;c<s.count;c++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null})},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&ia){var n=this._buffers[e];n&&(t[e].gpuBuffer=n.gpuBuffer||n.gpuBufferView)}else t[e].type&ra&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Q(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(xa);!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(t7||(t7={}));var n7=function(){function t(){}return t.setInstance=function(e){t._instance=e},Q(t,null,[{key:"instance",get:function(){return t._instance}}]),t}();function i7(t,e){switch(t){case pi.R8:return e.UNSIGNED_BYTE;case pi.R8SN:return e.BYTE;case pi.R8UI:return e.UNSIGNED_BYTE;case pi.R8I:return e.BYTE;case pi.R16F:return t7.HALF_FLOAT_OES;case pi.R16UI:return e.UNSIGNED_SHORT;case pi.R16I:return e.SHORT;case pi.R32F:return e.FLOAT;case pi.R32UI:return e.UNSIGNED_INT;case pi.R32I:return e.INT;case pi.RG8:return e.UNSIGNED_BYTE;case pi.RG8SN:return e.BYTE;case pi.RG8UI:return e.UNSIGNED_BYTE;case pi.RG8I:return e.BYTE;case pi.RG16F:return t7.HALF_FLOAT_OES;case pi.RG16UI:return e.UNSIGNED_SHORT;case pi.RG16I:return e.SHORT;case pi.RG32F:return e.FLOAT;case pi.RG32UI:return e.UNSIGNED_INT;case pi.RG32I:return e.INT;case pi.RGB8:case pi.SRGB8:return e.UNSIGNED_BYTE;case pi.RGB8SN:return e.BYTE;case pi.RGB8UI:return e.UNSIGNED_BYTE;case pi.RGB8I:return e.BYTE;case pi.RGB16F:return t7.HALF_FLOAT_OES;case pi.RGB16UI:return e.UNSIGNED_SHORT;case pi.RGB16I:return e.SHORT;case pi.RGB32F:return e.FLOAT;case pi.RGB32UI:return e.UNSIGNED_INT;case pi.RGB32I:return e.INT;case pi.BGRA8:case pi.RGBA8:case pi.SRGB8_A8:return e.UNSIGNED_BYTE;case pi.RGBA8SN:return e.BYTE;case pi.RGBA8UI:return e.UNSIGNED_BYTE;case pi.RGBA8I:return e.BYTE;case pi.RGBA16F:return t7.HALF_FLOAT_OES;case pi.RGBA16UI:return e.UNSIGNED_SHORT;case pi.RGBA16I:return e.SHORT;case pi.RGBA32F:return e.FLOAT;case pi.RGBA32UI:return e.UNSIGNED_INT;case pi.RGBA32I:return e.INT;case pi.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case pi.R11G11B10F:return e.FLOAT;case pi.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case pi.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case pi.RGB10A2:return e.UNSIGNED_BYTE;case pi.RGB10A2UI:return e.UNSIGNED_INT;case pi.RGB9E5:return e.UNSIGNED_BYTE;case pi.DEPTH:return e.UNSIGNED_INT;case pi.DEPTH_STENCIL:return t7.UNSIGNED_INT_24_8_WEBGL;case pi.BC1:case pi.BC1_SRGB:case pi.BC2:case pi.BC2_SRGB:case pi.BC3:case pi.BC3_SRGB:case pi.BC4:return e.UNSIGNED_BYTE;case pi.BC4_SNORM:return e.BYTE;case pi.BC5:return e.UNSIGNED_BYTE;case pi.BC5_SNORM:return e.BYTE;case pi.BC6H_SF16:case pi.BC6H_UF16:return e.FLOAT;case pi.BC7:case pi.BC7_SRGB:case pi.ETC_RGB8:case pi.ETC2_RGB8:case pi.ETC2_SRGB8:case pi.ETC2_RGB8_A1:case pi.ETC2_SRGB8_A1:case pi.EAC_R11:return e.UNSIGNED_BYTE;case pi.EAC_R11SN:return e.BYTE;case pi.EAC_RG11:return e.UNSIGNED_BYTE;case pi.EAC_RG11SN:return e.BYTE;case pi.PVRTC_RGB2:case pi.PVRTC_RGBA2:case pi.PVRTC_RGB4:case pi.PVRTC_RGBA4:case pi.PVRTC2_2BPP:case pi.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case pi.ASTC_RGBA_4X4:case pi.ASTC_RGBA_5X4:case pi.ASTC_RGBA_5X5:case pi.ASTC_RGBA_6X5:case pi.ASTC_RGBA_6X6:case pi.ASTC_RGBA_8X5:case pi.ASTC_RGBA_8X6:case pi.ASTC_RGBA_8X8:case pi.ASTC_RGBA_10X5:case pi.ASTC_RGBA_10X6:case pi.ASTC_RGBA_10X8:case pi.ASTC_RGBA_10X10:case pi.ASTC_RGBA_12X10:case pi.ASTC_RGBA_12X12:case pi.ASTC_SRGBA_4X4:case pi.ASTC_SRGBA_5X4:case pi.ASTC_SRGBA_5X5:case pi.ASTC_SRGBA_6X5:case pi.ASTC_SRGBA_6X6:case pi.ASTC_SRGBA_8X5:case pi.ASTC_SRGBA_8X6:case pi.ASTC_SRGBA_8X8:case pi.ASTC_SRGBA_10X5:case pi.ASTC_SRGBA_10X6:case pi.ASTC_SRGBA_10X8:case pi.ASTC_SRGBA_10X10:case pi.ASTC_SRGBA_12X10:case pi.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function r7(t,e){switch(t){case gi.BOOL:return e.BOOL;case gi.BOOL2:return e.BOOL_VEC2;case gi.BOOL3:return e.BOOL_VEC3;case gi.BOOL4:return e.BOOL_VEC4;case gi.INT:return e.INT;case gi.INT2:return e.INT_VEC2;case gi.INT3:return e.INT_VEC3;case gi.INT4:return e.INT_VEC4;case gi.UINT:return e.UNSIGNED_INT;case gi.FLOAT:return e.FLOAT;case gi.FLOAT2:return e.FLOAT_VEC2;case gi.FLOAT3:return e.FLOAT_VEC3;case gi.FLOAT4:return e.FLOAT_VEC4;case gi.MAT2:return e.FLOAT_MAT2;case gi.MAT3:return e.FLOAT_MAT3;case gi.MAT4:return e.FLOAT_MAT4;case gi.SAMPLER2D:return e.SAMPLER_2D;case gi.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),gi.UNKNOWN}}function a7(t){switch(t){case gi.BOOL:case gi.BOOL2:case gi.BOOL3:case gi.BOOL4:case gi.INT:case gi.INT2:case gi.INT3:case gi.INT4:case gi.UINT:return Int32Array;case gi.FLOAT:case gi.FLOAT2:case gi.FLOAT3:case gi.FLOAT4:case gi.MAT2:case gi.MAT3:case gi.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function o7(t,e){switch(t){case e.BOOL:return gi.BOOL;case e.BOOL_VEC2:return gi.BOOL2;case e.BOOL_VEC3:return gi.BOOL3;case e.BOOL_VEC4:return gi.BOOL4;case e.INT:return gi.INT;case e.INT_VEC2:return gi.INT2;case e.INT_VEC3:return gi.INT3;case e.INT_VEC4:return gi.INT4;case e.UNSIGNED_INT:return gi.UINT;case e.FLOAT:return gi.FLOAT;case e.FLOAT_VEC2:return gi.FLOAT2;case e.FLOAT_VEC3:return gi.FLOAT3;case e.FLOAT_VEC4:return gi.FLOAT4;case e.FLOAT_MAT2:return gi.MAT2;case e.FLOAT_MAT3:return gi.MAT3;case e.FLOAT_MAT4:return gi.MAT4;case e.SAMPLER_2D:return gi.SAMPLER2D;case e.SAMPLER_CUBE:return gi.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),gi.UNKNOWN}}function s7(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function c7(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}n7._instance=null;var l7,u7=[512,513,514,515,516,517,518,519],h7=[0,7680,7681,7682,7683,5386,34055,34056],f7=[32774,32778,32779,32775,32776],_7=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(l7||(l7={}));var d7=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},p7=function(t){function e(){var e;return(e=t.call(this,l7.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new ir,e.clearFlag=Ji.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return Z(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(d7),m7=function(t){function e(){var e;return(e=t.call(this,l7.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new ta,e}return Z(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(d7),g7=function(t){function e(){var e;return(e=t.call(this,l7.DRAW)||this).drawInfo=new gr,e}return Z(e,t),e.prototype.clear=function(){},e}(d7),v7=function(t){function e(){var e;return(e=t.call(this,l7.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return Z(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(d7),y7=function(t){function e(){var e;return(e=t.call(this,l7.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return Z(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(d7),S7=function(){function t(){this.cmds=new jl(1),this.beginRenderPassCmds=new jl(1),this.bindStatesCmds=new jl(1),this.drawCmds=new jl(1),this.updateBufferCmds=new jl(1),this.copyBufferToTextureCmds=new jl(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function T7(t,e,n,i,r){if(e.usage&vi.UNIFORM)ArrayBuffer.isView(n)?e.vf32.set(n,i/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(n),i/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&vi.INDIRECT){e.indirects.clearDraws();for(var a=n.drawInfos,o=0;o<a.length;++o)e.indirects.setDrawInfo(i+o,a[o])}else{var s=n,c=t.gl,l=t.stateCache;switch(e.glTarget){case c.ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case c.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r))}}var x7={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},E7=new ir;function A7(t,e,n,i,r,a,o){var s=t.gl,c=t.stateCache,l=0;if(n&&(E7.x=i.x<<n.lodLevel,E7.y=i.y<<n.lodLevel,E7.width=i.width<<n.lodLevel,E7.height=i.height<<n.lodLevel),n&&e){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===E7.x&&c.viewport.top===E7.y&&c.viewport.width===E7.width&&c.viewport.height===E7.height||(s.viewport(E7.x,E7.y,E7.width,E7.height),c.viewport.left=E7.x,c.viewport.top=E7.y,c.viewport.width=E7.width,c.viewport.height=E7.height),c.scissorRect.x===E7.x&&c.scissorRect.y===E7.y&&c.scissorRect.width===E7.width&&c.scissorRect.height===E7.height||(s.scissor(E7.x,E7.y,E7.width,E7.height),c.scissorRect.x=E7.x,c.scissorRect.y=E7.y,c.scissorRect.width=E7.width,c.scissorRect.height=E7.height);var u=r.length;t.extensions.WEBGL_draw_buffers||(u=1);for(var h=0;h<u;++h){var f=e.colorAttachments[h];if(f.format!==pi.UNKNOWN)switch(f.loadOp){case Fi.LOAD:break;case Fi.CLEAR:c.bs.targets[0].blendColorMask!==Mi.ALL&&s.colorMask(!0,!0,!0,!0);var _=r[0];s.clearColor(_.x,_.y,_.z,_.w),l|=s.COLOR_BUFFER_BIT;break;case Fi.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==pi.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),l|=s.DEPTH_BUFFER_BIT;break;case Fi.DISCARD:}if(na[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),l|=s.STENCIL_BUFFER_BIT;break;case Fi.DISCARD:}}if(l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var d=c.bs.targets[0].blendColorMask;if(d!==Mi.ALL){var p=(d&Mi.R)!==Mi.NONE,m=(d&Mi.G)!==Mi.NONE,g=(d&Mi.B)!==Mi.NONE,v=(d&Mi.A)!==Mi.NONE;s.colorMask(p,m,g,v)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function C7(t,e,n,i,r,a){var o,s,c,l=t.gl,u=t.stateCache,h=e&&e.gpuShader,f=!1;if(e&&x7.gpuPipelineState!==e){if(x7.gpuPipelineState=e,x7.glPrimitive=e.glPrimitive,e.gpuShader){var _=e.gpuShader.glProgram;u.glProgram!==_&&(l.useProgram(_),u.glProgram=_,f=!0)}var d=e.rs;if(d){if(u.rs.cullMode!==d.cullMode){switch(d.cullMode){case Wi.NONE:l.disable(l.CULL_FACE);break;case Wi.FRONT:l.enable(l.CULL_FACE),l.cullFace(l.FRONT);break;case Wi.BACK:l.enable(l.CULL_FACE),l.cullFace(l.BACK)}u.rs.cullMode=d.cullMode}var p=d.isFrontFaceCCW;u.rs.isFrontFaceCCW!==p&&(l.frontFace(p?l.CCW:l.CW),u.rs.isFrontFaceCCW=p),u.rs.depthBias===d.depthBias&&u.rs.depthBiasSlop===d.depthBiasSlop||(l.polygonOffset(d.depthBias,d.depthBiasSlop),u.rs.depthBias=d.depthBias,u.rs.depthBiasSlop=d.depthBiasSlop),u.rs.lineWidth!==d.lineWidth&&(l.lineWidth(d.lineWidth),u.rs.lineWidth=d.lineWidth)}var m=e.dss;m&&(u.dss.depthTest!==m.depthTest&&(m.depthTest?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),u.dss.depthTest=m.depthTest),u.dss.depthWrite!==m.depthWrite&&(l.depthMask(m.depthWrite),u.dss.depthWrite=m.depthWrite),u.dss.depthFunc!==m.depthFunc&&(l.depthFunc(u7[m.depthFunc]),u.dss.depthFunc=m.depthFunc),u.dss.stencilTestFront===m.stencilTestFront&&u.dss.stencilTestBack===m.stencilTestBack||(m.stencilTestFront||m.stencilTestBack?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),u.dss.stencilTestFront=m.stencilTestFront,u.dss.stencilTestBack=m.stencilTestBack),u.dss.stencilFuncFront===m.stencilFuncFront&&u.dss.stencilRefFront===m.stencilRefFront&&u.dss.stencilReadMaskFront===m.stencilReadMaskFront||(l.stencilFuncSeparate(l.FRONT,u7[m.stencilFuncFront],m.stencilRefFront,m.stencilReadMaskFront),u.dss.stencilFuncFront=m.stencilFuncFront,u.dss.stencilRefFront=m.stencilRefFront,u.dss.stencilReadMaskFront=m.stencilReadMaskFront),u.dss.stencilFailOpFront===m.stencilFailOpFront&&u.dss.stencilZFailOpFront===m.stencilZFailOpFront&&u.dss.stencilPassOpFront===m.stencilPassOpFront||(l.stencilOpSeparate(l.FRONT,h7[m.stencilFailOpFront],h7[m.stencilZFailOpFront],h7[m.stencilPassOpFront]),u.dss.stencilFailOpFront=m.stencilFailOpFront,u.dss.stencilZFailOpFront=m.stencilZFailOpFront,u.dss.stencilPassOpFront=m.stencilPassOpFront),u.dss.stencilWriteMaskFront!==m.stencilWriteMaskFront&&(l.stencilMaskSeparate(l.FRONT,m.stencilWriteMaskFront),u.dss.stencilWriteMaskFront=m.stencilWriteMaskFront),u.dss.stencilFuncBack===m.stencilFuncBack&&u.dss.stencilRefBack===m.stencilRefBack&&u.dss.stencilReadMaskBack===m.stencilReadMaskBack||(l.stencilFuncSeparate(l.BACK,u7[m.stencilFuncBack],m.stencilRefBack,m.stencilReadMaskBack),u.dss.stencilFuncBack=m.stencilFuncBack,u.dss.stencilRefBack=m.stencilRefBack,u.dss.stencilReadMaskBack=m.stencilReadMaskBack),u.dss.stencilFailOpBack===m.stencilFailOpBack&&u.dss.stencilZFailOpBack===m.stencilZFailOpBack&&u.dss.stencilPassOpBack===m.stencilPassOpBack||(l.stencilOpSeparate(l.BACK,h7[m.stencilFailOpBack],h7[m.stencilZFailOpBack],h7[m.stencilPassOpBack]),u.dss.stencilFailOpBack=m.stencilFailOpBack,u.dss.stencilZFailOpBack=m.stencilZFailOpBack,u.dss.stencilPassOpBack=m.stencilPassOpBack),u.dss.stencilWriteMaskBack!==m.stencilWriteMaskBack&&(l.stencilMaskSeparate(l.BACK,m.stencilWriteMaskBack),u.dss.stencilWriteMaskBack=m.stencilWriteMaskBack));var g=e.bs;if(g){u.bs.isA2C!==g.isA2C&&(g.isA2C?l.enable(l.SAMPLE_ALPHA_TO_COVERAGE):l.disable(l.SAMPLE_ALPHA_TO_COVERAGE),u.bs.isA2C=g.isA2C),u.bs.blendColor.x===g.blendColor.x&&u.bs.blendColor.y===g.blendColor.y&&u.bs.blendColor.z===g.blendColor.z&&u.bs.blendColor.w===g.blendColor.w||(l.blendColor(g.blendColor.x,g.blendColor.y,g.blendColor.z,g.blendColor.w),u.bs.blendColor.x=g.blendColor.x,u.bs.blendColor.y=g.blendColor.y,u.bs.blendColor.z=g.blendColor.z,u.bs.blendColor.w=g.blendColor.w);var v=g.targets[0],y=u.bs.targets[0];y.blend!==v.blend&&(v.blend?l.enable(l.BLEND):l.disable(l.BLEND),y.blend=v.blend),y.blendEq===v.blendEq&&y.blendAlphaEq===v.blendAlphaEq||(l.blendEquationSeparate(f7[v.blendEq],f7[v.blendAlphaEq]),y.blendEq=v.blendEq,y.blendAlphaEq=v.blendAlphaEq),y.blendSrc===v.blendSrc&&y.blendDst===v.blendDst&&y.blendSrcAlpha===v.blendSrcAlpha&&y.blendDstAlpha===v.blendDstAlpha||(l.blendFuncSeparate(_7[v.blendSrc],_7[v.blendDst],_7[v.blendSrcAlpha],_7[v.blendDstAlpha]),y.blendSrc=v.blendSrc,y.blendDst=v.blendDst,y.blendSrcAlpha=v.blendSrcAlpha,y.blendDstAlpha=v.blendDstAlpha),y.blendColorMask!==v.blendColorMask&&(l.colorMask((v.blendColorMask&Mi.R)!==Mi.NONE,(v.blendColorMask&Mi.G)!==Mi.NONE,(v.blendColorMask&Mi.B)!==Mi.NONE,(v.blendColorMask&Mi.A)!==Mi.NONE),y.blendColorMask=v.blendColorMask)}}if(e&&e.gpuPipelineLayout&&h){for(var S=h.glBlocks.length,x=e.gpuPipelineLayout.dynamicOffsetIndices,E=0;E<S;E++){var A=h.glBlocks[E],C=i[A.set],b=C&&C.descriptorIndices[A.binding],w=b>=0&&C.gpuDescriptors[b],I=null,P=0;if(w&&w.gpuBuffer){var R=w.gpuBuffer,D=x[A.set],O=D&&D[A.binding];O>=0&&(P=r[O]),"vf32"in R?I=R.vf32:(P+=R.offset,I=R.gpuBuffer.vf32),P>>=2}if(I)for(var N=A.glActiveUniforms.length,M=0;M<N;M++){var L=A.glActiveUniforms[M];switch(L.glType){case l.BOOL:case l.INT:for(var F=0;F<L.array.length;++F){var B=L.offset+P+F;if(I[B]!==L.array[F]){for(var z=F,U=B;z<L.array.length;++z,++U)L.array[z]=I[U];l.uniform1iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC2:case l.INT_VEC2:for(var k=0;k<L.array.length;++k){var G=L.offset+P+k;if(I[G]!==L.array[k]){for(var V=k,H=G;V<L.array.length;++V,++H)L.array[V]=I[H];l.uniform2iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC3:case l.INT_VEC3:for(var W=0;W<L.array.length;++W){var j=L.offset+P+W;if(I[j]!==L.array[W]){for(var X=W,q=j;X<L.array.length;++X,++q)L.array[X]=I[q];l.uniform3iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC4:case l.INT_VEC4:for(var Y=0;Y<L.array.length;++Y){var K=L.offset+P+Y;if(I[K]!==L.array[Y]){for(var Q=Y,J=K;Q<L.array.length;++Q,++J)L.array[Q]=I[J];l.uniform4iv(L.glLoc,L.array);break}}break;case l.FLOAT:for(var Z=0;Z<L.array.length;++Z){var $=L.offset+P+Z;if(I[$]!==L.array[Z]){for(var tt=Z,et=$;tt<L.array.length;++tt,++et)L.array[tt]=I[et];l.uniform1fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC2:for(var nt=0;nt<L.array.length;++nt){var it=L.offset+P+nt;if(I[it]!==L.array[nt]){for(var rt=nt,at=it;rt<L.array.length;++rt,++at)L.array[rt]=I[at];l.uniform2fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC3:for(var ot=0;ot<L.array.length;++ot){var st=L.offset+P+ot;if(I[st]!==L.array[ot]){for(var ct=ot,lt=st;ct<L.array.length;++ct,++lt)L.array[ct]=I[lt];l.uniform3fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC4:for(var ut=0;ut<L.array.length;++ut){var ht=L.offset+P+ut;if(I[ht]!==L.array[ut]){for(var ft=ut,_t=ht;ft<L.array.length;++ft,++_t)L.array[ft]=I[_t];l.uniform4fv(L.glLoc,L.array);break}}break;case l.FLOAT_MAT2:for(var dt=0;dt<L.array.length;++dt){var pt=L.offset+P+dt;if(I[pt]!==L.array[dt]){for(var mt=dt,gt=pt;mt<L.array.length;++mt,++gt)L.array[mt]=I[gt];l.uniformMatrix2fv(L.glLoc,!1,L.array);break}}break;case l.FLOAT_MAT3:for(var vt=0;vt<L.array.length;++vt){var yt=L.offset+P+vt;if(I[yt]!==L.array[vt]){for(var St=vt,Tt=yt;St<L.array.length;++St,++Tt)L.array[St]=I[Tt];l.uniformMatrix3fv(L.glLoc,!1,L.array);break}}break;case l.FLOAT_MAT4:for(var xt=0;xt<L.array.length;++xt){var Et=L.offset+P+xt;if(I[Et]!==L.array[xt]){for(var At=xt,Ct=Et;At<L.array.length;++At,++Ct)L.array[At]=I[Ct];l.uniformMatrix4fv(L.glLoc,!1,L.array);break}}}}else T("Buffer binding '"+A.name+"' at set "+A.set+" binding "+A.binding+" is not bounded")}for(var bt=h.glSamplerTextures.length,wt=0;wt<bt;wt++)for(var It=h.glSamplerTextures[wt],Pt=i[It.set],Rt=Pt&&Pt.descriptorIndices[It.binding],Dt=Rt>=0&&Pt.gpuDescriptors[Rt],Ot=It.units.length,Nt=0;Nt<Ot;Nt++){var Mt=It.units[Nt];if(Dt&&Dt.gpuSampler){if(Dt.gpuTexture&&Dt.gpuTexture.size>0){var Lt=Dt.gpuTexture,Ft=u.glTexUnits[Mt];Ft.glTexture!==Lt.glTexture&&(u.texUnit!==Mt&&(l.activeTexture(l.TEXTURE0+Mt),u.texUnit=Mt),Lt.glTexture?l.bindTexture(Lt.glTarget,Lt.glTexture):l.bindTexture(Lt.glTarget,t.nullTex2D.gpuTexture.glTexture),Ft.glTexture=Lt.glTexture);var Bt=Dt.gpuSampler;Lt.isPowerOf2?(o=Bt.glWrapS,s=Bt.glWrapT):(o=l.CLAMP_TO_EDGE,s=l.CLAMP_TO_EDGE),c=Lt.isPowerOf2?Lt.mipLevel<=1&&(Bt.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Bt.glMinFilter===l.LINEAR_MIPMAP_LINEAR)?l.LINEAR:Bt.glMinFilter:Bt.glMinFilter===l.LINEAR||Bt.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Bt.glMinFilter===l.LINEAR_MIPMAP_LINEAR?l.LINEAR:l.NEAREST,Lt.glWrapS!==o&&(u.texUnit!==Mt&&(l.activeTexture(l.TEXTURE0+Mt),u.texUnit=Mt),l.texParameteri(Lt.glTarget,l.TEXTURE_WRAP_S,o),Lt.glWrapS=o),Lt.glWrapT!==s&&(u.texUnit!==Mt&&(l.activeTexture(l.TEXTURE0+Mt),u.texUnit=Mt),l.texParameteri(Lt.glTarget,l.TEXTURE_WRAP_T,s),Lt.glWrapT=s),Lt.glMinFilter!==c&&(u.texUnit!==Mt&&(l.activeTexture(l.TEXTURE0+Mt),u.texUnit=Mt),l.texParameteri(Lt.glTarget,l.TEXTURE_MIN_FILTER,c),Lt.glMinFilter=c),Lt.glMagFilter!==Bt.glMagFilter&&(u.texUnit!==Mt&&(l.activeTexture(l.TEXTURE0+Mt),u.texUnit=Mt),l.texParameteri(Lt.glTarget,l.TEXTURE_MAG_FILTER,Bt.glMagFilter),Lt.glMagFilter=Bt.glMagFilter)}Dt=Pt.gpuDescriptors[++Rt]}else T("Sampler binding '"+It.name+"' at set "+It.set+" binding "+It.binding+" index "+Nt+" is not bounded")}}if(n&&h&&(f||x7.gpuInputAssembler!==n)){x7.gpuInputAssembler=n;var zt=t.extensions.ANGLE_instanced_arrays;if(t.extensions.useVAO){var Ut=t.extensions.OES_vertex_array_object,kt=n.glVAOs.get(h.glProgram);if(!kt){var Gt;kt=Ut.createVertexArrayOES(),n.glVAOs.set(h.glProgram,kt),Ut.bindVertexArrayOES(kt),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null;for(var Vt=h.glInputs.length,Ht=0;Ht<Vt;Ht++){var Wt=h.glInputs[Ht];Gt=null;for(var jt=n.glAttribs.length,Xt=0;Xt<jt;Xt++){var qt=n.glAttribs[Xt];if(qt.name===Wt.name){Gt=qt;break}}if(Gt){u.glArrayBuffer!==Gt.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,Gt.glBuffer),u.glArrayBuffer=Gt.glBuffer);for(var Yt=0;Yt<Gt.componentCount;++Yt){var Kt=Wt.glLoc+Yt,Qt=Gt.offset+Gt.size*Yt;l.enableVertexAttribArray(Kt),u.glCurrentAttribLocs[Kt]=!0,l.vertexAttribPointer(Kt,Gt.count,Gt.glType,Gt.isNormalized,Gt.stride,Qt),zt&&zt.vertexAttribDivisorANGLE(Kt,Gt.isInstanced?1:0)}}}var Jt=n.gpuIndexBuffer;Jt&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Jt.glBuffer),Ut.bindVertexArrayOES(null),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null}u.glVAO!==kt&&(Ut.bindVertexArrayOES(kt),u.glVAO=kt)}else{for(var Zt=0;Zt<t.capabilities.maxVertexAttributes;++Zt)u.glCurrentAttribLocs[Zt]=!1;for(var $t=h.glInputs.length,te=0;te<$t;te++){for(var ee=h.glInputs[te],ne=null,ie=n.glAttribs.length,re=0;re<ie;re++){var ae=n.glAttribs[re];if(ae.name===ee.name){ne=ae;break}}if(ne){u.glArrayBuffer!==ne.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,ne.glBuffer),u.glArrayBuffer=ne.glBuffer);for(var oe=0;oe<ne.componentCount;++oe){var se=ee.glLoc+oe,ce=ne.offset+ne.size*oe;!u.glEnabledAttribLocs[se]&&se>=0&&(l.enableVertexAttribArray(se),u.glEnabledAttribLocs[se]=!0),u.glCurrentAttribLocs[se]=!0,l.vertexAttribPointer(se,ne.count,ne.glType,ne.isNormalized,ne.stride,ce),zt&&zt.vertexAttribDivisorANGLE(se,ne.isInstanced?1:0)}}}var le=n.gpuIndexBuffer;le&&u.glElementArrayBuffer!==le.glBuffer&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,le.glBuffer),u.glElementArrayBuffer=le.glBuffer);for(var ue=0;ue<t.capabilities.maxVertexAttributes;++ue)u.glEnabledAttribLocs[ue]!==u.glCurrentAttribLocs[ue]&&(l.disableVertexAttribArray(ue),u.glEnabledAttribLocs[ue]=!1)}}if(e&&e.dynamicStates.length)for(var he=e.dynamicStates.length,fe=0;fe<he;fe++)switch(e.dynamicStates[fe]){case ji.LINE_WIDTH:u.rs.lineWidth!==a.lineWidth&&(l.lineWidth(a.lineWidth),u.rs.lineWidth=a.lineWidth);break;case ji.DEPTH_BIAS:u.rs.depthBias===a.depthBiasConstant&&u.rs.depthBiasSlop===a.depthBiasSlope||(l.polygonOffset(a.depthBiasConstant,a.depthBiasSlope),u.rs.depthBias=a.depthBiasConstant,u.rs.depthBiasSlop=a.depthBiasSlope);break;case ji.BLEND_CONSTANTS:var _e=a.blendConstant;u.bs.blendColor.x===_e.x&&u.bs.blendColor.y===_e.y&&u.bs.blendColor.z===_e.z&&u.bs.blendColor.w===_e.w||(l.blendColor(_e.x,_e.y,_e.z,_e.w),u.bs.blendColor.copy(_e));break;case ji.STENCIL_WRITE_MASK:var de=a.stencilStatesFront,pe=a.stencilStatesBack;u.dss.stencilWriteMaskFront!==de.writeMask&&(l.stencilMaskSeparate(l.FRONT,de.writeMask),u.dss.stencilWriteMaskFront=de.writeMask),u.dss.stencilWriteMaskBack!==pe.writeMask&&(l.stencilMaskSeparate(l.BACK,pe.writeMask),u.dss.stencilWriteMaskBack=pe.writeMask);break;case ji.STENCIL_COMPARE_MASK:var me=a.stencilStatesFront,ge=a.stencilStatesBack;u.dss.stencilRefFront===me.reference&&u.dss.stencilReadMaskFront===me.compareMask||(l.stencilFuncSeparate(l.FRONT,u7[u.dss.stencilFuncFront],me.reference,me.compareMask),u.dss.stencilRefFront=me.reference,u.dss.stencilReadMaskFront=me.compareMask),u.dss.stencilRefBack===ge.reference&&u.dss.stencilReadMaskBack===ge.compareMask||(l.stencilFuncSeparate(l.BACK,u7[u.dss.stencilFuncBack],ge.reference,ge.compareMask),u.dss.stencilRefBack=ge.reference,u.dss.stencilReadMaskBack=ge.compareMask)}}function b7(t,e){var n=t.gl,i=t.extensions,r=i.ANGLE_instanced_arrays,a=i.WEBGL_multi_draw,o=x7.gpuInputAssembler,s=x7.glPrimitive;if(o){var c=o.gpuIndexBuffer;if(o.gpuIndirectBuffer){var l=o.gpuIndirectBuffer.indirects;if(l.drawByIndex){for(var u=0;u<l.drawCount;u++)l.byteOffsets[u]=l.offsets[u]*c.stride;if(a)l.instancedDraw?a.multiDrawElementsInstancedWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.instances,0,l.drawCount):a.multiDrawElementsWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.drawCount);else for(var h=0;h<l.drawCount;h++)l.instances[h]&&r?r.drawElementsInstancedANGLE(s,l.counts[h],o.glIndexType,l.byteOffsets[h],l.instances[h]):n.drawElements(s,l.counts[h],o.glIndexType,l.byteOffsets[h])}else if(a)l.instancedDraw?a.multiDrawArraysInstancedWEBGL(s,l.offsets,0,l.counts,0,l.instances,0,l.drawCount):a.multiDrawArraysWEBGL(s,l.offsets,0,l.counts,0,l.drawCount);else for(var f=0;f<l.drawCount;f++)l.instances[f]&&r?r.drawArraysInstancedANGLE(s,l.offsets[f],l.counts[f],l.instances[f]):n.drawArrays(s,l.offsets[f],l.counts[f])}else if(e.instanceCount&&r)if(c){if(e.indexCount>0){var _=e.firstIndex*c.stride;r.drawElementsInstancedANGLE(s,e.indexCount,o.glIndexType,_,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(s,e.firstVertex,e.vertexCount,e.instanceCount);else if(c){if(e.indexCount>0){var d=e.firstIndex*c.stride;n.drawElements(s,e.indexCount,o.glIndexType,d)}}else e.vertexCount>0&&n.drawArrays(s,e.firstVertex,e.vertexCount)}}var w7=new Array(l7.COUNT);function I7(t,e){w7.fill(0);for(var n=0;n<e.cmds.length;++n){var i=e.cmds.array[n],r=w7[i]++;switch(i){case l7.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];A7(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case l7.BIND_STATES:var o=e.bindStatesCmds.array[r];C7(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.dynamicStates);break;case l7.DRAW:b7(t,e.drawCmds.array[r].drawInfo);break;case l7.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];T7(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case l7.COPY_BUFFER_TO_TEXTURE:var c=e.copyBufferToTextureCmds.array[r];P7(t,c.buffers,c.gpuTexture,c.regions)}}}function P7(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=1,c=1,l=0,u=na[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];s=f.texExtent.width,c=f.texExtent.height;var _=e[o++];u?n.glInternalFmt===t7.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,n.glInternalFmt,s,c,0,_):r.compressedTexSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,_):r.texSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,n.glType,_)}break;case r.TEXTURE_CUBE_MAP:for(var d=0;d<i.length;d++){var p=i[d],m=p.texSubres.baseArrayLayer+p.texSubres.layerCount;for(l=p.texSubres.baseArrayLayer;l<m;++l){s=p.texExtent.width,c=p.texExtent.height;var g=e[o++];u?n.glInternalFmt===t7.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,n.glInternalFmt,s,c,0,g):r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,g):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,n.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ai.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var R7=function(){function t(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var e=t.prototype;return e.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},e.setDrawInfo=function(t,e){this._ensureCapacity(t),this.drawByIndex=e.indexCount>0,this.instancedDraw=!!e.instanceCount,this.drawCount=Math.max(t+1,this.drawCount),this.drawByIndex?(this.counts[t]=e.indexCount,this.offsets[t]=e.firstIndex):(this.counts[t]=e.vertexCount,this.offsets[t]=e.firstVertex),this.instances[t]=Math.max(1,e.instanceCount)},e._ensureCapacity=function(t){if(!(this._capacity>t)){this._capacity=a(t);var e=new Int32Array(this._capacity),n=new Int32Array(this._capacity),i=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),e.set(this.counts),n.set(this.offsets),i.set(this.instances),this.counts=e,this.offsets=n,this.instances=i}},t}(),D7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&vi.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:new R7,glTarget:0,glBuffer:null},this._usage&vi.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ti.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(e.usage&vi.VERTEX){e.glTarget=n.ARRAY_BUFFER;var a=n.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&vi.INDEX){e.glTarget=n.ELEMENT_ARRAY_BUFFER;var o=n.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&vi.UNIFORM?(e.glTarget=n.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&vi.INDIRECT||e.usage&vi.TRANSFER_DST||e.usage&vi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(n7.instance,this._gpuBuffer),n7.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(function(t,e){var n=t.gl,i=t.stateCache;if(e.glBuffer){switch(e.glTarget){case n.ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),x7.gpuInputAssembler=null,n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case n.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),x7.gpuInputAssembler=null,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null}n.deleteBuffer(e.glBuffer),e.glBuffer=null}}(n7.instance,this._gpuBuffer),n7.instance.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},n.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ti.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;e.usage&vi.VERTEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null):e.usage&vi.INDEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),x7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&vi.UNIFORM?e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer)):(e.usage&vi.INDIRECT||e.usage&vi.TRANSFER_DST||e.usage&vi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(n7.instance,this._gpuBuffer),n7.instance.memoryStatus.bufferSize-=e,n7.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,e){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==e?e:this._usage&vi.INDIRECT?0:t.byteLength,T7(n7.instance,this._gpuBuffer,t,0,n))},Q(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(_a),O7=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new jl(e);for(var n=0;n<e;++n)this._frees[n]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,n=this._frees;this._frees=new Array(e);for(var i=e-n.length,r=0;r<i;++r)this._frees[r]=new t;for(var a=i,o=0;a<e;++a,++o)this._frees[a]=n[o];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),N7=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new O7(p7,1),this.bindStatesCmdPool=new O7(m7,1),this.drawCmdPool=new O7(g7,1),this.updateBufferCmdPool=new O7(v7,1),this.copyBufferToTextureCmdPool=new O7(y7,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),M7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).cmdPackage=new S7,e._cmdAllocator=new N7,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new ta,e._isStateInvalied=!1,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type,this._queue=t.queue;for(var e=n7.instance.bindingMappings.blockOffsets.length,n=0;n<e;n++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},n.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(t,e,n,i,r,a){var o=this._cmdAllocator.beginRenderPassCmdPool.alloc(p7);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea.copy(n),o.clearColors.length=i.length;for(var s=0;s<i.length;++s)o.clearColors[s]=i[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(l7.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},n.bindDescriptorSet=function(t,e,n){var i=e.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=i,this._isStateInvalied=!0),n){var r,a=null===(r=this._curGPUPipelineState)||void 0===r?void 0:r.gpuPipelineLayout;if(a){for(var o=this._curDynamicOffsets,s=a.dynamicOffsetOffsets[t],c=0;c<n.length;c++)o[s+c]=n[c];this._isStateInvalied=!0}}},n.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},n.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},n.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},n.setDepthBias=function(t,e,n){var i=this._curDynamicStates;i.depthBiasConstant===t&&i.depthBiasClamp===e&&i.depthBiasSlope===n||(i.depthBiasConstant=t,i.depthBiasClamp=e,i.depthBiasSlope=n,this._isStateInvalied=!0)},n.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},n.setDepthBound=function(t,e){var n=this._curDynamicStates;n.depthMinBounds===t&&n.depthMaxBounds===e||(n.depthMinBounds=t,n.depthMaxBounds=e,this._isStateInvalied=!0)},n.setStencilWriteMask=function(t,e){var n=this._curDynamicStates.stencilStatesFront,i=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&n.writeMask!==e&&(n.writeMask=e,this._isStateInvalied=!0),t&Xi.BACK&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0)},n.setStencilCompareMask=function(t,e,n){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&(i.compareMask===n&&i.reference===e||(i.reference=e,i.compareMask=n,this._isStateInvalied=!0)),t&Xi.BACK&&(r.compareMask===n&&r.reference===e||(r.reference=e,r.compareMask=n,this._isStateInvalied=!0))},n.draw=function(t){if(this._type===Qi.PRIMARY&&this._isInRenderPass||this._type===Qi.SECONDARY){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t,n=this._cmdAllocator.drawCmdPool.alloc(g7);n.drawInfo.copy(e),this.cmdPackage.drawCmds.push(n),this.cmdPackage.cmds.push(l7.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var i=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=t.gpuBuffer;if(i){var r,a=this._cmdAllocator.updateBufferCmdPool.alloc(v7),o=0;t.usage&vi.INDIRECT||(o=void 0!==n?n:e.byteLength),r=e,a.gpuBuffer=i,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(l7.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=e.gpuTexture;if(i){var r=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(y7);r&&(r.gpuTexture=i,r.regions=n,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(l7.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(t,e){for(var n=0;n<e;++n){for(var i=t[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var a=i.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<i.cmdPackage.bindStatesCmds.length;++o){var s=i.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<i.cmdPackage.updateBufferCmds.length;++u){var h=i.cmdPackage.updateBufferCmds.array[u];++h.refCount,this.cmdPackage.updateBufferCmds.push(h)}for(var f=0;f<i.cmdPackage.copyBufferToTextureCmds.length;++f){var _=i.cmdPackage.copyBufferToTextureCmds.array[f];++_.refCount,this.cmdPackage.copyBufferToTextureCmds.push(_)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var t=this._cmdAllocator.bindStatesCmdPool.alloc(m7);t&&(t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(l7.BIND_STATES),this._isStateInvalied=!1)},e}(da),L7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuFramebuffer=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=0,n=[],i=0;i<t.colorTextures.length;++i){var r=t.colorTextures[i];r&&(n.push(r.gpuTexture),e=r.lodLevel)}var a=null;t.depthStencilTexture&&(a=t.depthStencilTexture.gpuTexture,e=t.depthStencilTexture.lodLevel);var o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:n,gpuDepthStencilTexture:a,glFramebuffer:null,isOffscreen:!0,get width(){return this.isOffscreen?o:this.gpuColorTextures[0].width},set width(t){o=t},get height(){return this.isOffscreen?s:this.gpuColorTextures[0].height},set height(t){s=t},lodLevel:e},function(t,e){for(var n=0;n<e.gpuColorTextures.length;++n)if(e.gpuColorTextures[n].isSwapchainTexture)return void(e.isOffscreen=!1);var i=t.gl,r=[],a=i.createFramebuffer();if(a){e.glFramebuffer=a,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorTextures.length;++o){var s=e.gpuColorTextures[o];s&&(s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,s.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o),e.width=Math.min(e.width,s.width),e.height=Math.min(e.height,s.height))}var c=e.gpuDepthStencilTexture;if(c){var l=na[c.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;c.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,c.glTarget,c.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,c.glRenderbuffer),e.width=Math.min(e.width,c.width),e.height=Math.min(e.height,c.height)}t.extensions.WEBGL_draw_buffers&&t.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(r);var u=i.checkFramebufferStatus(i.FRAMEBUFFER);if(u!==i.FRAMEBUFFER_COMPLETE)switch(u){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}(n7.instance,this._gpuFramebuffer)},n.destroy=function(){var t,e;this._gpuFramebuffer&&(t=n7.instance,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),t.stateCache.glFramebuffer===e.glFramebuffer&&(t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.stateCache.glFramebuffer=null),e.glFramebuffer=null),this._gpuFramebuffer=null)},Q(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(ga),F7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuInputAssembler=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var e=this._vertexBuffers[0];this._drawInfo.vertexCount=e.size/e.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),i=0;i<t.vertexBuffers.length;++i){var r=t.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Error index buffer stride.")}var s=null;t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:n,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var n=t.gl;e.glAttribs=new Array(e.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],c=i7(a.format,n),l=na[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:c,size:l,count:na[a.format].count,stride:s.stride,componentCount:c7(c,n),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:i[o]},i[o]+=l}}(n7.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},n.destroy=function(){var t=n7.instance;this._gpuInputAssembler&&t.extensions.useVAO&&function(t,e){for(var n=e.glVAOs.values(),i=n.next(),r=t.extensions.OES_vertex_array_object,a=t.stateCache.glVAO;!i.done;)r.deleteVertexArrayOES(i.value),a===i.value&&(r.bindVertexArrayOES(null),a=null),i=n.next();t.stateCache.glVAO=a,e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Q(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Ta),B7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSetLayout=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];i.push(e),e+=a.count,a.binding>n&&(n=a.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var o=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,o[c.binding]=i[s]}for(var l=[],u=0;u<this._bindings.length;u++){var h=this._bindings[u];if(h.descriptorType&aa)for(var f=0;f<h.count;f++)l.push(h.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:o,descriptorCount:e}},n.destroy=function(){this._bindings.length=0},Q(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(Ea),z7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineLayout=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],n=[],i=0,r=[],a=0;a<this._setLayouts.length;a++){for(var o=this._setLayouts[a],s=o.gpuDescriptorSetLayout.dynamicBindings,c=Array(o.bindingIndices.length).fill(-1),l=0;l<s.length;l++){var u=s[l];c[u]<0&&(c[u]=i+l)}n.push(o.gpuDescriptorSetLayout),e.push(c),r.push(i),i+=s.length}this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:e,dynamicOffsetCount:i,dynamicOffsetOffsets:r}},n.destroy=function(){this._setLayouts.length=0},Q(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(Aa),U7=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],k7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineState=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var n=t.blendState,i=n.targets;i&&i.forEach((function(t,n){e.setTarget(n,t)})),void 0!==n.isA2C&&(e.isA2C=n.isA2C),void 0!==n.isIndepend&&(e.isIndepend=n.isIndepend),void 0!==n.blendColor&&(e.blendColor=n.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);this._gpuPipelineState={glPrimitive:U7[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r}},n.destroy=function(){this._gpuPipelineState=null},Q(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(Ra),G7=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.beginRenderPass=function(t,e,n,i,r,a){A7(n7.instance,t.gpuRenderPass,e.gpuFramebuffer,n,i,r,a),this._isInRenderPass=!0},n.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t;b7(n7.instance,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.setViewport=function(t){var e=n7.instance,n=e.stateCache,i=e.gl;n.viewport.left===t.left&&n.viewport.top===t.top&&n.viewport.width===t.width&&n.viewport.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.viewport.left=t.left,n.viewport.top=t.top,n.viewport.width=t.width,n.viewport.height=t.height)},n.setScissor=function(t){var e=n7.instance,n=e.stateCache,i=e.gl;n.scissorRect.x===t.x&&n.scissorRect.y===t.y&&n.scissorRect.width===t.width&&n.scissorRect.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.scissorRect.x=t.x,n.scissorRect.y=t.y,n.scissorRect.width=t.width,n.scissorRect.height=t.height)},n.updateBuffer=function(t,e,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=t.gpuBuffer;r&&(i=void 0!==n?n:t.usage&vi.INDIRECT?0:e.byteLength,T7(n7.instance,r,e,0,i))}},n.copyBuffersToTexture=function(t,e,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=e.gpuTexture;i&&P7(n7.instance,t,i,n)}},n.execute=function(t,e){for(var n=0;n<e;++n){var i=t[n];I7(n7.instance,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){C7(n7.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(M7),V7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type},n.destroy=function(){},n.submit=function(t){for(var e=t.length,n=0;n<e;n++){var i=t[n];this.numDrawCalls+=i.numDrawCalls,this.numInstances+=i.numInstances,this.numTris+=i.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Da),H7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuRenderPass=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,this._subpasses=t.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},Q(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(Oa),W7=[10497,33648,33071,33071],j7=function(t){function e(e,n){var i;(i=t.call(this,e,n)||this)._gpuSampler=null;var r,a,o=i._info.minFilter,s=i._info.magFilter,c=i._info.mipFilter;r=o===Ii.LINEAR||o===Ii.ANISOTROPIC?c===Ii.LINEAR||c===Ii.ANISOTROPIC?9987:c===Ii.POINT?9985:9729:c===Ii.LINEAR||c===Ii.ANISOTROPIC?9986:c===Ii.POINT?9984:9728,a=s===Ii.LINEAR||s===Ii.ANISOTROPIC?9729:9728;var l=W7[i._info.addressU],u=W7[i._info.addressV],h=W7[i._info.addressW];return i._gpuSampler={glMinFilter:r,glMagFilter:a,glWrapS:l,glWrapT:u,glWrapR:h},i}return Z(e,t),Q(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Na),X7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuShader=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks.slice(),samplerTextures:t.samplerTextures.slice(),subpassInputs:t.subpassInputs.slice(),gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var n=t.stages[e];this._gpuShader.gpuStages[e]={type:n.stage,source:n.source,glShader:null}}!function(t,e){for(var n=t.gl,i=function(t){var i=e.gpuStages[t],r=0,a="",o=1;switch(i.type){case Li.VERTEX:a="VertexShader",r=n.VERTEX_SHADER;break;case Li.FRAGMENT:a="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<e.gpuStages.length;c++){var l=e.gpuStages[t];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=i(r);if("object"==typeof a)return a.v}var o=n.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var c=e.gpuStages[s];n.attachShader(e.glProgram,c.glShader)}if(n.linkProgram(e.glProgram),t.extensions.destroyShadersImmediately)for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(n.detachShader(e.glProgram,u.glShader),n.deleteShader(u.glShader),u.glShader=null)}if(!n.getProgramParameter(e.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(n.getProgramInfoLog(e.glProgram));E("Shader '"+e.name+"' compilation succeeded.");var h=n.getProgramParameter(e.glProgram,n.ACTIVE_ATTRIBUTES);e.glInputs=new Array(h);for(var f=0;f<h;++f){var _=n.getActiveAttrib(e.glProgram,f);if(_){var d,p=_.name.indexOf("[");d=-1!==p?_.name.substr(0,p):_.name;var m=n.getAttribLocation(e.glProgram,d),g=o7(_.type,n),v=s7(_.type,n);e.glInputs[f]={binding:m,name:d,type:g,stride:v,count:_.size,size:v*_.size,glType:_.type,glLoc:m}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var y=0;y<e.blocks.length;++y){var S=e.blocks[y],T={set:S.set,binding:S.binding,name:S.name,size:0,glUniforms:new Array(S.members.length),glActiveUniforms:[]};e.glBlocks[y]=T;for(var x=0;x<S.members.length;++x){var A=S.members[x],C=r7(A.type,n),b=s7(C,n),w=b*A.count;T.glUniforms[x]={binding:-1,name:A.name,type:A.type,stride:b,count:A.count,size:w,offset:0,glType:C,glLoc:null,array:null}}}}for(var I=0;I<e.subpassInputs.length;++I){var P=e.subpassInputs[I];e.samplerTextures.push(new Cr(P.set,P.binding,P.name,gi.SAMPLER2D,P.count))}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var R=0;R<e.samplerTextures.length;++R){var D=e.samplerTextures[R];e.glSamplerTextures[R]={set:D.set,binding:D.binding,name:D.name,type:D.type,count:D.count,units:[],glUnits:null,glType:r7(D.type,n),glLoc:null}}}for(var O=n.getProgramParameter(e.glProgram,n.ACTIVE_UNIFORMS),N=0;N<O;++N){var M=n.getActiveUniform(e.glProgram,N);if(M&&M.type!==n.SAMPLER_2D&&M.type!==n.SAMPLER_CUBE){var L=n.getUniformLocation(e.glProgram,M.name);if(t.extensions.isLocationActive(L)){var F,B=M.name.indexOf("[");F=-1!==B?M.name.substr(0,B):M.name;for(var z=0;z<e.glBlocks.length;z++)for(var U=e.glBlocks[z],k=0;k<U.glUniforms.length;k++){var G=U.glUniforms[k];if(G.name===F){G.glLoc=L,G.count=M.size,G.size=G.stride*G.count,G.array=new(a7(G.type))(G.size/4),U.glActiveUniforms.push(G);break}}}}}for(var V=0;V<e.glBlocks.length;V++)for(var H=e.glBlocks[V],W=0;W<H.glUniforms.length;W++){var j=H.glUniforms[W];j.offset=H.size/4,H.size+=j.size}for(var X=[],q=[],Y=t.bindingMappings,K=t.stateCache.texUnitCacheMap,Q=0,J=0;J<e.blocks.length;++J)e.blocks[J].set===Y.flexibleSet&&Q++;for(var Z=0,$=0;$<e.samplerTextures.length;++$){var tt=e.samplerTextures[$],et=n.getUniformLocation(e.glProgram,tt.name);if(t.extensions.isLocationActive(et)&&(X.push(e.glSamplerTextures[$]),q.push(et)),void 0===K[tt.name]){var nt=tt.binding+Y.samplerTextureOffsets[tt.set]+Z;tt.set===Y.flexibleSet&&(nt-=Q),K[tt.name]=nt%t.capabilities.maxTextureUnits,Z+=tt.count-1}}if(X.length){for(var it=[],rt=0;rt<X.length;++rt){var at=X[rt],ot=K[at.name];if(void 0!==ot){at.glLoc=q[rt];for(var st=0;st<at.count;++st){for(;it[ot];)ot=(ot+1)%t.capabilities.maxTextureUnits;at.units.push(ot),it[ot]=!0}}}for(var ct=0,lt=0;lt<X.length;++lt){var ut=X[lt];if(!t.extensions.isLocationActive(ut.glLoc)){ut.glLoc=q[lt];for(var ht=0;ht<ut.count;++ht){for(;it[ct];)ct=(ct+1)%t.capabilities.maxTextureUnits;void 0===K[ut.name]&&(K[ut.name]=ct),ut.units.push(ct),it[ct]=!0}}}t.stateCache.glProgram!==e.glProgram&&n.useProgram(e.glProgram);for(var ft=0;ft<X.length;ft++){var _t=X[ft];_t.glUnits=new Int32Array(_t.units),n.uniform1iv(_t.glLoc,_t.glUnits)}t.stateCache.glProgram!==e.glProgram&&n.useProgram(t.stateCache.glProgram)}for(var dt=0;dt<e.glBlocks.length;)e.glBlocks[dt].glActiveUniforms.length?dt++:(e.glBlocks[dt]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplerTextures=X}}(n7.instance,this._gpuShader)},n.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var n=t.gl;if(!t.extensions.destroyShadersImmediately)for(var i=0;i<e.gpuStages.length;i++){var r=e.gpuStages[i];r.glShader&&(n.detachShader(e.glProgram,r.glShader),n.deleteShader(r.glShader),r.glShader=null)}n.deleteProgram(e.glProgram),t.stateCache.glProgram===e.glProgram&&(t.gl.useProgram(null),t.stateCache.glProgram=null),e.glProgram=null}}(n7.instance,this._gpuShader),this._gpuShader=null)},Q(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(Ma),q7=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new ur,this.scissorRect=new ir(0,0,0,0),this.rs=new Ca,this.dss=new ba,this.bs=new Ia,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var n=0;n<t;++n)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),Y7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuTexture=null,e._lodLevel=0,e}Z(e,t);var n=e.prototype;return n.initialize=function(t,e){var n=t,i=t;"texture"in t&&(n=i.texture.info,this._isTextureView=!0),this._info.copy(n),this._isPowerOf2=oa(this._info.width)&&oa(this._info.height),this._size=ca(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,this._isTextureView?(this._viewInfo.copy(i),this._lodLevel=i.baseLevel,this._gpuTexture=i.texture._gpuTexture):(this._gpuTexture={type:n.type,format:n.format,usage:n.usage,width:n.width,height:n.height,depth:n.depth,size:this._size,arrayLayer:n.layerCount,mipLevel:n.levelCount,samples:n.samples,flags:n.flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:e||!1},function(t,e){var n=t.gl;e.glFormat=e.glInternalFmt=function(t,e){switch(t){case pi.A8:return e.ALPHA;case pi.L8:return e.LUMINANCE;case pi.LA8:return e.LUMINANCE_ALPHA;case pi.RGB8:case pi.RGB16F:case pi.RGB32F:return e.RGB;case pi.BGRA8:case pi.RGBA8:case pi.SRGB8_A8:case pi.RGBA16F:case pi.RGBA32F:return e.RGBA;case pi.R5G6B5:return e.RGB;case pi.RGB5A1:case pi.RGBA4:return e.RGBA;case pi.DEPTH:return e.DEPTH_COMPONENT;case pi.DEPTH_STENCIL:return e.DEPTH_STENCIL;case pi.BC1:return t7.COMPRESSED_RGB_S3TC_DXT1_EXT;case pi.BC1_ALPHA:return t7.COMPRESSED_RGBA_S3TC_DXT1_EXT;case pi.BC1_SRGB:return t7.COMPRESSED_SRGB_S3TC_DXT1_EXT;case pi.BC1_SRGB_ALPHA:return t7.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case pi.BC2:return t7.COMPRESSED_RGBA_S3TC_DXT3_EXT;case pi.BC2_SRGB:return t7.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case pi.BC3:return t7.COMPRESSED_RGBA_S3TC_DXT5_EXT;case pi.BC3_SRGB:return t7.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case pi.ETC_RGB8:return t7.COMPRESSED_RGB_ETC1_WEBGL;case pi.ETC2_RGB8:return t7.COMPRESSED_RGB8_ETC2;case pi.ETC2_SRGB8:return t7.COMPRESSED_SRGB8_ETC2;case pi.ETC2_RGB8_A1:return t7.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_SRGB8_A1:return t7.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_RGBA8:return t7.COMPRESSED_RGBA8_ETC2_EAC;case pi.ETC2_SRGB8_A8:return t7.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case pi.EAC_R11:return t7.COMPRESSED_R11_EAC;case pi.EAC_R11SN:return t7.COMPRESSED_SIGNED_R11_EAC;case pi.EAC_RG11:return t7.COMPRESSED_RG11_EAC;case pi.EAC_RG11SN:return t7.COMPRESSED_SIGNED_RG11_EAC;case pi.PVRTC_RGB2:return t7.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGBA2:return t7.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGB4:return t7.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case pi.PVRTC_RGBA4:return t7.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case pi.ASTC_RGBA_4X4:return t7.COMPRESSED_RGBA_ASTC_4x4_KHR;case pi.ASTC_RGBA_5X4:return t7.COMPRESSED_RGBA_ASTC_5x4_KHR;case pi.ASTC_RGBA_5X5:return t7.COMPRESSED_RGBA_ASTC_5x5_KHR;case pi.ASTC_RGBA_6X5:return t7.COMPRESSED_RGBA_ASTC_6x5_KHR;case pi.ASTC_RGBA_6X6:return t7.COMPRESSED_RGBA_ASTC_6x6_KHR;case pi.ASTC_RGBA_8X5:return t7.COMPRESSED_RGBA_ASTC_8x5_KHR;case pi.ASTC_RGBA_8X6:return t7.COMPRESSED_RGBA_ASTC_8x6_KHR;case pi.ASTC_RGBA_8X8:return t7.COMPRESSED_RGBA_ASTC_8x8_KHR;case pi.ASTC_RGBA_10X5:return t7.COMPRESSED_RGBA_ASTC_10x5_KHR;case pi.ASTC_RGBA_10X6:return t7.COMPRESSED_RGBA_ASTC_10x6_KHR;case pi.ASTC_RGBA_10X8:return t7.COMPRESSED_RGBA_ASTC_10x8_KHR;case pi.ASTC_RGBA_10X10:return t7.COMPRESSED_RGBA_ASTC_10x10_KHR;case pi.ASTC_RGBA_12X10:return t7.COMPRESSED_RGBA_ASTC_12x10_KHR;case pi.ASTC_RGBA_12X12:return t7.COMPRESSED_RGBA_ASTC_12x12_KHR;case pi.ASTC_SRGBA_4X4:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case pi.ASTC_SRGBA_5X4:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case pi.ASTC_SRGBA_5X5:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case pi.ASTC_SRGBA_6X5:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case pi.ASTC_SRGBA_6X6:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case pi.ASTC_SRGBA_8X5:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case pi.ASTC_SRGBA_8X6:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case pi.ASTC_SRGBA_8X8:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case pi.ASTC_SRGBA_10X5:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case pi.ASTC_SRGBA_10X6:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case pi.ASTC_SRGBA_10X8:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case pi.ASTC_SRGBA_10X10:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case pi.ASTC_SRGBA_12X10:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case pi.ASTC_SRGBA_12X12:return t7.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}(e.format,n),e.glType=i7(e.format,n);var i=e.width,r=e.height;switch(e.type){case xi.TEX2D:if(e.glTarget=n.TEXTURE_2D,e.isSwapchainTexture)break;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),t.textureExclusive[e.format]||t.extensions.WEBGL_depth_texture||!na[e.format].hasDepth){if(e.glTexture=n.createTexture(),e.size>0){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),na[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=sa(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var u=0;u<e.mipLevel;++u)n.texImage2D(n.TEXTURE_2D,u,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1);e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}}else e.glInternalFmt=function(t,e){switch(t){case pi.R5G6B5:return e.RGB565;case pi.RGB5A1:return e.RGB5_A1;case pi.RGBA4:return e.RGBA4;case pi.RGBA16F:return t7.RGBA16F_EXT;case pi.RGBA32F:return t7.RGBA32F_EXT;case pi.SRGB8_A8:return t7.SRGB8_ALPHA8_EXT;case pi.DEPTH:return e.DEPTH_COMPONENT16;case pi.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,n),e.glRenderbuffer=n.createRenderbuffer(),e.size>0&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r));break;case xi.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var h=Math.max(i,r);if(h>t.capabilities.maxCubeMapTextureSize&&O(9100,h,t.capabilities.maxTextureSize),e.glTexture=n.createTexture(),e.size>0){var f=t.stateCache.glTexUnits[t.stateCache.texUnit];if(f.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),f.glTexture=e.glTexture),na[e.format].isCompressed)for(var _=0;_<6;++_){i=e.width,r=e.height;for(var d=0;d<e.mipLevel;++d){var p=sa(e.format,i,r,1),m=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,d,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var g=0;g<6;++g){i=e.width,r=e.height;for(var v=0;v<e.mipLevel;++v)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=xi.TEX2D,e.glTarget=n.TEXTURE_2D}}(n7.instance,this._gpuTexture),n7.instance.memoryStatus.textureSize+=this._size,this._viewInfo.texture=this,this._viewInfo.type=t.type,this._viewInfo.format=t.format,this._viewInfo.baseLevel=0,this._viewInfo.levelCount=t.levelCount,this._viewInfo.baseLayer=0,this._viewInfo.layerCount=t.layerCount)},n.destroy=function(){!this._isTextureView&&this._gpuTexture&&(function(t,e){var n=t.gl;if(e.glTexture){var i=t.stateCache.glTexUnits,r=t.stateCache.texUnit;n.deleteTexture(e.glTexture);for(var a=0;a<i.length;a++)i[a].glTexture===e.glTexture&&(n.activeTexture(n.TEXTURE0+a),r=a,n.bindTexture(e.glTarget,null),i[a].glTexture=null);t.stateCache.texUnit=r,e.glTexture=null}if(e.glRenderbuffer){var o=t.stateCache.glRenderbuffer;n.deleteRenderbuffer(e.glRenderbuffer),o===e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,null),o=null),e.glRenderbuffer=null}}(n7.instance,this._gpuTexture),n7.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(t,n){if(this._info.width!==t||this._info.height!==n){this._info.levelCount===e.getLevelCount(this._info.width,this._info.height)?this._info.levelCount=e.getLevelCount(t,n):this._info.levelCount>1&&(this._info.levelCount=Math.min(this._info.levelCount,e.getLevelCount(t,n)));var i=this._size;this._info.width=t,this._info.height=n,this._size=ca(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,!this._isTextureView&&this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=n,this._gpuTexture.size=this._size,function(t,e){if(e.size){var n=t.gl,i=e.width,r=e.height;switch(e.type){case xi.TEX2D:e.glTarget=n.TEXTURE_2D;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r);else if(e.glTexture){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),na[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=sa(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var u=0;u<e.mipLevel;++u)n.texImage2D(n.TEXTURE_2D,u,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;case xi.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var h=Math.max(i,r);h>t.capabilities.maxCubeMapTextureSize&&O(9100,h,t.capabilities.maxTextureSize);var f=t.stateCache.glTexUnits[t.stateCache.texUnit];if(f.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),f.glTexture=e.glTexture),na[e.format].isCompressed)for(var _=0;_<6;++_){i=e.width,r=e.height;for(var d=0;d<e.mipLevel;++d){var p=sa(e.format,i,r,1),m=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,d,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var g=0;g<6;++g){i=e.width,r=e.height;for(var v=0;v<e.mipLevel;++v)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=xi.TEX2D,e.glTarget=n.TEXTURE_2D}}}(n7.instance,this._gpuTexture),n7.instance.memoryStatus.textureSize-=i,n7.instance.memoryStatus.textureSize+=this._size)}},n.initAsSwapchainTexture=function(t){var e=new Sr;e.format=t.format,e.usage=na[t.format].hasDepth?Ei.DEPTH_STENCIL_ATTACHMENT:Ei.COLOR_ATTACHMENT,e.width=t.width,e.height=t.height,this.initialize(e,!0)},Q(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"lodLevel",get:function(){return this._lodLevel}}]),e}(La),K7="webglcontextlost";function Q7(t,e){for(var n=["","WEBKIT_","MOZ_"],i=0;i<n.length;++i){var r=t.getExtension(n[i]+e);if(r)return r}return null}function J7(t){var e={EXT_texture_filter_anisotropic:Q7(t,"EXT_texture_filter_anisotropic"),EXT_blend_minmax:Q7(t,"EXT_blend_minmax"),EXT_frag_depth:Q7(t,"EXT_frag_depth"),EXT_shader_texture_lod:Q7(t,"EXT_shader_texture_lod"),EXT_sRGB:Q7(t,"EXT_sRGB"),OES_vertex_array_object:Q7(t,"OES_vertex_array_object"),EXT_color_buffer_half_float:Q7(t,"EXT_color_buffer_half_float"),WEBGL_color_buffer_float:Q7(t,"WEBGL_color_buffer_float"),WEBGL_compressed_texture_etc1:Q7(t,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:Q7(t,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:Q7(t,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_s3tc:Q7(t,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:Q7(t,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:Q7(t,"WEBGL_debug_shaders"),WEBGL_draw_buffers:Q7(t,"WEBGL_draw_buffers"),WEBGL_lose_context:Q7(t,"WEBGL_lose_context"),WEBGL_depth_texture:Q7(t,"WEBGL_depth_texture"),OES_texture_half_float:Q7(t,"OES_texture_half_float"),OES_texture_half_float_linear:Q7(t,"OES_texture_half_float_linear"),OES_texture_float:Q7(t,"OES_texture_float"),OES_texture_float_linear:Q7(t,"OES_texture_float_linear"),OES_standard_derivatives:Q7(t,"OES_standard_derivatives"),OES_element_index_uint:Q7(t,"OES_element_index_uint"),ANGLE_instanced_arrays:Q7(t,"ANGLE_instanced_arrays"),WEBGL_debug_renderer_info:Q7(t,"WEBGL_debug_renderer_info"),WEBGL_multi_draw:null,WEBGL_compressed_texture_astc:null,destroyShadersImmediately:!0,noCompressedTexSubImage2D:!1,isLocationActive:function(t){return!!t},useVAO:!1};return du.os===au.IOS&&14===du.osMainVersion&&du.isBrowser||(e.WEBGL_compressed_texture_astc=Q7(t,"WEBGL_compressed_texture_astc")),du.os!==au.ANDROID&&du.os!==au.IOS&&(e.WEBGL_multi_draw=Q7(t,"WEBGL_multi_draw")),du.browserType===nu.UC&&(e.ANGLE_instanced_arrays=null),du.os===au.IOS&&du.osMainVersion<=10&&(e.destroyShadersImmediately=!1),e.OES_vertex_array_object&&(e.useVAO=!0),e}var Z7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stateCache=new q7,e.cmdAllocator=new N7,e.nullTex2D=null,e.nullTexCube=null,e._canvas=null,e._webGLContextLostHandler=null,e._extensions=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._canvas=t.windowHandle,this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(K7,this._onWebGLContextLost);var e=n7.instance.gl;this.stateCache.initialize(n7.instance.capabilities.maxTextureUnits,n7.instance.capabilities.maxVertexAttributes),this._extensions=J7(e),function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}(e);var n=pi.RGBA8,i=pi.DEPTH_STENCIL,r=e.getParameter(e.DEPTH_BITS),a=e.getParameter(e.STENCIL_BITS);r&&a?i=pi.DEPTH_STENCIL:r&&(i=pi.DEPTH),this._colorTexture=new Y7,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:n,width:t.width,height:t.height}),this._depthStencilTexture=new Y7,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:i,width:t.width,height:t.height}),this.nullTex2D=n7.instance.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED,pi.RGBA8,2,2,Ai.GEN_MIPMAP)),this.nullTexCube=n7.instance.createTexture(new Sr(xi.CUBE,Ei.SAMPLED,pi.RGBA8,2,2,Ai.GEN_MIPMAP,6));var o=new lr;o.texExtent.width=2,o.texExtent.height=2;var s=new Uint8Array(this.nullTex2D.size);s.fill(0),n7.instance.copyBuffersToTexture([s],this.nullTex2D,[o]),o.texSubres.layerCount=6,n7.instance.copyBuffersToTexture([s,s,s,s,s,s],this.nullTexCube,[o])},n.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(K7,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._extensions=null,this._canvas=null},n.resize=function(t,e){this._colorTexture.width===t&&this._colorTexture.height===e||(E("Resizing swapchain: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._colorTexture.resize(t,e),this._depthStencilTexture.resize(t,e))},n._onWebGLContextLost=function(t){R(11e3),S(t)},Q(e,[{key:"extensions",get:function(){return this._extensions}}]),e}(ma),$7=t("WebGLDevice",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._swapchain=null,e._context=null,e._bindingMappings=null,e._textureExclusive=new Array(pi.COUNT),e}Z(e,t);var n=e.prototype;return n.initialize=function(t){n7.setInstance(this),this._gfxAPI=fi.WEBGL;var e=this._bindingMappingInfo=t.bindingMappingInfo,n=[],i=[],r=e.setIndices[0];n[r]=0,i[r]=0;for(var a=1;a<e.setIndices.length;++a){var o=e.setIndices[a],s=e.setIndices[a-1];n[o]=e.maxBlockCounts[s]+n[s],i[o]=e.maxSamplerTextureCounts[s]+i[s]}for(var c=0;c<e.setIndices.length;++c){var l=e.setIndices[c];i[l]-=e.maxBlockCounts[l]}this._bindingMappings={blockOffsets:n,samplerTextureOffsets:i,flexibleSet:e.setIndices[e.setIndices.length-1]};var u=this._context=function(t){var e=null;try{var n={alpha:he.ENABLE_TRANSPARENT_CANVAS,antialias:he.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};e=t.getContext("webgl",n)}catch(t){return null}return e}(pa.canvas);if(!u)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new Kr(Yi.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Yr(this._queue)),this._caps.maxVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxUniformBufferBindings=16;var h=u.getSupportedExtensions(),f="";if(h)for(var _,d=ot(h);!(_=d()).done;)f+=_.value+" ";var p=J7(u);p.WEBGL_debug_renderer_info?(this._renderer=u.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=u.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=u.getParameter(u.RENDERER),this._vendor=u.getParameter(u.VENDOR));var m=u.getParameter(u.VERSION);this._features.fill(!1),this.initFormatFeatures(p),p.EXT_blend_minmax&&(this._features[di.BLEND_MINMAX]=!0),p.OES_element_index_uint&&(this._features[di.ELEMENT_INDEX_UINT]=!0),p.ANGLE_instanced_arrays&&(this._features[di.INSTANCED_ARRAYS]=!0),p.WEBGL_draw_buffers&&(this._features[di.MULTIPLE_RENDER_TARGETS]=!0);var g="";return this.getFormatFeatures(pi.ETC_RGB8)&&(g+="etc1 "),this.getFormatFeatures(pi.ETC2_RGB8)&&(g+="etc2 "),this.getFormatFeatures(pi.BC1)&&(g+="dxt "),this.getFormatFeatures(pi.PVRTC_RGB2)&&(g+="pvrtc "),this.getFormatFeatures(pi.ASTC_RGBA_4X4)&&(g+="astc "),E("WebGL device initialized."),E("RENDERER: "+this._renderer),E("VENDOR: "+this._vendor),E("VERSION: "+m),E("COMPRESSED_FORMAT: "+g),E("EXTENSIONS: "+f),!0},n.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null)},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},n.initFormatFeatures=function(t){this._formatFeatures.fill(Ci.NONE),this._textureExclusive.fill(!0);var e=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER;this._formatFeatures[pi.RGB8]=e,this._formatFeatures[pi.R5G6B5]=e,this._textureExclusive[pi.R5G6B5]=!1,this._formatFeatures[pi.RGBA8]=e,this._formatFeatures[pi.RGBA4]=e,this._textureExclusive[pi.RGBA4]=!1,this._formatFeatures[pi.RGB5A1]=e,this._textureExclusive[pi.RGB5A1]=!1,this._formatFeatures[pi.DEPTH]=Ci.RENDER_TARGET,this._textureExclusive[pi.DEPTH]=!1,this._formatFeatures[pi.DEPTH_STENCIL]=Ci.RENDER_TARGET,this._textureExclusive[pi.DEPTH_STENCIL]=!1,this._formatFeatures[pi.R8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RG8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGB8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGBA8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RG8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGB8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGBA8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RG8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGB8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGBA8I]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RG8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGB8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGBA8UI]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R32F]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RG32F]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGB32F]|=Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.RGBA32F]|=Ci.VERTEX_ATTRIBUTE,t.EXT_sRGB&&(this._formatFeatures[pi.SRGB8]=e,this._formatFeatures[pi.SRGB8_A8]=e,this._textureExclusive[pi.SRGB8_A8]=!1),t.WEBGL_depth_texture&&(this._formatFeatures[pi.DEPTH]|=e,this._formatFeatures[pi.DEPTH_STENCIL]|=e),t.WEBGL_color_buffer_float&&(this._formatFeatures[pi.RGB32F]|=Ci.RENDER_TARGET,this._formatFeatures[pi.RGBA32F]|=Ci.RENDER_TARGET,this._textureExclusive[pi.RGB32F]=!1,this._textureExclusive[pi.RGBA32F]=!1),t.EXT_color_buffer_half_float&&(this._formatFeatures[pi.RGB16F]|=Ci.RENDER_TARGET,this._formatFeatures[pi.RGBA16F]|=Ci.RENDER_TARGET,this._textureExclusive[pi.RGB16F]=!1,this._textureExclusive[pi.RGBA16F]=!1),t.OES_texture_float&&(this._formatFeatures[pi.RGB32F]|=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE,this._formatFeatures[pi.RGBA32F]|=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE),t.OES_texture_half_float&&(this._formatFeatures[pi.RGB16F]|=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE,this._formatFeatures[pi.RGBA16F]|=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE),t.OES_texture_float_linear&&(this._formatFeatures[pi.RGB32F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RGBA32F]|=Ci.LINEAR_FILTER),t.OES_texture_half_float_linear&&(this._formatFeatures[pi.RGB16F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RGBA16F]|=Ci.LINEAR_FILTER);var n=Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER;t.WEBGL_compressed_texture_etc1&&(this._formatFeatures[pi.ETC_RGB8]=n),t.WEBGL_compressed_texture_etc&&(this._formatFeatures[pi.ETC2_RGB8]=n,this._formatFeatures[pi.ETC2_RGBA8]=n,this._formatFeatures[pi.ETC2_SRGB8]=n,this._formatFeatures[pi.ETC2_SRGB8_A8]=n,this._formatFeatures[pi.ETC2_RGB8_A1]=n,this._formatFeatures[pi.ETC2_SRGB8_A1]=n),t.WEBGL_compressed_texture_s3tc&&(this._formatFeatures[pi.BC1]=n,this._formatFeatures[pi.BC1_ALPHA]=n,this._formatFeatures[pi.BC1_SRGB]=n,this._formatFeatures[pi.BC1_SRGB_ALPHA]=n,this._formatFeatures[pi.BC2]=n,this._formatFeatures[pi.BC2_SRGB]=n,this._formatFeatures[pi.BC3]=n,this._formatFeatures[pi.BC3_SRGB]=n),t.WEBGL_compressed_texture_pvrtc&&(this._formatFeatures[pi.PVRTC_RGB2]|=n,this._formatFeatures[pi.PVRTC_RGBA2]|=n,this._formatFeatures[pi.PVRTC_RGB4]|=n,this._formatFeatures[pi.PVRTC_RGBA4]|=n),t.WEBGL_compressed_texture_astc&&(this._formatFeatures[pi.ASTC_RGBA_4X4]|=n,this._formatFeatures[pi.ASTC_RGBA_5X4]|=n,this._formatFeatures[pi.ASTC_RGBA_5X5]|=n,this._formatFeatures[pi.ASTC_RGBA_6X5]|=n,this._formatFeatures[pi.ASTC_RGBA_6X6]|=n,this._formatFeatures[pi.ASTC_RGBA_8X5]|=n,this._formatFeatures[pi.ASTC_RGBA_8X6]|=n,this._formatFeatures[pi.ASTC_RGBA_8X8]|=n,this._formatFeatures[pi.ASTC_RGBA_10X5]|=n,this._formatFeatures[pi.ASTC_RGBA_10X6]|=n,this._formatFeatures[pi.ASTC_RGBA_10X8]|=n,this._formatFeatures[pi.ASTC_RGBA_10X10]|=n,this._formatFeatures[pi.ASTC_RGBA_12X10]|=n,this._formatFeatures[pi.ASTC_RGBA_12X12]|=n,this._formatFeatures[pi.ASTC_SRGBA_4X4]|=n,this._formatFeatures[pi.ASTC_SRGBA_5X4]|=n,this._formatFeatures[pi.ASTC_SRGBA_5X5]|=n,this._formatFeatures[pi.ASTC_SRGBA_6X5]|=n,this._formatFeatures[pi.ASTC_SRGBA_6X6]|=n,this._formatFeatures[pi.ASTC_SRGBA_8X5]|=n,this._formatFeatures[pi.ASTC_SRGBA_8X6]|=n,this._formatFeatures[pi.ASTC_SRGBA_8X8]|=n,this._formatFeatures[pi.ASTC_SRGBA_10X5]|=n,this._formatFeatures[pi.ASTC_SRGBA_10X6]|=n,this._formatFeatures[pi.ASTC_SRGBA_10X8]|=n,this._formatFeatures[pi.ASTC_SRGBA_10X10]|=n,this._formatFeatures[pi.ASTC_SRGBA_12X10]|=n,this._formatFeatures[pi.ASTC_SRGBA_12X12]|=n)},n.createCommandBuffer=function(t){var e=new(t.type===Qi.PRIMARY?G7:M7);return e.initialize(t),e},n.createSwapchain=function(t){var e=new Z7;return this._swapchain=e,e.initialize(t),e},n.createBuffer=function(t){var e=new D7;return e.initialize(t),e},n.createTexture=function(t){var e=new Y7;return e.initialize(t),e},n.createDescriptorSet=function(t){var e=new e7;return e.initialize(t),e},n.createShader=function(t){var e=new X7;return e.initialize(t),e},n.createInputAssembler=function(t){var e=new F7;return e.initialize(t),e},n.createRenderPass=function(t){var e=new H7;return e.initialize(t),e},n.createFramebuffer=function(t){var e=new L7;return e.initialize(t),e},n.createDescriptorSetLayout=function(t){var e=new B7;return e.initialize(t),e},n.createPipelineLayout=function(t){var e=new z7;return e.initialize(t),e},n.createPipelineState=function(t){var e=new k7;return e.initialize(t),e},n.createQueue=function(t){var e=new V7;return e.initialize(t),e},n.getSampler=function(t){var e=Na.computeHash(t);return this._samplers.has(e)||this._samplers.set(e,new j7(t,e)),this._samplers.get(e)},n.getGeneralBarrier=function(t){var e=Fa.computeHash(t);return this._generalBarrierss.has(e)||this._generalBarrierss.set(e,new Fa(t,e)),this._generalBarrierss.get(e)},n.getTextureBarrier=function(t){var e=Ba.computeHash(t);return this._textureBarriers.has(e)||this._textureBarriers.set(e,new Ba(t,e)),this._textureBarriers.get(e)},n.copyBuffersToTexture=function(t,e,n){P7(this,t,e.gpuTexture,n)},n.copyTextureToBuffers=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=0,c=0,l=1,u=1;switch(e.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,f.texSubres.mipLevel),s=f.texOffset.x,c=f.texOffset.y,l=f.texExtent.width,u=f.texExtent.height,r.readPixels(s,c,l,u,e.glFormat,e.glType,n[h])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}r.bindFramebuffer(r.FRAMEBUFFER,null),a.glFramebuffer=null,r.deleteFramebuffer(o)}(this,t.gpuTexture,e,n)},n.copyTexImagesToTexture=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var u=0;u<i.length;u++){var h=i[u],f=h.texSubres.baseArrayLayer+h.texSubres.layerCount;for(s=h.texSubres.baseArrayLayer;s<f;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,n.glFormat,n.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ai.GEN_MIPMAP&&n.isPowerOf2&&r.generateMipmap(n.glTarget)}(this,t,e.gpuTexture,n)},Q(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}}]),e}(pa));l.WebGLDevice=$7;var t9,e9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSet=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,n=e.bindings,i=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:i};for(var o=0;o<n.length;++o)for(var s=n[o],c=0;c<s.count;c++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTextureView:null,gpuSampler:null})},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)t[e].type&ia?this._buffers[e]&&(t[e].gpuBuffer=this._buffers[e].gpuBuffer):t[e].type&ra&&(this._textures[e]&&(t[e].gpuTextureView=this._textures[e].gpuTextureView),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Q(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(xa);!function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(t9||(t9={}));var n9=function(){function t(){}return t.setInstance=function(e){t._instance=e},Q(t,null,[{key:"instance",get:function(){return t._instance}}]),t}();n9._instance=null;var i9=[10497,33648,33071,33071],r9=new Float32Array(4);function a9(t,e){switch(t){case pi.R8:return e.UNSIGNED_BYTE;case pi.R8SN:return e.BYTE;case pi.R8UI:return e.UNSIGNED_BYTE;case pi.R8I:return e.BYTE;case pi.R16F:return e.HALF_FLOAT;case pi.R16UI:return e.UNSIGNED_SHORT;case pi.R16I:return e.SHORT;case pi.R32F:return e.FLOAT;case pi.R32UI:return e.UNSIGNED_INT;case pi.R32I:return e.INT;case pi.RG8:return e.UNSIGNED_BYTE;case pi.RG8SN:return e.BYTE;case pi.RG8UI:return e.UNSIGNED_BYTE;case pi.RG8I:return e.BYTE;case pi.RG16F:return e.HALF_FLOAT;case pi.RG16UI:return e.UNSIGNED_SHORT;case pi.RG16I:return e.SHORT;case pi.RG32F:return e.FLOAT;case pi.RG32UI:return e.UNSIGNED_INT;case pi.RG32I:return e.INT;case pi.RGB8:case pi.SRGB8:return e.UNSIGNED_BYTE;case pi.RGB8SN:return e.BYTE;case pi.RGB8UI:return e.UNSIGNED_BYTE;case pi.RGB8I:return e.BYTE;case pi.RGB16F:return e.HALF_FLOAT;case pi.RGB16UI:return e.UNSIGNED_SHORT;case pi.RGB16I:return e.SHORT;case pi.RGB32F:return e.FLOAT;case pi.RGB32UI:return e.UNSIGNED_INT;case pi.RGB32I:return e.INT;case pi.BGRA8:case pi.RGBA8:case pi.SRGB8_A8:return e.UNSIGNED_BYTE;case pi.RGBA8SN:return e.BYTE;case pi.RGBA8UI:return e.UNSIGNED_BYTE;case pi.RGBA8I:return e.BYTE;case pi.RGBA16F:return e.HALF_FLOAT;case pi.RGBA16UI:return e.UNSIGNED_SHORT;case pi.RGBA16I:return e.SHORT;case pi.RGBA32F:return e.FLOAT;case pi.RGBA32UI:return e.UNSIGNED_INT;case pi.RGBA32I:return e.INT;case pi.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case pi.R11G11B10F:return e.UNSIGNED_INT_10F_11F_11F_REV;case pi.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case pi.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case pi.RGB10A2:case pi.RGB10A2UI:return e.UNSIGNED_INT_2_10_10_10_REV;case pi.RGB9E5:case pi.DEPTH:return e.FLOAT;case pi.DEPTH_STENCIL:return e.UNSIGNED_INT_24_8;case pi.BC1:case pi.BC1_SRGB:case pi.BC2:case pi.BC2_SRGB:case pi.BC3:case pi.BC3_SRGB:case pi.BC4:return e.UNSIGNED_BYTE;case pi.BC4_SNORM:return e.BYTE;case pi.BC5:return e.UNSIGNED_BYTE;case pi.BC5_SNORM:return e.BYTE;case pi.BC6H_SF16:case pi.BC6H_UF16:return e.FLOAT;case pi.BC7:case pi.BC7_SRGB:case pi.ETC_RGB8:case pi.ETC2_RGB8:case pi.ETC2_SRGB8:case pi.ETC2_RGB8_A1:case pi.ETC2_SRGB8_A1:case pi.EAC_R11:return e.UNSIGNED_BYTE;case pi.EAC_R11SN:return e.BYTE;case pi.EAC_RG11:return e.UNSIGNED_BYTE;case pi.EAC_RG11SN:return e.BYTE;case pi.PVRTC_RGB2:case pi.PVRTC_RGBA2:case pi.PVRTC_RGB4:case pi.PVRTC_RGBA4:case pi.PVRTC2_2BPP:case pi.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case pi.ASTC_RGBA_4X4:case pi.ASTC_RGBA_5X4:case pi.ASTC_RGBA_5X5:case pi.ASTC_RGBA_6X5:case pi.ASTC_RGBA_6X6:case pi.ASTC_RGBA_8X5:case pi.ASTC_RGBA_8X6:case pi.ASTC_RGBA_8X8:case pi.ASTC_RGBA_10X5:case pi.ASTC_RGBA_10X6:case pi.ASTC_RGBA_10X8:case pi.ASTC_RGBA_10X10:case pi.ASTC_RGBA_12X10:case pi.ASTC_RGBA_12X12:case pi.ASTC_SRGBA_4X4:case pi.ASTC_SRGBA_5X4:case pi.ASTC_SRGBA_5X5:case pi.ASTC_SRGBA_6X5:case pi.ASTC_SRGBA_6X6:case pi.ASTC_SRGBA_8X5:case pi.ASTC_SRGBA_8X6:case pi.ASTC_SRGBA_8X8:case pi.ASTC_SRGBA_10X5:case pi.ASTC_SRGBA_10X6:case pi.ASTC_SRGBA_10X8:case pi.ASTC_SRGBA_10X10:case pi.ASTC_SRGBA_12X10:case pi.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function o9(t,e){switch(t){case gi.BOOL:return e.BOOL;case gi.BOOL2:return e.BOOL_VEC2;case gi.BOOL3:return e.BOOL_VEC3;case gi.BOOL4:return e.BOOL_VEC4;case gi.INT:return e.INT;case gi.INT2:return e.INT_VEC2;case gi.INT3:return e.INT_VEC3;case gi.INT4:return e.INT_VEC4;case gi.UINT:return e.UNSIGNED_INT;case gi.FLOAT:return e.FLOAT;case gi.FLOAT2:return e.FLOAT_VEC2;case gi.FLOAT3:return e.FLOAT_VEC3;case gi.FLOAT4:return e.FLOAT_VEC4;case gi.MAT2:return e.FLOAT_MAT2;case gi.MAT2X3:return e.FLOAT_MAT2x3;case gi.MAT2X4:return e.FLOAT_MAT2x4;case gi.MAT3X2:return e.FLOAT_MAT3x2;case gi.MAT3:return e.FLOAT_MAT3;case gi.MAT3X4:return e.FLOAT_MAT3x4;case gi.MAT4X2:return e.FLOAT_MAT4x2;case gi.MAT4X3:return e.FLOAT_MAT4x3;case gi.MAT4:return e.FLOAT_MAT4;case gi.SAMPLER2D:return e.SAMPLER_2D;case gi.SAMPLER2D_ARRAY:return e.SAMPLER_2D_ARRAY;case gi.SAMPLER3D:return e.SAMPLER_3D;case gi.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),gi.UNKNOWN}}function s9(t,e){switch(t){case e.BOOL:return gi.BOOL;case e.BOOL_VEC2:return gi.BOOL2;case e.BOOL_VEC3:return gi.BOOL3;case e.BOOL_VEC4:return gi.BOOL4;case e.INT:return gi.INT;case e.INT_VEC2:return gi.INT2;case e.INT_VEC3:return gi.INT3;case e.INT_VEC4:return gi.INT4;case e.UNSIGNED_INT:return gi.UINT;case e.UNSIGNED_INT_VEC2:return gi.UINT2;case e.UNSIGNED_INT_VEC3:return gi.UINT3;case e.UNSIGNED_INT_VEC4:return gi.UINT4;case e.FLOAT:return gi.FLOAT;case e.FLOAT_VEC2:return gi.FLOAT2;case e.FLOAT_VEC3:return gi.FLOAT3;case e.FLOAT_VEC4:return gi.FLOAT4;case e.FLOAT_MAT2:return gi.MAT2;case e.FLOAT_MAT2x3:return gi.MAT2X3;case e.FLOAT_MAT2x4:return gi.MAT2X4;case e.FLOAT_MAT3x2:return gi.MAT3X2;case e.FLOAT_MAT3:return gi.MAT3;case e.FLOAT_MAT3x4:return gi.MAT3X4;case e.FLOAT_MAT4x2:return gi.MAT4X2;case e.FLOAT_MAT4x3:return gi.MAT4X3;case e.FLOAT_MAT4:return gi.MAT4;case e.SAMPLER_2D:return gi.SAMPLER2D;case e.SAMPLER_2D_ARRAY:return gi.SAMPLER2D_ARRAY;case e.SAMPLER_3D:return gi.SAMPLER3D;case e.SAMPLER_CUBE:return gi.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),gi.UNKNOWN}}function c9(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:return 4;case e.UNSIGNED_INT_VEC2:return 8;case e.UNSIGNED_INT_VEC3:return 12;case e.UNSIGNED_INT_VEC4:return 16;case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT2x3:return 24;case e.FLOAT_MAT2x4:return 32;case e.FLOAT_MAT3x2:return 24;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT3x4:return 48;case e.FLOAT_MAT4x2:return 32;case e.FLOAT_MAT4x3:return 48;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_3D:case e.SAMPLER_CUBE:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_2D_ARRAY:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function l9(t,e){switch(t){case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:return 2;case e.FLOAT_MAT3x2:case e.FLOAT_MAT3:case e.FLOAT_MAT3x4:return 3;case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.FLOAT_MAT4:return 4;default:return 1}}var u9,h9=[512,513,514,515,516,517,518,519],f9=[0,7680,7681,7682,7683,5386,34055,34056],_9=[32774,32778,32779,32775,32776],d9=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(u9||(u9={}));var p9=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},m9=function(t){function e(){var e;return(e=t.call(this,u9.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new ir,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return Z(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(p9),g9=function(t){function e(){var e;return(e=t.call(this,u9.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new ta,e}return Z(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuInputAssembler=null,this.gpuDescriptorSets.length=0,this.dynamicOffsets.length=0},e}(p9),v9=function(t){function e(){var e;return(e=t.call(this,u9.DRAW)||this).drawInfo=new gr,e}return Z(e,t),e.prototype.clear=function(){},e}(p9),y9=function(t){function e(){var e;return(e=t.call(this,u9.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return Z(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(p9),S9=function(t){function e(){var e;return(e=t.call(this,u9.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return Z(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(p9),T9=function(){function t(){this.cmds=new jl(1),this.beginRenderPassCmds=new jl(1),this.bindStatesCmds=new jl(1),this.drawCmds=new jl(1),this.updateBufferCmds=new jl(1),this.copyBufferToTextureCmds=new jl(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function x9(t,e,n,i,r){if(e.usage&vi.INDIRECT){e.indirects.clearDraws();for(var a=n.drawInfos,o=0;o<a.length;++o)e.indirects.setDrawInfo(i+o,a[o])}else{var s=n,c=t.gl,l=t.stateCache;switch(e.glTarget){case c.ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(c.bindVertexArray(null),l.glVAO=null),C9.gpuInputAssembler=null,l.glArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ARRAY_BUFFER,e.glBuffer),l.glArrayBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r));break;case c.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(c.bindVertexArray(null),l.glVAO=null),C9.gpuInputAssembler=null,l.glElementArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glBuffer),l.glElementArrayBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r));break;case c.UNIFORM_BUFFER:l.glUniformBuffer!==e.glBuffer&&(c.bindBuffer(c.UNIFORM_BUFFER,e.glBuffer),l.glUniformBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,new Float32Array(s,0,r/4));break;default:console.error("Unsupported BufferType, update buffer failed.")}}}function E9(t,e){var n=t.gl;e.glInternalFmt=function(t,e){switch(t){case pi.A8:return e.ALPHA;case pi.L8:return e.LUMINANCE;case pi.LA8:return e.LUMINANCE_ALPHA;case pi.R8:return e.R8;case pi.R8SN:return e.R8_SNORM;case pi.R8UI:return e.R8UI;case pi.R8I:return e.R8I;case pi.RG8:return e.RG8;case pi.RG8SN:return e.RG8_SNORM;case pi.RG8UI:return e.RG8UI;case pi.RG8I:return e.RG8I;case pi.RGB8:return e.RGB8;case pi.RGB8SN:return e.RGB8_SNORM;case pi.RGB8UI:return e.RGB8UI;case pi.RGB8I:return e.RGB8I;case pi.BGRA8:case pi.RGBA8:return e.RGBA8;case pi.RGBA8SN:return e.RGBA8_SNORM;case pi.RGBA8UI:return e.RGBA8UI;case pi.RGBA8I:return e.RGBA8I;case pi.R16I:return e.R16I;case pi.R16UI:return e.R16UI;case pi.R16F:return e.R16F;case pi.RG16I:return e.RG16I;case pi.RG16UI:return e.RG16UI;case pi.RG16F:return e.RG16F;case pi.RGB16I:return e.RGB16I;case pi.RGB16UI:return e.RGB16UI;case pi.RGB16F:return e.RGB16F;case pi.RGBA16I:return e.RGBA16I;case pi.RGBA16UI:return e.RGBA16UI;case pi.RGBA16F:return e.RGBA16F;case pi.R32I:return e.R32I;case pi.R32UI:return e.R32UI;case pi.R32F:return e.R32F;case pi.RG32I:return e.RG32I;case pi.RG32UI:return e.RG32UI;case pi.RG32F:return e.RG32F;case pi.RGB32I:return e.RGB32I;case pi.RGB32UI:return e.RGB32UI;case pi.RGB32F:return e.RGB32F;case pi.RGBA32I:return e.RGBA32I;case pi.RGBA32UI:return e.RGBA32UI;case pi.RGBA32F:return e.RGBA32F;case pi.R5G6B5:return e.RGB565;case pi.RGB5A1:return e.RGB5_A1;case pi.RGBA4:return e.RGBA4;case pi.SRGB8:return e.SRGB8;case pi.SRGB8_A8:return e.SRGB8_ALPHA8;case pi.RGB10A2:return e.RGB10_A2;case pi.RGB10A2UI:return e.RGB10_A2UI;case pi.R11G11B10F:return e.R11F_G11F_B10F;case pi.DEPTH:return e.DEPTH_COMPONENT32F;case pi.DEPTH_STENCIL:return e.DEPTH24_STENCIL8;case pi.BC1:return t9.COMPRESSED_RGB_S3TC_DXT1_EXT;case pi.BC1_ALPHA:return t9.COMPRESSED_RGBA_S3TC_DXT1_EXT;case pi.BC1_SRGB:return t9.COMPRESSED_SRGB_S3TC_DXT1_EXT;case pi.BC1_SRGB_ALPHA:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case pi.BC2:return t9.COMPRESSED_RGBA_S3TC_DXT3_EXT;case pi.BC2_SRGB:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case pi.BC3:return t9.COMPRESSED_RGBA_S3TC_DXT5_EXT;case pi.BC3_SRGB:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case pi.ETC_RGB8:return t9.COMPRESSED_RGB_ETC1_WEBGL;case pi.ETC2_RGB8:return t9.COMPRESSED_RGB8_ETC2;case pi.ETC2_SRGB8:return t9.COMPRESSED_SRGB8_ETC2;case pi.ETC2_RGB8_A1:return t9.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_SRGB8_A1:return t9.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_RGBA8:return t9.COMPRESSED_RGBA8_ETC2_EAC;case pi.ETC2_SRGB8_A8:return t9.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case pi.EAC_R11:return t9.COMPRESSED_R11_EAC;case pi.EAC_R11SN:return t9.COMPRESSED_SIGNED_R11_EAC;case pi.EAC_RG11:return t9.COMPRESSED_RG11_EAC;case pi.EAC_RG11SN:return t9.COMPRESSED_SIGNED_RG11_EAC;case pi.PVRTC_RGB2:return t9.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGBA2:return t9.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGB4:return t9.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case pi.PVRTC_RGBA4:return t9.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case pi.ASTC_RGBA_4X4:return t9.COMPRESSED_RGBA_ASTC_4x4_KHR;case pi.ASTC_RGBA_5X4:return t9.COMPRESSED_RGBA_ASTC_5x4_KHR;case pi.ASTC_RGBA_5X5:return t9.COMPRESSED_RGBA_ASTC_5x5_KHR;case pi.ASTC_RGBA_6X5:return t9.COMPRESSED_RGBA_ASTC_6x5_KHR;case pi.ASTC_RGBA_6X6:return t9.COMPRESSED_RGBA_ASTC_6x6_KHR;case pi.ASTC_RGBA_8X5:return t9.COMPRESSED_RGBA_ASTC_8x5_KHR;case pi.ASTC_RGBA_8X6:return t9.COMPRESSED_RGBA_ASTC_8x6_KHR;case pi.ASTC_RGBA_8X8:return t9.COMPRESSED_RGBA_ASTC_8x8_KHR;case pi.ASTC_RGBA_10X5:return t9.COMPRESSED_RGBA_ASTC_10x5_KHR;case pi.ASTC_RGBA_10X6:return t9.COMPRESSED_RGBA_ASTC_10x6_KHR;case pi.ASTC_RGBA_10X8:return t9.COMPRESSED_RGBA_ASTC_10x8_KHR;case pi.ASTC_RGBA_10X10:return t9.COMPRESSED_RGBA_ASTC_10x10_KHR;case pi.ASTC_RGBA_12X10:return t9.COMPRESSED_RGBA_ASTC_12x10_KHR;case pi.ASTC_RGBA_12X12:return t9.COMPRESSED_RGBA_ASTC_12x12_KHR;case pi.ASTC_SRGBA_4X4:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case pi.ASTC_SRGBA_5X4:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case pi.ASTC_SRGBA_5X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case pi.ASTC_SRGBA_6X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case pi.ASTC_SRGBA_6X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case pi.ASTC_SRGBA_8X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case pi.ASTC_SRGBA_8X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case pi.ASTC_SRGBA_8X8:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case pi.ASTC_SRGBA_10X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case pi.ASTC_SRGBA_10X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case pi.ASTC_SRGBA_10X8:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case pi.ASTC_SRGBA_10X10:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case pi.ASTC_SRGBA_12X10:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case pi.ASTC_SRGBA_12X12:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,n),e.glFormat=function(t,e){switch(t){case pi.A8:return e.ALPHA;case pi.L8:return e.LUMINANCE;case pi.LA8:return e.LUMINANCE_ALPHA;case pi.R8:case pi.R8SN:return e.RED;case pi.R8UI:case pi.R8I:return e.RED;case pi.RG8:case pi.RG8SN:case pi.RG8UI:case pi.RG8I:return e.RG;case pi.RGB8:case pi.RGB8SN:case pi.RGB8UI:case pi.RGB8I:return e.RGB;case pi.BGRA8:case pi.RGBA8:case pi.RGBA8SN:case pi.RGBA8UI:case pi.RGBA8I:return e.RGBA;case pi.R16UI:case pi.R16I:case pi.R16F:return e.RED;case pi.RG16UI:case pi.RG16I:case pi.RG16F:return e.RG;case pi.RGB16UI:case pi.RGB16I:case pi.RGB16F:return e.RGB;case pi.RGBA16UI:case pi.RGBA16I:case pi.RGBA16F:return e.RGBA;case pi.R32UI:case pi.R32I:case pi.R32F:return e.RED;case pi.RG32UI:case pi.RG32I:case pi.RG32F:return e.RG;case pi.RGB32UI:case pi.RGB32I:case pi.RGB32F:return e.RGB;case pi.RGBA32UI:case pi.RGBA32I:case pi.RGBA32F:case pi.RGB10A2:return e.RGBA;case pi.R11G11B10F:case pi.R5G6B5:return e.RGB;case pi.RGB5A1:case pi.RGBA4:return e.RGBA;case pi.SRGB8:return e.RGB;case pi.SRGB8_A8:return e.RGBA;case pi.DEPTH:return e.DEPTH_COMPONENT;case pi.DEPTH_STENCIL:return e.DEPTH_STENCIL;case pi.BC1:return t9.COMPRESSED_RGB_S3TC_DXT1_EXT;case pi.BC1_ALPHA:return t9.COMPRESSED_RGBA_S3TC_DXT1_EXT;case pi.BC1_SRGB:return t9.COMPRESSED_SRGB_S3TC_DXT1_EXT;case pi.BC1_SRGB_ALPHA:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case pi.BC2:return t9.COMPRESSED_RGBA_S3TC_DXT3_EXT;case pi.BC2_SRGB:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case pi.BC3:return t9.COMPRESSED_RGBA_S3TC_DXT5_EXT;case pi.BC3_SRGB:return t9.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case pi.ETC_RGB8:return t9.COMPRESSED_RGB_ETC1_WEBGL;case pi.ETC2_RGB8:return t9.COMPRESSED_RGB8_ETC2;case pi.ETC2_SRGB8:return t9.COMPRESSED_SRGB8_ETC2;case pi.ETC2_RGB8_A1:return t9.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_SRGB8_A1:return t9.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case pi.ETC2_RGBA8:return t9.COMPRESSED_RGBA8_ETC2_EAC;case pi.ETC2_SRGB8_A8:return t9.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case pi.EAC_R11:return t9.COMPRESSED_R11_EAC;case pi.EAC_R11SN:return t9.COMPRESSED_SIGNED_R11_EAC;case pi.EAC_RG11:return t9.COMPRESSED_RG11_EAC;case pi.EAC_RG11SN:return t9.COMPRESSED_SIGNED_RG11_EAC;case pi.PVRTC_RGB2:return t9.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGBA2:return t9.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case pi.PVRTC_RGB4:return t9.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case pi.PVRTC_RGBA4:return t9.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case pi.ASTC_RGBA_4X4:return t9.COMPRESSED_RGBA_ASTC_4x4_KHR;case pi.ASTC_RGBA_5X4:return t9.COMPRESSED_RGBA_ASTC_5x4_KHR;case pi.ASTC_RGBA_5X5:return t9.COMPRESSED_RGBA_ASTC_5x5_KHR;case pi.ASTC_RGBA_6X5:return t9.COMPRESSED_RGBA_ASTC_6x5_KHR;case pi.ASTC_RGBA_6X6:return t9.COMPRESSED_RGBA_ASTC_6x6_KHR;case pi.ASTC_RGBA_8X5:return t9.COMPRESSED_RGBA_ASTC_8x5_KHR;case pi.ASTC_RGBA_8X6:return t9.COMPRESSED_RGBA_ASTC_8x6_KHR;case pi.ASTC_RGBA_8X8:return t9.COMPRESSED_RGBA_ASTC_8x8_KHR;case pi.ASTC_RGBA_10X5:return t9.COMPRESSED_RGBA_ASTC_10x5_KHR;case pi.ASTC_RGBA_10X6:return t9.COMPRESSED_RGBA_ASTC_10x6_KHR;case pi.ASTC_RGBA_10X8:return t9.COMPRESSED_RGBA_ASTC_10x8_KHR;case pi.ASTC_RGBA_10X10:return t9.COMPRESSED_RGBA_ASTC_10x10_KHR;case pi.ASTC_RGBA_12X10:return t9.COMPRESSED_RGBA_ASTC_12x10_KHR;case pi.ASTC_RGBA_12X12:return t9.COMPRESSED_RGBA_ASTC_12x12_KHR;case pi.ASTC_SRGBA_4X4:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case pi.ASTC_SRGBA_5X4:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case pi.ASTC_SRGBA_5X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case pi.ASTC_SRGBA_6X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case pi.ASTC_SRGBA_6X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case pi.ASTC_SRGBA_8X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case pi.ASTC_SRGBA_8X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case pi.ASTC_SRGBA_8X8:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case pi.ASTC_SRGBA_10X5:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case pi.ASTC_SRGBA_10X6:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case pi.ASTC_SRGBA_10X8:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case pi.ASTC_SRGBA_10X10:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case pi.ASTC_SRGBA_12X10:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case pi.ASTC_SRGBA_12X12:return t9.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}(e.format,n),e.glType=a9(e.format,n);var i=e.width,r=e.height;switch(e.type){case xi.TEX2D:if(e.glTarget=n.TEXTURE_2D,e.isSwapchainTexture)break;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),e.samples===bi.ONE){if(e.glTexture=n.createTexture(),e.size>0){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),na[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=sa(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else n.texStorage2D(n.TEXTURE_2D,e.mipLevel,e.glInternalFmt,i,r)}}else e.glRenderbuffer=n.createRenderbuffer(),e.size>0&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,e.samples,e.glInternalFmt,e.width,e.height));break;case xi.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);if(u>t.capabilities.maxCubeMapTextureSize&&O(9100,u,t.capabilities.maxTextureSize),e.glTexture=n.createTexture(),e.size>0){var h=t.stateCache.glTexUnits[t.stateCache.texUnit];if(h.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),h.glTexture=e.glTexture),na[e.format].isCompressed)for(var f=0;f<e.mipLevel;++f){for(var _=sa(e.format,i,r,1),d=new Uint8Array(_),p=0;p<6;++p)n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+p,f,e.glInternalFmt,i,r,0,d);i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else n.texStorage2D(n.TEXTURE_CUBE_MAP,e.mipLevel,e.glInternalFmt,i,r)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=xi.TEX2D,e.glTarget=n.TEXTURE_2D}}function A9(t,e){var n=t.gl;if(e.glTexture){var i=t.stateCache.glTexUnits,r=t.stateCache.texUnit;n.deleteTexture(e.glTexture);for(var a=0;a<i.length;++a)i[a].glTexture===e.glTexture&&(n.activeTexture(n.TEXTURE0+a),r=a,n.bindTexture(e.glTarget,null),i[a].glTexture=null);t.stateCache.texUnit=r,e.glTexture=null}if(e.glRenderbuffer){var o=t.stateCache.glRenderbuffer;n.deleteRenderbuffer(e.glRenderbuffer),o===e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,null),o=null),e.glRenderbuffer=null}}var C9={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0,invalidateAttachments:[]};function b9(t,e,n,i,r,a,o){var s=t.gl,c=t.stateCache,l=0;if(n&&e){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===i.x&&c.viewport.top===i.y&&c.viewport.width===i.width&&c.viewport.height===i.height||(s.viewport(i.x,i.y,i.width,i.height),c.viewport.left=i.x,c.viewport.top=i.y,c.viewport.width=i.width,c.viewport.height=i.height),c.scissorRect.x===i.x&&c.scissorRect.y===i.y&&c.scissorRect.width===i.width&&c.scissorRect.height===i.height||(s.scissor(i.x,i.y,i.width,i.height),c.scissorRect.x=i.x,c.scissorRect.y=i.y,c.scissorRect.width=i.width,c.scissorRect.height=i.height),C9.invalidateAttachments.length=0;for(var u=0;u<r.length;++u){var h=e.colorAttachments[u];if(h.format!==pi.UNKNOWN)switch(h.loadOp){case Fi.LOAD:break;case Fi.CLEAR:if(c.bs.targets[0].blendColorMask!==Mi.ALL&&s.colorMask(!0,!0,!0,!0),n.isOffscreen)r9[0]=r[u].x,r9[1]=r[u].y,r9[2]=r[u].z,r9[3]=r[u].w,s.clearBufferfv(s.COLOR,u,r9);else{var f=r[0];s.clearColor(f.x,f.y,f.z,f.w),l|=s.COLOR_BUFFER_BIT}break;case Fi.DISCARD:C9.invalidateAttachments.push(s.COLOR_ATTACHMENT0+u)}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==pi.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),l|=s.DEPTH_BUFFER_BIT;break;case Fi.DISCARD:C9.invalidateAttachments.push(s.DEPTH_ATTACHMENT)}if(na[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),l|=s.STENCIL_BUFFER_BIT;break;case Fi.DISCARD:C9.invalidateAttachments.push(s.STENCIL_ATTACHMENT)}}if(n.glFramebuffer&&C9.invalidateAttachments.length&&s.invalidateFramebuffer(s.FRAMEBUFFER,C9.invalidateAttachments),l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var _=c.bs.targets[0].blendColorMask;if(_!==Mi.ALL){var d=(_&Mi.R)!==Mi.NONE,p=(_&Mi.G)!==Mi.NONE,m=(_&Mi.B)!==Mi.NONE,g=(_&Mi.A)!==Mi.NONE;s.colorMask(d,p,m,g)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function w9(t,e,n,i,r,a){var o=t.gl,s=t.stateCache,c=e&&e.gpuShader,l=!1;if(e&&C9.gpuPipelineState!==e){if(C9.gpuPipelineState=e,C9.glPrimitive=e.glPrimitive,c){var u=c.glProgram;s.glProgram!==u&&(o.useProgram(u),s.glProgram=u,l=!0)}var h=e.rs;if(h){if(s.rs.cullMode!==h.cullMode){switch(h.cullMode){case Wi.NONE:o.disable(o.CULL_FACE);break;case Wi.FRONT:o.enable(o.CULL_FACE),o.cullFace(o.FRONT);break;case Wi.BACK:o.enable(o.CULL_FACE),o.cullFace(o.BACK)}t.stateCache.rs.cullMode=h.cullMode}var f=h.isFrontFaceCCW;t.stateCache.rs.isFrontFaceCCW!==f&&(o.frontFace(f?o.CCW:o.CW),t.stateCache.rs.isFrontFaceCCW=f),t.stateCache.rs.depthBias===h.depthBias&&t.stateCache.rs.depthBiasSlop===h.depthBiasSlop||(o.polygonOffset(h.depthBias,h.depthBiasSlop),t.stateCache.rs.depthBias=h.depthBias,t.stateCache.rs.depthBiasSlop=h.depthBiasSlop),t.stateCache.rs.lineWidth!==h.lineWidth&&(o.lineWidth(h.lineWidth),t.stateCache.rs.lineWidth=h.lineWidth)}var _=e.dss;_&&(s.dss.depthTest!==_.depthTest&&(_.depthTest?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),s.dss.depthTest=_.depthTest),s.dss.depthWrite!==_.depthWrite&&(o.depthMask(_.depthWrite),s.dss.depthWrite=_.depthWrite),s.dss.depthFunc!==_.depthFunc&&(o.depthFunc(h9[_.depthFunc]),s.dss.depthFunc=_.depthFunc),s.dss.stencilTestFront===_.stencilTestFront&&s.dss.stencilTestBack===_.stencilTestBack||(_.stencilTestFront||_.stencilTestBack?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),s.dss.stencilTestFront=_.stencilTestFront,s.dss.stencilTestBack=_.stencilTestBack),s.dss.stencilFuncFront===_.stencilFuncFront&&s.dss.stencilRefFront===_.stencilRefFront&&s.dss.stencilReadMaskFront===_.stencilReadMaskFront||(o.stencilFuncSeparate(o.FRONT,h9[_.stencilFuncFront],_.stencilRefFront,_.stencilReadMaskFront),s.dss.stencilFuncFront=_.stencilFuncFront,s.dss.stencilRefFront=_.stencilRefFront,s.dss.stencilReadMaskFront=_.stencilReadMaskFront),s.dss.stencilFailOpFront===_.stencilFailOpFront&&s.dss.stencilZFailOpFront===_.stencilZFailOpFront&&s.dss.stencilPassOpFront===_.stencilPassOpFront||(o.stencilOpSeparate(o.FRONT,f9[_.stencilFailOpFront],f9[_.stencilZFailOpFront],f9[_.stencilPassOpFront]),s.dss.stencilFailOpFront=_.stencilFailOpFront,s.dss.stencilZFailOpFront=_.stencilZFailOpFront,s.dss.stencilPassOpFront=_.stencilPassOpFront),s.dss.stencilWriteMaskFront!==_.stencilWriteMaskFront&&(o.stencilMaskSeparate(o.FRONT,_.stencilWriteMaskFront),s.dss.stencilWriteMaskFront=_.stencilWriteMaskFront),s.dss.stencilFuncBack===_.stencilFuncBack&&s.dss.stencilRefBack===_.stencilRefBack&&s.dss.stencilReadMaskBack===_.stencilReadMaskBack||(o.stencilFuncSeparate(o.BACK,h9[_.stencilFuncBack],_.stencilRefBack,_.stencilReadMaskBack),s.dss.stencilFuncBack=_.stencilFuncBack,s.dss.stencilRefBack=_.stencilRefBack,s.dss.stencilReadMaskBack=_.stencilReadMaskBack),s.dss.stencilFailOpBack===_.stencilFailOpBack&&s.dss.stencilZFailOpBack===_.stencilZFailOpBack&&s.dss.stencilPassOpBack===_.stencilPassOpBack||(o.stencilOpSeparate(o.BACK,f9[_.stencilFailOpBack],f9[_.stencilZFailOpBack],f9[_.stencilPassOpBack]),s.dss.stencilFailOpBack=_.stencilFailOpBack,s.dss.stencilZFailOpBack=_.stencilZFailOpBack,s.dss.stencilPassOpBack=_.stencilPassOpBack),s.dss.stencilWriteMaskBack!==_.stencilWriteMaskBack&&(o.stencilMaskSeparate(o.BACK,_.stencilWriteMaskBack),s.dss.stencilWriteMaskBack=_.stencilWriteMaskBack));var d=e.bs;if(d){s.bs.isA2C!==d.isA2C&&(d.isA2C?o.enable(o.SAMPLE_ALPHA_TO_COVERAGE):o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),s.bs.isA2C=d.isA2C),s.bs.blendColor.x===d.blendColor.x&&s.bs.blendColor.y===d.blendColor.y&&s.bs.blendColor.z===d.blendColor.z&&s.bs.blendColor.w===d.blendColor.w||(o.blendColor(d.blendColor.x,d.blendColor.y,d.blendColor.z,d.blendColor.w),s.bs.blendColor.x=d.blendColor.x,s.bs.blendColor.y=d.blendColor.y,s.bs.blendColor.z=d.blendColor.z,s.bs.blendColor.w=d.blendColor.w);var p=d.targets[0],m=s.bs.targets[0];m.blend!==p.blend&&(p.blend?o.enable(o.BLEND):o.disable(o.BLEND),m.blend=p.blend),m.blendEq===p.blendEq&&m.blendAlphaEq===p.blendAlphaEq||(o.blendEquationSeparate(_9[p.blendEq],_9[p.blendAlphaEq]),m.blendEq=p.blendEq,m.blendAlphaEq=p.blendAlphaEq),m.blendSrc===p.blendSrc&&m.blendDst===p.blendDst&&m.blendSrcAlpha===p.blendSrcAlpha&&m.blendDstAlpha===p.blendDstAlpha||(o.blendFuncSeparate(d9[p.blendSrc],d9[p.blendDst],d9[p.blendSrcAlpha],d9[p.blendDstAlpha]),m.blendSrc=p.blendSrc,m.blendDst=p.blendDst,m.blendSrcAlpha=p.blendSrcAlpha,m.blendDstAlpha=p.blendDstAlpha),m.blendColorMask!==p.blendColorMask&&(o.colorMask((p.blendColorMask&Mi.R)!==Mi.NONE,(p.blendColorMask&Mi.G)!==Mi.NONE,(p.blendColorMask&Mi.B)!==Mi.NONE,(p.blendColorMask&Mi.A)!==Mi.NONE),m.blendColorMask=p.blendColorMask)}}if(e&&e.gpuPipelineLayout&&c){for(var g=c.glBlocks.length,v=e.gpuPipelineLayout.dynamicOffsetIndices,y=0;y<g;y++){var S=c.glBlocks[y],x=i[S.set],E=x&&x.descriptorIndices[S.binding],A=E>=0&&x.gpuDescriptors[E];if(A&&A.gpuBuffer){var C=v[S.set],b=C&&C[S.binding],w=A.gpuBuffer.glOffset;b>=0&&(w+=r[b]),s.glBindUBOs[S.glBinding]===A.gpuBuffer.glBuffer&&s.glBindUBOOffsets[S.glBinding]===w||(w?o.bindBufferRange(o.UNIFORM_BUFFER,S.glBinding,A.gpuBuffer.glBuffer,w,A.gpuBuffer.size):o.bindBufferBase(o.UNIFORM_BUFFER,S.glBinding,A.gpuBuffer.glBuffer),s.glUniformBuffer=s.glBindUBOs[S.glBinding]=A.gpuBuffer.glBuffer,s.glBindUBOOffsets[S.glBinding]=w)}else T("Buffer binding '"+S.name+"' at set "+S.set+" binding "+S.binding+" is not bounded")}for(var I=c.glSamplerTextures.length,P=0;P<I;P++)for(var R=c.glSamplerTextures[P],D=i[R.set],O=D&&D.descriptorIndices[R.binding],N=O>=0&&D.gpuDescriptors[O],M=0;M<R.units.length;M++){var L=R.units[M],F=s.glTexUnits[L];if(N&&N.gpuTextureView&&N.gpuTextureView.gpuTexture&&N.gpuSampler){var B=N.gpuTextureView,z=B.gpuTexture,U=B.baseLevel,k=U+B.levelCount;if(z.size>0){F.glTexture!==z.glTexture&&(s.texUnit!==L&&(o.activeTexture(o.TEXTURE0+L),s.texUnit=L),z.glTexture?o.bindTexture(z.glTarget,z.glTexture):o.bindTexture(z.glTarget,t.nullTex2D.gpuTexture.glTexture),F.glTexture=z.glTexture);var G=N.gpuSampler.getGLSampler(t,U,k);s.glSamplerUnits[L]!==G&&(o.bindSampler(L,G),s.glSamplerUnits[L]=G)}N=D.gpuDescriptors[++O]}else T("Sampler binding '"+R.name+"' at set "+R.set+" binding "+R.binding+" index "+M+" is not bounded")}}if(n&&c&&(l||C9.gpuInputAssembler!==n))if(C9.gpuInputAssembler=n,t.extensions.useVAO){var V=n.glVAOs.get(c.glProgram);if(!V){var H;V=o.createVertexArray(),n.glVAOs.set(c.glProgram,V),o.bindVertexArray(V),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),s.glArrayBuffer=null,s.glElementArrayBuffer=null;for(var W=0;W<c.glInputs.length;W++){var j=c.glInputs[W];H=null;for(var X=0;X<n.glAttribs.length;X++){var q=n.glAttribs[X];if(q.name===j.name){H=q;break}}if(H){s.glArrayBuffer!==H.glBuffer&&(o.bindBuffer(o.ARRAY_BUFFER,H.glBuffer),s.glArrayBuffer=H.glBuffer);for(var Y=0;Y<H.componentCount;++Y){var K=j.glLoc+Y,Q=H.offset+H.size*Y;o.enableVertexAttribArray(K),s.glCurrentAttribLocs[K]=!0,o.vertexAttribPointer(K,H.count,H.glType,H.isNormalized,H.stride,Q),o.vertexAttribDivisor(K,H.isInstanced?1:0)}}}var J=n.gpuIndexBuffer;J&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,J.glBuffer),o.bindVertexArray(null),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),s.glArrayBuffer=null,s.glElementArrayBuffer=null}s.glVAO!==V&&(o.bindVertexArray(V),s.glVAO=V)}else{for(var Z=0;Z<t.capabilities.maxVertexAttributes;++Z)s.glCurrentAttribLocs[Z]=!1;for(var $=0;$<c.glInputs.length;$++){for(var tt=c.glInputs[$],et=null,nt=0;nt<n.glAttribs.length;nt++){var it=n.glAttribs[nt];if(it.name===tt.name){et=it;break}}if(et){s.glArrayBuffer!==et.glBuffer&&(o.bindBuffer(o.ARRAY_BUFFER,et.glBuffer),s.glArrayBuffer=et.glBuffer);for(var rt=0;rt<et.componentCount;++rt){var at=tt.glLoc+rt,ot=et.offset+et.size*rt;!s.glEnabledAttribLocs[at]&&at>=0&&(o.enableVertexAttribArray(at),s.glEnabledAttribLocs[at]=!0),s.glCurrentAttribLocs[at]=!0,o.vertexAttribPointer(at,et.count,et.glType,et.isNormalized,et.stride,ot),o.vertexAttribDivisor(at,et.isInstanced?1:0)}}}var st=n.gpuIndexBuffer;st&&s.glElementArrayBuffer!==st.glBuffer&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,st.glBuffer),s.glElementArrayBuffer=st.glBuffer);for(var ct=0;ct<t.capabilities.maxVertexAttributes;++ct)s.glEnabledAttribLocs[ct]!==s.glCurrentAttribLocs[ct]&&(o.disableVertexAttribArray(ct),s.glEnabledAttribLocs[ct]=!1)}if(e&&e.dynamicStates.length)for(var lt=e.dynamicStates.length,ut=0;ut<lt;ut++)switch(e.dynamicStates[ut]){case ji.LINE_WIDTH:s.rs.lineWidth!==a.lineWidth&&(o.lineWidth(a.lineWidth),s.rs.lineWidth=a.lineWidth);break;case ji.DEPTH_BIAS:s.rs.depthBias===a.depthBiasConstant&&s.rs.depthBiasSlop===a.depthBiasSlope||(o.polygonOffset(a.depthBiasConstant,a.depthBiasSlope),s.rs.depthBias=a.depthBiasConstant,s.rs.depthBiasSlop=a.depthBiasSlope);break;case ji.BLEND_CONSTANTS:var ht=a.blendConstant;s.bs.blendColor.x===ht.x&&s.bs.blendColor.y===ht.y&&s.bs.blendColor.z===ht.z&&s.bs.blendColor.w===ht.w||(o.blendColor(ht.x,ht.y,ht.z,ht.w),s.bs.blendColor.copy(ht));break;case ji.STENCIL_WRITE_MASK:var ft=a.stencilStatesFront,_t=a.stencilStatesBack;s.dss.stencilWriteMaskFront!==ft.writeMask&&(o.stencilMaskSeparate(o.FRONT,ft.writeMask),s.dss.stencilWriteMaskFront=ft.writeMask),s.dss.stencilWriteMaskBack!==_t.writeMask&&(o.stencilMaskSeparate(o.BACK,_t.writeMask),s.dss.stencilWriteMaskBack=_t.writeMask);break;case ji.STENCIL_COMPARE_MASK:var dt=a.stencilStatesFront,pt=a.stencilStatesBack;s.dss.stencilRefFront===dt.reference&&s.dss.stencilReadMaskFront===dt.compareMask||(o.stencilFuncSeparate(o.FRONT,h9[s.dss.stencilFuncFront],dt.reference,dt.compareMask),s.dss.stencilRefFront=dt.reference,s.dss.stencilReadMaskFront=dt.compareMask),s.dss.stencilRefBack===pt.reference&&s.dss.stencilReadMaskBack===pt.compareMask||(o.stencilFuncSeparate(o.BACK,h9[s.dss.stencilFuncBack],pt.reference,pt.compareMask),s.dss.stencilRefBack=pt.reference,s.dss.stencilReadMaskBack=pt.compareMask)}}function I9(t,e){var n=t.gl,i=C9.gpuInputAssembler,r=C9.glPrimitive,a=t.extensions.WEBGL_multi_draw;if(i){var o=i.gpuIndexBuffer;if(i.gpuIndirectBuffer){var s=i.gpuIndirectBuffer.indirects;if(s.drawByIndex){for(var c=0;c<s.drawCount;c++)s.byteOffsets[c]=s.offsets[c]*o.stride;if(a)s.instancedDraw?a.multiDrawElementsInstancedWEBGL(r,s.counts,0,i.glIndexType,s.byteOffsets,0,s.instances,0,s.drawCount):a.multiDrawElementsWEBGL(r,s.counts,0,i.glIndexType,s.byteOffsets,0,s.drawCount);else for(var l=0;l<s.drawCount;l++)s.instances[l]?n.drawElementsInstanced(r,s.counts[l],i.glIndexType,s.byteOffsets[l],s.instances[l]):n.drawElements(r,s.counts[l],i.glIndexType,s.byteOffsets[l])}else if(a)s.instancedDraw?a.multiDrawArraysInstancedWEBGL(r,s.offsets,0,s.counts,0,s.instances,0,s.drawCount):a.multiDrawArraysWEBGL(r,s.offsets,0,s.counts,0,s.drawCount);else for(var u=0;u<s.drawCount;u++)s.instances[u]?n.drawArraysInstanced(r,s.offsets[u],s.counts[u],s.instances[u]):n.drawArrays(r,s.offsets[u],s.counts[u])}else if(e.instanceCount)if(o){if(e.indexCount>0){var h=e.firstIndex*o.stride;n.drawElementsInstanced(r,e.indexCount,i.glIndexType,h,e.instanceCount)}}else e.vertexCount>0&&n.drawArraysInstanced(r,e.firstVertex,e.vertexCount,e.instanceCount);else if(o){if(e.indexCount>0){var f=e.firstIndex*o.stride;n.drawElements(r,e.indexCount,i.glIndexType,f)}}else e.vertexCount>0&&n.drawArrays(r,e.firstVertex,e.vertexCount)}}var P9=new Array(u9.COUNT);function R9(t,e){P9.fill(0);for(var n=0;n<e.cmds.length;++n){var i=e.cmds.array[n],r=P9[i]++;switch(i){case u9.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];b9(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case u9.BIND_STATES:var o=e.bindStatesCmds.array[r];w9(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.dynamicStates);break;case u9.DRAW:I9(t,e.drawCmds.array[r].drawInfo);break;case u9.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];x9(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case u9.COPY_BUFFER_TO_TEXTURE:var c=e.copyBufferToTextureCmds.array[r];D9(t,c.buffers,c.gpuTexture,c.regions)}}}function D9(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=1,c=1,l=0,u=na[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];s=f.texExtent.width,c=f.texExtent.height;var _=e[o++];u?n.glInternalFmt!==t9.COMPRESSED_RGB_ETC1_WEBGL?r.compressedTexSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,_):r.compressedTexImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,n.glInternalFmt,s,c,0,_):r.texSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,n.glType,_)}break;case r.TEXTURE_CUBE_MAP:for(var d=0;d<i.length;d++){var p=i[d],m=p.texSubres.baseArrayLayer+p.texSubres.layerCount;for(l=p.texSubres.baseArrayLayer;l<m;++l){s=p.texExtent.width,c=p.texExtent.height;var g=e[o++];u?n.glInternalFmt!==t9.COMPRESSED_RGB_ETC1_WEBGL?r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,g):r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,n.glInternalFmt,s,c,0,g):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,n.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ai.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var O9=function(){function t(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var e=t.prototype;return e.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},e.setDrawInfo=function(t,e){this._ensureCapacity(t),this.drawByIndex=e.indexCount>0,this.instancedDraw=!!e.instanceCount,this.drawCount=Math.max(t+1,this.drawCount),this.drawByIndex?(this.counts[t]=e.indexCount,this.offsets[t]=e.firstIndex):(this.counts[t]=e.vertexCount,this.offsets[t]=e.firstVertex),this.instances[t]=Math.max(1,e.instanceCount)},e._ensureCapacity=function(t){if(!(this._capacity>t)){this._capacity=a(t);var e=new Int32Array(this._capacity),n=new Int32Array(this._capacity),i=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),e.set(this.counts),n.set(this.offsets),i.set(this.instances),this.counts=e,this.offsets=n,this.instances=i}},t}(),N9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuBuffer=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:e.gpuBuffer.indirects,glTarget:e.gpuBuffer.glTarget,glBuffer:e.gpuBuffer.glBuffer,glOffset:t.offset}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:new O9,glTarget:0,glBuffer:null,glOffset:0},function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ti.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(e.usage&vi.VERTEX){e.glTarget=n.ARRAY_BUFFER;var a=n.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),C9.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&vi.INDEX){e.glTarget=n.ELEMENT_ARRAY_BUFFER;var o=n.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),C9.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else if(e.usage&vi.UNIFORM){e.glTarget=n.UNIFORM_BUFFER;var s=n.createBuffer();s&&e.size>0&&(e.glBuffer=s,t.stateCache.glUniformBuffer!==e.glBuffer&&(n.bindBuffer(n.UNIFORM_BUFFER,e.glBuffer),t.stateCache.glUniformBuffer=e.glBuffer),n.bufferData(n.UNIFORM_BUFFER,e.size,r),n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null)}else e.usage&vi.INDIRECT||e.usage&vi.TRANSFER_DST||e.usage&vi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE}(n9.instance,this._gpuBuffer),n9.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(this._isBufferView||(function(t,e){var n=t.gl,i=t.stateCache;if(e.glBuffer){switch(e.glTarget){case n.ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),t.stateCache.glVAO=null),C9.gpuInputAssembler=null,n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case n.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),t.stateCache.glVAO=null),C9.gpuInputAssembler=null,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null;break;case n.UNIFORM_BUFFER:n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null}n.deleteBuffer(e.glBuffer),e.glBuffer=null}}(n9.instance,this._gpuBuffer),n9.instance.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null)},n.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._gpuBuffer&&(this._gpuBuffer.size=t,t>0&&(function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ti.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;e.usage&vi.VERTEX?(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),C9.gpuInputAssembler=null,i.glArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),i.glArrayBuffer=null):e.usage&vi.INDEX?(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),C9.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&vi.UNIFORM?(t.stateCache.glUniformBuffer!==e.glBuffer&&n.bindBuffer(n.UNIFORM_BUFFER,e.glBuffer),n.bufferData(n.UNIFORM_BUFFER,e.size,r),n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null):(e.usage&vi.INDIRECT||e.usage&vi.TRANSFER_DST||e.usage&vi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(n9.instance,this._gpuBuffer),n9.instance.memoryStatus.bufferSize-=e,n9.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,e){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==e?e:this._usage&vi.INDIRECT?0:t.byteLength,x9(n9.instance,this._gpuBuffer,t,0,n))},Q(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}}]),e}(_a),M9=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new jl(e);for(var n=0;n<e;++n)this._frees[n]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,n=this._frees;this._frees=new Array(e);for(var i=e-n.length,r=0;r<i;++r)this._frees[r]=new t;for(var a=i,o=0;a<e;++a,++o)this._frees[a]=n[o];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),L9=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new M9(m9,1),this.bindStatesCmdPool=new M9(g9,1),this.drawCmdPool=new M9(v9,1),this.updateBufferCmdPool=new M9(y9,1),this.copyBufferToTextureCmdPool=new M9(S9,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),F9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).cmdPackage=new T9,e._cmdAllocator=new L9,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUDescriptorSets=[],e._curGPUInputAssembler=null,e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new ta,e._isStateInvalied=!1,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type,this._queue=t.queue;for(var e=n9.instance.bindingMappings.blockOffsets.length,n=0;n<e;n++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},n.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(t,e,n,i,r,a){var o=this._cmdAllocator.beginRenderPassCmdPool.alloc(m9);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea.copy(n);for(var s=0;s<i.length;++s)o.clearColors[s]=i[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(u9.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},n.bindDescriptorSet=function(t,e,n){var i=e.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=i,this._isStateInvalied=!0),n){var r,a=null===(r=this._curGPUPipelineState)||void 0===r?void 0:r.gpuPipelineLayout;if(a){for(var o=this._curDynamicOffsets,s=a.dynamicOffsetOffsets[t],c=0;c<n.length;c++)o[s+c]=n[c];this._isStateInvalied=!0}}},n.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},n.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},n.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},n.setDepthBias=function(t,e,n){var i=this._curDynamicStates;i.depthBiasConstant===t&&i.depthBiasClamp===e&&i.depthBiasSlope===n||(i.depthBiasConstant=t,i.depthBiasClamp=e,i.depthBiasSlope=n,this._isStateInvalied=!0)},n.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},n.setDepthBound=function(t,e){var n=this._curDynamicStates;n.depthMinBounds===t&&n.depthMaxBounds===e||(n.depthMinBounds=t,n.depthMaxBounds=e,this._isStateInvalied=!0)},n.setStencilWriteMask=function(t,e){var n=this._curDynamicStates.stencilStatesFront,i=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&n.writeMask!==e&&(n.writeMask=e,this._isStateInvalied=!0),t&Xi.BACK&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0)},n.setStencilCompareMask=function(t,e,n){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&(i.compareMask===n&&i.reference===e||(i.reference=e,i.compareMask=n,this._isStateInvalied=!0)),t&Xi.BACK&&(r.compareMask===n&&r.reference===e||(r.reference=e,r.compareMask=n,this._isStateInvalied=!0))},n.draw=function(t){if(this._type===Qi.PRIMARY&&this._isInRenderPass||this._type===Qi.SECONDARY){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t,n=this._cmdAllocator.drawCmdPool.alloc(v9);n.drawInfo.copy(e),this.cmdPackage.drawCmds.push(n),this.cmdPackage.cmds.push(u9.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var i=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=t.gpuBuffer;if(i){var r,a=this._cmdAllocator.updateBufferCmdPool.alloc(y9),o=0;t.usage&vi.INDIRECT||(o=void 0!==n?n:e.byteLength),r=e,a.gpuBuffer=i,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(u9.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=e.gpuTexture;if(i){var r=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(S9);r.gpuTexture=i,r.regions=n,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(u9.COPY_BUFFER_TO_TEXTURE)}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(t,e){for(var n=0;n<e;++n){for(var i=t[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var a=i.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<i.cmdPackage.bindStatesCmds.length;++o){var s=i.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<i.cmdPackage.updateBufferCmds.length;++u){var h=i.cmdPackage.updateBufferCmds.array[u];++h.refCount,this.cmdPackage.updateBufferCmds.push(h)}for(var f=0;f<i.cmdPackage.copyBufferToTextureCmds.length;++f){var _=i.cmdPackage.copyBufferToTextureCmds.array[f];++_.refCount,this.cmdPackage.copyBufferToTextureCmds.push(_)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var t=this._cmdAllocator.bindStatesCmdPool.alloc(g9);t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates=this._curDynamicStates,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(u9.BIND_STATES),this._isStateInvalied=!1},e}(da),B9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuFramebuffer=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=[],n=0;n<t.colorTextures.length;n++){var i=t.colorTextures[n];i&&e.push(i.gpuTextureView)}var r=null;t.depthStencilTexture&&(r=t.depthStencilTexture.gpuTextureView);var a=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorViews:e,gpuDepthStencilView:r,glFramebuffer:null,isOffscreen:!0,get width(){return this.isOffscreen?a:this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.width:this.gpuDepthStencilView.gpuTexture.width},set width(t){a=t},get height(){return this.isOffscreen?a:this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.height:this.gpuDepthStencilView.gpuTexture.height},set height(t){}},function(t,e){for(var n=0;n<e.gpuColorViews.length;++n)if(e.gpuColorViews[n].gpuTexture.isSwapchainTexture)return void(e.isOffscreen=!1);var i=t.gl,r=[],a=i.createFramebuffer();if(a){e.glFramebuffer=a,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorViews.length;++o){var s=e.gpuColorViews[o],c=s.gpuTexture;c&&(c.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,c.glTarget,c.glTexture,s.baseLevel):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,c.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o),e.width=Math.min(e.width,c.width>>s.baseLevel),e.height=Math.min(e.height,c.height>>s.baseLevel))}var l=e.gpuDepthStencilView;if(l){var u=l.gpuTexture,h=na[u.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;u.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,h,u.glTarget,u.glTexture,e.gpuDepthStencilView.baseLevel):i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,u.glRenderbuffer),e.width=Math.min(e.width,u.width>>l.baseLevel),e.height=Math.min(e.height,u.height>>l.baseLevel)}i.drawBuffers(r);var f=i.checkFramebufferStatus(i.FRAMEBUFFER);if(f!==i.FRAMEBUFFER_COMPLETE)switch(f){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}(n9.instance,this._gpuFramebuffer)},n.destroy=function(){var t,e;this._gpuFramebuffer&&(t=n9.instance,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),t.stateCache.glFramebuffer===e.glFramebuffer&&(t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.stateCache.glFramebuffer=null),e.glFramebuffer=null),this._gpuFramebuffer=null)},Q(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(ga),z9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuInputAssembler=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var e=this._vertexBuffers[0];this._drawInfo.vertexCount=e.size/e.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),i=0;i<t.vertexBuffers.length;++i){var r=t.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Illegal index buffer stride.")}var s=null;t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:n,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var n=t.gl;e.glAttribs=new Array(e.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],c=a9(a.format,n),l=na[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:c,size:l,count:na[a.format].count,stride:s.stride,componentCount:l9(c,n),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:i[o]},i[o]+=l}}(n9.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},n.destroy=function(){var t=n9.instance;this._gpuInputAssembler&&t.extensions.useVAO&&function(t,e){for(var n=e.glVAOs.values(),i=n.next(),r=t.gl,a=t.stateCache.glVAO;!i.done;)r.deleteVertexArray(i.value),a===i.value&&(r.bindVertexArray(null),a=null),i=n.next();t.stateCache.glVAO=a,e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Q(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Ta),U9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSetLayout=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];i.push(e),e+=a.count,a.binding>n&&(n=a.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var o=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,o[c.binding]=i[s]}for(var l=[],u=0;u<this._bindings.length;u++){var h=this._bindings[u];if(h.descriptorType&aa)for(var f=0;f<h.count;f++)l.push(h.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:o,descriptorCount:e}},n.destroy=function(){this._bindings.length=0},Q(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(Ea),k9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineLayout=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],n=[],i=0,r=[],a=0;a<this._setLayouts.length;a++){for(var o=this._setLayouts[a],s=o.gpuDescriptorSetLayout.dynamicBindings,c=Array(o.bindingIndices.length).fill(-1),l=0;l<s.length;l++){var u=s[l];c[u]<0&&(c[u]=i+l)}n.push(o.gpuDescriptorSetLayout),e.push(c),r.push(i),i+=s.length}this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:e,dynamicOffsetCount:i,dynamicOffsetOffsets:r}},n.destroy=function(){this._setLayouts.length=0},Q(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(Aa),G9=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],V9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineState=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var n=t.blendState,i=n.targets;i&&i.forEach((function(t,n){e.setTarget(n,t)})),void 0!==n.isA2C&&(e.isA2C=n.isA2C),void 0!==n.isIndepend&&(e.isIndepend=n.isIndepend),void 0!==n.blendColor&&(e.blendColor=n.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);this._gpuPipelineState={glPrimitive:G9[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r}},n.destroy=function(){this._gpuPipelineState=null},Q(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(Ra),H9=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.beginRenderPass=function(t,e,n,i,r,a){b9(n9.instance,t.gpuRenderPass,e.gpuFramebuffer,n,i,r,a),this._isInRenderPass=!0},n.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t;I9(n9.instance,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.setViewport=function(t){var e=n9.instance,n=e.stateCache,i=e.gl;n.viewport.left===t.left&&n.viewport.top===t.top&&n.viewport.width===t.width&&n.viewport.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.viewport.left=t.left,n.viewport.top=t.top,n.viewport.width=t.width,n.viewport.height=t.height)},n.setScissor=function(t){var e=n9.instance,n=e.stateCache,i=e.gl;n.scissorRect.x===t.x&&n.scissorRect.y===t.y&&n.scissorRect.width===t.width&&n.scissorRect.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.scissorRect.x=t.x,n.scissorRect.y=t.y,n.scissorRect.width=t.width,n.scissorRect.height=t.height)},n.updateBuffer=function(t,e,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=t.gpuBuffer;r&&(i=void 0!==n?n:t.usage&vi.INDIRECT?0:e.byteLength,x9(n9.instance,r,e,0,i))}},n.copyBuffersToTexture=function(t,e,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=e.gpuTexture;i&&D9(n9.instance,t,i,n)}},n.execute=function(t,e){for(var n=0;n<e;++n){var i=t[n];R9(n9.instance,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){w9(n9.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(F9),W9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type},n.destroy=function(){},n.submit=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.numDrawCalls+=n.numDrawCalls,this.numInstances+=n.numInstances,this.numTris+=n.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Da),j9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuRenderPass=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,this._subpasses=t.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},Q(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(Oa),X9=function(t){function e(e,n){var i,r,a,o;return(i=t.call(this,e,n)||this)._gpuSampler=null,i._gpuSampler={glSamplers:new Map,minFilter:i._info.minFilter,magFilter:i._info.magFilter,mipFilter:i._info.mipFilter,addressU:i._info.addressU,addressV:i._info.addressV,addressW:i._info.addressW,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0,getGLSampler:function(t,e,n){var i=t.gl,r=e<<16|n;if(!this.glSamplers.has(r)){var a=i.createSampler();a&&(this.glSamplers.set(r,a),i.samplerParameteri(a,i.TEXTURE_MIN_FILTER,this.glMinFilter),i.samplerParameteri(a,i.TEXTURE_MAG_FILTER,this.glMagFilter),i.samplerParameteri(a,i.TEXTURE_WRAP_S,this.glWrapS),i.samplerParameteri(a,i.TEXTURE_WRAP_T,this.glWrapT),i.samplerParameteri(a,i.TEXTURE_WRAP_R,this.glWrapR),i.samplerParameterf(a,i.TEXTURE_MIN_LOD,e),i.samplerParameterf(a,i.TEXTURE_MAX_LOD,n))}return this.glSamplers.get(r)}},r=n9.instance,a=i._gpuSampler,o=r.gl,a.minFilter===Ii.LINEAR||a.minFilter===Ii.ANISOTROPIC?a.mipFilter===Ii.LINEAR||a.mipFilter===Ii.ANISOTROPIC?a.glMinFilter=o.LINEAR_MIPMAP_LINEAR:a.mipFilter===Ii.POINT?a.glMinFilter=o.LINEAR_MIPMAP_NEAREST:a.glMinFilter=o.LINEAR:a.mipFilter===Ii.LINEAR||a.mipFilter===Ii.ANISOTROPIC?a.glMinFilter=o.NEAREST_MIPMAP_LINEAR:a.mipFilter===Ii.POINT?a.glMinFilter=o.NEAREST_MIPMAP_NEAREST:a.glMinFilter=o.NEAREST,a.magFilter===Ii.LINEAR||a.magFilter===Ii.ANISOTROPIC?a.glMagFilter=o.LINEAR:a.glMagFilter=o.NEAREST,a.glWrapS=i9[a.addressU],a.glWrapT=i9[a.addressV],a.glWrapR=i9[a.addressW],i}return Z(e,t),e.prototype.destroy=function(){this._gpuSampler&&(function(t,e){for(var n=t.gl,i=e.glSamplers.values().next();!i.done;){n.deleteSampler(i.value);for(var r=t.stateCache.glSamplerUnits,a=0;a<r.length;++a)r[a]===i.value&&(n.bindSampler(a,null),r[a]=null)}e.glSamplers.clear()}(n9.instance,this._gpuSampler),this._gpuSampler=null)},Q(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Na),q9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuShader=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks.slice(),samplerTextures:t.samplerTextures.slice(),subpassInputs:t.subpassInputs.slice(),gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var n=t.stages[e];this._gpuShader.gpuStages[e]={type:n.stage,source:n.source,glShader:null}}!function(t,e){for(var n=t.gl,i=function(t){var i=e.gpuStages[t],r=0,a="",o=1;switch(i.type){case Li.VERTEX:a="VertexShader",r=n.VERTEX_SHADER;break;case Li.FRAGMENT:a="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,"#version 300 es\n"+i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<e.gpuStages.length;c++){var l=e.gpuStages[t];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=i(r);if("object"==typeof a)return a.v}var o=n.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var c=e.gpuStages[s];n.attachShader(e.glProgram,c.glShader)}n.linkProgram(e.glProgram);for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(n.detachShader(e.glProgram,u.glShader),n.deleteShader(u.glShader),u.glShader=null)}if(!n.getProgramParameter(e.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(n.getProgramInfoLog(e.glProgram));E("Shader '"+e.name+"' compilation succeeded.");var h=n.getProgramParameter(e.glProgram,n.ACTIVE_ATTRIBUTES);e.glInputs=new Array(h);for(var f=0;f<h;++f){var _=n.getActiveAttrib(e.glProgram,f);if(_){var d,p=_.name.indexOf("[");d=-1!==p?_.name.substr(0,p):_.name;var m=n.getAttribLocation(e.glProgram,d),g=s9(_.type,n),v=c9(_.type,n);e.glInputs[f]={name:d,type:g,stride:v,count:_.size,size:v*_.size,glType:_.type,glLoc:m}}}var y,S,x,A,C=n.getProgramParameter(e.glProgram,n.ACTIVE_UNIFORM_BLOCKS);if(C){e.glBlocks=new Array(C);for(var b=0;b<C;++b){var w=(y=n.getActiveUniformBlockName(e.glProgram,b)).indexOf("[");-1!==w&&(y=y.substr(0,w)),A=null;for(var I=0;I<e.blocks.length;I++)if(e.blocks[I].name===y){A=e.blocks[I];break}if(A){S=b,x=n.getActiveUniformBlockParameter(e.glProgram,S,n.UNIFORM_BLOCK_DATA_SIZE);var P=A.binding+(t.bindingMappings.blockOffsets[A.set]||0);n.uniformBlockBinding(e.glProgram,S,P),e.glBlocks[b]={set:A.set,binding:A.binding,idx:S,name:y,size:x,glBinding:P}}else T("Block '"+y+"' does not bound")}}for(var R=0;R<e.subpassInputs.length;++R){var D=e.subpassInputs[R];e.samplerTextures.push(new Cr(D.set,D.binding,D.name,gi.SAMPLER2D,D.count))}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var O=0;O<e.samplerTextures.length;++O){var N=e.samplerTextures[O];e.glSamplerTextures[O]={set:N.set,binding:N.binding,name:N.name,type:N.type,count:N.count,units:[],glUnits:null,glType:o9(N.type,n),glLoc:null}}}for(var M=[],L=[],F=t.stateCache.texUnitCacheMap,B=0,z=0;z<e.blocks.length;++z)e.blocks[z].set===t.bindingMappings.flexibleSet&&B++;for(var U=0,k=0;k<e.samplerTextures.length;++k){var G=e.samplerTextures[k],V=n.getUniformLocation(e.glProgram,G.name);if(V&&-1!==V.id&&(M.push(e.glSamplerTextures[k]),L.push(V)),void 0===F[G.name]){var H=G.binding+t.bindingMappings.samplerTextureOffsets[G.set]+U;G.set===t.bindingMappings.flexibleSet&&(H-=B),F[G.name]=H%t.capabilities.maxTextureUnits,U+=G.count-1}}if(M.length){for(var W=[],j=0;j<M.length;++j){var X=M[j],q=F[X.name];if(void 0!==q){X.glLoc=L[j];for(var Y=0;Y<X.count;++Y){for(;W[q];)q=(q+1)%t.capabilities.maxTextureUnits;X.units.push(q),W[q]=!0}}}for(var K=0,Q=0;Q<M.length;++Q){var J=M[Q];if(!J.glLoc){for(J.glLoc=L[Q];W[K];)K++;for(var Z=0;Z<J.count;++Z){for(;W[K];)K=(K+1)%t.capabilities.maxTextureUnits;void 0===F[J.name]&&(F[J.name]=K),J.units.push(K),W[K]=!0}}}t.stateCache.glProgram!==e.glProgram&&n.useProgram(e.glProgram);for(var $=0;$<M.length;$++){var tt=M[$];tt.glUnits=new Int32Array(tt.units),n.uniform1iv(tt.glLoc,tt.glUnits)}t.stateCache.glProgram!==e.glProgram&&n.useProgram(t.stateCache.glProgram)}e.glSamplerTextures=M}}(n9.instance,this._gpuShader)},n.destroy=function(){var t,e;this._gpuShader&&(t=n9.instance,(e=this._gpuShader).glProgram&&(t.gl.deleteProgram(e.glProgram),t.stateCache.glProgram===e.glProgram&&(t.gl.useProgram(null),t.stateCache.glProgram=null),e.glProgram=null),this._gpuShader=null)},Q(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(Ma),Y9=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new ur,this.scissorRect=new ir(0,0,0,0),this.rs=new Ca,this.dss=new ba,this.bs=new Ia,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e,n){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=t,this.glSamplerUnits.fill(null),this.glBindUBOs.length=e,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=e,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=n,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=n,this.glCurrentAttribLocs.fill(!1)},t}(),K9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuTexture=null,e._gpuTextureView=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t,e){var n=t,i=t;if("texture"in t&&(n=i.texture.info,this._isTextureView=!0),this._info.copy(n),this._isPowerOf2=oa(this._info.width)&&oa(this._info.height),this._size=ca(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,this._isTextureView){var r;if(this._viewInfo.copy(i),this._gpuTexture=i.texture._gpuTexture,(null===(r=this._gpuTexture)||void 0===r?void 0:r.format)!==n.format)return void console.log("GPU memory alias is not supported");this._gpuTextureView={gpuTexture:this._gpuTexture,type:i.type,format:i.format,baseLevel:i.baseLevel,levelCount:i.levelCount}}else this._gpuTexture={type:n.type,format:n.format,usage:n.usage,width:n.width,height:n.height,depth:n.depth,size:this._size,arrayLayer:n.layerCount,mipLevel:n.levelCount,samples:n.samples,flags:n.flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:e||!1},E9(n9.instance,this._gpuTexture),n9.instance.memoryStatus.textureSize+=this._size,this._viewInfo.texture=this,this._viewInfo.type=t.type,this._viewInfo.format=t.format,this._viewInfo.baseLevel=0,this._viewInfo.levelCount=t.levelCount,this._viewInfo.baseLayer=0,this._viewInfo.layerCount=t.layerCount,this._gpuTextureView={gpuTexture:this._gpuTexture,type:this._viewInfo.type,format:this._viewInfo.format,baseLevel:this._viewInfo.baseLevel,levelCount:this._viewInfo.levelCount}},n.destroy=function(){!this._isTextureView&&this._gpuTexture&&(A9(n9.instance,this._gpuTexture),n9.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(t,n){if(this._info.width!==t||this._info.height!==n){this._info.levelCount===e.getLevelCount(this._info.width,this._info.height)?this._info.levelCount=e.getLevelCount(t,n):this._info.levelCount>1&&(this._info.levelCount=Math.min(this._info.levelCount,e.getLevelCount(t,n)));var i=this._size;this._info.width=t,this._info.height=n,this._size=ca(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,!this._isTextureView&&this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=n,this._gpuTexture.size=this._size,function(t,e){if(e.size){var n=t.gl,i=e.width,r=e.height;switch(e.type){case xi.TEX2D:e.glTarget=n.TEXTURE_2D;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),e.samples===bi.ONE){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),na[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=sa(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else A9(t,e),E9(t,e)}else e.glRenderbuffer&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,e.samples,e.glInternalFmt,e.width,e.height));break;case xi.CUBE:e.type=xi.CUBE,e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);u>t.capabilities.maxCubeMapTextureSize&&O(9100,u,t.capabilities.maxTextureSize);var h=t.stateCache.glTexUnits[t.stateCache.texUnit];if(h.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),h.glTexture=e.glTexture),na[e.format].isCompressed)for(var f=0;f<6;++f){i=e.width,r=e.height;for(var _=0;_<e.mipLevel;++_){var d=sa(e.format,i,r,1),p=new Uint8Array(d);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,_,e.glInternalFmt,i,r,0,p),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else A9(t,e),E9(t,e);break;default:console.error("Unsupported TextureType, create texture failed."),e.type=xi.TEX2D,e.glTarget=n.TEXTURE_2D}}}(n9.instance,this._gpuTexture),n9.instance.memoryStatus.textureSize-=i,n9.instance.memoryStatus.textureSize+=this._size)}},n.initAsSwapchainTexture=function(t){var e=new Sr;e.format=t.format,e.usage=na[t.format].hasDepth?Ei.DEPTH_STENCIL_ATTACHMENT:Ei.COLOR_ATTACHMENT,e.width=t.width,e.height=t.height,this.initialize(e,!0)},Q(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"gpuTextureView",get:function(){return this._gpuTextureView}}]),e}(La),Q9="webglcontextlost";function J9(t,e){for(var n=["","WEBKIT_","MOZ_"],i=0;i<n.length;++i){var r=t.getExtension(n[i]+e);if(r)return r}return null}function Z9(t){var e={EXT_texture_filter_anisotropic:J9(t,"EXT_texture_filter_anisotropic"),EXT_color_buffer_half_float:J9(t,"EXT_color_buffer_half_float"),EXT_color_buffer_float:J9(t,"EXT_color_buffer_float"),WEBGL_compressed_texture_etc1:J9(t,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:J9(t,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:J9(t,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_astc:J9(t,"WEBGL_compressed_texture_astc"),WEBGL_compressed_texture_s3tc:J9(t,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:J9(t,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:J9(t,"WEBGL_debug_shaders"),WEBGL_lose_context:J9(t,"WEBGL_lose_context"),WEBGL_debug_renderer_info:J9(t,"WEBGL_debug_renderer_info"),OES_texture_half_float_linear:J9(t,"OES_texture_half_float_linear"),OES_texture_float_linear:J9(t,"OES_texture_float_linear"),WEBGL_multi_draw:null,useVAO:!0};return du.os!==au.ANDROID&&du.os!==au.IOS&&(e.WEBGL_multi_draw=J9(t,"WEBGL_multi_draw")),e}var $9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stateCache=new Y9,e.nullTex2D=null,e.nullTexCube=null,e._canvas=null,e._webGL2ContextLostHandler=null,e._extensions=null,e}Z(e,t);var n=e.prototype;return n.initialize=function(t){this._canvas=t.windowHandle,this._webGL2ContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(Q9,this._onWebGLContextLost);var e=n9.instance.gl;this.stateCache.initialize(n9.instance.capabilities.maxTextureUnits,n9.instance.capabilities.maxUniformBufferBindings,n9.instance.capabilities.maxVertexAttributes),this._extensions=Z9(e),function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}(e);var n=pi.RGBA8,i=pi.DEPTH_STENCIL,r=e.getParameter(e.DEPTH_BITS),a=e.getParameter(e.STENCIL_BITS);r&&a?i=pi.DEPTH_STENCIL:r&&(i=pi.DEPTH),this._colorTexture=new K9,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:n,width:t.width,height:t.height}),this._depthStencilTexture=new K9,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:i,width:t.width,height:t.height}),this.nullTex2D=n9.instance.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED,pi.RGBA8,2,2,Ai.NONE)),this.nullTexCube=n9.instance.createTexture(new Sr(xi.CUBE,Ei.SAMPLED,pi.RGBA8,2,2,Ai.NONE,6));var o=new lr;o.texExtent.width=2,o.texExtent.height=2;var s=new Uint8Array(this.nullTex2D.size);s.fill(0),n9.instance.copyBuffersToTexture([s],this.nullTex2D,[o]),o.texSubres.layerCount=6,n9.instance.copyBuffersToTexture([s,s,s,s,s,s],this.nullTexCube,[o])},n.destroy=function(){this._canvas&&this._webGL2ContextLostHandler&&(this._canvas.removeEventListener(Q9,this._webGL2ContextLostHandler),this._webGL2ContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._extensions=null,this._canvas=null},n.resize=function(t,e){this._colorTexture.width===t&&this._colorTexture.height===e||(E("Resizing swapchain: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._colorTexture.resize(t,e),this._depthStencilTexture.resize(t,e))},n._onWebGLContextLost=function(t){R(11e3),S(t)},Q(e,[{key:"extensions",get:function(){return this._extensions}}]),e}(ma),ttt=t("WebGL2Device",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._swapchain=null,e._context=null,e._bindingMappings=null,e._textureExclusive=new Array(pi.COUNT),e}Z(e,t);var n=e.prototype;return n.initialize=function(t){n9.setInstance(this),this._gfxAPI=fi.WEBGL2;var e=this._bindingMappingInfo=t.bindingMappingInfo,n=[],i=[],r=e.setIndices[0];n[r]=0,i[r]=0;for(var a=1;a<e.setIndices.length;++a){var o=e.setIndices[a],s=e.setIndices[a-1];n[o]=e.maxBlockCounts[s]+n[s],i[o]=e.maxSamplerTextureCounts[s]+i[s]}for(var c=0;c<e.setIndices.length;++c){var l=e.setIndices[c];i[l]-=e.maxBlockCounts[l]}this._bindingMappings={blockOffsets:n,samplerTextureOffsets:i,flexibleSet:e.setIndices[e.setIndices.length-1]};var u=this._context=function(t){var e=null;try{var n={alpha:he.ENABLE_TRANSPARENT_CANVAS,antialias:he.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};e=t.getContext("webgl2",n)}catch(t){return null}return e}(pa.canvas);if(!u)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new Kr(Yi.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Yr(this._queue)),this._caps.maxVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxUniformBufferBindings=u.getParameter(u.MAX_UNIFORM_BUFFER_BINDINGS),this._caps.maxUniformBlockSize=u.getParameter(u.MAX_UNIFORM_BLOCK_SIZE),this._caps.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.uboOffsetAlignment=u.getParameter(u.UNIFORM_BUFFER_OFFSET_ALIGNMENT);var h=u.getSupportedExtensions(),f="";if(h)for(var _,d=ot(h);!(_=d()).done;)f+=_.value+" ";var p=Z9(u);p.WEBGL_debug_renderer_info?(this._renderer=u.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=u.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=u.getParameter(u.RENDERER),this._vendor=u.getParameter(u.VENDOR));var m=u.getParameter(u.VERSION);this._features.fill(!1),this.initFormatFeatures(p),this._features[di.ELEMENT_INDEX_UINT]=!0,this._features[di.INSTANCED_ARRAYS]=!0,this._features[di.MULTIPLE_RENDER_TARGETS]=!0,this._features[di.BLEND_MINMAX]=!0;var g="";return this.getFormatFeatures(pi.ETC_RGB8)&&(g+="etc1 "),this.getFormatFeatures(pi.ETC2_RGB8)&&(g+="etc2 "),this.getFormatFeatures(pi.BC1)&&(g+="dxt "),this.getFormatFeatures(pi.PVRTC_RGB2)&&(g+="pvrtc "),this.getFormatFeatures(pi.ASTC_RGBA_4X4)&&(g+="astc "),E("WebGL2 device initialized."),E("RENDERER: "+this._renderer),E("VENDOR: "+this._vendor),E("VERSION: "+m),E("COMPRESSED_FORMAT: "+g),E("EXTENSIONS: "+f),!0},n.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null);for(var t=this._samplers.values(),e=t.next();!e.done;)e.value.destroy(),e=t.next();this._swapchain=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},n.initFormatFeatures=function(t){this._formatFeatures.fill(Ci.NONE),this._textureExclusive.fill(!0);var e=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE|Ci.STORAGE_TEXTURE|Ci.LINEAR_FILTER|Ci.VERTEX_ATTRIBUTE;this._formatFeatures[pi.R8]=e,this._formatFeatures[pi.RG8]=e,this._formatFeatures[pi.RGB8]=e,this._formatFeatures[pi.RGBA8]=e,e=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE|Ci.STORAGE_TEXTURE|Ci.LINEAR_FILTER,this._formatFeatures[pi.R8SN]=e,this._formatFeatures[pi.RG8SN]=e,this._formatFeatures[pi.RGB8SN]=e,this._formatFeatures[pi.RGBA8SN]=e,this._formatFeatures[pi.R5G6B5]=e,this._formatFeatures[pi.RGBA4]=e,this._formatFeatures[pi.RGB5A1]=e,this._formatFeatures[pi.RGB10A2]=e,this._formatFeatures[pi.SRGB8]=e,this._formatFeatures[pi.SRGB8_A8]=e,this._formatFeatures[pi.R11G11B10F]=e,this._formatFeatures[pi.RGB9E5]=e,this._formatFeatures[pi.DEPTH]=e,this._formatFeatures[pi.DEPTH_STENCIL]=e,this._formatFeatures[pi.RGB10A2UI]=Ci.RENDER_TARGET|Ci.STORAGE_TEXTURE|Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER,e=Ci.RENDER_TARGET|Ci.SAMPLED_TEXTURE|Ci.STORAGE_TEXTURE|Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R16F]=e,this._formatFeatures[pi.RG16F]=e,this._formatFeatures[pi.RGB16F]=e,this._formatFeatures[pi.RGBA16F]=e,e=Ci.STORAGE_TEXTURE|Ci.SAMPLED_TEXTURE|Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R32F]=e,this._formatFeatures[pi.RG32F]=e,this._formatFeatures[pi.RGB32F]=e,this._formatFeatures[pi.RGBA32F]=e,this._formatFeatures[pi.RGB10A2UI]=Ci.RENDER_TARGET|Ci.STORAGE_TEXTURE|Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER,e=Ci.RENDER_TARGET|Ci.STORAGE_TEXTURE|Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER|Ci.VERTEX_ATTRIBUTE,this._formatFeatures[pi.R8I]=e,this._formatFeatures[pi.R8UI]=e,this._formatFeatures[pi.R16I]=e,this._formatFeatures[pi.R16UI]=e,this._formatFeatures[pi.R32I]=e,this._formatFeatures[pi.R32UI]=e,this._formatFeatures[pi.RG8I]=e,this._formatFeatures[pi.RG8UI]=e,this._formatFeatures[pi.RG16I]=e,this._formatFeatures[pi.RG16UI]=e,this._formatFeatures[pi.RG32I]=e,this._formatFeatures[pi.RG32UI]=e,this._formatFeatures[pi.RGB8I]=e,this._formatFeatures[pi.RGB8UI]=e,this._formatFeatures[pi.RGB16I]=e,this._formatFeatures[pi.RGB16UI]=e,this._formatFeatures[pi.RGB32I]=e,this._formatFeatures[pi.RGB32UI]=e,this._formatFeatures[pi.RGBA8I]=e,this._formatFeatures[pi.RGBA8UI]=e,this._formatFeatures[pi.RGBA16I]=e,this._formatFeatures[pi.RGBA16UI]=e,this._formatFeatures[pi.RGBA32I]=e,this._formatFeatures[pi.RGBA32UI]=e,this._textureExclusive[pi.R8]=!1,this._textureExclusive[pi.RG8]=!1,this._textureExclusive[pi.RGB8]=!1,this._textureExclusive[pi.R5G6B5]=!1,this._textureExclusive[pi.RGBA4]=!1,this._textureExclusive[pi.RGB5A1]=!1,this._textureExclusive[pi.RGBA8]=!1,this._textureExclusive[pi.RGB10A2]=!1,this._textureExclusive[pi.RGB10A2UI]=!1,this._textureExclusive[pi.SRGB8_A8]=!1,this._textureExclusive[pi.R8I]=!1,this._textureExclusive[pi.R8UI]=!1,this._textureExclusive[pi.R16I]=!1,this._textureExclusive[pi.R16UI]=!1,this._textureExclusive[pi.R32I]=!1,this._textureExclusive[pi.R32UI]=!1,this._textureExclusive[pi.RG8I]=!1,this._textureExclusive[pi.RG8UI]=!1,this._textureExclusive[pi.RG16I]=!1,this._textureExclusive[pi.RG16UI]=!1,this._textureExclusive[pi.RG32I]=!1,this._textureExclusive[pi.RG32UI]=!1,this._textureExclusive[pi.RGBA8I]=!1,this._textureExclusive[pi.RGBA8UI]=!1,this._textureExclusive[pi.RGBA16I]=!1,this._textureExclusive[pi.RGBA16UI]=!1,this._textureExclusive[pi.RGBA32I]=!1,this._textureExclusive[pi.RGBA32UI]=!1,this._textureExclusive[pi.DEPTH]=!1,this._textureExclusive[pi.DEPTH_STENCIL]=!1,t.EXT_color_buffer_float&&(this._formatFeatures[pi.R32F]|=Ci.RENDER_TARGET,this._formatFeatures[pi.RG32F]|=Ci.RENDER_TARGET,this._formatFeatures[pi.RGBA32F]|=Ci.RENDER_TARGET,this._textureExclusive[pi.R32F]=!1,this._textureExclusive[pi.RG32F]=!1,this._textureExclusive[pi.RGBA32F]=!1),t.EXT_color_buffer_half_float&&(this._textureExclusive[pi.R16F]=!1,this._textureExclusive[pi.RG16F]=!1,this._textureExclusive[pi.RGBA16F]=!1),t.OES_texture_float_linear&&(this._formatFeatures[pi.RGB32F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RGBA32F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.R32F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RG32F]|=Ci.LINEAR_FILTER),t.OES_texture_half_float_linear&&(this._formatFeatures[pi.RGB16F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RGBA16F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.R16F]|=Ci.LINEAR_FILTER,this._formatFeatures[pi.RG16F]|=Ci.LINEAR_FILTER);var n=Ci.SAMPLED_TEXTURE|Ci.LINEAR_FILTER;t.WEBGL_compressed_texture_etc1&&(this._formatFeatures[pi.ETC_RGB8]=n),t.WEBGL_compressed_texture_etc&&(this._formatFeatures[pi.ETC2_RGB8]=n,this._formatFeatures[pi.ETC2_RGBA8]=n,this._formatFeatures[pi.ETC2_SRGB8]=n,this._formatFeatures[pi.ETC2_SRGB8_A8]=n,this._formatFeatures[pi.ETC2_RGB8_A1]=n,this._formatFeatures[pi.ETC2_SRGB8_A1]=n),t.WEBGL_compressed_texture_s3tc&&(this._formatFeatures[pi.BC1]=n,this._formatFeatures[pi.BC1_ALPHA]=n,this._formatFeatures[pi.BC1_SRGB]=n,this._formatFeatures[pi.BC1_SRGB_ALPHA]=n,this._formatFeatures[pi.BC2]=n,this._formatFeatures[pi.BC2_SRGB]=n,this._formatFeatures[pi.BC3]=n,this._formatFeatures[pi.BC3_SRGB]=n),t.WEBGL_compressed_texture_pvrtc&&(this._formatFeatures[pi.PVRTC_RGB2]=n,this._formatFeatures[pi.PVRTC_RGBA2]=n,this._formatFeatures[pi.PVRTC_RGB4]=n,this._formatFeatures[pi.PVRTC_RGBA4]=n),t.WEBGL_compressed_texture_astc&&(this._formatFeatures[pi.ASTC_RGBA_4X4]=n,this._formatFeatures[pi.ASTC_RGBA_5X4]=n,this._formatFeatures[pi.ASTC_RGBA_5X5]=n,this._formatFeatures[pi.ASTC_RGBA_6X5]=n,this._formatFeatures[pi.ASTC_RGBA_6X6]=n,this._formatFeatures[pi.ASTC_RGBA_8X5]=n,this._formatFeatures[pi.ASTC_RGBA_8X6]=n,this._formatFeatures[pi.ASTC_RGBA_8X8]=n,this._formatFeatures[pi.ASTC_RGBA_10X5]=n,this._formatFeatures[pi.ASTC_RGBA_10X6]=n,this._formatFeatures[pi.ASTC_RGBA_10X8]=n,this._formatFeatures[pi.ASTC_RGBA_10X10]=n,this._formatFeatures[pi.ASTC_RGBA_12X10]=n,this._formatFeatures[pi.ASTC_RGBA_12X12]=n,this._formatFeatures[pi.ASTC_SRGBA_4X4]=n,this._formatFeatures[pi.ASTC_SRGBA_5X4]=n,this._formatFeatures[pi.ASTC_SRGBA_5X5]=n,this._formatFeatures[pi.ASTC_SRGBA_6X5]=n,this._formatFeatures[pi.ASTC_SRGBA_6X6]=n,this._formatFeatures[pi.ASTC_SRGBA_8X5]=n,this._formatFeatures[pi.ASTC_SRGBA_8X6]=n,this._formatFeatures[pi.ASTC_SRGBA_8X8]=n,this._formatFeatures[pi.ASTC_SRGBA_10X5]=n,this._formatFeatures[pi.ASTC_SRGBA_10X6]=n,this._formatFeatures[pi.ASTC_SRGBA_10X8]=n,this._formatFeatures[pi.ASTC_SRGBA_10X10]=n,this._formatFeatures[pi.ASTC_SRGBA_12X10]=n,this._formatFeatures[pi.ASTC_SRGBA_12X12]=n)},n.createCommandBuffer=function(t){var e=new(t.type===Qi.PRIMARY?H9:F9);return e.initialize(t),e},n.createSwapchain=function(t){var e=new $9;return this._swapchain=e,e.initialize(t),e},n.createBuffer=function(t){var e=new N9;return e.initialize(t),e},n.createTexture=function(t){var e=new K9;return e.initialize(t),e},n.createDescriptorSet=function(t){var e=new e9;return e.initialize(t),e},n.createShader=function(t){var e=new q9;return e.initialize(t),e},n.createInputAssembler=function(t){var e=new z9;return e.initialize(t),e},n.createRenderPass=function(t){var e=new j9;return e.initialize(t),e},n.createFramebuffer=function(t){var e=new B9;return e.initialize(t),e},n.createDescriptorSetLayout=function(t){var e=new U9;return e.initialize(t),e},n.createPipelineLayout=function(t){var e=new k9;return e.initialize(t),e},n.createPipelineState=function(t){var e=new V9;return e.initialize(t),e},n.createQueue=function(t){var e=new W9;return e.initialize(t),e},n.getSampler=function(t){var e=Na.computeHash(t);return this._samplers.has(e)||this._samplers.set(e,new X9(t,e)),this._samplers.get(e)},n.getGeneralBarrier=function(t){var e=Fa.computeHash(t);return this._generalBarrierss.has(e)||this._generalBarrierss.set(e,new Fa(t,e)),this._generalBarrierss.get(e)},n.getTextureBarrier=function(t){var e=Ba.computeHash(t);return this._textureBarriers.has(e)||this._textureBarriers.set(e,new Ba(t,e)),this._textureBarriers.get(e)},n.copyBuffersToTexture=function(t,e,n){D9(this,t,e.gpuTexture,n)},n.copyTextureToBuffers=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=0,c=0,l=1,u=1;switch(e.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,f.texSubres.mipLevel),s=f.texOffset.x,c=f.texOffset.y,l=f.texExtent.width,u=f.texExtent.height,r.readPixels(s,c,l,u,e.glFormat,e.glType,n[h])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}r.bindFramebuffer(r.FRAMEBUFFER,null),a.glFramebuffer=null,r.deleteFramebuffer(o)}(this,t.gpuTexture,e,n)},n.copyTexImagesToTexture=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var u=0;u<i.length;u++){var h=i[u],f=h.texSubres.baseArrayLayer+h.texSubres.layerCount;for(s=h.texSubres.baseArrayLayer;s<f;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,n.glFormat,n.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ai.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}(this,t,e.gpuTexture,n)},Q(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}}]),e}(pa));function ett(t,e,n,i){var r=(i.x-n.x)*(t.y-n.y)-(i.y-n.y)*(t.x-n.x),a=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),o=(i.y-n.y)*(e.x-t.x)-(i.x-n.x)*(e.y-t.y);if(0!==o){var s=r/o,c=a/o;if(s>=0&&s<=1&&c>=0&&c<=1)return!0}return!1}l.WebGL2Device=ttt;var ntt=new Qn,itt=new Qn,rtt=new Qn,att=new Qn;function ott(t,e,n){for(var i=n.length,r=0;r<i;++r)if(ett(t,e,n[r],n[(r+1)%i]))return!0;return!1}function stt(t,e){for(var n=!1,i=t.x,r=t.y,a=e.length,o=0,s=a-1;o<a;s=o++){var c=e[o].x,l=e[o].y,u=e[s].x,h=e[s].y;l>r!=h>r&&i<(u-c)*(r-l)/(h-l)+c&&(n=!n)}return n}function ctt(t,e,n,i){var r,a=n.x-e.x,o=n.y-e.y,s=a*a+o*o,c=((t.x-e.x)*a+(t.y-e.y)*o)/s;return r=i?s?c<0?e:c>1?n:ntt.set(e.x+c*a,e.y+c*o):e:ntt.set(e.x+c*a,e.y+c*o),a=t.x-r.x,o=t.y-r.y,Math.sqrt(a*a+o*o)}var ltt=t("Intersection2D",(function(){}));ltt.lineLine=ett,ltt.lineRect=function(t,e,n){var i=ntt.set(n.x,n.y),r=itt.set(n.x,n.yMax),a=rtt.set(n.xMax,n.yMax),o=att.set(n.xMax,n.y);return!!(ett(t,e,i,r)||ett(t,e,r,a)||ett(t,e,a,o)||ett(t,e,o,i))},ltt.linePolygon=ott,ltt.rectRect=function(t,e){var n=t.x,i=t.y,r=t.x+t.width,a=t.y+t.height,o=e.x,s=e.y,c=e.x+e.width,l=e.y+e.height;return n<=c&&r>=o&&i<=l&&a>=s},ltt.rectPolygon=function(t,e){var n=ntt.set(t.x,t.y),i=itt.set(t.x,t.yMax),r=rtt.set(t.xMax,t.yMax),a=att.set(t.xMax,t.y);if(ott(n,i,e))return!0;if(ott(i,r,e))return!0;if(ott(r,a,e))return!0;if(ott(a,n,e))return!0;for(var o=0,s=e.length;o<s;++o)if(t.contains(e[o]))return!0;return!!(stt(n,e)||stt(i,e)||stt(r,e)||stt(a,e))},ltt.rectCircle=function(t,e,n){var i=e.x,r=e.y,a=t.x,o=t.y,s=t.width,c=t.height,l=i,u=r;i<a?l=a:i>a+s&&(l=a+s),r<o?u=o:r>o+c&&(u=o+c);var h=i-l,f=r-u;return Math.sqrt(h*h+f*f)<=n},ltt.polygonPolygon=function(t,e){var n,i;for(n=0,i=t.length;n<i;++n)if(ott(t[n],t[(n+1)%i],e))return!0;for(n=0,i=e.length;n<i;++n)if(stt(e[n],t))return!0;for(n=0,i=t.length;n<i;++n)if(stt(t[n],e))return!0;return!1},ltt.circleCircle=function(t,e,n,i){return Qn.distance(t,n)<e+i},ltt.polygonCircle=function(t,e,n){var i=e;if(stt(i,t))return!0;for(var r=0,a=t.length;r<a;r++)if(ctt(i,0===r?t[t.length-1]:t[r-1],t[r],!0)<n)return!0;return!1},ltt.pointInPolygon=stt,ltt.pointLineDistance=ctt;var utt,htt,ftt,_tt,dtt=oe({GRAVITY:0,RADIUS:1}),ptt=oe({FREE:0,RELATIVE:1,GROUPED:2}),mtt=new Qn(0,0),gtt=new Qn,vtt=new Qn,ytt=new Qn,Stt=new Qn,Ttt=WB(VB),xtt=function(){this.pos=new Qn(0,0),this.startPos=new Qn(0,0),this.color=new Pn(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Qn(0,0),this.aspectRatio=1,this.dir=new Qn(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},Ett=new(function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e.prototype.get=function(){return this._get()||new xtt},e}(ee))((function(t){t.pos.set(mtt),t.startPos.set(mtt),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(mtt),t.aspectRatio=1,t.dir.set(mtt),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),Att=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)Ett.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,n=Ett.get();this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var i=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var r,a,o,s,c=e.startColor,l=e.startColorVar,u=e.endColor,h=e.endColorVar;n.color.r=r=Ee(c.r+l.r*(Math.random()-.5)*2,0,255),n.color.g=a=Ee(c.g+l.g*(Math.random()-.5)*2,0,255),n.color.b=o=Ee(c.b+l.b*(Math.random()-.5)*2,0,255),n.color.a=s=Ee(c.a+l.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(Ee(u.r+h.r*(Math.random()-.5)*2,0,255)-r)/i,n.deltaColor.g=(Ee(u.g+h.g*(Math.random()-.5)*2,0,255)-a)/i,n.deltaColor.b=(Ee(u.b+h.b*(Math.random()-.5)*2,0,255)-o)/i,n.deltaColor.a=(Ee(u.a+h.a*(Math.random()-.5)*2,0,255)-s)/i;var f=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(f=Math.max(0,f),n.size=f,-1===e.endSize)n.deltaSize=0;else{var _=e.endSize+e.endSizeVar*(Math.random()-.5)*2;_=Math.max(0,_),n.deltaSize=(_-f)/i}var d=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,p=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;n.rotation=d,n.deltaRotation=(p-d)/i,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=e.aspectRatio||1;var m=Ae(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===dtt.GRAVITY){var g=e.speed+e.speedVar*(Math.random()-.5)*2;n.dir.x=Math.cos(m),n.dir.y=Math.sin(m),n.dir.multiplyScalar(g),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-Ce(Math.atan2(n.dir.y,n.dir.x)))}else{var v=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,y=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;n.radius=v,n.deltaRadius=-1===e.endRadius?0:(y-v)/i,n.angle=m,n.degreesPerSecond=Ae(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var n=e.vData,i=this.sys._renderSpriteFrame.uv,r=t?0:this.uvFilled,a=this.particles.length,o=r;o<a;o++){var s=o*Ttt*4;n[s+3]=i[0],n[s+4]=i[1],n[s+12]=i[2],n[s+13]=i[3],n[s+21]=i[4],n[s+22]=i[5],n[s+30]=i[6],n[s+31]=i[7]}this.uvFilled=a}},e.updateParticleBuffer=function(t,e,n,i){var r=n.vData,a=e.x,o=e.y,s=t.size,c=s,l=t.aspectRatio;l>1?c=s/l:s=c*l;var u=s/2,h=c/2;if(t.rotation){var f=-u,_=-h,d=u,p=h,m=-Ae(t.rotation),g=Math.cos(m),v=Math.sin(m);r[i]=f*g-_*v+a,r[i+1]=f*v+_*g+o,r[i+2]=0,r[i+9]=d*g-_*v+a,r[i+10]=d*v+_*g+o,r[i+11]=0,r[i+18]=f*g-p*v+a,r[i+19]=f*v+p*g+o,r[i+20]=0,r[i+27]=d*g-p*v+a,r[i+28]=d*v+p*g+o,r[i+29]=0}else r[i]=a-u,r[i+1]=o-h,r[i+2]=0,r[i+9]=a+u,r[i+10]=o-h,r[i+11]=0,r[i+18]=a-u,r[i+19]=o+h,r[i+20]=0,r[i+27]=a+u,r[i+28]=o+h,r[i+29]=0;Pn.toArray(r,t.color,i+5),Pn.toArray(r,t.color,i+14),Pn.toArray(r,t.color,i+23),Pn.toArray(r,t.color,i+32)},e.step=function(t){var e=this.sys.assembler,n=this.sys,i=n.node,r=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,i.updateWorldTransform(),n.positionType===ptt.FREE){this._worldRotation=function(t){for(var e=0,n=t;n;)e+=n.eulerAngles.z,n=n.parent;return e}(i);var a=i.worldMatrix;gtt.x=a.m12,gtt.y=a.m13}else n.positionType===ptt.RELATIVE?(this._worldRotation=i.eulerAngles.z,gtt.x=i.position.x,gtt.y=i.position.y):this._worldRotation=0;if(this.active&&n.emissionRate){var o=1/n.emissionRate;for(r.length<n.totalParticles&&(this.emitCounter+=t);r.length<n.totalParticles&&this.emitCounter>o;)this.emitParticle(gtt),this.emitCounter-=o;this.elapsed+=t,-1!==n.duration&&n.duration<this.elapsed&&n.stopSystem()}var s=this.renderData,c=r.length;s.reset(),this.requestData(4*c,6*c),c>this.uvFilled&&this.updateUVs();for(var l=0;l<r.length;){vtt.x=vtt.y=ytt.x=ytt.y=Stt.x=Stt.y=0;var u=r[l];if(u.timeToLive-=t,u.timeToLive>0){if(n.emitterMode===dtt.GRAVITY){var h=Stt,f=vtt,_=ytt;(u.pos.x||u.pos.y)&&(f.set(u.pos),f.normalize()),_.set(f),f.multiplyScalar(u.radialAccel);var d=_.x;_.x=-_.y,_.y=d,_.multiplyScalar(u.tangentialAccel),h.set(f),h.add(_),h.add(n.gravity),h.multiplyScalar(t),u.dir.add(h),h.set(u.dir),h.multiplyScalar(t),u.pos.add(h)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var p=vtt;p.set(u.pos),n.positionType!==ptt.GROUPED&&p.add(u.startPos);var m=Ttt*l*4;this.updateParticleBuffer(u,p,s,m),++l}else{var g=r[l];l!==r.length-1&&(r[l]=r[r.length-1]),Ett.put(g),r.length--,s.resize(s.vertexCount-4,s.indexCount-6)}}0!==r.length||this.active||this.readyToPlay||(this.finished=!0,n._finishedSimulation())},e.requestData=function(t,e){var n=this.renderData.indexCount;this.renderData.request(t,e);for(var i=this.renderData.indexCount/6,r=this.renderData.iData,a=n;a<i;a++){var o=4*a;r[n++]=o,r[n++]=o+1,r[n++]=o+2,r[n++]=o+1,r[n++]=o+3,r[n++]=o+2}},t}(),Ctt=t("ParticleAsset",Ec("cc.ParticleAsset")((_tt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"spriteFrame",ftt,rt(e)),e}return Z(e,t),e}(Du),ftt=ct((htt=_tt).prototype,"spriteFrame",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),utt=htt))||utt);l.ParticleAsset=Ctt;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var btt={};(function(){function t(t){throw t}var e=void 0,n=!0,i=this;function r(t,n){var r,a=t.split("."),o=i;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(r=a.shift());)a.length||n===e?o=o[r]?o[r]:o[r]={}:o[r]=n}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function o(t){if("string"==typeof t){var e,n,i=t.split("");for(e=0,n=i.length;e<n;e++)i[e]=(255&i[e].charCodeAt(0))>>>0;t=i}for(var r,a=1,o=0,s=t.length,c=0;0<s;){s-=r=1024<s?1024:s;do{o+=a+=t[c++]}while(--r);a%=65521,o%=65521}return(o<<16|a)>>>0}function s(e,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var t,e=this.buffer,n=e.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(e);else for(t=0;t<n;++t)i[t]=e[t];return this.buffer=i},s.prototype.d=function(t,e,n){var i,r=this.buffer,a=this.index,o=this.i,s=r[a];if(n&&1<e&&(t=8<e?(_[255&t]<<24|_[t>>>8&255]<<16|_[t>>>16&255]<<8|_[t>>>24&255])>>32-e:_[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(i=0;i<e;++i)s=s<<1|t>>e-i-1&1,8==++o&&(o=0,r[a++]=_[s],s=0,a===r.length&&(r=this.f()));r[a]=s,this.buffer=r,this.i=o,this.index=a},s.prototype.finish=function(){var t,e=this.buffer,n=this.index;return 0<this.i&&(e[n]<<=8-this.i,e[n]=_[e[n]],n++),a?t=e.subarray(0,n):(e.length=n,t=e),t};var c,l=new(a?Uint8Array:Array)(256);for(c=0;256>c;++c){for(var u=f=c,h=7,f=f>>>1;f;f>>>=1)u<<=1,u|=1&f,--h;l[c]=(u<<h&255)>>>0}var _=l;function d(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function p(t){var e,n,i,r,o,s,c,l,u,h=t.length,f=0,_=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)t[l]>f&&(f=t[l]),t[l]<_&&(_=t[l]);for(e=1<<f,n=new(a?Uint32Array:Array)(e),i=1,r=0,o=2;i<=f;){for(l=0;l<h;++l)if(t[l]===i){for(s=0,c=r,u=0;u<i;++u)s=s<<1|1&c,c>>=1;for(u=s;u<e;u+=o)n[u]=i<<16|l;++r}++i,r<<=1,o<<=1}return[n,f,_]}function m(t,e){this.h=v,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}d.prototype.getParent=function(t){return 2*((t-2)/4|0)},d.prototype.push=function(t,e){var n,i,r,a=this.buffer;for(n=this.length,a[this.length++]=e,a[this.length++]=t;0<n&&(i=this.getParent(n),a[n]>a[i]);)r=a[n],a[n]=a[i],a[i]=r,r=a[n+1],a[n+1]=a[i+1],a[i+1]=r,n=i;return this.length},d.prototype.pop=function(){var t,e,n,i,r,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],r=0;!((i=2*r+2)>=this.length)&&(i+2<this.length&&a[i+2]>a[i]&&(i+=2),a[i]>a[r]);)n=a[r],a[r]=a[i],a[i]=n,n=a[r+1],a[r+1]=a[i+1],a[i+1]=n,r=i;return{index:t,value:e,length:this.length}};var g,v=2,y={NONE:0,r:1,j:v,N:3},S=[];for(g=0;288>g;g++)switch(n){case 143>=g:S.push([g+48,8]);break;case 255>=g:S.push([g-144+400,9]);break;case 279>=g:S.push([g-256+0,7]);break;case 287>=g:S.push([g-280+192,8]);break;default:t("invalid literal: "+g)}function T(t,e){this.length=t,this.G=e}function x(){var e=E;switch(n){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var i,r,o,c,l=this.input;switch(this.h){case 0:for(o=0,c=l.length;o<c;){var u,h,f,_=r=a?l.subarray(o,o+65535):l.slice(o,o+65535),d=(o+=r.length)===c,p=e,m=e,g=this.a,y=this.b;if(a){for(g=new Uint8Array(this.a.buffer);g.length<=y+_.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(u=d?1:0,g[y++]=0|u,f=65536+~(h=_.length)&65535,g[y++]=255&h,g[y++]=h>>>8&255,g[y++]=255&f,g[y++]=f>>>8&255,a)g.set(_,y),y+=_.length,g=g.subarray(0,y);else{for(p=0,m=_.length;p<m;++p)g[y++]=_[p];g.length=y}this.b=y,this.a=g}break;case 1:var T=new s(new Uint8Array(this.a.buffer),this.b);T.d(1,1,n),T.d(1,2,n);var x,E,A,C=w(this,l);for(x=0,E=C.length;x<E;x++)if(A=C[x],s.prototype.d.apply(T,S[A]),256<A)T.d(C[++x],C[++x],n),T.d(C[++x],5),T.d(C[++x],C[++x],n);else if(256===A)break;this.a=T.finish(),this.b=this.a.length;break;case v:var b,R,D,O,N,M,L,F,B,z,U,k,G,V,H,W=new s(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=Array(19);for(b=v,W.d(1,1,n),W.d(b,2,n),R=w(this,l),L=P(M=I(this.L,15)),B=P(F=I(this.K,7)),D=286;257<D&&0===M[D-1];D--);for(O=30;1<O&&0===F[O-1];O--);var q,Y,K,Q,J,Z,$=D,tt=O,et=new(a?Uint32Array:Array)($+tt),nt=new(a?Uint32Array:Array)(316),it=new(a?Uint8Array:Array)(19);for(q=Y=0;q<$;q++)et[Y++]=M[q];for(q=0;q<tt;q++)et[Y++]=F[q];if(!a)for(q=0,Q=it.length;q<Q;++q)it[q]=0;for(q=J=0,Q=et.length;q<Q;q+=Y){for(Y=1;q+Y<Q&&et[q+Y]===et[q];++Y);if(K=Y,0===et[q])if(3>K)for(;0<K--;)nt[J++]=0,it[0]++;else for(;0<K;)(Z=138>K?K:138)>K-3&&Z<K&&(Z=K-3),10>=Z?(nt[J++]=17,nt[J++]=Z-3,it[17]++):(nt[J++]=18,nt[J++]=Z-11,it[18]++),K-=Z;else if(nt[J++]=et[q],it[et[q]]++,3>--K)for(;0<K--;)nt[J++]=et[q],it[et[q]]++;else for(;0<K;)(Z=6>K?K:6)>K-3&&Z<K&&(Z=K-3),nt[J++]=16,nt[J++]=Z-3,it[16]++,K-=Z}for(i=a?nt.subarray(0,J):nt.slice(0,J),z=I(it,7),V=0;19>V;V++)X[V]=z[j[V]];for(N=19;4<N&&0===X[N-1];N--);for(U=P(z),W.d(D-257,5,n),W.d(O-1,5,n),W.d(N-4,4,n),V=0;V<N;V++)W.d(X[V],3,n);for(V=0,H=i.length;V<H;V++)if(k=i[V],W.d(U[k],z[k],n),16<=k){switch(V++,k){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:t("invalid code: "+k)}W.d(i[V],G,n)}var rt,at,ot,st,ct,lt,ut,ht,ft=[L,M],_t=[B,F];for(ct=ft[0],lt=ft[1],ut=_t[0],ht=_t[1],rt=0,at=R.length;rt<at;++rt)if(ot=R[rt],W.d(ct[ot],lt[ot],n),256<ot)W.d(R[++rt],R[++rt],n),st=R[++rt],W.d(ut[st],ht[st],n),W.d(R[++rt],R[++rt],n);else if(256===ot)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var E,A,C=[];for(E=3;258>=E;E++)A=x(),C[E]=A[2]<<24|A[1]<<16|A[0];var b=a?new Uint32Array(C):C;function w(i,r){function o(e,i){var r,a,o,s,c=e.G,l=[],u=0;switch(r=b[e.length],l[u++]=65535&r,l[u++]=r>>16&255,l[u++]=r>>24,n){case 1===c:a=[0,c-1,0];break;case 2===c:a=[1,c-2,0];break;case 3===c:a=[2,c-3,0];break;case 4===c:a=[3,c-4,0];break;case 6>=c:a=[4,c-5,1];break;case 8>=c:a=[5,c-7,1];break;case 12>=c:a=[6,c-9,2];break;case 16>=c:a=[7,c-13,2];break;case 24>=c:a=[8,c-17,3];break;case 32>=c:a=[9,c-25,3];break;case 48>=c:a=[10,c-33,4];break;case 64>=c:a=[11,c-49,4];break;case 96>=c:a=[12,c-65,5];break;case 128>=c:a=[13,c-97,5];break;case 192>=c:a=[14,c-129,6];break;case 256>=c:a=[15,c-193,6];break;case 384>=c:a=[16,c-257,7];break;case 512>=c:a=[17,c-385,7];break;case 768>=c:a=[18,c-513,8];break;case 1024>=c:a=[19,c-769,8];break;case 1536>=c:a=[20,c-1025,9];break;case 2048>=c:a=[21,c-1537,9];break;case 3072>=c:a=[22,c-2049,10];break;case 4096>=c:a=[23,c-3073,10];break;case 6144>=c:a=[24,c-4097,11];break;case 8192>=c:a=[25,c-6145,11];break;case 12288>=c:a=[26,c-8193,12];break;case 16384>=c:a=[27,c-12289,12];break;case 24576>=c:a=[28,c-16385,13];break;case 32768>=c:a=[29,c-24577,13];break;default:t("invalid distance")}for(r=a,l[u++]=r[0],l[u++]=r[1],l[u++]=r[2],o=0,s=l.length;o<s;++o)g[v++]=l[o];S[l[0]]++,x[l[3]]++,y=e.length+i-1,d=null}var s,c,l,u,h,f,_,d,p,m={},g=a?new Uint16Array(2*r.length):[],v=0,y=0,S=new(a?Uint32Array:Array)(286),x=new(a?Uint32Array:Array)(30),E=i.w;if(!a){for(l=0;285>=l;)S[l++]=0;for(l=0;29>=l;)x[l++]=0}for(S[256]=1,s=0,c=r.length;s<c;++s){for(l=h=0,u=3;l<u&&s+l!==c;++l)h=h<<8|r[s+l];if(m[h]===e&&(m[h]=[]),f=m[h],!(0<y--)){for(;0<f.length&&32768<s-f[0];)f.shift();if(s+3>=c){for(d&&o(d,-1),l=0,u=c-s;l<u;++l)p=r[s+l],g[v++]=p,++S[p];break}if(0<f.length){var A=e,C=e,w=0,I=e,P=e,R=e,D=r.length,O=(P=0,f.length);t:for(;P<O;P++){if(A=f[O-P-1],I=3,3<w){for(R=w;3<R;R--)if(r[A+R-1]!==r[s+R-1])continue t;I=w}for(;258>I&&s+I<D&&r[A+I]===r[s+I];)++I;if(I>w&&(C=A,w=I),258===I)break}_=new T(w,s-C),d?d.length<_.length?(p=r[s-1],g[v++]=p,++S[p],o(_,0)):o(d,-1):_.length<E?d=_:o(_,0)}else d?o(d,-1):(p=r[s],g[v++]=p,++S[p])}f.push(s)}return g[v++]=256,S[256]++,i.L=S,i.K=x,a?g.subarray(0,v):g}function I(t,e){function n(t){var e=E[t][A[t]];e===v?(n(t+1),n(t+1)):--T[e],++A[t]}var i,r,o,s,c,l=t.length,u=new d(572),h=new(a?Uint8Array:Array)(l);if(!a)for(s=0;s<l;s++)h[s]=0;for(s=0;s<l;++s)0<t[s]&&u.push(s,t[s]);if(i=Array(u.length/2),r=new(a?Uint32Array:Array)(u.length/2),1===i.length)return h[u.pop().index]=1,h;for(s=0,c=u.length/2;s<c;++s)i[s]=u.pop(),r[s]=i[s].value;var f,_,p,m,g,v=r.length,y=new(a?Uint16Array:Array)(e),S=new(a?Uint8Array:Array)(e),T=new(a?Uint8Array:Array)(v),x=Array(e),E=Array(e),A=Array(e),C=(1<<e)-v,b=1<<e-1;for(y[e-1]=v,_=0;_<e;++_)C<b?S[_]=0:(S[_]=1,C-=b),C<<=1,y[e-2-_]=(y[e-1-_]/2|0)+v;for(y[0]=S[0],x[0]=Array(y[0]),E[0]=Array(y[0]),_=1;_<e;++_)y[_]>2*y[_-1]+S[_]&&(y[_]=2*y[_-1]+S[_]),x[_]=Array(y[_]),E[_]=Array(y[_]);for(f=0;f<v;++f)T[f]=e;for(p=0;p<y[e-1];++p)x[e-1][p]=r[p],E[e-1][p]=p;for(f=0;f<e;++f)A[f]=0;for(1===S[e-1]&&(--T[0],++A[e-1]),_=e-2;0<=_;--_){for(m=f=0,g=A[_+1],p=0;p<y[_];p++)(m=x[_+1][g]+x[_+1][g+1])>r[f]?(x[_][p]=m,E[_][p]=v,g+=2):(x[_][p]=r[f],E[_][p]=f,++f);A[_]=0,1===S[_]&&n(_)}for(o=T,s=0,c=i.length;s<c;++s)h[i[s].index]=o[s];return h}function P(e){var n,i,r,o,s=new(a?Uint16Array:Array)(e.length),c=[],l=[],u=0;for(n=0,i=e.length;n<i;n++)c[e[n]]=1+(0|c[e[n]]);for(n=1,i=16;n<=i;n++)l[n]=u,(u+=0|c[n])>1<<n&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),n=0,i=e.length;n<i;n++)for(u=l[e[n]],l[e[n]]+=1,r=s[n]=0,o=e[n];r<o;r++)s[n]=s[n]<<1|1&u,u>>>=1;return s}function R(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=D.j;var n,i={};for(n in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)i[n]=e[n];i.outputBuffer=this.a,this.z=new m(this.input,i)}var D=y;function O(e,n){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.m=M,this.B=!1,!n&&(n={})||(n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize)),this.m){case N:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.l+258);break;case M:this.b=0,this.a=new(a?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}R.prototype.n=function(){var e,n,i,r,s,c,l,u=0;switch(l=this.a,e=ut){case ut:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=n<<4|e,l[u++]=i,e){case ut:switch(this.h){case D.NONE:s=0;break;case D.r:s=1;break;case D.j:s=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return r=s<<6|0,l[u++]=r|31-(256*i+r)%31,c=o(this.input),this.z.b=u,u=(l=this.z.n()).length,a&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=c>>24&255,l[u++]=c>>16&255,l[u++]=c>>8&255,l[u++]=255&c,l},r("Zlib.Deflate",R),r("Zlib.Deflate.compress",(function(t,e){return new R(t,e).n()})),r("Zlib.Deflate.CompressionType",D),r("Zlib.Deflate.CompressionType.NONE",D.NONE),r("Zlib.Deflate.CompressionType.FIXED",D.r),r("Zlib.Deflate.CompressionType.DYNAMIC",D.j);var N=0,M=1,L={D:N,C:M};O.prototype.p=function(){for(;!this.s;){var i=tt(this,3);switch(1&i&&(this.s=n),i>>>=1){case 0:var r=this.input,o=this.c,s=this.a,c=this.b,l=e,u=e,h=e,f=s.length,_=e;switch(this.e=this.g=0,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),u=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),u|=l<<8,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),h=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(h|=l<<8)&&t(Error("invalid uncompressed block header: length verify")),o+u>r.length&&t(Error("input buffer is broken")),this.m){case N:for(;c+u>s.length;){if(u-=_=f-c,a)s.set(r.subarray(o,o+_),c),c+=_,o+=_;else for(;_--;)s[c++]=r[o++];this.b=c,s=this.f(),c=this.b}break;case M:for(;c+u>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(r.subarray(o,o+u),c),c+=u,o+=u;else for(;u--;)s[c++]=r[o++];this.c=o,this.b=c,this.a=s;break;case 1:this.o(J,$);break;case 2:nt(this);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var F,B,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],U=a?new Uint16Array(z):z,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=a?new Uint16Array(k):k,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=a?new Uint8Array(V):V,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],j=a?new Uint16Array(W):W,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q=a?new Uint8Array(X):X,Y=new(a?Uint8Array:Array)(288);for(F=0,B=Y.length;F<B;++F)Y[F]=143>=F?8:255>=F?9:279>=F?7:8;var K,Q,J=p(Y),Z=new(a?Uint8Array:Array)(30);for(K=0,Q=Z.length;K<Q;++K)Z[K]=5;var $=p(Z);function tt(n,i){for(var r,a=n.g,o=n.e,s=n.input,c=n.c;o<i;)(r=s[c++])===e&&t(Error("input buffer is broken")),a|=r<<o,o+=8;return r=a&(1<<i)-1,n.g=a>>>i,n.e=o-i,n.c=c,r}function et(n,i){for(var r,a,o,s=n.g,c=n.e,l=n.input,u=n.c,h=i[0],f=i[1];c<f;)(r=l[u++])===e&&t(Error("input buffer is broken")),s|=r<<c,c+=8;return o=(a=h[s&(1<<f)-1])>>>16,n.g=s>>o,n.e=c-o,n.c=u,65535&a}function nt(t){function e(t,e,n){var i,r,a,o;for(o=0;o<t;)switch(i=et(this,e)){case 16:for(a=3+tt(this,2);a--;)n[o++]=r;break;case 17:for(a=3+tt(this,3);a--;)n[o++]=0;r=0;break;case 18:for(a=11+tt(this,7);a--;)n[o++]=0;r=0;break;default:r=n[o++]=i}return n}var n,i,r,o,s=tt(t,5)+257,c=tt(t,5)+1,l=tt(t,4)+4,u=new(a?Uint8Array:Array)(U.length);for(o=0;o<l;++o)u[U[o]]=tt(t,3);n=p(u),i=new(a?Uint8Array:Array)(s),r=new(a?Uint8Array:Array)(c),t.o(p(e.call(t,s,n,i)),p(e.call(t,c,n,r)))}function it(e,n){var i,r;switch(this.input=e,this.c=0,!n&&(n={})||(n.index&&(this.c=n.index),n.verify&&(this.M=n.verify)),i=e[this.c++],r=e[this.c++],15&i){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+r)%31&&t(Error("invalid fcheck flag:"+((i<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new O(e,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}O.prototype.o=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length-258;256!==(r=et(this,t));)if(256>r)i>=c&&(this.b=i,n=this.f(),i=this.b),n[i++]=r;else for(s=G[a=r-257],0<H[a]&&(s+=tt(this,H[a])),r=et(this,e),o=j[r],0<q[r]&&(o+=tt(this,q[r])),i>=c&&(this.b=i,n=this.f(),i=this.b);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},O.prototype.I=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length;256!==(r=et(this,t));)if(256>r)i>=c&&(c=(n=this.f()).length),n[i++]=r;else for(s=G[a=r-257],0<H[a]&&(s+=tt(this,H[a])),r=et(this,e),o=j[r],0<q[r]&&(o+=tt(this,q[r])),i+s>c&&(c=(n=this.f()).length);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},O.prototype.f=function(){var t,e,n=new(a?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.a;if(a)n.set(r.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=r[t+32768];if(this.k.push(n),this.q+=n.length,a)r.set(r.subarray(i,i+32768));else for(t=0;32768>t;++t)r[t]=r[i+t];return this.b=32768,r},O.prototype.J=function(t){var e,n,i,r=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),n=2>r?(i=(o.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+i:s.length<<1:s.length*r,a?(e=new Uint8Array(n)).set(s):e=s,this.a=e},O.prototype.t=function(){var t,e,n,i,r,o=0,s=this.a,c=this.k,l=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,n=c.length;e<n;++e)for(i=0,r=(t=c[e]).length;i<r;++i)l[o++]=t[i];for(e=32768,n=this.b;e<n;++e)l[o++]=s[e];return this.k=[],this.buffer=l},O.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},it.prototype.p=function(){var e,n=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==o(e)&&t(Error("invalid adler-32 checksum")),e},r("Zlib.Inflate",it),r("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,r("Zlib.Inflate.prototype.decompress",it.prototype.p);var rt,at,ot=new(a?Uint8Array:Array)(288);for(rt=0,at=ot.length;rt<at;++rt)ot[rt]=143>=rt?8:255>=rt?9:279>=rt?7:8;p(ot);var st,ct,lt=new(a?Uint8Array:Array)(30);for(st=0,ct=lt.length;st<ct;++st)lt[st]=5;p(lt);var ut=8}).call(btt);var wtt=btt.Zlib;wtt.Deflate=wtt.Deflate,wtt.Deflate.compress=wtt.Deflate.compress,wtt.Inflate=wtt.Inflate,wtt.Inflate.BufferType=wtt.Inflate.BufferType,wtt.Inflate.prototype.decompress=wtt.Inflate.prototype.decompress;for(var Itt=function(){function t(t){var e,n=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var i=0,r=0,a=0;;){a=this.readUInt32();var o=function(){var t=[];for(i=0;i<4;++i)t.push(String.fromCharCode(n.data[n.pos++]));return t}.call(this).join("");switch(o){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var s=this.readUInt16(),c=this.readUInt16()||100;e.delay=1e3*s/c,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===o&&(this.pos+=4,a-=4),t=(null!=e?e.data:void 0)||this.imgData,i=0;a>=0?i<a:i>a;a>=0?++i:--i)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(a);var l=255-this.transparency.indexed.length;if(l>0)for(r=0;l>=0?r<l:r>l;l>=0?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":var u=this.read(a),h=u.indexOf(0),f=String.fromCharCode.apply(String,u.slice(0,h));this.text[f]=String.fromCharCode.apply(String,u.slice(h+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(n.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var _=this.colorType;this.hasAlphaChannel=4===_||6===_;var d=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*d,this.colorSpace=function(){switch(n.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error(F(6017))}}var e=t.prototype;return e.read=function(t){var e=0,n=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)n.push(this.data[this.pos++]);return n},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new wtt.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,n=e*this.width,i=new Uint8Array(n*this.height),r=t.length,a=0,o=0,s=0,c=0,l=0,u=0,h=0,f=0,_=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,T=0,x=0,E=0;o<r;){switch(t[o++]){case 0:for(u=h=0;h<n;u=h+=1)i[s++]=t[o++];break;case 1:for(u=f=0;f<n;u=f+=1)c=t[o++],m=u<e?0:i[s-e],i[s++]=(c+m)%256;break;case 2:for(u=_=0;_<n;u=_+=1)c=t[o++],l=(u-u%e)/e,x=a&&i[(a-1)*n+l*e+u%e],i[s++]=(x+c)%256;break;case 3:for(u=d=0;d<n;u=d+=1)c=t[o++],l=(u-u%e)/e,m=u<e?0:i[s-e],x=a&&i[(a-1)*n+l*e+u%e],i[s++]=(c+Math.floor((m+x)/2))%256;break;case 4:for(u=p=0;p<n;u=p+=1)c=t[o++],l=(u-u%e)/e,m=u<e?0:i[s-e],0===a?x=E=0:(x=i[(a-1)*n+l*e+u%e],E=l&&i[(a-1)*n+(l-1)*e+u%e]),g=m+x-E,v=Math.abs(g-m),S=Math.abs(g-x),T=Math.abs(g-E),y=v<=S&&v<=T?m:S<=T?x:E,i[s++]=(c+y)%256;break;default:throw new Error(F(6018,t[o-1]))}a++}return i},e.copyToImageData=function(t,e){var n,i=this.hasAlphaChannel,r=this.colors;this.palette.length&&(n=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,i=!0);var a=t.data||t,o=a.length,s=n||e,c=0,l=0,u=0,h=0;if(1===r)for(;c<o;)u=n?4*e[c/4]:l,h=s[u++],a[c++]=h,a[c++]=h,a[c++]=h,a[c++]=i?s[u++]:255,l=u;else for(;c<o;)u=n?4*e[c/4]:l,a[c++]=s[u++],a[c++]=s[u++],a[c++]=s[u++],a[c++]=i?s[u++]:255,l=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],n=new Uint8Array((e.length||0)+t.length),i=0,r=0,a=0,o=0,s=0,c=t.length;s<c;o=s+=3)n[i++]=t[o],n[i++]=t[o+1],n[i++]=t[o+2],a=e[r++],n[i++]=null!=a?a:255;return n},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),n=e.createImageData(this.width,this.height);return this.copyToImageData(n,this.decodePixels(null)),e.putImageData(n,0,0)},t}(),Ptt=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(F(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(F(6020));return!0},e.getFieldTypeName=function(t){return t in Dtt?Dtt[t]:null},e.getFieldTagName=function(t){return t in Rtt?Rtt[t]:(I(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,n,i){var r=[],a=this.getFieldTypeLength(e);if(a*n<=4)!1===this._littleEndian?r.push(i>>>8*(4-a)):r.push(i);else for(var o=0;o<n;o++){var s=a*o;a>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(i+s)),r.push(this.getUint32(i+s+4))):I(8e3):r.push(this.getBytes(a,i+s))}return"ASCII"===e&&r.forEach((function(t,e,n){n[e]=String.fromCharCode(t)})),r},e.getBytes=function(t,e){if(t<=0)I(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);I(8002)}return 0},e.getBits=function(t,e,n){n=n||0;var i=e+Math.floor(n/8),r=n+t,a=32-t,o=0,s=0;return r<=0?I(6023):r<=8?(o=24+n,s=this.getUint8(i)):r<=16?(o=16+n,s=this.getUint16(i)):r<=32?(o=n,s=this.getUint32(i)):I(6022),{bits:s<<o>>>a,byteOffset:i+Math.floor(r/8),bitOffset:r%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),n=[],i=0,r=0;for(i=t+2,r=0;r<e;i+=12,r++){var a=this.getUint16(i),o=this.getUint16(i+2),s=this.getUint32(i+4),c=this.getUint32(i+8),l=this.getFieldTagName(a),u=this.getFieldTypeName(o),h=this.getFieldValues(l,u,s,c);n[l]={type:u,values:h}}this._fileDirectories.push(n);var f=this.getUint32(i);0!==f&&this.parseFileDirectory(f)},e.clampColorSample=function(t,e){var n=Math.pow(2,8-e);return Math.floor(t*n+(n-1))},e.parseTIFF=function(t,e){var n=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var r=this._fileDirectories[0],a=r.ImageWidth.values[0],o=r.ImageLength.values[0];this._canvas.width=a,this._canvas.height=o;var s=[],c=r.Compression?r.Compression.values[0]:1,l=r.SamplesPerPixel.values[0],u=[],h=0,f=!1;r.BitsPerSample.values.forEach((function(t,e){u[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[e].hasBytesPerSample=!0,u[e].bytesPerSample=t/8),h+=t}),this);var _=0;h%8==0&&(f=!0,_=h/8);var d,p=r.StripOffsets.values,m=p.length;if(r.StripByteCounts)d=r.StripByteCounts.values;else{if(I(8003),1!==m)throw Error(F(6024));d=[Math.ceil(a*o*h/8)]}for(var g=1,v=1,y=0;y<m;y++){var S=p[y];s[y]=[];for(var T=d[y],x=0,E=0,A=1,C=!0,b=[],w=0,P=0,R=0;x<T;x+=A)switch(c){case 1:b=[];for(var D=0;D<l;D++){var O=u[D];if(!O.hasBytesPerSample){var N=this.getBits(O.bitsPerSample,S+x,E);throw b.push(N.bits),x=N.byteOffset-S,E=N.bitOffset,RangeError(F(6025))}var M=O.bytesPerSample*D;b.push(this.getBytes(O.bytesPerSample,S+x+M))}if(s[y].push(b),!f)throw A=0,RangeError(F(6026));A=_;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var L=this.getUint8(S+x);L>=0&&L<=127?g=L+1:L>=-127&&L<=-1?v=1-L:C=!0}else{for(var B=this.getUint8(S+x),z=0;z<v;z++){var U=u[P];if(!U.hasBytesPerSample)throw RangeError(F(6025));R=R<<8*w|B,++w===U.bytesPerSample&&(b.push(R),R=w=0,P++),P===l&&(s[y].push(b),b=[],P=0)}0==--g&&(C=!0)}A=1}}if(e.getContext){var k=this._canvas.getContext("2d");k.fillStyle="rgba(255, 255, 255, 0)";var G=r.RowsPerStrip?r.RowsPerStrip.values[0]:o,V=s.length,H=o%G,W=0===H?G:H,j=G,X=0,q=r.PhotometricInterpretation.values[0],Y=[],K=0;r.ExtraSamples&&(K=(Y=r.ExtraSamples.values).length);var Q=[],J=0;r.ColorMap&&(Q=r.ColorMap.values,J=Math.pow(2,u[0].bitsPerSample));for(var Z=0;Z<V;Z++){Z+1===V&&(j=W);for(var $=s[Z].length,tt=X*Z,et=0,nt=0;et<j&&nt<$;et++)for(var it=0;it<a;it++,nt++){var rt=s[Z][nt],at=0,ot=0,st=0,ct=1;if(K>0)for(var lt=0;lt<K;lt++)if(1===Y[lt]||2===Y[lt]){ct=rt[3+lt]/256;break}!function(){switch(q){case 0:var t=0;u[0].hasBytesPerSample&&(t=Math.pow(16,2*u[0].bytesPerSample)),rt.forEach((function(e,n,i){i[n]=t-e}));case 1:at=ot=st=n.clampColorSample(rt[0],u[0].bitsPerSample);break;case 2:at=n.clampColorSample(rt[0],u[0].bitsPerSample),ot=n.clampColorSample(rt[1],u[1].bitsPerSample),st=n.clampColorSample(rt[2],u[2].bitsPerSample);break;case 3:if(void 0===Q)throw Error(F(6027));var e=rt[0];at=n.clampColorSample(Q[e],16),ot=n.clampColorSample(Q[J+e],16),st=n.clampColorSample(Q[2*J+e],16);break;default:throw RangeError(F(6028,q))}}(),k.fillStyle="rgba("+at+", "+ot+", "+st+", "+ct+")",k.fillRect(it,tt+et,1,1)}X=j}}return this._canvas}},t}(),Rtt={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},Dtt={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},Ott=new Array(123),Ntt=0;Ntt<123;++Ntt)Ott[Ntt]=64;for(var Mtt=0;Mtt<64;++Mtt)Ott["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Mtt)]=Mtt;var Ltt={name:"Jacob__Codec__Base64",decode:function(t){var e,n,i,r,a,o,s=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=Ott[t.charCodeAt(c++)]<<2|(r=Ott[t.charCodeAt(c++)])>>4,n=(15&r)<<4|(a=Ott[t.charCodeAt(c++)])>>2,i=(3&a)<<6|(o=Ott[t.charCodeAt(c++)]),s.push(String.fromCharCode(e)),64!==a&&s.push(String.fromCharCode(n)),64!==o&&s.push(String.fromCharCode(i));return s.join("")},decodeAsArray:function(t,e){var n,i,r,a=this.decode(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o}},Ftt=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(Ftt.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};Ftt.gunzip=function(t){return t.constructor===Array||t.constructor,new Ftt(t).gunzip()[0][0]},Ftt.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},Ftt.LITERALS=288,Ftt.NAMEMAX=256,Ftt.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],Ftt.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ftt.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Ftt.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Ftt.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ftt.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ftt.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},Ftt.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},Ftt.prototype.byteAlign=function(){this.bb=1},Ftt.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},Ftt.prototype.readBits=function(t){for(var e=0,n=t;n--;)e=e<<1|this.readBit();return t&&(e=Ftt.bitReverse[e]>>8-t),e},Ftt.prototype.flushBuffer=function(){this.bIdx=0},Ftt.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},Ftt.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},Ftt.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},Ftt.prototype.CreateTree=function(t,e,n){var i;for(this.Places=t,this.treepos=0,this.flens=n,this.fmax=e,i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},Ftt.prototype.DecodeValue=function(t){for(var e,n,i=0,r=t[i];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,n=0;n<e;n++)if(t[n]===r){i=n;break}}else{if(!(32768&r.b0))return r.b0;r=t[++i]}return-1},Ftt.prototype.DeflateLoop=function(){var t,e,n;do{var i,r;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),i=this.readByte(),i|=this.readByte()<<8,r=this.readByte(),65535&(i^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");i--;)a=this.readByte(),this.addBuffer(a);else if(1===e)for(;;)if((o=Ftt.bitReverse[this.readBits(7)]>>1)>23?(o=o<<1|this.readBit())>199?o=(o-=128)<<1|this.readBit():(o-=48)>143&&(o+=136):o+=256,o<256)this.addBuffer(o);else{if(256===o)break;for(o-=257,d=this.readBits(Ftt.cplext[o])+Ftt.cplens[o],o=Ftt.bitReverse[this.readBits(5)]>>3,Ftt.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Ftt.cpdext[o]-8)<<8):p=this.readBits(Ftt.cpdext[o]),p+=Ftt.cpdist[o],o=0;o<d;o++){var a=this.buf32k[this.bIdx-p&32767];this.addBuffer(a)}}else if(2===e){var o,s,c,l,u,h=new Array(320);for(c=257+this.readBits(5),l=1+this.readBits(5),u=4+this.readBits(4),o=0;o<19;o++)h[o]=0;for(o=0;o<u;o++)h[Ftt.border[o]]=this.readBits(3);for(d=this.distanceTree.length,n=0;n<d;n++)this.distanceTree[n]=new Ftt.HufNode;if(this.CreateTree(this.distanceTree,19,h,0))return this.flushBuffer(),1;for(s=c+l,n=0;n<s;)if((o=this.DecodeValue(this.distanceTree))<16)h[n++]=o;else if(16===o){var f;if(n+(o=3+this.readBits(2))>s)return this.flushBuffer(),1;for(f=n?h[n-1]:0;o--;)h[n++]=f}else{if(n+(o=17===o?3+this.readBits(3):11+this.readBits(7))>s)return this.flushBuffer(),1;for(;o--;)h[n++]=0}for(d=this.literalTree.length,n=0;n<d;n++)this.literalTree[n]=new Ftt.HufNode;if(this.CreateTree(this.literalTree,c,h,0))return this.flushBuffer(),1;for(d=this.literalTree.length,n=0;n<d;n++)this.distanceTree[n]=new Ftt.HufNode;var _=new Array;for(n=c;n<h.length;n++)_[n-c]=h[n];if(this.CreateTree(this.distanceTree,l,_,0))return this.flushBuffer(),1;for(;;)if((o=this.DecodeValue(this.literalTree))>=256){var d,p;if(0==(o-=256))break;for(o--,d=this.readBits(Ftt.cplext[o])+Ftt.cplens[o],o=this.DecodeValue(this.distanceTree),Ftt.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Ftt.cpdext[o]-8)<<8):p=this.readBits(Ftt.cpdext[o]),p+=Ftt.cpdist[o];d--;)a=this.buf32k[this.bIdx-p&32767],this.addBuffer(a)}else this.addBuffer(o)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},Ftt.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},Ftt.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8;var i=this.readByte();for(i|=this.readByte()<<8,a=0,this.nameBuf=[];n--;){var r=this.readByte();"/"===r|":"===r?a=0:a<Ftt.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<i;)r=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},Ftt.prototype.skipdir=function(){var t,e,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<Ftt.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var Btt,ztt,Utt,ktt,Gtt,Vtt,Htt,Wtt,jtt,Xtt,qtt,Ytt,Ktt,Qtt,Jtt,Ztt,$tt,tet,eet,net,iet,ret,aet,oet,set,cet,uet,het,fet,_et,det,pet,met,get,vet,yet,Tet,xet,Eet,Aet,Cet,bet,wet,Iet,Pet,Ret,Det,Oet,Net,Met,Let,Fet,Bet,zet,Uet,ket,Get,Vet,Het,Wet,jet,Xet,qet,Yet,Ket,Qet,Jet,Zet,$et,tnt,ent,nnt,int,rnt,ant,ont,snt,cnt,lnt,unt,hnt,fnt,_nt,dnt,pnt,mnt,gnt,vnt,ynt,Snt,Tnt,xnt,Ent,Ant,Cnt,bnt,wnt,Int,Pnt,Rnt,Dnt,Ont,Nnt,Mnt={name:"Jacob__Codec"};function Lnt(t){var e=t.parent,n=t.getComponent(Qnt);return e&&n?Lnt(e):t.getComponentsInChildren(Qnt)}Mnt.Base64=Ltt,Mnt.GZip=Ftt,Mnt.unzip=function(){return Mnt.GZip.gunzip.apply(Mnt.GZip,arguments)},Mnt.unzipBase64=function(){var t=Mnt.Base64.decode.apply(Mnt.Base64,arguments);try{return Mnt.GZip.gunzip.call(Mnt.GZip,t)}catch(e){return t.slice(7)}},Mnt.unzipBase64AsArray=function(t,e){e=e||1;var n,i,r,a=this.unzipBase64(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},Mnt.unzipAsArray=function(t,e){e=e||1;var n,i,r,a=this.unzip(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(Nnt||(Nnt={}));var Fnt,Bnt,znt,Unt,knt,Gnt,Vnt,Hnt,Wnt,jnt,Xnt,qnt,Ynt,Knt,Qnt=t("ParticleSystem2D",(Btt=Ec("cc.ParticleSystem2D"),ztt=Bc(),Utt=Zc(),ktt=Xc(),Gtt=al(Ctt),Vtt=Zc(),Htt=Xc(),Wtt=al(XF),jtt=Xc(),Xtt=Xc(),qtt=Xc(),Ytt=Xc(),Ktt=Xc(),Qtt=Xc(),Jtt=Xc(),Ztt=Xc(),$tt=Hc(),tet=Xc(),eet=Xc(),net=Xc(),iet=Xc(),ret=Xc(),aet=Xc(),oet=Xc(),set=Xc(),cet=Xc(),uet=Xc(),het=Xc(),fet=Xc(),_et=Xc(),det=al(ptt),pet=Xc(),met=Zc(),get=Xc(),vet=al(dtt),yet=Xc(),Tet=Xc(),xet=Xc(),Eet=Xc(),Aet=Xc(),Cet=Xc(),bet=Xc(),wet=Xc(),Iet=Xc(),Pet=Xc(),Ret=Xc(),Det=Xc(),Oet=Xc(),Net=Xc(),Met=Xc(),Let=Zc(),Fet=Xc(),Bet=Zc(),zet=Xc(),Uet=Oc("preview"),Btt(ket=ztt(ket=zc(ket=Fc((Ont=Dnt=function(t){function e(){var e;return st(e=t.call(this)||this,"duration",Vet,rt(e)),st(e,"emissionRate",Het,rt(e)),st(e,"life",Wet,rt(e)),st(e,"lifeVar",jet,rt(e)),st(e,"angle",Xet,rt(e)),st(e,"angleVar",qet,rt(e)),st(e,"startSize",Yet,rt(e)),st(e,"startSizeVar",Ket,rt(e)),st(e,"endSize",Qet,rt(e)),st(e,"endSizeVar",Jet,rt(e)),st(e,"startSpin",Zet,rt(e)),st(e,"startSpinVar",$et,rt(e)),st(e,"endSpin",tnt,rt(e)),st(e,"endSpinVar",ent,rt(e)),st(e,"sourcePos",nnt,rt(e)),st(e,"posVar",int,rt(e)),st(e,"emitterMode",rnt,rt(e)),st(e,"gravity",ant,rt(e)),st(e,"speed",ont,rt(e)),st(e,"speedVar",snt,rt(e)),st(e,"tangentialAccel",cnt,rt(e)),st(e,"tangentialAccelVar",lnt,rt(e)),st(e,"radialAccel",unt,rt(e)),st(e,"radialAccelVar",hnt,rt(e)),st(e,"rotationIsDir",fnt,rt(e)),st(e,"startRadius",_nt,rt(e)),st(e,"startRadiusVar",dnt,rt(e)),st(e,"endRadius",pnt,rt(e)),st(e,"endRadiusVar",mnt,rt(e)),st(e,"rotatePerS",gnt,rt(e)),st(e,"rotatePerSVar",vnt,rt(e)),e.aspectRatio=1,st(e,"playOnLoad",ynt,rt(e)),st(e,"autoRemoveOnFinish",Snt,rt(e)),st(e,"_preview",Tnt,rt(e)),st(e,"_custom",xnt,rt(e)),st(e,"_file",Ent,rt(e)),st(e,"_spriteFrame",Ant,rt(e)),st(e,"_totalParticles",Cnt,rt(e)),st(e,"_startColor",bnt,rt(e)),st(e,"_startColorVar",wnt,rt(e)),st(e,"_endColor",Int,rt(e)),st(e,"_endColorVar",Pnt,rt(e)),st(e,"_positionType",Rnt,rt(e)),e._stopped=!0,e.initProperties(),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this._simulator.renderData&&this._assembler&&this._assembler.removeData(this._simulator.renderData)},n.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new Att(this)},n.onFocusInEditor=function(){this._focused=!0;for(var t=Lnt(this.node),e=0;e<t.length;++e)t[e]._startPreview()},n.onLostFocusInEditor=function(){this._focused=!1;for(var t=Lnt(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},n._startPreview=function(){this._preview&&this.resetSystem()},n._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},n.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},n.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},n.addParticle=function(){},n.stopSystem=function(){this._stopped=!0,this._simulator.stop()},n.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},n.isFull=function(){return this.particleCount>=this.totalParticles},n._applyFile=function(){var t=this._file;if(t){if(!t)return void O(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},n._initTextureWithDictionary=function(t){var e,n=this;if(t.spriteFrameUuid){var i=t.spriteFrameUuid;xM.loadAny(i,(function(e,i){e?(t.spriteFrameUuid=void 0,n._initTextureWithDictionary(t),T(e)):n.spriteFrame=i}))}else{var r=Au(this._plistFile,t.textureFileName||"");if(t.textureFileName)xM.loadRemote(r,(function(e,i){e?(t.textureFileName=void 0,n._initTextureWithDictionary(t),T(e)):n.spriteFrame=i?XF.createWithImage(i):XF.createWithImage(Eg.get("white-texture"))}));else if(t.textureImageData){var a=t.textureImageData;if(!(a&&a.length>0))return!1;var o=xM.assets.get(r);if(!o){var s=Mnt.unzipBase64AsArray(a,1);if(!s)return R(6030,this._file.name),!1;var c=(e=s).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?Nnt.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?Nnt.TIFF:Nnt.UNKNOWN;if(c!==Nnt.TIFF&&c!==Nnt.PNG)return R(6031,this._file.name),!1;var l=document.createElement("canvas");c===Nnt.PNG?new Itt(s).render(l):(this._tiffReader||(this._tiffReader=new Ptt),this._tiffReader.parseTIFF(s,l)),o=new jm(l),xM.assets.add(r,o)}o||R(6032,this._file.name),this.spriteFrame=o?XF.createWithImage(o):XF.createWithImage(Eg.get("white-texture"))}}return!0},n._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||Oi.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||Oi.ONE_MINUS_SRC_ALPHA);var n=this._startColor;n.r=255*parseFloat(t.startColorRed||0),n.g=255*parseFloat(t.startColorGreen||0),n.b=255*parseFloat(t.startColorBlue||0),n.a=255*parseFloat(t.startColorAlpha||0);var i=this._startColorVar;i.r=255*parseFloat(t.startColorVarianceRed||0),i.g=255*parseFloat(t.startColorVarianceGreen||0),i.b=255*parseFloat(t.startColorVarianceBlue||0),i.a=255*parseFloat(t.startColorVarianceAlpha||0);var r=this._endColor;r.r=255*parseFloat(t.finishColorRed||0),r.g=255*parseFloat(t.finishColorGreen||0),r.b=255*parseFloat(t.finishColorBlue||0),r.a=255*parseFloat(t.finishColorAlpha||0);var a=this._endColorVar;if(a.r=255*parseFloat(t.finishColorVarianceRed||0),a.g=255*parseFloat(t.finishColorVarianceGreen||0),a.b=255*parseFloat(t.finishColorVarianceBlue||0),a.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:ptt.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||dtt.GRAVITY),this.emitterMode===dtt.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var o=t.rotationIsDir||"";null!==o?(o=o.toString().toLowerCase(),this.rotationIsDir="true"===o||"1"===o):this.rotationIsDir=!1}else{if(this.emitterMode!==dtt.RADIUS)return R(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},n._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},n._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()):this.resetSystem()},n._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},n._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==ptt.FREE})},n._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},n._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame},n._render=function(t){this._positionType===ptt.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===ptt.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},Q(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(ok),Dnt.EmitterMode=dtt,Dnt.PositionType=ptt,Dnt.DURATION_INFINITY=-1,Dnt.START_SIZE_EQUAL_TO_END_SIZE=-1,Dnt.START_RADIUS_EQUAL_TO_END_RADIUS=-1,ct((Get=Ont).prototype,"custom",[Vc,Utt,ktt],Object.getOwnPropertyDescriptor(Get.prototype,"custom"),Get.prototype),ct(Get.prototype,"file",[Gtt,Vtt,Htt],Object.getOwnPropertyDescriptor(Get.prototype,"file"),Get.prototype),ct(Get.prototype,"spriteFrame",[Wtt,jtt],Object.getOwnPropertyDescriptor(Get.prototype,"spriteFrame"),Get.prototype),ct(Get.prototype,"totalParticles",[Vc,Xtt],Object.getOwnPropertyDescriptor(Get.prototype,"totalParticles"),Get.prototype),Vet=ct(Get.prototype,"duration",[Dc,Vc,qtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Het=ct(Get.prototype,"emissionRate",[Dc,Vc,Ytt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Wet=ct(Get.prototype,"life",[Dc,Vc,Ktt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jet=ct(Get.prototype,"lifeVar",[Dc,Vc,Qtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct(Get.prototype,"startColor",[Vc,Jtt],Object.getOwnPropertyDescriptor(Get.prototype,"startColor"),Get.prototype),ct(Get.prototype,"startColorVar",[Vc,Ztt],Object.getOwnPropertyDescriptor(Get.prototype,"startColorVar"),Get.prototype),ct(Get.prototype,"color",[$tt],Object.getOwnPropertyDescriptor(Get.prototype,"color"),Get.prototype),ct(Get.prototype,"endColor",[Vc,tet],Object.getOwnPropertyDescriptor(Get.prototype,"endColor"),Get.prototype),ct(Get.prototype,"endColorVar",[Vc,eet],Object.getOwnPropertyDescriptor(Get.prototype,"endColorVar"),Get.prototype),Xet=ct(Get.prototype,"angle",[Dc,Vc,net],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),qet=ct(Get.prototype,"angleVar",[Dc,Vc,iet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Yet=ct(Get.prototype,"startSize",[Dc,Vc,ret],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Ket=ct(Get.prototype,"startSizeVar",[Dc,Vc,aet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qet=ct(Get.prototype,"endSize",[Dc,Vc,oet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jet=ct(Get.prototype,"endSizeVar",[Dc,Vc,set],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zet=ct(Get.prototype,"startSpin",[Dc,Vc,cet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$et=ct(Get.prototype,"startSpinVar",[Dc,Vc,uet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tnt=ct(Get.prototype,"endSpin",[Dc,Vc,het],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ent=ct(Get.prototype,"endSpinVar",[Dc,Vc,fet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nnt=ct(Get.prototype,"sourcePos",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),int=ct(Get.prototype,"posVar",[Dc,Vc,_et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),ct(Get.prototype,"positionType",[det,pet],Object.getOwnPropertyDescriptor(Get.prototype,"positionType"),Get.prototype),ct(Get.prototype,"preview",[Vc,met,get],Object.getOwnPropertyDescriptor(Get.prototype,"preview"),Get.prototype),rnt=ct(Get.prototype,"emitterMode",[Dc,Vc,vet,yet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dtt.GRAVITY}}),ant=ct(Get.prototype,"gravity",[Dc,Vc,Tet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),ont=ct(Get.prototype,"speed",[Dc,Vc,xet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),snt=ct(Get.prototype,"speedVar",[Dc,Vc,Eet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),cnt=ct(Get.prototype,"tangentialAccel",[Dc,Vc,Aet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),lnt=ct(Get.prototype,"tangentialAccelVar",[Dc,Vc,Cet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),unt=ct(Get.prototype,"radialAccel",[Dc,Vc,bet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hnt=ct(Get.prototype,"radialAccelVar",[Dc,Vc,wet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fnt=ct(Get.prototype,"rotationIsDir",[Dc,Vc,Iet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_nt=ct(Get.prototype,"startRadius",[Dc,Vc,Pet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dnt=ct(Get.prototype,"startRadiusVar",[Dc,Vc,Ret],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pnt=ct(Get.prototype,"endRadius",[Dc,Vc,Det],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mnt=ct(Get.prototype,"endRadiusVar",[Dc,Vc,Oet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gnt=ct(Get.prototype,"rotatePerS",[Dc,Vc,Net],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vnt=ct(Get.prototype,"rotatePerSVar",[Dc,Vc,Met],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ynt=ct(Get.prototype,"playOnLoad",[Dc,Vc,Let,Fet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Snt=ct(Get.prototype,"autoRemoveOnFinish",[Dc,Vc,Bet,zet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tnt=ct(Get.prototype,"_preview",[Uet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xnt=ct(Get.prototype,"_custom",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ent=ct(Get.prototype,"_file",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ant=ct(Get.prototype,"_spriteFrame",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cnt=ct(Get.prototype,"_totalParticles",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),bnt=ct(Get.prototype,"_startColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(255,255,255,255)}}),wnt=ct(Get.prototype,"_startColorVar",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(0,0,0,0)}}),Int=ct(Get.prototype,"_endColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(255,255,255,0)}}),Pnt=ct(Get.prototype,"_endColorVar",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(0,0,0,0)}}),Rnt=ct(Get.prototype,"_positionType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ptt.FREE}}),ket=Get))||ket)||ket)||ket)||ket)),Jnt=function(){function t(t,e){this.point=new Qn,this.dir=new Qn,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),Znt=t("MotionStreak",(Fnt=Ec("cc.MotionStreak"),Bnt=Bc(),znt=Gc(),Unt=al(dg),Fnt(knt=Fc(knt=zc(knt=Bnt(knt=znt((Knt=Ynt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_preview",Vnt,rt(e)),st(e,"_fadeTime",Hnt,rt(e)),st(e,"_minSeg",Wnt,rt(e)),st(e,"_stroke",jnt,rt(e)),st(e,"_texture",Xnt,rt(e)),st(e,"_fastMode",qnt,rt(e)),e._points=[],e}Z(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n.onFocusInEditor=function(){this._preview&&this.reset()},n.onLostFocusInEditor=function(){this._preview&&this.reset()},n.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},n.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},Q(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(ok),Ynt.Point=Jnt,ct((Gnt=Knt).prototype,"preview",[Vc],Object.getOwnPropertyDescriptor(Gnt.prototype,"preview"),Gnt.prototype),ct(Gnt.prototype,"fadeTime",[Vc],Object.getOwnPropertyDescriptor(Gnt.prototype,"fadeTime"),Gnt.prototype),ct(Gnt.prototype,"minSeg",[Vc],Object.getOwnPropertyDescriptor(Gnt.prototype,"minSeg"),Gnt.prototype),ct(Gnt.prototype,"stroke",[Vc],Object.getOwnPropertyDescriptor(Gnt.prototype,"stroke"),Gnt.prototype),ct(Gnt.prototype,"texture",[Unt],Object.getOwnPropertyDescriptor(Gnt.prototype,"texture"),Gnt.prototype),ct(Gnt.prototype,"fastMode",[Vc],Object.getOwnPropertyDescriptor(Gnt.prototype,"fastMode"),Gnt.prototype),Vnt=ct(Gnt.prototype,"_preview",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hnt=ct(Gnt.prototype,"_fadeTime",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wnt=ct(Gnt.prototype,"_minSeg",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jnt=ct(Gnt.prototype,"_stroke",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Xnt=ct(Gnt.prototype,"_texture",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qnt=ct(Gnt.prototype,"_fastMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),knt=Gnt))||knt)||knt)||knt)||knt)||knt)),$nt=(new Qn,new Qn),tit=new Qn;function eit(t,e){return t.x=-e.y,t.y=e.x,t}var nit={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e},update:function(t,e){var n,i=t.stroke/2,r=t.node.worldMatrix,a=r.m12,o=r.m13,s=t.points;if(s.length>1){var c=s[0],l=c.point.x-a,u=c.point.y-o;l*l+u*u<t.minSeg&&(n=c)}n||(n=new Znt.Point,s.unshift(n)),n.setPoint(a,o),n.time=t.fadeTime+e;var h,f=0;if(!(s.length<2)){var _=t.renderData;this.updateRenderDataCache(t,_);var d=t.color,p=d.r,m=d.g,g=d.b,v=d.a,y=s[1];y.distance=Qn.subtract(tit,n.point,y.point).length(),tit.normalize(),y.setDir(tit.x,tit.y),n.setDir(tit.x,tit.y),_.dataLength=2*s.length;for(var S=_.data,T=t.fadeTime,x=!1,E=s.length-1;E>=0;E--){var A=s[E],C=A.point,b=A.dir;if(A.time-=e,A.time<0)s.splice(E,1);else{var w=A.time/T,I=s[E-1];if(!x){if(!I){s.splice(E,1);continue}C.x=I.point.x-b.x*w,C.y=I.point.y-b.y*w}x=!0,eit($nt,b);var P=(w*v<<24>>>0)+(g<<16)+(m<<8)+p,R=f;S[R].x=C.x+$nt.x*i,S[R].y=C.y+$nt.y*i,S[R].u=1,S[R].v=w,S[R].color._val=P,S[R+=1].x=C.x-$nt.x*i,S[R].y=C.y-$nt.y*i,S[R].u=0,S[R].v=w,S[R].color._val=P,f+=2}}h=f<=2?0:3*(f-2),_.resize(f,h)}},updateRenderDataCache:function(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()},updateRenderData:function(){},updateColor:function(){},fillBuffers:function(t){for(var e=t.renderData,n=e.chunk,i=e.data,r=e.vertexCount,a=e.indexCount,o=n.vb,s=0,c=0;c<r;c++){var l=i[c];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z,o[s++]=l.u,o[s++]=l.v,Pn.toArray(o,l.color,s),s+=4}for(var u=n.bufferId,h=n.vertexOffset,f=n.vertexAccessor.getMeshBuffer(n.bufferId),_=n.vertexAccessor.getIndexBuffer(u),d=f.indexOffset,p=0,m=a;p<m;p+=2){var g=h+p;_[d++]=g,_[d++]=g+2,_[d++]=g+1,_[d++]=g+1,_[d++]=g+2,_[d++]=g+3}f.indexOffset+=e.indexCount,f.setDirty()}},iit=t("MotionStreakAssemblerManager",{getAssembler:function(){return nit}});Znt.Assembler=iit;var rit,ait,oit={maxParticleDeltaTime:0,createData:function(){return fz.add()},removeData:function(t){fz.remove(t)},updateRenderData:function(){},fillBuffers:function(){}},sit=t("ParticleSystem2DAssembler",{getAssembler:function(){return oit.maxParticleDeltaTime||(oit.maxParticleDeltaTime=l.game.frameTime/1e3*2),oit}});function cit(t,e){var n=e.length;return e[t<0?n- -t%n:t%n]}function lit(t,e,n){for(var i=[];e<t;)e+=n.length;for(;t<=e;++t)i.push(cit(t,n));return i}function uit(t,e,n){if(hit(t,n)){if(dit(cit(t,n),cit(t-1,n),cit(e,n))&&pit(cit(t,n),cit(t+1,n),cit(e,n)))return!1}else if(pit(cit(t,n),cit(t+1,n),cit(e,n))||dit(cit(t,n),cit(t-1,n),cit(e,n)))return!1;if(hit(e,n)){if(dit(cit(e,n),cit(e-1,n),cit(t,n))&&pit(cit(e,n),cit(e+1,n),cit(t,n)))return!1}else if(pit(cit(e,n),cit(e+1,n),cit(t,n))||dit(cit(e,n),cit(e-1,n),cit(t,n)))return!1;for(var i=0;i<n.length;++i)if((i+1)%n.length!=t&&i!=t&&(i+1)%n.length!=e&&i!=e){var r=new Qn;if(Sit(cit(t,n),cit(e,n),cit(i,n),cit(i+1,n),r))return!1}return!0}function hit(t,e){return fit(t,e)}function fit(t,e,n){if(void 0===n){var i=t,r=e;t=cit(i-1,r),e=cit(i,r),n=cit(i+1,r)}return Tit(t,e,n)<0}function _it(t,e,n){return Tit(t,e,n)>0}function dit(t,e,n){return Tit(t,e,n)>=0}function pit(t,e,n){return Tit(t,e,n)<=0}function mit(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function git(t){vit(t)||t.reverse()}function vit(t){return t.length<3||function(t){var e,n=0;for(e=0;e<t.length;e++){var i=(e+1)%t.length;n+=t[e].x*t[i].y,n-=t[e].y*t[i].x}return n/2}(t)>0}function yit(t,e,n,i){var r,a=new Qn,o=e.y-t.y,s=t.x-e.x,c=o*t.x+s*t.y,l=i.y-n.y,u=n.x-i.x,h=l*n.x+u*n.y,f=o*u-l*s;return r=f,0,Math.abs(r-0)<=1e-6||(a.x=(u*c-s*h)/f,a.y=(o*h-l*c)/f),a}function Sit(t,e,n,i,r){if(t==n||t==i||e==n||e==i)return!1;var a=t.x,o=t.y,s=e.x,c=e.y,l=n.x,u=n.y,h=i.x,f=i.y;if(Math.max(a,s)<Math.min(l,h)||Math.max(l,h)<Math.min(a,s))return!1;if(Math.max(o,c)<Math.min(u,f)||Math.max(u,f)<Math.min(o,c))return!1;var _=(h-l)*(o-u)-(f-u)*(a-l),d=(s-a)*(o-u)-(c-o)*(a-l),p=(f-u)*(s-a)-(h-l)*(c-o);return!(Math.abs(p)<1e-6)&&(d/=p,(_/=p)>0&&_<1&&d>0&&d<1&&(r.x=a+_*(s-a),r.y=o+_*(c-o),!0))}function Tit(t,e,n){return t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y)}Qnt.Assembler=sit;var xit,Eit,Ait,Cit,bit,wit=Object.freeze({__proto__:null,ConvexPartition:function t(e){git(e);for(var n,i,r,a,o,s,c=[],l=new Qn,u=new Qn,h=0,f=0,_=0;_<e.length;++_)if(hit(_,e)){i=r=1e8;for(var d=0;d<e.length;++d)_it(cit(_-1,e),cit(_,e),cit(d,e))&&pit(cit(_-1,e),cit(_,e),cit(d-1,e))&&(a=yit(cit(_-1,e),cit(_,e),cit(d,e),cit(d-1,e)),fit(cit(_+1,e),cit(_,e),a)&&(n=mit(cit(_,e),a))<i&&(i=n,l=a,h=d)),_it(cit(_+1,e),cit(_,e),cit(d+1,e))&&pit(cit(_+1,e),cit(_,e),cit(d,e))&&(a=yit(cit(_+1,e),cit(_,e),cit(d,e),cit(d+1,e)),_it(cit(_-1,e),cit(_,e),a)&&(n=mit(cit(_,e),a))<r&&(r=n,f=d,u=a));if(h==(f+1)%e.length){var p=l.add(u).multiplyScalar(.5);(o=lit(_,f,e)).push(p),(s=lit(h,_,e)).push(p)}else{for(var m=0,g=h;f<h;)f+=e.length;for(var v=h;v<=f;++v)if(uit(_,v,e)){var y=1/(mit(cit(_,e),cit(v,e))+1);hit(v,e)?pit(cit(v-1,e),cit(v,e),cit(_,e))&&dit(cit(v+1,e),cit(v,e),cit(_,e))?y+=3:y+=2:y+=1,y>m&&(g=v,m=y)}o=lit(_,g,e),s=lit(g,_,e)}return(c=c.concat(t(o))).concat(t(s))}c.push(e);for(var S=c.length-1;S>=0;S--)0==c[S].length&&c.splice(S,0);return c},ForceCounterClockWise:git,IsCounterClockWise:vit});!function(t){t[t.Static=0]="Static",t[t.Kinematic=1]="Kinematic",t[t.Dynamic=2]="Dynamic",t[t.Animated=3]="Animated"}(xit||(xit=t("ERigidBody2DType",{}))),oe(xit),function(t){t[t.None=0]="None",t[t.BOX=1]="BOX",t[t.CIRCLE=2]="CIRCLE",t[t.POLYGON=3]="POLYGON"}(Eit||(Eit=t("ECollider2DType",{}))),oe(Eit),function(t){t[t.None=0]="None",t[t.DISTANCE=1]="DISTANCE",t[t.SPRING=2]="SPRING",t[t.WHEEL=3]="WHEEL",t[t.MOUSE=4]="MOUSE",t[t.FIXED=5]="FIXED",t[t.SLIDER=6]="SLIDER",t[t.RELATIVE=7]="RELATIVE",t[t.HINGE=8]="HINGE"}(Ait||(Ait=t("EJoint2DType",{}))),oe(Ait),function(t){t[t.DEFAULT=1]="DEFAULT"}(Cit||(Cit=t("PhysicsGroup",{}))),oe(Cit),function(t){t[t.Closest=0]="Closest",t[t.Any=1]="Any",t[t.AllClosest=2]="AllClosest",t[t.All=3]="All"}(bit||(bit=t("ERaycast2DType",{})));var Iit,Pit=t("Contact2DType",{None:"none-contact",BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"});!function(t){t[t.None=0]="None",t[t.Shape=1]="Shape",t[t.Joint=2]="Joint",t[t.Aabb=4]="Aabb",t[t.Pair=8]="Pair",t[t.CenterOfMass=16]="CenterOfMass",t[t.Particle=32]="Particle",t[t.Controller=64]="Controller",t[t.All=63]="All"}(Iit||(Iit=t("EPhysics2DDrawFlags",{})));var Rit=t("PHYSICS_2D_PTM_RATIO",32),Dit=function(){return 0},Oit={impl:null,rigidBody:null,isAwake:!1,isSleeping:!1,initialize:Dit,setType:Dit,setLinearDamping:Dit,setAngularDamping:Dit,setGravityScale:Dit,setFixedRotation:Dit,setAllowSleep:Dit,isActive:Dit,setActive:Dit,wakeUp:Dit,sleep:Dit,getMass:Dit,getInertia:Dit,getLinearVelocity:Dit,setLinearVelocity:Dit,getLinearVelocityFromWorldPoint:Dit,getAngularVelocity:Dit,setAngularVelocity:Dit,getLocalVector:Dit,getWorldVector:Dit,getLocalPoint:Dit,getWorldPoint:Dit,getLocalCenter:Dit,getWorldCenter:Dit,applyForce:Dit,applyForceToCenter:Dit,applyTorque:Dit,applyLinearImpulse:Dit,applyLinearImpulseToCenter:Dit,applyAngularImpulse:Dit,onEnable:Dit,onDisable:Dit,onDestroy:Dit},Nit={INITED:!1};var Mit,Lit,Fit,Bit,zit,Uit,kit={INITED:!1},Git={impl:null,initialize:Dit,setDampingRatio:Dit,setFrequency:Dit,setMaxForce:Dit,setTarget:Dit,setDistance:Dit,setAngularOffset:Dit,setCorrectionFactor:Dit,setLinearOffset:Dit,setMaxLength:Dit,setMaxTorque:Dit,setLowerLimit:Dit,setUpperLimit:Dit,setMaxMotorForce:Dit,setMaxMotorTorque:Dit,setMotorSpeed:Dit,enableLimit:Dit,enableMotor:Dit,setLowerAngle:Dit,setUpperAngle:Dit};!function(t){t[t.DYNAMIC=1]="DYNAMIC",t[t.STATIC=2]="STATIC",t[t.KINEMATIC=4]="KINEMATIC"}(Mit||(Mit={})),oe(Mit),function(t){t[t.X_AXIS=0]="X_AXIS",t[t.Y_AXIS=1]="Y_AXIS",t[t.Z_AXIS=2]="Z_AXIS"}(Lit||(Lit={})),oe(Lit),function(t){t[t.VERTEX=1]="VERTEX",t[t.LINE=2]="LINE",t[t.TRIANGLE=3]="TRIANGLE",t[t.TETRAHEDRON=4]="TETRAHEDRON"}(Fit||(Fit={})),oe(Fit),function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.MESH=5]="MESH",t[t.PLANE=6]="PLANE",t[t.SIMPLEX=7]="SIMPLEX",t[t.TERRAIN=8]="TERRAIN"}(Bit||(Bit={})),oe(Bit),function(t){t[t.POINT_TO_POINT=0]="POINT_TO_POINT",t[t.HINGE=1]="HINGE",t[t.CONE_TWIST=2]="CONE_TWIST"}(zit||(zit={})),oe(zit),function(t){t[t.DEFAULT=1]="DEFAULT"}(Uit||(Uit={})),oe(Uit);var Vit=function(t){if(1===t){for(var e=this,n=function(t){var n="_"+(1<<t);e[n]=0,e.updateArray=[],Object.defineProperty(e,1<<t,{get:function(){return this[n]},set:function(e){this[n]!==e&&(this[n]=e,this.updateArray.indexOf(t)<0&&this.updateArray.push(t))}})},i=0;i<32;i++)n(i);this._1=Uit.DEFAULT}else{for(var r=0;r<32;r++)this[""+(1<<r)]=0;this[1]=Uit.DEFAULT}},Hit=null;l.internal.PhysicsGroup2D=Cit;var Wit,jit,Xit,qit,Yit,Kit,Qit,Jit,Zit,$it,trt,ert,nrt,irt,rrt,art,ort,srt,crt,lrt=t("PhysicsSystem2D",function(t){function e(){var e;(e=t.call(this)||this).velocityIterations=10,e.positionIterations=10,e.physicsWorld=void 0,e.collisionMatrix=new Vit,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._steping=!1,e._gravity=new Qn(0,-10*Rit),e._delayEvents=[];var n=sN.config?sN.config.physics:null;if(n){if(Qn.copy(e._gravity,n.gravity),e._gravity.multiplyScalar(Rit),e._allowSleep=n.allowSleep,e._fixedTimeStep=n.fixedTimeStep,e._maxSubSteps=n.maxSubSteps,e._autoSimulation=n.autoSimulation,n.collisionMatrix)for(var i in n.collisionMatrix){var r=parseInt(i),a=1<<parseInt(i);e.collisionMatrix[""+a]=n.collisionMatrix[r]}if(n.collisionGroups){var o=n.collisionGroups;o instanceof Array&&(o.forEach((function(t){Cit[t.name]=1<<t.index})),oe.update(Cit))}}return e.physicsWorld=new rit.PhysicsWorld,e.gravity=e._gravity,e.allowSleep=e._allowSleep,e}Z(e,t);var n=e.prototype;return n.postUpdate=function(t){if(this._enable&&this._autoSimulation){lN.emit(cN.EVENT_BEFORE_PHYSICS),this._steping=!0;var e=this._fixedTimeStep,n=this.velocityIterations,i=this.positionIterations;this._accumulator+=t;for(var r=0;r++<this._maxSubSteps&&this._accumulator>e;)this.physicsWorld.step(e,n,i),this._accumulator-=e;for(var a=this._delayEvents,o=0,s=a.length;o<s;o++){var c=a[o];c.func.call(c.target)}a.length=0,this.physicsWorld.syncPhysicsToScene(),this.debugDrawFlags&&this.physicsWorld.drawDebug(),this._steping=!1,lN.emit(cN.EVENT_AFTER_PHYSICS)}},n._callAfterStep=function(t,e){this._steping?this._delayEvents.push({target:t,func:e}):e.call(t)},n.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},n.step=function(t){this.physicsWorld.step(t,this.velocityIterations,this.positionIterations)},n.raycast=function(t,e,n,i){return void 0===n&&(n=bit.Closest),void 0===i&&(i=4294967295),this.physicsWorld.raycast(t,e,n,i)},n.testPoint=function(t){return this.physicsWorld.testPoint(t)},n.testAABB=function(t){return this.physicsWorld.testAABB(t)},Q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld.setGravity(new Qn(t.x/Rit,t.y/Rit))}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"debugDrawFlags",get:function(){return this.physicsWorld.debugDrawFlags},set:function(t){this.physicsWorld.debugDrawFlags=t}},{key:"stepping",get:function(){return this._steping}}],[{key:"PHYSICS_NONE",get:function(){return!ait}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===ait}},{key:"PHYSICS_BOX2D",get:function(){return"box2d"===ait}},{key:"PhysicsGroup",get:function(){return Cit}},{key:"instance",get:function(){return Hit||(Hit=new e),Hit}}]),e}($l(KO)));lrt.ID="PHYSICS_2D",lN.once(cN.EVENT_INIT,(function(){lrt.PHYSICS_NONE||lN.registerSystem(lrt.ID,lrt.instance,KO.Priority.LOW)})),function(t){t[t.Circles=0]="Circles",t[t.FaceA=1]="FaceA",t[t.FaceB=2]="FaceB"}(Wit||(Wit=t("Physics2DManifoldType",{})));var urt,hrt,frt,_rt,drt,prt,mrt,grt,vrt,yrt,Srt,Trt,xrt,Ert,Art,Crt,brt,wrt,Irt,Prt,Rrt,Drt,Ort,Nrt,Mrt,Lrt,Frt,Brt,zrt,Urt,krt,Grt,Vrt,Hrt,Wrt,jrt,Xrt,qrt,Yrt,Krt,Qrt,Jrt,Zrt,$rt,tat,eat,nat,iat,rat,aat,oat,sat,cat,lat,uat,hat,fat,_at,dat,pat,mat,gat,vat,yat,Sat,Tat,xat,Eat,Aat,Cat,bat,wat,Iat,Pat,Rat,Dat,Oat,Nat,Mat,Lat,Fat,Bat,zat,Uat,kat,Gat,Vat,Hat,Wat,jat,Xat,qat,Yat,Kat=wc,Qat=al,Jat=Bc,Zat=t("RigidBody2D",(jit=Ec("cc.RigidBody2D"),Xit=Jat(),qit=Qat(Uit),Yit=Qat(xit),jit(Kit=Xit((ct((Qit=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"enabledContactListener",Jit,rt(e)),st(e,"bullet",Zit,rt(e)),st(e,"awakeOnLoad",$it,rt(e)),e._body=null,st(e,"_group",trt,rt(e)),st(e,"_type",ert,rt(e)),st(e,"_allowSleep",nrt,rt(e)),st(e,"_gravityScale",irt,rt(e)),st(e,"_linearDamping",rrt,rt(e)),st(e,"_angularDamping",art,rt(e)),st(e,"_linearVelocity",ort,rt(e)),st(e,"_angularVelocity",srt,rt(e)),st(e,"_fixedRotation",crt,rt(e)),e}Z(e,t);var n=e.prototype;return n.isAwake=function(){return!!this._body&&this._body.isAwake},n.wakeUp=function(){this._body&&this._body.wakeUp()},n.sleep=function(){this._body&&this._body.sleep()},n.getMass=function(){return this._body?this._body.getMass():0},n.applyForce=function(t,e,n){this._body&&this._body.applyForce(t,e,n)},n.applyForceToCenter=function(t,e){this._body&&this._body.applyForceToCenter(t,e)},n.applyTorque=function(t,e){this._body&&this._body.applyTorque(t,e)},n.applyLinearImpulse=function(t,e,n){this._body&&this._body.applyLinearImpulse(t,e,n)},n.applyLinearImpulseToCenter=function(t,e){this._body&&this._body.applyLinearImpulseToCenter(t,e)},n.applyAngularImpulse=function(t,e){this._body&&this._body.applyAngularImpulse(t,e)},n.getLinearVelocityFromWorldPoint=function(t,e){return this._body?this._body.getLinearVelocityFromWorldPoint(t,e):e},n.getLocalVector=function(t,e){return this._body?this._body.getLocalVector(t,e):e},n.getWorldVector=function(t,e){return this._body?this._body.getWorldVector(t,e):e},n.getLocalPoint=function(t,e){return this._body?this._body.getLocalPoint(t,e):e},n.getWorldPoint=function(t,e){return this._body?this._body.getWorldPoint(t,e):e},n.getLocalCenter=function(t){return this._body?this._body.getLocalCenter(t):t},n.getWorldCenter=function(t){return this._body?this._body.getWorldCenter(t):t},n.getInertia=function(){return this._body&&this._body.getInertia(),0},n.onLoad=function(){this._body=l._global.CC_PHYSICS_2D_BUILTIN?Oit:new rit.RigidBody,this._body.initialize(this)},n.onEnable=function(){this._body&&this._body.onEnable()},n.onDisable=function(){this._body&&this._body.onDisable()},n.onDestroy=function(){this._body&&this._body.onDestroy()},Q(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._body&&(t===xit.Animated?this._body.setType(xit.Kinematic):this._body.setType(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"gravityScale",get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._body&&this._body.setGravityScale(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"linearVelocity",get:function(){return this._body&&this._body.getLinearVelocity(this._linearVelocity),this._linearVelocity},set:function(t){this._linearVelocity=t,this._body&&this._body.setLinearVelocity(t)}},{key:"angularVelocity",get:function(){return this._body&&(this._angularVelocity=this._body.getAngularVelocity()),this._angularVelocity},set:function(t){this._angularVelocity=t,this._body&&this._body.setAngularVelocity(t)}},{key:"fixedRotation",get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._body&&this._body.setFixedRotation(t)}},{key:"impl",get:function(){return this._body}}]),e}(Zu)).prototype,"group",[qit],Object.getOwnPropertyDescriptor(Qit.prototype,"group"),Qit.prototype),Jit=ct(Qit.prototype,"enabledContactListener",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zit=ct(Qit.prototype,"bullet",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct(Qit.prototype,"type",[Yit],Object.getOwnPropertyDescriptor(Qit.prototype,"type"),Qit.prototype),ct(Qit.prototype,"allowSleep",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"allowSleep"),Qit.prototype),ct(Qit.prototype,"gravityScale",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"gravityScale"),Qit.prototype),ct(Qit.prototype,"linearDamping",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"linearDamping"),Qit.prototype),ct(Qit.prototype,"angularDamping",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"angularDamping"),Qit.prototype),ct(Qit.prototype,"linearVelocity",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"linearVelocity"),Qit.prototype),ct(Qit.prototype,"angularVelocity",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"angularVelocity"),Qit.prototype),ct(Qit.prototype,"fixedRotation",[Kat],Object.getOwnPropertyDescriptor(Qit.prototype,"fixedRotation"),Qit.prototype),$it=ct(Qit.prototype,"awakeOnLoad",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),trt=ct(Qit.prototype,"_group",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Uit.DEFAULT}}),ert=ct(Qit.prototype,"_type",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xit.Dynamic}}),nrt=ct(Qit.prototype,"_allowSleep",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),irt=ct(Qit.prototype,"_gravityScale",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rrt=ct(Qit.prototype,"_linearDamping",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),art=ct(Qit.prototype,"_angularDamping",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ort=ct(Qit.prototype,"_linearVelocity",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),srt=ct(Qit.prototype,"_angularVelocity",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),crt=ct(Qit.prototype,"_fixedRotation",[Kat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kit=Qit))||Kit)||Kit)),$at=t("Collider2D",(urt=Ec("cc.Collider2D"),hrt=al(Uit),urt((xrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"editing",drt,rt(e)),st(e,"tag",prt,rt(e)),e.TYPE=Eit.None,e._shape=null,e._body=null,st(e,"_group",mrt,rt(e)),st(e,"_density",grt,rt(e)),st(e,"_sensor",vrt,rt(e)),st(e,"_friction",yrt,rt(e)),st(e,"_restitution",Srt,rt(e)),st(e,"_offset",Trt,rt(e)),e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._shape=function(t){return Nit.INITED||(Nit.INITED=!0,Nit[Eit.BOX]=function(){return new rit.BoxShape},Nit[Eit.CIRCLE]=function(){return new rit.CircleShape},Nit[Eit.POLYGON]=function(){return new rit.PolygonShape}),Nit[t]()}(this.TYPE),this._shape.initialize(this),this._shape.onLoad&&this._shape.onLoad(),this._body=this.getComponent(Zat)},n.onEnable=function(){this._shape&&this._shape.onEnable()},n.onDisable=function(){this._shape&&this._shape.onDisable&&this._shape.onDisable()},n.onDestroy=function(){this._shape&&this._shape.onDestroy&&this._shape.onDestroy()},n.apply=function(){this._shape&&this._shape.apply&&this._shape.apply()},Q(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t,this._shape&&this._shape.onGroupChanged&&this._shape.onGroupChanged()}},{key:"density",get:function(){return this._density},set:function(t){this._density=t}},{key:"sensor",get:function(){return this._sensor},set:function(t){this._sensor=t}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t}},{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._shape}},{key:"worldAABB",get:function(){return this._shape?this._shape.worldAABB:new ai}}]),e}($l(Zu)),drt=ct((_rt=xrt).prototype,"editing",[Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),prt=ct(_rt.prototype,"tag",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct(_rt.prototype,"group",[hrt],Object.getOwnPropertyDescriptor(_rt.prototype,"group"),_rt.prototype),ct(_rt.prototype,"density",[wc],Object.getOwnPropertyDescriptor(_rt.prototype,"density"),_rt.prototype),ct(_rt.prototype,"sensor",[wc],Object.getOwnPropertyDescriptor(_rt.prototype,"sensor"),_rt.prototype),ct(_rt.prototype,"friction",[wc],Object.getOwnPropertyDescriptor(_rt.prototype,"friction"),_rt.prototype),ct(_rt.prototype,"restitution",[wc],Object.getOwnPropertyDescriptor(_rt.prototype,"restitution"),_rt.prototype),ct(_rt.prototype,"offset",[wc],Object.getOwnPropertyDescriptor(_rt.prototype,"offset"),_rt.prototype),mrt=ct(_rt.prototype,"_group",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Uit.DEFAULT}}),grt=ct(_rt.prototype,"_density",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vrt=ct(_rt.prototype,"_sensor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yrt=ct(_rt.prototype,"_friction",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Srt=ct(_rt.prototype,"_restitution",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Trt=ct(_rt.prototype,"_offset",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),frt=_rt))||frt)),tot=(t("BoxCollider2D",Ec("cc.BoxCollider2D")(Ert=Bc()((brt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_size",Crt,rt(e)),e.TYPE=Eit.BOX,e}return Z(e,t),Q(e,[{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($at),Crt=ct((Art=brt).prototype,"_size",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ii(1,1)}}),ct(Art.prototype,"size",[wc],Object.getOwnPropertyDescriptor(Art.prototype,"size"),Art.prototype),Ert=Art))||Ert)||Ert),t("CircleCollider2D",Ec("cc.CircleCollider2D")(wrt=Bc()((Rrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_radius",Prt,rt(e)),e.TYPE=Eit.CIRCLE,e}return Z(e,t),Q(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}},{key:"worldPosition",get:function(){return this._shape?this._shape.worldPosition:new Qn}},{key:"worldRadius",get:function(){return this._shape?this._shape.worldRadius:0}}]),e}($at),Prt=ct((Irt=Rrt).prototype,"_radius",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ct(Irt.prototype,"radius",[wc],Object.getOwnPropertyDescriptor(Irt.prototype,"radius"),Irt.prototype),wrt=Irt))||wrt)||wrt),t("PolygonCollider2D",(Drt=Ec("cc.PolygonCollider2D"),Ort=Bc(),Nrt=wc({serializable:!1,displayOrder:0}),Mrt=wc({type:Qn}),Drt(Lrt=Ort((Urt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"threshold",Brt,rt(e)),st(e,"_points",zrt,rt(e)),e.TYPE=Eit.POLYGON,e}return Z(e,t),Q(e,[{key:"points",get:function(){return this._points},set:function(t){this._points=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($at),Brt=ct((Frt=Urt).prototype,"threshold",[Nrt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),zrt=ct(Frt.prototype,"_points",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new Qn(-1,-1),new Qn(1,-1),new Qn(1,1),new Qn(-1,1)]}}),ct(Frt.prototype,"points",[Mrt],Object.getOwnPropertyDescriptor(Frt.prototype,"points"),Frt.prototype),Lrt=Frt))||Lrt)||Lrt)),t("Joint2D",(krt=Ec("cc.Joint2D"),Grt=al(Zat),krt((Yrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"anchor",Wrt,rt(e)),st(e,"connectedAnchor",jrt,rt(e)),st(e,"collideConnected",Xrt,rt(e)),st(e,"connectedBody",qrt,rt(e)),e._body=null,e._joint=null,e.TYPE=Ait.None,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._joint=function(t){return function(){if(!kit.INITED){kit.INITED=!0;var t=l._global.CC_PHYSICS_2D_BUILTIN;kit[Ait.SPRING]=function(){return t?Git:new rit.SpringJoint},kit[Ait.DISTANCE]=function(){return t?Git:new rit.DistanceJoint},kit[Ait.FIXED]=function(){return t?Git:new rit.FixedJoint},kit[Ait.MOUSE]=function(){return t?Git:new rit.MouseJoint},kit[Ait.RELATIVE]=function(){return t?Git:new rit.RelativeJoint},kit[Ait.SLIDER]=function(){return t?Git:new rit.SliderJoint},kit[Ait.WHEEL]=function(){return t?Git:new rit.WheelJoint},kit[Ait.HINGE]=function(){return t?Git:new rit.HingeJoint}}}(),kit[t]()}(this.TYPE),this._joint.initialize(this),this._body=this.getComponent(Zat)},n.onEnable=function(){this._joint&&this._joint.onEnable&&this._joint.onEnable()},n.onDisable=function(){this._joint&&this._joint.onDisable&&this._joint.onDisable()},n.start=function(){this._joint&&this._joint.start&&this._joint.start()},n.onDestroy=function(){this._joint&&this._joint.onDestroy&&this._joint.onDestroy()},Q(e,[{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._joint}}]),e}(Zu),Wrt=ct((Hrt=Yrt).prototype,"anchor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),jrt=ct(Hrt.prototype,"connectedAnchor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),Xrt=ct(Hrt.prototype,"collideConnected",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qrt=ct(Hrt.prototype,"connectedBody",[Grt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vrt=Hrt))||Vrt))),eot=(t("DistanceJoint2D",Ec("cc.DistanceJoint2D")(Krt=Bc()((ct((Qrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.DISTANCE,st(e,"_maxLength",Jrt,rt(e)),st(e,"_autoCalcDistance",Zrt,rt(e)),e}return Z(e,t),Q(e,[{key:"maxLength",get:function(){return this._autoCalcDistance&&this.connectedBody?Dn.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.setMaxLength(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(tot)).prototype,"maxLength",[wc],Object.getOwnPropertyDescriptor(Qrt.prototype,"maxLength"),Qrt.prototype),ct(Qrt.prototype,"autoCalcDistance",[wc],Object.getOwnPropertyDescriptor(Qrt.prototype,"autoCalcDistance"),Qrt.prototype),Jrt=ct(Qrt.prototype,"_maxLength",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Zrt=ct(Qrt.prototype,"_autoCalcDistance",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Krt=Qrt))||Krt)||Krt),t("SpringJoint2D",Ec("cc.SpringJoint2D")($rt=Bc()((ct((tat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.SPRING,st(e,"_frequency",eat,rt(e)),st(e,"_dampingRatio",nat,rt(e)),st(e,"_distance",iat,rt(e)),st(e,"_autoCalcDistance",rat,rt(e)),e}return Z(e,t),Q(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"distance",get:function(){return this._autoCalcDistance&&this.connectedBody?Dn.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._distance},set:function(t){this._distance=t,this._joint&&this._joint.setDistance(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(tot)).prototype,"frequency",[wc],Object.getOwnPropertyDescriptor(tat.prototype,"frequency"),tat.prototype),ct(tat.prototype,"dampingRatio",[wc],Object.getOwnPropertyDescriptor(tat.prototype,"dampingRatio"),tat.prototype),ct(tat.prototype,"distance",[wc],Object.getOwnPropertyDescriptor(tat.prototype,"distance"),tat.prototype),ct(tat.prototype,"autoCalcDistance",[wc],Object.getOwnPropertyDescriptor(tat.prototype,"autoCalcDistance"),tat.prototype),eat=ct(tat.prototype,"_frequency",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),nat=ct(tat.prototype,"_dampingRatio",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),iat=ct(tat.prototype,"_distance",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),rat=ct(tat.prototype,"_autoCalcDistance",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$rt=tat))||$rt)||$rt),t("MouseJoint2D",Ec("cc.MouseJoint2D")(aat=Bc()((ct((oat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.MOUSE,st(e,"_maxForce",sat,rt(e)),st(e,"_dampingRatio",cat,rt(e)),st(e,"_frequency",lat,rt(e)),e._target=new Qn,e}return Z(e,t),e.prototype.update=function(t){this._joint.update(t)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target=t,this._joint&&this._joint.setTarget(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}}]),e}(tot)).prototype,"frequency",[wc],Object.getOwnPropertyDescriptor(oat.prototype,"frequency"),oat.prototype),ct(oat.prototype,"dampingRatio",[wc],Object.getOwnPropertyDescriptor(oat.prototype,"dampingRatio"),oat.prototype),ct(oat.prototype,"maxForce",[wc],Object.getOwnPropertyDescriptor(oat.prototype,"maxForce"),oat.prototype),sat=ct(oat.prototype,"_maxForce",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),cat=ct(oat.prototype,"_dampingRatio",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),lat=ct(oat.prototype,"_frequency",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),aat=oat))||aat)||aat),new Dn),not=new Dn,iot=(t("RelativeJoint2D",Ec("cc.RelativeJoint2D")(uat=Bc()((ct((hat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.RELATIVE,st(e,"_maxForce",fat,rt(e)),st(e,"_maxTorque",_at,rt(e)),st(e,"_correctionFactor",dat,rt(e)),st(e,"_angularOffset",pat,rt(e)),st(e,"_linearOffset",mat,rt(e)),st(e,"_autoCalcOffset",gat,rt(e)),e}return Z(e,t),Q(e,[{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}},{key:"maxTorque",get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.setMaxTorque(t)}},{key:"correctionFactor",get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.setCorrectionFactor(t)}},{key:"linearOffset",get:function(){return this._autoCalcOffset&&this.connectedBody?Qn.subtract(this._linearOffset,this.connectedBody.node.worldPosition,this.node.worldPosition):this._linearOffset},set:function(t){this._linearOffset.set(t),this._joint&&this._joint.setLinearOffset(t)}},{key:"angularOffset",get:function(){return this._autoCalcOffset&&this.connectedBody&&(zn.toEuler(eot,this.node.worldRotation),zn.toEuler(not,this.connectedBody.node.worldRotation),this._angularOffset=not.z-eot.z),this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t)}},{key:"autoCalcOffset",get:function(){return this._autoCalcOffset},set:function(t){this._autoCalcOffset=t}}]),e}(tot)).prototype,"maxForce",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"maxForce"),hat.prototype),ct(hat.prototype,"maxTorque",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"maxTorque"),hat.prototype),ct(hat.prototype,"correctionFactor",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"correctionFactor"),hat.prototype),ct(hat.prototype,"linearOffset",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"linearOffset"),hat.prototype),ct(hat.prototype,"angularOffset",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"angularOffset"),hat.prototype),ct(hat.prototype,"autoCalcOffset",[wc],Object.getOwnPropertyDescriptor(hat.prototype,"autoCalcOffset"),hat.prototype),fat=ct(hat.prototype,"_maxForce",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),_at=ct(hat.prototype,"_maxTorque",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),dat=ct(hat.prototype,"_correctionFactor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),pat=ct(hat.prototype,"_angularOffset",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mat=ct(hat.prototype,"_linearOffset",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),gat=ct(hat.prototype,"_autoCalcOffset",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uat=hat))||uat)||uat),new Qn),rot=(t("SliderJoint2D",Ec("cc.SliderJoint2D")(vat=Bc()((ct((yat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.SLIDER,st(e,"_angle",Sat,rt(e)),st(e,"_autoCalcAngle",Tat,rt(e)),st(e,"_enableMotor",xat,rt(e)),st(e,"_maxMotorForce",Eat,rt(e)),st(e,"_motorSpeed",Aat,rt(e)),st(e,"_enableLimit",Cat,rt(e)),st(e,"_lowerLimit",bat,rt(e)),st(e,"_upperLimit",wat,rt(e)),e}return Z(e,t),Q(e,[{key:"angle",get:function(){return this._autoCalcAngle&&this.connectedBody&&(Qn.subtract(iot,this.connectedBody.node.worldPosition,this.node.worldPosition),this._angle=dn(Math.atan2(iot.y,iot.x))),this._angle},set:function(t){this._angle=t}},{key:"autoCalcAngle",get:function(){return this._autoCalcAngle},set:function(t){this._autoCalcAngle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t}},{key:"maxMotorForce",get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.setMaxMotorForce(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerLimit",get:function(){return this._lowerLimit},set:function(t){this._lowerLimit=t,this._joint&&this._joint.setLowerLimit(t)}},{key:"upperLimit",get:function(){return this._upperLimit},set:function(t){this._upperLimit=t,this._joint&&this._joint.setUpperLimit(t)}}]),e}(tot)).prototype,"angle",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"angle"),yat.prototype),ct(yat.prototype,"autoCalcAngle",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"autoCalcAngle"),yat.prototype),ct(yat.prototype,"enableMotor",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"enableMotor"),yat.prototype),ct(yat.prototype,"maxMotorForce",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"maxMotorForce"),yat.prototype),ct(yat.prototype,"motorSpeed",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"motorSpeed"),yat.prototype),ct(yat.prototype,"enableLimit",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"enableLimit"),yat.prototype),ct(yat.prototype,"lowerLimit",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"lowerLimit"),yat.prototype),ct(yat.prototype,"upperLimit",[wc],Object.getOwnPropertyDescriptor(yat.prototype,"upperLimit"),yat.prototype),Sat=ct(yat.prototype,"_angle",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tat=ct(yat.prototype,"_autoCalcAngle",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xat=ct(yat.prototype,"_enableMotor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Eat=ct(yat.prototype,"_maxMotorForce",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Aat=ct(yat.prototype,"_motorSpeed",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Cat=ct(yat.prototype,"_enableLimit",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bat=ct(yat.prototype,"_lowerLimit",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wat=ct(yat.prototype,"_upperLimit",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vat=yat))||vat)||vat),t("FixedJoint2D",Ec("cc.FixedJoint2D")(Iat=Bc()((ct((Pat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.FIXED,st(e,"_frequency",Rat,rt(e)),st(e,"_dampingRatio",Dat,rt(e)),e}return Z(e,t),Q(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(tot)).prototype,"frequency",[wc],Object.getOwnPropertyDescriptor(Pat.prototype,"frequency"),Pat.prototype),ct(Pat.prototype,"dampingRatio",[wc],Object.getOwnPropertyDescriptor(Pat.prototype,"dampingRatio"),Pat.prototype),Rat=ct(Pat.prototype,"_frequency",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Dat=ct(Pat.prototype,"_dampingRatio",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Iat=Pat))||Iat)||Iat),t("WheelJoint2D",Ec("cc.WheelJoint2D")(Oat=Bc()((ct((Nat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.WHEEL,st(e,"_angle",Mat,rt(e)),st(e,"_enableMotor",Lat,rt(e)),st(e,"_maxMotorTorque",Fat,rt(e)),st(e,"_motorSpeed",Bat,rt(e)),st(e,"_frequency",zat,rt(e)),st(e,"_dampingRatio",Uat,rt(e)),e}return Z(e,t),Q(e,[{key:"angle",get:function(){return this._angle},set:function(t){this._angle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(tot)).prototype,"angle",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"angle"),Nat.prototype),ct(Nat.prototype,"enableMotor",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"enableMotor"),Nat.prototype),ct(Nat.prototype,"maxMotorTorque",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"maxMotorTorque"),Nat.prototype),ct(Nat.prototype,"motorSpeed",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"motorSpeed"),Nat.prototype),ct(Nat.prototype,"frequency",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"frequency"),Nat.prototype),ct(Nat.prototype,"dampingRatio",[wc],Object.getOwnPropertyDescriptor(Nat.prototype,"dampingRatio"),Nat.prototype),Mat=ct(Nat.prototype,"_angle",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),Lat=ct(Nat.prototype,"_enableMotor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fat=ct(Nat.prototype,"_maxMotorTorque",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Bat=ct(Nat.prototype,"_motorSpeed",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zat=ct(Nat.prototype,"_frequency",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Uat=ct(Nat.prototype,"_dampingRatio",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Oat=Nat))||Oat)||Oat),t("HingeJoint2D",Ec("cc.HingeJoint2D")(kat=Bc()((ct((Gat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ait.HINGE,st(e,"_enableLimit",Vat,rt(e)),st(e,"_lowerAngle",Hat,rt(e)),st(e,"_upperAngle",Wat,rt(e)),st(e,"_enableMotor",jat,rt(e)),st(e,"_maxMotorTorque",Xat,rt(e)),st(e,"_motorSpeed",qat,rt(e)),e}return Z(e,t),Q(e,[{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerAngle",get:function(){return this._lowerAngle},set:function(t){this._lowerAngle=t,this._joint&&this._joint.setLowerAngle(t)}},{key:"upperAngle",get:function(){return this._upperAngle},set:function(t){this._upperAngle=t,this._joint&&this._joint.setUpperAngle(t)}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}}]),e}(tot)).prototype,"enableLimit",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"enableLimit"),Gat.prototype),ct(Gat.prototype,"lowerAngle",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"lowerAngle"),Gat.prototype),ct(Gat.prototype,"upperAngle",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"upperAngle"),Gat.prototype),ct(Gat.prototype,"enableMotor",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"enableMotor"),Gat.prototype),ct(Gat.prototype,"maxMotorTorque",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"maxMotorTorque"),Gat.prototype),ct(Gat.prototype,"motorSpeed",[wc],Object.getOwnPropertyDescriptor(Gat.prototype,"motorSpeed"),Gat.prototype),Vat=ct(Gat.prototype,"_enableLimit",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hat=ct(Gat.prototype,"_lowerAngle",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wat=ct(Gat.prototype,"_upperAngle",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jat=ct(Gat.prototype,"_enableMotor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xat=ct(Gat.prototype,"_maxMotorTorque",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),qat=ct(Gat.prototype,"_motorSpeed",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kat=Gat))||kat)||kat),t("Physics2DUtils",{PolygonSeparator:wit}),function(){function t(){this._collider=null,this._worldAabb=new ai}var e=t.prototype;return e.apply=function(){},e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){lrt.instance.physicsWorld.addShape(this)},e.onDisable=function(){lrt.instance.physicsWorld.removeShape(this)},e.start=function(){},e.update=function(){},e.containsPoint=function(t){return!!this.worldAABB.contains(t)},e.intersectsRect=function(t){return!!this.worldAABB.intersects(t)},e.onGroupChanged=function(){lrt.instance.physicsWorld.updateShapeGroup(this)},Q(t,[{key:"impl",get:function(){return null}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){return this._worldAabb}}]),t}()),aot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPoints=[new Qn,new Qn,new Qn,new Qn],e}Z(e,t);var n=e.prototype;return n.update=function(){var t=this._worldAabb,e=this.collider,n=e.size,i=e.offset;t.x=i.x-n.width/2,t.y=i.y-n.height/2,t.width=n.width,t.height=n.height;var r=this._worldPoints,a=r[0],o=r[1],s=r[2],c=r[3];t.transformMat4ToPoints(e.node.worldMatrix,a,o,s,c);var l=Math.min(a.x,o.x,s.x,c.x),u=Math.min(a.y,o.y,s.y,c.y),h=Math.max(a.x,o.x,s.x,c.x),f=Math.max(a.y,o.y,s.y,c.y);t.x=l,t.y=u,t.width=h-l,t.height=f-u},n.containsPoint=function(t){return!!this.worldAABB.contains(t)&&ltt.pointInPolygon(t,this.worldPoints)},n.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&ltt.rectPolygon(t,this.worldPoints)},Q(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(rot),oot=new Qn,sot=new Xn,cot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPosition=new Qn,e._worldRadius=0,e}Z(e,t);var n=e.prototype;return n.update=function(){var t=this._worldAabb,e=this.collider,n=e.node.getWorldMatrix(sot);Qn.transformMat4(oot,e.offset,n);var i=this._worldPosition;i.x=oot.x,i.y=oot.y,n.m12=n.m13=0,oot.x=e.radius,oot.y=0,Qn.transformMat4(oot,oot,n);var r=this._worldRadius=oot.length();t.x=i.x-r,t.y=i.y-r,t.width=2*r,t.height=2*r},n.containsPoint=function(t){return!!this.worldAABB.contains(t)&&Qn.subtract(oot,t,this.worldPosition).length()<this.worldRadius},n.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&ltt.rectCircle(t,this.worldPosition,this.worldRadius)},Q(e,[{key:"worldPosition",get:function(){return this._worldPosition}},{key:"worldRadius",get:function(){return this._worldRadius}}]),e}(rot),lot=new Qn,uot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPoints=[],e}Z(e,t);var n=e.prototype;return n.update=function(){var t=this._worldAabb,e=this.collider,n=e.points,i=e.offset,r=e.node.worldMatrix,a=this._worldPoints;a.length=n.length;for(var o=1e6,s=1e6,c=-1e6,l=-1e6,u=0,h=n.length;u<h;u++){a[u]||(a[u]=new Qn),lot.x=n[u].x+i.x,lot.y=n[u].y+i.y,Qn.transformMat4(lot,lot,r);var f=lot.x,_=lot.y;a[u].x=f,a[u].y=_,f>c&&(c=f),f<o&&(o=f),_>l&&(l=_),_<s&&(s=_)}t.x=o,t.y=s,t.width=c-o,t.height=l-s},n.containsPoint=function(t){return!!this.worldAABB.contains(t)&&ltt.pointInPolygon(t,this.worldPoints)},n.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&ltt.rectPolygon(t,this.worldPoints)},Q(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(rot),hot=function(){function t(t,e){this.shape1=void 0,this.shape2=void 0,this.testFunc=void 0,this.touching=!1,this.type=Pit.None,this.shape1=t,this.shape2=e,this.touching=!1;var n=t instanceof aot||t instanceof uot,i=e instanceof aot||e instanceof uot,r=t instanceof cot,a=e instanceof cot;n&&i?this.testFunc=ltt.polygonPolygon:r&&a?this.testFunc=ltt.circleCircle:n&&a?this.testFunc=ltt.polygonCircle:r&&i?(this.testFunc=ltt.polygonCircle,this.shape1=e,this.shape2=t):T("Can not find contact for builtin shape: "+t.constructor.name+", "+e.constructor.name)}var e=t.prototype;return e.test=function(){var t=this.shape1,e=this.shape2;return!!t.worldAABB.intersects(e.worldAABB)&&(this.testFunc===ltt.polygonPolygon?ltt.polygonPolygon(t.worldPoints,e.worldPoints):this.testFunc===ltt.circleCircle?ltt.circleCircle(t.worldPosition,t.worldRadius,e.worldPosition,e.worldRadius):this.testFunc===ltt.polygonCircle&&ltt.polygonCircle(t.worldPoints,e.worldPosition,e.worldRadius))},e.updateState=function(){var t=this.test(),e=Pit.None;return t&&!this.touching?(this.touching=!0,e=Pit.BEGIN_CONTACT):!t&&this.touching&&(this.touching=!1,e=Pit.END_CONTACT),this.type=e,e},t}(),fot=[],_ot=[];Yat={PhysicsWorld:function(){function t(){this._contacts=[],this._shapes=[],this._debugGraphics=null,this._debugDrawFlags=0}var e=t.prototype;return e.shouldCollide=function(t,e){var n=t.collider,i=e.collider,r=lrt.instance.collisionMatrix;return n!==i&&n.node!==i.node&&r[n.group]&i.group&&r[i.group]&n.group},e.addShape=function(t){var e=this._shapes;if(-1===e.indexOf(t)){for(var n=0,i=e.length;n<i;n++){var r=e[n];if(this.shouldCollide(t,r)){var a=new hot(t,r);this._contacts.push(a)}}e.push(t)}},e.removeShape=function(t){var e=this._shapes,n=e.indexOf(t);if(n>=0){e.splice(n,1);for(var i=this._contacts,r=i.length-1;r>=0;r--){var a=i[r];a.shape1!==t&&a.shape2!==t||(a.touching&&this._emitCollide(a,Pit.END_CONTACT),i.splice(r,1))}}},e.updateShapeGroup=function(t){this.removeShape(t),this.addShape(t)},e.step=function(){for(var t=this._shapes,e=0,n=t.length;e<n;e++)t[e].update();var i=this._contacts;fot.length=0;for(var r=0,a=i.length;r<a;r++)i[r].updateState()!==Pit.None&&fot.push(i[r]);for(var o=0,s=fot.length;o<s;o++){var c=fot[o];this._emitCollide(c)}},e.drawDebug=function(){if(this._debugDrawFlags){this._checkDebugDrawValid();var t=this._debugGraphics;if(t){t.clear();for(var e=this._shapes,n=0,i=e.length;n<i;n++){var r=e[n];if(t.strokeColor=Pn.WHITE,r instanceof aot||r instanceof uot){var a=r.worldPoints;if(a.length>0){t.moveTo(a[0].x,a[0].y);for(var o=1;o<a.length;o++)t.lineTo(a[o].x,a[o].y);t.close(),t.stroke()}}else r instanceof cot&&(t.circle(r.worldPosition.x,r.worldPosition.y,r.worldRadius),t.stroke());if(this._debugDrawFlags&Iit.Aabb){var s=r.worldAABB;t.strokeColor=Pn.BLUE,t.moveTo(s.xMin,s.yMin),t.lineTo(s.xMin,s.yMax),t.lineTo(s.xMax,s.yMax),t.lineTo(s.xMax,s.yMin),t.close(),t.stroke()}}}}},e._emitCollide=function(t,e){e=e||t.type;var n=t.shape1.collider,i=t.shape2.collider;lrt.instance.emit(e,n,i),n.emit(e,n,i),i.emit(e,i,n)},e._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=VR("Canvas");if(!t){var e=lN.getScene();if(!e)return;(t=new ob("Canvas")).addComponent(VH),t.parent=e}var n=new ob("PHYSICS_2D_DEBUG_DRAW");n.hideFlags|=_l.Flags.DontSave,n.parent=t,n.worldPosition=Dn.ZERO,this._debugGraphics=n.addComponent(SG),this._debugGraphics.lineWidth=2}var i=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(i.children.length-1)},e.testPoint=function(t){var e=this._shapes;_ot.length=0;for(var n=0;n<e.length;n++){var i=e[n];i.containsPoint(t)&&_ot.push(i.collider)}return _ot},e.testAABB=function(t){var e=this._shapes;_ot.length=0;for(var n=0;n<e.length;n++){var i=e[n];i.intersectsRect(t)&&_ot.push(i.collider)}return _ot},e.impl=function(){return null},e.setGravity=function(){},e.setAllowSleep=function(){},e.syncPhysicsToScene=function(){},e.syncSceneToPhysics=function(){},e.raycast=function(){return[]},Q(t,[{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){this._debugDrawFlags=t}}]),t}(),RigidBody:null,BoxShape:aot,CircleShape:cot,PolygonShape:uot,MouseJoint:null,DistanceJoint:null,SpringJoint:null,RelativeJoint:null,SliderJoint:null,FixedJoint:null,WheelJoint:null,HingeJoint:null},ait="builtin",l._global.CC_PHYSICS_2D_BUILTIN=!0,l._global.CC_PHYSICS_2D_BOX2D=!1,rit=Yat;var dot,pot,mot,got,vot,yot=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;this._arrayBufferOrPaddings.push(n),this._length+=n}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n),e),e+=n.byteLength)})),t.buffer},t}(),Sot=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var n=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(n).fill(null);for(var i=0;i<n;++i){var r=this._mesh.struct.morph.subMeshMorphs[i];r&&(r.targets.length>_p.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[i]=new xot(this._mesh,i,this._mesh.struct.morph,e):this._subMeshRenderings[i]=new Tot(this._mesh,i,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,n=new Array(e),i=0;i<e;++i){var r,a;n[i]=null!==(r=null===(a=this._subMeshRenderings[i])||void 0===a?void 0:a.createInstance())&&void 0!==r?r:null}return{setWeights:function(t,e){var i;null===(i=n[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){t._mesh.struct.morph;var i=t._mesh.struct.morph.subMeshMorphs[e],r=n[e];if(null===r)return null;var a=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes($i.ATTR_POSITION)&&a.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes($i.ATTR_NORMAL)&&a.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes($i.ATTR_TANGENT)&&a.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),a.push.apply(a,r.requiredPatches()),a},adaptPipelineState:function(t,e){var i;null===(i=n[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t,e=ot(n);!(t=e()).done;){var i=t.value;null==i||i.destroy()}}}},t}(),Tot=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var r=n.subMeshMorphs[e];this._subMeshMorph=r,bot(t,e,i);var a=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=a;var o=r.targets.length,s=Cot(i,a*o);this._textureInfo={width:s.width,height:s.height},this._attributes=r.attributes.map((function(e,n){var i=s.create(),o=i.valueView;return r.targets.forEach((function(e,i){for(var r=e.displacements[n],s=new Float32Array(t.data.buffer,t.data.byteOffset+r.offset,r.count),c=a*i*4,l=0;l<a;++l)o[c+4*l+0]=s[3*l+0],o[c+4*l+1]=s[3*l+1],o[c+4*l+2]=s[3*l+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=ot(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Aot(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(n){for(var i,r=ot(t._attributes);!(i=r()).done;){var a=i.value,o=void 0;switch(a.name){case $i.ATTR_POSITION:o=vp;break;case $i.ATTR_NORMAL:o=Tp;break;case $i.ATTR_TANGENT:o=Ap;break;default:S("Unexpected attribute!")}void 0!==o&&(n.bindSampler(o,a.morphTexture.sampler),n.bindTexture(o,a.morphTexture.texture))}n.bindBuffer(_p.BINDING,e.buffer),n.update()},destroy:function(){}}},t}(),xot=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var r=n.subMeshMorphs[e];bot(t,e,i),this._attributes=r.attributes.map((function(e,n){return{name:e,targets:r.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[n].offset,e.displacements[n].count)}}))}}))}return t.prototype.createInstance=function(){return new Eot(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},Q(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Eot=function(){function t(t,e,n){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Aot(n,0);var i=Cot(n,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var n=this._attributes[e],i=n.morphTexture.valueView,r=this._owner.data[e];t.length,r.targets.length;for(var a=0;a<r.targets.length;++a){var o=r.targets[a].displacements,s=t[a],c=o.length/3;if(0===a)for(var l=0;l<c;++l)i[4*l+0]=o[3*l+0]*s,i[4*l+1]=o[3*l+1]*s,i[4*l+2]=o[3*l+2]*s;else if(0!==s)for(var u=0;u<c;++u)i[4*u+0]+=o[3*u+0]*s,i[4*u+1]+=o[3*u+1]*s,i[4*u+2]+=o[3*u+2]*s}n.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,n=ot(this._attributes);!(e=n()).done;){var i=e.value,r=void 0;switch(i.attributeName){case $i.ATTR_POSITION:r=vp;break;case $i.ATTR_NORMAL:r=Tp;break;case $i.ATTR_TANGENT:r=Ap;break;default:S("Unexpected attribute!")}void 0!==r&&(t.bindSampler(r,i.morphTexture.sampler),t.bindTexture(r,i.morphTexture.texture))}t.bindBuffer(_p.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),Aot=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(_p.SIZE)),this._remoteBuffer=t.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,_p.SIZE,_p.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){t.length,this._targetCount;for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(_p.OFFSET_OF_WEIGHTS+4*e,t[e],l.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(_p.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,l.sys.isLittleEndian),this._localBuffer.setFloat32(_p.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,l.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(_p.OFFSET_OF_VERTICES_COUNT,t,l.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},Q(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Cot(t,e){var i,r,o,s;t.getFormatFeatures(pi.RGBA32F)&Ci.SAMPLED_TEXTURE?(i=e,o=16,r=dg.PixelFormat.RGBA32F,s=Float32Array):(i=4*e,o=4,r=dg.PixelFormat.RGBA8888,s=Uint8Array);var c=function(t){t<5&&(t=5);var e=n(a(t)),i=e>>1;return{width:1<<(1&e?i+1:i),height:1<<i}}(i),l=c.width,u=c.height;return{width:l,height:u,create:function(){var e=new ArrayBuffer(l*u*o),n=new Float32Array(e),i=s===Float32Array?n:new s(e),a=new jm({width:l,height:u,_data:i,_compressed:!1,format:r}),c=new dg;c.setFilters(dg.Filter.NEAREST,dg.Filter.NEAREST),c.setMipFilter(dg.Filter.NONE),c.setWrapMode(dg.WrapMode.CLAMP_TO_EDGE,dg.WrapMode.CLAMP_TO_EDGE,dg.WrapMode.CLAMP_TO_EDGE),c.image=a,c.getGFXTexture()||S("Unexpected: failed to create morph texture?");var h=t.getSampler(c.getSamplerInfo());return{get texture(){return c.getGFXTexture()},get sampler(){return h},get valueView(){return n},destroy:function(){c.destroy()},updatePixels:function(){c.uploadData(i)}}}}}function bot(t,e,n){t.renderingSubMeshes[e].enableVertexIdChannel(n)}function wot(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var Iot=new Dn,Pot=new Dn,Rot=new Uint8Array,Dot=Ec("cc.Mesh")((vot=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,st(e,"_struct",mot,rt(e)),st(e,"_hash",got,rt(e)),e._data=Rot,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}Z(e,t);var n=e.prototype;return n.onLoaded=function(){this.initialize()},n.initialize=function(){if(!this._initialized){this._initialized=!0;for(var t=this._data.buffer,e=l.director.root.device,n=this._createVertexBuffers(e,t),i=[],r=0;r<this._struct.primitives.length;r++){var a=this._struct.primitives[r];if(0!==a.vertexBundelIndices.length){var o=null,s=null;if(a.indexView){var c=a.indexView,u=c.stride,h=c.length;if(4===u&&!e.hasFeature(di.ELEMENT_INDEX_UINT)){var f=this._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(f>=65536){R(10001,f,65536);continue}u>>=1,h>>=1}o=e.createBuffer(new pr(vi.INDEX,Ti.DEVICE,h,u)),s=new(wot(c.stride))(t,c.offset,c.count),c.stride!==u&&(s=wot(u).from(s)),o.update(s)}var _=a.vertexBundelIndices.map((function(t){return n[t]})),d=[];if(a.vertexBundelIndices.length>0)for(var p=a.vertexBundelIndices[0],m=this._struct.vertexBundles[p].attributes,g=0;g<m.length;++g){var v=m[g];d[g]=new Or(v.name,v.format,v.isNormalized,v.stream,v.isInstanced,v.location)}var y=new iw(_,d,a.primitiveMode,o);y.mesh=this,y.subMeshIdx=r,i.push(y)}}this._renderingSubMeshes=i,this._struct.morph&&(this.morphRendering=function(t,e){return new Sot(t,e)}(this,e))}},n.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},n.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},n.assign=function(t,e){this.reset({struct:t,data:e})},n.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},n.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var n=[],i=t.bindposes,r=0;r<i.length;r++)e.push(new Ys(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);for(var a=this._struct.primitives,o=0;o<a.length;o++){var s=this.readAttribute(o,$i.ATTR_JOINTS),c=this.readAttribute(o,$i.ATTR_WEIGHTS),l=this.readAttribute(o,$i.ATTR_POSITION);if(s&&c&&l)for(var u=Math.min(s.length/4,c.length/4,l.length/3),h=0;h<u;h++){Dn.set(Iot,l[3*h+0],l[3*h+1],l[3*h+2]);for(var f=0;f<4;++f){var _=4*h+f,d=s[_];if(!(0===c[_]||d>=i.length)){Dn.transformMat4(Pot,Iot,i[d]),n[d]=!0;var p=e[d];Dn.min(p.center,p.center,Pot),Dn.max(p.halfExtents,p.halfExtents,Pot)}}}}for(var m=0;m<i.length;m++){var g=e[m];n[m]?Ys.fromPoints(g,g.center,g.halfExtents):e[m]=null}return e},n.merge=function(t,e,n){if(n&&!this.validateMergingMesh(t))return!1;var i=new Dn,r=e&&new zn,a=e&&new Ys;if(r&&e.getRotation(r),!this._initialized){var o=JSON.parse(JSON.stringify(t._struct)),s=t._data.slice();if(e){o.maxPosition&&o.minPosition&&(Dn.add(a.center,o.maxPosition,o.minPosition),Dn.multiplyScalar(a.center,a.center,.5),Dn.subtract(a.halfExtents,o.maxPosition,o.minPosition),Dn.multiplyScalar(a.halfExtents,a.halfExtents,.5),Ys.transform(a,a,e),Dn.add(o.maxPosition,a.center,a.halfExtents),Dn.subtract(o.minPosition,a.center,a.halfExtents));for(var c=0;c<o.vertexBundles.length;c++)for(var l=o.vertexBundles[c],u=0;u<l.attributes.length;u++)if(l.attributes[u].name===$i.ATTR_POSITION||l.attributes[u].name===$i.ATTR_NORMAL){var h=l.attributes[u].format,f=new DataView(s.buffer,l.view.offset+Oot(l.attributes,u)),_=Lot(f,h),d=Fot(f,h);if(!_||!d)continue;for(var p=l.view.count,m=l.view.stride,g=Mot(h),v=0;v<p;v++){var y=v*m,S=y+g,T=S+g;switch(i.set(_(y),_(S),_(T)),l.attributes[u].name){case $i.ATTR_POSITION:i.transformMat4(e);break;case $i.ATTR_NORMAL:Dn.transformQuat(i,i,r)}d(y,i.x),d(S,i.y),d(T,i.z)}}}return this.reset({struct:o,data:s}),this.initialize(),!0}for(var x,E,A,C,b,w=new yot,I=0,P=0,R=0,D=0,O=0,N=0,M=0,L=0,F=!1,B=new Array(this._struct.vertexBundles.length),z=0;z<this._struct.vertexBundles.length;++z){var U=this._struct.vertexBundles[z],k=t._struct.vertexBundles[z];R=U.view.offset,D=k.view.offset,P=U.view.stride,I=U.view.count+k.view.count,x=new ArrayBuffer(I*P),E=new Uint8Array(x),R+=(A=this._data.subarray(R,R+U.view.length)).length,D+=(C=t._data.subarray(D,D+k.view.length)).length,E.set(A),O=0;for(var G,V=ot(U.attributes);!(G=V()).done;){var H=G.value;M=0,F=!1;for(var W,j=ot(k.attributes);!(W=j()).done;){var X=W.value;if(H.name===X.name&&H.format===X.format){F=!0;break}M+=na[X.format].size}if(F){L=na[H.format].size,N=U.view.length+O;for(var q=0;q<k.view.count;++q){if(b=C.subarray(M,M+L),E.set(b,N),(H.name===$i.ATTR_POSITION||H.name===$i.ATTR_NORMAL)&&e){var Y=new Float32Array(E.buffer,N,3);switch(i.set(Y[0],Y[1],Y[2]),H.name){case $i.ATTR_POSITION:i.transformMat4(e);break;case $i.ATTR_NORMAL:Dn.transformQuat(i,i,r)}Y[0]=i.x,Y[1]=i.y,Y[2]=i.z}N+=U.view.stride,M+=k.view.stride}}O+=na[H.format].size}B[z]={attributes:U.attributes,view:{offset:w.getLength(),length:x.byteLength,count:I,stride:P}},w.addBuffer(x)}for(var K,Q,J,Z=0,$=2,tt=0,et=new Array(this._struct.primitives.length),nt=0;nt<this._struct.primitives.length;++nt){var it=this._struct.primitives[nt],rt=t._struct.primitives[nt];et[nt]={primitiveMode:it.primitiveMode,vertexBundelIndices:it.vertexBundelIndices};for(var at,st=ot(it.vertexBundelIndices);!(at=st()).done;){var ct=at.value;tt=Math.max(tt,this._struct.vertexBundles[ct].view.count)}if(it.indexView&&rt.indexView){Z=it.indexView.count,Z+=rt.indexView.count,R=it.indexView.offset,D=rt.indexView.offset,$=Z<256?1:Z<65536?2:4;var lt=new ArrayBuffer(Z*$);if(K=2===$?new Uint16Array(lt):1===$?new Uint8Array(lt):new Uint32Array(lt),Q=2===it.indexView.stride?new Uint16Array(this._data.buffer,R,it.indexView.count):1===it.indexView.stride?new Uint8Array(this._data.buffer,R,it.indexView.count):new Uint32Array(this._data.buffer,R,it.indexView.count),$===it.indexView.stride)K.set(Q);else for(var ut=0;ut<it.indexView.count;++ut)K[ut]=Q[ut];R+=it.indexView.length,J=2===rt.indexView.stride?new Uint16Array(t._data.buffer,D,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(t._data.buffer,D,rt.indexView.count):new Uint32Array(t._data.buffer,D,rt.indexView.count);for(var ht=0;ht<rt.indexView.count;++ht)K[it.indexView.count+ht]=tt+J[ht];D+=rt.indexView.length,et[nt].indexView={offset:w.getLength(),length:lt.byteLength,count:Z,stride:$},w.setNextAlignment($),w.addBuffer(lt)}}var ft={vertexBundles:B,primitives:et,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return ft.minPosition&&t._struct.minPosition&&ft.maxPosition&&t._struct.maxPosition&&(e?(Dn.add(a.center,t._struct.maxPosition,t._struct.minPosition),Dn.multiplyScalar(a.center,a.center,.5),Dn.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),Dn.multiplyScalar(a.halfExtents,a.halfExtents,.5),Ys.transform(a,a,e),Dn.add(i,a.center,a.halfExtents),Dn.max(ft.maxPosition,ft.maxPosition,i),Dn.subtract(i,a.center,a.halfExtents),Dn.min(ft.minPosition,ft.minPosition,i)):(Dn.min(ft.minPosition,ft.minPosition,t._struct.minPosition),Dn.max(ft.maxPosition,ft.maxPosition,t._struct.maxPosition))),this.reset({struct:ft,data:new Uint8Array(w.getCombined())}),this.initialize(),!0},n.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var n=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(n.attributes.length!==i.attributes.length)return!1;for(var r=0;r<n.attributes.length;++r)if(n.attributes[r].format!==i.attributes[r].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var a=0;a<this._struct.primitives.length;++a){var o=this._struct.primitives[a],s=t._struct.primitives[a];if(o.vertexBundelIndices.length!==s.vertexBundelIndices.length)return!1;for(var c=0;c<o.vertexBundelIndices.length;++c)if(o.vertexBundelIndices[c]!==s.vertexBundelIndices[c])return!1;if(o.primitiveMode!==s.primitiveMode)return!1;if(o.indexView){if(void 0===s.indexView)return!1}else if(s.indexView)return!1}return!0},n.readAttribute=function(t,e){var n=this,i=null;return this._accessAttribute(t,e,(function(t,e){var r=t.view.count,a=t.attributes[e].format,o=ha(na[a]);if(0!==r){var s=new DataView(n._data.buffer,t.view.offset+Oot(t.attributes,e)),c=na[a],l=Lot(s,a);if(o&&l){for(var u=c.count,h=new o(r*u),f=t.view.stride,_=0;_<r;++_)for(var d=0;d<u;++d)h[u*_+d]=l(f*_+h.BYTES_PER_ELEMENT*d);i=h}}})),i},n.copyAttribute=function(t,e,n,i,r){var a=this,o=!1;return this._accessAttribute(t,e,(function(t,e){var s=t.view.count;if(0!==s){var c=t.attributes[e].format,l=new DataView(a._data.buffer,t.view.offset+Oot(t.attributes,e)),u=new DataView(n,r),h=na[c],f=Lot(l,c),_=Fot(u,c);if(f&&_){for(var d=h.count,p=t.view.stride,m=Mot(c),g=i,v=m,y=0;y<s;++y)for(var S=0;S<d;++S)_(g*y+v*S,f(p*y+m*S));o=!0}}else o=!0})),o},n.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var n=e.indexView.stride;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},n.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var n=this._struct.primitives[t];if(!n.indexView)return!1;for(var i=n.indexView.count,r=1===n.indexView.stride?pi.R8UI:2===n.indexView.stride?pi.R16UI:pi.R32UI,a=Lot(new DataView(this._data.buffer),r),o=0;o<i;++o)e[o]=a(n.indexView.offset+na[r].size*o);return!0},n._accessAttribute=function(t,e,n){if(!(t>=this._struct.primitives.length))for(var i,r=ot(this._struct.primitives[t].vertexBundelIndices);!(i=r()).done;){var a=i.value,o=this._struct.vertexBundles[a],s=o.attributes.findIndex((function(t){return t.name===e}));if(!(s<0)){n(o,s);break}}},n._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(n){var i=t.createBuffer(new pr(vi.VERTEX,Ti.DEVICE,n.view.length,n.view.stride)),r=new Uint8Array(e,n.view.offset,n.view.length);return i.update(r),i}))},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:Rot})},Q(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=Sa(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]),e}(Du),mot=ct((pot=vot).prototype,"_struct",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),got=ct(pot.prototype,"_hash",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dot=pot))||dot;function Oot(t,e){for(var n=0,i=0;i<e;++i){var r=t[i];n+=na[r.format].size}return n}l.Mesh=Dot;var Not=ch.isLittleEndian;function Mot(t){var e=na[t];return e.size/e.count}function Lot(t,e){var n=na[e],i=n.size/n.count;switch(n.type){case mi.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Not)};case 4:return function(e){return t.getUint32(e,Not)}}break;case mi.SNORM:case mi.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Not)};case 4:return function(e){return t.getInt32(e,Not)}}break;case mi.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Not)};case 4:return function(e){return t.getUint32(e,Not)}}break;case mi.FLOAT:return function(e){return t.getFloat32(e,Not)}}return null}function Fot(t,e){var n=na[e],i=n.size/n.count;switch(n.type){case mi.UNORM:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Not)};case 4:return function(e,n){return t.setUint32(e,n,Not)}}break;case mi.SNORM:case mi.INT:switch(i){case 1:return function(e,n){return t.setInt8(e,n)};case 2:return function(e,n){return t.setInt16(e,n,Not)};case 4:return function(e,n){return t.setInt32(e,n,Not)}}break;case mi.UINT:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Not)};case 4:return function(e,n){return t.setUint32(e,n,Not)}}break;case mi.FLOAT:return function(e,n){return t.setFloat32(e,n,Not)}}return null}var Bot,zot,Uot,kot,Got,Vot,Hot,Wot,jot,Xot,qot,Yot,Kot,Qot,Jot,Zot,$ot,tst,est,nst,ist,rst,ast,ost,sst,cst,lst,ust,hst,fst,_st,dst,pst,mst,gst,vst,yst,Sst,Tst,xst,Est,Ast,Cst=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}Z(e,t);var n=e.prototype;return n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);if(this._morphRenderingInstance){var i=this._morphRenderingInstance.requiredPatches(e);if(i)return i.concat(null!=n?n:[])}return n},n.initSubModel=function(e,n,i){return t.prototype.initSubModel.call(this,e,n,this._launderMaterial(i))},n.destroy=function(){t.prototype.destroy.call(this),this._morphRenderingInstance=null},n.setSubModelMaterial=function(e,n){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(n))},n.setMorphRendering=function(t){this._morphRenderingInstance=t},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,n)},n._launderMaterial=function(t){return t},e}(oy),bst=oe({OFF:0,ON:1}),wst=oe({OFF:0,ON:1}),Ist=(Bot=Ec("cc.ModelLightmapSettings"),zot=Oc("_recieveShadow"),Bot((qot=function(){function t(){st(this,"texture",Got,this),st(this,"uvParam",Vot,this),st(this,"_bakeable",Hot,this),st(this,"_castShadow",Wot,this),st(this,"_receiveShadow",jot,this),st(this,"_lightmapSize",Xot,this)}return Q(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Got=ct((kot=qot).prototype,"texture",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vot=ct(kot.prototype,"uvParam",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti}}),Hot=ct(kot.prototype,"_bakeable",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wot=ct(kot.prototype,"_castShadow",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jot=ct(kot.prototype,"_receiveShadow",[zot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xot=ct(kot.prototype,"_lightmapSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),ct(kot.prototype,"bakeable",[Vc],Object.getOwnPropertyDescriptor(kot.prototype,"bakeable"),kot.prototype),ct(kot.prototype,"castShadow",[Vc],Object.getOwnPropertyDescriptor(kot.prototype,"castShadow"),kot.prototype),ct(kot.prototype,"receiveShadow",[Vc],Object.getOwnPropertyDescriptor(kot.prototype,"receiveShadow"),kot.prototype),ct(kot.prototype,"lightmapSize",[Vc],Object.getOwnPropertyDescriptor(kot.prototype,"lightmapSize"),kot.prototype),Uot=kot))||Uot),Pst=(Yot=Ec("cc.MeshRenderer"),Kot=Gc(),Qot=Cc(100),Jot=Bc(),Zot=al(Me),$ot=Xc(),tst=wc({group:{name:"DynamicShadowSettings",displayOrder:0}}),est=al(Me),nst=Xc(),ist=wc({group:{name:"DynamicShadowSettings",displayOrder:1}}),rst=al(bst),ast=Xc(),ost=wc({group:{name:"DynamicShadowSettings",displayOrder:2}}),sst=al(wst),cst=Xc(),lst=wc({group:{name:"DynamicShadowSettings",displayOrder:3}}),ust=al(Dot),hst=Xc(),fst=Hc(),Yot(_st=Kot(_st=Qot(_st=Jot(_st=Fc((Est=xst=function(t){function e(){var e;return st(e=t.call(this)||this,"lightmapSettings",pst,rt(e)),st(e,"_mesh",mst,rt(e)),st(e,"_shadowCastingMode",gst,rt(e)),st(e,"_shadowReceivingMode",vst,rt(e)),st(e,"_shadowBias",yst,rt(e)),st(e,"_shadowNormalBias",Sst,rt(e)),e._subMeshShapesWeights=[],e._modelType=void 0,e._model=null,e._morphInstance=null,st(e,"_enableMorph",Tst,rt(e)),e._modelType=oy,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._mesh&&this._mesh.initialize(),this._validateShapeWeights()||this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias()},n.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias()},n.onEnable=function(){this._model||this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._onUpdateLocalShadowBias(),this._attachToScene()},n.onDisable=function(){this._model&&this._detachFromScene()},n.onDestroy=function(){this._model&&(l.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},n.getWeight=function(t,e){this._subMeshShapesWeights.length;var n=this._subMeshShapesWeights[t];return n.length,n[e]},n.setWeights=function(t,e){var n=this._subMeshShapesWeights;e>=n.length||n[e].length===t.length&&(n[e]=t.slice(0),this._uploadSubMeshShapesWeights(e))},n.setWeight=function(t,e,n){var i=this._subMeshShapesWeights;if(!(e>=i.length)){var r=i[e];n>=r.length||(r[n]=t,this._uploadSubMeshShapesWeights(e))}},n.setInstancedAttribute=function(t,e){if(this.model)for(var n=this.model.instancedAttributes,i=n.attributes,r=n.views,a=0;a<i.length;a++)if(i[a].name===t){r[a].set(e);break}},n._updateLightmap=function(t,e,n,i,r){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=n,this.lightmapSettings.uvParam.z=i,this.lightmapSettings.uvParam.w=r,this._onUpdateLightingmap()},n._updateModels=function(){if(this.enabledInHierarchy){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._mesh&&this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap(),this._onUpdateLocalShadowBias())}},n._createModel=function(){var t=this._morphInstance&&this._modelType===oy?Cst:this._modelType,e=this._model=l.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof Cst&&e.setMorphRendering(this._morphInstance)},n._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},n._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},n._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=yy.POSITION,this._model.transform.hasChangedFlags|=yy.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var n=0;n<t;++n){var i=this.getRenderMaterial(n);i&&!i.isValid&&(i=null);var r=e[n];r&&this._model.initSubModel(n,r,i||this._getBuiltinMaterial())}this._model.enabled=!0}},n._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},n._onUpdateLocalShadowBias=function(){null!==this.model&&this.model.updateLocalShadowBias(),this.setInstancedAttribute("a_localShadowBias",[this._shadowBias,this._shadowNormalBias])},n._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},n._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap(),this._onUpdateLocalShadowBias())},n._onMeshChanged=function(){},n._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},n._getBuiltinMaterial=function(){return Eg.get("missing-material")},n._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},n._updateShadowBias=function(){this._model&&(this._model.shadowBias=this._shadowBias)},n._updateShadowNormalBias=function(){this._model&&(this._model.shadowNormalBias=this._shadowNormalBias)},n._updateCastShadow=function(){this._model&&(this._shadowCastingMode===bst.OFF?this._model.castShadow=!1:(this._shadowCastingMode,bst.ON,this._shadowCastingMode,this._model.castShadow=!0))},n._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===wst.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},n._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var n=0;n<e.passes.length;++n)if(e.passes[n].batchingScheme)return!0}return!1},n._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this._morphInstance=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,e=0;e<t;++e)this._uploadSubMeshShapesWeights(e);this._model&&this._model instanceof Cst&&this._model.setMorphRendering(this._morphInstance)}},n._initSubMeshShapesWeights=function(){var t=this._mesh;if(this._subMeshShapesWeights.length=0,t){var e=t.struct.morph;if(e){var n=e.weights;this._subMeshShapesWeights=e.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):n?(n.length,t.targets.length,n.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},n._validateShapeWeights=function(){var t=this._mesh,e=this._subMeshShapesWeights;if(!t||!t.struct.morph)return 0===e.length;var n=t.struct.morph;return n.subMeshMorphs.length===e.length&&e.every((function(t,e){var i,r,a=t.length;return(null!==(i=null===(r=n.subMeshMorphs[e])||void 0===r?void 0:r.targets.length)&&void 0!==i?i:0)===a}))},n._uploadSubMeshShapesWeights=function(t){var e;null===(e=this._morphInstance)||void 0===e||e.setWeights(t,this._subMeshShapesWeights[t])},Q(e,[{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._updateShadowBias(),this._onUpdateLocalShadowBias()}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._updateShadowNormalBias(),this._onUpdateLocalShadowBias()}},{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh,n=this._mesh=t;null==n||n.initialize(),this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]),e}(PF),xst.ShadowCastingMode=bst,xst.ShadowReceivingMode=wst,pst=ct((dst=Est).prototype,"lightmapSettings",[Dc,Vc,tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ist}}),mst=ct(dst.prototype,"_mesh",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gst=ct(dst.prototype,"_shadowCastingMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bst.OFF}}),vst=ct(dst.prototype,"_shadowReceivingMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wst.ON}}),yst=ct(dst.prototype,"_shadowBias",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Sst=ct(dst.prototype,"_shadowNormalBias",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct(dst.prototype,"shadowBias",[Zot,$ot,tst,tl],Object.getOwnPropertyDescriptor(dst.prototype,"shadowBias"),dst.prototype),ct(dst.prototype,"shadowNormalBias",[est,nst,ist,tl],Object.getOwnPropertyDescriptor(dst.prototype,"shadowNormalBias"),dst.prototype),ct(dst.prototype,"shadowCastingMode",[rst,ast,ost,tl],Object.getOwnPropertyDescriptor(dst.prototype,"shadowCastingMode"),dst.prototype),ct(dst.prototype,"receiveShadow",[sst,cst,lst,tl],Object.getOwnPropertyDescriptor(dst.prototype,"receiveShadow"),dst.prototype),ct(dst.prototype,"mesh",[ust,hst],Object.getOwnPropertyDescriptor(dst.prototype,"mesh"),dst.prototype),ct(dst.prototype,"enableMorph",[fst,tl],Object.getOwnPropertyDescriptor(dst.prototype,"enableMorph"),dst.prototype),Tst=ct(dst.prototype,"_enableMorph",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_st=dst))||_st)||_st)||_st)||_st)||_st);!function(t){t[t.positions=$i.ATTR_POSITION]="positions",t[t.normals=$i.ATTR_NORMAL]="normals",t[t.uvs=$i.ATTR_TEX_COORD]="uvs",t[t.colors=$i.ATTR_COLOR]="colors"}(Ast||(Ast={}));var Rst,Dst=[new Or($i.ATTR_POSITION,pi.RGB32F),new Or($i.ATTR_NORMAL,pi.RGB32F),new Or($i.ATTR_TEX_COORD,pi.RG32F),new Or($i.ATTR_TANGENT,pi.RGBA32F),new Or($i.ATTR_COLOR,pi.RGBA32F)],Ost=new Dn,Nst=function(){function t(t,e,n){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=n}var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,n=t.isInteger,i=e?this._averageValue:this._value;return n?Math.round(i):Math.round(100*i)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var n=e;n-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=n,this._accumSamples=0)}},Q(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),Mst=Ec("cc.PerfCounter")(Rst=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this)._time=void 0,r._time=i,r}Z(e,t);var n=e.prototype;return n.start=function(t){void 0===t&&(t=0),this._time=t},n.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},n.tick=function(){this.end(),this.start()},n.frame=function(t){var e=t,n=e-this._time;this._total++,n>(this._opts.average||1e3)&&(this._value=1e3*this._total/n,this._total=0,this._time=e,this._average(this._value))},e}(Nst))||Rst,Lst="0123456789. ",Fst=500,Bst={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},zst={fps:{desc:"Framerate (FPS)",below:30,average:Fst,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:Fst},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:Fst,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:Fst},render:{desc:"Renderer (ms)",min:0,max:50,average:Fst,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},Ust=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new lr,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(zst).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.reset=function(){this._stats=null,this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer&&this._meshRenderer.destroy(),this._meshRenderer=null,this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(zst).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0},e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),l.director.off(l.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),l.director.off(l.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),l.director.off(l.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),l.director.off(l.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),l.director.off(l.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),l.director.off(l.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1,this._pipeline.profiler=null,l.game.config.showFPS=!1)},e.showStats=function(){if(!this._showFPS){if(!this._device){var t=l.director.root;this._device=t.device,this._swapchain=t.mainWindow.swapchain,this._pipeline=t.pipeline}this.generateCanvas(),this.generateStats(),l.game.once(l.Game.EVENT_ENGINE_INITED,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),l.director.on(l.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),l.director.on(l.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),l.director.on(l.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),l.director.on(l.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),l.director.on(l.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),l.director.on(l.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0,l.game.config.showFPS=!0}},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new Sr(xi.TEX2D,Ei.SAMPLED|Ei.TRANSFER_DST,pi.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var n in zst){var i=zst[n];this._ctx.fillText(i.desc,0,e*this._lineHeight),i.counter=new Mst(n,i,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var r=0;r<Lst.length;++r){var a=this._ctx.measureText(Lst[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var o=0;o<Lst.length;++o)this._ctx.fillText(Lst[o],o*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=zst,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new ob("PROFILER_NODE"),l.game.addPersistRootNode(this._rootNode);var t=new ob("Profiler_Root");t.parent=this._rootNode;for(var e=.4,n=e/this._totalLines,i=e/this._wordHeight,r=n/23,a=this._eachNumWidth*this._canvas.width*r,o=[0,e,0,i,e,0,i,0,0,0,0,0],s=[0,2,1,0,3,2],c=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],u=0,h=0;h<this._totalLines;h++)for(var f=0;f<8;f++){o.push(i+f*a,e-h*n,0),o.push(i+(f+1)*a,e-h*n,0),o.push(i+(f+1)*a,e-(h+1)*n,0),o.push(i+f*a,e-(h+1)*n,0),u=4*(8*h+f+1),s.push(0+u,2+u,1+u,0+u,3+u,2+u);var _=8*h+f,d=Math.floor(_/4),p=_-4*d;c.push(0,this._wordHeight,d,p),c.push(this._eachNumWidth,this._wordHeight,d,p),c.push(this._eachNumWidth,1,d,p),c.push(0,1,d,p)}this._meshRenderer=t.addComponent(Pst),this._meshRenderer.mesh=function(t,e,n){n=n||{};var i,r=[],a=0,o=[],s=0,c=t.positions.slice();if(c.length>0){if(i=null,t.attributes)for(var l,u=ot(t.attributes);!(l=u()).done;){var h=l.value;if(h.name===$i.ATTR_POSITION){i=h;break}}i||(i=Dst[0]),r.push(i);var f=na[i.format];s=Math.max(s,Math.floor(c.length/f.count)),o.push({offset:a,data:c,attribute:i}),a+=f.size}if(t.normals&&t.normals.length>0){if(i=null,t.attributes)for(var _,d=ot(t.attributes);!(_=d()).done;){var p=_.value;if(p.name===$i.ATTR_NORMAL){i=p;break}}i||(i=Dst[1]);var m=na[i.format];r.push(i),s=Math.max(s,Math.floor(t.normals.length/m.count)),o.push({offset:a,data:t.normals,attribute:i}),a+=m.size}if(t.uvs&&t.uvs.length>0){if(i=null,t.attributes)for(var g,v=ot(t.attributes);!(g=v()).done;){var y=g.value;if(y.name===$i.ATTR_TEX_COORD){i=y;break}}i||(i=Dst[2]);var S=na[i.format];r.push(i),s=Math.max(s,Math.floor(t.uvs.length/S.count)),o.push({offset:a,data:t.uvs,attribute:i}),a+=S.size}if(t.tangents&&t.tangents.length>0){if(i=null,t.attributes)for(var T,x=ot(t.attributes);!(T=x()).done;){var E=T.value;if(E.name===$i.ATTR_TANGENT){i=E;break}}i||(i=Dst[3]);var A=na[i.format];r.push(i),s=Math.max(s,Math.floor(t.tangents.length/A.count)),o.push({offset:a,data:t.tangents,attribute:i}),a+=A.size}if(t.colors&&t.colors.length>0){if(i=null,t.attributes)for(var C,b=ot(t.attributes);!(C=b()).done;){var w=C.value;if(w.name===$i.ATTR_COLOR){i=w;break}}i||(i=Dst[4]);var I=na[i.format];r.push(i),s=Math.max(s,Math.floor(t.colors.length/I.count)),o.push({offset:a,data:t.colors,attribute:i}),a+=I.size}if(t.customAttributes)for(var P,R=ot(t.customAttributes);!(P=R()).done;){var D=P.value,O=na[D.attr.format];r.push(D.attr),s=Math.max(s,Math.floor(D.values.length/O.count)),o.push({offset:a,data:D.values,attribute:D.attr}),a+=O.size}for(var N=new yot,M=new ArrayBuffer(s*a),L=new DataView(M),F=0,B=o;F<B.length;F++){var z=B[F];Zb(L,z.data,z.attribute.format,z.offset,a)}N.setNextAlignment(0);var U={attributes:r,view:{offset:N.getLength(),length:M.byteLength,count:s,stride:a}};N.addBuffer(M);var k=null,G=0;if(t.indices){var V=t.indices;G=V.length,k=new ArrayBuffer(2*G),Zb(new DataView(k),V,pi.R16UI)}var H={primitiveMode:t.primitiveMode||Gi.TRIANGLE_LIST,vertexBundelIndices:[0]};k&&(N.setNextAlignment(2),H.indexView={offset:N.getLength(),length:k.byteLength,count:G,stride:2},N.addBuffer(k));var W=t.minPos;if(!W&&n.calculateBounds){W=Dn.set(new Dn,1/0,1/0,1/0);for(var j=0;j<s;++j)Dn.set(Ost,c[3*j+0],c[3*j+1],c[3*j+2]),Dn.min(W,W,Ost)}var X=t.maxPos;if(!X&&n.calculateBounds){X=Dn.set(new Dn,-1/0,-1/0,-1/0);for(var q=0;q<s;++q)Dn.set(Ost,c[3*q+0],c[3*q+1],c[3*q+2]),Dn.max(X,X,Ost)}var Y={vertexBundles:[U],primitives:[H]};return W&&(Y.minPosition=new Dn(W.x,W.y,W.z)),X&&(Y.maxPosition=new Dn(X.x,X.y,X.z)),e||(e=new Dot),e.reset({struct:Y,data:new Uint8Array(N.getCombined())}),e}({positions:o,indices:s,colors:c});var m=new $g;m.initialize({effectName:"profiler"});var g=this.pass=m.passes[0],v=g.getBinding("mainTexture"),y=g.getBinding("digits"),S=g.getBinding("offset");g.bindTexture(v,this._texture),this.digitsData=g.blocks[y],this.offsetData=g.blocks[S],this.offsetData[3]=-1,this._meshRenderer.material=m,this._meshRenderer.node.layer=Cd.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();l.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats&&this._inited){var t=this._swapchain.surfaceTransform,e=this._device.capabilities.clipSpaceSignY;if(t!==this.offsetData[3]){var n=jn[t],i=-.9*e;this.offsetData[0]=-.9*n[0]+i*n[2],this.offsetData[1]=-.9*n[1]+i*n[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=t}this.pass._setRootBufferDirty(!0),this._meshRenderer.model&&(this._pipeline.profiler=this._meshRenderer.model);var r=performance.now();this._stats.render.counter.start(r)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.frame.counter.end(t),this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<Fst)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var n=0,i=this.digitsData;for(var r in this._stats){var a=this._stats[r];a.counter.sample(t);for(var o=a.counter.human().toString(),s=7;s>=0;s--){var c=8*n+s,l=o[o.length-(8-s)],u=Bst[l];void 0===u&&(u=11),i[c]=u}n++}}}},t}()),kst=t("profiler",new Ust);l.profiler=kst;var Gst=new xr(Ii.POINT,Ii.POINT,Ii.NONE,Pi.CLAMP,Pi.CLAMP,Pi.CLAMP),Vst=function(t,e,n){t[e+0]=n.m00,t[e+1]=n.m01,t[e+2]=n.m02,t[e+3]=n.m12,t[e+4]=n.m04,t[e+5]=n.m05,t[e+6]=n.m06,t[e+7]=n.m13,t[e+8]=n.m08,t[e+9]=n.m09,t[e+10]=n.m10,t[e+11]=n.m14};function Hst(t,e){var n=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*n,t)/12)}new zn,new zn,new Dn,new zn,new Dn;var Wst=new Dn,jst=new Dn,Xst=new Dn,qst=new Dn,Yst=new Xn,Kst=new Xn,Qst=new Ys,Jst=Number.MAX_SAFE_INTEGER,Zst=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=function(t){return t.getFormatFeatures(pi.RGBA32F)&Ci.SAMPLED_TEXTURE?pi.RGBA32F:pi.RGBA8}(this._device);this._formatSize=na[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new Vy(t),this._pool.initialize({format:e,roundUpFn:Hst}),this._customPool=new Vy(t),this._customPool.initialize({format:e,roundUpFn:Hst})}var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var n=t[e],i=this._customPool.createChunk(n.textureLength),r=0;r<n.contents.length;r++){var a=n.contents[r],o=a.skeleton;this._chunkIdxMap.set(o,i);for(var s=0;s<a.clips.length;s++){var c=a.clips[s];this._chunkIdxMap.set(o^c,i)}}},e.getDefaultPoseTexture=function(t,e,n){var i=0^t.hash,r=this._textureBuffers.get(i)||null;if(r&&r.bounds.has(e.hash))return r.refCount++,r;var a=t.joints,o=t.bindposes,s=null,c=!1,l=a.length;if(r)r.refCount++;else{var u=12*l,h=this._chunkIdxMap.get(i),f=void 0!==h?this._customPool.alloc(u*Float32Array.BYTES_PER_ELEMENT,h):this._pool.alloc(u*Float32Array.BYTES_PER_ELEMENT);if(!f)return r;r={pixelOffset:f.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:f},s=new Float32Array(u),c=!0}Dn.set(Xst,Jst,Jst,Jst),Dn.set(qst,-Jst,-Jst,-Jst);for(var _=e.getBoneSpaceBounds(t),d=0,p=0;d<l;d++,p+=12){var m=n.getChildByPath(a[d]),g=m?X2(m,n,Yst):t.inverseBindposes[d],v=_[d];v&&(Ys.transform(Qst,v,g),Qst.getBoundary(Wst,jst),Dn.min(Xst,Xst,Wst),Dn.max(qst,qst,jst)),c&&(m&&Xn.multiply(g,g,o[d]),Vst(s,p,m?g:Xn.IDENTITY))}var y=[new Ys];return r.bounds.set(e.hash,y),Ys.fromPoints(y[0],Xst,qst),c&&(this._pool.update(r.handle,s.buffer),this._textureBuffers.set(i,r)),r},e.getSequencePoseTexture=function(t,e,n,i){var r=t.hash^e.hash,a=this._textureBuffers.get(r)||null;if(a&&a.bounds.has(n.hash))return a.refCount++,a;var o=t.joints,s=t.bindposes,c=wJ.getOrExtract(e).frames,l=null,u=!1,h=o.length;if(a)a.refCount++;else{var f=12*h*c,_=this._chunkIdxMap.get(r),d=void 0!==_?this._customPool.alloc(f*Float32Array.BYTES_PER_ELEMENT,_):this._pool.alloc(f*Float32Array.BYTES_PER_ELEMENT);if(!d)return null;var p=this._createAnimInfos(t,e,i);a={pixelOffset:d.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:d,animInfos:p},l=new Float32Array(f),u=!0}var m=n.getBoneSpaceBounds(t),g=[];a.bounds.set(n.hash,g);for(var v=0;v<c;v++)g.push(new Ys(Jst,Jst,Jst,-Jst,-Jst,-Jst));for(var y=0,S=0;y<c;y++){for(var T=g[y],x=0;x<h;x++,S+=12){var E=a.animInfos[x],A=E.curveData,C=E.downstream,b=E.bindposeIdx,w=E.bindposeCorrection,I=void 0,P=!0;A&&C?I=Xn.multiply(Yst,A[y],C):A?I=A[y]:C?I=C:(I=t.inverseBindposes[b],P=!1);var R=m[x];if(R){var D=w?Xn.multiply(Kst,I,w):I;Ys.transform(Qst,R,D),Qst.getBoundary(Wst,jst),Dn.min(T.center,T.center,Wst),Dn.max(T.halfExtents,T.halfExtents,jst)}u&&(P&&Xn.multiply(Yst,I,s[b]),Vst(l,S,P?Yst:Xn.IDENTITY))}Ys.fromPoints(T,T.center,T.halfExtents)}return u&&(this._pool.update(a.handle,l.buffer),this._textureBuffers.set(r,a)),a},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),n=e.next();!n.done;){var i=n.value;i.skeletonHash===t.hash&&(i.readyToBeDeleted=!0,i.refCount?this._textureBuffers.delete(i.skeletonHash^i.clipHash):this.releaseHandle(i)),n=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),n=e.next();!n.done;){var i=n.value;i.clipHash===t.hash&&(i.readyToBeDeleted=!0,i.refCount?this._textureBuffers.delete(i.skeletonHash^i.clipHash):this.releaseHandle(i)),n=e.next()}},e._createAnimInfos=function(t,e,n){for(var i=[],r=t.joints,a=t.bindposes,o=r.length,s=wJ.getOrExtract(e),c=0;c<o;c++){for(var l=r[c],u=s.joints[l],h=n.getChildByPath(l),f=void 0,_=void 0;!u;){var d=l.lastIndexOf("/");if(l=l.substring(0,d),u=s.joints[l],h?(f||(f=new Xn),Xn.fromRTS(Yst,h.rotation,h.position,h.scale),Xn.multiply(f,Yst,f),h=h.parent):_=l,d<0)break}var p=c,m=void 0;if(void 0!==_&&u){p=c-1;for(var g=0;g<o;g++)if(r[g]===_){p=g,m=new Xn,Xn.multiply(m,a[g],t.inverseBindposes[c]);break}}i.push({curveData:u&&u.transforms,downstream:f,bindposeIdx:p,bindposeCorrection:m})}return i},Q(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]),t}(),$st=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var n=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,up.SIZE,up.SIZE)),i=new Float32Array([0,0,0,0]);n.update(i);var r={buffer:n,data:i,dirty:!1,currentClip:null};return this._setAnimInfoDirty(r,!1),this._pool.set(t,r),r},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e._setAnimInfoDirty=function(t,e){t.dirty=e},e.switchClip=function(t,e){return t.currentClip=e,t.data[0]=-1,t.buffer.update(t.data),this._setAnimInfoDirty(t,!1),t},e.clear=function(){for(var t,e=ot(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),tct=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new Zst(t),this.jointAnimationInfo=new $st(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();l.internal.DataPoolManager=tct;var ect,nct,ict,rct,act,oct,sct,cct,lct,uct=new Xn,hct=new Xn,fct=t("SkeletalAnimationState",function(t){function e(e,n){var i;return void 0===n&&(n=""),(i=t.call(this,e,n)||this)._frames=1,i._bakedDuration=0,i._animInfo=null,i._sockets=[],i._animInfoMgr=void 0,i._parent=null,i._curvesInited=!1,i._animInfoMgr=l.director.root.dataPoolManager.jointAnimationInfo,i}Z(e,t);var n=e.prototype;return n.initialize=function(e){if(!this._curveLoaded){this._parent=e.getComponent("cc.SkeletalAnimation");var n=this._parent.useBakedAnimation;this._doNotCreateEval=n,t.prototype.initialize.call(this,e),this._curvesInited=!n;var i=wJ.getOrExtract(this.clip),r=i.frames,a=i.samples;this._frames=r-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/a,this.setUseBaked(n)}},n.setUseBaked=function(e){e?(this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration):(this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0))},n.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,n=0;n<t.length;++n){var i=t[n],r=e.getChildByPath(i.path);if(i.target){for(var a=wJ.getOrExtract(this.clip),o=i.path,s=a.joints[o],c=r,l=void 0;!s;){var u=o.lastIndexOf("/");if(o=o.substring(0,u),s=a.joints[o],c&&(l||(l=Xn.identity(hct)),Xn.fromRTS(uct,c.rotation,c.position,c.scale),Xn.multiply(l,uct,l),c=c.parent),u<0)break}for(var h=s&&s.transforms,f=a.frames,_=[],d=0;d<f;d++){var p;p=h&&l?Xn.multiply(uct,h[d],l):h?h[d]:l||new Xn;var m={pos:new Dn,rot:new zn,scale:new Dn};Xn.toRTS(p,m.rot,m.pos,m.scale),_.push(m)}this._sockets.push({target:i.target,frames:_})}}},n._setAnimInfoDirty=function(t,e){t.dirty=e},n._sampleCurvesBaked=function(t){var e=t/this.duration,n=this._animInfo,i=this.clip;n.currentClip!==i&&(this._animInfoMgr.switchClip(this._animInfo,i),this._parent.getUsers().forEach((function(t){t.uploadAnimation(i)})));var r=e*this._frames+.5|0;if(r!==n.data[0]){n.data[0]=r,this._setAnimInfoDirty(n,!0);for(var a=0;a<this._sockets.length;++a){var o=this._sockets[a],s=o.target,c=o.frames[r],l=c.pos,u=c.rot,h=c.scale;s.setRTS(u,l,h)}}},e}(T$)),_ct=(ect=Ec("cc.Skeleton"),nct=al([Fe]),ict=al([Xn]),ect((lct=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_joints",oct,rt(e)),st(e,"_bindposes",sct,rt(e)),st(e,"_hash",cct,rt(e)),e._invBindposes=null,e}Z(e,t);var n=e.prototype;return n.destroy=function(){var e,n;return null===(e=null===(n=l.director.root)||void 0===n?void 0:n.dataPoolManager)||void 0===e||e.releaseSkeleton(this),t.prototype.destroy.call(this)},n.validate=function(){return this.joints.length>0&&this.bindposes.length>0},Q(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new Xn;Xn.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var n=this._bindposes[e];t+=n.m00.toPrecision(2)+" "+n.m01.toPrecision(2)+" "+n.m02.toPrecision(2)+" "+n.m03.toPrecision(2)+" "+n.m04.toPrecision(2)+" "+n.m05.toPrecision(2)+" "+n.m06.toPrecision(2)+" "+n.m07.toPrecision(2)+" "+n.m08.toPrecision(2)+" "+n.m09.toPrecision(2)+" "+n.m10.toPrecision(2)+" "+n.m11.toPrecision(2)+" "+n.m12.toPrecision(2)+" "+n.m13.toPrecision(2)+" "+n.m14.toPrecision(2)+" "+n.m15.toPrecision(2)+"\n"}this._hash=Sa(t,666)}return this._hash}}]),e}(Du),oct=ct((act=lct).prototype,"_joints",[nct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sct=ct(act.prototype,"_bindposes",[ict],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cct=ct(act.prototype,"_hash",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rct=act))||rct);l.Skeleton=_ct;var dct=[{name:"CC_USE_SKINNING",value:!0}];function pct(t,e,n,i){for(var r=0;r<n.length;r++){for(var a=n[r],o=-1,s=0;s<a.length;s++)if(a[s]===i){o=s;break}o>=0&&(e.push(r),t.push(o))}}var mct,gct,vct,yct,Sct,Tct,xct,Ect,Act,Cct,bct,wct,Ict,Pct,Rct,Dct,Oct,Nct,Mct,Lct,Fct,Bct,zct,Uct,kct,Gct,Vct,Hct,Wct,jct,Xct,qct,Yct,Kct,Qct,Jct,Zct,$ct,tlt,elt,nlt,ilt,rlt,alt,olt,slt,clt,llt,ult,hlt,flt,_lt,dlt,plt,mlt,glt,vlt,ylt,Slt,Tlt,xlt,Elt,Alt,Clt,blt,wlt=new Dn,Ilt=new Dn,Plt=new Dn,Rlt=new Dn,Dlt=new Xn,Olt=new Ys,Nlt=function(t){function e(){var e;return(e=t.call(this)||this)._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=qv.SKINNING,e}Z(e,t);var n=e.prototype;return n._init=function(){},n.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},n.uploadAnimation=function(){},n.bindSkeleton=function(t,e,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null);for(var i=0;i<this._joints.length;i++)S2(this._joints[i].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&n){this.transform=e;var r=n.getBoneSpaceBounds(t),a=n.struct.jointMaps;this._ensureEnoughBuffers(a&&a.length||1),this._bufferIndices=n.jointBufferIndices;for(var o=0;o<t.joints.length;o++){var s=r[o],c=e.getChildByPath(t.joints[o]);if(s&&c){var l=y2(c,e),u=t.bindposes[o],h=[],f=[];a?pct(h,f,a,o):(h.push(o),f.push(0)),this._joints.push({indices:h,buffers:f,bound:s,target:c,bindpose:u,transform:l})}}}},n.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._localDataUpdated=!0),Dn.set(wlt,1/0,1/0,1/0),Dn.set(Ilt,-1/0,-1/0,-1/0);for(var n=0;n<this._joints.length;n++){var i=this._joints[n],r=i.bound,a=v2(i.transform,t);Ys.transform(Olt,r,a),Olt.getBoundary(Plt,Rlt),Dn.min(wlt,wlt,Plt),Dn.max(Ilt,Ilt,Rlt)}var o=this._worldBounds;this._modelBounds&&o&&(Ys.fromPoints(this._modelBounds,wlt,Ilt),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),this._updateNativeBounds())},n.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var n=0;n<this._joints.length;n++){var i=this._joints[n],r=i.indices,a=i.buffers,o=i.transform,s=i.bindpose;Xn.multiply(Dlt,o.world,s);for(var c=0;c<a.length;c++)Vst(this._dataArray[a[c]],12*r[c],Dlt)}for(var l=0;l<this._buffers.length;l++)this._buffers[l].update(this._dataArray[l]);return!0},n.initSubModel=function(e,n,i){var r=n.vertexBuffers,a=n.iaInfo;a.vertexBuffers=n.jointMappedBuffers,t.prototype.initSubModel.call(this,e,n,i),a.vertexBuffers=r},n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);return n?dct.concat(n):dct},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n);var i=this._buffers[this._bufferIndices[e]];i&&n.bindBuffer(fp.BINDING,i)},n._updateInstancedAttributes=function(e,n){n.batchingScheme!==yg.NONE&&R(3936,this.node.getPathInHierarchy()),t.prototype._updateInstancedAttributes.call(this,e,n)},n._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.HOST|Ti.DEVICE,fp.SIZE,fp.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(fp.COUNT))},e}(Cst),Mlt=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],Llt=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=qv.BAKED_SKINNING,e._dataPoolManager=l.director.root.dataPoolManager;var n=new Float32Array(4),i=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:n,animInfo:i,texture:null,boundsInfo:null},e}Z(e,t);var n=e.prototype;return n._init=function(){},n.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),this._applyNativeJointMedium(),t.prototype.destroy.call(this)},n.bindSkeleton=function(t,e,n){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),this._skeleton=t,this._mesh=n,t&&e&&n){this.transform=e;var i=this._dataPoolManager;this._jointsMedium.animInfo=i.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new pr(vi.UNIFORM|vi.TRANSFER_DST,Ti.DEVICE,lp.SIZE,lp.SIZE)))}},n.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var n=this._jointsMedium,i=n.animInfo,r=n.boundsInfo[i.data[0]],a=this._worldBounds;if(a&&r){var o=this.transform;r.transform(o._mat,o._pos,o._rot,o._scale,a)}}},n.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var n=this._jointsMedium.animInfo,i=this._instAnimInfoIdx;return i>=0?this.instancedAttributes.views[i][0]=n.data[0]:n.dirty&&(n.buffer.update(n.data),n.dirty=!1),!0},n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);return n?n.concat(Mlt):Mlt},n.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,n=null;t?(n=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=n&&n.bounds.get(this._mesh.hash),this._updateModelBounds(null)):(n=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._updateModelBounds(n&&n.bounds.get(this._mesh.hash)[0])),this._applyJointTexture(n),this._applyNativeJointMedium()}},n._applyNativeJointMedium=function(){},n._updateModelBounds=function(t){this._modelBounds=t},n._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var n=this._jointsMedium,i=n.buffer,r=n.jointTextureInfo;r[0]=t.handle.texture.width,r[1]=this._skeleton.joints.length,r[2]=t.pixelOffset+.1,r[3]=1/r[0],this.updateInstancedJointTextureInfo(),i&&i.update(r);for(var a=t.handle.texture,o=0;o<this._subModels.length;++o)this._subModels[o].descriptorSet.bindTexture(pp,a)}},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n);var i=this._jointsMedium,r=i.buffer,a=i.texture,o=i.animInfo;if(n.bindBuffer(lp.BINDING,r),n.bindBuffer(up.BINDING,o.buffer),a){var s=this._device.getSampler(Gst);n.bindTexture(pp,a.handle.texture),n.bindSampler(pp,s)}},n._updateInstancedAttributes=function(e,n){t.prototype._updateInstancedAttributes.call(this,e,n),this._setInstAnimInfoIdx(this._getInstancedAttributeIndex(hp)),this.updateInstancedJointTextureInfo()},n._setInstAnimInfoIdx=function(t){this._instAnimInfoIdx=t},n.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,n=t.animInfo,i=this._instAnimInfoIdx;if(i>=0){var r=this.instancedAttributes.views[i];r[0]=n.data[0],r[1]=e[1],r[2]=e[2]}},e}(Cst),Flt=(mct=Ec("cc.SkinnedMeshRenderer"),gct=Gc(),vct=Cc(100),yct=Bc(),Sct=al(_ct),Tct=al(ob),xct=al(_ct),Ect=al(ob),Act=Xc(),mct(Cct=gct(Cct=vct(Cct=Fc(Cct=yct((Pct=function(t){function e(){var e;return st(e=t.call(this)||this,"_skeleton",wct,rt(e)),st(e,"_skinningRoot",Ict,rt(e)),e._clip=null,e.associatedAnimation=null,e._modelType=Llt,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this._tryBindAnimation()},n.onDestroy=function(){this.associatedAnimation&&(this.associatedAnimation.notifySkinnedMeshRemoved(this),this.associatedAnimation),t.prototype.onDestroy.call(this)},n.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},n.setUseBakedAnimation=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var n=t?Llt:Nlt;(e||this._modelType!==n)&&(this._modelType=n,this._model&&(l.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},n.setMaterial=function(e,n){t.prototype.setMaterial.call(this,e,n),this._modelType===Nlt&&this.getMaterialInstance(n)},n._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},n._tryBindAnimation=function(){var t=this._skinningRoot;if(t){for(var e=!1,n=this.node;n;n=n.parent)if(n===t){e=!0;break}if(e){var i=t.getComponent("cc.SkeletalAnimation");i?i.notifySkinnedMeshAdded(this):this.setUseBakedAnimation(!1)}}},n._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},Q(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){this._skinningRoot=t,this._tryBindAnimation(),t!==this._skinningRoot&&this._update()}},{key:"model",get:function(){return this._model}}]),e}(Pst),wct=ct((bct=Pct).prototype,"_skeleton",[Sct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ict=ct(bct.prototype,"_skinningRoot",[Tct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct(bct.prototype,"skeleton",[xct],Object.getOwnPropertyDescriptor(bct.prototype,"skeleton"),bct.prototype),ct(bct.prototype,"skinningRoot",[Ect,Act],Object.getOwnPropertyDescriptor(bct.prototype,"skinningRoot"),bct.prototype),Cct=bct))||Cct)||Cct)||Cct)||Cct)||Cct),Blt=new Or($i.ATTR_BATCH_ID,pi.R32F),zlt=new Or($i.ATTR_BATCH_UV,pi.RG32F),Ult=na[Blt.format].size+na[zlt.format].size,klt=(Rct=Ec("cc.SkinnedMeshUnit"),Dct=al(Dot),Oct=al(_ct),Nct=al($g),Mct=al(Flt),Rct((Hct=function(){function t(){st(this,"mesh",Bct,this),st(this,"skeleton",zct,this),st(this,"material",Uct,this),st(this,"_localTransform",kct,this),st(this,"_offset",Gct,this),st(this,"_size",Vct,this)}return Q(t,[{key:"offset",get:function(){return this._offset},set:function(t){Qn.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){Qn.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&X2(t.node,t.skinningRoot,this._localTransform))}}]),t}(),Bct=ct((Fct=Hct).prototype,"mesh",[Dct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zct=ct(Fct.prototype,"skeleton",[Oct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uct=ct(Fct.prototype,"material",[Nct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kct=ct(Fct.prototype,"_localTransform",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xn}}),Gct=ct(Fct.prototype,"_offset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(0,0)}}),Vct=ct(Fct.prototype,"_size",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(1,1)}}),ct(Fct.prototype,"offset",[Vc],Object.getOwnPropertyDescriptor(Fct.prototype,"offset"),Fct.prototype),ct(Fct.prototype,"size",[Vc],Object.getOwnPropertyDescriptor(Fct.prototype,"size"),Fct.prototype),ct(Fct.prototype,"copyFrom",[Mct],Object.getOwnPropertyDescriptor(Fct.prototype,"copyFrom"),Fct.prototype),Lct=Fct))||Lct),Glt=new Xn,Vlt=(new Xn,new Dn),Hlt=(Wct=Ec("cc.SkinnedMeshBatchRenderer"),jct=Gc(),Xct=Cc(100),qct=Bc(),Yct=Xc(),Kct=al([Fe]),Qct=Xc(),Jct=al([klt]),Zct=Xc(),$ct=Hc(),tlt=Hc(),Wct(elt=jct(elt=Xct(elt=Fc(elt=qct((olt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"atlasSize",ilt,rt(e)),st(e,"batchableTextureNames",rlt,rt(e)),st(e,"units",alt,rt(e)),e._textures={},e._batchMaterial=null,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},n.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},n._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},n.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},n.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var n=e.effectAsset.techniques[e.technique],i=function(i){var r=n.passes[i];if(!r.properties)return"continue";var a=function(n){if(r.properties[n].type>=gi.SAMPLER1D){var a=null;t.batchableTextureNames.find((function(t){return t===n}))?((a=t._textures[n])||(a=t.createTexture(n)),t.cookTextures(a,n,i)):t.units.some((function(t){return a=t.material&&t.material.getProperty(n,i)})),a&&e.setProperty(n,a,i)}else{for(var o=[],s=0;s<t.units.length;s++){var c=t.units[s];c.material&&o.push(c.material.getProperty(n.slice(0,-3),i))}e.setProperty(n,o,i)}};for(var o in r.properties)a(o)},r=0;r<n.passes.length;r++)i(r)}else console.warn("incomplete batch material!")},n.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],n=0;n<this.units.length;n++){var i=this.units[n];if(i&&i.skeleton){var r=i.skeleton;Xn.invert(Glt,i._localTransform);for(var a=function(n){var i=r.joints[n];if(t.findIndex((function(t){return t===i}))>=0)return"continue";t.push(i),e.push(Xn.multiply(new Xn,r.bindposes[n]||Xn.IDENTITY,Glt))},o=0;o<r.joints.length;o++)a(o)}}var s=Array.from(Array(t.length).keys()).sort((function(e,n){return t[e]>t[n]?1:t[e]<t[n]?-1:0})),c=new _ct;c.joints=t.map((function(t,e,n){return n[s[e]]})),c.bindposes=e.map((function(t,e,n){return n[s[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=c}else console.warn("no skinning root specified!")},n.cookMeshes=function(){for(var t=this,e=!1,n=0;n<this.units.length;n++)if(this.units[n].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new Dot;for(var i=0,r=pi.UNKNOWN,a=0,o=pi.UNKNOWN,s=0,c=pi.UNKNOWN,l=0,u=pi.UNKNOWN,h=0,f=pi.UNKNOWN,_=new Array(this.units.length),d=this.units.length,p=0;p<d;p++){var m=this.units[p];m&&m.skeleton&&(_[p]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var g=function(e){var n=t.units[e];if(!n||!n.mesh||!n.mesh.data)return"continue";var d=t._createUnitMesh(e,n.mesh),p=new DataView(d.data.buffer);Xn.inverseTranspose(Glt,n._localTransform);for(var m=n.offset,g=n.size,v=function(t){var v=d.struct.vertexBundles[t];i=v.view.offset,r=pi.UNKNOWN;for(var y=0;y<v.attributes.length;y++){var S=v.attributes[y];if(S.name===$i.ATTR_POSITION){r=S.format;break}i+=na[S.format].size}if(r){for(var T=$b(p,r,i,v.view.length,v.view.stride),x=0;x<T.length;x+=3)Dn.fromArray(Vlt,T,x),Dn.transformMat4(Vlt,Vlt,n._localTransform),Dn.toArray(T,Vlt,x);Zb(p,T,r,i,v.view.stride)}a=v.view.offset,o=pi.UNKNOWN;for(var E=0;E<v.attributes.length;E++){var A=v.attributes[E];if(A.name===$i.ATTR_NORMAL){o=A.format;break}a+=na[A.format].size}if(o){for(var C=$b(p,o,a,v.view.length,v.view.stride),b=0;b<C.length;b+=3)Dn.fromArray(Vlt,C,b),Dn.transformMat4Normal(Vlt,Vlt,Glt),Dn.toArray(C,Vlt,b);Zb(p,C,o,a,v.view.stride)}s=v.view.offset,c=pi.UNKNOWN;for(var w=0;w<v.attributes.length;w++){var I=v.attributes[w];if(I.name===$i.ATTR_TANGENT){c=I.format;break}s+=na[I.format].size}if(c){for(var P=$b(p,c,s,v.view.length,v.view.stride),R=0;R<P.length;R+=3)Dn.fromArray(Vlt,P,R),Dn.transformMat4Normal(Vlt,Vlt,Glt),Dn.toArray(P,Vlt,R);Zb(p,P,c,s,v.view.stride)}l=v.view.offset,u=pi.UNKNOWN;for(var D=0;D<v.attributes.length;D++){var O=v.attributes[D];if(O.name===$i.ATTR_BATCH_UV){u=O.format;break}l+=na[O.format].size}u&&tw(p,(function(t,e){var n,i=0===e?"x":"y";return(t=(n=t)-Math.floor(n))*g[i]+m[i]}),u,l,v.view.length,v.view.stride,p);var N=_[e];if(!N)return"continue";h=v.view.offset,f=pi.UNKNOWN;for(var M=0;M<v.attributes.length;M++){var L=v.attributes[M];if(L.name===$i.ATTR_JOINTS){f=L.format;break}h+=na[L.format].size}f&&tw(p,(function(t){return N[t]}),f,h,v.view.length,v.view.stride,p)},y=0;y<d.struct.vertexBundles.length;y++)v(y);t._mesh.merge(d)},v=0;v<d;v++)g(v);this._onMeshChanged(this._mesh),this._updateModels()}},n.cookTextures=function(t,e,n){for(var i=[],r=[],a=[],o=[],s=0;s<this.units.length;s++){var c=this.units[s];if(c.material){var u=c.material.getProperty(e,n);if(u&&u.image&&u.image.data){var h=new lr;h.texOffset.x=c.offset.x*this.atlasSize,h.texOffset.y=c.offset.y*this.atlasSize,h.texExtent.width=c.size.x*this.atlasSize,h.texExtent.height=c.size.y*this.atlasSize;var f=u.image.data;ArrayBuffer.isView(f)?(a.push(f),o.push(h)):(i.push(f),r.push(h))}}}var _=t.getGFXTexture(),d=l.director.root.device;a.length>0&&d.copyBuffersToTexture(a,_,o),i.length>0&&d.copyTexImagesToTexture(i,_,r)},n.createTexture=function(t){var e=new dg;return e.setFilters(Am.LINEAR,Am.LINEAR),e.setMipFilter(Am.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:xm.RGBA8888}),this._textures[t]=e,e},n.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:xm.RGBA8888})},n._createUnitMesh=function(t,e){for(var n=JSON.parse(JSON.stringify(e.struct)),i={},r=0;r<e.struct.primitives.length;r++){for(var a=e.struct.primitives[r],o=0,s=pi.UNKNOWN,c=0;c<a.vertexBundelIndices.length;c++){var u=e.struct.vertexBundles[a.vertexBundelIndices[c]];o=u.view.offset,s=pi.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var f=u.attributes[h];if(f.name===$i.ATTR_TEX_COORD){s=f.format;break}o+=na[f.format].size}if(s)break}if(void 0===i[c]){i[c]=[s,o];var _=n.vertexBundles[c];_.attributes.push(Blt),_.attributes.push(zlt),_.view.offset=0,_.view.length+=_.view.count*Ult,_.view.stride+=Ult}}for(var d=0,p=0;p<n.vertexBundles.length;p++)d+=n.vertexBundles[p].view.length;for(var m=0;m<n.primitives.length;m++){var g=n.primitives[m];g.indexView&&(g.indexView.offset=d,d+=g.indexView.length)}var v=new Uint8Array(d),y=e.data,S=new DataView(v.buffer),T=new DataView(y.buffer),x=l.sys.isLittleEndian;for(var E in i)for(var A=n.vertexBundles[E],C=e.struct.vertexBundles[E],b=i[E],w=$b(T,b[0],b[1],C.view.length,C.view.stride),I=C.view,P=A.view,R=I.stride,D=P.stride,O=I.offset,N=P.offset,M=0;M<P.count;M++){var L=y.subarray(O,O+R);v.set(L,N),S.setFloat32(N+R,t),S.setFloat32(N+R+4,w[2*M],x),S.setFloat32(N+R+8,w[2*M+1],x),N+=D,O+=R}for(var F=0;F<n.primitives.length;F++){var B=e.struct.primitives[F],z=n.primitives[F];if(B.indexView&&z.indexView)for(var U=B.indexView.stride,k=z.indexView.stride,G=B.indexView.offset,V=z.indexView.offset,H=0;H<z.indexView.count;H++){var W=y.subarray(G,G+U);v.set(W,V),V+=k,G+=U}}var j=new Dot;return j.reset({struct:n,data:v}),j},Q(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(Flt),ilt=ct((nlt=olt).prototype,"atlasSize",[Dc,Yct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),rlt=ct(nlt.prototype,"batchableTextureNames",[Kct,Dc,Qct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),alt=ct(nlt.prototype,"units",[Jct,Dc,Zct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ct(nlt.prototype,"mesh",[sl,$ct],Object.getOwnPropertyDescriptor(nlt.prototype,"mesh"),nlt.prototype),ct(nlt.prototype,"skeleton",[sl,tlt],Object.getOwnPropertyDescriptor(nlt.prototype,"skeleton"),nlt.prototype),elt=nlt))||elt)||elt)||elt)||elt)||elt);l.SkinningModelComponent=Flt,ie.setClassAlias(Flt,"cc.SkinningModelComponent"),l.SkinningModelUnit=klt,ie.setClassAlias(klt,"cc.SkinningModelUnit"),l.BatchedSkinningModelComponent=Hlt,ie.setClassAlias(Hlt,"cc.BatchedSkinningModelComponent");var Wlt=t("Socket",(slt=Ec("cc.SkeletalAnimation.Socket"),clt=al(ob),slt((hlt=ct((ult=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),st(this,"path",hlt,this),st(this,"target",flt,this),this.path=t,this.target=e}).prototype,"path",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),flt=ct(ult.prototype,"target",[clt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),llt=ult))||llt));ie.setClassAlias(Wlt,"cc.SkeletalAnimationComponent.Socket");var jlt=new Xn,Xlt=new Xn;function qlt(t,e,n){void 0===e&&(e=""),void 0===n&&(n=[]);for(var i=0;i<t.children.length;i++){var r=t.children[i];if(r){var a=e?e+"/"+r.name:r.name;n.push(a),qlt(r,a,n)}}return n}var Ylt=function(e){return t({SkeletalAnimation:e,SkeletalAnimationComponent:e}),e}((_lt=Ec("cc.SkeletalAnimation"),dlt=Gc(),plt=Cc(99),mlt=Bc(),glt=al([Wlt]),vlt=Xc(),ylt=Xc(),Slt=al([Wlt]),_lt(Tlt=dlt(Tlt=plt(Tlt=Fc(Tlt=mlt((blt=Clt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_useBakedAnimation",Elt,rt(e)),st(e,"_sockets",Alt,rt(e)),e._users=new Set,e._currentBakedState=null,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this);for(var e=this.node.getComponentsInChildren(Flt),n=0;n<e.length;++n){var i=e[n];i.skinningRoot===this.node&&this.notifySkinnedMeshAdded(i)}},n.onDestroy=function(){t.prototype.onDestroy.call(this),l.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),r$().removeSockets(this.node,this._sockets),this._removeAllUsers()},n.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},n.pause=function(){var e;this._useBakedAnimation?null===(e=this._currentBakedState)||void 0===e||e.pause():t.prototype.pause.call(this)},n.resume=function(){var e;this._useBakedAnimation?null===(e=this._currentBakedState)||void 0===e||e.resume():t.prototype.resume.call(this)},n.stop=function(){this._useBakedAnimation?this._currentBakedState&&(this._currentBakedState.stop(),this._currentBakedState=null):t.prototype.stop.call(this)},n.querySockets=function(){var t=this._defaultClip&&Object.keys(wJ.getOrExtract(this._defaultClip).joints).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],n=0;n<t.length;n++){var i=t[n],r=this.node.getChildByPath(i);r&&(e.push(i),qlt(r,i,e))}return e},n.rebuildSocketAnimations=function(){for(var t,e=ot(this._sockets);!(t=e()).done;){var n=t.value,i=this.node.getChildByPath(n.path),r=n.target;i&&r&&(r.name=n.path.substring(n.path.lastIndexOf("/")+1)+" Socket",r.parent=this.node,X2(i,this.node,jlt),Xn.fromRTS(Xlt,r.rotation,r.position,r.scale),Xn.equals(Xlt,jlt)||(r.matrix=jlt))}for(var a=0,o=Object.keys(this._nameToState);a<o.length;a++){var s=o[a];this._nameToState[s].rebuildSocketCurves(this._sockets)}},n.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var n=new ob;return n.parent=this.node,this._sockets.push(new Wlt(t,n)),this.rebuildSocketAnimations(),n},n.notifySkinnedMeshAdded=function(t){var e=this._useBakedAnimation,n=t.associatedAnimation;if(n&&n._users.delete(t),t.associatedAnimation=this,t.setUseBakedAnimation(e,!0),e){var i=this._currentBakedState;i&&t.uploadAnimation(i.clip)}this._users.add(t)},n.notifySkinnedMeshRemoved=function(t){t.associatedAnimation===this||t.associatedAnimation,t.setUseBakedAnimation(!1),t.associatedAnimation=null,this._users.delete(t)},n.getUsers=function(){return this._users},n._createState=function(t,e){return new fct(t,e)},n._doCreateState=function(e,n){var i=t.prototype._doCreateState.call(this,e,n);return i.rebuildSocketCurves(this._sockets),i},n.doPlayOrCrossFade=function(e,n){if(this._useBakedAnimation){this._currentBakedState&&this._currentBakedState.stop();var i=e;this._currentBakedState=i,i.play()}else t.prototype.doPlayOrCrossFade.call(this,e,n)},n._removeAllUsers=function(){var t=this;Array.from(this._users).forEach((function(e){t.notifySkinnedMeshRemoved(e)}))},Q(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=r$();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){for(var e in this._useBakedAnimation=t,this._nameToState)this._nameToState[e].setUseBaked(t);this._users.forEach((function(e){e.setUseBakedAnimation(t)})),this._useBakedAnimation?r$().removeSockets(this.node,this._sockets):(r$().addSockets(this.node,this._sockets),this._currentBakedState=null)}}]),e}(k2),Clt.Socket=Wlt,ct((xlt=blt).prototype,"sockets",[glt,vlt],Object.getOwnPropertyDescriptor(xlt.prototype,"sockets"),xlt.prototype),ct(xlt.prototype,"useBakedAnimation",[ylt],Object.getOwnPropertyDescriptor(xlt.prototype,"useBakedAnimation"),xlt.prototype),Elt=ct(xlt.prototype,"_useBakedAnimation",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Alt=ct(xlt.prototype,"_sockets",[Slt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tlt=xlt))||Tlt)||Tlt)||Tlt)||Tlt)||Tlt));l.SkeletalAnimationComponent=Ylt,ie.setClassAlias(Ylt,"cc.SkeletalAnimationComponent");var Klt,Qlt,Jlt=(Klt=function(t,e){return(Klt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Klt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){var e,n,i,r=function(){function t(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=n}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,n,i,r,a,o,s){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var c=this.timelines,l=0,u=c.length;l<u;l++)c[l].apply(t,e,n,r,a,o,s)},t.binarySearch=function(t,e,n){void 0===n&&(n=1);var i=0,r=t.length/n-2;if(0==r)return n;for(var a=r>>>1;;){if(t[(a+1)*n]<=e?i=a+1:r=a,i==r)return(i+1)*n;a=i+r>>>1}},t.linearSearch=function(t,e,n){for(var i=0,r=t.length-n;i<=r;i+=n)if(t[i]>e)return i;return-1},t}();t.Animation=r,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(n=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(i=t.TimelineType||(t.TimelineType={}));var a=function(){function e(n){if(n<=0)throw new Error("frameCount must be > 0: "+n);this.curves=t.Utils.newFloatArray((n-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var n=t*e.BEZIER_SIZE;if(n==this.curves.length)return e.LINEAR;var i=this.curves[n];return i==e.LINEAR?e.LINEAR:i==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,n,i,r,a){var o=.03*(2*-n+r),s=.03*(2*-i+a),c=.006*(3*(n-r)+1),l=.006*(3*(i-a)+1),u=2*o+c,h=2*s+l,f=.3*n+o+.16666667*c,_=.3*i+s+.16666667*l,d=t*e.BEZIER_SIZE,p=this.curves;p[d++]=e.BEZIER;for(var m=f,g=_,v=d+e.BEZIER_SIZE-1;d<v;d+=2)p[d]=m,p[d+1]=g,f+=u,_+=h,u+=c,h+=l,m+=f,g+=_},e.prototype.getCurvePercent=function(n,i){i=t.MathUtils.clamp(i,0,1);var r=this.curves,a=n*e.BEZIER_SIZE,o=r[a];if(o==e.LINEAR)return i;if(o==e.STEPPED)return 0;for(var s=0,c=++a,l=a+e.BEZIER_SIZE-1;a<l;a+=2)if((s=r[a])>=i){var u=void 0,h=void 0;return a==c?(u=0,h=0):(u=r[a-2],h=r[a-1]),h+(r[a+1]-h)*(i-u)/(s-u)}var f=r[a-1];return f+(1-f)*(i-s)/(1-s)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=a;var o=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e<<1),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.rotate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return void(u.rotation=u.data.rotation);case e.first:var h=u.data.rotation-u.rotation;u.rotation+=(h-360*(16384-(16384.499999999996-h/360|0)))*s}else if(i>=l[l.length-a.ENTRIES]){var f=l[l.length+a.PREV_ROTATION];switch(c){case e.setup:u.rotation=u.data.rotation+f*s;break;case e.first:case e.replace:f+=u.data.rotation-u.rotation,f-=360*(16384-(16384.499999999996-f/360|0));case e.add:u.rotation+=f*s}}else{var _=r.binarySearch(l,i,a.ENTRIES),d=l[_+a.PREV_ROTATION],p=l[_],m=this.getCurvePercent((_>>1)-1,1-(i-p)/(l[_+a.PREV_TIME]-p)),g=l[_+a.ROTATION]-d;switch(g=d+(g-360*(16384-(16384.499999999996-g/360|0)))*m,c){case e.setup:u.rotation=u.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*s;break;case e.first:case e.replace:g+=u.data.rotation-u.rotation;case e.add:u.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*s}}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_ROTATION=-1,a.ROTATION=1,a}(a);t.RotateTimeline=o;var s=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.translate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=n,this.frames[t+a.Y]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return u.x=u.data.x,void(u.y=u.data.y);case e.first:u.x+=(u.data.x-u.x)*s,u.y+=(u.data.y-u.y)*s}else{var h=0,f=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_X],f=l[l.length+a.PREV_Y];else{var _=r.binarySearch(l,i,a.ENTRIES);h=l[_+a.PREV_X],f=l[_+a.PREV_Y];var d=l[_],p=this.getCurvePercent(_/a.ENTRIES-1,1-(i-d)/(l[_+a.PREV_TIME]-d));h+=(l[_+a.X]-h)*p,f+=(l[_+a.Y]-f)*p}switch(c){case e.setup:u.x=u.data.x+h*s,u.y=u.data.y+f*s;break;case e.first:case e.replace:u.x+=(u.data.x+h-u.x)*s,u.y+=(u.data.y+f-u.y)*s;break;case e.add:u.x+=h*s,u.y+=f*s}}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_X=-2,a.PREV_Y=-1,a.X=1,a.Y=2,a}(a);t.TranslateTimeline=s;var c=function(a){function o(t){return a.call(this,t)||this}return Jlt(o,a),o.prototype.getPropertyId=function(){return(i.scale<<24)+this.boneIndex},o.prototype.apply=function(i,a,s,c,l,u,h){var f=this.frames,_=i.bones[this.boneIndex];if(_.active)if(s<f[0])switch(u){case e.setup:return _.scaleX=_.data.scaleX,void(_.scaleY=_.data.scaleY);case e.first:_.scaleX+=(_.data.scaleX-_.scaleX)*l,_.scaleY+=(_.data.scaleY-_.scaleY)*l}else{var d=0,p=0;if(s>=f[f.length-o.ENTRIES])d=f[f.length+o.PREV_X]*_.data.scaleX,p=f[f.length+o.PREV_Y]*_.data.scaleY;else{var m=r.binarySearch(f,s,o.ENTRIES);d=f[m+o.PREV_X],p=f[m+o.PREV_Y];var g=f[m],v=this.getCurvePercent(m/o.ENTRIES-1,1-(s-g)/(f[m+o.PREV_TIME]-g));d=(d+(f[m+o.X]-d)*v)*_.data.scaleX,p=(p+(f[m+o.Y]-p)*v)*_.data.scaleY}if(1==l)u==e.add?(_.scaleX+=d-_.data.scaleX,_.scaleY+=p-_.data.scaleY):(_.scaleX=d,_.scaleY=p);else{var y=0,S=0;if(h==n.mixOut)switch(u){case e.setup:y=_.data.scaleX,S=_.data.scaleY,_.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*l,_.scaleY=S+(Math.abs(p)*t.MathUtils.signum(S)-S)*l;break;case e.first:case e.replace:y=_.scaleX,S=_.scaleY,_.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*l,_.scaleY=S+(Math.abs(p)*t.MathUtils.signum(S)-S)*l;break;case e.add:y=_.scaleX,S=_.scaleY,_.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-_.data.scaleX)*l,_.scaleY=S+(Math.abs(p)*t.MathUtils.signum(S)-_.data.scaleY)*l}else switch(u){case e.setup:y=Math.abs(_.data.scaleX)*t.MathUtils.signum(d),S=Math.abs(_.data.scaleY)*t.MathUtils.signum(p),_.scaleX=y+(d-y)*l,_.scaleY=S+(p-S)*l;break;case e.first:case e.replace:y=Math.abs(_.scaleX)*t.MathUtils.signum(d),S=Math.abs(_.scaleY)*t.MathUtils.signum(p),_.scaleX=y+(d-y)*l,_.scaleY=S+(p-S)*l;break;case e.add:y=t.MathUtils.signum(d),S=t.MathUtils.signum(p),_.scaleX=Math.abs(_.scaleX)*y+(d-Math.abs(_.data.scaleX)*y)*l,_.scaleY=Math.abs(_.scaleY)*S+(p-Math.abs(_.data.scaleY)*S)*l}}}},o}(s);t.ScaleTimeline=c;var l=function(t){function n(e){return t.call(this,e)||this}return Jlt(n,t),n.prototype.getPropertyId=function(){return(i.shear<<24)+this.boneIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(a<l[0])switch(c){case e.setup:return u.shearX=u.data.shearX,void(u.shearY=u.data.shearY);case e.first:u.shearX+=(u.data.shearX-u.shearX)*s,u.shearY+=(u.data.shearY-u.shearY)*s}else{var h=0,f=0;if(a>=l[l.length-n.ENTRIES])h=l[l.length+n.PREV_X],f=l[l.length+n.PREV_Y];else{var _=r.binarySearch(l,a,n.ENTRIES);h=l[_+n.PREV_X],f=l[_+n.PREV_Y];var d=l[_],p=this.getCurvePercent(_/n.ENTRIES-1,1-(a-d)/(l[_+n.PREV_TIME]-d));h+=(l[_+n.X]-h)*p,f+=(l[_+n.Y]-f)*p}switch(c){case e.setup:u.shearX=u.data.shearX+h*s,u.shearY=u.data.shearY+f*s;break;case e.first:case e.replace:u.shearX+=(u.data.shearX+h-u.shearX)*s,u.shearY+=(u.data.shearY+f-u.shearY)*s;break;case e.add:u.shearX+=h*s,u.shearY+=f*s}}},n}(s);t.ShearTimeline=l;var u=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.color<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var u=this.frames;if(i<u[0])switch(c){case e.setup:return void l.color.setFromColor(l.data.color);case e.first:var h=l.color,f=l.data.color;h.add((f.r-h.r)*s,(f.g-h.g)*s,(f.b-h.b)*s,(f.a-h.a)*s)}else{var _=0,d=0,p=0,m=0;if(i>=u[u.length-a.ENTRIES]){var g=u.length;_=u[g+a.PREV_R],d=u[g+a.PREV_G],p=u[g+a.PREV_B],m=u[g+a.PREV_A]}else{var v=r.binarySearch(u,i,a.ENTRIES);_=u[v+a.PREV_R],d=u[v+a.PREV_G],p=u[v+a.PREV_B],m=u[v+a.PREV_A];var y=u[v],S=this.getCurvePercent(v/a.ENTRIES-1,1-(i-y)/(u[v+a.PREV_TIME]-y));_+=(u[v+a.R]-_)*S,d+=(u[v+a.G]-d)*S,p+=(u[v+a.B]-p)*S,m+=(u[v+a.A]-m)*S}1==s?l.color.set(_,d,p,m):(h=l.color,c==e.setup&&h.setFromColor(l.data.color),h.add((_-h.r)*s,(d-h.g)*s,(p-h.b)*s,(m-h.a)*s))}}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_R=-4,a.PREV_G=-3,a.PREV_B=-2,a.PREV_A=-1,a.R=1,a.G=2,a.B=3,a.A=4,a}(a);t.ColorTimeline=u;var h=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.twoColor<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o,s,c,l){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o,this.frames[t+a.R2]=s,this.frames[t+a.G2]=c,this.frames[t+a.B2]=l},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var u=this.frames;if(i<u[0])switch(c){case e.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case e.first:var h=l.color,f=l.darkColor,_=l.data.color,d=l.data.darkColor;h.add((_.r-h.r)*s,(_.g-h.g)*s,(_.b-h.b)*s,(_.a-h.a)*s),f.add((d.r-f.r)*s,(d.g-f.g)*s,(d.b-f.b)*s,0)}else{var p=0,m=0,g=0,v=0,y=0,S=0,T=0;if(i>=u[u.length-a.ENTRIES]){var x=u.length;p=u[x+a.PREV_R],m=u[x+a.PREV_G],g=u[x+a.PREV_B],v=u[x+a.PREV_A],y=u[x+a.PREV_R2],S=u[x+a.PREV_G2],T=u[x+a.PREV_B2]}else{var E=r.binarySearch(u,i,a.ENTRIES);p=u[E+a.PREV_R],m=u[E+a.PREV_G],g=u[E+a.PREV_B],v=u[E+a.PREV_A],y=u[E+a.PREV_R2],S=u[E+a.PREV_G2],T=u[E+a.PREV_B2];var A=u[E],C=this.getCurvePercent(E/a.ENTRIES-1,1-(i-A)/(u[E+a.PREV_TIME]-A));p+=(u[E+a.R]-p)*C,m+=(u[E+a.G]-m)*C,g+=(u[E+a.B]-g)*C,v+=(u[E+a.A]-v)*C,y+=(u[E+a.R2]-y)*C,S+=(u[E+a.G2]-S)*C,T+=(u[E+a.B2]-T)*C}1==s?(l.color.set(p,m,g,v),l.darkColor.set(y,S,T,1)):(h=l.color,f=l.darkColor,c==e.setup&&(h.setFromColor(l.data.color),f.setFromColor(l.data.darkColor)),h.add((p-h.r)*s,(m-h.g)*s,(g-h.b)*s,(v-h.a)*s),f.add((y-f.r)*s,(S-f.g)*s,(T-f.b)*s,0))}}},a.ENTRIES=8,a.PREV_TIME=-8,a.PREV_R=-7,a.PREV_G=-6,a.PREV_B=-5,a.PREV_A=-4,a.PREV_R2=-3,a.PREV_G2=-2,a.PREV_B2=-1,a.R=1,a.G=2,a.B=3,a.A=4,a.R2=5,a.G2=6,a.B2=7,a}(a);t.TwoColorTimeline=h;var f=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return a.prototype.getPropertyId=function(){return(i.attachment<<24)+this.slotIndex},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},a.prototype.apply=function(t,i,a,o,s,c,l){var u=t.slots[this.slotIndex];if(u.bone.active)if(l!=n.mixOut||c!=e.setup){var h=this.frames;if(a<h[0]){if(c==e.setup||c==e.first){var f=u.data.attachmentName;u.setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var _;_=a>=h[h.length-1]?h.length-1:r.binarySearch(h,a,1)-1;var d=this.attachmentNames[_];t.slots[this.slotIndex].setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p=u.data.attachmentName;u.setAttachment(null==p?null:t.getAttachment(this.slotIndex,p))}},a}();t.AttachmentTimeline=f;var _=null,d=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e),i.frameVertices=new Array(e),null==_&&(_=t.Utils.newFloatArray(64)),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.deform<<27)+ +this.attachment.id+this.slotIndex},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},a.prototype.apply=function(n,i,a,o,s,c){var l=n.slots[this.slotIndex];if(l.bone.active){var u=l.getAttachment();if(u instanceof t.VertexAttachment&&u.deformAttachment==this.attachment){var h=l.deform;0==h.length&&(c=e.setup);var f=this.frameVertices,_=f[0].length,d=this.frames;if(a<d[0]){var p=u;switch(c){case e.setup:return void(h.length=0);case e.first:if(1==s){h.length=0;break}var m=t.Utils.setArraySize(h,_);if(null==p.bones)for(var g=p.vertices,v=0;v<_;v++)m[v]+=(g[v]-m[v])*s;else for(s=1-s,v=0;v<_;v++)m[v]*=s}}else{var y=t.Utils.setArraySize(h,_);if(a>=d[d.length-1]){var S=f[d.length-1];if(1==s)if(c==e.add)if(null==(p=u).bones){g=p.vertices;for(var T=0;T<_;T++)y[T]+=S[T]-g[T]}else for(var x=0;x<_;x++)y[x]+=S[x];else t.Utils.arrayCopy(S,0,y,0,_);else switch(c){case e.setup:var E=u;if(null==E.bones){g=E.vertices;for(var A=0;A<_;A++){var C=g[A];y[A]=C+(S[A]-C)*s}}else for(var b=0;b<_;b++)y[b]=S[b]*s;break;case e.first:case e.replace:for(var w=0;w<_;w++)y[w]+=(S[w]-y[w])*s;case e.add:if(null==(p=u).bones){g=p.vertices;for(var I=0;I<_;I++)y[I]+=(S[I]-g[I])*s}else for(var P=0;P<_;P++)y[P]+=S[P]*s}}else{var R=r.binarySearch(d,a),D=f[R-1],O=f[R],N=d[R],M=this.getCurvePercent(R-1,1-(a-N)/(d[R-1]-N));if(1==s)if(c==e.add)if(null==(p=u).bones){g=p.vertices;for(var L=0;L<_;L++){var F=D[L];y[L]+=F+(O[L]-F)*M-g[L]}}else for(var B=0;B<_;B++)F=D[B],y[B]+=F+(O[B]-F)*M;else for(var z=0;z<_;z++)F=D[z],y[z]=F+(O[z]-F)*M;else switch(c){case e.setup:var U=u;if(null==U.bones){g=U.vertices;for(var k=0;k<_;k++)F=D[k],C=g[k],y[k]=C+(F+(O[k]-F)*M-C)*s}else for(var G=0;G<_;G++)F=D[G],y[G]=(F+(O[G]-F)*M)*s;break;case e.first:case e.replace:for(var V=0;V<_;V++)F=D[V],y[V]+=(F+(O[V]-F)*M-y[V])*s;break;case e.add:if(null==(p=u).bones){g=p.vertices;for(var H=0;H<_;H++)F=D[H],y[H]+=(F+(O[H]-F)*M-g[H])*s}else for(var W=0;W<_;W++)F=D[W],y[W]+=(F+(O[W]-F)*M)*s}}}}}},a}(a);t.DeformTimeline=d;var p=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return i.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,n,i,a,o,s){if(null!=i){var c=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,i,a,o,s),e=-1;else if(e>=c[l-1])return;if(!(n<c[0])){var u=0;if(e<c[0])u=0;else for(var h=c[u=r.binarySearch(c,e)];u>0&&c[u-1]==h;)u--;for(;u<l&&n>=c[u];u++)i.push(this.events[u])}}},e}();t.EventTimeline=p;var m=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return a.prototype.getPropertyId=function(){return i.drawOrder<<24},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},a.prototype.apply=function(i,a,o,s,c,l,u){var h=i.drawOrder,f=i.slots;if(u!=n.mixOut||l!=e.setup){var _=this.frames;if(o<_[0])l!=e.setup&&l!=e.first||t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length);else{var d;d=o>=_[_.length-1]?_.length-1:r.binarySearch(_,o)-1;var p=this.drawOrders[d];if(null==p)t.Utils.arrayCopy(f,0,h,0,f.length);else for(var m=0,g=p.length;m<g;m++)h[m]=f[p[m]]}}else t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length)},a}();t.DrawOrderTimeline=m;var g=function(a){function o(e){var n=a.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return Jlt(o,a),o.prototype.getPropertyId=function(){return(i.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(t,e,n,i,r,a,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.MIX]=n,this.frames[t+o.SOFTNESS]=i,this.frames[t+o.BEND_DIRECTION]=r,this.frames[t+o.COMPRESS]=a?1:0,this.frames[t+o.STRETCH]=s?1:0},o.prototype.apply=function(t,i,a,s,c,l,u){var h=this.frames,f=t.ikConstraints[this.ikConstraintIndex];if(f.active)if(a<h[0])switch(l){case e.setup:return f.mix=f.data.mix,f.softness=f.data.softness,f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,void(f.stretch=f.data.stretch);case e.first:f.mix+=(f.data.mix-f.mix)*c,f.softness+=(f.data.softness-f.softness)*c,f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch}else if(a>=h[h.length-o.ENTRIES])l==e.setup?(f.mix=f.data.mix+(h[h.length+o.PREV_MIX]-f.data.mix)*c,f.softness=f.data.softness+(h[h.length+o.PREV_SOFTNESS]-f.data.softness)*c,u==n.mixOut?(f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch):(f.bendDirection=h[h.length+o.PREV_BEND_DIRECTION],f.compress=0!=h[h.length+o.PREV_COMPRESS],f.stretch=0!=h[h.length+o.PREV_STRETCH])):(f.mix+=(h[h.length+o.PREV_MIX]-f.mix)*c,f.softness+=(h[h.length+o.PREV_SOFTNESS]-f.softness)*c,u==n.mixIn&&(f.bendDirection=h[h.length+o.PREV_BEND_DIRECTION],f.compress=0!=h[h.length+o.PREV_COMPRESS],f.stretch=0!=h[h.length+o.PREV_STRETCH]));else{var _=r.binarySearch(h,a,o.ENTRIES),d=h[_+o.PREV_MIX],p=h[_+o.PREV_SOFTNESS],m=h[_],g=this.getCurvePercent(_/o.ENTRIES-1,1-(a-m)/(h[_+o.PREV_TIME]-m));l==e.setup?(f.mix=f.data.mix+(d+(h[_+o.MIX]-d)*g-f.data.mix)*c,f.softness=f.data.softness+(p+(h[_+o.SOFTNESS]-p)*g-f.data.softness)*c,u==n.mixOut?(f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch):(f.bendDirection=h[_+o.PREV_BEND_DIRECTION],f.compress=0!=h[_+o.PREV_COMPRESS],f.stretch=0!=h[_+o.PREV_STRETCH])):(f.mix+=(d+(h[_+o.MIX]-d)*g-f.mix)*c,f.softness+=(p+(h[_+o.SOFTNESS]-p)*g-f.softness)*c,u==n.mixIn&&(f.bendDirection=h[_+o.PREV_BEND_DIRECTION],f.compress=0!=h[_+o.PREV_COMPRESS],f.stretch=0!=h[_+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(a);t.IkConstraintTimeline=g;var v=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.transformConstraint<<24)+this.transformConstraintIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i,this.frames[t+a.SCALE]=r,this.frames[t+a.SHEAR]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.transformConstraints[this.transformConstraintIndex];if(u.active)if(i<l[0]){var h=u.data;switch(c){case e.setup:return u.rotateMix=h.rotateMix,u.translateMix=h.translateMix,u.scaleMix=h.scaleMix,void(u.shearMix=h.shearMix);case e.first:u.rotateMix+=(h.rotateMix-u.rotateMix)*s,u.translateMix+=(h.translateMix-u.translateMix)*s,u.scaleMix+=(h.scaleMix-u.scaleMix)*s,u.shearMix+=(h.shearMix-u.shearMix)*s}}else{var f=0,_=0,d=0,p=0;if(i>=l[l.length-a.ENTRIES]){var m=l.length;f=l[m+a.PREV_ROTATE],_=l[m+a.PREV_TRANSLATE],d=l[m+a.PREV_SCALE],p=l[m+a.PREV_SHEAR]}else{var g=r.binarySearch(l,i,a.ENTRIES);f=l[g+a.PREV_ROTATE],_=l[g+a.PREV_TRANSLATE],d=l[g+a.PREV_SCALE],p=l[g+a.PREV_SHEAR];var v=l[g],y=this.getCurvePercent(g/a.ENTRIES-1,1-(i-v)/(l[g+a.PREV_TIME]-v));f+=(l[g+a.ROTATE]-f)*y,_+=(l[g+a.TRANSLATE]-_)*y,d+=(l[g+a.SCALE]-d)*y,p+=(l[g+a.SHEAR]-p)*y}c==e.setup?(h=u.data,u.rotateMix=h.rotateMix+(f-h.rotateMix)*s,u.translateMix=h.translateMix+(_-h.translateMix)*s,u.scaleMix=h.scaleMix+(d-h.scaleMix)*s,u.shearMix=h.shearMix+(p-h.shearMix)*s):(u.rotateMix+=(f-u.rotateMix)*s,u.translateMix+=(_-u.translateMix)*s,u.scaleMix+=(d-u.scaleMix)*s,u.shearMix+=(p-u.shearMix)*s)}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_ROTATE=-4,a.PREV_TRANSLATE=-3,a.PREV_SCALE=-2,a.PREV_SHEAR=-1,a.ROTATE=1,a.TRANSLATE=2,a.SCALE=3,a.SHEAR=4,a}(a);t.TransformConstraintTimeline=v;var y=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintPosition<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return void(u.position=u.data.position);case e.first:u.position+=(u.data.position-u.position)*s}else{var h=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_VALUE];else{var f=r.binarySearch(l,i,a.ENTRIES);h=l[f+a.PREV_VALUE];var _=l[f],d=this.getCurvePercent(f/a.ENTRIES-1,1-(i-_)/(l[f+a.PREV_TIME]-_));h+=(l[f+a.VALUE]-h)*d}c==e.setup?u.position=u.data.position+(h-u.data.position)*s:u.position+=(h-u.position)*s}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_VALUE=-1,a.VALUE=1,a}(a);t.PathConstraintPositionTimeline=y;var S=function(t){function n(e){return t.call(this,e)||this}return Jlt(n,t),n.prototype.getPropertyId=function(){return(i.pathConstraintSpacing<<24)+this.pathConstraintIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(a<l[0])switch(c){case e.setup:return void(u.spacing=u.data.spacing);case e.first:u.spacing+=(u.data.spacing-u.spacing)*s}else{var h=0;if(a>=l[l.length-n.ENTRIES])h=l[l.length+n.PREV_VALUE];else{var f=r.binarySearch(l,a,n.ENTRIES);h=l[f+n.PREV_VALUE];var _=l[f],d=this.getCurvePercent(f/n.ENTRIES-1,1-(a-_)/(l[f+n.PREV_TIME]-_));h+=(l[f+n.VALUE]-h)*d}c==e.setup?u.spacing=u.data.spacing+(h-u.data.spacing)*s:u.spacing+=(h-u.spacing)*s}},n}(y);t.PathConstraintSpacingTimeline=S;var T=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return Jlt(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintMix<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return u.rotateMix=u.data.rotateMix,void(u.translateMix=u.data.translateMix);case e.first:u.rotateMix+=(u.data.rotateMix-u.rotateMix)*s,u.translateMix+=(u.data.translateMix-u.translateMix)*s}else{var h=0,f=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_ROTATE],f=l[l.length+a.PREV_TRANSLATE];else{var _=r.binarySearch(l,i,a.ENTRIES);h=l[_+a.PREV_ROTATE],f=l[_+a.PREV_TRANSLATE];var d=l[_],p=this.getCurvePercent(_/a.ENTRIES-1,1-(i-d)/(l[_+a.PREV_TIME]-d));h+=(l[_+a.ROTATE]-h)*p,f+=(l[_+a.TRANSLATE]-f)*p}c==e.setup?(u.rotateMix=u.data.rotateMix+(h-u.data.rotateMix)*s,u.translateMix=u.data.translateMix+(f-u.data.translateMix)*s):(u.rotateMix+=(h-u.rotateMix)*s,u.translateMix+=(f-u.translateMix)*s)}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_ROTATE=-2,a.PREV_TRANSLATE=-1,a.ROTATE=1,a.TRANSLATE=2,a}(a);t.PathConstraintMixTimeline=T}(Qlt||(Qlt={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new r(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new n})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,i=e.length;n<i;n++){var r=e[n];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var a=t*r.timeScale;if(r.delay>0){if(r.delay-=a,r.delay>0)continue;a=-r.delay,r.delay=0}var o=r.next;if(null!=o){var s=r.trackLast-o.delay;if(s>=0){for(o.delay=0,o.trackTime+=0==r.timeScale?0:(s/r.timeScale+t)*o.timeScale,r.trackTime+=a,this.setCurrent(n,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[n]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var c=r.mixingFrom;for(r.mixingFrom=null,null!=c&&(c.mixingTo=null);null!=c;)this.queue.end(c),c=c.mixingFrom}r.trackTime+=a}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var i=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),i):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(n){if(null==n)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var i=this.events,r=this.tracks,a=!1,o=0,s=r.length;o<s;o++){var c=r[o];if(!(null==c||c.delay>0)){a=!0;var l=0==o?t.MixBlend.first:c.mixBlend,u=c.alpha;null!=c.mixingFrom?u*=this.applyMixingFrom(c,n,l):c.trackTime>=c.trackEnd&&null==c.next&&(u=0);var h=c.animationLast,f=c.getAnimationTime(),_=c.animation.timelines.length,d=c.animation.timelines;if(0==o&&1==u||l==t.MixBlend.add)for(var p=0;p<_;p++)t.Utils.webkit602BugfixHelper(u,l),d[p].apply(n,h,f,i,u,l,t.MixDirection.mixIn);else{var m=c.timelineMode,g=0==c.timelinesRotation.length;g&&t.Utils.setArraySize(c.timelinesRotation,_<<1,null);var v=c.timelinesRotation;for(p=0;p<_;p++){var y=d[p],S=(m[p]&e.NOT_LAST-1)==e.SUBSEQUENT?l:t.MixBlend.setup;y instanceof t.RotateTimeline?this.applyRotateTimeline(y,n,f,u,S,v,p<<1,g):(t.Utils.webkit602BugfixHelper(u,l),y.apply(n,h,f,i,u,S,t.MixDirection.mixIn))}}this.queueEvents(c,f),i.length=0,c.nextAnimationLast=f,c.nextTrackLast=c.trackTime}}return this.queue.drain(),a},e.prototype.applyMixingFrom=function(n,i,r){var a=n.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,i,r);var o=0;0==n.mixDuration?(o=1,r==t.MixBlend.first&&(r=t.MixBlend.setup)):((o=n.mixTime/n.mixDuration)>1&&(o=1),r!=t.MixBlend.first&&(r=a.mixBlend));var s=o<a.eventThreshold?this.events:null,c=o<a.attachmentThreshold,l=o<a.drawOrderThreshold,u=a.animationLast,h=a.getAnimationTime(),f=a.animation.timelines.length,_=a.animation.timelines,d=a.alpha*n.interruptAlpha,p=d*(1-o);if(r==t.MixBlend.add)for(var m=0;m<f;m++)_[m].apply(i,u,h,s,p,r,t.MixDirection.mixOut);else{var g=a.timelineMode,v=a.timelineHoldMix,y=0==a.timelinesRotation.length;y&&t.Utils.setArraySize(a.timelinesRotation,f<<1,null);var S=a.timelinesRotation;for(a.totalAlpha=0,m=0;m<f;m++){var T=_[m],x=t.MixDirection.mixOut,E=void 0,A=0;switch(g[m]&e.NOT_LAST-1){case e.SUBSEQUENT:if(E=r,!c&&T instanceof t.AttachmentTimeline){if((g[m]&e.NOT_LAST)==e.NOT_LAST)continue;E=t.MixBlend.setup}if(!l&&T instanceof t.DrawOrderTimeline)continue;A=p;break;case e.FIRST:E=t.MixBlend.setup,A=p;break;case e.HOLD:E=t.MixBlend.setup,A=d;break;default:E=t.MixBlend.setup;var C=v[m];A=d*Math.max(0,1-C.mixTime/C.mixDuration)}a.totalAlpha+=A,T instanceof t.RotateTimeline?this.applyRotateTimeline(T,i,h,A,E,S,m<<1,y):(t.Utils.webkit602BugfixHelper(A,r),E==t.MixBlend.setup&&(T instanceof t.AttachmentTimeline?(c||(g[m]&e.NOT_LAST)==e.NOT_LAST)&&(x=t.MixDirection.mixIn):T instanceof t.DrawOrderTimeline&&l&&(x=t.MixDirection.mixIn)),T.apply(i,u,h,s,A,E,x))}}return n.mixDuration>0&&this.queueEvents(a,h),this.events.length=0,a.nextAnimationLast=h,a.nextTrackLast=a.trackTime,o},e.prototype.applyRotateTimeline=function(e,n,i,r,a,o,s,c){if(c&&(o[s]=0),1!=r){var l=e,u=l.frames,h=n.bones[l.boneIndex];if(h.active){var f=0,_=0;if(i<u[0])switch(a){case t.MixBlend.setup:h.rotation=h.data.rotation;default:return;case t.MixBlend.first:f=h.rotation,_=h.data.rotation}else if(f=a==t.MixBlend.setup?h.data.rotation:h.rotation,i>=u[u.length-t.RotateTimeline.ENTRIES])_=h.data.rotation+u[u.length+t.RotateTimeline.PREV_ROTATION];else{var d=t.Animation.binarySearch(u,i,t.RotateTimeline.ENTRIES),p=u[d+t.RotateTimeline.PREV_ROTATION],m=u[d],g=l.getCurvePercent((d>>1)-1,1-(i-m)/(u[d+t.RotateTimeline.PREV_TIME]-m));_=u[d+t.RotateTimeline.ROTATION]-p,_=p+(_-=360*(16384-(16384.499999999996-_/360|0)))*g+h.data.rotation,_-=360*(16384-(16384.499999999996-_/360|0))}var v=0,y=_-f;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))v=o[s];else{var S=0,T=0;c?(S=0,T=y):(S=o[s],T=o[s+1]);var x=y>0,E=S>=0;t.MathUtils.signum(T)!=t.MathUtils.signum(y)&&Math.abs(T)<=90&&(Math.abs(S)>180&&(S+=360*t.MathUtils.signum(S)),E=x),v=y+S-S%360,E!=x&&(v+=360*t.MathUtils.signum(S)),o[s]=v}o[s+1]=y,f+=v*r,h.rotation=f-360*(16384-(16384.499999999996-f/360|0))}}else e.apply(n,0,i,null,1,a,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var n=t.animationStart,i=t.animationEnd,r=i-n,a=t.trackLast%r,o=this.events,s=0,c=o.length;s<c;s++){var l=o[s];if(l.time<a)break;l.time>i||this.queue.event(t,l)}for((t.loop?0==r||a>t.trackTime%r:e>=i&&t.animationLast<i)&&this.queue.complete(t);s<c;s++)o[s].time<n||this.queue.event(t,o[s])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var i=n.mixingFrom;if(null==i)break;this.queue.end(i),n.mixingFrom=null,n.mixingTo=null,n=i}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,n){var i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(n&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,n)},e.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var i=!0,r=this.expandToIndex(t);null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,i=!1):this.disposeNext(r));var a=this.trackEntry(t,e,n,r);return this.setCurrent(t,a,i),this.queue.drain(),a},e.prototype.addAnimation=function(t,e,n,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,n,i)},e.prototype.addAnimationWith=function(t,e,n,i){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;var a=this.trackEntry(t,e,n,r);if(null==r)this.setCurrent(t,a,!0),this.queue.drain();else if(r.next=a,i<=0){var o=r.animationEnd-r.animationStart;0!=o?(r.loop?i+=o*(1+(r.trackTime/o|0)):i+=Math.max(o,r.trackTime),i-=this.data.getMix(r.animation,e)):i=r.trackTime}return a.delay=i,a},e.prototype.setEmptyAnimation=function(t,n){var i=this.setAnimationWith(t,e.emptyAnimation,!1);return i.mixDuration=n,i.trackEnd=n,i},e.prototype.addEmptyAnimation=function(t,n,i){i<=0&&(i-=n);var r=this.addAnimationWith(t,e.emptyAnimation,!1,i);return r.mixDuration=n,r.trackEnd=n,r},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,i=this.tracks.length;n<i;n++){var r=this.tracks[n];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,n,i){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=n,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==i?0:this.data.getMix(i.animation,e),r},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,n=this.tracks.length;e<n;e++)if(null!=(i=this.tracks[e])){for(;null!=i.mixingFrom;)i=i.mixingFrom;do{null!=i.mixingFrom&&i.mixBlend==t.MixBlend.add||this.computeHold(i),i=i.mixingTo}while(null!=i)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var i=this.tracks[e];null!=i;)this.computeNotLast(i),i=i.mixingFrom},e.prototype.computeHold=function(n){var i=n.mixingTo,r=n.animation.timelines,a=n.animation.timelines.length,o=t.Utils.setArraySize(n.timelineMode,a);n.timelineHoldMix.length=0;var s=t.Utils.setArraySize(n.timelineHoldMix,a),c=this.propertyIDs;if(null!=i&&i.holdPrevious)for(var l=0;l<a;l++)c.add(r[l].getPropertyId()),o[l]=e.HOLD;else t:for(l=0;l<a;l++){var u=r[l],h=u.getPropertyId();if(c.add(h))if(null==i||u instanceof t.AttachmentTimeline||u instanceof t.DrawOrderTimeline||u instanceof t.EventTimeline||!i.animation.hasTimeline(h))o[l]=e.FIRST;else{for(var f=i.mixingTo;null!=f;f=f.mixingTo)if(!f.animation.hasTimeline(h)){if(n.mixDuration>0){o[l]=e.HOLD_MIX,s[l]=f;continue t}break}o[l]=e.HOLD}else o[l]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(n){for(var i=n.animation.timelines,r=n.animation.timelines.length,a=n.timelineMode,o=this.propertyIDs,s=0;s<r;s++)if(i[s]instanceof t.AttachmentTimeline){var c=i[s];o.add(c.slotIndex)||(a[s]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var n=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=n;var i,r=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(i.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(i.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(i.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(i.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(i.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(i.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],a=t[n+1];switch(r){case i.start:null!=a.listener&&a.listener.start&&a.listener.start(a);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(a);break;case i.interrupt:for(null!=a.listener&&a.listener.interrupt&&a.listener.interrupt(a),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(a);break;case i.end:for(null!=a.listener&&a.listener.end&&a.listener.end(a),o=0;o<e.length;o++)e[o].end&&e[o].end(a);case i.dispose:for(null!=a.listener&&a.listener.dispose&&a.listener.dispose(a),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(a);this.animState.trackEntryPool.free(a);break;case i.complete:for(null!=a.listener&&a.listener.complete&&a.listener.complete(a),o=0;o<e.length;o++)e[o].complete&&e[o].complete(a);break;case i.event:var s=t[2+n++];for(null!=a.listener&&a.listener.event&&a.listener.event(a,s),o=0;o<e.length;o++)e[o].event&&e[o].event(a,s)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=r,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(i=t.EventType||(t.EventType={}));var a=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=a}(Qlt||(Qlt={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var i=this.skeletonData.findAnimation(t);if(null==i)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);this.setMixWith(i,r,n)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var i=t.name+"."+e.name;this.animationToMixTime[i]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,i=this.animationToMixTime[n];return void 0===i?this.defaultMix:i},t}();t.AnimationStateData=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){200==i.status?e(i.responseText):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.downloadBinary=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status?e(new Uint8Array(i.response)):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.prototype.loadBinary=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load binary "+t+": status "+status+", "+n,i&&i(t,"Couldn't load binary "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadText=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load text "+t+": status "+status+", "+n,i&&i(t,"Couldn't load text "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadTexture=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var n=i.textureLoader(r);i.assets[t]=n,i.toLoad--,i.loaded++,e&&e(t,r)},r.onerror=function(){i.errors[t]="Couldn't load image "+t,i.toLoad--,i.loaded++,n&&n(t,"Couldn't load image "+t)},r.src=t},e.prototype.loadTextureData=function(t,e,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var a=new Image;a.onload=function(){var e=r.textureLoader(a);r.assets[t]=e,r.toLoad--,r.loaded++,n&&n(t,a)},a.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},a.src=e},e.prototype.loadTextureAtlas=function(n,i,r){var a=this;void 0===i&&(i=null),void 0===r&&(r=null);var o=n.lastIndexOf("/")>=0?n.substring(0,n.lastIndexOf("/")):"";n=this.pathPrefix+n,this.toLoad++,e.downloadText(n,(function(e){var s={count:0},c=new Array;try{new t.TextureAtlas(e,(function(e){c.push(o+"/"+e);var n=document.createElement("img");return n.width=16,n.height=16,new t.FakeTexture(n)}))}catch(t){var l=t;return a.errors[n]="Couldn't load texture atlas "+n+": "+l.message,r&&r(n,"Couldn't load texture atlas "+n+": "+l.message),a.toLoad--,void a.loaded++}for(var u=function(l){var u=!1;a.loadTexture(l,(function(l){if(s.count++,s.count==c.length)if(u)a.errors[n]="Couldn't load texture atlas page "+l+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+l+" of atlas "+n),a.toLoad--,a.loaded++;else try{var h=new t.TextureAtlas(e,(function(t){return a.get(o+"/"+t)}));a.assets[n]=h,i&&i(n,h),a.toLoad--,a.loaded++}catch(t){var f=t;a.errors[n]="Couldn't load texture atlas "+n+": "+f.message,r&&r(n,"Couldn't load texture atlas "+n+": "+f.message),a.toLoad--,a.loaded++}}),(function(t){u=!0,s.count++,s.count==c.length&&(a.errors[n]="Couldn't load texture atlas page "+t+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+t+" of atlas "+n),a.toLoad--,a.loaded++)}))},h=0,f=c;h<f.length;h++)u(f[h])}),(function(t,e){a.errors[n]="Couldn't load texture atlas "+n+": status "+status+", "+e,r&&r(n,"Couldn't load texture atlas "+n+": status "+status+", "+e),a.toLoad--,a.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.RegionAttachment(n);return a.setRegion(r),a},e.prototype.newMeshAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.MeshAttachment(n);return a.region=r,a},e.prototype.newBoundingBoxAttachment=function(e,n){return new t.BoundingBoxAttachment(n)},e.prototype.newPathAttachment=function(e,n){return new t.PathAttachment(n)},e.prototype.newPointAttachment=function(e,n){return new t.PointAttachment(n)},e.prototype.newClippingAttachment=function(e,n){return new t.ClippingAttachment(n)},e}();t.AtlasAttachmentLoader=e}(Qlt||(Qlt={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={}))}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e,n){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,n,i,r,a,o,s){this.ax=e,this.ay=n,this.arotation=i,this.ascaleX=r,this.ascaleY=a,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var c=this.parent;if(null==c){var l=this.skeleton,u=i+90+s,h=l.scaleX,f=l.scaleY;return this.a=t.MathUtils.cosDeg(i+o)*r*h,this.b=t.MathUtils.cosDeg(u)*a*h,this.c=t.MathUtils.sinDeg(i+o)*r*f,this.d=t.MathUtils.sinDeg(u)*a*f,this.worldX=e*h+l.x,void(this.worldY=n*f+l.y)}var _=c.a,d=c.b,p=c.c,m=c.d;switch(this.worldX=_*e+d*n+c.worldX,this.worldY=p*e+m*n+c.worldY,this.data.transformMode){case t.TransformMode.Normal:u=i+90+s;var g=t.MathUtils.cosDeg(i+o)*r,v=t.MathUtils.cosDeg(u)*a,y=t.MathUtils.sinDeg(i+o)*r,S=t.MathUtils.sinDeg(u)*a;return this.a=_*g+d*y,this.b=_*v+d*S,this.c=p*g+m*y,void(this.d=p*v+m*S);case t.TransformMode.OnlyTranslation:u=i+90+s,this.a=t.MathUtils.cosDeg(i+o)*r,this.b=t.MathUtils.cosDeg(u)*a,this.c=t.MathUtils.sinDeg(i+o)*r,this.d=t.MathUtils.sinDeg(u)*a;break;case t.TransformMode.NoRotationOrReflection:var T=0;(A=_*_+p*p)>1e-4?(d=p*(A=Math.abs(_*m-d*p)/A),m=_*A,T=Math.atan2(p,_)*t.MathUtils.radDeg):(_=0,p=0,T=90-Math.atan2(m,d)*t.MathUtils.radDeg);var x=i+o-T,E=i+s-T+90;g=t.MathUtils.cosDeg(x)*r,v=t.MathUtils.cosDeg(E)*a,y=t.MathUtils.sinDeg(x)*r,S=t.MathUtils.sinDeg(E)*a,this.a=_*g-d*y,this.b=_*v-d*S,this.c=p*g+m*y,this.d=p*v+m*S;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var A,C=t.MathUtils.cosDeg(i),b=t.MathUtils.sinDeg(i),w=(_*C+d*b)/this.skeleton.scaleX,I=(p*C+m*b)/this.skeleton.scaleY;(A=Math.sqrt(w*w+I*I))>1e-5&&(A=1/A),w*=A,I*=A,A=Math.sqrt(w*w+I*I),this.data.transformMode==t.TransformMode.NoScale&&_*m-d*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(A=-A);var P=Math.PI/2+Math.atan2(I,w),R=Math.cos(P)*A,D=Math.sin(P)*A;g=t.MathUtils.cosDeg(o)*r,v=t.MathUtils.cosDeg(90+s)*a,y=t.MathUtils.sinDeg(o)*r,S=t.MathUtils.sinDeg(90+s)*a,this.a=w*g+R*y,this.b=w*v+R*S,this.c=I*g+D*y,this.d=I*v+D*S}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var n=e.a,i=e.b,r=e.c,a=e.d,o=1/(n*a-i*r),s=this.worldX-e.worldX,c=this.worldY-e.worldY;this.ax=s*a*o-c*i*o,this.ay=c*n*o-s*r*o;var l=o*a,u=o*n,h=o*i,f=o*r,_=l*this.a-h*this.c,d=l*this.b-h*this.d,p=u*this.c-f*this.a,m=u*this.d-f*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(_*_+p*p),this.ascaleX>1e-4){var g=_*m-d*p;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(_*d+p*m,g)*t.MathUtils.radDeg,this.arotation=Math.atan2(p,_)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(d*d+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,d)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,a=1/(e*r-n*i),o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*r*a-s*n*a,t.y=s*e*a-o*i*a,t},e.prototype.localToWorld=function(t){var e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(this.a*n-this.c*i,this.d*i-this.b*n)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(i*this.c+n*this.d,i*this.a+n*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var n=this.a,i=this.b,r=this.c,a=this.d,o=t.MathUtils.cosDeg(e),s=t.MathUtils.sinDeg(e);this.a=o*n-s*r,this.b=o*i-s*a,this.c=s*n+o*r,this.d=s*i+o*a,this.appliedValid=!1},e}();t.Bone=e}(Qlt||(Qlt={})),function(t){var e;t.BoneData=function(n,i,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,n<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");this.index=n,this.name=i,this.parent=r},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(Qlt||(Qlt={})),function(t){t.ConstraintData=function(t,e,n){this.name=t,this.order=e,this.skinRequired=n}}(Qlt||(Qlt={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(Qlt||(Qlt={})),function(t){t.EventData=function(t){this.name=t}}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,n,i,r,a,o,s){e.appliedValid||e.updateAppliedTransform();var c=e.parent,l=1/(c.a*c.d-c.b*c.c),u=n-c.worldX,h=i-c.worldY,f=(u*c.d-h*c.b)*l-e.ax,_=(h*c.a-u*c.c)*l-e.ay,d=Math.atan2(_,f)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var p=e.ascaleX,m=e.ascaleY;if(r||a){var g=e.data.length*p,v=Math.sqrt(f*f+_*_);if(r&&v<g||a&&v>g&&g>1e-4){var y=(v/g-1)*s+1;p*=y,o&&(m*=y)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+d*s,p,m,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,n,i,r,a,o,s,c){if(0!=c){e.appliedValid||e.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();var l=e.ax,u=e.ay,h=e.ascaleX,f=h,_=e.ascaleY,d=n.ascaleX,p=0,m=0,g=0;h<0?(h=-h,p=180,g=-1):(p=0,g=1),_<0&&(_=-_,g=-g),d<0?(d=-d,m=180):m=0;var v=n.ax,y=0,S=0,T=0,x=e.a,E=e.b,A=e.c,C=e.d,b=Math.abs(h-_)<=1e-4;b?(S=x*v+E*(y=n.ay)+e.worldX,T=A*v+C*y+e.worldY):(y=0,S=x*v+e.worldX,T=A*v+e.worldY);var w=e.parent;x=w.a,E=w.b,A=w.c;var I,P,R=1/(x*(C=w.d)-E*A),D=S-w.worldX,O=T-w.worldY,N=(D*C-O*E)*R-l,M=(O*x-D*A)*R-u,L=Math.sqrt(N*N+M*M),F=n.data.length*d;if(L<1e-4)return this.apply1(e,i,r,!1,o,!1,c),void n.updateWorldTransformWith(v,y,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);var B=((D=i-w.worldX)*C-(O=r-w.worldY)*E)*R-l,z=(O*x-D*A)*R-u,U=B*B+z*z;if(0!=s){s*=h*(d+1)/2;var k=Math.sqrt(U),G=k-L-F*h+s;if(G>0){var V=Math.min(1,G/(2*s))-1;U=(B-=(V=(G-s*(1-V*V))/k)*B)*B+(z-=V*z)*z}}t:if(b){var H=(U-L*L-(F*=h)*F)/(2*L*F);H<-1?H=-1:H>1&&(H=1,o&&(f*=(Math.sqrt(U)/(L+F)-1)*c+1)),P=Math.acos(H)*a,x=L+F*H,E=F*Math.sin(P),I=Math.atan2(z*x-B*E,B*x+z*E)}else{var W=(x=h*F)*x,j=(E=_*F)*E,X=Math.atan2(z,B),q=-2*j*L,Y=j-W;if((C=q*q-4*Y*(A=j*L*L+W*U-W*j))>=0){var K=Math.sqrt(C);q<0&&(K=-K);var Q=(K=-(q+K)/2)/Y,J=A/K,Z=Math.abs(Q)<Math.abs(J)?Q:J;if(Z*Z<=U){O=Math.sqrt(U-Z*Z)*a,I=X-Math.atan2(O,Z),P=Math.atan2(O/_,(Z-L)/h);break t}}var $=t.MathUtils.PI,tt=L-x,et=tt*tt,nt=0,it=0,rt=L+x,at=rt*rt,ot=0;(A=-x*L/(W-j))>=-1&&A<=1&&(A=Math.acos(A),(C=(D=x*Math.cos(A)+L)*D+(O=E*Math.sin(A))*O)<et&&($=A,et=C,tt=D,nt=O),C>at&&(it=A,at=C,rt=D,ot=O)),U<=(et+at)/2?(I=X-Math.atan2(nt*a,tt),P=$*a):(I=X-Math.atan2(ot*a,rt),P=it*a)}var st=Math.atan2(y,v)*g,ct=e.arotation;(I=(I-st)*t.MathUtils.radDeg+p-ct)>180?I-=360:I<-180&&(I+=360),e.updateWorldTransformWith(l,u,ct+I*c,f,e.ascaleY,0,0),ct=n.arotation,(P=((P+st)*t.MathUtils.radDeg-n.ashearX)*g+m-ct)>180?P-=360:P<-180&&(P+=360),n.updateWorldTransformWith(v,y,ct+P*c,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}else n.updateWorldTransform()},e}();t.IkConstraint=e}(Qlt||(Qlt={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return Jlt(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,i=t.bones.length;n<i;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var n=this.target.getAttachment();if(n instanceof t.PathAttachment){var i=this.rotateMix,r=this.translateMix,a=i>0;if(r>0||a){var o=this.data,s=o.spacingMode==t.SpacingMode.Percent,c=o.rotateMode,l=c==t.RotateMode.Tangent,u=c==t.RotateMode.ChainScale,h=this.bones.length,f=l?h:h+1,_=this.bones,d=t.Utils.setArraySize(this.spaces,f),p=null,m=this.spacing;if(u||!s){u&&(p=t.Utils.setArraySize(this.lengths,h));for(var g=o.spacingMode==t.SpacingMode.Length,v=0,y=f-1;v<y;){var S=(D=_[v]).data.length;if(S<e.epsilon)u&&(p[v]=0),d[++v]=0;else if(s){if(u){var T=S*D.a,x=S*D.c,E=Math.sqrt(T*T+x*x);p[v]=E}d[++v]=m}else{T=S*D.a,x=S*D.c;var A=Math.sqrt(T*T+x*x);u&&(p[v]=A),d[++v]=(g?S+m:m)*A/S}}}else for(v=1;v<f;v++)d[v]=m;var C=this.computeWorldPositions(n,f,l,o.positionMode==t.PositionMode.Percent,s),b=C[0],w=C[1],I=o.offsetRotation,P=!1;0==I?P=c==t.RotateMode.Chain:(P=!1,I*=(R=this.target.bone).a*R.d-R.b*R.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),v=0;for(var R=3;v<h;v++,R+=3){var D;(D=_[v]).worldX+=(b-D.worldX)*r,D.worldY+=(w-D.worldY)*r;var O=(T=C[R])-b,N=(x=C[R+1])-w;if(u){var M=p[v];if(0!=M){var L=(Math.sqrt(O*O+N*N)/M-1)*i+1;D.a*=L,D.c*=L}}if(b=T,w=x,a){var F=D.a,B=D.b,z=D.c,U=D.d,k=0,G=0,V=0;if(k=l?C[R-1]:0==d[v+1]?C[R+2]:Math.atan2(N,O),k-=Math.atan2(z,F),P){G=Math.cos(k),V=Math.sin(k);var H=D.data.length;b+=(H*(G*F-V*z)-O)*i,w+=(H*(V*F+G*z)-N)*i}else k+=I;k>t.MathUtils.PI?k-=t.MathUtils.PI2:k<-t.MathUtils.PI&&(k+=t.MathUtils.PI2),k*=i,G=Math.cos(k),V=Math.sin(k),D.a=G*F-V*z,D.b=G*B-V*U,D.c=V*F+G*z,D.d=V*B+G*U}D.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(n,i,r,a,o){var s=this.target,c=this.position,l=this.spaces,u=t.Utils.setArraySize(this.positions,3*i+2),h=null,f=n.closed,_=n.worldVerticesLength,d=_/6,p=e.NONE;if(!n.constantSpeed){var m=n.lengths,g=m[d-=f?1:2];if(a&&(c*=g),o)for(var v=1;v<i;v++)l[v]*=g;h=t.Utils.setArraySize(this.world,8),v=0;for(var y=0,S=0;v<i;v++,y+=3){var T=c+=j=l[v];if(f)(T%=g)<0&&(T+=g),S=0;else{if(T<0){p!=e.BEFORE&&(p=e.BEFORE,n.computeWorldVertices(s,2,4,h,0,2)),this.addBeforePosition(T,h,0,u,y);continue}if(T>g){p!=e.AFTER&&(p=e.AFTER,n.computeWorldVertices(s,_-6,4,h,0,2)),this.addAfterPosition(T-g,h,0,u,y);continue}}for(;;S++){var x=m[S];if(!(T>x)){0==S?T/=x:T=(T-(K=m[S-1]))/(x-K);break}}S!=p&&(p=S,f&&S==d?(n.computeWorldVertices(s,_-4,4,h,0,2),n.computeWorldVertices(s,0,4,h,4,2)):n.computeWorldVertices(s,6*S+2,8,h,0,2)),this.addCurvePosition(T,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],u,y,r||v>0&&0==j)}return u}f?(_+=2,h=t.Utils.setArraySize(this.world,_),n.computeWorldVertices(s,2,_-4,h,0,2),n.computeWorldVertices(s,0,2,h,_-4,2),h[_-2]=h[0],h[_-1]=h[1]):(d--,_-=4,h=t.Utils.setArraySize(this.world,_),n.computeWorldVertices(s,2,_,h,0,2));for(var E=t.Utils.setArraySize(this.curves,d),A=0,C=h[0],b=h[1],w=0,I=0,P=0,R=0,D=0,O=0,N=0,M=0,L=0,F=0,B=0,z=0,U=0,k=0,G=(v=0,2);v<d;v++,G+=6)w=h[G],I=h[G+1],P=h[G+2],R=h[G+3],B=2*(N=.1875*(C-2*w+P))+(L=.09375*(3*(w-P)-C+(D=h[G+4]))),z=2*(M=.1875*(b-2*I+R))+(F=.09375*(3*(I-R)-b+(O=h[G+5]))),U=.75*(w-C)+N+.16666667*L,k=.75*(I-b)+M+.16666667*F,A+=Math.sqrt(U*U+k*k),U+=B,k+=z,B+=L,z+=F,A+=Math.sqrt(U*U+k*k),U+=B,k+=z,A+=Math.sqrt(U*U+k*k),U+=B+L,k+=z+F,A+=Math.sqrt(U*U+k*k),E[v]=A,C=D,b=O;if(c*=a?A:A/n.lengths[d-1],o)for(v=1;v<i;v++)l[v]*=A;for(var V=this.segments,H=0,W=(v=0,y=0,S=0,0);v<i;v++,y+=3){var j;if(T=c+=j=l[v],f)(T%=A)<0&&(T+=A),S=0;else{if(T<0){this.addBeforePosition(T,h,0,u,y);continue}if(T>A){this.addAfterPosition(T-A,h,_-4,u,y);continue}}for(;;S++){var X=E[S];if(!(T>X)){0==S?T/=X:T=(T-(K=E[S-1]))/(X-K);break}}if(S!=p){p=S;var q=6*S;for(C=h[q],b=h[q+1],w=h[q+2],I=h[q+3],P=h[q+4],R=h[q+5],B=2*(N=.03*(C-2*w+P))+(L=.006*(3*(w-P)-C+(D=h[q+6]))),z=2*(M=.03*(b-2*I+R))+(F=.006*(3*(I-R)-b+(O=h[q+7]))),U=.3*(w-C)+N+.16666667*L,k=.3*(I-b)+M+.16666667*F,H=Math.sqrt(U*U+k*k),V[0]=H,q=1;q<8;q++)U+=B,k+=z,B+=L,z+=F,H+=Math.sqrt(U*U+k*k),V[q]=H;U+=B,k+=z,H+=Math.sqrt(U*U+k*k),V[8]=H,U+=B+L,k+=z+F,H+=Math.sqrt(U*U+k*k),V[9]=H,W=0}for(T*=H;;W++){var Y=V[W];if(!(T>Y)){var K;0==W?T/=Y:T=W+(T-(K=V[W-1]))/(Y-K);break}}this.addCurvePosition(.1*T,C,b,w,I,P,R,D,O,u,y,r||v>0&&0==j)}return u},e.prototype.addBeforePosition=function(t,e,n,i,r){var a=e[n],o=e[n+1],s=e[n+2]-a,c=e[n+3]-o,l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addAfterPosition=function(t,e,n,i,r){var a=e[n+2],o=e[n+3],s=a-e[n],c=o-e[n+1],l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,u,h){if(0==t||isNaN(t))return l[u]=e,l[u+1]=n,void(l[u+2]=Math.atan2(r-n,i-e));var f=t*t,_=f*t,d=1-t,p=d*d,m=p*d,g=d*t,v=3*g,y=d*v,S=v*t,T=e*m+i*y+a*S+s*_,x=n*m+r*y+o*S+c*_;l[u]=T,l[u+1]=x,h&&(l[u+2]=t<.001?Math.atan2(r-n,i-e):Math.atan2(x-(n*p+r*g*2+o*f),T-(e*p+i*g*2+a*f)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(Qlt||(Qlt={})),function(t){var e,n,i,r=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n}return Jlt(e,t),e}(t.ConstraintData);t.PathConstraintData=r,(i=t.PositionMode||(t.PositionMode={}))[i.Fixed=0]="Fixed",i[i.Percent=1]="Percent",(n=t.SpacingMode||(t.SpacingMode={}))[n.Length=0]="Length",n[n.Fixed=1]="Fixed",n[n.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(Qlt||(Qlt={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),n=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,n,i){var r=this.clientAssets[t];return null==r&&(r=new e(t),this.clientAssets[t]=r),null!==n&&(r.textureLoader=n),r.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},t.prototype.loadText=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadJson=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadTexture=function(t,e,n){var i=this;if(n=this.pathPrefix+n,this.queueAsset(t,e,n)){var r=new Image;r.src=n,r.crossOrigin="anonymous",r.onload=function(){i.rawAssets[n]=r},r.onerror=function(){i.errors[n]="Couldn't load image "+n}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var n=this.clientAssets[t];return null==n||n.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var n=t.toLoad[e];if(null==t.assets[n]){var i=this.rawAssets[n];if(null==i)continue;i instanceof HTMLImageElement?t.assets[n]=t.textureLoader(i):t.assets[n]=i}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=n}(Qlt||(Qlt={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var n=0;n<e.bones.length;n++){var i=e.bones[n],r=void 0;if(null==i.parent)r=new t.Bone(i,this,null);else{var a=this.bones[i.parent.index];r=new t.Bone(i,this,a),a.children.push(r)}this.bones.push(r)}for(this.slots=new Array,this.drawOrder=new Array,n=0;n<e.slots.length;n++){var o=e.slots[n],s=(r=this.bones[o.boneData.index],new t.Slot(o,r));this.slots.push(s),this.drawOrder.push(s)}for(this.ikConstraints=new Array,n=0;n<e.ikConstraints.length;n++){var c=e.ikConstraints[n];this.ikConstraints.push(new t.IkConstraint(c,this))}for(this.transformConstraints=new Array,n=0;n<e.transformConstraints.length;n++){var l=e.transformConstraints[n];this.transformConstraints.push(new t.TransformConstraint(l,this))}for(this.pathConstraints=new Array,n=0;n<e.pathConstraints.length;n++){var u=e.pathConstraints[n];this.pathConstraints.push(new t.PathConstraint(u,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin){var i=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var r=this.bones[i[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(null!=r)}}var a=this.ikConstraints,o=this.transformConstraints,s=this.pathConstraints,c=a.length,l=o.length,u=s.length,h=c+l+u;t:for(e=0;e<h;e++){for(var f=0;f<c;f++)if((_=a[f]).data.order==e){this.sortIkConstraint(_);continue t}for(f=0;f<l;f++)if((_=o[f]).data.order==e){this.sortTransformConstraint(_);continue t}for(f=0;f<u;f++){var _;if((_=s[f]).data.order==e){this.sortPathConstraint(_);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target;this.sortBone(n);var i=e.bones,r=i[0];if(this.sortBone(r),i.length>1){var a=i[i.length-1];this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}this._updateCache.push(e),this.sortReset(r.children),i[i.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target,i=n.data.index,r=n.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,r);for(var a=0,o=this.data.skins.length;a<o;a++)this.sortPathConstraintAttachment(this.data.skins[a],i,r);var s=n.getAttachment();s instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(s,r);var c=e.bones,l=c.length;for(a=0;a<l;a++)this.sortBone(c[a]);for(this._updateCache.push(e),a=0;a<l;a++)this.sortReset(c[a].children);for(a=0;a<l;a++)c[a].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var n=e.bones,i=n.length;if(e.data.local)for(var r=0;r<i;r++){var a=n[r];this.sortBone(a.parent),this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}else for(r=0;r<i;r++)this.sortBone(n[r]);this._updateCache.push(e);for(var o=0;o<i;o++)this.sortReset(n[o].children);for(o=0;o<i;o++)n[o].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,n){var i=t.attachments[e];if(i)for(var r in i)this.sortPathConstraintAttachmentWith(i[r],n)},e.prototype.sortPathConstraintAttachmentWith=function(e,n){if(e instanceof t.PathAttachment){var i=e.bones;if(null==i)this.sortBone(n);else for(var r=this.bones,a=0;a<i.length;)for(var o=i[a++],s=a+o;a<s;a++){var c=i[a];this.sortBone(r[c])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var i=t[e];i.ax=i.x,i.ay=i.y,i.arotation=i.rotation,i.ascaleX=i.scaleX,i.ascaleY=i.scaleY,i.ashearX=i.shearX,i.ashearY=i.shearY,i.appliedValid=!0}var r=this._updateCache;for(e=0,n=r.length;e<n;e++)r[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var i=this.ikConstraints;for(e=0,n=i.length;e<n;e++)(s=i[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;var r=this.transformConstraints;for(e=0,n=r.length;e<n;e++){var a=(s=r[e]).data;s.rotateMix=a.rotateMix,s.translateMix=a.translateMix,s.scaleMix=a.scaleMix,s.shearMix=a.shearMix}var o=this.pathConstraints;for(e=0,n=o.length;e<n;e++){var s;a=(s=o[e]).data,s.position=a.position,s.spacing=a.spacing,s.rotateMix=a.rotateMix,s.translateMix=a.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var n=0,i=e.length;n<i;n++)e[n].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n],a=r.data.attachmentName;if(null!=a){var o=t.getAttachment(n,a);null!=o&&r.setAttachment(o)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,i=0,r=n.length;i<r;i++){var a=n[i];if(a.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(i,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void a.setAttachment(o)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.getBounds=function(e,n,i){if(void 0===i&&(i=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==n)throw new Error("size cannot be null.");for(var r=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=0,u=r.length;l<u;l++){var h=r[l];if(h.bone.active){var f=0,_=null,d=h.getAttachment();if(d instanceof t.RegionAttachment)f=8,_=t.Utils.setArraySize(i,f,0),d.computeWorldVertices(h.bone,_,0,2);else if(d instanceof t.MeshAttachment){var p=d;f=p.worldVerticesLength,_=t.Utils.setArraySize(i,f,0),p.computeWorldVertices(h,0,f,_,0,2)}if(null!=_)for(var m=0,g=_.length;m<g;m+=2){var v=_[m],y=_[m+1];a=Math.min(a,v),o=Math.min(o,y),s=Math.max(s,v),c=Math.max(c,y)}}}e.set(a,o),n.set(s-a,c-o)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,a=new t.SkeletonData;a.name="";var o=new n(i);a.hash=o.readString(),a.version=o.readString(),a.x=o.readFloat(),a.y=o.readFloat(),a.width=o.readFloat(),a.height=o.readFloat();var s=o.readBoolean();s&&(a.fps=o.readFloat(),a.imagesPath=o.readString(),a.audioPath=o.readString());var c=0;c=o.readInt(!0);for(var l=0;l<c;l++)o.strings.push(o.readString());for(c=o.readInt(!0),l=0;l<c;l++){var u=o.readString(),h=0==l?null:a.bones[o.readInt(!0)];(d=new t.BoneData(l,u,h)).rotation=o.readFloat(),d.x=o.readFloat()*r,d.y=o.readFloat()*r,d.scaleX=o.readFloat(),d.scaleY=o.readFloat(),d.shearX=o.readFloat(),d.shearY=o.readFloat(),d.length=o.readFloat()*r,d.transformMode=e.TransformModeValues[o.readInt(!0)],d.skinRequired=o.readBoolean(),s&&t.Color.rgba8888ToColor(d.color,o.readInt32()),a.bones.push(d)}for(c=o.readInt(!0),l=0;l<c;l++){var f=o.readString(),_=a.bones[o.readInt(!0)],d=new t.SlotData(l,f,_);t.Color.rgba8888ToColor(d.color,o.readInt32());var p=o.readInt32();-1!=p&&t.Color.rgb888ToColor(d.darkColor=new t.Color,p),d.attachmentName=o.readStringRef(),d.blendMode=e.BlendModeValues[o.readInt(!0)],a.slots.push(d)}c=o.readInt(!0),l=0;for(var m=void 0;l<c;l++){(d=new t.IkConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0);for(var g=0;g<m;g++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.mix=o.readFloat(),d.softness=o.readFloat()*r,d.bendDirection=o.readByte(),d.compress=o.readBoolean(),d.stretch=o.readBoolean(),d.uniform=o.readBoolean(),a.ikConstraints.push(d)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((d=new t.TransformConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.local=o.readBoolean(),d.relative=o.readBoolean(),d.offsetRotation=o.readFloat(),d.offsetX=o.readFloat()*r,d.offsetY=o.readFloat()*r,d.offsetScaleX=o.readFloat(),d.offsetScaleY=o.readFloat(),d.offsetShearY=o.readFloat(),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),d.scaleMix=o.readFloat(),d.shearMix=o.readFloat(),a.transformConstraints.push(d)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((d=new t.PathConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.slots[o.readInt(!0)],d.positionMode=e.PositionModeValues[o.readInt(!0)],d.spacingMode=e.SpacingModeValues[o.readInt(!0)],d.rotateMode=e.RotateModeValues[o.readInt(!0)],d.offsetRotation=o.readFloat(),d.position=o.readFloat(),d.positionMode==t.PositionMode.Fixed&&(d.position*=r),d.spacing=o.readFloat(),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=r),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),a.pathConstraints.push(d)}var v=this.readSkin(o,a,!0,s);for(null!=v&&(a.defaultSkin=v,a.skins.push(v)),l=a.skins.length,t.Utils.setArraySize(a.skins,c=l+o.readInt(!0));l<c;l++)a.skins[l]=this.readSkin(o,a,!1,s);for(c=this.linkedMeshes.length,l=0;l<c;l++){var y=this.linkedMeshes[l],S=null==y.skin?a.defaultSkin:a.findSkin(y.skin);if(null==S)throw new Error("Skin not found: "+y.skin);var T=S.getAttachment(y.slotIndex,y.parent);if(null==T)throw new Error("Parent mesh not found: "+y.parent);y.mesh.deformAttachment=y.inheritDeform?T:y.mesh,y.mesh.setParentMesh(T),y.mesh.updateUVs()}for(this.linkedMeshes.length=0,c=o.readInt(!0),l=0;l<c;l++)(d=new t.EventData(o.readStringRef())).intValue=o.readInt(!1),d.floatValue=o.readFloat(),d.stringValue=o.readString(),d.audioPath=o.readString(),null!=d.audioPath&&(d.volume=o.readFloat(),d.balance=o.readFloat()),a.events.push(d);for(c=o.readInt(!0),l=0;l<c;l++)a.animations.push(this.readAnimation(o,o.readString(),a));return a},e.prototype.readSkin=function(e,n,i,r){var a=null,o=0;if(i){if(0==(o=e.readInt(!0)))return null;a=new t.Skin("default")}else{(a=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var s=0,c=a.bones.length;s<c;s++)a.bones[s]=n.bones[e.readInt(!0)];for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.ikConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.transformConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(s=0;s<o;s++)for(var l=e.readInt(!0),u=0,h=e.readInt(!0);u<h;u++){var f=e.readStringRef(),_=this.readAttachment(e,n,a,l,f,r);null!=_&&a.setAttachment(l,f,_)}return a},e.prototype.readAttachment=function(n,r,a,o,s,c){var l=this.scale,u=n.readStringRef();null==u&&(u=s);var h=n.readByte();switch(e.AttachmentTypeValues[h]){case t.AttachmentType.Region:var f=n.readStringRef(),_=n.readFloat(),d=n.readFloat(),p=n.readFloat(),m=n.readFloat(),g=n.readFloat(),v=n.readFloat(),y=n.readFloat(),S=n.readInt32();null==f&&(f=u);var T=this.attachmentLoader.newRegionAttachment(a,u,f);return null==T?null:(T.path=f,T.x=d*l,T.y=p*l,T.scaleX=m,T.scaleY=g,T.rotation=_,T.width=v*l,T.height=y*l,t.Color.rgba8888ToColor(T.color,S),T.updateOffset(),T);case t.AttachmentType.BoundingBox:var x=n.readInt(!0),E=this.readVertices(n,x),A=(S=c?n.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(a,u));return null==A?null:(A.worldVerticesLength=x<<1,A.vertices=E.vertices,A.bones=E.bones,c&&t.Color.rgba8888ToColor(A.color,S),A);case t.AttachmentType.Mesh:f=n.readStringRef(),S=n.readInt32(),x=n.readInt(!0);var C=this.readFloatArray(n,x<<1,1),b=this.readShortArray(n),w=(E=this.readVertices(n,x),n.readInt(!0)),I=null;return v=0,y=0,c&&(I=this.readShortArray(n),v=n.readFloat(),y=n.readFloat()),null==f&&(f=u),null==(P=this.attachmentLoader.newMeshAttachment(a,u,f))?null:(P.path=f,t.Color.rgba8888ToColor(P.color,S),P.bones=E.bones,P.vertices=E.vertices,P.worldVerticesLength=x<<1,P.triangles=b,P.regionUVs=C,P.updateUVs(),P.hullLength=w<<1,c&&(P.edges=I,P.width=v*l,P.height=y*l),P);case t.AttachmentType.LinkedMesh:f=n.readStringRef(),S=n.readInt32();var P,R=n.readStringRef(),D=n.readStringRef(),O=n.readBoolean();return v=0,y=0,c&&(v=n.readFloat(),y=n.readFloat()),null==f&&(f=u),null==(P=this.attachmentLoader.newMeshAttachment(a,u,f))?null:(P.path=f,t.Color.rgba8888ToColor(P.color,S),c&&(P.width=v*l,P.height=y*l),this.linkedMeshes.push(new i(P,R,o,D,O)),P);case t.AttachmentType.Path:for(var N=n.readBoolean(),M=n.readBoolean(),L=(x=n.readInt(!0),E=this.readVertices(n,x),t.Utils.newArray(x/3,0)),F=0,B=L.length;F<B;F++)L[F]=n.readFloat()*l;return S=c?n.readInt32():0,null==(f=this.attachmentLoader.newPathAttachment(a,u))?null:(f.closed=N,f.constantSpeed=M,f.worldVerticesLength=x<<1,f.vertices=E.vertices,f.bones=E.bones,f.lengths=L,c&&t.Color.rgba8888ToColor(f.color,S),f);case t.AttachmentType.Point:_=n.readFloat(),d=n.readFloat(),p=n.readFloat(),S=c?n.readInt32():0;var z=this.attachmentLoader.newPointAttachment(a,u);return null==z?null:(z.x=d*l,z.y=p*l,z.rotation=_,c&&t.Color.rgba8888ToColor(z.color,S),z);case t.AttachmentType.Clipping:var U=n.readInt(!0),k=(x=n.readInt(!0),E=this.readVertices(n,x),S=c?n.readInt32():0,this.attachmentLoader.newClippingAttachment(a,u));return null==k?null:(k.endSlot=r.slots[U],k.worldVerticesLength=x<<1,k.vertices=E.vertices,k.bones=E.bones,c&&t.Color.rgba8888ToColor(k.color,S),k)}return null},e.prototype.readVertices=function(e,n){var i=n<<1,a=new r,o=this.scale;if(!e.readBoolean())return a.vertices=this.readFloatArray(e,i,o),a;for(var s=new Array,c=new Array,l=0;l<n;l++){var u=e.readInt(!0);c.push(u);for(var h=0;h<u;h++)c.push(e.readInt(!0)),s.push(e.readFloat()*o),s.push(e.readFloat()*o),s.push(e.readFloat())}return a.vertices=t.Utils.toFloatArray(s),a.bones=c,a},e.prototype.readFloatArray=function(t,e,n){var i=new Array(e);if(1==n)for(var r=0;r<e;r++)i[r]=t.readFloat();else for(r=0;r<e;r++)i[r]=t.readFloat()*n;return i},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),i=0;i<e;i++)n[i]=t.readShort();return n},e.prototype.readAnimation=function(n,i,r){for(var a=new Array,o=this.scale,s=0,c=new t.Color,l=new t.Color,u=0,h=n.readInt(!0);u<h;u++)for(var f=n.readInt(!0),_=0,d=n.readInt(!0);_<d;_++){var p=n.readByte(),m=n.readInt(!0);switch(p){case e.SLOT_ATTACHMENT:(S=new t.AttachmentTimeline(m)).slotIndex=f;for(var g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readStringRef());a.push(S),s=Math.max(s,S.frames[m-1]);break;case e.SLOT_COLOR:for((S=new t.ColorTimeline(m)).slotIndex=f,g=0;g<m;g++){var v=n.readFloat();t.Color.rgba8888ToColor(c,n.readInt32()),S.setFrame(g,v,c.r,c.g,c.b,c.a),g<m-1&&this.readCurve(n,g,S)}a.push(S),s=Math.max(s,S.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((S=new t.TwoColorTimeline(m)).slotIndex=f,g=0;g<m;g++)v=n.readFloat(),t.Color.rgba8888ToColor(c,n.readInt32()),t.Color.rgb888ToColor(l,n.readInt32()),S.setFrame(g,v,c.r,c.g,c.b,c.a,l.r,l.g,l.b),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var y=n.readInt(!0);for(_=0,d=n.readInt(!0);_<d;_++)switch(p=n.readByte(),m=n.readInt(!0),p){case e.BONE_ROTATE:for((S=new t.RotateTimeline(m)).boneIndex=y,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var S=void 0,T=1;for(p==e.BONE_SCALE?S=new t.ScaleTimeline(m):p==e.BONE_SHEAR?S=new t.ShearTimeline(m):(S=new t.TranslateTimeline(m),T=o),S.boneIndex=y,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat()*T,n.readFloat()*T),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var x=n.readInt(!0);for(m=n.readInt(!0),(S=new t.IkConstraintTimeline(m)).ikConstraintIndex=x,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat()*o,n.readByte(),n.readBoolean(),n.readBoolean()),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(u=0,h=n.readInt(!0);u<h;u++){for(x=n.readInt(!0),m=n.readInt(!0),(S=new t.TransformConstraintTimeline(m)).transformConstraintIndex=x,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(u=0,h=n.readInt(!0);u<h;u++){x=n.readInt(!0);var E=r.pathConstraints[x];for(_=0,d=n.readInt(!0);_<d;_++)switch(p=n.readByte(),m=n.readInt(!0),p){case e.PATH_POSITION:case e.PATH_SPACING:for(S=void 0,T=1,p==e.PATH_SPACING?(S=new t.PathConstraintSpacingTimeline(m),E.spacingMode!=t.SpacingMode.Length&&E.spacingMode!=t.SpacingMode.Fixed||(T=o)):(S=new t.PathConstraintPositionTimeline(m),E.positionMode==t.PositionMode.Fixed&&(T=o)),S.pathConstraintIndex=x,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat()*T),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((S=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=x,g=0;g<m;g++)S.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,S);a.push(S),s=Math.max(s,S.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var A=r.skins[n.readInt(!0)];for(_=0,d=n.readInt(!0);_<d;_++){f=n.readInt(!0);for(var C=0,b=n.readInt(!0);C<b;C++){var w=A.getAttachment(f,n.readStringRef()),I=null!=w.bones,P=w.vertices,R=I?P.length/3*2:P.length;for(m=n.readInt(!0),(S=new t.DeformTimeline(m)).slotIndex=f,S.attachment=w,g=0;g<m;g++){v=n.readFloat();var D=void 0,O=n.readInt(!0);if(0==O)D=I?t.Utils.newFloatArray(R):P;else{D=t.Utils.newFloatArray(R);var N=n.readInt(!0);if(O+=N,1==o)for(var M=N;M<O;M++)D[M]=n.readFloat();else for(M=N;M<O;M++)D[M]=n.readFloat()*o;if(!I){M=0;for(var L=D.length;M<L;M++)D[M]+=P[M]}}S.setFrame(g,v,D),g<m-1&&this.readCurve(n,g,S)}a.push(S),s=Math.max(s,S.frames[m-1])}}}var F=n.readInt(!0);if(F>0){S=new t.DrawOrderTimeline(F);var B=r.slots.length;for(u=0;u<F;u++){v=n.readFloat();var z=n.readInt(!0),U=t.Utils.newArray(B,0);for(_=B-1;_>=0;_--)U[_]=-1;var k=t.Utils.newArray(B-z,0),G=0,V=0;for(_=0;_<z;_++){for(f=n.readInt(!0);G!=f;)k[V++]=G++;U[G+n.readInt(!0)]=G++}for(;G<B;)k[V++]=G++;for(_=B-1;_>=0;_--)-1==U[_]&&(U[_]=k[--V]);S.setFrame(u,v,U)}a.push(S),s=Math.max(s,S.frames[F-1])}var H=n.readInt(!0);if(H>0){for(S=new t.EventTimeline(H),u=0;u<H;u++){v=n.readFloat();var W=r.events[n.readInt(!0)],j=new t.Event(v,W);j.intValue=n.readInt(!1),j.floatValue=n.readFloat(),j.stringValue=n.readBoolean()?n.readString():W.stringValue,null!=j.data.audioPath&&(j.volume=n.readFloat(),j.balance=n.readFloat()),S.setFrame(u,j)}a.push(S),s=Math.max(s,S.frames[H-1])}return new t.Animation(i,a,s)},e.prototype.readCurve=function(t,n,i){switch(t.readByte()){case e.CURVE_STEPPED:i.setStepped(n);break;case e.CURVE_BEZIER:this.setCurve(i,n,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,n,i,r,a){t.setCurve(e,n,i,r,a)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var n=function(){function t(t,e,n,i){void 0===e&&(e=new Array),void 0===n&&(n=0),void 0===i&&(i=new DataView(t.buffer)),this.strings=e,this.index=n,this.buffer=i}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),n=127&e;return 0!=(128&e)&&(n|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<28)))),t?n:n>>>1^-(1&n)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",n=0;n<t;){var i=this.readByte();switch(i>>4){case 12:case 13:e+=String.fromCharCode((31&i)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&i)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(i),n++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),i=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r},r=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(Qlt||(Qlt={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,n){if(null==e)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,r=this.polygons,a=this.polygonPool,o=e.slots,s=o.length;i.length=0,a.freeAll(r),r.length=0;for(var c=0;c<s;c++){var l=o[c];if(l.bone.active){var u=l.getAttachment();if(u instanceof t.BoundingBoxAttachment){var h=u;i.push(h);var f=a.obtain();f.length!=h.worldVerticesLength&&(f=t.Utils.newFloatArray(h.worldVerticesLength)),r.push(f),h.computeWorldVertices(l,0,h.worldVerticesLength,f,0,2)}}}n?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=this.polygons,a=0,o=r.length;a<o;a++)for(var s=r[a],c=s,l=0,u=s.length;l<u;l+=2){var h=c[l],f=c[l+1];t=Math.min(t,h),e=Math.min(e,f),n=Math.max(n,h),i=Math.max(i,f)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=i},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,n,i){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&n<=r||e<=a&&i<=a||t>=o&&n>=o||e>=s&&i>=s)return!1;var c=(i-e)/(n-t),l=c*(r-t)+e;if(l>a&&l<s)return!0;if((l=c*(o-t)+e)>a&&l<s)return!0;var u=(a-e)/c+t;return u>r&&u<o||(u=(s-e)/c+t)>r&&u<o},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var n=this.polygons,i=0,r=n.length;i<r;i++)if(this.containsPointPolygon(n[i],t,e))return this.boundingBoxes[i];return null},e.prototype.containsPointPolygon=function(t,e,n){for(var i=t,r=t.length,a=r-2,o=!1,s=0;s<r;s+=2){var c=i[s+1],l=i[a+1];if(c<n&&l>=n||l<n&&c>=n){var u=i[s];u+(n-c)/(l-c)*(i[a]-u)<e&&(o=!o)}a=s}return o},e.prototype.intersectsSegment=function(t,e,n,i){for(var r=this.polygons,a=0,o=r.length;a<o;a++)if(this.intersectsSegmentPolygon(r[a],t,e,n,i))return this.boundingBoxes[a];return null},e.prototype.intersectsSegmentPolygon=function(t,e,n,i,r){for(var a=t,o=t.length,s=e-i,c=n-r,l=e*r-n*i,u=a[o-2],h=a[o-1],f=0;f<o;f+=2){var _=a[f],d=a[f+1],p=u*d-h*_,m=u-_,g=h-d,v=s*g-c*m,y=(l*m-s*p)/v;if((y>=u&&y<=_||y>=_&&y<=u)&&(y>=e&&y<=i||y>=i&&y<=e)){var S=(l*g-c*p)/v;if((S>=h&&S<=d||S>=d&&S<=h)&&(S>=n&&S<=r||S>=r&&S<=n))return!0}u=_,h=d}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(n,i){if(null!=this.clipAttachment)return 0;this.clipAttachment=i;var r=i.worldVerticesLength,a=t.Utils.setArraySize(this.clippingPolygon,r);i.computeWorldVertices(n,0,r,a,0,2);var o=this.clippingPolygon;e.makeClockwise(o);for(var s=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),c=0,l=s.length;c<l;c++){var u=s[c];e.makeClockwise(u),u.push(u[0]),u.push(u[1])}return s.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,n,i,r,a,o,s,c,l,u,h){void 0===l&&(l=2),void 0===u&&(u=0),void 0===h&&(h=0);var f=this.clipOutput,_=this.clippedVertices,d=this.clippedTriangles,p=this.clippingPolygons,m=this.clippingPolygons.length,g=c?12:8,v=0;_.length=0,d.length=0;t:for(var y=0;y<r;y+=3)for(var S=i[y]*l,T=e[S+u],x=e[S+u+1],E=a[S+h],A=a[S+h+1],C=e[(S=i[y+1]*l)+u],b=e[S+u+1],w=a[S+h],I=a[S+h+1],P=e[(S=i[y+2]*l)+u],R=e[S+u+1],D=a[S+h],O=a[S+h+1],N=0;N<m;N++){var M=_.length;if(!this.clip(T,x,C,b,P,R,p[N],f)){(H=t.Utils.setArraySize(_,M+3*g))[M]=T,H[M+1]=x,H[M+2]=o.r,H[M+3]=o.g,H[M+4]=o.b,H[M+5]=o.a,c?(H[M+6]=E,H[M+7]=A,H[M+8]=s.r,H[M+9]=s.g,H[M+10]=s.b,H[M+11]=s.a,H[M+12]=C,H[M+13]=b,H[M+14]=o.r,H[M+15]=o.g,H[M+16]=o.b,H[M+17]=o.a,H[M+18]=w,H[M+19]=I,H[M+20]=s.r,H[M+21]=s.g,H[M+22]=s.b,H[M+23]=s.a,H[M+24]=P,H[M+25]=R,H[M+26]=o.r,H[M+27]=o.g,H[M+28]=o.b,H[M+29]=o.a,H[M+30]=D,H[M+31]=O,H[M+32]=s.r,H[M+33]=s.g,H[M+34]=s.b,H[M+35]=s.a):(H[M+6]=E,H[M+7]=A,H[M+8]=C,H[M+9]=b,H[M+10]=o.r,H[M+11]=o.g,H[M+12]=o.b,H[M+13]=o.a,H[M+14]=w,H[M+15]=I,H[M+16]=P,H[M+17]=R,H[M+18]=o.r,H[M+19]=o.g,H[M+20]=o.b,H[M+21]=o.a,H[M+22]=D,H[M+23]=O),M=d.length,(Z=t.Utils.setArraySize(d,M+3))[M]=v,Z[M+1]=v+1,Z[M+2]=v+2,v+=3;continue t}var L=f.length;if(0!=L){for(var F=b-R,B=P-C,z=T-P,U=R-x,k=1/(F*z+B*(x-R)),G=L>>1,V=this.clipOutput,H=t.Utils.setArraySize(_,M+G*g),W=0;W<L;W+=2){var j=V[W],X=V[W+1];H[M]=j,H[M+1]=X,H[M+2]=o.r,H[M+3]=o.g,H[M+4]=o.b,H[M+5]=o.a;var q=j-P,Y=X-R,K=(F*q+B*Y)*k,Q=(U*q+z*Y)*k,J=1-K-Q;H[M+6]=E*K+w*Q+D*J,H[M+7]=A*K+I*Q+O*J,c&&(H[M+8]=s.r,H[M+9]=s.g,H[M+10]=s.b,H[M+11]=s.a),M+=g}M=d.length;var Z=t.Utils.setArraySize(d,M+3*(G-2));for(G--,W=1;W<G;W++)Z[M]=v,Z[M+1]=v+W,Z[M+2]=v+W+1,M+=3;v+=G+1}}},e.prototype.clip=function(t,e,n,i,r,a,o,s){var c=s,l=!1,u=null;o.length%4>=2?(u=s,s=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(n),u.push(i),u.push(r),u.push(a),u.push(t),u.push(e),s.length=0;for(var h=o,f=o.length-4,_=0;;_+=2){for(var d=h[_],p=h[_+1],m=h[_+2],g=h[_+3],v=d-m,y=p-g,S=u,T=u.length-2,x=s.length,E=0;E<T;E+=2){var A=S[E],C=S[E+1],b=S[E+2],w=S[E+3],I=v*(w-g)-y*(b-m)>0;if(v*(C-g)-y*(A-m)>0){if(I){s.push(b),s.push(w);continue}var P=(D=w-C)*(m-d)-(O=b-A)*(g-p);if(Math.abs(P)>1e-6){var R=(O*(p-C)-D*(d-A))/P;s.push(d+(m-d)*R),s.push(p+(g-p)*R)}else s.push(d),s.push(p)}else if(I){var D,O;P=(D=w-C)*(m-d)-(O=b-A)*(g-p),Math.abs(P)>1e-6?(R=(O*(p-C)-D*(d-A))/P,s.push(d+(m-d)*R),s.push(p+(g-p)*R)):(s.push(d),s.push(p)),s.push(b),s.push(w)}l=!0}if(x==s.length)return c.length=0,!0;if(s.push(s[0]),s.push(s[1]),_==f)break;var N=s;(s=u).length=0,u=N}if(c!=s){c.length=0,_=0;for(var M=s.length-2;_<M;_++)c[_]=s[_]}else c.length=c.length-2;return l},e.makeClockwise=function(t){for(var e=t,n=t.length,i=e[n-2]*e[1]-e[0]*e[n-1],r=0,a=0,o=0,s=0,c=n-3;s<c;s+=2)r=e[s],a=e[s+1],o=e[s+2],i+=r*e[s+3]-o*a;if(!(i<0)){s=0;var l=n-2;for(c=n>>1;s<c;s+=2){var u=e[s],h=e[s+1],f=l-s;e[s]=e[f],e[s+1]=e[f+1],e[f]=u,e[f+1]=h}}},e}();t.SkeletonClipping=e}(Qlt||(Qlt={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t}();t.SkeletonData=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(n){var i=this.scale,r=new t.SkeletonData,a="string"==typeof n?JSON.parse(n):n,o=a.skeleton;if(null!=o&&(r.hash=o.hash,r.version=o.spine,r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height,r.fps=o.fps,r.imagesPath=o.images),a.bones)for(var s=0;s<a.bones.length;s++){var c=a.bones[s],l=null,u=this.getValue(c,"parent",null);if(null!=u&&null==(l=r.findBone(u)))throw new Error("Parent bone not found: "+u);(d=new t.BoneData(r.bones.length,c.name,l)).length=this.getValue(c,"length",0)*i,d.x=this.getValue(c,"x",0)*i,d.y=this.getValue(c,"y",0)*i,d.rotation=this.getValue(c,"rotation",0),d.scaleX=this.getValue(c,"scaleX",1),d.scaleY=this.getValue(c,"scaleY",1),d.shearX=this.getValue(c,"shearX",0),d.shearY=this.getValue(c,"shearY",0),d.transformMode=e.transformModeFromString(this.getValue(c,"transform","normal")),d.skinRequired=this.getValue(c,"skin",!1),r.bones.push(d)}if(a.slots)for(s=0;s<a.slots.length;s++){var h=(P=a.slots[s]).name,f=P.bone,_=r.findBone(f);if(null==_)throw new Error("Slot bone not found: "+f);var d=new t.SlotData(r.slots.length,h,_),p=this.getValue(P,"color",null);null!=p&&d.color.setFromString(p);var m=this.getValue(P,"dark",null);null!=m&&(d.darkColor=new t.Color(1,1,1,1),d.darkColor.setFromString(m)),d.attachmentName=this.getValue(P,"attachment",null),d.blendMode=e.blendModeFromString(this.getValue(P,"blend","normal")),r.slots.push(d)}if(a.ik)for(s=0;s<a.ik.length;s++){var g=a.ik[s];(d=new t.IkConstraintData(g.name)).order=this.getValue(g,"order",0),d.skinRequired=this.getValue(g,"skin",!1);for(var v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("IK bone not found: "+f);d.bones.push(b)}var y=g.target;if(d.target=r.findBone(y),null==d.target)throw new Error("IK target bone not found: "+y);d.mix=this.getValue(g,"mix",1),d.softness=this.getValue(g,"softness",0)*i,d.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,d.compress=this.getValue(g,"compress",!1),d.stretch=this.getValue(g,"stretch",!1),d.uniform=this.getValue(g,"uniform",!1),r.ikConstraints.push(d)}if(a.transform)for(s=0;s<a.transform.length;s++){for(g=a.transform[s],(d=new t.TransformConstraintData(g.name)).order=this.getValue(g,"order",0),d.skinRequired=this.getValue(g,"skin",!1),v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("Transform constraint bone not found: "+f);d.bones.push(b)}if(y=g.target,d.target=r.findBone(y),null==d.target)throw new Error("Transform constraint target bone not found: "+y);d.local=this.getValue(g,"local",!1),d.relative=this.getValue(g,"relative",!1),d.offsetRotation=this.getValue(g,"rotation",0),d.offsetX=this.getValue(g,"x",0)*i,d.offsetY=this.getValue(g,"y",0)*i,d.offsetScaleX=this.getValue(g,"scaleX",0),d.offsetScaleY=this.getValue(g,"scaleY",0),d.offsetShearY=this.getValue(g,"shearY",0),d.rotateMix=this.getValue(g,"rotateMix",1),d.translateMix=this.getValue(g,"translateMix",1),d.scaleMix=this.getValue(g,"scaleMix",1),d.shearMix=this.getValue(g,"shearMix",1),r.transformConstraints.push(d)}if(a.path)for(s=0;s<a.path.length;s++){for(g=a.path[s],(d=new t.PathConstraintData(g.name)).order=this.getValue(g,"order",0),d.skinRequired=this.getValue(g,"skin",!1),v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("Transform constraint bone not found: "+f);d.bones.push(b)}if(y=g.target,d.target=r.findSlot(y),null==d.target)throw new Error("Path target slot not found: "+y);d.positionMode=e.positionModeFromString(this.getValue(g,"positionMode","percent")),d.spacingMode=e.spacingModeFromString(this.getValue(g,"spacingMode","length")),d.rotateMode=e.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),d.offsetRotation=this.getValue(g,"rotation",0),d.position=this.getValue(g,"position",0),d.positionMode==t.PositionMode.Fixed&&(d.position*=i),d.spacing=this.getValue(g,"spacing",0),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=i),d.rotateMix=this.getValue(g,"rotateMix",1),d.translateMix=this.getValue(g,"translateMix",1),r.pathConstraints.push(d)}if(a.skins){var S=a.skins;if(!(S instanceof Array)){var T=[];for(var x in S)T.push({name:x,attachments:S[x]});S=T}for(s=0;s<S.length;s++){var E=S[s],A=new t.Skin(E.name);if(E.bones)for(var C=0;C<E.bones.length;C++){var b;if(null==(b=r.findBone(E.bones[C])))throw new Error("Skin bone not found: "+E.bones[s]);A.bones.push(b)}if(E.ik)for(C=0;C<E.ik.length;C++){if(null==(w=r.findIkConstraint(E.ik[C])))throw new Error("Skin IK constraint not found: "+E.ik[s]);A.constraints.push(w)}if(E.transform)for(C=0;C<E.transform.length;C++){if(null==(w=r.findTransformConstraint(E.transform[C])))throw new Error("Skin transform constraint not found: "+E.transform[s]);A.constraints.push(w)}if(E.path)for(C=0;C<E.path.length;C++){var w;if(null==(w=r.findPathConstraint(E.path[C])))throw new Error("Skin path constraint not found: "+E.path[s]);A.constraints.push(w)}for(var h in E.attachments){var I=r.findSlot(h);if(null==I)throw new Error("Slot not found: "+h);var P=E.attachments[h];for(var R in P){var D=this.readAttachment(P[R],A,I.index,R,r);null!=D&&A.setAttachment(I.index,R,D)}}r.skins.push(A),"default"==A.name&&(r.defaultSkin=A)}}s=0;for(var O=this.linkedMeshes.length;s<O;s++){var N=this.linkedMeshes[s];if(null==(A=null==N.skin?r.defaultSkin:r.findSkin(N.skin)))throw new Error("Skin not found: "+N.skin);var M=A.getAttachment(N.slotIndex,N.parent);if(null==M)throw new Error("Parent mesh not found: "+N.parent);N.mesh.deformAttachment=N.inheritDeform?M:N.mesh,N.mesh.setParentMesh(M),N.mesh.updateUVs()}if(this.linkedMeshes.length=0,a.events)for(var L in a.events){var F=a.events[L];(d=new t.EventData(L)).intValue=this.getValue(F,"int",0),d.floatValue=this.getValue(F,"float",0),d.stringValue=this.getValue(F,"string",""),d.audioPath=this.getValue(F,"audio",null),null!=d.audioPath&&(d.volume=this.getValue(F,"volume",1),d.balance=this.getValue(F,"balance",0)),r.events.push(d)}if(a.animations)for(var B in a.animations){var z=a.animations[B];this.readAnimation(z,B,r)}return r},e.prototype.readAttachment=function(e,i,r,a,o){var s=this.scale;switch(a=this.getValue(e,"name",a),this.getValue(e,"type","region")){case"region":var c=this.getValue(e,"path",a),l=this.attachmentLoader.newRegionAttachment(i,a,c);return null==l?null:(l.path=c,l.x=this.getValue(e,"x",0)*s,l.y=this.getValue(e,"y",0)*s,l.scaleX=this.getValue(e,"scaleX",1),l.scaleY=this.getValue(e,"scaleY",1),l.rotation=this.getValue(e,"rotation",0),l.width=e.width*s,l.height=e.height*s,null!=(y=this.getValue(e,"color",null))&&l.color.setFromString(y),l.updateOffset(),l);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(i,a);return null==u?null:(this.readVertices(e,u,e.vertexCount<<1),null!=(y=this.getValue(e,"color",null))&&u.color.setFromString(y),u);case"mesh":case"linkedmesh":c=this.getValue(e,"path",a);var h=this.attachmentLoader.newMeshAttachment(i,a,c);if(null==h)return null;h.path=c,null!=(y=this.getValue(e,"color",null))&&h.color.setFromString(y),h.width=this.getValue(e,"width",0)*s,h.height=this.getValue(e,"height",0)*s;var f=this.getValue(e,"parent",null);if(null!=f)return this.linkedMeshes.push(new n(h,this.getValue(e,"skin",null),r,f,this.getValue(e,"deform",!0))),h;var _=e.uvs;return this.readVertices(e,h,_.length),h.triangles=e.triangles,h.regionUVs=_,h.updateUVs(),h.edges=this.getValue(e,"edges",null),h.hullLength=2*this.getValue(e,"hull",0),h;case"path":if(null==(c=this.attachmentLoader.newPathAttachment(i,a)))return null;c.closed=this.getValue(e,"closed",!1),c.constantSpeed=this.getValue(e,"constantSpeed",!0);var d=e.vertexCount;this.readVertices(e,c,d<<1);for(var p=t.Utils.newArray(d/3,0),m=0;m<e.lengths.length;m++)p[m]=e.lengths[m]*s;return c.lengths=p,null!=(y=this.getValue(e,"color",null))&&c.color.setFromString(y),c;case"point":var g=this.attachmentLoader.newPointAttachment(i,a);return null==g?null:(g.x=this.getValue(e,"x",0)*s,g.y=this.getValue(e,"y",0)*s,g.rotation=this.getValue(e,"rotation",0),null!=(y=this.getValue(e,"color",null))&&g.color.setFromString(y),g);case"clipping":var v=this.attachmentLoader.newClippingAttachment(i,a);if(null==v)return null;var y,S=this.getValue(e,"end",null);if(null!=S){var T=o.findSlot(S);if(null==T)throw new Error("Clipping end slot not found: "+S);v.endSlot=T}return d=e.vertexCount,this.readVertices(e,v,d<<1),null!=(y=this.getValue(e,"color",null))&&v.color.setFromString(y),v}return null},e.prototype.readVertices=function(e,n,i){var r=this.scale;n.worldVerticesLength=i;var a=e.vertices;if(i!=a.length){var o=new Array,s=new Array;for(h=0,f=a.length;h<f;){var c=a[h++];s.push(c);for(var l=h+4*c;h<l;h+=4)s.push(a[h]),o.push(a[h+1]*r),o.push(a[h+2]*r),o.push(a[h+3])}n.bones=s,n.vertices=t.Utils.toFloatArray(o)}else{var u=t.Utils.toFloatArray(a);if(1!=r)for(var h=0,f=a.length;h<f;h++)u[h]*=r;n.vertices=u}},e.prototype.readAnimation=function(e,n,i){var r=this.scale,a=new Array,o=0;if(e.slots)for(var s in e.slots){var c=e.slots[s];if(-1==(J=i.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var l in c){var u=c[l];if("attachment"==l){(S=new t.AttachmentTimeline(u.length)).slotIndex=J;for(var h=0,f=0;f<u.length;f++){var _=u[f];S.setFrame(h++,this.getValue(_,"time",0),_.name)}a.push(S),o=Math.max(o,S.frames[S.getFrameCount()-1])}else if("color"==l){for((S=new t.ColorTimeline(u.length)).slotIndex=J,h=0,f=0;f<u.length;f++){_=u[f];var d=new t.Color;d.setFromString(_.color),S.setFrame(h,this.getValue(_,"time",0),d.r,d.g,d.b,d.a),this.readCurve(_,S,h),h++}a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");for((S=new t.TwoColorTimeline(u.length)).slotIndex=J,h=0,f=0;f<u.length;f++){_=u[f];var p=new t.Color,m=new t.Color;p.setFromString(_.light),m.setFromString(_.dark),S.setFrame(h,this.getValue(_,"time",0),p.r,p.g,p.b,p.a,m.r,m.g,m.b),this.readCurve(_,S,h),h++}a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var g in e.bones){var v=e.bones[g],y=i.findBoneIndex(g);if(-1==y)throw new Error("Bone not found: "+g);for(var l in v)if(u=v[l],"rotate"===l){for((S=new t.RotateTimeline(u.length)).boneIndex=y,h=0,f=0;f<u.length;f++)_=u[f],S.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"angle",0)),this.readCurve(_,S,h),h++;a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+g+")");var S=null,T=1,x=0;for("scale"===l?(S=new t.ScaleTimeline(u.length),x=1):"shear"===l?S=new t.ShearTimeline(u.length):(S=new t.TranslateTimeline(u.length),T=r),S.boneIndex=y,h=0,f=0;f<u.length;f++){_=u[f];var E=this.getValue(_,"x",x),A=this.getValue(_,"y",x);S.setFrame(h,this.getValue(_,"time",0),E*T,A*T),this.readCurve(_,S,h),h++}a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var C in e.ik){var b=e.ik[C],w=i.findIkConstraint(C);for((S=new t.IkConstraintTimeline(b.length)).ikConstraintIndex=i.ikConstraints.indexOf(w),h=0,f=0;f<b.length;f++)_=b[f],S.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"mix",1),this.getValue(_,"softness",0)*r,this.getValue(_,"bendPositive",!0)?1:-1,this.getValue(_,"compress",!1),this.getValue(_,"stretch",!1)),this.readCurve(_,S,h),h++;a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var C in e.transform){for(b=e.transform[C],w=i.findTransformConstraint(C),(S=new t.TransformConstraintTimeline(b.length)).transformConstraintIndex=i.transformConstraints.indexOf(w),h=0,f=0;f<b.length;f++)_=b[f],S.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"rotateMix",1),this.getValue(_,"translateMix",1),this.getValue(_,"scaleMix",1),this.getValue(_,"shearMix",1)),this.readCurve(_,S,h),h++;a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var I=e.path||e.paths;if(I)for(var C in I){b=I[C];var P=i.findPathConstraintIndex(C);if(-1==P)throw new Error("Path constraint not found: "+C);var R=i.pathConstraints[P];for(var l in b)if(u=b[l],"position"===l||"spacing"===l){for(S=null,T=1,"spacing"===l?(S=new t.PathConstraintSpacingTimeline(u.length),R.spacingMode!=t.SpacingMode.Length&&R.spacingMode!=t.SpacingMode.Fixed||(T=r)):(S=new t.PathConstraintPositionTimeline(u.length),R.positionMode==t.PositionMode.Fixed&&(T=r)),S.pathConstraintIndex=P,h=0,f=0;f<u.length;f++)_=u[f],S.setFrame(h,this.getValue(_,"time",0),this.getValue(_,l,0)*T),this.readCurve(_,S,h),h++;a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===l){for((S=new t.PathConstraintMixTimeline(u.length)).pathConstraintIndex=P,h=0,f=0;f<u.length;f++)_=u[f],S.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"rotateMix",1),this.getValue(_,"translateMix",1)),this.readCurve(_,S,h),h++;a.push(S),o=Math.max(o,S.frames[(S.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var D in e.deform){var O=e.deform[D],N=i.findSkin(D);if(null==N)throw new Error("Skin not found: "+D);for(var s in O){if(c=O[s],-1==(J=i.findSlotIndex(s)))throw new Error("Slot not found: "+c.name);for(var l in c){u=c[l];var M=N.getAttachment(J,l);if(null!=M){var L=null!=M.bones,F=M.vertices,B=L?F.length/3*2:F.length;(S=new t.DeformTimeline(u.length)).slotIndex=J,S.attachment=M,h=0;for(var z=0;z<u.length;z++){_=u[z];var U=void 0,k=this.getValue(_,"vertices",null);if(null==k)U=L?t.Utils.newFloatArray(B):F;else{U=t.Utils.newFloatArray(B);var G=this.getValue(_,"offset",0);if(t.Utils.arrayCopy(k,0,U,G,k.length),1!=r)for(var V=(f=G)+k.length;f<V;f++)U[f]*=r;if(!L)for(f=0;f<B;f++)U[f]+=F[f]}S.setFrame(h,this.getValue(_,"time",0),U),this.readCurve(_,S,h),h++}a.push(S),o=Math.max(o,S.frames[S.getFrameCount()-1])}}}}var H=e.drawOrder;if(null==H&&(H=e.draworder),null!=H){S=new t.DrawOrderTimeline(H.length);var W=i.slots.length;for(h=0,z=0;z<H.length;z++){var j=H[z],X=null,q=this.getValue(j,"offsets",null);if(null!=q){X=t.Utils.newArray(W,-1);var Y=t.Utils.newArray(W-q.length,0),K=0,Q=0;for(f=0;f<q.length;f++){var J,Z=q[f];if(-1==(J=i.findSlotIndex(Z.slot)))throw new Error("Slot not found: "+Z.slot);for(;K!=J;)Y[Q++]=K++;X[K+Z.offset]=K++}for(;K<W;)Y[Q++]=K++;for(f=W-1;f>=0;f--)-1==X[f]&&(X[f]=Y[--Q])}S.setFrame(h++,this.getValue(j,"time",0),X)}a.push(S),o=Math.max(o,S.frames[S.getFrameCount()-1])}if(e.events){for(S=new t.EventTimeline(e.events.length),h=0,f=0;f<e.events.length;f++){var $=e.events[f],tt=i.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),S.setFrame(h++,et)}a.push(S),o=Math.max(o,S.frames[S.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");i.animations.push(new t.Animation(n,a,o))},e.prototype.readCurve=function(t,e,n){var i=t.curve;i&&("stepped"==i?e.setStepped(n):"[object Array]"===Object.prototype.toString.call(i)?e.setCurve(n,i[0],i[1],i[2],i[3]):e.setCurve(n,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var n=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r}}(Qlt||(Qlt={})),function(t){var e=function(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n};t.SkinEntry=e;var n=function(){function n(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return n.prototype.setAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=n},n.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],i=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==n){i=!0;break}i||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];for(i=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==a){i=!0;break}i||this.constraints.push(a)}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}},n.prototype.copySkin=function(e){for(var n=0;n<e.bones.length;n++){for(var i=e.bones[n],r=!1,a=0;a<this.bones.length;a++)if(this.bones[a]==i){r=!0;break}r||this.bones.push(i)}for(n=0;n<e.constraints.length;n++){var o=e.constraints[n];for(r=!1,a=0;a<this.constraints.length;a++)if(this.constraints[a]==o){r=!0;break}r||this.constraints.push(o)}var s=e.getAttachments();for(n=0;n<s.length;n++){var c=s[n];null!=c.attachment&&(c.attachment instanceof t.MeshAttachment?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}},n.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},n.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},n.prototype.getAttachments=function(){for(var t=new Array,n=0;n<this.attachments.length;n++){var i=this.attachments[n];if(i)for(var r in i){var a=i[r];a&&t.push(new e(n,r,a))}}return t},n.prototype.getAttachmentsForSlot=function(t,n){var i=this.attachments[t];if(i)for(var r in i){var a=i[r];a&&n.push(new e(t,r,a))}},n.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},n.prototype.attachAll=function(t,e){for(var n=0,i=0;i<t.slots.length;i++){var r=t.slots[i],a=r.getAttachment();if(a&&n<e.attachments.length){var o=e.attachments[n];for(var s in o)if(a==o[s]){var c=this.getAttachment(n,s);null!=c&&r.setAttachment(c);break}}n++}},n}();t.Skin=n}(Qlt||(Qlt={})),function(t){var e=function(){function e(e,n){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=e,this.bone=n,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(Qlt||(Qlt={})),function(t){t.SlotData=function(e,n,i){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=e,this.name=n,this.boneData=i}}(Qlt||(Qlt={})),function(t){var e,n,i=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=i,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(n=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Jlt(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(i);t.FakeTexture=r}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,a){if(null==a)throw new Error("textureLoader cannot be null.");for(var o=new n(e),s=new Array(4),c=null;;){var l=o.readLine();if(null==l)break;if(0==(l=l.trim()).length)c=null;else if(c){var u=new r;u.name=l,u.page=c;var h=o.readValue();"true"==h.toLocaleLowerCase()?u.degrees=90:"false"==h.toLocaleLowerCase()?u.degrees=0:u.degrees=parseFloat(h),u.rotate=90==u.degrees,o.readTuple(s);var f=parseInt(s[0]),_=parseInt(s[1]);o.readTuple(s);var d=parseInt(s[0]),p=parseInt(s[1]);u.u=f/c.width,u.v=_/c.height,u.rotate?(u.u2=(f+p)/c.width,u.v2=(_+d)/c.height):(u.u2=(f+d)/c.width,u.v2=(_+p)/c.height),u.x=f,u.y=_,u.width=Math.abs(d),u.height=Math.abs(p),4==o.readTuple(s)&&4==o.readTuple(s)&&o.readTuple(s),u.originalWidth=parseInt(s[0]),u.originalHeight=parseInt(s[1]),o.readTuple(s),u.offsetX=parseInt(s[0]),u.offsetY=parseInt(s[1]),u.index=parseInt(o.readValue()),u.texture=c.texture,this.regions.push(u)}else{(c=new i).name=l,2==o.readTuple(s)&&(c.width=parseInt(s[0]),c.height=parseInt(s[1]),o.readTuple(s)),o.readTuple(s),c.minFilter=t.Texture.filterFromString(s[0]),c.magFilter=t.Texture.filterFromString(s[1]);var m=o.readValue();c.uWrap=t.TextureWrap.ClampToEdge,c.vWrap=t.TextureWrap.ClampToEdge,"x"==m?c.uWrap=t.TextureWrap.Repeat:"y"==m?c.vWrap=t.TextureWrap.Repeat:"xy"==m&&(c.uWrap=c.vWrap=t.TextureWrap.Repeat),c.texture=a(l),c.texture.setFilters(c.minFilter,c.magFilter),c.texture.setWraps(c.uWrap,c.vWrap),c.width=c.texture.getImage().width,c.height=c.texture.getImage().height,this.pages.push(c)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var n=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw new Error("Invalid line: "+e);for(var i=0,r=n+1;i<3;i++){var a=e.indexOf(",",r);if(-1==a)break;t[i]=e.substr(r,a-r).trim(),r=a+1}return t[i]=e.substring(r).trim(),i+1},t}(),i=function(){};t.TextureAtlasPage=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Jlt(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=r}(Qlt||(Qlt={})),function(t){var e=function(){function e(e,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var i=0;i<e.bones.length;i++)this.bones.push(n.findBone(e.bones[i].name));this.target=n.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,u=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,h=this.data.offsetRotation*u,f=this.data.offsetShearY*u,_=this.bones,d=0,p=_.length;d<p;d++){var m=_[d],g=!1;if(0!=e){var v=m.a,y=m.b,S=m.c,T=m.d;(w=Math.atan2(c,o)-Math.atan2(S,v)+h)>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w*=e;var x=Math.cos(w),E=Math.sin(w);m.a=x*v-E*S,m.b=x*y-E*T,m.c=E*v+x*S,m.d=E*y+x*T,g=!0}if(0!=n){var A=this.temp;a.localToWorld(A.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(A.x-m.worldX)*n,m.worldY+=(A.y-m.worldY)*n,g=!0}if(i>0){var C=Math.sqrt(m.a*m.a+m.c*m.c),b=Math.sqrt(o*o+c*c);C>1e-5&&(C=(C+(b-C+this.data.offsetScaleX)*i)/C),m.a*=C,m.c*=C,C=Math.sqrt(m.b*m.b+m.d*m.d),b=Math.sqrt(s*s+l*l),C>1e-5&&(C=(C+(b-C+this.data.offsetScaleY)*i)/C),m.b*=C,m.d*=C,g=!0}if(r>0){y=m.b,T=m.d;var w,I=Math.atan2(T,y);(w=Math.atan2(l,s)-Math.atan2(c,o)-(I-Math.atan2(m.c,m.a)))>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w=I+(w+f)*r,C=Math.sqrt(y*y+T*T),m.b=Math.cos(w)*C,m.d=Math.sin(w)*C,g=!0}g&&(m.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,u=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,h=this.data.offsetRotation*u,f=this.data.offsetShearY*u,_=this.bones,d=0,p=_.length;d<p;d++){var m,g=_[d],v=!1;if(0!=e){var y=g.a,S=g.b,T=g.c,x=g.d;(m=Math.atan2(c,o)+h)>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),m*=e;var E=Math.cos(m),A=Math.sin(m);g.a=E*y-A*T,g.b=E*S-A*x,g.c=A*y+E*T,g.d=A*S+E*x,v=!0}if(0!=n){var C=this.temp;a.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),g.worldX+=C.x*n,g.worldY+=C.y*n,v=!0}if(i>0){var b=(Math.sqrt(o*o+c*c)-1+this.data.offsetScaleX)*i+1;g.a*=b,g.c*=b,b=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleY)*i+1,g.b*=b,g.d*=b,v=!0}if(r>0)(m=Math.atan2(l,s)-Math.atan2(c,o))>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),S=g.b,x=g.d,m=Math.atan2(x,S)+(m-t.MathUtils.PI/2+f)*r,b=Math.sqrt(S*S+x*x),g.b=Math.cos(m)*b,g.d=Math.sin(m)*b,v=!0;v&&(g.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;if(0!=t){var u=r.arotation-l+this.data.offsetRotation;l+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var h=c.ax,f=c.ay;0!=e&&(h+=(r.ax-h+this.data.offsetX)*e,f+=(r.ay-f+this.data.offsetY)*e);var _=c.ascaleX,d=c.ascaleY;0!=n&&(_>1e-5&&(_=(_+(r.ascaleX-_+this.data.offsetScaleX)*n)/_),d>1e-5&&(d=(d+(r.ascaleY-d+this.data.offsetScaleY)*n)/d));var p=c.ashearY;0!=i&&(u=r.ashearY-p+this.data.offsetShearY,u-=360*(16384-(16384.499999999996-u/360|0)),c.shearY+=u*i),c.updateWorldTransformWith(h,f,l,_,d,c.ashearX,p)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;0!=t&&(l+=(r.arotation+this.data.offsetRotation)*t);var u=c.ax,h=c.ay;0!=e&&(u+=(r.ax+this.data.offsetX)*e,h+=(r.ay+this.data.offsetY)*e);var f=c.ascaleX,_=c.ascaleY;0!=n&&(f>1e-5&&(f*=(r.ascaleX-1+this.data.offsetScaleX)*n+1),_>1e-5&&(_*=(r.ascaleY-1+this.data.offsetScaleY)*n+1));var d=c.ashearY;0!=i&&(d+=(r.ashearY+this.data.offsetShearY)*i),c.updateWorldTransformWith(u,h,l,f,_,c.ashearX,d)}},e}();t.TransformConstraint=e}(Qlt||(Qlt={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return Jlt(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var n=t,i=t.length>>1,r=this.indicesArray;r.length=0;for(var a=0;a<i;a++)r[a]=a;var o=this.isConcaveArray;o.length=0,a=0;for(var s=i;a<s;++a)o[a]=e.isConcave(a,i,n,r);var c=this.triangles;for(c.length=0;i>3;){for(var l=i-1,u=(a=0,1);;){t:if(!o[a]){for(var h=r[l]<<1,f=r[a]<<1,_=r[u]<<1,d=n[h],p=n[h+1],m=n[f],g=n[f+1],v=n[_],y=n[_+1],S=(u+1)%i;S!=l;S=(S+1)%i)if(o[S]){var T=r[S]<<1,x=n[T],E=n[T+1];if(e.positiveArea(v,y,d,p,x,E)&&e.positiveArea(d,p,m,g,x,E)&&e.positiveArea(m,g,v,y,x,E))break t}break}if(0==u){do{if(!o[a])break;a--}while(a>0);break}l=a,a=u,u=(u+1)%i}c.push(r[(i+a-1)%i]),c.push(r[a]),c.push(r[(a+1)%i]),r.splice(a,1),o.splice(a,1);var A=(--i+a-1)%i,C=a==i?0:a;o[A]=e.isConcave(A,i,n,r),o[C]=e.isConcave(C,i,n,r)}return 3==i&&(c.push(r[2]),c.push(r[0]),c.push(r[1])),c},e.prototype.decompose=function(t,n){var i=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;var a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var s=this.polygonPool.obtain();s.length=0;for(var c=-1,l=0,u=0,h=n.length;u<h;u+=3){var f=n[u]<<1,_=n[u+1]<<1,d=n[u+2]<<1,p=i[f],m=i[f+1],g=i[_],v=i[_+1],y=i[d],S=i[d+1],T=!1;if(c==f){var x=s.length-4,E=e.winding(s[x],s[x+1],s[x+2],s[x+3],y,S),A=e.winding(y,S,s[0],s[1],s[2],s[3]);E==l&&A==l&&(s.push(y),s.push(S),o.push(d),T=!0)}T||(s.length>0?(r.push(s),a.push(o)):(this.polygonPool.free(s),this.polygonIndicesPool.free(o)),(s=this.polygonPool.obtain()).length=0,s.push(p),s.push(m),s.push(g),s.push(v),s.push(y),s.push(S),(o=this.polygonIndicesPool.obtain()).length=0,o.push(f),o.push(_),o.push(d),l=e.winding(p,m,g,v,y,S),c=f)}for(s.length>0&&(r.push(s),a.push(o)),u=0,h=r.length;u<h;u++)if(0!=(o=a[u]).length)for(var C=o[0],b=o[o.length-1],w=(s=r[u])[x=s.length-4],I=s[x+1],P=s[x+2],R=s[x+3],D=s[0],O=s[1],N=s[2],M=s[3],L=e.winding(w,I,P,R,D,O),F=0;F<h;F++)if(F!=u){var B=a[F];if(3==B.length){var z=B[0],U=B[1],k=B[2],G=r[F];y=G[G.length-2],S=G[G.length-1],z==C&&U==b&&(E=e.winding(w,I,P,R,y,S),A=e.winding(y,S,D,O,N,M),E==L&&A==L&&(G.length=0,B.length=0,s.push(y),s.push(S),o.push(k),w=P,I=R,P=y,R=S,F=0))}}for(u=r.length-1;u>=0;u--)0==(s=r[u]).length&&(r.splice(u,1),this.polygonPool.free(s),o=a[u],a.splice(u,1),this.polygonIndicesPool.free(o));return r},e.isConcave=function(t,e,n,i){var r=i[(e+t-1)%e]<<1,a=i[t]<<1,o=i[(t+1)%e]<<1;return!this.positiveArea(n[r],n[r+1],n[a],n[a+1],n[o],n[o+1])},e.positiveArea=function(t,e,n,i,r,a){return t*(a-i)+n*(e-a)+r*(i-e)>=0},e.winding=function(t,e,n,i,r,a){var o=n-t,s=i-e;return r*s-a*o+o*e-t*s>=0?1:-1},e}();t.Triangulator=e}(Qlt||(Qlt={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var n=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=n,this.a=i}return t.prototype.set=function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,n,i){return this.r+=t,this.g+=e,this.b+=n,this.a+=i,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=n;var i=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,n){return t.randomTriangularWith(e,n,.5*(e+n))},t.randomTriangularWith=function(t,e,n){var i=Math.random(),r=e-t;return i<=(n-t)/r?t+Math.sqrt(i*r*(n-t)):e-Math.sqrt((1-i)*r*(e-n))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=i;var r=function(){function t(){}return t.prototype.apply=function(t,e,n){return t+(e-t)*this.applyInternal(n)},t}();t.Interpolation=r;var a=function(t){function e(e){var n=t.call(this)||this;return n.power=2,n.power=e,n}return Jlt(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(r);t.Pow=a;var o=function(t){function e(e){return t.call(this,e)||this}return Jlt(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(a);t.PowOut=o;var s=function(){function t(){}return t.arrayCopy=function(t,e,n,i,r){for(var a=e,o=i;a<e+r;a++,o++)n[o]=t[a]},t.setArraySize=function(t,e,n){void 0===n&&(n=0);var i=t.length;if(i==e)return t;if(t.length=e,i<e)for(var r=i;r<e;r++)t[r]=n;return t},t.ensureArrayCapacity=function(e,n,i){return void 0===i&&(i=0),e.length>=n?e:t.setArraySize(e,n,i)},t.newArray=function(t,e){for(var n=new Array(t),i=0;i<t;i++)n[i]=e;return n},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=s;var c=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var n=t.bones[e];console.log(n.data.name+", "+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.worldX+", "+n.worldY)}},t}();t.DebugUtils=c;var l=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=l;var u=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=u;var h=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=h;var f=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=f}(Qlt||(Qlt={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var n=function(e){function n(t){var i=e.call(this,t)||this;return i.id=(65535&n.nextID++)<<11,i.worldVerticesLength=0,i.deformAttachment=i,i}return Jlt(n,e),n.prototype.computeWorldVertices=function(t,e,n,i,r,a){n=r+(n>>1)*a;var o=t.bone.skeleton,s=t.deform,c=this.vertices,l=this.bones;if(null!=l){for(var u=0,h=0,f=0;f<e;f+=2)u+=(m=l[u])+1,h+=m;var _=o.bones;if(0==s.length)for(I=r,A=3*h;I<n;I+=a){var d=0,p=0,m=l[u++];for(m+=u;u<m;u++,A+=3){S=_[l[u]],P=c[A],R=c[A+1];var g=c[A+2];d+=(P*S.a+R*S.b+S.worldX)*g,p+=(P*S.c+R*S.d+S.worldY)*g}i[I]=d,i[I+1]=p}else for(var v=s,y=(I=r,A=3*h,h<<1);I<n;I+=a){for(d=0,p=0,m=l[u++],m+=u;u<m;u++,A+=3,y+=2)S=_[l[u]],P=c[A]+v[y],R=c[A+1]+v[y+1],g=c[A+2],d+=(P*S.a+R*S.b+S.worldX)*g,p+=(P*S.c+R*S.d+S.worldY)*g;i[I]=d,i[I+1]=p}}else{s.length>0&&(c=s);for(var S,T=(S=t.bone).worldX,x=S.worldY,E=S.a,A=S.b,C=S.c,b=S.d,w=e,I=r;I<n;w+=2,I+=a){var P=c[w],R=c[w+1];i[I]=P*E+R*A+T,i[I+1]=P*C+R*b+x}}},n.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},n.nextID=0,n}(e);t.VertexAttachment=n}(Qlt||(Qlt={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i}return Jlt(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.BoundingBoxAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.2275,.2275,.8078,1),i}return Jlt(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.ClippingAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i.tempColor=new t.Color(0,0,0,0),i}return Jlt(n,e),n.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var n=this.uvs,i=this.uvs.length,r=this.region.u,a=this.region.v,o=0,s=0;if(this.region instanceof t.TextureAtlasRegion){var c=this.region,l=c.texture.getImage().width,u=c.texture.getImage().height;switch(c.degrees){case 90:r-=(c.originalHeight-c.offsetY-c.height)/l,a-=(c.originalWidth-c.offsetX-c.width)/u,o=c.originalHeight/l,s=c.originalWidth/u;for(var h=0;h<i;h+=2)n[h]=r+e[h+1]*o,n[h+1]=a+(1-e[h])*s;return;case 180:for(r-=(c.originalWidth-c.offsetX-c.width)/l,a-=c.offsetY/u,o=c.originalWidth/l,s=c.originalHeight/u,h=0;h<i;h+=2)n[h]=r+(1-e[h])*o,n[h+1]=a+(1-e[h+1])*s;return;case 270:for(r-=c.offsetY/l,a-=c.offsetX/u,o=c.originalHeight/l,s=c.originalWidth/u,h=0;h<i;h+=2)n[h]=r+(1-e[h+1])*o,n[h+1]=a+e[h]*s;return}r-=c.offsetX/l,a-=(c.originalHeight-c.offsetY-c.height)/u,o=c.originalWidth/l,s=c.originalHeight/u}else null==this.region?(r=a=0,o=s=1):(o=this.region.u2-r,s=this.region.v2-a);for(h=0;h<i;h+=2)n[h]=r+e[h]*o,n[h+1]=a+e[h+1]*s},n.prototype.getParentMesh=function(){return this.parentMesh},n.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},n.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new n(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},n.prototype.newLinkedMesh=function(){var t=new n(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},n}(t.VertexAttachment);t.MeshAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.closed=!1,i.constantSpeed=!1,i.color=new t.Color(1,1,1,1),i}return Jlt(n,e),n.prototype.copy=function(){var e=new n(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},n}(t.VertexAttachment);t.PathAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.38,.94,0,1),i}return Jlt(n,e),n.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},n.prototype.computeWorldRotation=function(e){var n=t.MathUtils.cosDeg(this.rotation),i=t.MathUtils.sinDeg(this.rotation),r=n*e.a+i*e.b,a=n*e.c+i*e.d;return Math.atan2(a,r)*t.MathUtils.radDeg},n.prototype.copy=function(){var t=new n(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.PointAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.x=0,i.y=0,i.scaleX=1,i.scaleY=1,i.rotation=0,i.width=0,i.height=0,i.color=new t.Color(1,1,1,1),i.offset=t.Utils.newFloatArray(8),i.uvs=t.Utils.newFloatArray(8),i.tempColor=new t.Color(1,1,1,1),i}return Jlt(n,e),n.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,a=i+this.region.width*t,o=r+this.region.height*e,s=this.rotation*Math.PI/180,c=Math.cos(s),l=Math.sin(s),u=i*c+this.x,h=i*l,f=r*c+this.y,_=r*l,d=a*c+this.x,p=a*l,m=o*c+this.y,g=o*l,v=this.offset;v[n.OX1]=u-_,v[n.OY1]=f+h,v[n.OX2]=u-g,v[n.OY2]=m+h,v[n.OX3]=d-g,v[n.OY3]=m+p,v[n.OX4]=d-_,v[n.OY4]=f+p},n.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},n.prototype.computeWorldVertices=function(t,e,i,r){var a=this.offset,o=t.worldX,s=t.worldY,c=t.a,l=t.b,u=t.c,h=t.d,f=0,_=0;f=a[n.OX1],_=a[n.OY1],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX2],_=a[n.OY2],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX3],_=a[n.OY3],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX4],_=a[n.OY4],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s},n.prototype.copy=function(){var e=new n(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},n.OX1=0,n.OY1=1,n.OX2=2,n.OY2=3,n.OX3=4,n.OY3=5,n.OX4=6,n.OY4=7,n.X1=0,n.Y1=1,n.C1R=2,n.C1G=3,n.C1B=4,n.C1A=5,n.U1=6,n.V1=7,n.X2=8,n.Y2=9,n.C2R=10,n.C2G=11,n.C2B=12,n.C2A=13,n.U2=14,n.V2=15,n.X3=16,n.Y3=17,n.C3R=18,n.C3G=19,n.C3B=20,n.C3A=21,n.U3=22,n.V3=23,n.X4=24,n.Y4=25,n.C4R=26,n.C4G=27,n.C4B=28,n.C4A=29,n.U4=30,n.V4=31,n}(t.Attachment);t.RegionAttachment=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(Qlt||(Qlt={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var n=this.angle*t.MathUtils.degreesToRadians,i=e.x-this.worldX,r=e.y-this.worldY,a=Math.sqrt(i*i+r*r);if(a<this.radius){var o=this.interpolation.apply(0,n,(this.radius-a)/this.radius),s=Math.cos(o),c=Math.sin(o);e.x=s*i-c*r+this.worldX,e.y=c*i+s*r+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(Qlt||(Qlt={}));var Zlt,$lt,tut,eut,nut,iut,rut=Qlt,aut=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),out=1/60,sut=[],cut=[],lut=0,uut=0,hut=0,fut=null,_ut=null,dut=0,put=0,mut=0,gut=0,vut=null,yut=null,Sut=0,Tut=0,xut=new rut.Color(1,1,1,1),Eut=new rut.Color(1,1,1,1),Aut=[0,1,2,2,3,0],Cut=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var n=null==t?void 0:t.skeleton,i=null==t?void 0:t.listener,r=null==t?void 0:t.state,a=null==n?void 0:n.data.findAnimation(this._animationName);null==r||r.setAnimationWith(0,a,!1),this.bind(i),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,n=null==e?void 0:e.skeleton,i=null==e?void 0:e.clipper,r=null==e?void 0:e.state;do{null==n||n.update(out),null==r||r.update(out),null==r||r.apply(n),null==n||n.updateWorldTransform(),this._frameIdx++,this.updateFrame(n,i,this._frameIdx),this.totalTime+=out}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,n,i,r){if(eut=n.a*e.a*t.a*255,Zlt=e.r*t.r*255,$lt=e.g*t.g*255,tut=e.b*t.b*255,xut.r=Zlt*n.r,xut.g=$lt*n.g,xut.b=tut*n.b,xut.a=eut,null==r.darkColor?Eut.set(0,0,0,1):(Eut.r=r.darkColor.r*Zlt,Eut.g=r.darkColor.g*$lt,Eut.b=r.darkColor.b*tut),Eut.a=0,nut=(xut.a<<24>>>0)+(xut.b<<16)+(xut.g<<8)+xut.r,iut=(Eut.a<<24>>>0)+(Eut.b<<16)+(Eut.g<<8)+Eut.r,vut!==nut||yut!==iut){var a=this._tempColors;vut=nut,yut=iut,gut>0&&(a[gut-1].vfOffset=hut),a[gut++]={fr:xut.r,fg:xut.g,fb:xut.b,fa:xut.a,dr:Eut.r,dg:Eut.g,db:Eut.b,da:Eut.a,vfOffset:0}}if(i.isClipping()){i.clipTriangles(sut,Sut,cut,Tut,sut,xut,Eut,!0,6,hut,hut+2);var o=i.clippedVertices,s=i.clippedTriangles;Tut=s.length,Sut=o.length/12*6;for(var c=0,l=uut,u=s.length;c<u;)cut[l++]=s[c++];for(var h=0,f=o.length,_=hut;h<f;h+=12,_+=6)sut[_]=o[h],sut[_+1]=o[h+1],sut[_+2]=o[h+6],sut[_+3]=o[h+7],sut[_+4]=nut,sut[_+5]=iut}else for(var d=hut,p=hut+Sut;d<p;d+=6)sut[d+4]=nut,sut[d+5]=iut},e.updateFrame=function(t,e,n){hut=0,lut=0,uut=0,fut=null,_ut=null,dut=0,put=0,mut=0,gut=0,vut=null,yut=null,this.frames[n]=this.frames[n]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[n],r=this._tempSegments=i.segments,a=this._tempColors=i.colors,o=this._tempBoneInfos=i.boneInfos;this.traverseSkeleton(t,e),gut>0&&(a[gut-1].vfOffset=hut),a.length=gut,o.length=lut;var s=mut-1;if(s>=0)if(put>0){var c=r[s];c.indexCount=put,c.vfCount=13*dut,c.vertexCount=dut,r.length=mut}else r.length=mut-1;if(0!==r.length){var l=i.vertices,u=hut/6,h=13*u;(!l||l.length<h)&&(l=i.vertices=new Float32Array(h));for(var f=0,_=0;f<h;)l[f]=sut[_++],l[f+1]=sut[_++],l[f+3]=sut[_++],l[f+4]=sut[_++],this._setVerticeColor(sut[_++],l,f+5),this._setVerticeColor(sut[_++],l,f+9),f+=13;var d=i.indices;(!d||d.length<uut)&&(d=i.indices=new Uint16Array(uut));for(var p=0;p<uut;p++)d[p]=cut[p];i.vertices=l,i.indices=d,this.maxVertexCount=u>this.maxVertexCount?u:this.maxVertexCount,this.maxIndexCount=d.length>this.maxIndexCount?d.length:this.maxIndexCount}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var n,i,r,a,o,s,c,l,u,h,f,_,d=this._tempSegments,p=this._tempBoneInfos,m=t.color,g=t.bones;if(this._enableCacheAttachedInfo)for(var v=0,y=g.length;v<y;v++,lut++){var S=g[v],T=p[lut];T||(T=p[lut]={}),T.a=S.a,T.b=S.b,T.c=S.c,T.d=S.d,T.worldX=S.worldX,T.worldY=S.worldY}for(var x=0,E=t.drawOrder.length;x<E;x++)if((_=t.drawOrder[x]).bone.active)if(Sut=0,Tut=0,n=_.getAttachment())if(s=n instanceof rut.RegionAttachment,c=n instanceof rut.MeshAttachment,n instanceof rut.ClippingAttachment)e.clipStart(_,n);else if(s||c)if(l=n.region.texture.getRealTexture()){if(f=_.data.blendMode,fut===l.getId()&&_ut===f||(fut=l.getId(),_ut=f,(u=mut-1)>=0&&(put>0?((h=d[u]).indexCount=put,h.vertexCount=dut,h.vfCount=13*dut):mut--),d[mut]={tex:l,blendMode:f,indexCount:0,vertexCount:0,vfCount:0},mut++,put=0,dut=0),s)o=Aut,Sut=24,Tut=6,n.computeWorldVertices(_.bone,sut,hut,6);else if(c){var A=n;o=A.triangles,Sut=6*(A.worldVerticesLength>>1),Tut=o.length,A.computeWorldVertices(_,0,A.worldVerticesLength,sut,hut,6)}if(0!==Sut&&0!==Tut){for(var C=0,b=uut,w=o.length;C<w;)cut[b++]=o[C++];a=n.uvs;for(var I=hut,P=hut+Sut,R=0;I<P;I+=6,R+=2)sut[I+2]=a[R],sut[I+3]=a[R+1];if(i=n.color,r=_.color,this.fillVertices(m,i,r,e,_),Tut>0){for(var D=uut,O=uut+Tut;D<O;D++)cut[D]+=dut;uut+=Tut,hut+=Sut,put+=Tut,dut+=Sut/6}e.clipEndWithSlot(_)}else e.clipEndWithSlot(_)}else e.clipEndWithSlot(_);else e.clipEndWithSlot(_);else e.clipEndWithSlot(_);e.clipEnd()},e._setVerticeColor=function(t,e,n){e[n]=(255&t)/255,e[n+1]=(t>>8&255)/255,e[n+2]=(t>>16&255)/255,e[n+3]=(t>>24&255)/255},t}(),but=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var n=this._skeletonCache[t];if(!n){var i=new rut.Skeleton(e),r=new rut.SkeletonClipping,a=new rut.AnimationStateData(i.data),o=new rut.AnimationState(a),s=new aut;o.addListener(s),this._skeletonCache[t]=n={skeleton:i,clipper:r,state:o,listener:s,animationsCache:{},curAnimationCache:null}}return n},e.getAnimationCache=function(t,e){var n=this._skeletonCache[t];return n?n.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._skeletonCache[t],i=n&&n.skeleton;if(!i)return null;if(!i.data.findAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new Cut)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._skeletonCache[t];if(!i||!i.skeleton)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t}();but.FrameTime=out,but.sharedCache=new but;var wut,Iut,Put,Rut,Dut,Out,Nut,Mut,Lut,Fut,But,zut=new Xn,Uut=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){if(this._inited){var t=this._skeletonComp.socketNodes;if(0!==t.size){var e;if(e=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var n,i=function(t,e){var n=zut;n.m00=e.a,n.m01=e.c,n.m04=e.b,n.m05=e.d,n.m12=e.worldX,n.m13=e.worldY,t.matrix=zut},r=ot(t.keys());!(n=r()).done;){var a=n.value,o=t.get(a);if(o&&o.isValid){var s=e[a];s?i(o,s):(o.removeFromParent(),o.destroy(),t.delete(a))}else t.delete(a)}}}},t}(),kut=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="sp.SkeletonTexture",n._texture=null,n._material=null,n}Z(e,t);var n=e.prototype;return n.setRealTexture=function(t){this._texture=t},n.getRealTexture=function(){return this._texture},n.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(Gut(t),Gut(e))},n.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(Vut(t),Vut(e))},n.dispose=function(){},e}(rut.Texture);function Gut(t){switch(t){case rut.TextureFilter.Nearest:case rut.TextureFilter.MipMapNearestNearest:case rut.TextureFilter.MipMapLinearNearest:return Am.NEAREST;case rut.TextureFilter.MipMap:case rut.TextureFilter.MipMapNearestLinear:case rut.TextureFilter.MipMapLinearLinear:case rut.TextureFilter.Linear:default:return Am.LINEAR}}function Vut(t){switch(t){case rut.TextureWrap.MirroredRepeat:return Em.MIRRORED_REPEAT;case rut.TextureWrap.ClampToEdge:return Em.CLAMP_TO_EDGE;case rut.TextureWrap.Repeat:default:return Em.REPEAT}}var Hut=(wut=Ec("sp.SkeletonData"),Iut=al([dg]),Put=al([Fe]),wut((But=function(t){function e(){var e;return st(e=t.call(this)||this,"_skeletonJson",Out,rt(e)),st(e,"textures",Nut,rt(e)),st(e,"textureNames",Mut,rt(e)),st(e,"scale",Lut,rt(e)),st(e,"_atlasText",Fut,rt(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}Z(e,t);var n=e.prototype;return n.createNode=function(t){var e=new ob(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},n.reset=function(){this._skeletonCache=null,this._atlasCache=null},n.resetEnums=function(){},n.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var n=new rut.AtlasAttachmentLoader(e),i=null,r=null;return this.skeletonJson?(r=new rut.SkeletonJson(n),i=this.skeletonJson):(r=new rut.SkeletonBinary(n),i=new Uint8Array(this._nativeAsset)),r.scale=this.scale,this._skeletonCache=r.readSkeletonData(i),e.dispose(),this._skeletonCache},n.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,n={},i=0;i<e.length;i++)n[e[i].name]=i;return this._skinsEnum=oe(n)}return null},n.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},n=t.animations,i=0;i<n.length;i++)e[n[i].name]=i+1;return this._animsEnum=oe(e)}return null},n.destroy=function(){return but.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},n._getTexture=function(t){for(var e=this.textureNames,n=0;n<e.length;n++)if(e[n]===t){var i=this.textures[n],r=new kut({width:i.width,height:i.height});return r.setRealTexture(i),r}return console.error(this.name+" no textures found!"),null},n._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new rut.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},Q(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}(Du),Out=ct((Dut=But).prototype,"_skeletonJson",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nut=ct(Dut.prototype,"textures",[Dc,Iut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mut=ct(Dut.prototype,"textureNames",[Dc,Put],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lut=ct(Dut.prototype,"scale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Fut=ct(Dut.prototype,"_atlasText",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Rut=Dut))||Rut);l.internal.SpineSkeletonData=Hut;var Wut,jut,Xut,qut,Yut,Kut,Qut,Jut,Zut,$ut,tht,eht,nht,iht,rht,aht,oht,sht,cht,lht,uht,hht,fht,_ht,dht,pht,mht,ght,vht,yht,Sht,Tht,xht,Eht,Aht,Cht,bht,wht,Iht,Pht,Rht,Dht,Oht,Nht,Mht,Lht,Fht,Bht,zht,Uht,kht,Ght,Vht,Hht,Wht,jht=function(t){function e(){var e;return(e=t.call(this)||this)._skeletons=new Set,e}Z(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,lN.registerSystem(e.ID,e._instance,KO.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))},n.remove=function(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)},n.postUpdate=function(t){this._skeletons&&this._skeletons.forEach((function(e){e.updateAnimation(t)}))},e}(KO);function Xht(t,e,n){tn.Attr.setClassAttr(t,e,"type","Enum"),tn.Attr.setClassAttr(t,e,"enumList",oe.getList(n))}jht.ID="SKELETON",jht._instance=void 0,function(t){t[t.default=0]="default"}(Ght||(Ght={})),le(Ght),function(t){t[t["<None>"]=0]="<None>"}(Vht||(Vht={})),le(Vht),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(Hht||(Hht={})),le(Hht),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(Wht||(Wht={}));var qht=(Wut=Ec("sp.Skeleton.SpineSocket"),jut=al(ob),Wut((Yut=ct((qut=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),st(this,"path",Yut,this),st(this,"target",Kut,this),this.path=t,this.target=e}).prototype,"path",[Dc,Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kut=ct(qut.prototype,"target",[jut,Vc,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xut=qut))||Xut);ie.setClassAlias(qht,"sp.Skeleton.SpineSocket");var Yht=(Qut=Ec("sp.Skeleton"),Jut=Gc(),Zut=Bc(),$ut=al($g),tht=Zc(),eht=jc(),nht=al(Hut),iht=jc(),rht=al(Ght),aht=Xc(),oht=jc(),sht=al(Vht),cht=Xc(),lht=jc(),uht=Xc(),hht=al(Hht),fht=Xc(),_ht=Xc(),dht=Xc(),pht=Xc(),mht=Xc(),ght=Xc(),vht=Xc(),yht=al([qht]),Sht=Xc(),Tht=Hc(),xht=Hc(),Qut(Eht=Jut(Eht=Zut(Eht=Fc((kht=Uht=function(t){function e(){var e;return st(e=t.call(this)||this,"loop",Cht,rt(e)),e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumSkins=oe({}),e._enumAnimations=oe({}),e._playTimes=0,st(e,"_timeScale",bht,rt(e)),e._paused=!1,e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._isAniComplete=!0,e._needUpdateSkeltonData=!0,st(e,"_useTint",wht,rt(e)),st(e,"_preCacheMode",Iht,rt(e)),st(e,"_cacheMode",Pht,rt(e)),st(e,"_defaultCacheMode",Rht,rt(e)),st(e,"_debugBones",Dht,rt(e)),st(e,"_debugSlots",Oht,rt(e)),st(e,"_skeletonData",Nht,rt(e)),st(e,"_premultipliedAlpha",Mht,rt(e)),st(e,"defaultSkin",Lht,rt(e)),st(e,"defaultAnimation",Fht,rt(e)),st(e,"_sockets",Bht,rt(e)),e._drawIdx=0,e._drawList=new Wl((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),st(e,"_debugMesh",zht,rt(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new Uut,Xht(rt(e),"_defaultSkinIndex",e._enumSkins),Xht(rt(e),"_animationIndex",e._enumAnimations),e._useVertexOpacity=!0,e}Z(e,t);var n=e.prototype;return n.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===Hht.SHARED_CACHE?this._skeletonCache=but.sharedCache:this._cacheMode===Hht.PRIVATE_CACHE&&(this._skeletonCache=new but,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&S("Debug bones or slots is invalid in cached mode");var n=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=n.skeleton,this._clipper=n.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new rut.Skeleton(t),this._clipper=new rut.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this._flushAssembler()},n.setSlotsRange=function(t,e){this.isAnimationCached()?S("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},n.setAnimationStateData=function(t){if(this.isAnimationCached())S("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new rut.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},n.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,n=0,i=e.length;n<i;n++){var r=e[n];r&&"DEBUG_DRAW_NODE"===r.name&&r.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._needUpdateSkeltonData=!0,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==Hht.REALTIME},n.updateAnimation=function(t){if(this.markForUpdateRenderData(),!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var n=e.frames;this._curFrame=n[n.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var i=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,i.animationName,i.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},n.setVertexEffectDelegate=function(t){this._effectDelegate=t},n.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},n.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},n.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},n.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},n.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},n.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},n.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},n.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},n.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},n.getTextureAtlas=function(t){return t.region},n.setMix=function(t,e,n){this._state&&this._state.data.setMix(t,e,n)},n.setAnimation=function(t,e,n){if(this._playTimes=n?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&S("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var i=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);i||(i=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),i&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=i,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var r=this._skeleton.data.findAnimation(e);if(!r)return I(7509,e),null;var a=this._state.setAnimationWith(t,r,n);return this._state.apply(this._skeleton),a}return null},n.addAnimation=function(t,e,n,i){if(i=i||0,this.isAnimationCached())0!==t&&S("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:n,delay:i});else if(this._skeleton){var r,a=this._skeleton.data.findAnimation(e);return a?null===(r=this._state)||void 0===r?void 0:r.addAnimationWith(t,a,n,i):(I(7510,e),null)}return null},n.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},n.getCurrent=function(t){if(this.isAnimationCached())S("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},n.clearTracks=function(){this.isAnimationCached()?S("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},n.clearTrack=function(t){this.isAnimationCached()?S("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},n.setStartListener=function(t){this._ensureListener(),this._listener.start=t},n.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},n.setEndListener=function(t){this._ensureListener(),this._listener.end=t},n.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},n.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},n.setEventListener=function(t){this._ensureListener(),this._listener.event=t},n.setTrackStartListener=function(t,e){aut.getListeners(t).start=e},n.setTrackInterruptListener=function(t,e){aut.getListeners(t).interrupt=e},n.setTrackEndListener=function(t,e){aut.getListeners(t).end=e},n.setTrackDisposeListener=function(t,e){aut.getListeners(t).dispose=e},n.setTrackCompleteListener=function(t,e){aut.getListeners(t).complete=function(t){var n=Math.floor(t.trackTime/t.animationEnd);e(t,n)}},n.setTrackEventListener=function(t,e){aut.getListeners(t).event=e},n.getState=function(){return this._state},n.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),jht.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),jht.getInstance().remove(this)},n.onDestroy=function(){this._cleanMaterialCache(),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlendAndTint=function(t,e,n){var i=n+"/"+t+"/"+e,r=this._materialCache[i];if(r)return r;var a=this.customMaterial;null===a&&(a=Eg.get("default-spine-material"));var o=!1;switch(n){case Wht.TWO_COLORED:o=!0;break;case Wht.COLORED_TEXTURED:}return r=new ly({parent:a,subModelIdx:0,owner:this}),this._materialCache[i]=r,r.overridePipelineStates({blendState:{blendColor:Pn.WHITE,targets:[{blendEq:Ni.ADD,blendAlphaEq:Ni.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),r.recompileShaders({TWO_COLORED:o,USE_LOCAL:!0}),r},n.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.markForUpdateRenderData()},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc(),this._blendHash=-1},n.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},n._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},n._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var n=e.frames,i=but.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r]}},n._updateRealtime=function(t){var e=this._skeleton,n=this._state;e&&(e.update(t),n&&(n.update(t),n.apply(e)))},n._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(n){return null==n.parent?n.data.name||"<Unamed>":e(t[n.parent.data.index])+"/"+n.data.name},n=0,i=t.length;n<i;n++){var r=t[n].data,a=e(t[n]);this._cachedSockets.set(a,r.index)}}},n._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData(),this._assembler&&this._skeleton&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},n._updateBatch=function(){this.markForUpdateRenderData()},n._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():Vht,this._enumAnimations=oe({}),Object.assign(this._enumAnimations,t),oe.update(this._enumAnimations),Xht(this,"_animationIndex",this._enumAnimations)},n._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():Ght,this._enumSkins=oe({}),Object.assign(this._enumSkins,t),oe.update(this._enumSkins),Xht(this,"_defaultSkinIndex",this._enumSkins)},n._ensureListener=function(){this._listener||(this._listener=new aut,this._state&&this._state.addListener(this._listener))},n._updateSkeletonData=function(){if(this.skeletonData&&!1!==this._needUpdateSkeltonData){this._needUpdateSkeltonData=!1;var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new rut.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){S(t)}this._indexBoneSockets(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}}},n._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},n._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new ob("DEBUG_DRAW_NODE");t.hideFlags|=_l.Flags.DontSave|_l.Flags.HideInHierarchy;var e=t.addComponent(SG);e.lineWidth=1,e.strokeColor=new Pn(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&S("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._skeleton&&this._assembler&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}this._socketNodes.set(i,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}var r=new Map;t.forEach((function(t){t.target&&(r.get(t.target)?console.error("Target node "+t.target.name+" has existed."):r.set(t.target,!0))}))},n._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},Q(e,[{key:"drawList",get:function(){return this._drawList}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"paused",get:function(){return this._paused},set:function(t){this._paused=t}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this.destroyRenderData(),this._skeletonData=t,this._needUpdateSkeltonData=!0,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var n=e[t];void 0!==n?(this.defaultSkin=n,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var n=e[t];if(void 0!==n)return n}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var n=e[t];void 0!==n?(this.animation=n,this.animation=n):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]),e}(ok),Uht.SpineSocket=qht,Uht.AnimationCacheMode=Hht,ct((Aht=kht).prototype,"customMaterial",[sl,$ut,tht,eht],Object.getOwnPropertyDescriptor(Aht.prototype,"customMaterial"),Aht.prototype),ct(Aht.prototype,"skeletonData",[Vc,nht],Object.getOwnPropertyDescriptor(Aht.prototype,"skeletonData"),Aht.prototype),ct(Aht.prototype,"_defaultSkinIndex",[iht,rht,aht],Object.getOwnPropertyDescriptor(Aht.prototype,"_defaultSkinIndex"),Aht.prototype),ct(Aht.prototype,"_animationIndex",[oht,sht,cht],Object.getOwnPropertyDescriptor(Aht.prototype,"_animationIndex"),Aht.prototype),ct(Aht.prototype,"defaultCacheMode",[lht,uht,Vc,hht],Object.getOwnPropertyDescriptor(Aht.prototype,"defaultCacheMode"),Aht.prototype),Cht=ct(Aht.prototype,"loop",[Dc,fht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct(Aht.prototype,"premultipliedAlpha",[Vc,_ht],Object.getOwnPropertyDescriptor(Aht.prototype,"premultipliedAlpha"),Aht.prototype),ct(Aht.prototype,"timeScale",[dht,Vc],Object.getOwnPropertyDescriptor(Aht.prototype,"timeScale"),Aht.prototype),ct(Aht.prototype,"debugSlots",[Vc,pht],Object.getOwnPropertyDescriptor(Aht.prototype,"debugSlots"),Aht.prototype),ct(Aht.prototype,"debugBones",[Vc,mht],Object.getOwnPropertyDescriptor(Aht.prototype,"debugBones"),Aht.prototype),ct(Aht.prototype,"debugMesh",[Vc,ght],Object.getOwnPropertyDescriptor(Aht.prototype,"debugMesh"),Aht.prototype),ct(Aht.prototype,"useTint",[Vc,vht],Object.getOwnPropertyDescriptor(Aht.prototype,"useTint"),Aht.prototype),ct(Aht.prototype,"sockets",[yht,Sht],Object.getOwnPropertyDescriptor(Aht.prototype,"sockets"),Aht.prototype),bht=ct(Aht.prototype,"_timeScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wht=ct(Aht.prototype,"_useTint",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Iht=ct(Aht.prototype,"_preCacheMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Pht=ct(Aht.prototype,"_cacheMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hht.REALTIME}}),Rht=ct(Aht.prototype,"_defaultCacheMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hht.REALTIME}}),Dht=ct(Aht.prototype,"_debugBones",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oht=ct(Aht.prototype,"_debugSlots",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nht=ct(Aht.prototype,"_skeletonData",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mht=ct(Aht.prototype,"_premultipliedAlpha",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Lht=ct(Aht.prototype,"defaultSkin",[Dc,Tht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Fht=ct(Aht.prototype,"defaultAnimation",[xht,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Bht=ct(Aht.prototype,"_sockets",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zht=ct(Aht.prototype,"_debugMesh",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Eht=Aht))||Eht)||Eht)||Eht)||Eht);l.internal.SpineSkeleton=Yht;var Kht,Qht,Jht,Zht,$ht,tft,eft,nft,ift,rft,aft,oft,sft,cft,lft,uft,hft,fft,_ft,dft,pft,mft,gft,vft,yft,Sft,Tft,xft,Eft,Aft,Cft,bft,wft,Ift,Pft,Rft=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new rut.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new rut.Pow(e),this._vertexEffect=new rut.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new rut.PowOut(e),this._vertexEffect=new rut.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),Dft=[0,1,2,2,3,0],Oft=new Pn(0,0,255,255),Nft=new Pn(255,0,0,255),Mft=new Pn(0,255,0,255),Lft=new Pn(255,255,0,255),Fft=new rut.Color(1,1,1,1),Bft=new rut.Color(1,1,1,1),zft=new rut.Vector2,Uft=new rut.Vector2,kft=new Float32Array(4),Gft=new Float32Array(4),Vft=0,Hft=0,Wft=0,jft=0,Xft=0,qft=0,Yft=0,Kft=0,Qft=null,Jft=null,Zft=null;function $ft(t){var e,n;switch(t){case rut.BlendMode.Additive:e=Kht?Oi.ONE:Oi.SRC_ALPHA,n=Oi.ONE;break;case rut.BlendMode.Multiply:e=Oi.DST_COLOR,n=Oi.ONE_MINUS_SRC_ALPHA;break;case rut.BlendMode.Screen:e=Oi.ONE,n=Oi.ONE_MINUS_SRC_COLOR;break;case rut.BlendMode.Normal:default:e=Kht?Oi.ONE:Oi.SRC_ALPHA,n=Oi.ONE_MINUS_SRC_ALPHA}return Cft.getMaterialForBlendAndTint(e,n,$ht?Wht.TWO_COLORED:Wht.COLORED_TEXTURED)}function t_t(t){Sft=t.fa*oft,dft=ift*(Qht=Kht?Sft/255:1),pft=rft*Qht,mft=aft*Qht,gft=t.fr*dft,vft=t.fg*pft,yft=t.fb*mft,kft[0]=gft/255,kft[1]=vft/255,kft[2]=yft/255,kft[3]=Sft/255,Tft=t.dr*dft,xft=t.dg*pft,Eft=t.db*mft,Aft=Kht?255:0,Gft[0]=Tft/255,Gft[1]=xft/255,Gft[2]=Eft/255,Gft[3]=Aft/255}var e_t=new Float32Array(4);function n_t(t){return e_t[0]=t.r/255,e_t[1]=t.g/255,e_t[2]=t.b/255,e_t[3]=t.a/255,e_t}var i_t=null,r_t=null,a_t={vCount:32767,ensureAccessor:function(t){var e=t?r_t:i_t;if(!e){var n=lN.root.device,i=lN.root.batcher2D,r=t?HB:VB;t?(e=r_t=new Iq(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINETINT",36),r_t)):(e=i_t=new Iq(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINE",36),i_t))}return e},createData:function(t){var e=t.renderData;if(!e){for(var n=t.useTint||t.isAnimationCached(),i=this.ensureAccessor(n),r=t._skeleton.data.skins,a=0,o=0,s=0;s<r.length;++s)for(var c=r[s].attachments,l=0;l<c.length;l++){var u=c[l];for(var h in u){var f=u[h];f instanceof rut.RegionAttachment?(a+=4,o+=6):f instanceof rut.MeshAttachment&&(a+=f.worldVerticesLength>>1,o+=f.triangles.length)}}(e=hz.add(n?HB:VB,i)).resize(a,o),e.indices&&o===e.indices.length||(e.indices=new Uint16Array(o)),t.maxVertexCount=a,t.maxIndexCount=o}return e},updateRenderData:function(t){Cft=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e=t.color;ift=e.r/255,rft=e.g/255,aft=e.b/255,oft=t.node._uiProps.opacity,$ht=t.useTint||t.isAnimationCached(),sft=$ht?13:9,t.drawList.reset(),Cft=t,t.node,bft=t.renderData,Jft=null,_ft=!0,Kht=t.premultipliedAlpha,Qht=1,Pft=!1,Qft=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==e._val||Kht)&&(Pft=!0),t.isAnimationCached()?function(){var t=Cft._curFrame;if(t){var e=t.segments;if(0!==e.length){cft=12,jft=0,Xft=0,Wft=0,qft=0;var n=null,i=t.vertices,r=t.indices,a=0,o=0,s=0,c=0,l=t.colors,u=0,h=l[u++],f=h.vfOffset;t_t(h);for(var _=0,d=bft,p=d.chunk.vb,m=d.indices,g=0,v=e.length;g<v;g++){var y=e[g];if(n=$ft(y.blendMode)){if(Jft||(Jft=n),_ft||n.hash!==Jft.hash||y.tex&&y.tex!==Zft){_ft=!1;var S=qft-_;S>0&&(Cft._requestDrawData(Jft,Zft,_,S),_=qft),Jft=n,Zft=y.tex}Hft=y.vertexCount,Xft=y.indexCount,a=d.chunk.vertexOffset;for(var T=qft,x=qft+Xft;T<x;T++)m[T]=a+Wft+r[s++];if(c=y.vfCount,p.set(i.subarray(o,o+c),o),Pft)for(var E=o/13*6,A=o,C=o+c;A<C;A+=sft,E+=6)E>=f&&(t_t(h=l[u++]),f=h.vfOffset),p.set(kft,A+5),p.set(Gft,A+9);o+=c,Wft+=Hft,qft+=Xft,Hft=0,Xft=0}}var b=qft-_;Zft&&b>0&&Cft._requestDrawData(Jft,Zft,_,b)}}}():(Qft&&Qft.begin(t._skeleton),function(){var t=bft;Ift=t.chunk.vb,wft=t.indices,Yft=Cft.maxVertexCount,Kft=Cft.maxIndexCount;var e,n,i,r,a,o,s=Cft._skeleton,c=s.color,l=Cft._debugRenderer,u=Cft._clipper,h=null;Jht=Cft._startSlotIndex,Zht=Cft._endSlotIndex,fft=!1,-1===Jht&&(fft=!0),tft=Cft.debugSlots,eft=Cft.debugBones,nft=Cft.debugMesh,l&&(eft||tft||nft)&&(l.clear(),l.lineWidth=5),cft=12,Vft=0,Wft=0,jft=0,Xft=0,qft=0;for(var f=0,_=0,d=s.drawOrder.length;_<d;_++)if(void 0!==(o=s.drawOrder[_])&&o.bone.active)if(Jht>=0&&Jht===o.data.index&&(fft=!0),fft)if(Zht>=0&&Zht===o.data.index&&(fft=!1),Vft=0,Xft=0,e=o.getAttachment())if(r=e instanceof rut.RegionAttachment,a=e instanceof rut.MeshAttachment,e instanceof rut.ClippingAttachment)u.clipStart(o,e);else if(r||a){var p=e.region.texture.getRealTexture();if(h=$ft(o.data.blendMode)){if(Jft||(Jft=h),_ft||h.hash!==Jft.hash||p&&Zft!==p){_ft=!1;var m=qft-f;m>0&&(Cft._requestDrawData(Jft,Zft,f,m),f=qft),Zft=p,Jft=h}if(r){if(i=Dft,Vft=(Hft=4)*sft,Xft=6,e.computeWorldVertices(o.bone,Ift,jft,sft),l&&tft){l.strokeColor=Oft,l.moveTo(Ift[jft],Ift[jft+1]);for(var g=jft+sft,v=jft+Vft;g<v;g+=sft)l.lineTo(Ift[g],Ift[g+1]);l.close(),l.stroke()}}else if(a){var y=e;if(i=y.triangles,Hft=y.worldVerticesLength>>1,Vft=Hft*sft,Xft=i.length,y.computeWorldVertices(o,0,y.worldVerticesLength,Ift,jft,sft),l&&nft){l.strokeColor=Lft;for(var S=0,T=i.length;S<T;S+=3){var x=i[S]*sft+jft,E=i[S+1]*sft+jft,A=i[S+2]*sft+jft;l.moveTo(Ift[x],Ift[x+1]),l.lineTo(Ift[E],Ift[E+1]),l.lineTo(Ift[A],Ift[A+1]),l.close(),l.stroke()}}}if(0!==Vft&&0!==Xft){var C=e;(wft=t.indices).set(i,qft),n=C.uvs;for(var b=jft,w=jft+Vft,I=0;b<w;b+=sft,I+=2)Ift[b+3]=n[I],Ift[b+4]=n[I+1];if(o_t(c,C.color,o.color,u,o),Xft>0)for(var P=t.chunk.vertexOffset,R=qft,D=qft+Xft;R<D;R++)wft[R]+=Wft+P;jft+=Vft,Wft+=Hft,qft+=Xft,Hft=0,Xft=0,u.clipEndWithSlot(o)}else u.clipEndWithSlot(o)}else u.clipEndWithSlot(o)}else u.clipEndWithSlot(o);else u.clipEndWithSlot(o);else u.clipEndWithSlot(o);var O=qft-f;if(Zft&&O>0&&Cft._requestDrawData(Jft,Zft,f,O),u.clipEnd(),l&&eft){var N;l.strokeColor=Nft,l.fillColor=Oft;for(var M=0,L=s.bones.length;M<L;M++){var F=(N=s.bones[M]).data.length*N.a+N.worldX,B=N.data.length*N.c+N.worldY;l.moveTo(N.worldX,N.worldY),l.lineTo(F,B),l.stroke(),l.circle(N.worldX,N.worldY,1.5*Math.PI),l.fill(),0===M&&(l.fillColor=Mft)}}}(),Qft&&Qft.end()),($ht?r_t:i_t).getMeshBuffer(bft.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),Cft=void 0,Qft=null}}(t)},updateColor:function(t){t&&(Cft=t).markForUpdateRenderData()},fillBuffers:function(){}};function o_t(t,e,n,i,r){if(Fft.a=n.a*e.a*t.a*oft*255,Qht=Kht?Fft.a:255,lft=ift*e.r*t.r*Qht,uft=rft*e.g*t.g*Qht,hft=aft*e.b*t.b*Qht,Fft.r=lft*n.r,Fft.g=uft*n.g,Fft.b=hft*n.b,null==r.darkColor?Bft.set(0,0,0,1):(Bft.r=r.darkColor.r*lft,Bft.g=r.darkColor.g*uft,Bft.b=r.darkColor.b*hft),Bft.a=Kht?255:0,i.isClipping()){cft=$ht?12:8;var a=Ift.subarray(jft),o=Ift.subarray(jft+3);i.clipTriangles(a,Vft,wft.subarray(qft),Xft,o,Fft,Bft,$ht,sft);var s=i.clippedVertices,c=i.clippedTriangles;if(function(t,e){var n=Hft,i=Xft,r=bft;Xft=e.length,Hft=t.length/cft,Vft=Hft*sft,Yft+=Hft-n,Kft+=Xft-i;var a=wft,o=r.chunk.vertexOffset,s=!1;if(Yft>r.vertexCount&&(r.resizeAndCopy(Yft,Kft>r.indexCount?Kft:r.indexCount),Ift=r.chunk.vb,s=!0),Kft>wft.length&&(wft=r.indices=new Uint16Array(Kft),s=!0),s)for(var c=r.chunk.vertexOffset-o,l=0;l<qft;++l)wft[l]=a[l]+c}(s,c),c.length>0&&wft.set(c,qft),Qft)for(var l=0,u=s.length,h=jft;l<u;l+=cft,h+=sft)zft.x=s[l],zft.y=s[l+1],Fft.set(s[l+2],s[l+3],s[l+4],s[l+5]),Uft.x=s[l+6],Uft.y=s[l+7],$ht?Bft.set(s[l+8],s[l+9],s[l+10],s[l+11]):Bft.set(0,0,0,0),Qft.transform(zft,Uft,Fft,Bft),Ift[h]=zft.x,Ift[h+1]=zft.y,Ift[h+3]=Uft.x,Ift[h+4]=Uft.y,Ift.set(n_t(Fft),h+5),$ht&&Ift.set(n_t(Bft),h+9);else for(var f=0,_=s.length,d=jft;f<_;f+=cft,d+=sft)Ift[d]=s[f],Ift[d+1]=s[f+1],Ift[d+3]=s[f+6],Ift[d+4]=s[f+7],Ift[d+5]=s[f+2]/255,Ift[d+6]=s[f+3]/255,Ift[d+7]=s[f+4]/255,Ift[d+8]=s[f+5]/255,$ht&&(Ift[d+9]=s[f+8]/255,Ift[d+10]=s[f+9]/255,Ift[d+11]=s[f+10]/255,Ift[d+12]=s[f+11]/255)}else if(Qft)for(var p=jft,m=jft+Vft;p<m;p+=sft)zft.x=Ift[p],zft.y=Ift[p+1],Uft.x=Ift[p+3],Uft.y=Ift[p+4],Qft.transform(zft,Uft,Fft,Bft),Ift[p]=zft.x,Ift[p+1]=zft.y,Ift[p+3]=Uft.x,Ift[p+4]=Uft.y,Ift.set(n_t(Fft),p+5),$ht&&Ift.set(n_t(Bft),p+9);else{kft.set(n_t(Fft)),Gft.set(n_t(Bft));for(var g=jft,v=jft+Vft;g<v;g+=sft)Ift.set(kft,g+5),$ht&&Ift.set(Gft,g+9)}}l.internal.SpineAssembler=a_t;var s_t,c_t,l_t,u_t,h_t,f_t,__t,d_t,p_t,m_t={getAssembler:function(){return a_t}};Yht.Assembler=m_t,k(Yht.prototype,"Skeleton",[{name:"enableBatch",suggest:"Not support batch render mode"}]),function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(s_t||(s_t={})),le(s_t),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(c_t||(c_t={})),le(c_t),t("sp",Object.freeze({__proto__:null,spine:rut,get ATTACHMENT_TYPE(){return s_t},get AnimationEventType(){return c_t},timeScale:1,get DefaultSkinsEnum(){return Ght},get DefaultAnimsEnum(){return Vht},get AnimationCacheMode(){return Hht},get SpineMaterialType(){return Wht},SpineSocket:qht,Skeleton:Yht,SkeletonData:Hut,SkeletonTexture:kut,convertFilter:Gut,convertWraps:Vut,VertexEffectDelegate:Rft,simpleSpineAssembler:m_t})),function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(l_t||(l_t={})),le(l_t),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(u_t||(u_t={})),le(u_t),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(h_t||(h_t={})),le(h_t),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(f_t||(f_t={})),le(f_t),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(__t||(__t={})),le(__t),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(d_t||(d_t={})),le(d_t),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(p_t||(p_t={})),le(p_t);var g_t=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new ii(0,0),this.tileOffset=new Qn(0,0),this._tileSize=new ii(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var n=e||new ai(0,0,0,0);n.width=this._tileSize.width,n.height=this._tileSize.height;var i=t;i&=h_t.FLIPPED_MASK,i-=this.firstGid;var r=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return n.x=Math.round(i%r*(this._tileSize.width+this.spacing)+this.margin),n.y=Math.round(Math.floor(i/r)*(this._tileSize.height+this.spacing)+this.margin),n},t}(),v_t=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new Pn(255,255,255,255),this.offset=new Qn(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),y_t=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new Qn(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();y_t.ATTRIB_NONE=1,y_t.ATTRIB_BASE64=2,y_t.ATTRIB_GZIP=4,y_t.ATTRIB_ZLIB=8;var S_t=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new Qn(0,0),this.opacity=0,this.trans=new Pn(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function T_t(t){var e=uk.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function x_t(t){var e=uk.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function E_t(t){if(!t)return new Pn(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0;return new Pn(n,i,r,e)}var a=parseInt(t.substr(0,2),16)||0,o=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0;return new Pn(a,o,s,255)}function A_t(t,e){for(var n=[],i=t.getElementsByTagName("properties"),r=0;r<i.length;++r)for(var a=i[r].getElementsByTagName("property"),o=0;o<a.length;++o)n.push(a[o]);e=e||{};for(var s=0;s<n.length;s++){var c=n[s],l=c.getAttribute("name"),u=c.getAttribute("type")||"string",h=c.getAttribute("value");"int"===u?h=parseInt(h):"float"===u?h=parseFloat(h):"bool"===u?h="true"===h:"color"===u&&(h=E_t(h)),e[l]=h}return e}var C_t,b_t,w_t,I_t,P_t,R_t,D_t,O_t,N_t,M_t,L_t,F_t,B_t,z_t,U_t,k_t,G_t=function(){function t(t,e,n,i,r){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=d_t.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new ii(0,0),this._tileSize=new ii(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,n,i,r)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new ii(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new ii(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,n,i,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=n,this._imageLayerSPF=r,this._spfSizeMap=i,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=y_t.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,n){var i,r=(new uM).parse(e).documentElement,a=r.getAttribute("orientation"),o=r.getAttribute("staggeraxis"),s=r.getAttribute("staggerindex"),c=r.getAttribute("hexsidelength"),l=r.getAttribute("renderorder"),u=r.getAttribute("version")||"1.0.0";if("map"===r.nodeName){var h=u.split("."),f=this._supportVersion;for(i=0;i<f.length;i++){var _=parseInt(h[i])||0;if(f[i]<_){I(7216,u);break}}"orthogonal"===a?this.orientation=l_t.ORTHO:"isometric"===a?this.orientation=l_t.ISO:"hexagonal"===a?this.orientation=l_t.HEX:null!==a&&I(7217,a),this.renderOrder="right-up"===l?d_t.RightUp:"left-up"===l?d_t.LeftUp:"left-down"===l?d_t.LeftDown:d_t.RightDown,"x"===o?this.setStaggerAxis(f_t.STAGGERAXIS_X):"y"===o&&this.setStaggerAxis(f_t.STAGGERAXIS_Y),"odd"===s?this.setStaggerIndex(__t.STAGGERINDEX_ODD):"even"===s&&this.setStaggerIndex(__t.STAGGERINDEX_EVEN),c&&this.setHexSideLength(parseFloat(c));var d=new ii(0,0);d.width=parseFloat(r.getAttribute("width")),d.height=parseFloat(r.getAttribute("height")),this.setMapSize(d),(d=new ii(0,0)).width=parseFloat(r.getAttribute("tilewidth")),d.height=parseFloat(r.getAttribute("tileheight")),this.setTileSize(d),this.properties=A_t(r)}var p=r.getElementsByTagName("tileset");for("map"!==r.nodeName&&(p=[]).push(r),i=0;i<p.length;i++){var m=p[i],g=m.getAttribute("source");if(g){var v=parseInt(m.getAttribute("firstgid")),y=this._tsxContentMap[g];y&&this.parseXMLString(y,v)}else{var S=m.getElementsByTagName("image"),T=S.length>1,x=S[0],E=x.getAttribute("source");E=E.replace(/\\/g,"/");var A=m.getElementsByTagName("tile"),C=A&&A.length||1,b=null,w=m.getAttribute("name")||"",P=parseInt(m.getAttribute("spacing"))||0,R=parseInt(m.getAttribute("margin"))||0,D=n||parseInt(m.getAttribute("firstgid"))||0,N=new ii(0,0);N.width=parseFloat(m.getAttribute("tilewidth")),N.height=parseFloat(m.getAttribute("tileheight"));var M=m.getElementsByTagName("tileoffset")[0],L=0,F=0;M&&(L=parseFloat(M.getAttribute("x"))||0,F=parseFloat(M.getAttribute("y"))||0);for(var B=null,z=0;z<C;z++){var U=S[z]?S[z]:x;if(U){var k=U.getAttribute("source");if(k=k.replace(/\\/g,"/"),!B||T){if((B=new g_t).name=w,B.firstGid=D&h_t.FLIPPED_MASK,B.tileOffset.x=L,B.tileOffset.y=F,B.collection=T,!T&&(B.imageName=k,B.imageSize.width=parseFloat(U.getAttribute("width"))||0,B.imageSize.height=parseFloat(U.getAttribute("height"))||0,B.sourceImage=this._spriteFrameMap[k],!B.sourceImage)){var G=t.getNameWithPostfix(k);if(B.imageName=G,B.sourceImage=this._spriteFrameMap[G],!B.sourceImage){var V=t.getShortName(k);B.imageName=V,B.sourceImage=this._spriteFrameMap[V],B.sourceImage||(console.error("[error]: "+V+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),O(7221,k),console.warn("Please try asset type of "+k+" to 'sprite-frame'"))}}B.spacing=P,B.margin=R,B._tileSize.width=N.width,B._tileSize.height=N.height,this.setTilesets(B)}if(b=A&&A[z]){this.parentGID=D+(parseInt(b.getAttribute("id"))||0);var H=b.getElementsByTagName("image");if(H&&H.length>0){var W=H[0],j=W.getAttribute("source");if(j=j.replace(/\\/g,"/"),B.imageName=j,B.imageSize.width=parseFloat(W.getAttribute("width"))||0,B.imageSize.height=parseFloat(W.getAttribute("height"))||0,B._tileSize.width=B.imageSize.width,B._tileSize.height=B.imageSize.height,B.sourceImage=this._spriteFrameMap[j],!B.sourceImage){var X=t.getNameWithPostfix(j);if(B.imageName=X,B.sourceImage=this._spriteFrameMap[X],!B.sourceImage){var q=t.getShortName(j);B.imageName=q,B.sourceImage=this._spriteFrameMap[q],B.sourceImage||(O(7221,j),console.warn("Please try asset type of "+j+" to 'sprite-frame'"))}}B.firstGid=this.parentGID&h_t.FLIPPED_MASK}var Y=(h_t.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(Y,A_t(b));var K=b.getElementsByTagName("animation");if(K&&K.length>0){var Q=K[0].getElementsByTagName("frame"),J={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(Y,J);for(var Z=J.frames,$=0;$<Q.length;$++){var tt=Q[$],et=D+(parseInt(tt.getAttribute("tileid"))||0),nt=parseFloat(tt.getAttribute("duration"))||0;Z.push({tileid:et,duration:nt/1e3,grid:null})}}}}}}}var it=r.childNodes;for(i=0;i<it.length;i++){var rt=it[i];if(!this._shouldIgnoreNode(rt)){if("imagelayer"===rt.nodeName){var at=this._parseImageLayer(rt);at&&this.setImageLayers(at)}if("layer"===rt.nodeName){var ot=this._parseLayer(rt);this.setLayers(ot)}if("objectgroup"===rt.nodeName){var st=this._parseObjectGroup(rt);this.setObjectGroups(st)}}}return r},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var n=new S_t;n.name=t.getAttribute("name"),n.offset.x=parseFloat(t.getAttribute("offsetx"))||0,n.offset.y=parseFloat(t.getAttribute("offsety"))||0;var i=t.getAttribute("visible");n.visible=!("0"===i);var r=t.getAttribute("opacity");n.opacity=r?Math.round(255*parseFloat(r)):255;var a=t.getAttribute("tintcolor");n.tintColor=a?E_t(a):null;var o=e[0],s=o.getAttribute("source");return n.sourceImage=this._imageLayerSPF[s],n.width=parseInt(o.getAttribute("width"))||0,n.height=parseInt(o.getAttribute("height"))||0,n.trans=E_t(o.getAttribute("trans")),n.sourceImage?n:(O(7221,s),console.warn("Please try asset type of "+s+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],n=new y_t;n.name=t.getAttribute("name");var i=new ii(0,0);i.width=parseFloat(t.getAttribute("width")),i.height=parseFloat(t.getAttribute("height")),n.layerSize=i;var r=t.getAttribute("visible");n.visible=!("0"===r);var a=t.getAttribute("opacity");n.opacity=a?Math.round(255*parseFloat(a)):255,n.offset=new Qn(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var o=t.getAttribute("tintcolor");n.tintColor=o?E_t(o):null;for(var s="",c=0;c<e.childNodes.length;c++)s+=e.childNodes[c].nodeValue;s=s.trim();var l,u=e.getAttribute("compression"),h=e.getAttribute("encoding");if(u&&"gzip"!==u&&"zlib"!==u)return I(7218),null;switch(u){case"gzip":l=Mnt.unzipBase64AsArray(s,4);break;case"zlib":l=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,n=window.Uint32Array?new Uint32Array(e):[],i=0;i<e;i++){var r=4*i;n[i]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return n}(new wtt.Inflate(Mnt.Base64.decodeAsArray(s,1)).decompress());break;case null:case"":if("base64"===h)l=Mnt.Base64.decodeAsArray(s,4);else if("csv"===h){l=[];for(var f=s.split(","),_=0;_<f.length;_++)l.push(parseInt(f[_]))}else{var d=e.getElementsByTagName("tile");l=[];for(var p=0;p<d.length;p++)l.push(parseInt(d[p].getAttribute("gid")))}break;default:this.layerAttrs===y_t.ATTRIB_NONE&&I(7219)}return l&&(n.tiles=new Uint32Array(l)),n.properties=A_t(t),n},e._parseObjectGroup=function(t){var e=new v_t;e.name=t.getAttribute("name")||"",e.offset=new Qn(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var n=t.getAttribute("opacity");e.opacity=n?Math.round(255*parseFloat(n)):255;var i=t.getAttribute("tintcolor");e.tintColor=i?E_t(i):null;var r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);var a=t.getAttribute("color");a&&e.color.fromHEX(a);var o=t.getAttribute("draworder");o&&(e.draworder=o),e.setProperties(A_t(t));var s=t.getElementsByTagName("object");if(s){for(var c=0;c<s.length;c++){var l=s[c],u={};u.id=l.getAttribute("id")||c,u.name=l.getAttribute("name")||"",u.width=parseFloat(l.getAttribute("width"))||0,u.height=parseFloat(l.getAttribute("height"))||0,u.x=parseFloat(l.getAttribute("x"))||0,u.y=parseFloat(l.getAttribute("y"))||0,u.rotation=parseFloat(l.getAttribute("rotation"))||0,A_t(l,u);var h=l.getAttribute("visible");u.visible=!(h&&0===parseInt(h));var f=l.getElementsByTagName("text");if(f&&f.length>0){var _=f[0];u.type=p_t.TEXT,u.wrap="1"===_.getAttribute("wrap"),u.color=E_t(_.getAttribute("color")),u.halign=T_t(_.getAttribute("halign")),u.valign=x_t(_.getAttribute("valign")),u.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,u.text=_.childNodes[0].nodeValue}var d=l.getAttribute("gid");d&&(u.gid=parseInt(d),u.type=p_t.IMAGE);var p=l.getElementsByTagName("ellipse");p&&p.length>0&&(u.type=p_t.ELLIPSE);var m=l.getElementsByTagName("polygon");if(m&&m.length>0){u.type=p_t.POLYGON;var g=m[0].getAttribute("points");g&&(u.points=this._parsePointsString(g))}var v=l.getElementsByTagName("polyline");if(v&&v.length>0){u.type=p_t.POLYLINE;var y=v[0].getAttribute("points");y&&(u.polylinePoints=this._parsePointsString(y))}u.type||(u.type=p_t.RECT),e.objects.push(u)}"index"!==o&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],n=t.split(" "),i=0;i<n.length;i++){var r=n[i].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.length;return t.substring(e,n)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.lastIndexOf(".");return n=n<0?t.length:n,t.substring(e,n)},Q(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),V_t=t("TiledTile",(C_t=Ec("cc.TiledTile"),b_t=Gc(),w_t=Bc(),I_t=Ac(xz),P_t=al(Ne),R_t=al(Ne),D_t=al(Ne),O_t=al(Ne),N_t=al(Ne),C_t(M_t=b_t(M_t=w_t(M_t=I_t(M_t=Fc((z_t=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,st(e,"_x",F_t,rt(e)),st(e,"_y",B_t,rt(e)),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},n.onDisable=function(){this._resetTile()},n._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},n.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))S("There is already a TiledTile at [%s, %s]",t,e);else{var n=this._layer.getPositionAt(t,e);this.node.setPosition(n.x,n.y),this._layer.setTiledTileAt(t,e,this)}}},Q(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?S("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?S("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(Zu),F_t=ct((L_t=z_t).prototype,"_x",[P_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B_t=ct(L_t.prototype,"_y",[R_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ct(L_t.prototype,"x",[D_t],Object.getOwnPropertyDescriptor(L_t.prototype,"x"),L_t.prototype),ct(L_t.prototype,"y",[O_t],Object.getOwnPropertyDescriptor(L_t.prototype,"y"),L_t.prototype),ct(L_t.prototype,"grid",[N_t],Object.getOwnPropertyDescriptor(L_t.prototype,"grid"),L_t.prototype),M_t=L_t))||M_t)||M_t)||M_t)||M_t)||M_t));function H_t(t,e,n){var i=n||t.sourceImage,r=i.texture,a=t.collection;if(!t.imageSize.width||!t.imageSize.height){var o=t.sourceImage;t.imageSize.width=o.width,t.imageSize.height=o.height}var s=t.imageSize.width,c=t.imageSize.height,l=t._tileSize.width,u=t._tileSize.height,h=i.width,f=i.height,_=t.spacing,d=t.margin,p=1;if(!a){var m=Math.floor((s-2*d+_)/(l+_)),g=Math.floor((c-2*d+_)/(u+_));p=Math.max(1,g*m)}for(var v=t.firstGid,y=null,S=!!e.get(v),T=t.firstGid+p,x=v;x<T&&(S&&!e.get(x)&&(S=!1),S||!e.get(x));++x){if(y={tileset:t,x:0,y:0,width:l,height:u,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:x,spriteFrame:i,texture:r},t.rectForGID(x,y),!n||p>1)if(n){y._name=n.name;var E=n.unbiasUV[0],A=n.rotated?n.unbiasUV[1]:n.unbiasUV[5];y.l=E+(y.x+.5)/h,y.t=A+(y.y+.5)/f,y.r=E+(y.x+y.width-.5)/h,y.b=A+(y.y+y.height-.5)/f,y._rect=new ai(y.x,y.y,y.width,y.height)}else y.l=y.x/h,y.t=y.y/f,y.r=(y.x+y.width)/h,y.b=(y.y+y.height)/f,y._rect=new ai(y.x,y.y,y.width,y.height);else n.rotated?(y._rotated=!0,y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[1],y.r=n.unbiasUV[4],y.b=n.unbiasUV[3]):(y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[5],y.r=n.unbiasUV[2],y.b=n.unbiasUV[1]);y.cx=(y.l+y.r)/2,y.cy=(y.t+y.b)/2,e.set(x,y)}}for(var W_t,j_t,X_t,q_t,Y_t,K_t,Q_t,J_t,Z_t,$_t,tdt,edt,ndt,idt,rdt,adt,odt,sdt,cdt,ldt,udt,hdt,fdt,_dt,ddt,pdt,mdt,gdt,vdt,ydt,Sdt,Tdt,xdt,Edt,Adt,Cdt,bdt,wdt,Idt=new Xn,Pdt=new Qn,Rdt=new Dn,Ddt=new Dn,Odt={row:0,col:0},Ndt=t("TiledUserNodeData",Ec("cc.TiledUserNodeData")(U_t=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return Z(e,t),e}(Zu))||U_t),Mdt=t("TiledLayer",Ec("cc.TiledLayer")(k_t=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}Z(e,t);var n=e.prototype;return n.hasTiledNode=function(){return this._hasTiledNodeGrid},n.hasAnimation=function(){return this._hasAniGrid},n.addUserNode=function(t){var e=t.getComponent(Ndt);return e?(S("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(Ndt),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),Pdt),this._positionToRowCol(Pdt.x,Pdt.y,Odt),this._addUserNodeToGrid(e,Odt),this._updateCullingOffsetByUserNode(t),t.on(rA.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(rA.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},n.removeUserNode=function(t){var e=t.getComponent(Ndt);return e?(t.off(rA.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(rA.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(S("CCTiledLayer:removeUserNode node is not exist"),!1)},n.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},n._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},n.getNodesByRowCol=function(t,e){var n=this._userNodeGrid[t];return n?n[e]:null},n.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},n._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),Pdt),this._positionToRowCol(Pdt.x,Pdt.y,Odt),this._addUserNodeToGrid(e,Odt),this._updateCullingOffsetByUserNode(e.node)}},n._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},n._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},n._userNodePosChange=function(){var t=this,e=t.node,n=t._tiledLayer;n._nodeLocalPosToLayerPos(e.getPosition(),Pdt),n._positionToRowCol(Pdt.x,Pdt.y,Odt),n._limitInLayer(Odt),Odt.row===t._row&&Odt.col===t._col||(n._removeUserNodeFromGrid(t),n._addUserNodeToGrid(t,Odt))},n._removeUserNodeFromGrid=function(t){var e=t._row,n=t._col,i=t._index,r=this._userNodeGrid[e],a=r&&r[n];a&&(r.count--,a.count--,a.list[i]=null,a.count<=0&&(a.list.length=0,a.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},n._limitInLayer=function(t){var e=t.row,n=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),n<0&&(t.col=0),n>this._rightTop.col&&(t.col=this._rightTop.col)},n._addUserNodeToGrid=function(t,e){var n=e.row,i=e.col,r=this._userNodeGrid[n]=this._userNodeGrid[n]||{count:0},a=r[i]=r[i]||{count:0,list:[]};t._row=n,t._col=i,t._index=a.list.length,r.count++,a.count++,a.list.push(t),this._userNodeDirty=!0},n.isUserNodeDirty=function(){return this._userNodeDirty},n.setUserNodeDirty=function(t){this._userNodeDirty=t},n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(rA.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(rA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(rA.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(rA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(rA.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},n.onDisable=function(){var e,n;t.prototype.onDisable.call(this),null===(e=this.node.parent)||void 0===e||e.off(rA.SIZE_CHANGED,this.updateCulling,this),null===(n=this.node.parent)||void 0===n||n.off(rA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(rA.SIZE_CHANGED,this.updateCulling,this),this.node.off(rA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(rA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,n=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*n.x,this._leftDownToCenterY=e.height*e.anchorY*n.y,this._cullingDirty=!0,this.markForUpdateRenderData()},n.getLayerName=function(){return this._layerName},n.setLayerName=function(t){this._layerName=t},n.getProperty=function(t){return this._properties[t]},n.getPositionAt=function(t,e){var n;switch(void 0!==e?(n=Math.floor(t),e=Math.floor(e)):(n=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case l_t.ORTHO:return this._positionForOrthoAt(n,e);case l_t.ISO:return this._positionForIsoAt(n,e);case l_t.HEX:return this._positionForHexAt(n,e)}return null},n.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},n._positionForIsoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&h_t.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Qn(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+n,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-i)},n._positionForOrthoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&h_t.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Qn(t*this._mapTileSize.width+n,(this._layerSize.height-e-1)*this._mapTileSize.height-i)},n._positionForHexAt=function(t,e){var n,i=this._mapTileSize.width,r=this._mapTileSize.height,a=this._layerSize.height,o=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=(this.tiles[o]&h_t.FLIPPED_MASK)>>>0;n=this.texGrids.get(s)?this.texGrids.get(s).tileset.tileOffset:{x:0,y:0};var c=this._staggerIndex===__t.STAGGERINDEX_ODD?1:-1,l=0,u=0,h=0,f=0;switch(this._staggerAxis){case f_t.STAGGERAXIS_Y:h=0,e%2==1&&(h=i/2*c),l=t*i+h+n.x,u=(a-e-1)*(r-(r-this._hexSideLength)/2)-n.y;break;case f_t.STAGGERAXIS_X:f=0,t%2==1&&(f=r/2*-c),l=t*(i-(i-this._hexSideLength)/2)+n.x,u=(a-e-1)*r+f-n.y}return new Qn(l,u)},n.setTilesGIDAt=function(t,e,n,i){if(t&&0!==t.length&&!(i<=0)){n<0&&(n=0),e<0&&(e=0);for(var r=0,a=e+i,o=n;;o++)for(var s=e;s<a;s++){if(r>=t.length)return;this._updateTileForGID(t[r],s,o),r++}}},n.setTileGIDAt=function(t,e,n,i){var r=(t&h_t.FLIPPED_MASK)>>>0;if(e=Math.floor(e),n=Math.floor(n),this.isInvalidPosition(e,n))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==r&&r<this._tilesets[0].firstGid?I(7239,t):(i=i||0,this._updateTileForGID((r|i)>>>0,e,n)):I(7238)},n._updateTileForGID=function(t,e,n){var i=0|e+n*this._layerSize.width;if(!(i>=this.tiles.length)&&t!==this.tiles[i]){var r=(t&h_t.FLIPPED_MASK)>>>0;this.texGrids.get(r)?(this.tiles[i]=t,this._updateVertex(e,n)):this.tiles[i]=0,this._cullingDirty=!0}},n.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return I(7237),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&h_t.FLIPPED_MASK)>>>0},n.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return I(7240),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&h_t.FLIPPED_ALL)>>>0},n.setCullingDirty=function(t){this._cullingDirty=t},n.isCullingDirty=function(){return this._cullingDirty},n.updateViewPort=function(t,e,n,i){if(this._viewPort.width!==n||this._viewPort.height!==i||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=n,this._viewPort.height=i;var r=1;this._layerOrientation===l_t.ISO&&(r=2);var a=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,s=a-this._leftOffset,c=o-this._downOffset,l=a+n+this._rightOffset,u=o+i+this._topOffset,h=this._cullingRect.leftDown,f=this._cullingRect.rightTop;s<0&&(s=0),c<0&&(c=0),this._positionToRowCol(s,c,Odt),Odt.row-=r,Odt.col-=r,Odt.row=Odt.row>0?Odt.row:0,Odt.col=Odt.col>0?Odt.col:0,Odt.row===h.row&&Odt.col===h.col||(h.row=Odt.row,h.col=Odt.col,this._cullingDirty=!0),l<0||u<0?(Odt.row=-1,Odt.col=-1):(this._positionToRowCol(l,u,Odt),Odt.row++,Odt.col++),Odt.row>this._rightTop.row&&(Odt.row=this._rightTop.row),Odt.col>this._rightTop.col&&(Odt.col=this._rightTop.col),Odt.row===f.row&&Odt.col===f.col||(f.row=Odt.row,f.col=Odt.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},n._positionToRowCol=function(t,e,n){var i=this._mapTileSize.width,r=this._mapTileSize.height,a=.5*i,o=.5*r,s=0,c=0,l=0,u=0,h=this._staggerAxis;switch(this._layerOrientation){case l_t.ORTHO:c=Math.floor(t/i),s=Math.floor(e/r);break;case l_t.ISO:c=Math.floor(t/a),s=Math.floor(e/o);break;case l_t.HEX:h===f_t.STAGGERAXIS_Y?(l=(s=Math.floor(e/(r-this._diffY1)))%2==1?a*this._odd_even:0,c=Math.floor((t-l)/i)):(u=(c=Math.floor(t/(i-this._diffX1)))%2==1?o*-this._odd_even:0,s=Math.floor((e-u)/r))}return n.row=s,n.col=c,n},n.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),Xn.invert(Idt,this.node.getWorldMatrix());var t=lN.root.batcher2D.getFirstRenderCamera(this.node);t&&(Rdt.x=0,Rdt.y=0,Rdt.z=0,Ddt.x=t.width,Ddt.y=t.height,Ddt.z=0,t.screenToWorld(Rdt,Rdt),t.screenToWorld(Ddt,Ddt),Dn.transformMat4(Rdt,Rdt,Idt),Dn.transformMat4(Ddt,Ddt,Idt),this.updateViewPort(Rdt.x,Rdt.y,Ddt.x-Rdt.x,Ddt.y-Rdt.y))}},n.getLayerOrientation=function(){return this._layerOrientation},n.getProperties=function(){return this._properties},n._updateVertex=function(t,e){var n=h_t.FLIPPED_MASK,i=this.vertices,r=this._layerOrientation,a=this.tiles;if(a){var o,s,c,l,u=this._rightTop,h=this._mapTileSize.width,f=this._mapTileSize.height,_=.5*h,d=.5*f,p=this._layerSize.height,m=this._layerSize.width,g=this.texGrids,v=0,y=0;r===l_t.HEX&&(o=this._staggerAxis,s=this._diffX1,c=this._diffY1,l=this._odd_even);var S,T,x,E=0,A=0,C=0,b=0,w=e*m+t;S=(a[w]&n)>>>0;var I=g.get(S);if(I){switch(this._animations.get(S)&&(this._hasAniGrid=this._hasAniGrid||!0),r){case l_t.ORTHO:v=(E=t)*h,y=(A=p-e-1)*f;break;case l_t.ISO:v=_*(E=p+t-e-1),y=d*(A=p+m-t-e-2);break;case l_t.HEX:v=t*(h-s)+(o===f_t.STAGGERAXIS_Y&&e%2==1?_*l:0),y=(p-e-1)*(f-c)+(o===f_t.STAGGERAXIS_X&&t%2==1?d*-l:0),E=t,A=p-e-1}var P=i[A]=i[A]||{minCol:0,maxCol:0},R=P[E]=P[E]||{};P.minCol>E&&(P.minCol=E),P.maxCol<E&&(P.maxCol=E),u.row<A&&(u.row=A,r===l_t.ISO&&(u.row+=1)),u.col<E&&(u.col=E,r===l_t.ISO&&(u.col+=1));var D=I.tileset.tileOffset;v+=this._offset.x+D.x+I.offsetX,y+=this._offset.y-D.y-I.offsetY,C=(C=-D.y+I.tileset._tileSize.height-f)<0?0:C,T=D.y<0?0:D.y,x=-D.x<0?0:-D.x,b=(b=D.x+I.tileset._tileSize.width-h)<0?0:b,this._rightOffset<x&&(this._rightOffset=x),this._leftOffset<b&&(this._leftOffset=b),this._topOffset<T&&(this._topOffset=T),this._downOffset<C&&(this._downOffset=C),R.left=v,R.bottom=y,R.index=w,this._cullingDirty=!0}}},n._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,n=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var i=0;i<e;++i)for(var r=0;r<n;++r)this._updateVertex(r,i);this._verticesDirty=!1}},n.getTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return I(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this.tiledTiles[i];if(!r&&n){var a=new ob;return(r=a.addComponent(V_t))._x=t,r._y=e,r._layer=this,r.updateInfo(),a.parent=this.node,r}return r},n.setTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return I(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[i]=n,this._cullingDirty=!0,this._hasTiledNodeGrid=!!n||this.tiledTiles.some((function(t){return!!t})),n},n.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},n.getTextures=function(){return this._textures},n.setTexture=function(t){this.setTextures([t])},n.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},n.getLayerSize=function(){return this._layerSize},n.getMapTileSize=function(){return this._mapTileSize},n.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},n.getTileSets=function(){return this._tilesets},n.setTileSet=function(t){this.setTileSets([t])},n.setTileSets=function(t){this._tilesets=t;var e=this._textures=[],n=this.texGrids;n.clear();for(var i=0;i<t.length;i++){var r=t[i];r&&(e[i]=r.sourceImage)}for(var a=0,o=t.length;a<o;++a){var s=t[a];s&&H_t(s,n,s.sourceImage)}this._prepareToRender()},n.init=function(t,e,n,i,r){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var a=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=a,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=n,this._textures=i,this.texGrids=r,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var o=this._mapTileSize.width,s=this._mapTileSize.height,c=this._layerSize.width,l=this._layerSize.height;if(this._layerOrientation===l_t.HEX){var u=0,h=0;this._odd_even=this._staggerIndex===__t.STAGGERINDEX_ODD?1:-1,this._staggerAxis===f_t.STAGGERAXIS_X?(this._diffX1=(o-this._hexSideLength)/2,this._diffY1=0,h=s*(l+.5),u=(o+this._hexSideLength)*Math.floor(c/2)+o*(c%2)):(this._diffX1=0,this._diffY1=(s-this._hexSideLength)/2,u=o*(c+.5),h=(s+this._hexSideLength)*Math.floor(l/2)+s*(l%2)),this.node._uiProps.uiTransformComp.setContentSize(u,h)}else if(this._layerOrientation===l_t.ISO){var f=c+l;this.node._uiProps.uiTransformComp.setContentSize(.5*o*f,.5*s*f)}else this.node._uiProps.uiTransformComp.setContentSize(c*o,l*s);this._offset=new Qn(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},n._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},n.requestMeshRenderData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){var e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}var n=fz.add(),i={renderData:n,texture:null};return n.material=this.getRenderMaterial(0),this._meshRenderDataArray.push(i),i},n.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);var t=this._meshRenderDataArray;if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},n.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){var e=t.renderData;e&&fz.remove(e)})),this._meshRenderDataArray.length=0),t.prototype.destroyRenderData.call(this)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var n=this._meshRenderDataArray[e];n.subNodes?n.subNodes.forEach((function(e){e&&t.walk(e.node)})):n.texture&&t.commitComp(this,n.renderData,n.texture,this._assembler,null)}this.node._static=!0}},Q(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),e}(ok))||k_t),Ldt=t("TiledObjectGroup",(W_t=Ec("cc.TiledObjectGroup"),j_t=Gc(),X_t=Ac(xz),q_t=al(Le),W_t(Y_t=j_t(Y_t=X_t((ct((K_t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}Z(e,t);var n=e.prototype;return n.getPositionOffset=function(){return this._positionOffset},n.getProperties=function(){return this._properties},n.getGroupName=function(){return this._groupName},n.getProperty=function(t){return this._properties[t.toString()]},n.getObject=function(t){for(var e=0,n=this._objects.length;e<n;e++){var i=this._objects[e];if(i&&i.name===t)return i}return null},n.getObjects=function(){return this._objects},n._init=function(t,e,n){var i=h_t.FLIPPED_MASK,r=h_t.HORIZONTAL,a=h_t.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new Qn(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=n,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var o=e.mapSize,s=e.tileSize,c=0,l=0,u=new Pn,h=l_t.ISO===e.orientation;if(e.orientation===l_t.HEX)e.getStaggerAxis()===f_t.STAGGERAXIS_X?(l=s.height*(o.height+.5),c=(s.width+e.getHexSideLength())*Math.floor(o.width/2)+s.width*(o.width%2)):(c=s.width*(o.width+.5),l=(s.height+e.getHexSideLength())*Math.floor(o.height/2)+s.height*(o.height%2));else if(h){var f=o.width+o.height;c=.5*s.width*f,l=.5*s.height*f}else c=o.width*s.width,l=o.height*s.height;var _=this.node._uiProps.uiTransformComp;_.setContentSize(c,l);for(var d=c*_.anchorX,p=l*(1-_.anchorY),m=t.objects,g={},v=0,y=m.length;v<y;v++){var S=m[v],T=S.type;S.offset=new Qn(S.x,S.y);var x=S.points||S.polylinePoints;if(x)for(var E=0;E<x.length;E++)x[E].y*=-1;if(h){var A=S.x/s.height,C=S.y/s.height;S.x=.5*s.width*(o.height+A-C),S.y=.5*s.height*(o.width+o.height-A-C)}else S.y=l-S.y;if(T===p_t.TEXT){var b="text"+S.id;g[b]=!0;var w=this.node.getChildByName(b);w||(w=new ob),w.setRotationFromEuler(0,0,-S.rotation),w.setPosition(S.x-d,S.y-p),w.name=b,w.parent=this.node,w.setSiblingIndex(v);var I=w.getComponent(uk);I||(I=w.addComponent(uk));var P=w._uiProps.uiTransformComp;w.active=S.visible,P.anchorX=0,P.anchorY=1,this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,I.color.set(u)):I.color.a*=this._opacity/255,I.overflow=uk.Overflow.SHRINK,I.lineHeight=S.height,I.string=S.text,I.horizontalAlign=S.halign,I.verticalAlign=S.valign,I.fontSize=S.pixelsize,P.setContentSize(S.width,S.height)}else if(T===p_t.IMAGE){var R=S.gid,D=(R&i)>>>0,O=n.get(D);if(!O)continue;var N=O.tileset,M="img"+S.id;g[M]=!0;var L=this.node.getChildByName(M);S.width=S.width||O.width,S.height=S.height||O.height,L&&L._objFlags&_l.Flags.HideInHierarchy&&(L.removeFromParent(),L.hideFlags|=_l.Flags.DontSave,L.destroy(),L=null),L||(L=new ob),this._animations.get(D)&&(this.aniObjects.push({object:S,imgNode:L,gridGID:D}),this._hasAniObj=!0);var F=N.tileOffset.x,B=N.tileOffset.y;L.active=S.visible,L.setRotationFromEuler(0,0,-S.rotation),L.setPosition(S.x-d,S.y-p),L.name=M,L.parent=this.node,L.setSiblingIndex(v);var z=L.getComponent(kV);z||(z=L.addComponent(kV));var U=L._uiProps.uiTransformComp;h?(U.anchorX=.5+F/S.width,U.anchorY=B/S.height):(U.anchorX=F/S.width,U.anchorY=B/S.height),this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,z.color.set(u)):z.color.a*=this._opacity/255,z.sizeMode=kV.SizeMode.CUSTOM,z._srcBlendFactor=this._premultiplyAlpha?Oi.ONE:Oi.SRC_ALPHA,z._dstBlendFactor=Oi.ONE_MINUS_SRC_ALPHA,z._updateBlendFunc();var k=O.spriteFrame;k=k?k.clone():new XF,(R&r)>>>0&&(k.flipUVX=!k.flipUVX),(R&a)>>>0&&(k.flipUVY=!k.flipUVY),k.rotated=O._rotated,k.rect=O._rect,z.spriteFrame=k,U.setContentSize(S.width,S.height),z.markForUpdateRenderData()}}this._objects=m;for(var G=this.node.children,V=/^(?:img|text)\d+$/,H=0,W=G.length;H<W;H++){var j=G[H],X=j.name;V.test(X)&&!g[X]&&j.destroy()}},n.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,n=l_t.ISO===this._mapInfo.orientation,i=0,r=t.length;i<r;i++){var a=t[i],o=a.gridGID,s=e.get(o);if(s){var c=s.tileset,l=a.object,u=a.imgNode,h=c.tileOffset.x,f=c.tileOffset.y,_=u._uiProps.uiTransformComp;n?(_.anchorX=.5+h/l.width,_.anchorY=f/l.height):(_.anchorX=h/l.width,_.anchorY=f/l.height);var d=u.getComponent(kV),p=d.spriteFrame;p.rotated=s._rotated,p.rect=s._rect,d.spriteFrame=p,d.markForUpdateRenderData()}}},Q(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(Zu)).prototype,"premultiplyAlpha",[q_t],Object.getOwnPropertyDescriptor(K_t.prototype,"premultiplyAlpha"),K_t.prototype),Y_t=K_t))||Y_t)||Y_t)||Y_t)),Fdt=t("TiledMapAsset",(Q_t=Ec("cc.TiledMapAsset"),J_t=al([wD]),Z_t=al([Fe]),$_t=al([XF]),tdt=al([XF]),edt=al([Fe]),ndt=al([Fe]),idt=al([ii]),Q_t((ddt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"tmxXmlStr",odt,rt(e)),st(e,"tsxFiles",sdt,rt(e)),st(e,"tsxFileNames",cdt,rt(e)),st(e,"spriteFrames",ldt,rt(e)),st(e,"imageLayerSpriteFrame",udt,rt(e)),st(e,"imageLayerSpriteFrameNames",hdt,rt(e)),st(e,"spriteFrameNames",fdt,rt(e)),st(e,"spriteFrameSizes",_dt,rt(e)),e}return Z(e,t),e}(Du),odt=ct((adt=ddt).prototype,"tmxXmlStr",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sdt=ct(adt.prototype,"tsxFiles",[Dc,J_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cdt=ct(adt.prototype,"tsxFileNames",[Dc,Z_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ldt=ct(adt.prototype,"spriteFrames",[Dc,$_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),udt=ct(adt.prototype,"imageLayerSpriteFrame",[Dc,tdt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hdt=ct(adt.prototype,"imageLayerSpriteFrameNames",[Dc,edt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fdt=ct(adt.prototype,"spriteFrameNames",[Dc,ndt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_dt=ct(adt.prototype,"spriteFrameSizes",[Dc,idt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rdt=adt))||rdt)),Bdt=(t("TiledMap",(pdt=Ec("cc.TiledMap"),mdt=Gc(),gdt=Bc(),vdt=Ac(xz),ydt=al(Fdt),Sdt=Zc(),pdt(Tdt=mdt(Tdt=gdt(Tdt=vdt(Tdt=Fc((wdt=bdt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new ii(0,0),e._tileSize=new ii(0,0),e._mapOrientation=l_t.ORTHO,e._isApplied=!1,st(e,"_tmxFile",Edt,rt(e)),st(e,"_enableCulling",Adt,rt(e)),st(e,"cleanupImageCache",Cdt,rt(e)),e}Z(e,t);var n=e.prototype;return n.getMapSize=function(){return this._mapSize},n.getTileSize=function(){return this._tileSize},n.getMapOrientation=function(){return this._mapOrientation},n.getObjectGroups=function(){return this._groups},n.getObjectGroup=function(t){for(var e=this._groups,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getGroupName()===t)return r}return null},n.getProperties=function(){return this._properties},n.getLayers=function(){return this._layers},n.getLayer=function(t){for(var e=this._layers,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getLayerName()===t)return r}return null},n._changeLayer=function(t,e){for(var n=this._layers,i=0,r=n.length;i<r;i++){var a=n[i];if(a&&a.getLayerName()===t)return void(n[i]=e)}},n.getProperty=function(t){return this._properties[t.toString()]},n.getPropertiesForGID=function(t){return this._tileProperties.get(t)},n.__preload=function(){this._tmxFile&&!1===this._isApplied&&(this._applyFile(),this._isApplied=!0)},n.onEnable=function(){this.node.on(rA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n.onDisable=function(){this.node.off(rA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._applyFile=function(){var t=[],e={},n=this._tmxFile;if(n){for(var i=n.spriteFrameNames,r=n.spriteFrameSizes,a=n.spriteFrames,o={},s={},c=0;c<i.length;++c){var l=i[c];s[l]=r[c],t[c]=a[c];var u=t[c];u&&(e[u.name]=u,o[l]=u)}var h={},f=n.imageLayerSpriteFrame;i=n.imageLayerSpriteFrameNames;for(var _=0;_<f.length;++_)h[i[_]]=f[_];for(var d=n.tsxFileNames,p=n.tsxFiles,m={},g=0;g<d.length;++g)d[g].length>0&&(m[d[g]]=p[g].text);var v=new G_t(n.tmxXmlStr,m,o,s,h),y=v.getTilesets();y&&0!==y.length||I(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},n._releaseMapInfo=function(){for(var t=this._layers,e=0,n=t.length;e<n;e++){var i,r;null===(i=t[e].node.parent)||void 0===i||i.off(rA.SIZE_CHANGED,t[e].updateCulling,t[e]),null===(r=t[e].node.parent)||void 0===r||r.off(rA.TRANSFORM_CHANGED,t[e].updateCulling,t[e]),t[e].node.removeFromParent(),t[e].node.destroy()}t.length=0;for(var a=this._groups,o=0,s=a.length;o<s;o++)a[o].node.removeFromParent(),a[o].node.destroy();a.length=0;for(var c=this._images,l=0,u=c.length;l<u;l++)c[l].removeFromParent(),c[l].destroy();c.length=0},n._syncAnchorPoint=function(){var t,e,n=this.node._uiProps.uiTransformComp.anchorPoint,i=this.node._uiProps.uiTransformComp.width*n.x,r=this.node._uiProps.uiTransformComp.height*(1-n.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(n);for(t=0,e=this._groups.length;t<e;t++){var a=this._groups[t],o=a.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var s=a.offset.x-i+o.width*o.anchorX,c=a.offset.y+r-o.height*o.anchorY;a.node.setPosition(s,c)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-i+l.width*l.anchorX,h=this._images[t]._offset.y+r-l.height*l.anchorY;this._images[t].setPosition(u,h)}},n._fillAniGrids=function(t,e){for(var n,i=ot(e.keys());!(n=i()).done;){var r=n.value,a=e.get(r);if(a)for(var o=a.frames,s=0;s<o.length;s++){var c=o[s];c.grid=t.get(c.tileid)}}},n._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,n=this._animations;e.clear();for(var i=0,r=t.length;i<r;++i){var a=t[i];a&&(a.sourceImage?H_t(a,e,a.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+i))}this._fillAniGrids(e,n);for(var o=this._layers,s=this._groups,c=this._images,l={},u=0,h=o.length;u<h;u++)l[o[u].node.name]=!0;for(var f=0,_=s.length;f<_;f++)l[s[f].node.name]=!0;for(var d=0,p=c.length;d<p;d++)l[c[d].name]=!0;o=this._layers=[],s=this._groups=[],c=this._images=[];var m=this._mapInfo,g=this.node,v=m.getAllChildren(),y=this._textures,S=0,T=0;if(v&&v.length>0)for(var x=0,E=v.length;x<E;x++){var A=v[x],C=A.name,b=this.node.getChildByName(C);if(l[C]=!1,b||((b=new ob).name=C,b.layer=g.layer,g.addChild(b)),b.setSiblingIndex(x),b.active=A.visible,A instanceof y_t){var w=b.getComponent(Mdt);w||(w=b.addComponent(Mdt)),w.init(A,m,t,y,e),w.enableCulling=this._enableCulling,A.ownTiles=!1,o.push(w)}else if(A instanceof v_t){var I=b.getComponent(Ldt);I||(I=b.addComponent(Ldt)),I._init(A,m,e),s.push(I)}else if(A instanceof S_t){var P=A.sourceImage;b.layerInfo=A,b._offset=new Qn(A.offset.x,-A.offset.y);var R=b.getComponent(kV);R||(R=b.addComponent(kV)),R.color.a*=A.opacity,R.spriteFrame=P;var D=P.width,O=P.height;P.original&&(D=P.originalSize.width,O=P.originalSize.height),b._uiProps.uiTransformComp.setContentSize(D,O),c.push(b)}S=Math.max(S,b._uiProps.uiTransformComp.width),T=Math.max(T,b._uiProps.uiTransformComp.height)}for(var N=g.children,M=0,L=N.length;M<L;M++){var F=N[M];l[F.name]&&F.destroy()}this.node._uiProps.uiTransformComp.setContentSize(S,T),this._syncAnchorPoint()},n._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var n=this._tilesets;this._textures.length=0;for(var i=[],r=0,a=n.length;r<a;++r){var o=n[r];o&&o.sourceImage&&(this._textures[r]=o.sourceImage,i.push(o.sourceImage))}for(var s=0;s<this._imageLayers.length;s++){var c=this._imageLayers[s];c&&c.sourceImage&&i.push(c.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((function(t){e.doCleanupImageCache(t)}))},n.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":ch.hasFeature(ch.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},n.lateUpdate=function(t){for(var e,n=this._animations,i=this._texGrids,r=ot(n.keys());!(e=r()).done;){var a=e.value,o=n.get(a),s=o.frames,c=s[o.frameIdx];o.dt+=t,c.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=s.length&&(o.frameIdx=0),c=s[o.frameIdx]),i.set(a,c.grid)}for(var l=this.getLayers(),u=0,h=l.length;u<h;u++){var f=l[u];(f.hasAnimation()||f.node.hasChangedFlags)&&f.markForUpdateRenderData()}},Q(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile(),this._isApplied=!0)}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,n=0;n<e.length;++n)e[n].enableCulling=t}}]),e}(Zu),bdt.Orientation=l_t,bdt.Property=u_t,bdt.TileFlag=h_t,bdt.StaggerAxis=f_t,bdt.StaggerIndex=__t,bdt.TMXObjectType=p_t,bdt.RenderOrder=d_t,Edt=ct((xdt=wdt).prototype,"_tmxFile",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct(xdt.prototype,"tmxAsset",[ydt,Sdt],Object.getOwnPropertyDescriptor(xdt.prototype,"tmxAsset"),xdt.prototype),Adt=ct(xdt.prototype,"_enableCulling",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct(xdt.prototype,"enableCulling",[Vc],Object.getOwnPropertyDescriptor(xdt.prototype,"enableCulling"),xdt.prototype),Cdt=ct(xdt.prototype,"cleanupImageCache",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Tdt=xdt))||Tdt)||Tdt)||Tdt)||Tdt)||Tdt)),Math.ceil(10922.5)),zdt=[],Udt=0;Udt<4;Udt++)zdt.push(new Dn);var kdt,Gdt,Vdt=new Xn,Hdt=new Dn,Wdt={row:0,col:0},jdt={x:0,y:0},Xdt={x:0,y:0},qdt={x:0,y:0},Ydt={x:0,y:0},Kdt=0,Qdt=0,Jdt=0,Zdt=0,$dt={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(Jdt=t.leftDownToCenterX,Zdt=t.leftDownToCenterY,kdt=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){var n,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var r=t.cullingRect;n=r.leftDown,i=r.rightTop}else n=Wdt,i=t.rightTop;switch(t.renderOrder){case d_t.RightDown:npt(n,i,-1,1,t);break;case d_t.LeftDown:npt(n,i,-1,-1,t);break;case d_t.RightUp:npt(n,i,1,1,t);break;case d_t.LeftUp:default:npt(n,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}kdt=null},updateColor:function(t){var e=t.color,n=new Float32Array(4);n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.a/255;var i=t.meshRenderDataArray;if(i)for(var r,a=ot(i);!(r=a()).done;){var o=r.value;if(o.renderData)for(var s=o.renderData,c=s.vData,l=s.vertexStart,u=s.vertexCount;l<u;l++)c.set(n,9*l+5)}},fillBuffers:function(t){if(t&&t.meshRenderDataArray)for(var e=t.meshRenderDataArray[t._meshRenderDataArrayIdx].renderData,n=e.iData,i=0,r=0,a=e.vertexCount/4,o=0;o<a;o+=1)n[i]=r,n[i+1]=r+1,n[i+2]=r+2,n[i+3]=r+2,n[i+4]=r+1,n[i+5]=r+3,i+=6,r+=4}};function tpt(t,e){var n;t._rotated?(jdt.x=t.r,jdt.y=t.t,Xdt.x=t.l,Xdt.y=t.t,qdt.x=t.r,qdt.y=t.b,Ydt.x=t.l,Ydt.y=t.b):(jdt.x=t.l,jdt.y=t.t,Xdt.x=t.l,Xdt.y=t.b,qdt.x=t.r,qdt.y=t.t,Ydt.x=t.r,Ydt.y=t.b),(e&h_t.DIAGONAL)>>>0&&(n=Xdt,Xdt=qdt,qdt=n),(e&h_t.HORIZONTAL)>>>0&&(n=jdt,jdt=qdt,qdt=n,n=Xdt,Xdt=Ydt,Ydt=n),(e&h_t.VERTICAL)>>>0&&(n=jdt,jdt=Xdt,Xdt=n,n=qdt,qdt=Ydt,Ydt=n)}function ept(t,e,n){t||(t=e.texture),kdt.texture||(kdt.texture=t),(kdt=n.requestMeshRenderData()).texture=e.texture}function npt(t,e,n,i,r){if(!(!kdt||e.row<0||e.col<0)){kdt.renderData||(kdt=r.requestMeshRenderData());var a=kdt.renderData.vData,o=r.node.worldMatrix;Kdt=0,Qdt=0;var s,c,l,u,h,f,_,d,p,m=r.tiledTiles,g=r.texGrids,v=r.tiles,y=18,S=27,T=r.vertices,x=0,E=0,A=0,C=0,b=0,w=null,I=0,P=!0;Gdt=tpt;var R=new Float32Array(4);for(R[0]=r.color.r/255,R[1]=r.color.g/255,R[2]=r.color.b/255,R[3]=r.color.a/255,-1===n?(u=e.row,h=t.row):(u=t.row,h=e.row);(h-u)*n>=0;u+=n)for(s=T[u],I=r.getNodesCountByRow(u),P=s&&0===I,1===i?(c=P&&t.col<s.minCol?s.minCol:t.col,l=P&&e.col>s.maxCol?s.maxCol:e.col):(c=P&&e.col>s.maxCol?s.maxCol:e.col,l=P&&t.col<s.minCol?s.minCol:t.col);(l-c)*i>=0;c+=i){if(f=s&&s[c],I>0){var D=r.requestSubNodesData(),O=r.getNodesByRowCol(u,c);O&&O.count>0&&(D.subNodes=r.getNodesByRowCol(u,c).list,w=null,kdt=r.requestMeshRenderData())}if(f&&(x=v[f.index],d=g.get((x&h_t.FLIPPED_MASK)>>>0))){w!==d.texture&&(ept(w,d,r),w=d.texture),_=d.tileset._tileSize,E=f.left-Jdt,A=f.bottom-Zdt,C=E+_.width,b=A+_.height,p=m[f.index];var N=kdt.renderData;N.reserve(4,0),Qdt=9*N.vertexCount,a=N.vData,p?p.node.active&&ipt(p.node,R,a,E,C,b,A,!1):(zdt[0].x=E,zdt[0].y=b,zdt[1].x=E,zdt[1].y=A,zdt[2].x=C,zdt[2].y=b,zdt[3].x=C,zdt[3].y=A,zdt[0].transformMat4(o),a[Qdt]=zdt[0].x,a[Qdt+1]=zdt[0].y,a[Qdt+2]=zdt[0].z,zdt[1].transformMat4(o),a[Qdt+9]=zdt[1].x,a[Qdt+9+1]=zdt[1].y,a[Qdt+9+2]=zdt[1].z,zdt[2].transformMat4(o),a[Qdt+y]=zdt[2].x,a[Qdt+y+1]=zdt[2].y,a[Qdt+y+2]=zdt[2].z,zdt[3].transformMat4(o),a[Qdt+S]=zdt[3].x,a[Qdt+S+1]=zdt[3].y,a[Qdt+S+2]=zdt[3].z,a.set(R,Qdt+5),a.set(R,Qdt+9+5),a.set(R,Qdt+y+5),a.set(R,Qdt+S+5)),Gdt(d,x),a[Qdt+3]=jdt.x,a[Qdt+4]=jdt.y,a[Qdt+9+3]=Xdt.x,a[Qdt+9+4]=Xdt.y,a[Qdt+y+3]=qdt.x,a[Qdt+y+4]=qdt.y,a[Qdt+S+3]=Ydt.x,a[Qdt+S+4]=Ydt.y,Kdt++,N.request(4,6),N.resize(N.vertexCount,N.indexCount),Kdt>=Bdt&&(ept(w,d,r),w=d.texture)}}}}function ipt(t,e,n,i,r,a,o,s){var c=18,l=27;t.updateWorldTransform(),Xn.fromRTS(Vdt,t.rotation,t.position,t.scale),Dn.set(Hdt,-(i+Jdt),-(o+Zdt),0),Xn.transform(Vdt,Vdt,Hdt),Xn.multiply(Vdt,t.parent.worldMatrix,Vdt);var u=Vdt,h=u.m12,f=u.m13,_=u.m00,d=u.m01,p=u.m04,m=u.m05,g=1===_&&0===d&&0===p&&1===m;if(s){var v=(i+r)/2,y=(a+o)/2;g?(n[Qdt]=v+h,n[Qdt+1]=a+f,n[Qdt+9]=i+h,n[Qdt+9+1]=y+f,n[Qdt+c]=r+h,n[Qdt+c+1]=y+f,n[Qdt+l]=v+h,n[Qdt+l+1]=o+f):(n[Qdt]=v*_+a*p+h,n[Qdt+1]=v*d+a*m+f,n[Qdt+9]=i*_+y*p+h,n[Qdt+9+1]=i*d+y*m+f,n[Qdt+c]=r*_+y*p+h,n[Qdt+c+1]=r*d+y*m+f,n[Qdt+l]=v*_+o*p+h,n[Qdt+l+1]=v*d+o*m+f)}else g?(n[Qdt]=i+h,n[Qdt+1]=a+f,n[Qdt+9]=i+h,n[Qdt+9+1]=o+f,n[Qdt+c]=r+h,n[Qdt+c+1]=a+f,n[Qdt+l]=r+h,n[Qdt+l+1]=o+f):(n[Qdt]=i*_+a*p+h,n[Qdt+1]=i*d+a*m+f,n[Qdt+9]=i*_+o*p+h,n[Qdt+9+1]=i*d+o*m+f,n[Qdt+c]=r*_+a*p+h,n[Qdt+c+1]=r*d+a*m+f,n[Qdt+l]=r*_+o*p+h,n[Qdt+l+1]=r*d+o*m+f);n.set(e,Qdt+5),n.set(e,Qdt+9+5),n.set(e,Qdt+c+5),n.set(e,Qdt+l+5)}var rpt=t("tiledLayerAssembler",{getAssembler:function(){return $dt}});Mdt.Assembler=rpt;var apt=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){I(1006)},e.update=function(){I(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return I(1008),null},e.retain=function(){},e.release=function(){},t}();apt.TAG_INVALID=-1;var opt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._duration=0,e._timesForRepeat=1,e}Z(e,t);var n=e.prototype;return n.getDuration=function(){return this._duration*(this._timesForRepeat||1)},n.setDuration=function(t){this._duration=t},n.clone=function(){return new e},e}(apt),spt=(function(t){function e(e,n){var i;return void 0===n&&(n=1),(i=t.call(this)||this)._speed=0,i._innerAction=null,e&&i.initWithAction(e,n),i}Z(e,t);var n=e.prototype;n.getSpeed=function(){return this._speed},n.setSpeed=function(t){this._speed=t},n.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(O(1021),!1)},n.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),apt.prototype.stop.call(this)},n.step=function(t){this._innerAction.step(t*this._speed)},n.isDone=function(){return this._innerAction.isDone()},n.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction}}(apt),0),cpt=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},lpt=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var n=0;n<t.length;n++)if(e===t[n].target)return t[n];return null},e._getElement=function(t,e){var n=this._elementPool.pop();return n||(n=new cpt),n.target=t,n.paused=!!e,n},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,n){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+spt++);var i=this._hashTargets.get(e);i?i.actions||(i.actions=[]):(i=this._getElement(e,n),this._hashTargets.set(e,i),this._arrayTargets.push(i)),i.target=e,i.actions.push(t),t.startWithTarget(e)}else O(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var n=t[e];n&&this._putElement(n)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),n=this._hashTargets.get(e);if(n)for(var i=0;i<n.actions.length;i++)if(n.actions[i]===t){n.actions.splice(i,1),n.actionIndex>=i&&n.actionIndex--;break}}},e._removeActionByTag=function(t,e,n){for(var i=0,r=e.actions.length;i<r;++i){var a=e.actions[i];if(a&&a.getTag()===t){if(n&&a.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e);break}}},e._removeAllActionsByTag=function(t,e,n){for(var i=e.actions.length-1;i>=0;--i){var r=e.actions[i];if(r&&r.getTag()===t){if(n&&r.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e)}}},e.removeActionByTag=function(t,e){var n=this;t===apt.TAG_INVALID&&I(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeActionByTag(t,r,e)}else i.forEach((function(e){n._removeActionByTag(t,e)}))},e.removeAllActionsByTag=function(t,e){var n=this;t===apt.TAG_INVALID&&I(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeAllActionsByTag(t,r,e)}else i.forEach((function(e){n._removeAllActionsByTag(t,e)}))},e.getActionByTag=function(t,e){t===apt.TAG_INVALID&&I(1004);var n=this._hashTargets.get(e);if(n){if(null!=n.actions)for(var i=0;i<n.actions.length;++i){var r=n.actions[i];if(r&&r.getTag()===t)return r}I(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,n=0;n<e.length;n++){var i=e[n];i&&!i.paused&&(i.paused=!0,t.push(i.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){l.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var n=this._arrayTargets,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,n=this._arrayTargets,i=0;i<n.length;i++){this._currentTarget=n[i];var r=(e=this._currentTarget).target;if(r instanceof _l&&!r.isValid)this.removeAllActionsFromTarget(r),i--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var a=e.currentAction;e.currentAction=null,this.removeAction(a)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&i--}}},t}(),upt=t("TweenSystem",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).actionMgr=new lpt,e}return Z(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},Q(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(KO));upt.ID="TWEEN",upt.instance=void 0,lN.on(cN.EVENT_INIT,(function(){var t=new upt;upt.instance=t,lN.registerSystem(upt.ID,t,KO.Priority.MEDIUM)}));var hpt=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.clone=function(){return new e},e}(opt),fpt=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(PF),e=0;e<t.length;++e)t[e].enabled=!0},n.reverse=function(){return new _pt},n.clone=function(){return new e},e}(hpt),_pt=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(PF),e=0;e<t.length;++e)t[e].enabled=!1},n.reverse=function(){return new fpt},n.clone=function(){return new e},e}(hpt);!function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;n.update=function(){for(var t=this.target.getComponentsInChildren(PF),e=0;e<t.length;++e){var n=t[e];n.enabled=!n.enabled}},n.reverse=function(){return new e},n.clone=function(){return new e}}(hpt);var dpt=function(t){function e(e){var n;return(n=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&n.init(e),n}Z(e,t);var n=e.prototype;return n.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},n.init=function(t){return this._isNeedCleanUp=t,!0},n.reverse=function(){return new e(this._isNeedCleanUp)},n.clone=function(){return new e(this._isNeedCleanUp)},e}(hpt),ppt=function(t){function e(e,n,i){var r;return(r=t.call(this)||this)._selectorTarget=null,r._function=null,r._data=null,r.initWithFunction(e,n,i),r}Z(e,t);var n=e.prototype;return n.initWithFunction=function(t,e,n){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==n&&(this._data=n),!0},n.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},n.update=function(){this.execute()},n.getTargetCallback=function(){return this._selectorTarget},n.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},n.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(hpt),mpt=function(t){function e(e){var n;return(n=t.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._firstTick=!1,n._easeList=[],n._speed=1,n._repeatForever=!1,n._repeatMethod=!1,n._speedMethod=!1,void 0===e||isNaN(e)||n.initWithDuration(e),n}Z(e,t);var n=e.prototype;return n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(t){return this._duration=0===t?he.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration},n._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},n._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},n.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},n.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},n._computeEaseTime=function(t){return t},n.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},n.reverse=function(){return I(1010),this},n.setAmplitudeRate=function(){I(1011)},n.getAmplitudeRate=function(){return I(1012),0},n.speed=function(t){return t<=0?(I(1013),this):(this._speedMethod=!0,this._speed*=t,this)},n.getSpeed=function(){return this._speed},n.setSpeed=function(t){return this._speed=t,this},n.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(I(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},n.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(opt),gpt=function(t){function e(n){var i;(i=t.call(this)||this)._actions=[],i._split=0,i._last=0,i._reversed=!1;var r=n instanceof Array?n:arguments;if(1===r.length)return O(1019),rt(i);var a=r.length-1;if(a>=0&&null==r[a]&&I(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}Z(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return O(1025),!1;var n=t._duration,i=e._duration,r=(n*=t._repeatMethod?t._timesForRepeat:1)+(i*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},n.startWithTarget=function(t){mpt.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},n.stop=function(){-1!==this._last&&this._actions[this._last].stop(),apt.prototype.stop.call(this)},n.update=function(t){var e,n,i=0,r=this._split,a=this._actions,o=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===i&&1===o&&this._reversed&&(a[1].update(0),a[1].stop())):(i=1,e=1===r?1:(t-r)/(1-r),-1===o&&(a[0].startWithTarget(this.target),a[0].update(1),a[0].stop()),0===o&&(a[0].update(1),a[0].stop())),n=a[i],o===i&&n.isDone()||(o!==i&&n.startWithTarget(this.target),e*=n._timesForRepeat,n.update(e>1?e%1:e),this._last=i)},n.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(mpt);function vpt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return O(1019),null;var n=e.length-1;n>=0&&null==e[n]&&I(1015);var i=null;if(n>=0){i=e[0];for(var r=1;r<=n;r++)e[r]&&(i=gpt._actionOneTwo(i,e[r]))}return i}gpt._actionOneTwo=function(t,e){var n=new gpt;return n.initWithTwoActions(t,e),n};var ypt=function(t){function e(e,n){var i;return(i=t.call(this)||this)._times=0,i._total=0,i._nextDt=0,i._actionInstant=!1,i._innerAction=null,void 0!==n&&i.initWithAction(e,n),i}Z(e,t);var n=e.prototype;return n.initWithAction=function(t,e){var n=t._duration*e;return!!this.initWithDuration(n)&&(this._times=e,this._innerAction=t,t instanceof hpt&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},n.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,mpt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),apt.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,n=this._duration,i=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<i;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/n,this._nextDt=r>1?1:r;t>=1&&this._total<i&&(e.update(1),this._total++),this._actionInstant||(this._total===i?e.stop():e.update(t-(r-e._duration/n)))}else e.update(t*i%1)},n.isDone=function(){return this._total===this._times},n.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(mpt),Spt=function(t){function e(e){var n;return(n=t.call(this)||this)._innerAction=null,e&&n.initWithAction(e),n}Z(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?(this._innerAction=t,!0):(O(1026),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},n.startWithTarget=function(t){mpt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},n.isDone=function(){return!1},n.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(mpt),Tpt=function(t){function e(n){var i;(i=t.call(this)||this)._one=null,i._two=null;var r=n instanceof Array?n:arguments;if(1===r.length)return O(1020),rt(i);var a=r.length-1;if(a>=0&&null==r[a]&&I(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}Z(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return O(1027),!1;var n=!1,i=t._duration,r=e._duration;return this.initWithDuration(Math.max(i,r))&&(this._one=t,this._two=e,i>r?this._two=gpt._actionOneTwo(e,Apt(i-r)):i<r&&(this._one=gpt._actionOneTwo(t,Apt(r-i))),n=!0),n},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},n.startWithTarget=function(t){mpt.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},n.stop=function(){this._one.stop(),this._two.stop(),apt.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},n.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(mpt);function xpt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return O(1020),null;e.length>0&&null==e[e.length-1]&&I(1015);for(var n=e[0],i=1;i<e.length;i++)null!=e[i]&&(n=Tpt._actionOneTwo(n,e[i]));return n}Tpt._actionOneTwo=function(t,e){var n=new Tpt;return n.initWithTwoActions(t,e),n};var Ept=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.update=function(){},n.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(mpt);function Apt(t){return new Ept(t)}var Cpt,bpt,wpt,Ipt,Ppt,Rpt,Dpt,Opt,Npt,Mpt,Lpt,Fpt,Bpt,zpt,Upt,kpt,Gpt,Vpt,Hpt,Wpt,jpt,Xpt,qpt,Ypt,Kpt,Qpt,Jpt,Zpt,$pt,tmt,emt,nmt,imt,rmt,amt,omt,smt,cmt,lmt,umt,hmt,fmt,_mt,dmt,pmt,mmt,gmt,vmt,ymt,Smt,Tmt,xmt,Emt,Amt,Cmt,bmt,wmt,Imt,Pmt,Rmt,Dmt=function(t){function e(e){var n;return(n=t.call(this)||this)._other=null,e&&n.initWithAction(e),n}Z(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?t===this._other?(O(1029),!1):!!mpt.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(O(1028),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},n.startWithTarget=function(t){mpt.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},n.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},n.reverse=function(){return this._other.clone()},n.stop=function(){this._other.stop(),apt.prototype.stop.call(this)},e}(mpt),Omt=t("TweenAction",function(t){function e(e,n,i){var r;if((r=t.call(this)||this)._opts=void 0,r._props=void 0,r._originProps=void 0,null==i)i=Object.create(null);else if(function(t){var e=" [Tween:] ",n=" option is not support in v + "+u,i=t;i.delay&&S(e+"delay"+n),i.repeat&&S(e+"repeat"+n),i.repeatDelay&&S(e+"repeatDelay"+n),i.interpolation&&S(e+"interpolation"+n),i.onStop&&S(e+"onStop"+n)}(i),i.easing&&"string"==typeof i.easing&&(i.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var n=(t=t.replace(e,e.toLowerCase())).split("-");if(2===n.length){var i=n[0];if("linear"===i)t="linear";else{var r=n[1];switch(i){case"quadratic":t="quad"+r;break;case"quartic":t="quart"+r;break;case"quintic":t="quint"+r;break;case"sinusoidal":t="sine"+r;break;case"exponential":t="expo"+r;break;case"circular":t="circ"+r;break;default:t=i+r}}}}return t}(i.easing)),i.progress||(i.progress=r.progress),i.easing&&"string"==typeof i.easing){var a=i.easing;i.easing=t_[a],i.easing||R(1031,a)}for(var o in r._opts=i,r._props=Object.create(null),n)if(n.hasOwnProperty(o)){var s=n[o];if("function"==typeof s&&(s=s()),null!=s&&"string"!=typeof s){var c=void 0,l=void 0;void 0!==s.value&&(s.easing||s.progress)&&("string"==typeof s.easing?(c=t_[s.easing])||R(1031,s.easing):c=s.easing,l=s.progress,s=s.value);var h=Object.create(null);h.value=s,h.easing=c,h.progress=l,r._props[o]=h}}return r._originProps=n,r.initWithDuration(e),r}Z(e,t);var n=e.prototype;return n.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},n.startWithTarget=function(t){mpt.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,n=this._props;for(var i in n){var r=t[i];if(void 0!==r){var a=n[i],o=a.value;if("number"==typeof r)a.start=r,a.current=r,a.end=e?r+o:o;else if("object"==typeof r)for(var s in null==a.start&&(a.start={},a.current={},a.end={}),o)isNaN(r[s])||(a.start[s]=r[s],a.current[s]=r[s],a.end[s]=e?r[s]+o[s]:o[s])}}this._opts.onStart&&this._opts.onStart(this.target)},n.update=function(t){var e=this.target;if(e){var n=this._props,i=this._opts,r=t;i.easing&&(r=i.easing(t));var a=i.progress;for(var o in n){var s=n[o],c=s.easing?s.easing(t):r,l=s.progress?s.progress:a,u=s.start,h=s.end;if("number"==typeof u)s.current=l(u,h,s.current,c);else if("object"==typeof u)for(var f in u)s.current[f]=l(u[f],h[f],s.current[f],c);e[o]=s.current}i.onUpdate&&i.onUpdate(this.target,t),1===t&&i.onComplete&&i.onComplete(this.target)}},n.progress=function(t,e,n,i){return t+(e-t)*i},e}(mpt)),Nmt=function(t){function e(e){var n;return(n=t.call(this)||this)._props=void 0,n._props={},void 0!==e&&n.init(e),n}Z(e,t);var n=e.prototype;return n.init=function(t){for(var e in t)this._props[e]=t[e];return!0},n.update=function(){var t=this._props,e=this.target;for(var n in t)e[n]=t[n]},n.clone=function(){var t=new e;return t.init(this._props),t},e}(hpt),Mmt=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=apt.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof apt?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&upt.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),upt.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(S("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&upt.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return Lmt(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,n){(n=n||Object.create(null)).relative=!1;var i=new Omt(t,e,n);return this._actions.push(i),this},e.by=function(t,e,n){(n=n||Object.create(null)).relative=!0;var i=new Omt(t,e,n);return this._actions.push(i),this},e.set=function(t){var e=new Nmt(t);return this._actions.push(e),this},e.delay=function(t){var e=Apt(t);return this._actions.push(e),this},e.call=function(t){var e=new ppt(t,undefined,undefined);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,n){if(e===1/0)return this.repeatForever(n);var i,r=this._actions;return i=n instanceof t?n._union():r.pop(),r.push(function(t,e){return new ypt(t,e)}(i,e)),this},e.repeatForever=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new Spt(t)}(n)),this},e.reverseTime=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new Dmt(t)}(n)),this},e.hide=function(){var t=new _pt;return this._actions.push(t),this},e.show=function(){var t=new fpt;return this._actions.push(t),this},e.removeSelf=function(){var t=new dpt(!1);return this._actions.push(t),this},t.stopAll=function(){upt.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){upt.instance.ActionManager.removeAllActionsByTag(t,e)},t.stopAllByTarget=function(t){upt.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:vpt(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return vpt.apply(vpt,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return xpt.apply(xpt,e)},t}());function Lmt(t){return new Mmt(t)}function Fmt(t){return S("tweenUtil' is deprecated, please use 'tween' instead "),new Mmt(t)}Mmt._tmp_args=[],l.Tween=Mmt,l.tween=Lmt,l.tweenUtil=Fmt;var Bmt,zmt,Umt,kmt=new Pn;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(Bmt||(Bmt={})),le(Bmt),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(zmt||(zmt={})),function(t){t.CLICK="click"}(Umt||(Umt={}));var Gmt=function(e){return t({Button:e,ButtonComponent:e}),e}((Cpt=Ec("cc.Button"),bpt=Gc(),wpt=Cc(110),Ipt=Bc(),Ppt=Ac(xz),Rpt=al(ob),Dpt=Zc(),Opt=Xc(),Npt=Zc(),Mpt=Xc(),Lpt=al(Bmt),Fpt=Zc(),Bpt=Xc(),zpt=Zc(),Upt=Xc(),kpt=Zc(),Gpt=Xc(),Vpt=Zc(),Hpt=Xc(),Wpt=Zc(),jpt=Xc(),Xpt=Yc(),qpt=Kc(),Ypt=Zc(),Kpt=Xc(),Qpt=Zc(),Jpt=Xc(),Zpt=al(XF),$pt=Zc(),tmt=Xc(),emt=al(XF),nmt=Zc(),imt=Xc(),rmt=al(XF),amt=Zc(),omt=Xc(),smt=al(XF),cmt=Zc(),lmt=Xc(),umt=al([cF]),hmt=Zc(),fmt=Xc(),Cpt(_mt=bpt(_mt=wpt(_mt=Ipt(_mt=Ppt(_mt=Fc((Rmt=Pmt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"clickEvents",pmt,rt(e)),st(e,"_interactable",mmt,rt(e)),st(e,"_transition",gmt,rt(e)),st(e,"_normalColor",vmt,rt(e)),st(e,"_hoverColor",ymt,rt(e)),st(e,"_pressedColor",Smt,rt(e)),st(e,"_disabledColor",Tmt,rt(e)),st(e,"_normalSprite",xmt,rt(e)),st(e,"_hoverSprite",Emt,rt(e)),st(e,"_pressedSprite",Amt,rt(e)),st(e,"_disabledSprite",Cmt,rt(e)),st(e,"_duration",bmt,rt(e)),st(e,"_zoomScale",wmt,rt(e)),st(e,"_target",Imt,rt(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new Pn,e._toColor=new Pn,e._time=0,e._transitionFinished=!0,e._fromScale=new Dn,e._toScale=new Dn,e._originalScale=null,e._sprite=null,e._targetScale=new Dn,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(kV);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},n.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===Bmt.COLOR||this._transition===Bmt.SCALE)){this._time+=t;var n=1;if(this._duration>0&&(n=this._time/this._duration),n>=1&&(n=1),this._transition===Bmt.COLOR){var i=e._uiProps.uiComp;Pn.lerp(kmt,this._fromColor,this._toColor,n),i&&(i.color=kmt)}else this.transition===Bmt.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=fn(this._fromScale.x,this._toScale.x,n),this._targetScale.y=fn(this._fromScale.y,this._toScale.y,n),e.setScale(this._targetScale));1===n&&(this._transitionFinished=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},n._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=this._transition;if(e===Bmt.COLOR&&this._interactable){var n=t.getComponent(ok);n&&(n.color=this._normalColor)}else e===Bmt.SCALE&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}},n._registerNodeEvent=function(){this.node.on(rA.TOUCH_START,this._onTouchBegan,this),this.node.on(rA.TOUCH_MOVE,this._onTouchMove,this),this.node.on(rA.TOUCH_END,this._onTouchEnded,this),this.node.on(rA.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(rA.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(rA.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._registerTargetEvent=function(t){t.on(rA.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},n._unregisterNodeEvent=function(){this.node.off(rA.TOUCH_START,this._onTouchBegan,this),this.node.off(rA.TOUCH_MOVE,this._onTouchMove,this),this.node.off(rA.TOUCH_END,this._onTouchEnded,this),this.node.off(rA.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(rA.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(rA.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._unregisterTargetEvent=function(t){t.off(rA.TRANSFORM_CHANGED)},n._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(kV)),e},n._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Dn),Dn.copy(this._originalScale,this.target.getScale()),this._registerTargetEvent(this.target))},n._onTargetSpriteFrameChanged=function(t){this._transition===Bmt.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},n._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case zmt.NORMAL:this._normalSprite=t;break;case zmt.HOVER:this._hoverSprite=t;break;case zmt.PRESSED:this._pressedSprite=t;break;case zmt.DISABLED:this._disabledSprite=t}},n._onTargetColorChanged=function(t){this._transition===Bmt.COLOR&&this._setCurrentStateColor(t)},n._setCurrentStateColor=function(t){switch(this._getButtonState()){case zmt.NORMAL:this._normalColor=t;break;case zmt.HOVER:this._hoverColor=t;break;case zmt.PRESSED:this._pressedColor=t;break;case zmt.DISABLED:this._disabledColor=t}},n._onTargetTransformChanged=function(t){t&yy.SCALE&&this._originalScale&&this._transition===Bmt.SCALE&&this._transitionFinished&&Dn.copy(this._originalScale,this.target.getScale())},n._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var n,i=this.node._uiProps.uiTransformComp.hitTest(e.getLocation());this._transition===Bmt.SCALE&&this.target&&this._originalScale?i?(Dn.copy(this._fromScale,this._originalScale),Dn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(n=i?zmt.PRESSED:zmt.NORMAL,this._applyTransition(n)),t&&(t.propagationStopped=!0)}}},n._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(cF.emitEvents(this.clickEvents,t),this.node.emit(Umt.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},n._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==Bmt.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},n._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},n._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},n._getButtonState=function(){var t=zmt.NORMAL;return this._interactable?this._pressed?t=zmt.PRESSED:this._hovered&&(t=zmt.HOVER):t=zmt.DISABLED,t.toString()},n._updateColorTransition=function(t){var e,n=this[t+"Color"],i=null===(e=this.target)||void 0===e?void 0:e.getComponent(ok);i&&(t===zmt.DISABLED?i.color=n:(this._fromColor=i.color.clone(),this._toColor=n,this._time=0,this._transitionFinished=!1))},n._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},n._updateScaleTransition=function(t){this._interactable&&(t===zmt.PRESSED?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this._originalScale&&(Dn.copy(this._fromScale,this._originalScale),Dn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},n._zoomBack=function(){this.target&&this._originalScale&&(Dn.copy(this._fromScale,this.target.getScale()),Dn.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},n._applyTransition=function(t){var e=this._transition;e===Bmt.COLOR?this._updateColorTransition(t):e===Bmt.SPRITE?this._updateSpriteTransition(t):e===Bmt.SCALE&&this._updateScaleTransition(t)},Q(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===Bmt.COLOR?this._updateColorTransition(zmt.NORMAL):this._transition===Bmt.SPRITE&&this._updateSpriteTransition(zmt.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(kV);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(Zu),Pmt.Transition=Bmt,Pmt.EventType=Umt,ct((dmt=Rmt).prototype,"target",[Rpt,Dpt,Opt],Object.getOwnPropertyDescriptor(dmt.prototype,"target"),dmt.prototype),ct(dmt.prototype,"interactable",[Npt,Mpt],Object.getOwnPropertyDescriptor(dmt.prototype,"interactable"),dmt.prototype),ct(dmt.prototype,"transition",[Lpt,Fpt,Bpt],Object.getOwnPropertyDescriptor(dmt.prototype,"transition"),dmt.prototype),ct(dmt.prototype,"normalColor",[zpt,Upt],Object.getOwnPropertyDescriptor(dmt.prototype,"normalColor"),dmt.prototype),ct(dmt.prototype,"pressedColor",[kpt,Gpt],Object.getOwnPropertyDescriptor(dmt.prototype,"pressedColor"),dmt.prototype),ct(dmt.prototype,"hoverColor",[Vpt,Hpt],Object.getOwnPropertyDescriptor(dmt.prototype,"hoverColor"),dmt.prototype),ct(dmt.prototype,"disabledColor",[Wpt,jpt],Object.getOwnPropertyDescriptor(dmt.prototype,"disabledColor"),dmt.prototype),ct(dmt.prototype,"duration",[Xpt,qpt,Ypt,Kpt],Object.getOwnPropertyDescriptor(dmt.prototype,"duration"),dmt.prototype),ct(dmt.prototype,"zoomScale",[Qpt,Jpt],Object.getOwnPropertyDescriptor(dmt.prototype,"zoomScale"),dmt.prototype),ct(dmt.prototype,"normalSprite",[Zpt,$pt,tmt],Object.getOwnPropertyDescriptor(dmt.prototype,"normalSprite"),dmt.prototype),ct(dmt.prototype,"pressedSprite",[emt,nmt,imt],Object.getOwnPropertyDescriptor(dmt.prototype,"pressedSprite"),dmt.prototype),ct(dmt.prototype,"hoverSprite",[rmt,amt,omt],Object.getOwnPropertyDescriptor(dmt.prototype,"hoverSprite"),dmt.prototype),ct(dmt.prototype,"disabledSprite",[smt,cmt,lmt],Object.getOwnPropertyDescriptor(dmt.prototype,"disabledSprite"),dmt.prototype),pmt=ct(dmt.prototype,"clickEvents",[umt,Dc,hmt,fmt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mmt=ct(dmt.prototype,"_interactable",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gmt=ct(dmt.prototype,"_transition",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bmt.NONE}}),vmt=ct(dmt.prototype,"_normalColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pn.WHITE.clone()}}),ymt=ct(dmt.prototype,"_hoverColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(211,211,211,255)}}),Smt=ct(dmt.prototype,"_pressedColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pn.WHITE.clone()}}),Tmt=ct(dmt.prototype,"_disabledColor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pn(124,124,124,255)}}),xmt=ct(dmt.prototype,"_normalSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Emt=ct(dmt.prototype,"_hoverSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Amt=ct(dmt.prototype,"_pressedSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cmt=ct(dmt.prototype,"_disabledSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bmt=ct(dmt.prototype,"_duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),wmt=ct(dmt.prototype,"_zoomScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),Imt=ct(dmt.prototype,"_target",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_mt=dmt))||_mt)||_mt)||_mt)||_mt)||_mt)||_mt));l.Button=Gmt;var Vmt,Hmt,Wmt,jmt=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,n=e.indexOf(t);if(t.setFocus(!1),-1!==n){var i=e[n+1];i&&i._delegate.tabIndex>=0&&i.setFocus(!0)}},t}();jmt._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(Vmt||(Vmt={})),oe(Vmt),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(Hmt||(Hmt={})),oe(Hmt),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(Wmt||(Wmt={})),oe(Wmt);var Xmt,qmt,Ymt,Kmt,Qmt,Jmt,Zmt,$mt,tgt,egt,ngt,igt,rgt,agt,ogt,sgt,cgt,lgt,ugt,hgt,fgt,_gt,dgt,pgt,mgt,ggt,vgt,ygt,Sgt,Tgt,xgt,Egt,Agt,Cgt,bgt,wgt,Igt,Pgt,Rgt,Dgt,Ogt,Ngt,Mgt,Lgt,Fgt,Bgt,zgt,Ugt,kgt,Ggt,Vgt,Hgt,Wgt,jgt,Xgt,qgt,Ygt,Kgt,Qgt,Jgt,Zgt,$gt=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),tvt=new Xn,evt=new Xn,nvt=new Dn,ivt=null,rvt=0,avt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++rvt,e}Z(e,t);var n=e.prototype;return n.init=function(t){t&&(this._delegate=t,t.inputMode===Hmt.ANY?this._createTextArea():this._createInput(),jmt.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer())},n.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),jmt.remove(this),ivt===this&&(ivt=null),this._delegate=null},n.update=function(){this._updateMatrix()},n.setTabIndex=function(t){this._edTxt.tabIndex=t,jmt.resort()},n.setSize=function(t,e){var n=this._edTxt;n&&(n.style.width=t+"px",n.style.height=e+"px")},n.beginEditing=function(){ivt&&ivt!==this&&ivt.setFocus(!1),this._editing=!0,ivt=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},n._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},n._addDomToGameContainer=function(){l.GAME_VIEW&&this._edTxt?(l.gameView.container.appendChild(this._edTxt),l.gameView.head.appendChild(this._placeholderStyleSheet)):sN.container&&this._edTxt&&(sN.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},n._removeDomFromGameContainer=function(){(l.GAME_VIEW?ye(l.gameView.container,this._edTxt):ye(sN.container,this._edTxt))&&this._edTxt&&(l.GAME_VIEW?l.gameView.container.removeChild(this._edTxt):sN.container.removeChild(this._edTxt)),(l.GAME_VIEW?ye(l.gameView.head,this._placeholderStyleSheet):ye(document.head,this._placeholderStyleSheet))&&(l.GAME_VIEW?l.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},n._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),ch.isMobile&&this._showDomOnMobile()},n._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),ch.isMobile&&this._hideDomOnMobile()},n._showDomOnMobile=function(){ch.os!==au.ANDROID&&ch.os!==au.OHOS||(ah.handleResizeEvent=!1,this._adjustWindowScroll())},n._hideDomOnMobile=function(){ch.os!==au.ANDROID&&ch.os!==au.OHOS||(ah.handleResizeEvent=!0),this._scrollBackWindow()},n._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n._scrollBackWindow=function(){setTimeout((function(){ch.browserType!==nu.WECHAT||ch.os!==au.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},n._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=yN.getScaleX(),n=yN.getScaleY(),i=1,r=1;l.GAME_VIEW&&(i=l.gameView.canvas.width/l.game.canvas.width,r=l.gameView.canvas.height/l.game.canvas.height),e*=i,n*=r;var a=yN.getViewportRect(),o=ah.devicePixelRatio;t.getWorldMatrix(tvt);var s=t._uiProps.uiTransformComp;if(s&&Dn.set(nvt,-s.anchorX*s.width,-s.anchorY*s.height,nvt.z),Xn.transform(tvt,tvt,nvt),t._uiProps.uiTransformComp){var c=lN.root.batcher2D.getFirstRenderCamera(t);if(c){c.node.getWorldRT(evt);var u=evt.m12,h=evt.m13,f=fN.center;evt.m12=f.x-(evt.m00*u+evt.m04*h),evt.m13=f.y-(evt.m01*u+evt.m05*h),Xn.multiply(evt,evt,tvt),e/=o,n/=o;var _=l.GAME_VIEW?l.gameView.container:sN.container,d=evt.m00*e,p=tvt.m01,m=tvt.m04,g=evt.m05*n,v=parseInt(_&&_.style.paddingLeft||"0");v+=a.x*i/o;var y=parseInt(_&&_.style.paddingBottom||"0");y+=a.y/o;var S="matrix("+d+","+-p+","+-m+","+g+","+(evt.m12*e+v)+","+-(evt.m13*n+y)+")";this._edTxt.style.transform=S,this._edTxt.style["-webkit-transform"]=S,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n._updateInputType=function(){var t=this._delegate,e=t.inputMode,n=t.inputFlag,i=t.returnType,r=this._edTxt;if(this._inputMode!==e||this._inputFlag!==n||this._returnType!==i){if(this._inputMode=e,this._inputFlag=n,this._returnType=i,this._isTextArea){var a="none";return n===Wmt.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":n===Wmt.INITIAL_CAPS_WORD&&(a="capitalize"),void(r.style.textTransform=a)}if(r=r,n===Wmt.PASSWORD)return r.type="password",void(r.style.textTransform="none");var o=r.type;e===Hmt.EMAIL_ADDR?o="email":e===Hmt.NUMERIC||e===Hmt.DECIMAL?o="number":e===Hmt.PHONE_NUMBER?(o="number",r.pattern="[0-9]*",r.addEventListener("wheel",(function(){return!1}))):e===Hmt.URL?o="url":(o="text",i===Vmt.SEARCH&&(o="search")),r.type=o;var s="none";n===Wmt.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":n===Wmt.INITIAL_CAPS_WORD&&(s="capitalize"),r.style.textTransform=s}},n._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},n._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},n._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _B?t.fontFamily:e._fontFamily;var n=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==n||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=n,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var i=this._edTxt;switch(i.style.fontSize=n+"px",i.style.color=t.color.toCSS(),i.style.fontFamily=e,t.horizontalAlign){case uk.HorizontalAlign.LEFT:i.style.textAlign="left";break;case uk.HorizontalAlign.CENTER:i.style.textAlign="center";break;case uk.HorizontalAlign.RIGHT:i.style.textAlign="right"}}}},n._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _B?t.fontFamily:t.font._fontFamily;var n=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==n||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=n,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var i=this._placeholderStyleSheet,r=t.color.toCSS(),a=t.fontSize,o="";switch(t.horizontalAlign){case uk.HorizontalAlign.LEFT:o="left";break;case uk.HorizontalAlign.CENTER:o="center";break;case uk.HorizontalAlign.RIGHT:o="right"}i.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}",ch.browserType===nu.EDGE&&(i.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},n._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,n=!1,i=this.__eventListeners;i.compositionStart=function(){n=!0},i.compositionEnd=function(){n=!1,t._delegate._editBoxTextChanged(e.value)},i.onInput=function(){if(!n){var i=t._delegate,r=i.maxLength;r>=0&&(e.value=e.value.slice(0,r)),i._editBoxTextChanged(e.value)}},i.onClick=function(){t._editing&&ch.isMobile&&t._adjustWindowScroll()},i.onKeydown=function(n){n.keyCode===dR.ENTER?(n.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):n.keyCode===dR.TAB&&(n.propagationStopped=!0,n.preventDefault(),jmt.next(t))},i.onBlur=function(){ch.isMobile&&n&&i.compositionEnd(),t._editing=!1,ivt=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",i.compositionStart),e.addEventListener("compositionend",i.compositionEnd),e.addEventListener("input",i.onInput),e.addEventListener("keydown",i.onKeydown),e.addEventListener("blur",i.onBlur),e.addEventListener("touchstart",i.onClick)}},n._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}($gt);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(Zgt||(Zgt={}));var ovt,svt,cvt,lvt,uvt,hvt,fvt,_vt,dvt,pvt,mvt,gvt,vvt,yvt,Svt,Tvt,xvt,Evt,Avt,Cvt,bvt,wvt,Ivt,Pvt,Rvt,Dvt,Ovt,Nvt,Mvt,Lvt,Fvt,Bvt,zvt,Uvt,kvt,Gvt,Vvt,Hvt,Wvt,jvt,Xvt,qvt,Yvt,Kvt,Qvt,Jvt,Zvt,$vt,tyt,eyt,nyt,iyt,ryt,ayt,oyt,syt,cyt,lyt,uyt,hyt,fyt,_yt=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((Xmt=Ec("cc.EditBox"),qmt=Gc(),Ymt=Cc(110),Kmt=Bc(),Qmt=Ac(xz),Jmt=Zc(),Zmt=Xc(),$mt=Zc(),tgt=Xc(),egt=al(uk),ngt=Zc(),igt=Xc(),rgt=al(uk),agt=Zc(),ogt=Xc(),sgt=al(XF),cgt=Zc(),lgt=Xc(),ugt=al(Wmt),hgt=Zc(),fgt=Xc(),_gt=al(Hmt),dgt=Zc(),pgt=Xc(),mgt=al(Vmt),ggt=Zc(),vgt=Xc(),ygt=Zc(),Sgt=Xc(),Tgt=Zc(),xgt=Xc(),Egt=al([cF]),Agt=Zc(),Cgt=Xc(),bgt=al([cF]),wgt=Zc(),Igt=Xc(),Pgt=al([cF]),Rgt=Zc(),Dgt=Xc(),Ogt=al([cF]),Ngt=Zc(),Mgt=Xc(),Xmt(Lgt=qmt(Lgt=Ymt(Lgt=Kmt(Lgt=Qmt(Lgt=Fc((Jgt=Qgt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"editingDidBegan",Bgt,rt(e)),st(e,"textChanged",zgt,rt(e)),st(e,"editingDidEnded",Ugt,rt(e)),st(e,"editingReturn",kgt,rt(e)),e._impl=null,e._background=null,st(e,"_textLabel",Ggt,rt(e)),st(e,"_placeholderLabel",Vgt,rt(e)),st(e,"_returnType",Hgt,rt(e)),st(e,"_string",Wgt,rt(e)),st(e,"_tabIndex",jgt,rt(e)),st(e,"_backgroundImage",Xgt,rt(e)),st(e,"_inputFlag",qgt,rt(e)),st(e,"_inputMode",Ygt,rt(e)),st(e,"_maxLength",Kgt,rt(e)),e._isLabelVisible=!1,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n.update=function(){this._impl&&this._impl.update()},n.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){cF.emitEvents(this.editingDidBegan,this),this.node.emit(Zgt.EDITING_DID_BEGAN,this)},n._editBoxEditingDidEnded=function(){cF.emitEvents(this.editingDidEnded,this),this.node.emit(Zgt.EDITING_DID_ENDED,this)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,cF.emitEvents(this.textChanged,t,this),this.node.emit(Zgt.TEXT_CHANGED,this)},n._editBoxEditingReturn=function(){cF.emitEvents(this.editingReturn,this),this.node.emit(Zgt.EDITING_RETURN,this)},n._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},n._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(rA.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(kV);t||(t=this.node.addComponent(kV)),t!==this._background&&(t.type=kV.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||((e=new ob("TEXT_LABEL")).layer=this.node.layer),(t=e.getComponent(uk))||(t=e.addComponent(uk)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=uk.Overflow.CLAMP,this._inputMode===Hmt.ANY?(t.verticalAlign=ik.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||((e=new ob("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=e.getComponent(uk))||(t=e.addComponent(uk)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),this._inputMode===Hmt.ANY?(t.verticalAlign=ik.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var n=this._background.node._uiProps.uiTransformComp;n.anchorPoint=t.anchorPoint,n.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},n._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var e=this._textLabel;if(e){var n=t;n&&(n=this._updateLabelStringStyle(n)),e.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var n,i=this._inputFlag;if(e||i!==Wmt.PASSWORD)i===Wmt.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===Wmt.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===Wmt.INITIAL_CAPS_SENTENCE&&(t=(n=t).charAt(0).toUpperCase()+n.slice(1));else{for(var r="",a=t.length,o=0;o<a;++o)r+="";t=r}return t},n._registerEvent=function(){this.node.on(rA.TOUCH_START,this._onTouchBegan,this),this.node.on(rA.TOUCH_END,this._onTouchEnded,this)},n._unregisterEvent=function(){this.node.off(rA.TOUCH_START,this._onTouchBegan,this),this.node.off(rA.TOUCH_END,this._onTouchEnded,this)},n._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n._registerBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.on(kV.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._unregisterBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.off(kV.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=-e.anchorX*e.width,i=-e.anchorY*e.height,r=this._placeholderLabel,a=this._textLabel;a&&(a.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),a.node.setPosition(n+2,i+t.height,a.node.position.z),this._inputMode===Hmt.ANY&&(a.verticalAlign=ik.TOP),a.enableWrapText=this._inputMode===Hmt.ANY),r&&(r.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),r.lineHeight=t.height,r.node.setPosition(n+2,i+t.height,r.node.position.z),this._inputMode===Hmt.ANY&&(r.verticalAlign=ik.TOP),r.enableWrapText=this._inputMode===Hmt.ANY)},n._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-t.width/2,t.height/2,n.position.z),n._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._background&&this._background.node;i&&i._uiProps.uiTransformComp.setContentSize(t.contentSize),this._syncSize()},Q(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(Zu),Qgt._EditBoxImpl=$gt,Qgt.KeyboardReturnType=Vmt,Qgt.InputFlag=Wmt,Qgt.InputMode=Hmt,Qgt.EventType=Zgt,ct((Fgt=Jgt).prototype,"string",[Jmt,Zmt],Object.getOwnPropertyDescriptor(Fgt.prototype,"string"),Fgt.prototype),ct(Fgt.prototype,"placeholder",[$mt,tgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"placeholder"),Fgt.prototype),ct(Fgt.prototype,"textLabel",[egt,ngt,igt],Object.getOwnPropertyDescriptor(Fgt.prototype,"textLabel"),Fgt.prototype),ct(Fgt.prototype,"placeholderLabel",[rgt,agt,ogt],Object.getOwnPropertyDescriptor(Fgt.prototype,"placeholderLabel"),Fgt.prototype),ct(Fgt.prototype,"backgroundImage",[sgt,cgt,lgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"backgroundImage"),Fgt.prototype),ct(Fgt.prototype,"inputFlag",[ugt,hgt,fgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"inputFlag"),Fgt.prototype),ct(Fgt.prototype,"inputMode",[_gt,dgt,pgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"inputMode"),Fgt.prototype),ct(Fgt.prototype,"returnType",[mgt,ggt,vgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"returnType"),Fgt.prototype),ct(Fgt.prototype,"maxLength",[ygt,Sgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"maxLength"),Fgt.prototype),ct(Fgt.prototype,"tabIndex",[Tgt,xgt],Object.getOwnPropertyDescriptor(Fgt.prototype,"tabIndex"),Fgt.prototype),Bgt=ct(Fgt.prototype,"editingDidBegan",[Egt,Dc,Agt,Cgt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zgt=ct(Fgt.prototype,"textChanged",[bgt,Dc,wgt,Igt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ugt=ct(Fgt.prototype,"editingDidEnded",[Pgt,Dc,Rgt,Dgt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kgt=ct(Fgt.prototype,"editingReturn",[Ogt,Dc,Ngt,Mgt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ggt=ct(Fgt.prototype,"_textLabel",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vgt=ct(Fgt.prototype,"_placeholderLabel",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hgt=ct(Fgt.prototype,"_returnType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vmt.DEFAULT}}),Wgt=ct(Fgt.prototype,"_string",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jgt=ct(Fgt.prototype,"_tabIndex",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xgt=ct(Fgt.prototype,"_backgroundImage",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qgt=ct(Fgt.prototype,"_inputFlag",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wmt.DEFAULT}}),Ygt=ct(Fgt.prototype,"_inputMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hmt.ANY}}),Kgt=ct(Fgt.prototype,"_maxLength",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Lgt=Fgt))||Lgt)||Lgt)||Lgt)||Lgt)||Lgt)||Lgt));"object"==typeof window&&"object"==typeof document&&(_yt._EditBoxImpl=avt),l.internal.EditBox=_yt,function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(syt||(syt={})),le(syt),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(cyt||(cyt={})),le(cyt),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(lyt||(lyt={})),le(lyt),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(uyt||(uyt={})),le(uyt),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(hyt||(hyt={})),le(hyt),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(fyt||(fyt={})),le(fyt);var dyt,pyt,myt,gyt,vyt,yyt,Syt,Tyt,xyt,Eyt,Ayt,Cyt,byt,wyt,Iyt,Pyt,Ryt,Dyt,Oyt,Nyt,Myt,Lyt,Fyt,Byt=new Dn,zyt=function(e){return t({Layout:e,LayoutComponent:e}),e}((ovt=Ec("cc.Layout"),svt=Gc(),cvt=Cc(110),lvt=Bc(),uvt=Ac(xz),hvt=Hc(),fvt=Xc(),_vt=Hc(),dvt=Xc(),pvt=al(syt),mvt=Zc(),gvt=Xc(),vvt=al(cyt),yvt=Hc(),Svt=Xc(),Tvt=Hc(),xvt=Xc(),Evt=al(lyt),Avt=Xc(),Cvt=Xc(),bvt=Xc(),wvt=Xc(),Ivt=Xc(),Pvt=Xc(),Rvt=Xc(),Dvt=al(uyt),Ovt=Xc(),Nvt=al(hyt),Mvt=Xc(),Lvt=al(fyt),Fvt=Hc(),Bvt=Xc(),zvt=Hc(),Uvt=Xc(),kvt=Xc(),ovt(Gvt=svt(Gvt=cvt(Gvt=lvt(Gvt=uvt(Gvt=Fc((oyt=ayt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_resizeMode",Hvt,rt(e)),st(e,"_layoutType",Wvt,rt(e)),st(e,"_cellSize",jvt,rt(e)),st(e,"_startAxis",Xvt,rt(e)),st(e,"_paddingLeft",qvt,rt(e)),st(e,"_paddingRight",Yvt,rt(e)),st(e,"_paddingTop",Kvt,rt(e)),st(e,"_paddingBottom",Qvt,rt(e)),st(e,"_spacingX",Jvt,rt(e)),st(e,"_spacingY",Zvt,rt(e)),st(e,"_verticalDirection",$vt,rt(e)),st(e,"_horizontalDirection",tyt,rt(e)),st(e,"_constraint",eyt,rt(e)),st(e,"_constraintNum",nyt,rt(e)),st(e,"_affectedByScale",iyt,rt(e)),st(e,"_isAlign",ryt,rt(e)),e._layoutSize=new ii(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}Z(e,t);var n=e.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(ii.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e],i=n._uiProps.uiTransformComp;n.activeInHierarchy&&i&&this._usefulLayoutObj.push(i)}},n._addEventListeners=function(){lN.on(cN.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(rA.SIZE_CHANGED,this._resized,this),this.node.on(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(rA.CHILD_ADDED,this._childAdded,this),this.node.on(rA.CHILD_REMOVED,this._childRemoved,this),this.node.on(rA.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){lN.off(cN.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(rA.SIZE_CHANGED,this._resized,this),this.node.off(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(rA.CHILD_ADDED,this._childAdded,this),this.node.off(rA.CHILD_REMOVED,this._childRemoved,this),this.node.off(rA.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.on(rA.SIZE_CHANGED,this._doLayoutDirty,this),n.on(rA.TRANSFORM_CHANGED,this._transformDirty,this),n.on(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),n.on(rA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.off(rA.SIZE_CHANGED,this._doLayoutDirty,this),n.off(rA.TRANSFORM_CHANGED,this._transformDirty,this),n.off(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),n.off(rA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._childAdded=function(t){t.on(rA.SIZE_CHANGED,this._doLayoutDirty,this),t.on(rA.TRANSFORM_CHANGED,this._transformDirty,this),t.on(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on(rA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off(rA.SIZE_CHANGED,this._doLayoutDirty,this),t.off(rA.TRANSFORM_CHANGED,this._transformDirty,this),t.off(rA.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off(rA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingLeft;this._horizontalDirection===hyt.RIGHT_TO_LEFT&&(o=-1,s=this._paddingRight);var c=(this._horizontalDirection-r.x)*t+o*s,l=c-o*this._spacingX,u=0,h=0,f=0,_=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.width,g=this._getPaddingH();this._layoutType!==syt.GRID&&this._resizeMode===cyt.CHILDREN&&(m=(t-g-(p-1)*this._spacingX)/p);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var S=v[y],T=S.node,x=T.scale,E=this._getUsedScaleValue(x.x),A=this._getUsedScaleValue(x.y);this._resizeMode===cyt.CHILDREN&&(S.width=m/E,this._layoutType===syt.GRID&&(S.height=this._cellSize.height/A));var C=Math.abs(this._horizontalDirection-S.anchorX),b=S.width*E,w=S.height*A;w>f&&(_=Math.max(f,_),h=f||w,f=w),l+=o*(C*b+this._spacingX);var I=o*(1-C)*b;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(h=f>w?f:h);else if(b>t-g)l>c+o*C*b&&(d=!0);else{var P=(1-this._horizontalDirection-r.x)*t,R=l+I+o*(o>0?this._paddingRight:this._paddingLeft);d=Math.abs(R)>Math.abs(P)}d&&(l=c+o*C*b,w!==f&&(h=f),u+=h+this._spacingY,h=f=w)}var D=n(T,S,u);i&&T.setPosition(l,D),l+=I}return h=Math.max(h,f),Math.max(_,u+h)+this._getPaddingV()},n._doLayoutVertically=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingBottom;this._verticalDirection===uyt.TOP_TO_BOTTOM&&(o=-1,s=this._paddingTop);var c=(this._verticalDirection-r.y)*t+o*s,l=c-o*this._spacingY,u=0,h=0,f=0,_=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.height,g=this._getPaddingV();this._layoutType!==syt.GRID&&this._resizeMode===cyt.CHILDREN&&(m=(t-g-(p-1)*this._spacingY)/p);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var S=v[y],T=S.node,x=T.scale,E=this._getUsedScaleValue(x.x),A=this._getUsedScaleValue(x.y);this._resizeMode===cyt.CHILDREN&&(S.height=m/A,this._layoutType===syt.GRID&&(S.width=this._cellSize.width/E));var C=Math.abs(this._verticalDirection-S.anchorY),b=S.width*E,w=S.height*A;b>u&&(h=Math.max(u,h),f=u||b,u=b),l+=o*(C*w+this._spacingY);var I=o*(1-C)*w;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(f=u>w?u:f);else if(w>t-g)l>c+o*C*w&&(d=!0);else{var P=(1-this._verticalDirection-r.y)*t,R=l+I+o*(o>0?this._paddingTop:this._paddingBottom);d=Math.abs(R)>Math.abs(P)}d&&(l=c+o*C*w,b!==u&&(f=u),_+=f+this._spacingX,f=u=b)}var D=n(T,S,_);i&&(T.getPosition(Byt),T.setPosition(D,l,Byt.z)),l+=I}return f=Math.max(f,u),Math.max(h,_+f)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,e){var n=this,i=e.width,r=1,a=-t.y*e.height,o=this._paddingBottom;this._verticalDirection===uyt.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*e.height,o=this._paddingTop);var s=function(t,e,i){return a+r*(i+(1-e.anchorY)*e.height*n._getUsedScaleValue(t.scale.y)+o)},c=0;this._resizeMode===cyt.CONTAINER&&(c=this._doLayoutHorizontally(i,!0,s,!1),a=-t.y*c,this._verticalDirection===uyt.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*c)),this._doLayoutHorizontally(i,!0,s,!0),this._resizeMode===cyt.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(i,c)},n._doLayoutGridAxisVertical=function(t,e){var n=this,i=e.height,r=1,a=-t.x*e.width,o=this._paddingLeft;this._horizontalDirection===hyt.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*e.width,o=this._paddingRight);var s=function(t,e,i){return a+r*(i+(1-e.anchorX)*e.width*n._getUsedScaleValue(t.scale.x)+o)},c=0;this._resizeMode===cyt.CONTAINER&&(c=this._doLayoutVertically(i,!0,s,!1),a=-t.x*c,this._horizontalDirection===hyt.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*c)),this._doLayoutVertically(i,!0,s,!0),this._resizeMode===cyt.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(c,i)},n._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,n=t.contentSize;this.startAxis===lyt.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,n):this.startAxis===lyt.VERTICAL&&this._doLayoutGridAxisVertical(e,n)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===cyt.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.width*this._getUsedScaleValue(a.x)}e+=(n-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===cyt.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.height*this._getUsedScaleValue(a.y)}e+=(n-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===syt.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?Dn.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===syt.VERTICAL){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(e){return(t._isAlign?Dn.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=n}else this._layoutType===syt.GRID&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){t&yy.SCALE&&t&yy.POSITION&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(this._layoutType!==syt.GRID||this._constraint===fyt.NONE||this._constraintNum<=0)return 0;var t=this._constraint===fyt.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===lyt.VERTICAL&&(t=this._constraint===fyt.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},Q(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===syt.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===syt.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==syt.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==syt.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==fyt.NONE&&this._constraintNum!==t&&(t<=0&&S("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(Zu),ayt.Type=syt,ayt.VerticalDirection=uyt,ayt.HorizontalDirection=hyt,ayt.ResizeMode=cyt,ayt.AxisDirection=lyt,ayt.Constraint=fyt,ct((Vvt=oyt).prototype,"alignHorizontal",[hvt,fvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"alignHorizontal"),Vvt.prototype),ct(Vvt.prototype,"alignVertical",[_vt,dvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"alignVertical"),Vvt.prototype),ct(Vvt.prototype,"type",[pvt,mvt,gvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"type"),Vvt.prototype),ct(Vvt.prototype,"resizeMode",[vvt,yvt,Svt],Object.getOwnPropertyDescriptor(Vvt.prototype,"resizeMode"),Vvt.prototype),ct(Vvt.prototype,"cellSize",[Tvt,xvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"cellSize"),Vvt.prototype),ct(Vvt.prototype,"startAxis",[Evt,Avt],Object.getOwnPropertyDescriptor(Vvt.prototype,"startAxis"),Vvt.prototype),ct(Vvt.prototype,"paddingLeft",[Cvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"paddingLeft"),Vvt.prototype),ct(Vvt.prototype,"paddingRight",[bvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"paddingRight"),Vvt.prototype),ct(Vvt.prototype,"paddingTop",[wvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"paddingTop"),Vvt.prototype),ct(Vvt.prototype,"paddingBottom",[Ivt],Object.getOwnPropertyDescriptor(Vvt.prototype,"paddingBottom"),Vvt.prototype),ct(Vvt.prototype,"spacingX",[Pvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"spacingX"),Vvt.prototype),ct(Vvt.prototype,"spacingY",[Rvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"spacingY"),Vvt.prototype),ct(Vvt.prototype,"verticalDirection",[Dvt,Ovt],Object.getOwnPropertyDescriptor(Vvt.prototype,"verticalDirection"),Vvt.prototype),ct(Vvt.prototype,"horizontalDirection",[Nvt,Mvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"horizontalDirection"),Vvt.prototype),ct(Vvt.prototype,"constraint",[Lvt,Fvt,Bvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"constraint"),Vvt.prototype),ct(Vvt.prototype,"constraintNum",[zvt,Uvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"constraintNum"),Vvt.prototype),ct(Vvt.prototype,"affectedByScale",[kvt],Object.getOwnPropertyDescriptor(Vvt.prototype,"affectedByScale"),Vvt.prototype),Hvt=ct(Vvt.prototype,"_resizeMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cyt.NONE}}),Wvt=ct(Vvt.prototype,"_layoutType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return syt.NONE}}),jvt=ct(Vvt.prototype,"_cellSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ii(40,40)}}),Xvt=ct(Vvt.prototype,"_startAxis",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lyt.HORIZONTAL}}),qvt=ct(Vvt.prototype,"_paddingLeft",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yvt=ct(Vvt.prototype,"_paddingRight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kvt=ct(Vvt.prototype,"_paddingTop",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qvt=ct(Vvt.prototype,"_paddingBottom",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jvt=ct(Vvt.prototype,"_spacingX",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zvt=ct(Vvt.prototype,"_spacingY",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$vt=ct(Vvt.prototype,"_verticalDirection",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uyt.TOP_TO_BOTTOM}}),tyt=ct(Vvt.prototype,"_horizontalDirection",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hyt.LEFT_TO_RIGHT}}),eyt=ct(Vvt.prototype,"_constraint",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fyt.NONE}}),nyt=ct(Vvt.prototype,"_constraintNum",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),iyt=ct(Vvt.prototype,"_affectedByScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ryt=ct(Vvt.prototype,"_isAlign",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gvt=Vvt))||Gvt)||Gvt)||Gvt)||Gvt)||Gvt)||Gvt));l.Layout=zyt,function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(Fyt||(Fyt={})),oe(Fyt);var Uyt,kyt,Gyt,Vyt,Hyt,Wyt,jyt,Xyt,qyt,Yyt,Kyt,Qyt,Jyt,Zyt,$yt,tSt,eSt,nSt,iSt,rSt,aSt,oSt,sSt,cSt,lSt=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((dyt=Ec("cc.ProgressBar"),pyt=Gc(),myt=Cc(110),gyt=Bc(),vyt=Ac(xz),yyt=al(kV),Syt=Xc(),Tyt=al(Fyt),xyt=Xc(),Eyt=Xc(),Ayt=qc(),Cyt=Xc(),byt=Xc(),dyt(wyt=pyt(wyt=myt(wyt=gyt(wyt=vyt((Lyt=Myt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_barSprite",Pyt,rt(e)),st(e,"_mode",Ryt,rt(e)),st(e,"_totalLength",Dyt,rt(e)),st(e,"_progress",Oyt,rt(e)),st(e,"_reverse",Nyt,rt(e)),e}Z(e,t);var n=e.prototype;return n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===kV.FillType.RADIAL&&(this._mode=Fyt.FILLED),this._mode===Fyt.HORIZONTAL?this.totalLength=r.width:this._mode===Fyt.VERTICAL?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var a=-n.width*i.x;t.setPosition(a,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,n=e.anchorPoint,i=e.contentSize,r=t.getPosition(),a=new Qn(0,.5),o=hn(this._progress),s=this._totalLength*o,c=i,l=0,u=0;switch(this._mode){case Fyt.HORIZONTAL:this._reverse&&(a=new Qn(1,.5)),c=new ii(s,i.height),l=this._totalLength,u=i.height;break;case Fyt.VERTICAL:a=this._reverse?new Qn(.5,1):new Qn(.5,0),c=new ii(i.width,s),l=i.width,u=this._totalLength}if(this._mode===Fyt.FILLED)this._barSprite.type!==kV.Type.FILLED?S("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==kV.Type.FILLED){var h=a.x-n.x,f=a.y-n.y,_=new Dn(l*h,u*f,0);t.setPosition(r.x+_.x,r.y+_.y,r.z),e.setAnchorPoint(a),e.setContentSize(c)}else S("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},Q(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var n=e._uiProps.uiTransformComp.contentSize;this._mode===Fyt.HORIZONTAL?this.totalLength=n.width:this._mode===Fyt.VERTICAL?this.totalLength=n.height:this._mode===Fyt.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===Fyt.FILLED&&(t=hn(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(Zu),Myt.Mode=Fyt,ct((Iyt=Lyt).prototype,"barSprite",[yyt,Syt],Object.getOwnPropertyDescriptor(Iyt.prototype,"barSprite"),Iyt.prototype),ct(Iyt.prototype,"mode",[Tyt,xyt],Object.getOwnPropertyDescriptor(Iyt.prototype,"mode"),Iyt.prototype),ct(Iyt.prototype,"totalLength",[Eyt],Object.getOwnPropertyDescriptor(Iyt.prototype,"totalLength"),Iyt.prototype),ct(Iyt.prototype,"progress",[Ayt,Jc,Cyt],Object.getOwnPropertyDescriptor(Iyt.prototype,"progress"),Iyt.prototype),ct(Iyt.prototype,"reverse",[byt],Object.getOwnPropertyDescriptor(Iyt.prototype,"reverse"),Iyt.prototype),Pyt=ct(Iyt.prototype,"_barSprite",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ryt=ct(Iyt.prototype,"_mode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fyt.HORIZONTAL}}),Dyt=ct(Iyt.prototype,"_totalLength",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Oyt=ct(Iyt.prototype,"_progress",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Nyt=ct(Iyt.prototype,"_reverse",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wyt=Iyt))||wyt)||wyt)||wyt)||wyt)||wyt));l.ProgressBar=lSt;var uSt,hSt=new Dn,fSt=new Dn,_St=new Dn,dSt=new Qn,pSt=new Pn,mSt=new Qn;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(uSt||(uSt={})),le(uSt);var gSt,vSt=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((Uyt=Ec("cc.ScrollBar"),kyt=Gc(),Gyt=Cc(110),Vyt=Bc(),Hyt=Ac(xz),Wyt=al(kV),jyt=Zc(),Xyt=Xc(),qyt=al(uSt),Yyt=Zc(),Kyt=Xc(),Qyt=Zc(),Jyt=Xc(),Zyt=Zc(),$yt=Xc(),Uyt(tSt=kyt(tSt=Gyt(tSt=Vyt(tSt=Hyt((cSt=sSt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_scrollView",nSt,rt(e)),st(e,"_handle",iSt,rt(e)),st(e,"_direction",rSt,rt(e)),st(e,"_enableAutoHide",aSt,rt(e)),st(e,"_autoHideTime",oSt,rt(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}Z(e,t);var n=e.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var n=e._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize,r=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(n,i)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var a=0,o=0,s=0,c=0,l=0,u=mSt;u.set(0,0),this._direction===uSt.HORIZONTAL?(a=n.width,o=i.width,l=r.width,s=t.x,this._convertToScrollViewSpace(u,e),c=-u.x):this._direction===uSt.VERTICAL&&(a=n.height,o=i.height,l=r.height,s=t.y,this._convertToScrollViewSpace(u,e),c=-u.y);var h=this._calculateLength(a,o,l,s),f=mSt;this._calculatePosition(f,a,o,l,c,s,h),this._updateLength(h),this._updateHandlerPosition(f)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,n=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(kV);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,e){var n=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp;if(n&&i){hSt.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR(hSt,fSt);var r=n.convertToNodeSpaceAR(fSt);r.x+=n.anchorX*n.width,r.y+=n.anchorY*n.height,t.set(r.x,r.y)}else t.set(Qn.ZERO)},n._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(kV);e&&(pSt.set(e.color),pSt.a=t,e.color=pSt),(e=this._handle.getComponent(kV))&&(pSt.set(e.color),pSt.a=t,e.color=pSt)}},n._updateHandlerPosition=function(t){if(this._handle){var e=_St;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},n._fixupHandlerPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=this.handle.node._uiProps.uiTransformComp.contentSize,a=this.handle.node.parent;Dn.set(hSt,-n.width*i.x,-n.height*i.y,0);var o=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(hSt,fSt),s=t;s.set(0,0,0),a._uiProps.uiTransformComp.convertToNodeSpaceAR(o,s),this.direction===uSt.HORIZONTAL?s.set(s.x,s.y+(n.height-r.height)/2,s.z):this.direction===uSt.VERTICAL&&s.set(s.x+(n.width-r.width)/2,s.y,s.z),this.handle.node.setPosition(s)},n._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===uSt.HORIZONTAL||t.height<=e.height&&this._direction===uSt.VERTICAL},n._calculateLength=function(t,e,n,i){var r=t;return i&&(r+=20*(i>0?i:-i)),n*(e/r)},n._calculatePosition=function(t,e,n,i,r,a,o){var s=e-n;a&&(s+=Math.abs(a));var c=0;s&&(c=hn(c=r/s));var l=(i-o)*c;this._direction===uSt.VERTICAL?t.set(0,l):t.set(l,0)},n._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint;i.x===dSt.x&&i.y===dSt.y||e.setAnchorPoint(dSt),this._direction===uSt.HORIZONTAL?e.setContentSize(t,n.height):e.setContentSize(n.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},Q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Qn.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(Qn.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(Zu),sSt.Direction=uSt,ct((eSt=cSt).prototype,"handle",[Wyt,jyt,Xyt],Object.getOwnPropertyDescriptor(eSt.prototype,"handle"),eSt.prototype),ct(eSt.prototype,"direction",[qyt,Yyt,Kyt],Object.getOwnPropertyDescriptor(eSt.prototype,"direction"),eSt.prototype),ct(eSt.prototype,"enableAutoHide",[Qyt,Jyt],Object.getOwnPropertyDescriptor(eSt.prototype,"enableAutoHide"),eSt.prototype),ct(eSt.prototype,"autoHideTime",[Zyt,$yt],Object.getOwnPropertyDescriptor(eSt.prototype,"autoHideTime"),eSt.prototype),nSt=ct(eSt.prototype,"_scrollView",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iSt=ct(eSt.prototype,"_handle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rSt=ct(eSt.prototype,"_direction",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uSt.HORIZONTAL}}),aSt=ct(eSt.prototype,"_enableAutoHide",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oSt=ct(eSt.prototype,"_autoHideTime",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tSt=eSt))||tSt)||tSt)||tSt)||tSt)||tSt));l.ScrollBar=vSt;var ySt,SSt,TSt,xSt,ESt,ASt,CSt,bSt,wSt,ISt,PSt,RSt,DSt,OSt,NSt,MSt,LSt,FSt,BSt,zSt,USt,kSt,GSt,VSt,HSt,WSt,jSt,XSt,qSt,YSt,KSt,QSt,JSt,ZSt,$St,tTt,eTt,nTt,iTt,rTt,aTt,oTt,sTt,cTt,lTt,uTt,hTt,fTt,_Tt=t("ViewGroup",Ec("cc.ViewGroup")(gSt=Cc(110)(gSt=function(t){function e(){return t.apply(this,arguments)||this}return Z(e,t),e}(Zu))||gSt)||gSt);l.ViewGroup=_Tt;var dTt,pTt=1e-4,mTt=new Dn,gTt=new Dn,vTt=new Qn,yTt=new Qn,STt=function(){return(new Date).getMilliseconds()},TTt={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(dTt||(dTt={}));var xTt,ETt,ATt,CTt,bTt,wTt,ITt,PTt,RTt,DTt,OTt,NTt,MTt,LTt,FTt,BTt,zTt,UTt,kTt,GTt,VTt,HTt=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((ySt=Ec("cc.ScrollView"),SSt=Gc(),TSt=Cc(110),xSt=Bc(),ESt=Ac(xz),ASt=qc(),CSt=Zc(),bSt=Xc(),wSt=qc(),ISt=Zc(),PSt=Xc(),RSt=Zc(),DSt=Xc(),OSt=Zc(),NSt=Xc(),MSt=al(ob),LSt=Zc(),FSt=Xc(),BSt=Zc(),zSt=Xc(),USt=al(vSt),kSt=Zc(),GSt=Xc(),VSt=Zc(),HSt=Xc(),WSt=al(vSt),jSt=Zc(),XSt=Xc(),qSt=Zc(),YSt=Xc(),KSt=al([cF]),QSt=Zc(),JSt=Xc(),ySt(ZSt=SSt(ZSt=TSt(ZSt=xSt(ZSt=ESt((fTt=hTt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"bounceDuration",tTt,rt(e)),st(e,"brake",eTt,rt(e)),st(e,"elastic",nTt,rt(e)),st(e,"inertia",iTt,rt(e)),st(e,"horizontal",rTt,rt(e)),st(e,"vertical",aTt,rt(e)),st(e,"cancelInnerEvents",oTt,rt(e)),st(e,"scrollEvents",sTt,rt(e)),e._autoScrolling=!1,e._scrolling=!1,st(e,"_content",cTt,rt(e)),st(e,"_horizontalScrollBar",lTt,rt(e)),st(e,"_verticalScrollBar",uTt,rt(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new Dn,e._autoScrollTargetDelta=new Dn,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new Dn,e._outOfBoundaryAmount=new Dn,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new Dn,e._deltaPos=new Dn,e}Z(e,t);var n=e.prototype;return n.scrollToBottom=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n,!0)},n.scrollToTop=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToOffset=function(t,e,n){void 0===n&&(n=!0);var i=this.getMaxScrollOffset(),r=new Qn(0,0);0===i.x?r.x=0:r.x=t.x/i.x,0===i.y?r.y=1:r.y=(i.y-t.y)/i.y,this.scrollTo(r,e,n)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Qn(e,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return Qn.ZERO;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,n=t.height-this.view.height;return new Qn(e=e>=0?e:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},n.scrollTo=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.scrollToPercentVertical=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this._setContentPosition(t)},n._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<pTt&&Math.abs(t.y-e.y)<pTt||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this._getContentPosition()},n._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):Dn.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return pTt},n.start=function(){this._calculateBoundary(),this._content&&lN.once(cN.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},n.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(rA.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(rA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(rA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(rA.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},n.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},n.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(rA.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(rA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(rA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(rA.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},n._registerEvent=function(){this.node.on(rA.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(rA.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(rA.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(rA.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(rA.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._unregisterEvent=function(){this.node.off(rA.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(rA.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(rA.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(rA.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(rA.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._onMouseWheel=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=new Dn,i=t.getScrollY();this.vertical?n.set(0,-.1*i,0):this.horizontal&&n.set(-.1*i,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(n),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var n=t.touch;if(this._handleMoveLogic(n),this.cancelInnerEvents){var i=n.getUILocation(vTt);if(i.subtract(n.getUIStartLocation(yTt)),i.length()>7&&!this._touchMoved&&t.target!==this.node){var r=new _R(t.getTouches(),t.bubbles,ew.TOUCH_CANCEL);r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(dTt.TOUCH_UP);var n=t.touch;this._handleReleaseLogic(n),this._touchMoved?t.propagationStopped=!0:this._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var n=t.touch;this._handleReleaseLogic(n)}this._stopPropagationIfTargetIsMe(t)}},n._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(zyt);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,n=e.width*e.anchorX,i=e.height*e.anchorY;this._leftBoundary=-n,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},n._hasNestedViewGroup=function(t,e){if(!t||t.eventPhase!==cR.CAPTURING_PHASE)return!1;if(e)for(var n,i=ot(e);!(n=i()).done;){var r=n.value;if(this.node===r)return!(!t.target||!t.target.getComponent(_Tt));if(r.getComponent(_Tt))return!0}return!1},n._startInertiaScroll=function(t){var e=new Dn(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,e){var n=t.clone();if(n.normalize(),this._content&&this.view){var i=this._content._uiProps.uiTransformComp.contentSize,r=this.view.contentSize,a=i.width-r.width,o=i.height-r.height,s=this._calculateAttenuatedFactor(a),c=this._calculateAttenuatedFactor(o);n.x=n.x*a*(1-this.brake)*s,n.y=n.y*o*c*(1-this.brake),n.z=0}var l=t.length(),u=n.length()/l;if(n.add(t),this.brake>0&&u>7){u=Math.sqrt(u);var h=t.clone();h.multiplyScalar(u),n.set(h),n.add(t)}var f=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&u>3&&(f*=u=3),0===this.brake&&u>1&&(f*=u),this._startAutoScroll(n,f,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,e,n){void 0===n&&(n=!1);var i=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=i,this._autoScrollAttenuate=n,Dn.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(Dn.ZERO,pTt)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new Dn,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(Dn.ZERO);else{var n=new Dn;n=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),n),t.set(n.x*(1-this.brake)/e,n.y*(1-this.brake)/e,n.z)}return t},n._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},n._moveContent=function(t,e){var n=this._flattenVectorByDirection(t);mTt.set(this._getContentPosition()),mTt.add(n),mTt.set(Math.round(1e4*mTt.x)*pTt,Math.round(1e4*mTt.y)*pTt,mTt.z),this._setContentPosition(mTt);var i=this._getHowMuchOutOfBoundary();vTt.set(i.x,i.y),this._updateScrollBar(vTt),this.elastic&&e&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},n._getHowMuchOutOfBoundary=function(t){if((t=t||new Dn).equals(Dn.ZERO,pTt)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new Dn,n=this._getContentLeftBoundary(),i=this._getContentRightBoundary();n+t.x>this._leftBoundary?e.x=this._leftBoundary-(n+t.x):i+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(i+t.x));var r=this._getContentTopBoundary(),a=this._getContentBottomBoundary();return r+t.y<this._topBoundary?e.y=this._topBoundary-(r+t.y):a+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(a+t.y)),t.equals(Dn.ZERO,pTt)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if(t===dTt.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===dTt.SCROLL_TO_TOP||t===dTt.SCROLL_TO_BOTTOM||t===dTt.SCROLL_TO_LEFT||t===dTt.SCROLL_TO_RIGHT){var e=1<<TTt[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cF.emitEvents(this.scrollEvents,this,TTt[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();mTt.set(this._getContentPosition()),mTt.add(t),this._content.setPosition(mTt),this._updateScrollBar(Qn.ZERO)}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===cR.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._processDeltaMove(this._deltaPos)},n._handleReleaseLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(dTt.SCROLL_ENDED))},n._getLocalAxisAlignDelta=function(t,e){var n=this.node._uiProps.uiTransformComp,i=new Dn;n&&(e.getUILocation(vTt),e.getUIPreviousLocation(yTt),mTt.set(vTt.x,vTt.y,0),gTt.set(yTt.x,yTt.y,0),n.convertToNodeSpaceAR(mTt,mTt),n.convertToNodeSpaceAR(gTt,gTt),Dn.subtract(i,mTt,gTt)),t.set(i)},n._scrollChildren=function(t){this._clampDelta(t);var e,n=t;this.elastic&&(e=this._getHowMuchOutOfBoundary(),n.x*=0===e.x?1:.5,n.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(n),n.add(e));var i="",r="";if(this._content){var a=this._content._uiProps.uiTransformComp,o=a.anchorX,s=a.anchorY,c=a.width,l=a.height,u=this._content.position||Dn.ZERO;this.vertical&&(n.y>0?u.y-s*l+n.y>=this._bottomBoundary&&(i=dTt.SCROLL_TO_BOTTOM):n.y<0&&u.y-s*l+l+n.y<=this._topBoundary&&(i=dTt.SCROLL_TO_TOP)),this.horizontal&&(n.x<0?u.x-o*c+c+n.x<=this._rightBoundary&&(r=dTt.SCROLL_TO_RIGHT):n.x>0&&u.x-o*c+n.x>=this._leftBoundary&&(r=dTt.SCROLL_TO_LEFT))}this._moveContent(n,!1),(this.horizontal&&0!==n.x||this.vertical&&0!==n.y)&&(this._scrolling||(this._scrolling=!0,this._dispatchEvent(dTt.SCROLL_BEGAN)),this._dispatchEvent(dTt.SCROLLING)),""!==i&&this._dispatchEvent(i),""!==r&&this._dispatchEvent(r)},n._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(dTt.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=STt(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,n=this._content._uiProps.uiTransformComp;n.width<e.width&&(t.x=0),n.height<e.height&&(t.y=0)}},n._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var n=STt();this._touchMoveTimeDeltas.push((n-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=n},n._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(this._clampDelta(t),t.equals(Dn.ZERO,pTt))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(dTt.BOUNCE_TOP),t.y<0&&this._dispatchEvent(dTt.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(dTt.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(dTt.BOUNCE_LEFT),this._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(mTt,pTt)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(Dn.ZERO,pTt)},n._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,Dn.copy(this._autoScrollBrakingStartPosition,this._getContentPosition()),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),n=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/n);var i,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=r,r=(i-=1)*i*i*i*i+1);var a=this._autoScrollTargetDelta.clone();a.multiplyScalar(r);var o=this._autoScrollStartPosition.clone();o.add(a);var s=Math.abs(r-1)<=pTt;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(dTt.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var c=o.clone();c.subtract(this._autoScrollBrakingStartPosition),e&&c.multiplyScalar(n),o.set(this._autoScrollBrakingStartPosition),o.add(c)}else{var l=o.clone();l.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(l);u.equals(Dn.ZERO,pTt)||(o.add(u),s=!0)}s&&(this._autoScrolling=!1);var h=o.clone();h.subtract(this._getContentPosition()),this._clampDelta(h),this._moveContent(h,s),this._dispatchEvent(dTt.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(dTt.SCROLL_ENDED))},n._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(Dn.ZERO,pTt))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(dTt.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(dTt.SCROLL_ENDED),this._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var e=t.anchor,n=t.applyToHorizontal,i=t.applyToVertical;this._calculateBoundary(),e.clampf(Qn.ZERO,Qn.ONE);var r=this._getContentBottomBoundary()-this._bottomBoundary;r=-r;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var o=new Dn;if(this._content&&this.view){var s=0,c=this._content._uiProps.uiTransformComp.contentSize,l=this.view.contentSize;n&&(s=c.width-l.width,o.x=a-s*e.x),i&&(s=c.height-l.height,o.y=r-s*e.y)}return o},n._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var n=new Dn,i=0,r=this._getContentLeftBoundary()-this._leftBoundary;if(r=-r,this._content){var a=this._content._uiProps.uiTransformComp.contentSize;a.height<t.height&&(i=a.height-t.height,n.y=e-i),a.width<t.width&&(i=a.width-t.width,n.x=r)}this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},n._scaleChanged=function(t){t===yy.SCALE&&this._calculateBoundary()},Q(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):I(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(Qn.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(Qn.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(_Tt),hTt.EventType=dTt,tTt=ct(($St=fTt).prototype,"bounceDuration",[Dc,ASt,CSt,bSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eTt=ct($St.prototype,"brake",[Dc,wSt,ISt,PSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),nTt=ct($St.prototype,"elastic",[Dc,RSt,DSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iTt=ct($St.prototype,"inertia",[Dc,OSt,NSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct($St.prototype,"content",[MSt,LSt,FSt],Object.getOwnPropertyDescriptor($St.prototype,"content"),$St.prototype),rTt=ct($St.prototype,"horizontal",[Dc,BSt,zSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct($St.prototype,"horizontalScrollBar",[USt,kSt,GSt],Object.getOwnPropertyDescriptor($St.prototype,"horizontalScrollBar"),$St.prototype),aTt=ct($St.prototype,"vertical",[Dc,VSt,HSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct($St.prototype,"verticalScrollBar",[WSt,jSt,XSt],Object.getOwnPropertyDescriptor($St.prototype,"verticalScrollBar"),$St.prototype),oTt=ct($St.prototype,"cancelInnerEvents",[Dc,qSt,YSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sTt=ct($St.prototype,"scrollEvents",[KSt,Dc,QSt,JSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cTt=ct($St.prototype,"_content",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lTt=ct($St.prototype,"_horizontalScrollBar",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uTt=ct($St.prototype,"_verticalScrollBar",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZSt=$St))||ZSt)||ZSt)||ZSt)||ZSt)||ZSt));l.ScrollView=HTt;var WTt,jTt=new Dn;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(WTt||(WTt={})),le(WTt);var XTt,qTt,YTt,KTt,QTt,JTt,ZTt,$Tt,txt,ext,nxt,ixt,rxt,axt,oxt,sxt,cxt,lxt,uxt,hxt,fxt=function(e){return t({Slider:e,SliderComponent:e}),e}((xTt=Ec("cc.Slider"),ETt=Gc(),ATt=Cc(110),CTt=Bc(),bTt=Ac(xz),wTt=al(kV),ITt=Xc(),PTt=al(WTt),RTt=Xc(),DTt=qc(),OTt=Xc(),NTt=al([cF]),MTt=Xc(),xTt(LTt=ETt(LTt=ATt(LTt=CTt(LTt=bTt((VTt=GTt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"slideEvents",BTt,rt(e)),st(e,"_handle",zTt,rt(e)),st(e,"_direction",UTt,rt(e)),st(e,"_progress",kTt,rt(e)),e._offset=new Dn,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new Dn,e._touchPos=new Dn,e}Z(e,t);var n=e.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){this._updateHandlePosition(),this.node.on(rA.TOUCH_START,this._onTouchBegan,this),this.node.on(rA.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(rA.TOUCH_END,this._onTouchEnded,this),this.node.on(rA.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(rA.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(rA.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(rA.TOUCH_END,this._onTouchEnded,this))},n.onDisable=function(){this.node.off(rA.TOUCH_START,this._onTouchBegan,this),this.node.off(rA.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(rA.TOUCH_END,this._onTouchEnded,this),this.node.off(rA.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(rA.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(rA.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(rA.TOUCH_END,this._onTouchEnded,this))},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();Dn.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Dn,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){cF.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();Dn.set(this._touchPos,e.x,e.y,0);var n=this.node._uiProps.uiTransformComp,i=n.convertToNodeSpaceAR(this._touchPos,jTt);this.direction===WTt.Horizontal?this.progress=hn(.5+(i.x-this._offset.x)/n.width):this.progress=hn(.5+(i.y-this._offset.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===WTt.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},n._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var n=this._handle.node.position;this._direction===WTt.Horizontal?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},Q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(Zu),GTt.Direction=WTt,ct((FTt=VTt).prototype,"handle",[wTt,ITt],Object.getOwnPropertyDescriptor(FTt.prototype,"handle"),FTt.prototype),ct(FTt.prototype,"direction",[PTt,RTt],Object.getOwnPropertyDescriptor(FTt.prototype,"direction"),FTt.prototype),ct(FTt.prototype,"progress",[Jc,DTt,OTt],Object.getOwnPropertyDescriptor(FTt.prototype,"progress"),FTt.prototype),BTt=ct(FTt.prototype,"slideEvents",[NTt,Dc,MTt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zTt=ct(FTt.prototype,"_handle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UTt=ct(FTt.prototype,"_direction",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WTt.Horizontal}}),kTt=ct(FTt.prototype,"_progress",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),LTt=FTt))||LTt)||LTt)||LTt)||LTt)||LTt));function _xt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(e))}l.Slider=fxt,function(t){t.TOGGLE="toggle"}(hxt||(hxt={}));var dxt,pxt,mxt,gxt,vxt,yxt,Sxt,Txt,xxt,Ext,Axt,Cxt,bxt=function(e){return t({Toggle:e,ToggleComponent:e}),e}((XTt=Ec("cc.Toggle"),qTt=Gc(),YTt=Cc(110),KTt=Bc(),QTt=Ac(xz),JTt=Zc(),ZTt=Xc(),$Tt=al(kV),txt=Zc(),ext=Xc(),nxt=al([cF]),ixt=Xc(),XTt(rxt=qTt(rxt=YTt(rxt=KTt(rxt=QTt((uxt=lxt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"checkEvents",oxt,rt(e)),st(e,"_isChecked",sxt,rt(e)),st(e,"_checkMark",cxt,rt(e)),e}Z(e,t);var n=e.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(t||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},n.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},n._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&cF.emitEvents(this.checkEvents,this)},Q(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return l.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(Gmt),lxt.EventType=_xt(hxt,Umt),ct((axt=uxt).prototype,"isChecked",[JTt,ZTt],Object.getOwnPropertyDescriptor(axt.prototype,"isChecked"),axt.prototype),ct(axt.prototype,"checkMark",[$Tt,txt,ext],Object.getOwnPropertyDescriptor(axt.prototype,"checkMark"),axt.prototype),oxt=ct(axt.prototype,"checkEvents",[nxt,Dc,ixt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sxt=ct(axt.prototype,"_isChecked",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cxt=ct(axt.prototype,"_checkMark",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rxt=axt))||rxt)||rxt)||rxt)||rxt)||rxt));l.Toggle=bxt;var wxt,Ixt,Pxt,Rxt,Dxt,Oxt,Nxt,Mxt,Lxt,Fxt,Bxt,zxt,Uxt,kxt,Gxt,Vxt,Hxt,Wxt,jxt,Xxt,qxt,Yxt,Kxt,Qxt,Jxt,Zxt,$xt,tEt,eEt,nEt,iEt,rEt,aEt,oEt,sEt,cEt,lEt,uEt,hEt,fEt,_Et,dEt,pEt,mEt,gEt,vEt=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((dxt=Ec("cc.ToggleContainer"),pxt=Gc(),mxt=Cc(110),gxt=Bc(),vxt=Xc(),yxt=al([cF]),Sxt=Xc(),dxt(Txt=pxt(Txt=mxt(Txt=gxt(Txt=Fc((Cxt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_allowSwitchOff",Ext,rt(e)),st(e,"checkEvents",Axt,rt(e)),e}Z(e,t);var n=e.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on(rA.CHILD_ADDED,this.ensureValidState,this),this.node.on(rA.CHILD_REMOVED,this.ensureValidState,this)},n.onDisable=function(){this.node.off(rA.CHILD_ADDED,this.ensureValidState,this),this.node.off(rA.CHILD_REMOVED,this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var i=this.toggleItems[n];i!==t&&(e?i.isChecked=!1:i.setIsCheckedWithoutNotify(!1))}this.checkEvents&&l.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var n=this.activeToggles();if(n.length>1)for(var i=n[0],r=0;r<n.length;++r){var a=n[r];a!==i&&(a.isChecked=!1)}},Q(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}(Zu),Ext=ct((xxt=Cxt).prototype,"_allowSwitchOff",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct(xxt.prototype,"allowSwitchOff",[vxt],Object.getOwnPropertyDescriptor(xxt.prototype,"allowSwitchOff"),xxt.prototype),Axt=ct(xxt.prototype,"checkEvents",[yxt,Dc,Sxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Txt=xxt))||Txt)||Txt)||Txt)||Txt)||Txt));l.ToggleContainer=vEt;var yEt,SEt,TEt=new Qn;function xEt(t){return t instanceof GR?fN:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:ii.ZERO}function EEt(t,e,n,i){t.parent?TEt.set(t.parent.getScale().x,t.parent.getScale().y):TEt.set(0,0);for(var r=TEt.x,a=TEt.y,o=0,s=0,c=t.parent;;){if(!c)return n.x=n.y=0,void(i.x=i.y=1);var l=c.getPosition();if(o+=l.x,s+=l.y,(c=c.parent)===e)break;c?TEt.set(c.getScale().x,c.getScale().y):TEt.set(0,0);var u=TEt.x,h=TEt.y;o*=u,s*=h,r*=u,a*=h}i.x=0!==r?1/r:1,i.y=0!==a?1/a:1,n.x=-o,n.y=-s}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(yEt||(yEt={})),le(yEt),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(SEt||(SEt={}));var AEt,CEt,bEt,wEt,IEt,PEt,REt,DEt,OEt,NEt,MEt,LEt,FEt,BEt,zEt,UEt,kEt,GEt,VEt,HEt=SEt.TOP|SEt.BOT,WEt=SEt.LEFT|SEt.RIGHT,jEt=function(e){return t({Widget:e,WidgetComponent:e}),e}((wxt=Ec("cc.Widget"),Ixt=Gc(),Pxt=Cc(110),Rxt=Bc(),Dxt=Ac(xz),Oxt=al(ob),Nxt=Xc(),Mxt=Xc(),Lxt=Xc(),Fxt=Xc(),Bxt=Xc(),zxt=Xc(),Uxt=Xc(),kxt=Hc(),Gxt=Hc(),Vxt=Xc(),Hxt=Xc(),Wxt=Xc(),jxt=Xc(),Xxt=Xc(),qxt=Xc(),Yxt=al(yEt),Kxt=Xc(),wxt(Qxt=Ixt(Qxt=Pxt(Qxt=Rxt(Qxt=Dxt(Qxt=Fc((gEt=mEt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastPos=new Dn,e._lastSize=new ii,e._dirty=!0,e._hadAlignOnce=!1,st(e,"_alignFlags",Zxt,rt(e)),st(e,"_target",$xt,rt(e)),st(e,"_left",tEt,rt(e)),st(e,"_right",eEt,rt(e)),st(e,"_top",nEt,rt(e)),st(e,"_bottom",iEt,rt(e)),st(e,"_horizontalCenter",rEt,rt(e)),st(e,"_verticalCenter",aEt,rt(e)),st(e,"_isAbsLeft",oEt,rt(e)),st(e,"_isAbsRight",sEt,rt(e)),st(e,"_isAbsTop",cEt,rt(e)),st(e,"_isAbsBottom",lEt,rt(e)),st(e,"_isAbsHorizontalCenter",uEt,rt(e)),st(e,"_isAbsVerticalCenter",hEt,rt(e)),st(e,"_originalWidth",fEt,rt(e)),st(e,"_originalHeight",_Et,rt(e)),st(e,"_alignMode",dEt,rt(e)),st(e,"_lockFlags",pEt,rt(e)),e}Z(e,t);var n=e.prototype;return n.updateAlignment=function(){l._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this._recursiveDirty()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),l._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){l._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on(rA.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(rA.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(rA.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(rA.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off(rA.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(rA.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(rA.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off(rA.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var n=this.node.parent&&this.node.parent._uiProps,i=n&&n.uiTransformComp,r=i?i.contentSize:fN;this.isAlignLeft&&t===SEt.LEFT?this._left=e?this._left*r.width:this._left/r.width:this.isAlignRight&&t===SEt.RIGHT?this._right=e?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&t===SEt.CENTER?this._horizontalCenter=e?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&t===SEt.TOP?this._top=e?this._top*r.height:this._top/r.height:this.isAlignBottom&&t===SEt.BOT?this._bottom=e?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&t===SEt.MID&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(xz)&&(t.on(rA.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(rA.SIZE_CHANGED,this._setDirtyByMode,this),t.on(rA.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(rA.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(rA.SIZE_CHANGED,this._setDirtyByMode,this),t.off(rA.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(rA.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(rA.SIZE_CHANGED,this._setDirtyByMode,this))},n._setDirtyByMode=function(){this.alignMode===yEt.ALWAYS&&this._recursiveDirty()},n._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var n=(t&WEt)>0,i=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=i.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=i.height))):(n?this.isStretchWidth&&(i.width=this._originalWidth):this.isStretchHeight&&(i.height=this._originalHeight),this._alignFlags&=~t)}},n._recursiveDirty=function(){this._dirty||(this._dirty=!0)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&SEt.TOP)>0},set:function(t){this._setAlign(SEt.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&SEt.BOT)>0},set:function(t){this._setAlign(SEt.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&SEt.LEFT)>0},set:function(t){this._setAlign(SEt.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&SEt.RIGHT)>0},set:function(t){this._setAlign(SEt.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&SEt.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=SEt.MID):this._alignFlags&=~SEt.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&SEt.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=SEt.CENTER):this._alignFlags&=~SEt.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&WEt)===WEt}},{key:"isStretchHeight",get:function(){return(this._alignFlags&HEt)===HEt}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(SEt.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(SEt.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(SEt.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(SEt.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(SEt.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(SEt.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(Zu),mEt.AlignMode=yEt,ct((Jxt=gEt).prototype,"target",[Oxt,Nxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"target"),Jxt.prototype),ct(Jxt.prototype,"isAlignTop",[Mxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignTop"),Jxt.prototype),ct(Jxt.prototype,"isAlignBottom",[Lxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignBottom"),Jxt.prototype),ct(Jxt.prototype,"isAlignLeft",[Fxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignLeft"),Jxt.prototype),ct(Jxt.prototype,"isAlignRight",[Bxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignRight"),Jxt.prototype),ct(Jxt.prototype,"isAlignVerticalCenter",[zxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignVerticalCenter"),Jxt.prototype),ct(Jxt.prototype,"isAlignHorizontalCenter",[Uxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAlignHorizontalCenter"),Jxt.prototype),ct(Jxt.prototype,"isStretchWidth",[kxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isStretchWidth"),Jxt.prototype),ct(Jxt.prototype,"isStretchHeight",[Gxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"isStretchHeight"),Jxt.prototype),ct(Jxt.prototype,"top",[Vxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"top"),Jxt.prototype),ct(Jxt.prototype,"editorTop",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorTop"),Jxt.prototype),ct(Jxt.prototype,"bottom",[Hxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"bottom"),Jxt.prototype),ct(Jxt.prototype,"editorBottom",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorBottom"),Jxt.prototype),ct(Jxt.prototype,"left",[Wxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"left"),Jxt.prototype),ct(Jxt.prototype,"editorLeft",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorLeft"),Jxt.prototype),ct(Jxt.prototype,"right",[jxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"right"),Jxt.prototype),ct(Jxt.prototype,"editorRight",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorRight"),Jxt.prototype),ct(Jxt.prototype,"horizontalCenter",[Xxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"horizontalCenter"),Jxt.prototype),ct(Jxt.prototype,"editorHorizontalCenter",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorHorizontalCenter"),Jxt.prototype),ct(Jxt.prototype,"verticalCenter",[qxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"verticalCenter"),Jxt.prototype),ct(Jxt.prototype,"editorVerticalCenter",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"editorVerticalCenter"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteTop",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteTop"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteBottom",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteBottom"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteLeft",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteLeft"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteRight",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteRight"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteHorizontalCenter",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteHorizontalCenter"),Jxt.prototype),ct(Jxt.prototype,"isAbsoluteVerticalCenter",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"isAbsoluteVerticalCenter"),Jxt.prototype),ct(Jxt.prototype,"alignMode",[Yxt,Kxt],Object.getOwnPropertyDescriptor(Jxt.prototype,"alignMode"),Jxt.prototype),ct(Jxt.prototype,"alignFlags",[Vc],Object.getOwnPropertyDescriptor(Jxt.prototype,"alignFlags"),Jxt.prototype),Zxt=ct(Jxt.prototype,"_alignFlags",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$xt=ct(Jxt.prototype,"_target",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tEt=ct(Jxt.prototype,"_left",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eEt=ct(Jxt.prototype,"_right",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nEt=ct(Jxt.prototype,"_top",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iEt=ct(Jxt.prototype,"_bottom",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rEt=ct(Jxt.prototype,"_horizontalCenter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aEt=ct(Jxt.prototype,"_verticalCenter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oEt=ct(Jxt.prototype,"_isAbsLeft",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sEt=ct(Jxt.prototype,"_isAbsRight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cEt=ct(Jxt.prototype,"_isAbsTop",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lEt=ct(Jxt.prototype,"_isAbsBottom",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uEt=ct(Jxt.prototype,"_isAbsHorizontalCenter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hEt=ct(Jxt.prototype,"_isAbsVerticalCenter",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fEt=ct(Jxt.prototype,"_originalWidth",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_Et=ct(Jxt.prototype,"_originalHeight",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dEt=ct(Jxt.prototype,"_alignMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yEt.ON_WINDOW_RESIZE}}),pEt=ct(Jxt.prototype,"_lockFlags",[Dc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qxt=Jxt))||Qxt)||Qxt)||Qxt)||Qxt)||Qxt)||Qxt));l.internal.computeInverseTransForTarget=EEt,l.internal.getReadonlyNodeSize=xEt,l.Widget=jEt;var XEt,qEt=new Pn;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(XEt||(XEt={})),le(XEt);var YEt,KEt,QEt,JEt,ZEt,$Et,tAt,eAt,nAt,iAt,rAt,aAt,oAt,sAt,cAt,lAt,uAt,hAt,fAt,_At,dAt,pAt,mAt,gAt,vAt,yAt,SAt,TAt,xAt,EAt,AAt,CAt,bAt,wAt,IAt,PAt,RAt,DAt,OAt,NAt,MAt,LAt,FAt,BAt=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((AEt=Ec("cc.PageViewIndicator"),CEt=Gc(),bEt=Cc(110),wEt=Bc(),IEt=al(XF),PEt=Xc(),REt=al(XEt),DEt=Xc(),OEt=al(ii),NEt=Xc(),MEt=Xc(),AEt(LEt=CEt(LEt=bEt(LEt=wEt((VEt=GEt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"spacing",BEt,rt(e)),st(e,"_spriteFrame",zEt,rt(e)),st(e,"_direction",UEt,rt(e)),st(e,"_cellSize",kEt,rt(e)),e._layout=null,e._pageView=null,e._indicators=[],e}Z(e,t);var n=e.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(zyt),this._layout||(this._layout=this.addComponent(zyt));var t=this._layout;this.direction===XEt.HORIZONTAL?(t.type=zyt.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===XEt.VERTICAL&&(t.type=zyt.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=zyt.ResizeMode.CONTAINER},n._createIndicator=function(){var t=new ob;t.layer=this.node.layer;var e=t.addComponent(kV);return e.spriteFrame=this.spriteFrame,e.sizeMode=kV.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var n=0;n<t.length;++n){var i=t[n];if(i._uiProps.uiComp){var r=i._uiProps.uiComp;qEt.set(r.color),qEt.a=127.5,r.color=qEt}}if(t[e]._uiProps.uiComp){var a=t[e]._uiProps.uiComp;qEt.set(a.color),qEt.a=255,a.color=qEt}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var n=0;if(e.length>t.length)for(n=0;n<e.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-e.length;n>0;--n){var i=t[n-1];this.node.removeChild(i),t.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},Q(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(Zu),GEt.Direction=XEt,ct((FEt=VEt).prototype,"spriteFrame",[IEt,PEt],Object.getOwnPropertyDescriptor(FEt.prototype,"spriteFrame"),FEt.prototype),ct(FEt.prototype,"direction",[REt,DEt],Object.getOwnPropertyDescriptor(FEt.prototype,"direction"),FEt.prototype),ct(FEt.prototype,"cellSize",[OEt,NEt],Object.getOwnPropertyDescriptor(FEt.prototype,"cellSize"),FEt.prototype),BEt=ct(FEt.prototype,"spacing",[Dc,MEt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zEt=ct(FEt.prototype,"_spriteFrame",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UEt=ct(FEt.prototype,"_direction",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XEt.HORIZONTAL}}),kEt=ct(FEt.prototype,"_cellSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ii(20,20)}}),LEt=FEt))||LEt)||LEt)||LEt)||LEt));l.PageViewIndicator=BAt;var zAt,UAt,kAt,GAt=new Qn;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(zAt||(zAt={})),le(zAt),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(UAt||(UAt={})),le(UAt),function(t){t.PAGE_TURNING="page-turning"}(kAt||(kAt={}));var VAt=function(e){return t({PageView:e,PageViewComponent:e}),e}((YEt=Ec("cc.PageView"),KEt=Gc(),QEt=Cc(110),JEt=Bc(),ZEt=al(zAt),$Et=Xc(),tAt=al(UAt),eAt=Xc(),nAt=qc(),iAt=Xc(),rAt=qc(),aAt=Xc(),oAt=al(BAt),sAt=Xc(),cAt=Xc(),lAt=al(vSt),uAt=Hc(),hAt=al(vSt),fAt=Hc(),_At=Hc(),dAt=Hc(),pAt=Hc(),mAt=al([cF]),gAt=Hc(),vAt=Xc(),yAt=al([cF]),SAt=Xc(),YEt(TAt=KEt(TAt=QEt(TAt=JEt((FAt=LAt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"autoPageTurningThreshold",EAt,rt(e)),st(e,"horizontal",AAt,rt(e)),st(e,"vertical",CAt,rt(e)),st(e,"cancelInnerEvents",bAt,rt(e)),st(e,"scrollEvents",wAt,rt(e)),st(e,"pageTurningSpeed",IAt,rt(e)),st(e,"pageEvents",PAt,rt(e)),st(e,"_sizeMode",RAt,rt(e)),st(e,"_direction",DAt,rt(e)),st(e,"_scrollThreshold",OAt,rt(e)),st(e,"_pageTurningEventTiming",NAt,rt(e)),st(e,"_indicator",MAt,rt(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new Dn,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Qn,e._touchEndPosition=new Qn,e}Z(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(rA.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(rA.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):I(4301))},n.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void I(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):R(4300,t.name)}},n.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var n=e[t];n&&this.content&&(this.content.removeChild(n),e.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,n=t.length;e<n;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(zyt);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,i=0;i<e;++i){var r=this._pages[i].position;this.direction===UAt.Horizontal?this._scrollCenterOffsetX[i]=Math.abs(n.x+r.x):this._scrollCenterOffsetY[i]=Math.abs(n.y+r.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===zAt.Unified)for(var e=this._pages,n=t.contentSize,i=0,r=e.length;i<r;i++)e[i]._uiProps.uiTransformComp.setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},n._onTouchBegan=function(e,n){e.touch.getUILocation(GAt),Qn.set(this._touchBeganPosition,GAt.x,GAt.y),t.prototype._onTouchBegan.call(this,e,n)},n._onTouchMoved=function(e,n){t.prototype._onTouchMoved.call(this,e,n)},n._onTouchEnded=function(e,n){e.touch.getUILocation(GAt),Qn.set(this._touchEndPosition,GAt.x,GAt.y),t.prototype._onTouchEnded.call(this,e,n)},n._onTouchCancelled=function(e,n){e.touch.getUILocation(GAt),Qn.set(this._touchEndPosition,GAt.x,GAt.y),t.prototype._onTouchCancelled.call(this,e,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=this.direction===UAt.Horizontal,this.vertical=this.direction===UAt.Vertical},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(zyt);if(e){if(this._sizeMode===zAt.Free&&this._pages.length>0){var n=this._pages[0]._uiProps.uiTransformComp,i=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===UAt.Horizontal?(e.paddingLeft=(t.width-n.width)/2,e.paddingRight=(t.width-i.width)/2):this.direction===UAt.Vertical&&(e.paddingTop=(t.height-n.height)/2,e.paddingBottom=(t.height-i.height)/2)}e.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var n=t[e];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cF.emitEvents(this.pageEvents,this,kAt.PAGE_TURNING),this.node.emit(kAt.PAGE_TURNING,this))},n._isQuicklyScrollable=function(t){if(this.direction===UAt.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===UAt.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var e=new Qn;if(this._sizeMode===zAt.Free)this.direction===UAt.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===UAt.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var n=this.view;if(!n)return e;this.direction===UAt.Horizontal?e.x=t*n.width:this.direction===UAt.Vertical&&(e.y=t*n.height)}return e},n._getDragDirection=function(t){return this._direction===UAt.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,e,n){if(this._sizeMode===zAt.Free){var i=0,r=0;if(this.direction===UAt.Horizontal)return i=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(i-r)*this.scrollThreshold;if(this.direction===UAt.Vertical)return i=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(i-r)*this.scrollThreshold}else{var a=this.view;if(!a)return!1;if(this.direction===UAt.Horizontal)return Math.abs(t.x)>=a.width*this.scrollThreshold;if(this.direction===UAt.Vertical)return Math.abs(t.y)>=a.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Qn;Qn.subtract(e,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,i=n+this._getDragDirection(e),r=this.pageTurningSpeed*Math.abs(n-i);if(i<this._pages.length){if(this._isScrollable(e,n,i))return void this.scrollToPage(i,r);var a=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(a))return void this.scrollToPage(i,r)}this.scrollToPage(n,r)}},Q(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(HTt),LAt.SizeMode=zAt,LAt.Direction=UAt,LAt.EventType=_xt(kAt,dTt),ct((xAt=FAt).prototype,"sizeMode",[ZEt,$Et],Object.getOwnPropertyDescriptor(xAt.prototype,"sizeMode"),xAt.prototype),ct(xAt.prototype,"direction",[tAt,eAt],Object.getOwnPropertyDescriptor(xAt.prototype,"direction"),xAt.prototype),ct(xAt.prototype,"scrollThreshold",[Jc,nAt,iAt],Object.getOwnPropertyDescriptor(xAt.prototype,"scrollThreshold"),xAt.prototype),ct(xAt.prototype,"pageTurningEventTiming",[Jc,rAt,aAt],Object.getOwnPropertyDescriptor(xAt.prototype,"pageTurningEventTiming"),xAt.prototype),ct(xAt.prototype,"indicator",[oAt,sAt],Object.getOwnPropertyDescriptor(xAt.prototype,"indicator"),xAt.prototype),EAt=ct(xAt.prototype,"autoPageTurningThreshold",[Dc,cAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ct(xAt.prototype,"verticalScrollBar",[lAt,sl,uAt],Object.getOwnPropertyDescriptor(xAt.prototype,"verticalScrollBar"),xAt.prototype),ct(xAt.prototype,"horizontalScrollBar",[hAt,sl,fAt],Object.getOwnPropertyDescriptor(xAt.prototype,"horizontalScrollBar"),xAt.prototype),AAt=ct(xAt.prototype,"horizontal",[sl,Dc,_At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),CAt=ct(xAt.prototype,"vertical",[sl,Dc,dAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bAt=ct(xAt.prototype,"cancelInnerEvents",[sl,Dc,pAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),wAt=ct(xAt.prototype,"scrollEvents",[mAt,Dc,sl,gAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IAt=ct(xAt.prototype,"pageTurningSpeed",[Dc,Vc,vAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),PAt=ct(xAt.prototype,"pageEvents",[yAt,Dc,SAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RAt=ct(xAt.prototype,"_sizeMode",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zAt.Unified}}),DAt=ct(xAt.prototype,"_direction",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UAt.Horizontal}}),OAt=ct(xAt.prototype,"_scrollThreshold",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),NAt=ct(xAt.prototype,"_pageTurningEventTiming",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),MAt=ct(xAt.prototype,"_indicator",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TAt=xAt))||TAt)||TAt)||TAt)||TAt));l.PageView=VAt;var HAt=new Dn,WAt=new Qn,jAt=new Qn,XAt=new Qn(1,1),qAt=new Qn,YAt=new Qn;function KAt(t,e){if(!e._hadAlignOnce){e.alignMode===yEt.ONCE&&(e._hadAlignOnce=!0);var n,i=e.target,r=jAt,a=XAt;i?EEt(t,n=i,r,a):n=t.parent;var o=xEt(n),s=n instanceof GR||!n.getComponent(xz),c=s?WAt:n.getComponent(xz).anchorPoint,l=s;t.getPosition(HAt);var u=t._uiProps.uiTransformComp,h=HAt.x,f=HAt.y,_=u.anchorPoint,d=t.getScale();if(e.alignFlags&SEt.HORIZONTAL){var p=0,m=0,g=o.width;l?(p=fN.left.x,m=fN.right.x):m=(p=-c.x*g)+g,p+=e.isAbsoluteLeft?e.left:e.left*g,m-=e.isAbsoluteRight?e.right:e.right*g,i&&(p+=r.x,p*=a.x,m+=r.x,m*=a.x);var v=0,y=_.x,S=d.x;if(S<0&&(y=1-y,S=-S),e.isStretchWidth)v=m-p,0!==S&&(u.width=v/S),h=p+y*v;else if(v=u.width*S,e.isAlignHorizontalCenter){var T=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*g,x=(.5-c.x)*o.width;i&&(T*=a.x,x+=r.x,x*=a.x),h=x+(y-.5)*v+T}else h=e.isAlignLeft?p+y*v:m+(y-1)*v;e._lastSize.width=v}if(e.alignFlags&SEt.VERTICAL){var E=0,A=0,C=o.height;l?(A=fN.bottom.y,E=fN.top.y):E=(A=-c.y*C)+C,A+=e.isAbsoluteBottom?e.bottom:e.bottom*C,E-=e.isAbsoluteTop?e.top:e.top*C,i&&(A+=r.y,A*=a.y,E+=r.y,E*=a.y);var b=0,w=_.y,I=d.y;if(I<0&&(w=1-w,I=-I),e.isStretchHeight)b=E-A,0!==I&&(u.height=b/I),f=A+w*b;else if(b=u.height*I,e.isAlignVerticalCenter){var P=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*C,R=(.5-c.y)*o.height;i&&(P*=a.y,R+=r.y,R*=a.y),f=R+(w-.5)*b+P}else f=e.isAlignBottom?A+w*b:E+(w-1)*b;e._lastSize.height=b}t.setPosition(h,f,HAt.z),Dn.set(e._lastPos,h,f,HAt.z)}}function QAt(t){var e=t.getComponent(jEt);if(e&&e.enabled){if(!l.isValid(t,!0))return;$At.push(e)}for(var n,i=ot(t.children);!(n=i()).done;){var r=n.value;r.active&&QAt(r)}}function JAt(){var t=lN.getScene();if(t){tCt.isAligning=!0,tCt._nodesOrderDirty&&($At.length=0,QAt(t),tCt._nodesOrderDirty=!1);var e=null,n=tCt._activeWidgetsIterator;for(n.i=0;n.i<$At.length;++n.i)(e=$At[n.i])._dirty&&(KAt(e.node,e),e._dirty=!1);tCt.isAligning=!1}}var ZAt,$At=[],tCt=t("widgetManager",l._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new ne.MutableForwardIterator($At),animationState:null,init:function(){lN.on(cN.EVENT_AFTER_SCENE_LAUNCH,JAt),lN.on(cN.EVENT_AFTER_UPDATE,JAt),pN.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);pN.instance.on("canvas-resize",t),ah.on("orientation-change",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=lN.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=ob.isNode(t)&&t.getComponent(jEt);e&&e.enabled&&(e.alignMode===yEt.ON_WINDOW_RESIZE||e.alignMode===yEt.ALWAYS)&&e.setDirty();for(var n,i=ot(t.children);!(n=i()).done;){var r=n.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,e){function n(t,e){return Math.abs(t-e)>1e-10?e:t}var i=t.node,r=i.parent;if(r){var a=qAt;a.set(0,0);var o=YAt;if(o.set(1,1),t.target&&EEt(i,r=t.target,a,o),!e)return;var s=r._uiProps&&r._uiProps.uiTransformComp,c=s?s.anchorPoint:WAt,l=i._uiProps.uiTransformComp,u=xEt(r),h=l.anchorPoint,f=i.getPosition(),_=SEt,d=i.getScale(),p=0;if(e&_.LEFT){var m=-c.x*u.width;m+=a.x,m*=o.x,p=f.x-h.x*l.width*Math.abs(d.x)-m,t.isAbsoluteLeft||(p/=u.width),p/=o.x,t.left=n(t.left,p)}if(e&_.RIGHT){var g=(1-c.x)*u.width;g+=a.x,p=(g*=o.x)-(f.x+(1-h.x)*l.width*Math.abs(d.x)),t.isAbsoluteRight||(p/=u.width),p/=o.x,t.right=n(t.right,p)}if(e&_.TOP){var v=(1-c.y)*u.height;v+=a.y,p=(v*=o.y)-(f.y+(1-h.y)*l.height*Math.abs(d.y)),t.isAbsoluteTop||(p/=u.height),p/=o.y,t.top=n(t.top,p)}if(e&_.BOT){var y=-c.y*u.height;y+=a.y,y*=o.y,p=f.y-h.y*l.height*Math.abs(d.y)-y,t.isAbsoluteBottom||(p/=u.height),p/=o.y,t.bottom=n(t.bottom,p)}}},updateAlignment:function t(e){var n=e.parent;n&&ob.isNode(n)&&t(n);var i=e.getComponent(jEt);i&&n&&KAt(e,i)},AlignMode:yEt,AlignFlags:SEt});lN.on(cN.EVENT_INIT,(function(){tCt.init()}));var eCt,nCt,iCt,rCt,aCt,oCt,sCt,cCt,lCt,uCt,hCt,fCt,_Ct,dCt,pCt,mCt,gCt,vCt,yCt,SCt=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}(Ec("cc.SafeArea")(ZAt=Gc()(ZAt=Cc(110)(ZAt=Fc(ZAt=Bc()(ZAt=Ac(jEt)(ZAt=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.onEnable=function(){this.updateArea(),ah.on("window-resize",this.updateArea,this),ah.on("orientation-change",this.updateArea,this)},n.onDisable=function(){ah.off("window-resize",this.updateArea,this),ah.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(jEt),e=this.node.getComponent(xz);if(t&&e){t.updateAlignment();var n=this.node.position.clone(),i=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var r=yN.getVisibleSize(),a=r.width,o=r.height,s=ch.getSafeAreaRect();t.top=o-s.y-s.height,t.bottom=s.y,t.left=s.x,t.right=a-s.x-s.width,t.updateAlignment();var c=this.node.position.clone(),l=i.x-(c.x-n.x)/e.width,u=i.y-(c.y-n.y)/e.height;e.setAnchorPoint(l,u),tCt.add(t)}},e}(Zu))||ZAt)||ZAt)||ZAt)||ZAt)||ZAt)||ZAt);l.SafeArea=SCt;var TCt,xCt=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((eCt=Ec("cc.UICoordinateTracker"),nCt=Gc(),iCt=Bc(),rCt=Cc(110),aCt=al(ob),oCt=Xc(),sCt=al(wF),cCt=Xc(),lCt=Xc(),uCt=Xc(),hCt=al([cF]),fCt=Xc(),eCt(_Ct=nCt(_Ct=iCt(_Ct=rCt((ct((dCt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"syncEvents",pCt,rt(e)),st(e,"_target",mCt,rt(e)),st(e,"_camera",gCt,rt(e)),st(e,"_useScale",vCt,rt(e)),st(e,"_distance",yCt,rt(e)),e._transformPos=new Dn,e._viewPos=new Dn,e._canMove=!0,e._lastWPos=new Dn,e._lastCameraPos=new Dn,e}Z(e,t);var n=e.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Dn.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);cF.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(Zu)).prototype,"target",[aCt,oCt],Object.getOwnPropertyDescriptor(dCt.prototype,"target"),dCt.prototype),ct(dCt.prototype,"camera",[sCt,cCt],Object.getOwnPropertyDescriptor(dCt.prototype,"camera"),dCt.prototype),ct(dCt.prototype,"useScale",[lCt],Object.getOwnPropertyDescriptor(dCt.prototype,"useScale"),dCt.prototype),ct(dCt.prototype,"distance",[uCt],Object.getOwnPropertyDescriptor(dCt.prototype,"distance"),dCt.prototype),pCt=ct(dCt.prototype,"syncEvents",[hCt,Dc,fCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mCt=ct(dCt.prototype,"_target",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gCt=ct(dCt.prototype,"_camera",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vCt=ct(dCt.prototype,"_useScale",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yCt=ct(dCt.prototype,"_distance",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_Ct=dCt))||_Ct)||_Ct)||_Ct)||_Ct)),ECt=[rA.TOUCH_START,rA.TOUCH_END,rA.TOUCH_MOVE,rA.MOUSE_DOWN,rA.MOUSE_MOVE,rA.MOUSE_UP,rA.MOUSE_ENTER,rA.MOUSE_LEAVE,rA.MOUSE_WHEEL];function ACt(t){t.propagationStopped=!0}var CCt,bCt,wCt,ICt,PCt,RCt,DCt,OCt,NCt,MCt,LCt,FCt,BCt=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(Ec("cc.BlockInputEvents")(TCt=Gc()(TCt=Bc()(TCt=function(t){function e(){return t.apply(this,arguments)||this}Z(e,t);var n=e.prototype;return n.onEnable=function(){for(var t=0;t<ECt.length;t++)this.node.on(ECt[t],ACt,this)},n.onDisable=function(){for(var t=0;t<ECt.length;t++)this.node.off(ECt[t],ACt,this)},e}(Zu))||TCt)||TCt)||TCt),zCt=t("SubContextView",(CCt=Ec("cc.SubContextView"),bCt=Gc(),wCt=Cc(110),ICt=Ac(xz),PCt=Bc(),RCt=Xc(),DCt=Xc(),CCt(OCt=bCt(OCt=wCt(OCt=ICt(OCt=PCt((ct((NCt=function(t){function e(){var e;return st(e=t.call(this)||this,"_fps",MCt,rt(e)),e._sprite=void 0,e._imageAsset=void 0,e._texture=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,st(e,"_designResolutionSize",LCt,rt(e)),e._content=new ob("content"),e._content.hideFlags|=_l.Flags.DontSave|_l.Flags.HideInHierarchy,e._sprite=null,e._imageAsset=new jm,e._openDataContext=null,e._updatedTime=performance.now(),e._texture=new dg,e}Z(e,t);var n=e.prototype;return n.onLoad=function(){NF.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=NF.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._unregisterNodeEvent()},n._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._designResolutionSize.width,n=this._designResolutionSize.height;t.width=e,t.height=n}},n._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(kV),this._sprite||(this._sprite=this._content.addComponent(kV)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var n=new XF;n.texture=this._texture,this._sprite.spriteFrame=n}this._content.parent=this.node}},n._updateSubContextView=function(){if(this._openDataContext){var t=this.node.getComponent(xz),e=this._content.getComponent(xz),n=t.width/e.width,i=t.height/e.height,r=n>i?i:n;e.width*=r,e.height*=r;var a=yN.getViewportRect(),o=e.getBoundingBoxToWorld(),s=yN.getVisibleSize(),c=ah.devicePixelRatio,l=(a.width*(o.x/s.width)+a.x)/c,u=(a.height*(o.y/s.height)+a.y)/c,h=a.width*(o.width/s.width)/c,f=a.height*(o.height/s.height)/c;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:u,width:h,height:f})}},n._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}},n._registerNodeEvent=function(){this.node.on(rA.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(rA.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(rA.LAYER_CHANGED,this._updateContentLayer,this)},n._unregisterNodeEvent=function(){this.node.off(rA.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(rA.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(rA.LAYER_CHANGED,this._updateContentLayer,this)},n._updateContentLayer=function(){this._content.layer=this.node.layer},n.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},n.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},Q(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}(Zu)).prototype,"designResolutionSize",[RCt],Object.getOwnPropertyDescriptor(NCt.prototype,"designResolutionSize"),NCt.prototype),ct(NCt.prototype,"fps",[DCt],Object.getOwnPropertyDescriptor(NCt.prototype,"fps"),NCt.prototype),MCt=ct(NCt.prototype,"_fps",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),LCt=ct(NCt.prototype,"_designResolutionSize",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ii(640,960)}}),OCt=NCt))||OCt)||OCt)||OCt)||OCt)||OCt));l.SubContextView=zCt;var UCt,kCt,GCt,VCt,HCt=t("UIReorderComponent",Ec("cc.UIReorderComponent")(FCt=function(){R(1408,"UIReorderComponent")})||FCt);l.UIReorderComponent=HCt,l.ButtonComponent=Gmt,ie.setClassAlias(Gmt,"cc.ButtonComponent"),l.EditBoxComponent=_yt,ie.setClassAlias(_yt,"cc.EditBoxComponent"),l.LayoutComponent=zyt,ie.setClassAlias(zyt,"cc.LayoutComponent"),l.ProgressBarComponent=lSt,ie.setClassAlias(lSt,"cc.ProgressBarComponent"),l.ScrollViewComponent=HTt,ie.setClassAlias(HTt,"cc.ScrollViewComponent"),l.ScrollBarComponent=vSt,ie.setClassAlias(vSt,"cc.ScrollBarComponent"),l.SliderComponent=fxt,ie.setClassAlias(fxt,"cc.SliderComponent"),l.ToggleComponent=bxt,ie.setClassAlias(bxt,"cc.ToggleComponent"),l.ToggleContainerComponent=vEt,ie.setClassAlias(vEt,"cc.ToggleContainerComponent"),l.WidgetComponent=jEt,ie.setClassAlias(jEt,"cc.WidgetComponent"),l.PageViewComponent=VAt,ie.setClassAlias(VAt,"cc.PageViewComponent"),l.PageViewIndicatorComponent=BAt,ie.setClassAlias(BAt,"cc.PageViewIndicatorComponent"),l.SafeAreaComponent=SCt,ie.setClassAlias(SCt,"cc.SafeAreaComponent"),ie.setClassAlias(xCt,"cc.UICoordinateTrackerComponent"),l.BlockInputEventsComponent=BCt,ie.setClassAlias(BCt,"cc.BlockInputEventsComponent");var WCt=t("VideoClip",Ec("cc.VideoClip")((VCt=function(t){function e(){var e;return st(e=t.call(this)||this,"_duration",GCt,rt(e)),e._video=null,e}return Z(e,t),Q(e,[{key:"_nativeAsset",get:function(){return this._video},set:function(t){this._video=t,this._duration=t?t.duration:0}}]),e}(Du),GCt=ct((kCt=VCt).prototype,"_duration",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UCt=kCt))||UCt);function jCt(t,e,n){var i=document.createElement("video"),r=document.createElement("source");i.appendChild(r);var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=function(){200===this.status||0===this.status?(r.src=URL.createObjectURL(this.response),n(null,i)):n(new Error(a.status+"(no response)"))},a.onerror=function(){var e="load video failure - "+t;y(e),n(new Error(e))},a.send()}function XCt(t,e,n,i){var r=new WCt;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}$N.register({".mp4":jCt,".avi":jCt,".mov":jCt,".mpg":jCt,".mpeg":jCt,".rm":jCt,".rmvb":jCt}),oM.register({".mp4":XCt,".avi":XCt,".mov":XCt,".mpg":XCt,".mpeg":XCt,".rm":XCt,".rmvb":XCt});var qCt,YCt,KCt=oe({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(qCt||(qCt={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(YCt||(YCt={}));var QCt=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=qCt.NONE,this._video=null,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(xz),this._onHide=function(){e.video&&e._state===qCt.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},l.game.on(l.Game.EVENT_HIDE,this._onHide),l.game.on(l.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(qCt.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(qCt.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(qCt.PLAYING)},e.onPlaying=function(){this.dispatchEvent(qCt.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(qCt.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(qCt.STOPPED)},e.onEnded=function(){this.dispatchEvent(qCt.COMPLETED)},e.onClick=function(){this.dispatchEvent(qCt.CLICKED)},e.onError=function(t){this.dispatchEvent(qCt.ERROR);var e=t.target;e&&e.error&&T("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),l.game.off(l.Game.EVENT_HIDE,this._onHide),l.game.off(l.Game.EVENT_SHOW,this._onShow)},Q(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return lN.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();l.internal.VideoPlayerImpl=QCt;var JCt,ZCt,$Ct,tbt,ebt,nbt,ibt,rbt,abt,obt,sbt,cbt,lbt,ubt,hbt,fbt,_bt,dbt,pbt,mbt,gbt,vbt,ybt,Sbt,Tbt,xbt,Ebt,Abt,Cbt,bbt,wbt,Ibt,Pbt,Rbt,Dbt,Obt,Nbt,Mbt,Lbt,Fbt=-Math.pow(2,15),Bbt=Kn(),zbt=function(t){function e(e){var n;return(n=t.call(this,e)||this)._eventList=new Map,n._clearColorA=-1,n._clearFlag=void 0,n}Z(e,t);var n=e.prototype;return n.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},n.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,n){t._video&&t._video.removeEventListener(n,e)})),this._eventList.clear()},n.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},n.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},n.resume=function(){this.play()},n.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(qCt.STOPPED)}),0))},n.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},n.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},n.syncPlaybackRate=function(t){ch.browserType!==nu.UC?this.video&&(this.video.playbackRate=t):S("playbackRate is not supported by the uc mobile browser.")},n.syncVolume=function(t){this.video&&(this.video.volume=t)},n.syncMute=function(t){this.video&&(this.video.muted=t)},n.syncLoop=function(t){this.video&&(this.video.loop=t)},n.getDuration=function(){return this.video?this.video.duration:0},n.getCurrentTime=function(){return this.video?this.video.currentTime:-1},n.seekTo=function(t){this.video&&(this.video.currentTime=t)},n.canFullScreen=function(t){var e=this,n=this._video;if(n&&n.readyState===YCt.HAVE_ENOUGH_DATA)return ch.os===au.IOS&&ch.isBrowser?(t?n.webkitEnterFullscreen&&n.webkitEnterFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen(),void(this._fullScreenOnAwake=n.webkitDisplayingFullscreen)):sh.supportsFullScreen?void(t?(ch.browserType===nu.IE&&(n.style.transform=""),n.setAttribute("x5-video-player-fullscreen","true"),sh.requestFullScreen(n,(function(t){var i=ch.browserType===nu.IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=i===n}),(function(){e._fullScreenOnAwake=!1}))):(n.removeAttribute("x5-video-player-fullscreen"),sh.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},n.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?Fbt:0,this._stayOnBottom=t),this._dirty=!0},n.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},n.removeVideoPlayer=function(){var t=this._video;t&&ye(sN.container,t)&&(sN.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},n.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),sN.container.appendChild(e);var n=document.createElement("source");e.appendChild(n),n.src=t},n._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},n.onCanPlay=function(e){var n=e.target;if(!this._loaded||!n)switch(n.readyState){case YCt.HAVE_METADATA:case YCt.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},n.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},n.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},n.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t&&!sh.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=Ji.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(Bbt),t.update(!0),t.worldMatrixToScreen(Bbt,Bbt,sN.canvas.width,sN.canvas.height);var e=0,n=0;if(this._fullScreenOnAwake?(e=fN.width,n=fN.height):(e=this._uiTrans.contentSize.width,n=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==Bbt.m00||this._m01!==Bbt.m01||this._m04!==Bbt.m04||this._m05!==Bbt.m05||this._m12!==Bbt.m12||this._m13!==Bbt.m13||this._w!==e||this._h!==n){this._m00=Bbt.m00,this._m01=Bbt.m01,this._m04=Bbt.m04,this._m05=Bbt.m05,this._m12=Bbt.m12,this._m13=Bbt.m13,this._w=e,this._h=n;var i=ah.devicePixelRatio,r=1/i,a=1/i,o=sN.container,s=Bbt.m00*r,c=Bbt.m01,l=Bbt.m04,u=Bbt.m05*a;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",ch.browserType!==nu.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":S("keepAspectRatio is not supported by the qq mobile browser.");var h=this._w*r,f=this._h*a,_=this._uiTrans.anchorPoint,d=_.x,p=_.y,m=h*Bbt.m00*d,g=f*Bbt.m05*p,v=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,y=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,T="matrix("+s+","+-c+","+-l+","+u+","+(Bbt.m12*r-m+v)+","+-(Bbt.m13*a-g+y)+")";this._video.style.transform=T,this._video.style["-webkit-transform"]=T,ch.browserType!==nu.IE&&(this._forceUpdate=!1)}}}},e}(QCt),Ubt=function(){function t(){}return t.getImpl=function(t){return new zbt(t)},t}();l.internal.VideoPlayerImplManager=Ubt;var kbt,Gbt=t("VideoPlayer",(JCt=Ec("cc.VideoPlayer"),ZCt=Gc(),$Ct=Bc(),tbt=Ac(xz),ebt=al(WCt),nbt=al(KCt),ibt=Xc(),rbt=Xc(),abt=al(WCt),obt=Xc(),sbt=Xc(),cbt=qc(),lbt=Xc(),ubt=qc(),hbt=Xc(),fbt=Xc(),_bt=Xc(),dbt=Xc(),pbt=Xc(),mbt=Xc(),gbt=al([cF]),vbt=Zc(),ybt=Xc(),JCt(Sbt=ZCt(Sbt=$Ct(Sbt=tbt(Sbt=Fc((Lbt=Mbt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_resourceType",xbt,rt(e)),st(e,"_remoteURL",Ebt,rt(e)),st(e,"_clip",Abt,rt(e)),st(e,"_playOnAwake",Cbt,rt(e)),st(e,"_volume",bbt,rt(e)),st(e,"_mute",wbt,rt(e)),st(e,"_playbackRate",Ibt,rt(e)),st(e,"_loop",Pbt,rt(e)),st(e,"_fullScreenOnAwake",Rbt,rt(e)),st(e,"_stayOnBottom",Dbt,rt(e)),st(e,"_keepAspectRatio",Obt,rt(e)),e._impl=null,e._cachedCurrentTime=0,st(e,"videoPlayerEvent",Nbt,rt(e)),e}Z(e,t);var n=e.prototype;return n.syncSource=function(){this._impl&&(this._resourceType===KCt.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},n.__preload=function(){this._impl=Ubt.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(qCt.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(qCt.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(qCt.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(qCt.PAUSED,this.onPaused.bind(this)),this._impl.componentEventList.set(qCt.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(qCt.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(qCt.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},n.onMetaLoaded=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.META_LOADED),this.node.emit("meta-loaded",this)},n.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),cF.emitEvents(this.videoPlayerEvent,this,qCt.READY_TO_PLAY),this.node.emit(qCt.READY_TO_PLAY,this)},n.onPlaying=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.PLAYING),this.node.emit(qCt.PLAYING,this)},n.onPaused=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.PAUSED),this.node.emit(qCt.PAUSED,this)},n.onStopped=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.STOPPED),this.node.emit(qCt.STOPPED,this)},n.onCompleted=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.COMPLETED),this.node.emit(qCt.COMPLETED,this)},n.onError=function(){cF.emitEvents(this.videoPlayerEvent,this,qCt.ERROR),this.node.emit(qCt.ERROR,this)},n.play=function(){this._impl&&this._impl.play()},n.resume=function(){this._impl&&this._impl.resume()},n.pause=function(){this._impl&&this._impl.pause()},n.stop=function(){this._impl&&this._impl.stop()},Q(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?S("illegal video time! value:"+t):(t=un(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:qCt.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}(Zu),Mbt.EventType=qCt,Mbt.ResourceType=KCt,xbt=ct((Tbt=Lbt).prototype,"_resourceType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return KCt.LOCAL}}),Ebt=ct(Tbt.prototype,"_remoteURL",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Abt=ct(Tbt.prototype,"_clip",[ebt,Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cbt=ct(Tbt.prototype,"_playOnAwake",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bbt=ct(Tbt.prototype,"_volume",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wbt=ct(Tbt.prototype,"_mute",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ibt=ct(Tbt.prototype,"_playbackRate",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Pbt=ct(Tbt.prototype,"_loop",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rbt=ct(Tbt.prototype,"_fullScreenOnAwake",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Dbt=ct(Tbt.prototype,"_stayOnBottom",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Obt=ct(Tbt.prototype,"_keepAspectRatio",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ct(Tbt.prototype,"resourceType",[nbt,ibt],Object.getOwnPropertyDescriptor(Tbt.prototype,"resourceType"),Tbt.prototype),ct(Tbt.prototype,"remoteURL",[rbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"remoteURL"),Tbt.prototype),ct(Tbt.prototype,"clip",[abt,obt],Object.getOwnPropertyDescriptor(Tbt.prototype,"clip"),Tbt.prototype),ct(Tbt.prototype,"playOnAwake",[sbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"playOnAwake"),Tbt.prototype),ct(Tbt.prototype,"playbackRate",[Jc,cbt,lbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"playbackRate"),Tbt.prototype),ct(Tbt.prototype,"volume",[Jc,ubt,hbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"volume"),Tbt.prototype),ct(Tbt.prototype,"mute",[fbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"mute"),Tbt.prototype),ct(Tbt.prototype,"loop",[_bt],Object.getOwnPropertyDescriptor(Tbt.prototype,"loop"),Tbt.prototype),ct(Tbt.prototype,"keepAspectRatio",[dbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"keepAspectRatio"),Tbt.prototype),ct(Tbt.prototype,"fullScreenOnAwake",[pbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"fullScreenOnAwake"),Tbt.prototype),ct(Tbt.prototype,"stayOnBottom",[mbt],Object.getOwnPropertyDescriptor(Tbt.prototype,"stayOnBottom"),Tbt.prototype),Nbt=ct(Tbt.prototype,"videoPlayerEvent",[Dc,gbt,vbt,ybt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sbt=Tbt))||Sbt)||Sbt)||Sbt)||Sbt)||Sbt));l.internal.VideoPlayer=Gbt,U(Gbt.prototype,"VideoPlayer.prototype",[{name:"onPasued",newName:"onPaused"}]),function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(kbt||(kbt={}));var Vbt=function(){function t(t){this._componentEventList=new Map,this._state=kbt.NONE,this._wrapper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(xz),this.reset(),this.createWebView()}var e=t.prototype;return e.reset=function(){this._wrapper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=kbt.NONE,this._forceUpdate=!1},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.call(this,i)}},e.destroy=function(){this.removeWebView(),this._wrapper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},Q(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return lN.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();l.internal.WebViewImpl=Vbt;var Hbt,Wbt,jbt,Xbt,qbt,Ybt,Kbt,Qbt,Jbt,Zbt,$bt,twt,ewt,nwt,iwt=Kn(),rwt=function(t){function e(e){return t.call(this,e)||this}Z(e,t);var n=e.prototype;return n._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(kbt.LOADED);var n=e.target,i=n.contentDocument&&n.contentDocument.body;i&&i.innerHTML.includes("404")&&t.dispatchEvent(kbt.ERROR,i.innerHTML)}))},n.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(kbt.LOADING))},n.createWebView=function(){var t=document.createElement("div");this._wrapper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",sN.container.appendChild(t);var e=document.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},n.removeWebView=function(){var t=this._wrapper;ye(sN.container,t)&&sN.container.removeChild(t),this.reset()},n.enable=function(){this._wrapper&&(this._wrapper.style.visibility="visible")},n.disable=function(){this._wrapper&&(this._wrapper.style.visibility="hidden")},n.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(kbt.ERROR,t),T(t)}}},n.setOnJSCallback=function(){S("The platform does not support")},n.setJavascriptInterfaceScheme=function(){S("The platform does not support")},n.syncMatrix=function(){if(this._wrapper&&this._uiTrans&&this._component&&"hidden"!==this._wrapper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(iwt),t.update(!0),t.worldMatrixToScreen(iwt,iwt,sN.canvas.width,sN.canvas.height);var e=this._uiTrans.contentSize,n=e.width,i=e.height;if(this._forceUpdate||this._m00!==iwt.m00||this._m01!==iwt.m01||this._m04!==iwt.m04||this._m05!==iwt.m05||this._m12!==iwt.m12||this._m13!==iwt.m13||this._w!==n||this._h!==i){this._m00=iwt.m00,this._m01=iwt.m01,this._m04=iwt.m04,this._m05=iwt.m05,this._m12=iwt.m12,this._m13=iwt.m13,this._w=n,this._h=i;var r=ah.devicePixelRatio,a=1/r,o=1/r,s=sN.container,c=iwt.m00*a,l=iwt.m01,u=iwt.m04,h=iwt.m05*o;this._wrapper.style.width=n+"px",this._wrapper.style.height=i+"px";var f=this._w*a,_=this._h*o,d=f*iwt.m00*this._uiTrans.anchorX,p=_*iwt.m05*this._uiTrans.anchorY,m=s&&s.style.paddingLeft?parseInt(s.style.paddingLeft):0,g=s&&s.style.paddingBottom?parseInt(s.style.paddingBottom):0,v="matrix("+c+","+-l+","+-u+","+h+","+(iwt.m12*a-d+m)+","+-(iwt.m13*o-p+g)+")";this._wrapper.style.transform=v,this._wrapper.style["-webkit-transform"]=v,this._forceUpdate=!1}}}},e}(Vbt),awt=function(){function t(){}return t.getImpl=function(t){return new rwt(t)},t}();l.internal.WebViewImplManager=awt;var owt=t("WebView",(Hbt=Ec("cc.WebView"),Wbt=Gc(),jbt=Bc(),Xbt=Ac(xz),qbt=Xc(),Ybt=al([cF]),Kbt=Zc(),Qbt=Xc(),Hbt(Jbt=Wbt(Jbt=jbt(Jbt=Xbt(Jbt=Fc((nwt=ewt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return st(e=t.call.apply(t,[this].concat(i))||this,"_url",$bt,rt(e)),e._impl=null,st(e,"webviewEvents",twt,rt(e)),e}Z(e,t);var n=e.prototype;return n.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},n.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},n.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},n.__preload=function(){this._impl=awt.getImpl(this),this._impl.componentEventList.set(kbt.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(kbt.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(kbt.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},n.onLoading=function(){cF.emitEvents(this.webviewEvents,this,kbt.LOADING),this.node.emit(kbt.LOADING,this)},n.onLoaded=function(){cF.emitEvents(this.webviewEvents,this,kbt.LOADED),this.node.emit(kbt.LOADED,this)},n.onError=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];cF.emitEvents(this.webviewEvents,this,kbt.ERROR,e),this.node.emit(kbt.ERROR,this,e)},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},Q(e,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:kbt.NONE}}]),e}(Zu),ewt.EventType=kbt,$bt=ct((Zbt=nwt).prototype,"_url",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://cocos.com"}}),ct(Zbt.prototype,"url",[qbt],Object.getOwnPropertyDescriptor(Zbt.prototype,"url"),Zbt.prototype),twt=ct(Zbt.prototype,"webviewEvents",[Dc,Ybt,Kbt,Qbt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jbt=Zbt))||Jbt)||Jbt)||Jbt)||Jbt)||Jbt));l.internal.WebView=owt}}}));
